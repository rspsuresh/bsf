<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />

<style type="text/css">
    .jqx-widget-content{z-index:999 !important;}
    .mar_20{margin-top:20px!important;}
    .subDiv {background-color: #e7e9ec;border: 1px solid #ddd;float: left;margin-left: 2%;margin-top: 2px;position: relative;width: 98%;}
    .sub_tbl1 {color:#424141;font-weight: 600; background:#edefe2 !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{color: #424141;font-weight: 600; background: #efe2e2 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl3{color: #424141;font-weight: 600; background: #ceefe5 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
	.blubg{background : #B0C3EB !important;}
</style>
<div class="content_wrapper padlr0">
	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-12">
				<h1 style="margin-left:10px;">Decision Detail<span class="edit_symbl"></span>&nbsp;&nbsp;</h1>
			</div>
			<div class="col-lg-12">
				<div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear padlr0">
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="RDecisionNo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status6">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-gavel fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $RDecisionNo; ?></div>
										<div class="cbhuge comnelips">Decision No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="RequestDate">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status2">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-calendar fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $RequestDate; ?></div>
										<div class="cbhuge comnelips">Decision Date</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="TypeName">
						<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-certificate fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $TypeName; ?></div>
										<div class="cbhuge comnelips">Decision Type</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="Approve">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status5">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-registered fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $Approve; ?></div>
										<div class="cbhuge comnelips">Status</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-12">
					<div class="table-responsive top-30">
						<!--Table 1-->
						<table id="decisionTable" class="table table-bordered tableView dataTable no-footer table-striped" style=" margin-bottom:0px;">
							<thead>
							<tr>
								<th tabindex="0" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;"  class="blubg" >Code</th>
								<th tabindex="1" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;"  class="blubg" >Resource name</th>
								<th tabindex="2" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px; text-align:center"  class="blubg" >Unit name</th>
								<th class="blubg" >&nbsp;</th>
							</tr>
							</thead>
							<tbody class="main"></tbody>
							<tbody class="total">
							</tbody>
						</table>
						<input type="hidden" name="rowid" id="rowid" value="0"/>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
	<div class="col-lg-12 savebtn_area">
		<ul>
				<li class="dropdown save_btn float_r">
					<a href="<?php echo $this->basePath();?>/ats/decision/register" class="ripple">Back</a>
				</li>
		 </ul>
	</div>
<script id="resource-template"  type="text/template">
    <tr class="count-tr">
		<input type="hidden" name="resourceid__" id="resourceid__"/>
        <td width="30%"  name="code__" id="code__" class="border-none"></td>
        <td width="30%" name="resourcename__" id="resourcename__"  class="border-none" ></td>
        <td width="29%" name="unitname__" id="unitname__"  class="border-none"  style="text-align:center"></td>
		<td width="3%" align="center" class="action_btns_td border-none">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr" id="expandTr__"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
	<tr class="subTr count-tr" style="display:none;">
		<td colspan="9" style="padding-inline-start:0px !important;">
			<div class="subDiv">
				<div class="col-lg-12">
					<div class="table-responsive">
						<table class="table table-bordered" style="margin-bottom:10px !important;margin-top:10px !important;" id="iowTable__" bgcolor="#00FF00" >
							<thead>
							<tr>
								<th class="worktype-activity sub_tbl1">Request No</th>
								<th class="worktype-activity sub_tbl1">Request Date</th>
								<th class="worktype-activity sub_tbl1">Cost Centre</th>
								<th class="worktype-activity sub_tbl1"  style="text-align:center">Bal Qty</th>
								<th class="worktype-activity sub_tbl1"  style="text-align:center">PO Qty</th>
								<th class="worktype-activity sub_tbl1"  style="text-align:center">Transfer</th>
								<th class="worktype-activity sub_tbl1"  style="text-align:center">Production</th>
								<th class="sub_tbl1" >&nbsp;</th>
							</tr>
							</thead>
							<tbody class="main"></tbody>
							<tbody class="total">
							</tbody>
							<input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
						</table>
					</div>
				</div>
			</div>
		</td>
	</tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="9%" class="worktype-activity border-none" name="iow___RequestNo_0" id="iow___RequestNo_0"></td>
        <td width="10%" name="iow___ReqDate_0" id="iow___ReqDate_0" class="border-none"></td>
		<td width="30%" name="iow___CostCentreName_0" id="iow___CostCentreName_0" class="border-none"></td>
        <td width="12%" name="iow___BalQty_0" id="iow___BalQty_0" class="border-none"  style="text-align:right"></td>
		<td width="12%" name="iow___IndentApproveQty_0" id="iow___IndentApproveQty_0" class="border-none" style="text-align:right"></td>
		<td width="12%" name="iow___TransferApproveQty_0" id="iow___TransferApproveQty_0" class="border-none" style="text-align:right"></td>
		<td width="12%" name="iow___ProductionApproveQty_0" id="iow___ProductionApproveQty_0" class="border-none" style="text-align:right"></td>
		<input  type="hidden" name="iow___RequestTransId_0" id="iow___RequestTransId_0">
		<input  type="hidden" name="iow___RequestId_0" id="iow___RequestId_0">
		<input  type="hidden" name="iow___ResourceId_0" id="iow___ResourceId_0">
		<td width="3%" align="center" class="action_btns_td border-none iow___requestfields" style="display:none;"> 
            <ul class="action_btns">
                <li> <a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
	</tr>
	<tr class="subTr dont-hide" style="display:none;">
        <td colspan="9" style="" id="iow___request_0_decreq">
            <div class="subDiv">
                <div class="col-lg-12 col-lg-offset-0 rdbt"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table table-bordered" style="margin-bottom:10px !important;margin-top:10px !important;" id="sec___dec_0_whreqno"></table>
                        <input type="hidden" name="iow___request_0_rowid" id="iow___request_0_rowid" value="0"/>
                        <input type="hidden" name="wh___dec_0_wrowid" id="wh___dec_0_wrowid" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="request-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="38%" name="iow___request_0_WbsName__9" id="iow___request_0_WbsName__9" class="border-none"></td>
		<input  type="hidden" name="iow___request_0_RequestAHTransId__9" id="iow___request_0_RequestAHTransId__9">
        <td width="12%" name="iow___request_0_Quantity__9" id="iow___request_0_Quantity__9" class="border-none" style="text-align:right"></td>
        <td width="12%" name="iow___request_0_BalQty__9" id="iow___request_0_BalQty__9" class="border-none" style="text-align:right"></td>
        <td width="12%" name="iow___request_0_IndentApproveQty__9" id="iow___request_0_IndentApproveQty__9" class="border-none" style="text-align:right"></td>
        <td width="12%" name="iow___request_0_TransferApproveQty__9" id="iow___request_0_TransferApproveQty__9" class="border-none" style="text-align:right"></td>
        <td width="12%" name="iow___request_0_ProductionApproveQty__9" id="iow___request_0_ProductionApproveQty__9" class="border-none" style="text-align:right"></td>
		<input  type="hidden" name="iow___request_0_ReqTransId__9" id="iow___request_0_ReqTransId__9">
		<td width="2%" align="center" class="action_btns_td border-none iow___requestfields_0_wbs" style="display:none;">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
   </tr>
	<tr class="subTr dont-hide" style="display:none;">
        <td colspan="9" style="padding-inline-start:0px !important"  id="iow___request_0_decWbs__9_wbs">
            <div class="subDiv">
                <div class="col-lg-12 col-lg-offset-0 rdbt"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table table-bordered" style="margin-bottom:10px !important;margin-top:10px !important;" id="thr___request_0_wbs__9_whreqno">
                        </table>
                        <input type="hidden" name="wh___dec_0_wbs_45_wrowid" id="wh___dec_0_wbs_45_wrowid" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="iow-po-warehouse"  type="text/template" class="hide">
    <tr class="dont-hide" >
        <td width="20%"  name="wh___dec_0_CostCentreName_4" id="wh___dec_0_CostCentreName_4" class="border-none"></td>
        <td width="20%" name="wh___dec_0_ClosingStock_4" id="wh___dec_0_ClosingStock_4" class="border-none" style="text-align:center"></td>
        <td width="20%" name="wh___dec_0_Qty_4" id="wh___dec_0_Qty_4" class="border-none" style="text-align:center"></td>
		<input type="hidden" name="wh___dec_0_ToCostcentreId_4" id="wh___dec_0_ToCostcentreId_4"/>
		<input type="hidden" name="wh___dec_0_CostCentreId_4" id="wh___dec_0_CostCentreId_4"/>
		<input type="hidden" name="wh___dec_0_ItemId_4" id="wh___dec_0_ItemId_4"/>
		<input type="hidden" name="wh___dec_0_ResourceId_4" id="wh___dec_0_ResourceId_4"/>
    </tr>
</script>
<script>
    $(function () {
       	var RequestId= <?php echo (isset($RequestId)) ? json_encode($RequestId) : '[]'; ?>;
		var ResourceId= <?php echo (isset($ResourceId)) ? json_encode($ResourceId) : '[]'; ?>;
		var ItemId= <?php echo (isset($ItemId)) ? json_encode($ItemId) : '[]'; ?>;
		$("#requestId").val(RequestId);	
		$.ajax({
			url:getBaseURL()+"ats/decision/detailed",
			type:"post",
			data:"reqId="+RequestId+"&resId="+ResourceId+"&ItemId="+ItemId+"&mode=editSecondStep&requestDecId=<?php echo $decId; ?>",
			dataType:"json",
			success:function(data, textStatus, jqXHR){
				$(function () {
					var $rowid = $('#rowid');
					var template = $('#resource-template').html();
					var iowtemplate = $('#iow-template').html();
					var requesttemplate = $('#request-template').html();
					var warepotemplate = $('#iow-po-warehouse').html();
					var rowid = 0;
					var $tbody = $('#decisionTable').find('> tbody.main');
					$.each(data, function(i,o){ 
						rowid += 1;
						$tbody.append(template.replace(/__/g, '_' + rowid));
						$('#code_' + rowid).html(o.Code);
						$('#resourcename_' + rowid).html(o.ResourceName);
						$('#resourceid_' + rowid).val(o.ResourceId);
						$('#unitname_' + rowid).html(o.UnitName);
						/*Request*/
						var pocount = 0;
						if(o.request.length > 0) { 
							$.each(o.request, function (j, l) { 
								var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
								$('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
								$('#iow_' + rowid + '_rowid').val(iowrowid);
								pocount++;
								$('#iow_' + rowid + '_RequestNo_' + iowrowid).html(l.RequestNo);
								$('#iow_' + rowid + '_ReqDate_' + iowrowid).html(l.ReqDate);
								$('#iow_' + rowid + '_CostCentreName_' + iowrowid).html(l.CostCentreName);
								$('#iow_' + rowid + '_BalQty_' + iowrowid).html(l.BalQty);	
								$('#iow_' + rowid + '_RequestTransId_' + iowrowid).val(l.RequestTransId);
								$('#iow_' + rowid + '_RequestId_' + iowrowid).val(l.RequestId);
								$('#iow_' + rowid + '_ResourceId_' + iowrowid).val(l.ResourceId);
								$('#iow_' + rowid + '_IndentApproveQty_' + iowrowid).html(l.IndentApproveQty);
								$('#iow_' + rowid + '_TransferApproveQty_' + iowrowid).html(l.TransferApproveQty);
								$('#iow_' + rowid + '_ProductionApproveQty_' + iowrowid).html(l.ProductionApproveQty);
								/*WBS*/
								requestrowid = 0;
								if (l.wbsResults.length > 0) {
									$('#sec_' + rowid + '_dec_' + iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl3">WBS Name</th> <th class="worktype-activity sub_tbl3" style="text-align:center">Quantity</th> <th class="worktype-activity sub_tbl3" style="text-align:center">Bal Qty</th> <th class="worktype-activity sub_tbl3" style="text-align:center"> PO Qty</th> <th class="worktype-activity sub_tbl3" style="text-align:center">Transfer</th> <th class="worktype-activity sub_tbl3" style="text-align:center">Production</th> <th class="worktype-activity sub_tbl3"></th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody> ');
									$.each(l.wbsResults, function (k, r) {
										requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
										$('#sec_' + rowid + '_dec_' + iowrowid + '_whreqno').find('> tbody.main').append(requesttemplate
											.replace(/__9/g, '_' + requestrowid)
											.replace(/_0/g, '_' + iowrowid)
											.replace(/__/g, '_' + rowid)
											.replace(/_45/g, '_' + requestrowid));

										$('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);
										$('#iow_' + rowid + '_request_' + iowrowid + '_WbsName_' + requestrowid).html(r.WbsName);
										$('#iow_' + rowid + '_request_' + iowrowid + '_Quantity_' + requestrowid).html(r.Quantity);
										$('#iow_' + rowid + '_request_' + iowrowid + '_BalQty_' + requestrowid).html(r.BalQty);
										$('#iow_' + rowid + '_request_' + iowrowid + '_RequestAHTransId_' + requestrowid).val(r.RequestAHTransId);
										$('#iow_' + rowid + '_request_' + iowrowid + '_ReqTransId_' + requestrowid).val(r.ReqTransId);
										$('#iow_' + rowid + '_request_' + iowrowid + '_IndentApproveQty_' + requestrowid).html(r.IndentApproveQty);
										$('#iow_' + rowid + '_request_' + iowrowid + '_TransferApproveQty_' + requestrowid).html(r.TransferApproveQty);
										$('#iow_' + rowid + '_request_' + iowrowid + '_ProductionApproveQty_' + requestrowid).html(r.ProductionApproveQty);
										$('.iow_' + rowid + '_requestfields').show();
										/*Decision*/
										if (r.descision.length != 0) { 

											$('#thr_' + rowid + '_request_' + iowrowid + '_wbs_' + requestrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl2">CostCentreName </th> <th class="worktype-activity sub_tbl2" style="text-align:center">ClosingStock </th> <th class="worktype-activity sub_tbl2" style="text-align:center">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main wbs"></tbody> <tbody class="total"> </tbody>');
											$.each(r.descision, function (u, v) { 
												var whrowid = parseInt($('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val()) + 1;
												$('#thr_' + rowid + '_request_' + iowrowid + '_wbs_' + requestrowid + '_whreqno').find('> tbody.main').append(warepotemplate
													.replace(/_4/g, '_' + whrowid)
													.replace(/_0/g, '_' + iowrowid + '_wbs_' + requestrowid)
													.replace(/__/g, '_' + rowid));

												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val(whrowid);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_CostCentreName_' + whrowid).html(v.CostCentreName);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_ClosingStock_' + whrowid).html(v.ClosingStock);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_Qty_' + whrowid).html(v.Quantity);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_ToCostcentreId_' + whrowid).val(v.ToCostCentreId);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_CostCentreId_' + whrowid).val(v.CostCentreId);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_ItemId_' + whrowid).val(v.ItemId);
												$('#wh_' + rowid + '_dec_' + iowrowid + '_wbs_' + requestrowid + '_ResourceId_' + whrowid).val(v.ResourceId);
												$('.iow_' + rowid + '_requestfields_'+iowrowid+'_wbs').show();
											});
										}else{
											$('#iow_' + rowid + '_request_' + iowrowid + '_decWbs_' + requestrowid + '_wbs').hide();
										}
									});
								} 
								else { 
									
									if (l.descision.length != 0) { 
										$('#sec_' + rowid + '_dec_' + iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl2">CostCentreName</th> <th class="worktype-activity sub_tbl2" style="text-align:center">ClosingStock </th> <th class="worktype-activity sub_tbl2" style="text-align:center">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main iow"></tbody> <tbody class="total"> </tbody>');
										$.each(l.descision, function (u, v) {
											var whrowid1 = parseInt($('#wh_' + rowid + '_dec_' + iowrowid + '_wrowid').val()) + 1;
											$('#sec_' + rowid + '_dec_' + iowrowid + '_whreqno').find('> tbody.main').append(warepotemplate
												.replace(/_4/g, '_' + whrowid1)
												.replace(/_0/g, '_' + iowrowid)
												.replace(/__/g, '_' + rowid));

											$('#wh_' + rowid + '_dec_' + iowrowid + '_wrowid').val(whrowid1);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_CostCentreName_' + whrowid1).html(v.CostCentreName);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_ClosingStock_' + whrowid1).html(v.ClosingStock);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_Qty_' + whrowid1).html(v.Quantity);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_ToCostcentreId_' + whrowid1).val(v.ToCostCentreId);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_CostCentreId_' + whrowid1).val(v.CostCentreId);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_ItemId_' + whrowid1).val(v.ItemId);
											$('#wh_' + rowid + '_dec_' + iowrowid + '_ResourceId_' + whrowid1).val(v.ResourceId);
											$('.iow_' + rowid + '_requestfields').show();
										});
									}else{
										$('#iow_' + rowid + '_request_' + iowrowid + '_decreq').hide();
									}
								}
							});
						}
					});
					$rowid.val(rowid);
				});
			}		
		});	
		
		$('.content_wrapper').on('click', '.mainTr', function (e) {
            e.preventDefault();
            if (!$(this).closest("tr").next(".subTr").is(":visible")) {
                $(this).closest("tr").prevAll(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").prevAll(".subTr").slideUp("slow");
                $(this).closest("tr").nextAll(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").nextAll(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");

                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else {
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        });
    });
	
var RDecisionNo= <?php echo json_encode ($RDecisionNo);?>;
var RequestDate= <?php echo json_encode ($RequestDate);?>;
var TypeName= <?php echo json_encode ($TypeName);?>;
var Approve= <?php echo json_encode ($Approve);?>;
if(RDecisionNo == ''|| RDecisionNo == null) {
	$('#RDecisionNo').hide();
} 
if(RequestDate == ''|| RequestDate == null){
	$('#RequestDate').hide();
} 
if(TypeName == ''|| TypeName == null){
	$('#TypeName').hide();
} 
if(Approve == ''|| Approve == null){
	$('#Approve').hide();
}
</script>


