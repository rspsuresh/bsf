<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css';?>"/>
<!--STYLE-->
<style>
    .pan_box{height:110px !important;}
    .subDiv {border: 0px !important;margin-top: 9px !important;}
    .mar_10{margin-bottom:10px;}
    .exp-tex{margin-bottom:-5px !important;}
    .date_icon{top:10px!important;right:22px !important;}
    #sequentialView tr th{ width:auto !important;}
    .spee-bubble 												{top: 0px !important;margin:auto !important;}
    .spee-bubble 												{position: relative;width:220px;display: block;vertical-align: top;float:right;margin-top:0px !important;}
    .spee-bubble .arow-top-small-container 						{clip: rect(-10px, 40px, 7px, -20px);position: absolute;margin: -6px 0 0 -15px;margin: -7px 0 0 -15px;left: 96%;top: 1px;}
    .spee-bubble .arow 											{position: absolute;z-index: 100;width: 12px;height: 30px;background: #5a84dc;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);display: block;}
    .spee-bubble .inner 											{background-color: #fff;-webkit-border-radius: 0px;-moz-border-radius: 0px;border-radius: 0px;font-size: 15px;text-align: left;white-space: normal;-webkit-box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);-moz-box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
        border:1px solid #083084;padding: 8px 20px;line-height: 20px;color: #999;border-radius:8px 0px 8px 8px;-webkit-border-radius: 8px 0px 8px 8px;-moz-border-radius: 8px 0px 8px 8px;-ms-border-radius: 8px 0px 8px 8px;text-align:center;}
    .inner p														{color: #000;font-weight: 500;}
    .nos 														{color: #31c7b9; margin-left: 10px;text-align:left;float:right;}
	.pan_box{height:100px !important;}
	.lbl_ptb {padding-top: 5px!important;padding-bottom:5px !important;}
    .date_icon{top:10px!important;right:22px !important;}
	.bar1, .bar2, .bar3 {width: 18px;height: 3px;background-color: #009688;margin: 3px 0;transition: 0.4s;}
    .change .bar1 {-webkit-transform: rotate(-45deg) translate(-6px, 5px);transform: rotate(-45deg) translate(-6px,5px);}
    .change .bar2 {opacity: 0;}
    .change .bar3 {-webkit-transform: rotate(45deg) translate(-3px, -3px);transform: rotate(45deg) translate(-3px, -3px);}
    .flip0{float:right;margin-top:5px;cursor:pointer;}
</style>

<!--content-->
<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/ats/index/sampleent">
                <input type="hidden" id="CostCentre" name="CostCentre" value="<?php echo (isset($CostCentre)) ? $CostCentre : '';?>">
                <input type="hidden" id="RequestType" name="RequestType" value="<?php echo (isset($RequestType)) ? $RequestType : '';?>">
                <input type="hidden" name="ReqNo" value="<?php echo (isset($ReqNo)) ? $ReqNo : '';?>">
                <input type="hidden" name="ReqDate" value="<?php echo (isset($ReqDate)) ? $ReqDate : '';?>">
                <input type="hidden" name="RequestId" id="RequestId" value="<?php echo (isset($requestId)) ? $requestId : 0;?>">
                <input type="hidden" name="Priority" value="<?php echo (isset($priority)) ? $priority : 0;?>">
                <input type="hidden" id="requestTransIds" name="requestTransIds" value="<?php echo (isset($requestTransIds)) ? $requestTransIds : '';?>">
                <input type="hidden" id="gridtype" name="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : 0;?>">
                <input type="hidden" id="approve"  name="approve" value="<?php echo (isset($approve)) ? $approve : '';?>">
                <input type="hidden" id="reqAdd"  name="reqAdd" value="<?php echo $reqAdd;?>">
                <input type="hidden" id="variantQty"  name="variantQty" value="<?php echo (isset($variantQty)) ? $variantQty : 0;?>">

                <div class="col-lg-12">
                    <h1 class="col-lg-3">Request Entry
						<div class="flip0">
							<div class="click" onclick="myFunction(this)">
								<div class="bar1"></div>
								<div class="bar2"></div>
								<div class="bar3"></div>
							</div>
						</div>
					</h1>
                </div>
                <div class="col-lg-12">
					<div class="pane0">
						<div class="col-lg-6">
							<div class="pan_box">
								<ul>
									<li id="CostCentreName" class="lbl_ptb">
										<label>Cost Centre</label>
										<span class="mgic"><?php echo (isset($CostCentreName)) ? $CostCentreName : '';?></span>
									</li>
									<li class="lbl_ptb">
										<label>Request Type</label>
										<span class="mgic"><?php echo (isset($RequestType)) ? ucfirst($RequestType) : '';?></span>
									</li>
									<li class="lbl_ptb">
										<label>Request Date</label>
										<span><input type="text" placeholder="DD-MM-YYYY" class="date_picker datepickerinput" name="ReqDate" value="<?php echo (isset($ReqDate)) ? date('d-m-Y',strtotime($ReqDate)) : date('d-m-Y');?>" readonly/></span>
									</li>
								</ul>
							</div>
						</div>
						<!--<div class="col-lg-4">
							<div class="panel-box box2th">
								<ul>
								</ul>
							</div>
						</div>-->
						<div class="col-lg-6">
							<div class="pan_box">
								<ul>
									<li class="lbl_ptb">
										<label>Request No.</label>
										<span><input type="text" placeholder="xxxxx" name="RequestNo" value="<?php echo (isset($ReqNo)) ? $ReqNo : '';?>" readonly/></span>
									</li>
									<li class="lbl_ptb">
										<label>CCRequest No.</label>
										<?php if((((isset($requestId)) ? $requestId : 0) > 0 )){?>
											<span><input type="text" placeholder="xxxxx" id="CCReqNo" name="CCReqNo" value="<?php echo (isset($CCRNo)) ? $CCRNo : '';?>"/></span>
										<?php }else{ ?>
											<span><input type="text" placeholder="xxxxx" id="CCReqNo" name="CCReqNo" value="<?php echo (isset($CCRNo)) ? $CCRNo : '';?>" readonly /></span>
										<?php } ?>
									</li>
									<li class="lbl_ptb">
										<label>CRequest No.</label>
										<?php if((((isset($requestId)) ? $requestId : 0) > 0 )){?>
											<span><input type="text" placeholder="xxxxx" name="CReqNo" value="<?php echo (isset($RNo)) ? $RNo : '';?>"/></span>
										<?php }else{ ?>
											<span><input type="text" placeholder="xxxxx" id="CReqNo" name="CReqNo" value="<?php echo (isset($RNo)) ? $RNo : '';?>" readonly /></span>
										<?php } ?>
									</li>
								</ul>
							</div>
						</div>
					</div>
                </div>
                <div class="clearfix"></div>
                <div class="col-lg-12 clear top-20">
                    <?php
                    if($RequestType == "TurnKey") {
                        $disTKey="display:none";
                    }
                    else{
                        $disTKey="display:show";
                    }
                    ?>
                    <div id="accordion" class="panel-group">
                        <!-------------------------------Bill of Quantities------------------------------->
                        <div class="panel panel-info">
                            <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                                <h4 id="sHead" class="panel-title accordion-toggle defa_panels">Enter Request Quantity</h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                                <div class="panel-body bgcolr">
                                    <div class="col-lg-12">
                                        <div class="table-responsive">
                                            <table class="table table-bordered tableView dataTable no-footer table-striped" style=" margin-bottom:0px;" id="workorderTable"   >
                                                <thead>
                                                <tr>
                                                    <th id="thCode" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;" >Code</th>
                                                    <th id="thDesc" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;" >Description</th>
                                                    <th id="thUnit"  aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px; <?php echo $disTKey; ?>" >Unit</th>
                                                    <th id="thRDate"  aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;<?php echo $disTKey; ?>" >Required Date</th>
                                                    <th id="thRemarks"  aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px; <?php echo $disTKey; ?>" >Remarks</th>
                                                    <th id="thQty" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;" >Qty</th>
                                                    <th>&nbsp;</th>
                                                    <th style="<?php echo $disTKey; ?>" >&nbsp;</th>
                                                </tr>
                                                </thead>
                                                <tbody class="main"></tbody>
                                            </table>
                                            <input type="hidden" name="rowid" id="rowid" value="0"/>
                                        </div>

                                        <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                                            <ul>
                                                <li><a href="javascript:nextAccordian(2)" data-toggle="tooltip" class="ripple" title="Continue to Next">Continue &nbsp; <i class="fa fa-chevron-circle-right"></i></a></li>
<!--                                                <a onClick="submitForm()"  data-toggle="tooltip" id="sub1" class="ripple" title="Submit">-->
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-------------------------------Bill of Quantities end------------------------------->
                        <!-------------------------------Terms and Condition------------------------------->
                        <div class="panel panel-info">
                            <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
                                <h4 class="panel-title accordion-toggle defa_panels">Narration</h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
                                <div class="panel-body bgcolr">
                                    <div class="clearfix"></div>
                                    <div class="col-lg-12">
                                        <div class="card">
<!--                                            <ul class="nav nav-tabs">-->
<!--                                                <li><a href="#Note" aria-controls="settings" role="tab" data-toggle="tab">Narration</a></li>-->
<!--                                            </ul>-->
                                            <div class="tab-pane" id="Note">
<!--                                                <p>-->
<!--                                                <div class="col-lg-12">-->
<!--                                                    <textarea class="exp-tex" name="Narration" id="Narration" placeholder="Text here"> --><?php //echo (isset($Narration)) ? $Narration : '';?><!-- </textarea>-->
<!--                                                </div>-->
<!--                                                </p>-->

                                                <p>
                                                <div class="col-lg-12">
                                                    <?php
                                                    if(isset($Narration)){
                                                        ?>
                                                        <textarea class="exp-tex" name="Narration" id="Narration"><?php echo (isset($Narration)) ? $Narration : 'Enter your Notes.......';?></textarea>
                                                    <?php }else{ ?>
                                                        <textarea class="exp-tex" name="Narration" id="Narration" placeholder="Enter your Notes..."></textarea>
                                                    <?php } ?>
                                                </div>
                                                </p>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-------------------------------Terms and Condition------------------------------->
                </div>
                    <div class="clearfix"></div>
                </form>
        </div>
    </div>
</div>

<div class="col-lg-12 savebtn_area">
    <ul>
<!--        <li class="dropdown save_btn float_r"><a onclick="submitForm()" data-toggle="model" id="sub1" title="submit"> Submit</a> </li>-->
        <li class="dropdown save_btn float_r"><a onClick="submitForm()" href="javascript:void(0);" data-toggle="tooltip" id="sub1" class="ripple" title="Submit">Submit</a> </li>
<!--        <li class="dropdown save_btn float_r"><a onClick="submitForm()" data-toggle="tooltip" class="ripple" title="Submit" style="cursor:pointer;">Submit</a></li>-->
        <li class="dropdown save_btn float_r">
            <?php if(isset($approve) && $approve=="N"): ?>
                <a href="<?php echo $this->basePath();?>/ats/index/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Close</a>
            <?php elseif (isset($approve) && $approve=='P'): ?>
                <a href="<?php echo $this->basePath();?>/ats/index/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Back</a>
			<?php else: ?>
				<a href="<?php echo $this->basePath();?>/ats/index/sample" data-toggle="tooltip" class="ripple" title="Close!">Close</a>
            <?php endif; ?>
        </li>
    </ul>
</div>
<div class="modal fade" id="stockReqModal"  role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable">
                            <thead>
                            </thead>
                            <tbody>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                </td>
                            </tr>

                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Available Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="availableQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Excess Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="excessQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>

                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Requested Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="requestQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal Requested Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balanceRequest" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">PO Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="poQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal PO Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balancePO" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Total Purchase</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="totalPurchase" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Issue Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="issueQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Transfer Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="transferQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Return Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billreturnQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>




                            <!--                            <tr>-->
<!--                                <td width="50%">-->
<!--                                    <label class="pop_label">Min Quantity</label>-->
<!--                                </td>-->
<!--                                <td width="50%">-->
<!--                                    <input type="text" id="minQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                            <tr>-->
<!--                                <td width="50%">-->
<!--                                    <label class="pop_label">Bill Quantity</label>-->
<!--                                </td>-->
<!--                                <td width="50%">-->
<!--                                    <input type="text" id="billQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />-->
<!--                                </td>-->
<!--                            </tr>-->

                            </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="stockWBSModal" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock [Wbs]  Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable">
                            <tbody>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateWbsQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Available Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="availableWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Excess Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="excessWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>

                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Requested Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="requestWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal Requested Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balanceWbsRequest" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">PO Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="poWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal PO Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balanceWbsPO" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Total Purchase</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="totalWbsPurchase" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Return Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billreturnWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>


<!--                            <tr>-->
<!--                                <td width="50%">-->
<!--                                    <label class="pop_label">Min Quantity</label>-->
<!--                                </td>-->
<!--                                <td width="50%">-->
<!--                                    <input type="text" id="minWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                            <tr>-->
<!--                                <td width="50%">-->
<!--                                    <label class="pop_label">Bill Quantity</label>-->
<!--                                </td>-->
<!--                                <td width="50%">-->
<!--                                    <input type="text" id="billWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />-->
<!--                                </td>-->
<!--                            </tr>-->
                            </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<script id="resource-template"  type="text/template" class="hide">
    <?php
    if($RequestType=="Material" || $RequestType=="Asset"){
    $displayscreen="display:show";
    $displaymaintr="";
    if($gridtype==1)
    {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }
    ?>
    <tr id="click__" onclick="clickTr(this);" class="count-tr" >
        <td class="mar_20" width="15%"><input class="parent_text border-none" type="text" name="code__" id="code__" readonly/></td>
        <td width="25%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);"/>
            <input type="hidden" name="resourceid__" id="resourceid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="10%">
            <input  class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td  width="15%">
            <div class='col-lg-12 padlr0'>
                <input type="text" name="reqdate__" id="reqdate__" class='tbl_input date_picker datepickerinput' value="" onChange="validateDate(this)" readonly/>
                <span class="date_icon"><i class='fa fa-calendar'></i></span>
            </div>
        </td>
        <td  width="15%"><input class="tbl_input changeVal" type="text" name="remarks__" id="remarks__" maxlength="100"  /></td>
        <td width="15%">
            <input class="tbl_input changeVal <?php echo $displaymaintr; ?>" type="text" name="qty__" id="qty__" style="text-align:right;" maxlength="15" onkeypress="return isqtyDecimal(event,this)" onblur="return FormatNum(this, 3)" onchange="checkWbs(this)" readonly/>
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" />
            <input type="hidden" name="rfrom__" id="rfrom__" />

        </td>
        <td width="1%">
            <ul class="action_btns">
                <li><a href="#" class="mainTr" id="expandTr__" style="display:none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="" ></i></a> </li>
                <li><a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="right" data-original-title="Delete"></i> </a> </li>
                <li><a onclick="return stockReqDetails(this);"  id="expandSt__" style="display:none;" data-toggle="modal"  data-original-title="Stock Details" data-target="#stockReqModal"><i class="fa fa-bookmark" data-placement="left" data-toggle="tooltip" title="StockDetail"></i></a></li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li id="iow__" class="active"><a class="ripple has-ripple" id="wbsTabLink__" onclick="mShowtabs('wbs',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Wbs<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li id= "spec__"  class=""><a class="ripple has-ripple" id="reqspeTabLink__" onclick="mShowtabs('reqspe',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Resource Specification<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="iowTable__">

                        </table>
                        <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                        <div class="tab-content">
                            <div class="table-responsive topsp">
                                <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">

                                    <tbody class="main"></tbody>
                                    <tbody class="total">
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                <input  type="text" name="estqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="estqty__" readonly/>-->
                <!--                <input  type="text" name="avaqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="avaqty__" readonly/>-->
                <!--                <input  type="text" name="excessqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="excessqty__" readonly/>-->
            </div>
			<div class="col-lg-12 col-md-12 col-xs-12 mar_10">
				<span class="est1 mr_lt" id="estqty__" ></span>
				<span class="est2 mr_lt" id="avaqty__" ></span>
				<span class="est3 mr_lt" id="excessqty__" ></span>
				<span class="" id="balreqqty__" hidden="true" ></span>
				<span class="" id="balindqty__" hidden="true" ></span>
				<span class="" id="balpoqty__" hidden="true" ></span>
				<span class="" id="totpurchase__" hidden="true" ></span>
				<span class="" id="isproj__" hidden="true" ></span>
			</div>
        </td>
    </tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="30%">
            <input type="hidden"  name="iow___wbsid_0" id="iow___wbsid_0" readonly/>
            <input class="parent_text border-none" type="text" name="iow___wbsname_0" id="iow___wbsname_0" readonly/>
        </td>
        <td width="25%">
            <input class="parent_text" type="text" style="text-align:right;" name="iow___qty_0" id="iow___qty_0" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3)"  maxlength="15" onchange="calcQuantity(this);" data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' onclick="checkEstWbs(this);"/>
            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0" />

                <span class="nos" id="iow___estwbsqty_0" hidden="true"></span>
                <span class="nos" id="iow___avawbsqty_0" hidden="true" ></span>
                <span class="nos" id="iow___excesswbsqty_0" hidden="true"></span>
                <span class="nos" id="iow___balreqwbsqty_0" hidden="true"></span>
                <span class="nos" id="iow___balpowbsqty_0" hidden="true"></span>
                <span class="nos" id="iow___totpurchasewbsqty_0" hidden="true"></span>
                <span class="nos" id="iow___isprojwbsqty_0" hidden="true"></span>
          </td>
        <td width="2%" align="center" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
<!--                <li><a onclick="stockWBSDetails(this);" class="mainTr" id="iow___expandWbs_0" style="cursor:pointer;"><i class="fa fa-star" data-toggle="modal" data-target="#stockWBSModal" data-placement="left"></i></a></li>-->
                <li><a onclick="stockWBSDetails(this);" id="iow___expandWbs_0" class="mainTr" style="cursor:pointer;" data-toggle="modal"  data-original-title="WBS->Stock Details" data-target="#stockWBSModal"><i class="fa fa-star" data-placement="left" data-toggle="tooltip" title="WBS->Stock Details"></i></a></li>

            </ul>
        </td>
    </tr>
</script>
<script id="resspec-template" type="text/template">
    <tr>
        <td width="100%">
            <textarea class="exp-tex parent_txts newRow"  name="resspec__" id="resspec__"></textarea>
        </td>
    </tr>
    <?php } else {
    $displayscreen="display:show";
    $displaymaintr="parent_text";
    if($gridtype==1) {
        $displayscreen="display:none";
        $displaymaintr="parent_text mainTr";

    }
    if($RequestType == "TurnKey") {
        $disTKey="display:none;";
    }
    else{
        $disTKey="display:show;";
    }
    ?>
    <tr id="click__" onclick="clickTr(this);" class="count-tr" >
        <td class="mar_20" width="15%"><input class="parent_text border-none" type="text" name="code__" id="code__" readonly/></td>
        <td width="25%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkAResourceUsed(this);"/>
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td style="<?php echo $disTKey; ?>" width="10%">
            <input class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td style="<?php echo $disTKey; ?>" width="15%">
            <div class='col-lg-12 padlr0'>
                <input type="text" name="reqdate__" id="reqdate__" class='tbl_input date_picker datepickerinput' value="<?php echo Date('d-m-Y'); ?>" onChange="validateDate(this)" readonly />
                <span class="date_icon"><i class='fa fa-calendar'></i></span>
            </div>
        </td>
        <td style="<?php echo $disTKey; ?>" width="15%"><input class="tbl_input changeVal" type="text" name="remarks__" id="remarks__" maxlength="8000" /></td>
        <td width="15%">
            <input class="tbl_input changeVal <?php echo $displaymaintr; ?>" type="text" name="qty__" id="qty__" style="text-align:right;" maxlength="50" onkeypress="return isqtyDecimal(event,this)" onblur="return FormatNum(this, 3)" onchange="checkActQty(this)" readonly/>
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" />
            <input type="hidden" name="hqty__" id="hqty__" />
            <input type="hidden" name="rate__" id="rate__" />
            <input type="hidden" name="rateType__" id="rateType__" />
            <input type="hidden" name="rfrom__" id="rfrom__" />
        </td>
        <td width="1%">
            <ul class="action_btns">
                <li><a href="#" class="mainTr" id="expandTr__" style="display:none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="" ></i></a> </li>
                <li><a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="right" data-original-title="Delete"></i> </a> </li>
                <li><a onclick="return stockReqDetails(this);"  id="expandSt__" style="display:none;" data-toggle="modal"  data-original-title="Stock Details" data-target="#stockReqModal"><i class="fa fa-bookmark" data-placement="left" data-toggle="tooltip" title="StockDetail"></i></a></li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li id="wbsiow__" class="active"><a class="ripple has-ripple" id="wbsTabLink__" onclick="showtabs('wbs',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Wbs<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li id="wbsspec__" class=""><a class="ripple has-ripple" id="reqspeTabLink__" onclick="showtabs('reqspe',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Resource Specification<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="iowTable__">


                        </table>
                        <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                        <div class="tab-content">
                            <div class="table-responsive topsp">
                                <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">

                                    <tbody class="main"></tbody>
                                    <tbody class="total">
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                <input  type="text" name="estqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="estqty__" readonly/>-->
                <!--                <input  type="text" name="avaqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="avaqty__" readonly/>-->
                <!--                <input  type="text" name="excessqty__" style="text-align:left; color: #18439d;font-weight: bold;display: block;width: 200px;float: left;" id="excessqty__" readonly/>-->
            </div>
			<div class="col-lg-12 col-md-12 col-xs-12 mar_10">
				<span class="est1 mr_lt" id="estqty__" ></span>
				<span class="est2 mr_lt" id="avaqty__" ></span>
				<span class="est3 mr_lt" id="excessqty__" ></span>
				<span class="" id="isproj__" hidden="true" ></span>
			</div>
			<div class="col-lg-12 col-md-12 col-xs-12 mar_10">
				<span class="est1 mr_lt" id="reqqty__"  ></span>
				<span class="est2 mr_lt" id="balreqqty__" ></span>
				<span class="est3 mr_lt" id="woqty__" ></span>
			</div>
        </td>
    </tr>
</script>
<script id="act-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%">
            <input class="parent_text border-none" type="text" name="iow___code_0" id="iow___code_0" readonly/>
        </td>
        <td width="20%">
            <input class="parent_text border-none" type="text" name="iow___specification_0" id="iow___specification_0" readonly/>
        </td>
        <td width="20%">
            <input type="hidden"  name="iow___wbsid_0" id="iow___wbsid_0" readonly/>
            <input type="hidden"  name="iow___iowid_0" id="iow___iowid_0" readonly/>
            <input type="hidden"  name="iow___resid_0" id="iow___resid_0" readonly/>
            <input class="parent_text border-none" type="text" name="iow___wbsname_0" id="iow___wbsname_0" readonly/>
        </td>

        <td width="20%">
            <input class="parent_text" type="text" style="text-align:right;" name="iow___qty_0" id="iow___qty_0" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3)"  maxlength="50" onchange="calcActQuantity(this);" data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' onclick="checkActEstWbs(this);" autofocus/>
            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0" />
            <input type="hidden" name="iow___hqty_0" id="iow___hqty_0" />

            <span class="nos" id="iow___estwbsqty_0" hidden="true"></span>
            <span class="nos" id="iow___avawbsqty_0" hidden="true"></span>
            <span class="nos" id="iow___excesswbsqty_0" hidden="true"></span>
            <span class="nos" id="iow___balreqwbsqty_0" hidden="true">0</span>
            <span class="nos" id="iow___reqwbsqty_0" hidden="true">0</span>
            <span class="nos" id="iow___wowbsqty_0" hidden="true">0</span>
        </td>

        <td width="2%" align="center" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
                <!--                <li><a onclick="stockWBSDetails(this);" class="mainTr" id="iow___expandWbs_0" style="cursor:pointer;"><i class="fa fa-star" data-toggle="modal" data-target="#stockWBSModal" data-placement="left"></i></a></li>-->
                <li><a onclick="stockWBSDetails(this);" id="iow___expandWbs_0" class="mainTr" style="cursor:pointer;" data-toggle="modal"  data-original-title="WBS->Stock Details" data-target="#stockWBSModal"><i class="fa fa-star" data-placement="left" data-toggle="tooltip" title="WBS->Stock Details"></i></a></li>
            </ul>
        </td>
    </tr>
</script>
<script id="resspec-template" type="text/template">
    <tr>
        <td width="100%">
            <textarea class="exp-tex parent_txts newRow"  name="resspec__" id="resspec__"></textarea>
        </td>
    </tr>
    <?php  } ?>
</script>

<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/paging.css';?>"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/paging.js"></script>

<script type="text/javascript">

    var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
    var tmp_arr_resources = arr_resources;
    var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
    var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
    var arr_estdetails = <?php echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;
    var arr_resource_wbs = <?php echo (isset($arr_resource_wbs)) ? json_encode($arr_resource_wbs) : '[]';?>;
    var arr_wbsestimate = <?php echo (isset($arr_wbsestimate)) ? json_encode($arr_wbsestimate) : '[]';?>;
    var arr_actEst = <?php echo (isset($arr_actEst)) ? json_encode($arr_actEst) : '[]';?>;
    var arr_ResourceEst = <?php echo (isset($result_ResourceEst)) ? json_encode($result_ResourceEst) : '[]';?>;
    var arr_act1 = <?php echo (isset($arr_act1)) ? json_encode($arr_act1) : '[]';?>;
    var result1_ResourceEst = <?php echo (isset($result1_ResourceEst)) ? json_encode($result1_ResourceEst) : '[]';?>;
    var arr_iowestimate = <?php echo (isset($arr_iowestimate)) ? json_encode($arr_iowestimate) : '[]';?>;
    var arr_iowwbsestimate = <?php echo (isset($arr_iowwbsestimate)) ? json_encode($arr_iowwbsestimate) : '[]';?>;
    var rType = $('#RequestType').val();
    var approve = $('#approve').val();
    var reqAdd = $('#reqAdd').val();
    var requestId = $('#RequestId').val();


    if(rType == 'Service'){
        $('#sHead').text('Enter Request Amount');
    }
    else if(rType == 'TurnKey') {
        $('#sHead').text('Enter Percentage');
    }
    else {
        $('#sHead').text('Enter Request Quantity');
    }

    if(rType == 'Activity'){
        $(function () {
            var $rowid = $('#rowid');
            var template = $('#resource-template').html();
            var actTemplate = $('#act-template').html();
            var resspectemplate=$('#resspec-template').html();
            var rowid = 0;
            var $tbody = $('#workorderTable').find('> tbody.main');
            if(arr_requestResources.length != 0) {
                $.each(arr_requestResources, function (i, o) {
                    rowid += 1;
                    $tbody.append(template.replace(/__/g, '_' + rowid));
                    $('#code_' + rowid).val(o.Code).addClass('border-none').prop('disabled', false);
                    $('#desc_' + rowid).val(o.ResourceName).addClass('border-none').prop('readonly', true);
                    $('#resourceid_' + rowid).val(o.ResourceId);
                    $('#unitname_' + rowid).val(o.UnitName);
                    $('#unitid_' + rowid).val(o.UnitId);
                    $('#rate_' + rowid).val(o.Rate);
                    $('#qty_' + rowid).val(sanitizeNumber(o.CurrentQty,3,true));
                    $('#hqty_' + rowid).val(o.HQty);
                    $('#hiddenqty_' + rowid).val(o.HiddenQty);
                    $('#rateType_' + rowid).val(o.RateType);
                    $('#reqdate_' + rowid).val(o.ReqDate);
                    if(reqAdd == 1 && requestId > 0){
                        $('#reqdate_' + rowid).val(o.ReqDate);
                    } else if(reqAdd == 1) {
                        $('#reqdate_' + rowid).val('');
                    } else {
                        var rDate = new Date();
                        var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                        $('#reqdate_' + rowid).val(endDate);
                    }
                    $('#remarks_' + rowid).val(o.Remarks);
                    $('#rfrom_' + rowid).val(o.RFrom);
                    $('#expandTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#estqty_' + rowid).show();
                    $('#avaqty_' + rowid).show();
                    $('#excessqty_' + rowid).show();
                    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                    $('#resspec_' + rowid).val(o.Specification);
                    if (approve == "Y") {
                        $('#deleteTr_' + rowid).hide();
                    } else {
                        $('#deleteTr_' + rowid).show();
                    }
                    var availableQty =0;
                   $.each(arr_ResourceEst, function (a, rkey) {
                       if (o.ResourceId == rkey) {
                           availableQty = parseFloatVal(arr_actEst[rkey]['EstimateQty']) - (parseFloatVal(arr_actEst[rkey]['WOQty'])+parseFloatVal(arr_actEst[rkey]['BalReqQty']));

                           if (arr_actEst[rkey]['EstimateQty'] > 0 || arr_actEst[rkey]['EstimateQty'] < 0) {
                               $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(arr_actEst[rkey]['EstimateQty'], 3, true));
                           } else {
                               $('#estqty_' + rowid).text('Estimate Qty:  0');
                           }

                           if (availableQty > 0 || availableQty < 0) {
                               $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(availableQty, 3, true));
                           } else {
                               $('#avaqty_' + rowid).text('Available Qty:  ');
                           }

                           if (availableQty < 0) {
                               $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(availableQty, 3, true));
                           } else {
                               $('#excessqty_' + rowid).text('Excess Qty:  ');
                           }

                           if (arr_actEst[rkey]['ReqQty'] > 0 || arr_actEst[rkey]['ReqQty'] < 0) {
                                $('#reqqty_' + rowid).text('Request Qty: ' + sanitizeNumber(arr_actEst[rkey]['ReqQty'],3,true));
                           } else {
                                $('#reqqty_' + rowid).text('Request Qty: ');
                           }

                           if (arr_actEst[rkey]['BalReqQty'] > 0 || arr_actEst[rkey]['BalReqQty'] < 0) {
                                $('#balreqqty_' + rowid).text('Bal Request Qty: ' + sanitizeNumber(arr_actEst[rkey]['BalReqQty'],3,true));
                           } else {
                                $('#balreqqty_' + rowid).text(0);
                           }

                           if (arr_actEst[rkey]['WOQty'] > 0 || arr_actEst[rkey]['WOQty'] < 0) {
                               $('#woqty_' + rowid).text('WOQty: ' + sanitizeNumber(arr_actEst[rkey]['WOQty'], 3, true));

                           } else {
                               $('#woqty_' + rowid).text('WOQty:  0');
                           }
                       }
                   });
                    if (arr_resource_iows.length != 0) {
                        $('#iowTable_' + rowid).html('<thead> <tr> <th width="10%">Code</th> <th width="25%">Specification</th> <th width="25%">Wbs Name</th>  <th width="20%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
                        $.each(arr_resource_iows, function (k, l) {
                            if (l.ResourceId == o.ResourceId) {
                                var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;

                                $('#iowTable_' + rowid).find('tbody.main').append(actTemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                $('#iow_' + rowid + '_rowid').val(iowrowid);
                                $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                $('#iow_' + rowid + '_iowid_' + iowrowid).val(l.IowId);
                                $('#iow_' + rowid + '_resid_' + iowrowid).val(l.ResourceId);

                                $('#iow_' + rowid + '_code_' + iowrowid).val(l.Code);
                                $('#iow_' + rowid + '_specification_' + iowrowid).val(l.Specification);
                                $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WBSName);
                                $('#iow_' + rowid + '_qty_' + iowrowid).attr('autofocus', true);
                                $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.CurrentQty,3,true));
                                $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                                $('#iow_' + rowid + '_hqty_' + iowrowid).val(l.Qty);
                                var AvailableQty1 = 0;
                                $.each(arr_act1, function (s, w) {
                                    if (l.ResourceId == w.ResourceId&& l.WBSId == w.WbsId && l.IowId == w.IowId ) {

                                        AvailableQty1 = parseFloatVal(w.EstimateQty) - (parseFloatVal(w.WOQty)+parseFloatVal(w.BalReqQty));
                                            $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(w.EstimateQty);
                                            $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(AvailableQty1);
                                            if(AvailableQty1 < 0){
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(AvailableQty1);
                                            } else {
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(000);
                                            }
                                            $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(w.BalReqQty);
                                            $('#iow_' + rowid + '_reqwbsqty_' + iowrowid).html(w.RequestQty);
                                        $('#iow_' + rowid + '_wowbsqty_' + iowrowid).html(w.WOQty);
                                    }
                                });
                                $('#iow_' + rowid + '_expandWbs_' + iowrowid).show();
                            }else{
								$('#wbsiow_'+rowid).hide();
								$('#wbsspec_'+rowid).addClass('active');
								$('#iowTable_'+rowid).hide();
								$('#reqspeTable_'+rowid).show();
							}
                        });
                    }else{
						$('#wbsiow_'+rowid).hide();
						$('#wbsspec_'+rowid).addClass('active');
						$('#iowTable_'+rowid).hide();
						$('#reqspeTable_'+rowid).show();
					}
                });
            }
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $rowid.val(rowid);
            bindResourceAutocomplete();
            $('.content_wrapper').on('click','.mainTr',function(e){
                e.preventDefault();
                if(!$(this).closest("tr").next(".subTr").is(":visible")){
                    $(this).closest("tr").next(".subTr").show();
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                    $(this).find("i").addClass("tform");
                }
                else{
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                    $(this).closest("tr").next(".subTr").slideUp("slow");
                    $(this).find("i").removeClass("tform");
                }
            });
            nextAccordian(1);
            $('[data-toggle="tooltip"]').tooltip();
            if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
                //paging
                $('#workorderTable').paging({limit: 2});
                $('.paging-nav').children('a[data-page=0]').trigger('click');
            }
        });

        function bindResourceAutocomplete() {

            // bind resource autocomplete
            $('#workorderTable .resourceSuggest').autocomplete({
                lookup: tmp_arr_resources,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {

                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        var $this = $(this);
                        var rowid = $this[0].id.split('_')[1];
                            $this.prop('readonly', true).addClass('border-none');
                            $('#resourceid_' + rowid).val(suggestion.Data);
                            $('#unitname_' + rowid).val(suggestion.UnitName);
                            $('#code_' + rowid).val(suggestion.Code);
                            if(reqAdd == 1) {
                                $('#reqdate_' + rowid).val();
                            } else {
                                var rDate = new Date();
                                var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                                $('#reqdate_' + rowid).val(endDate);
                            }
                            $('#unitid_' + rowid).val(suggestion.UnitId);
                            $('#rate_' + rowid).val(suggestion.Rate);
                            $('#rateType_' + rowid).val(suggestion.RateType);
                            $('#qty_' + rowid).val(suggestion.CurrentQty);
                            $('#hiddenqty_' + rowid).val(suggestion.HiddenQty);
                            $('#hqty_' + rowid).val(suggestion.HQty);
                            $('#expandTr_' + rowid).show();
                            $('#expandSt_' + rowid).show();
                            bindAResourceIOW($this);
                            addNewAResourceRow($this,suggestion.data);

                    }
                }, onSearchStart: function (suggestion) {
                    var rowid = $(this)[0].id.split('_')[1];

                    $('#unitname_' + rowid).val('');
                    $('#rate_' + rowid).val('');
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length) {
                        var rowid = $(this)[0].id.split('_')[1];

                        $('#unitname_' + rowid).val('');
                        $('#rate_' + rowid).val('');
                    }
                }
            });
        }
        function bindAResourceIOW(x) {
            var rowid = $(x)[0].id.split('_')[1];
            var $iowrowid = $('#iow_' + rowid + '_rowid');
            var resourceId = $('#resourceid_' + rowid).val();
            var costcentre=$('#CostCentre').val();
            $('.loading_area').show();
            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: {'Type': 'getAct-wbsdetails', 'ResourceId': resourceId, 'CostCentreId': costcentre},
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        data = JSON.parse(data);
                        var actTemplate = $('#act-template').html();
                        var wbscount =0;
                        if (data.wbs.length > 0) {
                            $('#iowTable_' + rowid).html('<thead> <tr> <th width="10%">Code</th>  <th width="25%">Specification</th>  <th width="25%">Wbs Name</th>  <th width="20%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
                            $.each(data.wbs, function (i,l) {

                                if (l.ResourceId == resourceId) {
                                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                                    $('#iowTable_' + rowid).find('tbody.main').append(actTemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                    wbscount++;

                                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                                    $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                    $('#iow_' + rowid + '_iowid_' + iowrowid).val(l.IowId);
                                    $('#iow_' + rowid + '_resid_' + iowrowid).val(l.ResourceId);
                                    $('#iow_' + rowid + '_code_' + iowrowid).val(l.Code);
                                    $('#iow_' + rowid + '_specification_' + iowrowid).val(l.Specification);
                                    $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WBSName);
                                    $('#iow_' + rowid + '_qty_' + iowrowid).focus();
                                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.CurrentQty);
                                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                                    $('#iow_' + rowid + '_hqty_' + iowrowid).val(l.Qty);


                                   //WBS Estimate
                                    var AvailableQty1 = 0;
                                    $.each(data.aWBS, function (s,w) {

                                        if (l.ResourceId == w.ResourceId && l.WBSId == w.WbsId && l.IowId == w.IowId ) {
                                            $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(w.EstimateQty);
                                            $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(w.AvailableQty);
                                            if(w.AvailableQty < 0){
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(w.AvailableQty);
                                            } else{
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(000);
                                            }
                                            $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(w.BalReqQty);
                                            $('#iow_' + rowid + '_reqwbsqty_' + iowrowid).html(w.RequestQty);
                                            $('#iow_' + rowid + '_wowbsqty_' + iowrowid).html(w.WOQty);
                                        }
                                    });
                                    // end of est-wbs
                                }
                            });
                        }else{
							$('#wbsiow_'+rowid).hide();
							$('#wbsspec_'+rowid).addClass('active');
							$('#iowTable_'+rowid).hide();
							$('#reqspeTable_'+rowid).show();
						}
                        if(wbscount == 0){
                            $('#qty_' + rowid).attr('readonly',false);
                            $('#qty_' + rowid).focus();
                        }
                    }
                    $('.loading_area').hide();
                }, error: function (jqXHR, textStatus, errorThrown) {
                    $('.loading_area').hide();
                }
            });
        }
        function addNewAResourceRow(x,v) {
            var $tr = $(x).closest('tr');
            if ($tr.next('tr:not(.subTr)').length != 0)
                return;

            var $rowid = $('#rowid'),
                rowid = parseInt($rowid.val()),
                $tbody = $('#workorderTable').find('> tbody.main');

            $('#deleteTr_' + rowid).show();
            var count = rowid + 1,
                template = $('#resource-template').html();
            var resspectemplate=$('#resspec-template').html();
            $("#click_"+count).hide();


           // var rTransId=$('#requestTransIds').val();
           // var rTransId=$('#requestTransIds').val();
//            if($('#requestTransIds').val().length > 0)
//            {
//                $('#requestTransIds').val(rTransId+","+v);
//                rTransId= $('#requestTransIds').val();
//            }
//            else
//            {
//                $('#requestTransIds').val(v);
//                rTransId=$('#requestTransIds').val();
//            }
          //  var arr_estdetails = <?php //echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;
            var ccid=<?php echo (isset($CostCentre)) ? $CostCentre : '';?>;
            var rTransId=$('#resourceid_' + rowid).val();
            $.ajax({
                type: "POST",
                url: getBaseURL()+'ats/index/entry-sample',
                data: "ccid="+ccid+"&resid="+ rTransId +"&Type=getAct-estDetails",
                dataType: "json",
                success: function(data){
                   var arr_actEstData = data.Est;
                   var arr_ResourceEst1 = data.arr_ActResId;
                    var availableQty =0;
                    $.each(arr_ResourceEst1, function (a, rkey) {
                        if (rTransId == rkey) {

                            availableQty = parseFloatVal(arr_actEstData[rkey]['EstimateQty']) - (parseFloatVal(arr_actEstData[rkey]['WOQty'])+parseFloatVal(arr_actEstData[rkey]['BalReqQty']));

                            if (arr_actEstData[rkey]['EstimateQty'] > 0 || arr_actEstData[rkey]['EstimateQty'] < 0) {
                                $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(arr_actEstData[rkey]['EstimateQty'], 3, true));
                            } else {
                                $('#estqty_' + rowid).text('Estimate Qty:  ');
                            }

                            if (availableQty > 0 || availableQty < 0) {
                                $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(availableQty, 3, true));
                            } else {
                                $('#avaqty_' + rowid).text('Available Qty:  ');
                            }

                            if (availableQty < 0) {
                                $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(availableQty, 3, true));
                            } else {
                                $('#excessqty_' + rowid).text('Excess Qty:  ');
                            }

                            if (arr_actEstData[rkey]['ReqQty'] > 0 || arr_actEstData[rkey]['ReqQty'] < 0) {
                                $('#reqqty_' + rowid).text('Request Qty: ' + sanitizeNumber(arr_actEstData[rkey]['ReqQty'],3,true));
                            } else {
                                $('#reqqty_' + rowid).text('Request Qty: ');
                            }

                            if (arr_actEstData[rkey]['BalReqQty'] > 0 || arr_actEstData[rkey]['BalReqQty'] < 0) {
                                $('#balreqqty_' + rowid).text('Bal Request Qty: ' +sanitizeNumber(arr_actEstData[rkey]['BalReqQty'],3,true));
                            } else {
                                $('#balreqqty_' + rowid).text('Bal Request Qty: ');
                            }

                            if (arr_actEstData[rkey]['WOQty'] > 0 || arr_actEstData[rkey]['WOQty'] < 0) {
                                $('#woqty_' + rowid).text('WO Qty: ' + sanitizeNumber(aarr_actEstData[rkey]['WOQty'], 3, true));
                            } else {
                                $('#woqty_' + rowid).text('WO Qty: ');
                            }
                        }
                    });
                }
            });
            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            template = template.replace(/__/g, '_' + count);
            $tbody.append(template);
            $rowid.val(count);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            else{
                $("#click_"+count).show();
            }
        }
        function checkAResourceUsed(x) {
            var id = $(x)[0].id.split('_')[1];
            var reskeyid = $('input[id*=resourceid_]');
            tmp_arr_resources = arr_resources;
            tmp_arr_resources = $.grep(arr_resources, function (element, index) {
                var is_selected = true;
                $.each(reskeyid, function (i, obj) {

                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != id) {
                        if (element.data == $this.val()) {
                            is_selected = false;
                            return false;
                        }

                    }
                });
                return is_selected;
            });
            bindResourceAutocomplete();
        }
        function nextAccordian(id) {
            $('#panelheading-' + id).trigger('click');
        }
        function showtabs(type,id,event) {
            event.preventDefault();
            $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
            var rowid = id.split('_')[1];
            if (type=="wbs") {
                $('#iowTable_'+rowid).show();
                $('#reqspeTable_'+rowid).hide();

            } else{
                $('#reqspeTable_'+rowid).show();
                $('#iowTable_'+rowid).hide();
            }
            return false;
        }
        function checkActQty(x){

            var rowid = $(x)[0].id.split('_')[1];
            var abc = $('#iow_' + rowid + '_rowid');
           // var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var eststr = $('#estqty_' + rowid).text();
            var eststr = $('#estqty_' + rowid).text().split(':');
            var estqty = eststr[1];
            var curQty = parseFloat($('#qty_' + rowid).val());
            var hiddenQty = parseFloat($('#hiddenqty_' + rowid).val());
            var avaqty = $('#avaqty_' + rowid).text();

            if(estqty == 'undefined' || estqty == null) { estqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null) { hiddenQty=0; }
            if(avaqty == 'undefined' || avaqty == null) { avaqty=0; }

            if((curQty-hiddenQty) > avaqty) {
                alert("Request quantity is greater than Available Quantity");
                $('#qty_' + rowid).val(0);
                return false;
            }
        }
        function calcActQuantity(x) {
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];

            var iowrowid=ids[3];
            var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var estqty = $('#iow_'+rowid+'_estwbsqty_' + iowrowid).text();
            var avaqty = $('#iow_'+rowid+'_avawbsqty_' + iowrowid).text();
            var curQty = parseFloat($('#iow_'+rowid+'_qty_' + iowrowid).val());
            var hiddenQty = parseFloat($('#iow_'+rowid+'_hiddenqty_' + iowrowid).val());

            if(estqty == 'undefined' || estqty == null || estqty == '' || isNaN(estqty)) { estqty=0; }
            if(avaqty == 'undefined' || avaqty == null || avaqty == '' || isNaN(avaqty)) { avaqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || hiddenQty == '' || isNaN(hiddenQty) == true ) { hiddenQty=0; }

            if((curQty-hiddenQty)  > avaqty){
                alert("Request quantity is greater than Available quantity");
                $('#iow_'+rowid+'_qty_' + iowrowid).val(0);
                return false;
            }
            //
            // calc total qty
            var totalQty=0.0;
            $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
                var qty=0.0;
                if($(this).val() != '' || $(this).val().length != 0 )
                {
                    qty = $(this).val();
                }
                if(isNaN(qty))
                    qty = 0;

                totalQty = parseFloat(totalQty) + parseFloat(qty);
            });

            $('#qty_'+rowid).val(sanitizeNumber(totalQty, 3,true));

            // calc total amount
            var rate = parseFloatVal($('#rate_'+rowid).val());
            $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate));
            calcTotal();
        }
        function calcTotal() {
            var total = 0;
            $.each($('input[id^=amount_]'), function (i,o) {
                total += parseFloatVal($(this).val());
            });
            $('#total').val(sanitizeNumber(total,3,true));
        }
        function checkActEstWbs(x) {
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowid = ids[3];
            var trowid = $('#iow_'+rowid+'_rowid');
            //tooltip show
            var estqty = $('#iow_' + rowid + '_estwbsqty_' + iowid).text();
            var avaqty = $('#iow_' + rowid + '_avawbsqty_' + iowid).text();
            var excessqty = $('#iow_' + rowid + '_excesswbsqty_' + iowid).text();
            var reqqty = $('#iow_' + rowid + '_reqwbsqty_' + iowid).text();
            var balreqqty = $('#iow_' + rowid + '_balreqwbsqty_' + iowid).text();
            var woqty = $('#iow_' + rowid + '_wowbsqty_' + iowid).text();
            //"1st line text" +"\n" + "2nd line text";
            $(x).attr('data-original-title',"Estimate Qty : " + sanitizeNumber(estqty,3,true) + "<br />"  +
             "Available Qty : " + sanitizeNumber(avaqty,3,true) + "<br />" +
             "Excess Qty : " + sanitizeNumber(excessqty,3,true) + "<br />" +
             "Request Qty : " + sanitizeNumber(reqqty,3,true) + "<br />" +
             "Bal Request Qty : " + sanitizeNumber(balreqqty,3,true) + "<br />" +
             "WO Qty : " + sanitizeNumber(woqty,3,true) + "<br />" );
            $(x).tooltip('show');
        }
        function clickTr(val){
            var data = ($(val).attr('id')).split('_');
            var resourceId = $('#resourceid_' + data[1]).val();
            var itemId = $('#itemid_' + data[1]).val();
            var costCentreId = $('#CostCentre').val();
        }
        function deleteRow(x,e) {
            e.preventDefault();
            var rowid = $('#rowid').val();
            var $x = $(x),
                key = $x[0].className.split('_')[1];
            if (!confirm('Do you want to Delete'))
                return false;
            var $tr = $x.closest('tr');
            $tr.next('.subTr').remove();
            $tr.remove();
            //rowid -= 1;
            $('#rowid').val(rowid);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            return false;
        }
        function stockReqDetails(x){

            var rowid = $(x)[0].id.split('_')[1];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var  mode="getstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockReqModal").show();
                        $("#estimateQty").val(sdata['EstimateQty']);
                        $("#availableQty").val(sdata['AvailableQty']);
                        $("#excessQty").val(sdata['ExcessQty']);
                        $("#balanceRequest").val(sdata['BalReqQty']);
                        $("#balancePO").val(sdata['BalPOQty']);
                        $("#totalPurchase").val(sdata['TotPurchase']);
                        $("#requestQty").val(sdata['ReqQty']);
                        $("#poQty").val(sdata['POQty']);
                        $("#minQty").val(sdata['MinQty']);
                        $("#billQty").val(sdata['BillQty']);
                        $("#issueQty").val(sdata['IssueQty']);
                        $("#transferQty").val(sdata['TransferQty']);
                        $("#billreturnQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
        function stockWBSDetails(x){
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowrowid = ids[3];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var WBSId = $('#iow_' + rowid + '_wbsid_' + iowrowid).val();
            var  mode="getwbsstockdetails";
            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockWBSModal").show();
                        $("#estimateWbsQty").val(sdata['EstimateQty']);
                        $("#availableWbsQty").val(sdata['AvailableQty']);
                        $("#excessWbsQty").val(sdata['ExcessQty']);
                        $("#balanceWbsRequest").val(sdata['BalReqQty']);
                        $("#balanceWbsPO").val(sdata['BalPOQty']);
                        $("#totalWbsPurchase").val(sdata['TotPurchase']);
                        $("#requestWbsQty").val(sdata['ReqQty']);
                        $("#poWbsQty").val(sdata['POQty']);
                        $("#minWbsQty").val(sdata['MinQty']);
                        $("#billWbsQty").val(sdata['BillQty']);
                        $("#billreturnWbsQty").val(sdata['ReturnQty']);
                    }
                }
            });
        }
    } // end of activity

    if(rType == 'IOW'){
        $(function () {
            var $rowid = $('#rowid');
            var template = $('#resource-template').html();
            var actTemplate = $('#act-template').html();
            var resspectemplate=$('#resspec-template').html();
            var rowid = 0;
            var $tbody = $('#workorderTable').find('> tbody.main');
            if(arr_requestResources.length != 0) {
                $.each(arr_requestResources, function (i, o) {
                    rowid += 1;
                    $tbody.append(template.replace(/__/g, '_' + rowid));
                    $('#code_' + rowid).val(o.Code).addClass('border-none').prop('disabled', false);
                    $('#desc_' + rowid).val(o.ResourceName).addClass('border-none').prop('readonly', true);
                    $('#resourceid_' + rowid).val(o.ResourceId);
                    $('#unitname_' + rowid).val(o.UnitName);
                    $('#unitid_' + rowid).val(o.UnitId);
                    $('#rate_' + rowid).val(o.Rate);
                    $('#qty_' + rowid).val(sanitizeNumber(o.CurrentQty,3,true));
                    $('#hqty_' + rowid).val(o.HQty);
                    $('#hiddenqty_' + rowid).val(o.HiddenQty);
                    $('#rateType_' + rowid).val(o.RateType);
                    if(reqAdd == 1 && requestId > 0){
                        $('#reqdate_' + rowid).val(o.ReqDate);
                    } else if(reqAdd == 1) {
                        $('#reqdate_' + rowid).val('');
                    } else {
                        var rDate = new Date();
                        var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                        $('#reqdate_' + rowid).val(endDate);
                    }
                    $('#remarks_' + rowid).val(o.Remarks);
                    $('#rfrom_' + rowid).val(o.RFrom);
                    $('#expandTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#estqty_' + rowid).show();
                    $('#avaqty_' + rowid).show();
                    $('#excessqty_' + rowid).show();
                    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                    $('#resspec_' + rowid).val(o.Specification);
                    if (approve == "Y") {
                        $('#deleteTr_' + rowid).hide();
                    } else {
                        $('#deleteTr_' + rowid).show();
                    }
                    var availableQty =0;
                    $.each(arr_iowestimate, function (a, iKey) {
                        if (o.ResourceId == iKey['IowId']) {
                            if (iKey['EstimateQty'] > 0) {
                                $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(iKey['EstimateQty'], 3, true));
                            } else {
                                $('#estqty_' + rowid).text('Estimate Qty:  0');
                            }

                            if (iKey['AvailableQty'] > 0) {
                                $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(iKey['AvailableQty'], 3, true));
                            } else {
                                $('#avaqty_' + rowid).text('Available Qty:  0');
                            }

                            if (iKey['AvailableQty'] < 0) {
                                $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(iKey['AvailableQty'], 3, true));
                            } else {
                                $('#excessqty_' + rowid).text('Excess Qty:  0');
                            }

                            if (iKey['RequestQty'] > 0) {
                                $('#reqqty_' + rowid).text('Request Qty:  ' + sanitizeNumber(iKey['RequestQty'], 3, true));
                            } else {
                                $('#reqqty_' + rowid).text('Request Qty:  0');
                            }

                            if (iKey['BalRequestQty'] > 0) {
                                $('#balreqqty_' + rowid).text('Bal Request Qty:  ' + sanitizeNumber(iKey['BalRequestQty'], 3, true));
                            } else {
                                $('#balreqqty_' + rowid).text('Bal Request Qty:  0');
                            }

                            if (iKey['WOQty'] > 0) {
                                $('#woqty_' + rowid).text('WOQty: ' + sanitizeNumber(iKey['WOQty'], 3, true));

                            } else {
                                $('#woqty_' + rowid).text('WOQty:  0');
                            }
                        }
                    });
                    if (arr_resource_iows.length != 0) {
                        $('#iowTable_' + rowid).html('<thead> <tr> <th>Code</th> <th>Specification</th> <th width="20%">Wbs Name</th>  <th width="20%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
                        $.each(arr_resource_iows, function (k, l) {
                            if (l.ResourceId == o.ResourceId) {
                                var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;

                                $('#iowTable_' + rowid).find('tbody.main').append(actTemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                $('#iow_' + rowid + '_rowid').val(iowrowid);
                                $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                $('#iow_' + rowid + '_iowid_' + iowrowid).val(l.IowId);
                                $('#iow_' + rowid + '_resid_' + iowrowid).val(l.ResourceId);
                                $('#iow_' + rowid + '_code_' + iowrowid).val('');
                                $('#iow_' + rowid + '_specification_' + iowrowid).val('');
                                $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WBSName);
                                $('#iow_' + rowid + '_qty_' + iowrowid).attr('autofocus', true);
                                $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.CurrentQty,3,true));
                                $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                                $('#iow_' + rowid + '_hqty_' + iowrowid).val(l.Qty);
                                var AvailableQty1 = 0;
                                $.each(arr_iowwbsestimate, function (s, w) {
                                    if (l.ResourceId == w.IowId&& l.WBSId == w.WbsId) {
                                        $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(w.EstimateQty);
                                        $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(w.AvailableQty);
                                        if(w.AvailableQty < 0){
                                            $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(w.AvailableQty);
                                        } else {
                                            $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(000);
                                        }
                                        $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(w.BalRequestQty);
                                        $('#iow_' + rowid + '_reqwbsqty_' + iowrowid).html(w.RequestQty);
                                        $('#iow_' + rowid + '_wowbsqty_' + iowrowid).html(w.WOQty);
                                    }
                                });
                                $('#iow_' + rowid + '_expandWbs_' + iowrowid).show();
                            }else{
								$('#wbsiow_'+rowid).hide();
								$('#wbsspec_'+rowid).addClass('active');
								$('#iowTable_'+rowid).hide();
								$('#reqspeTable_'+rowid).show();
							}
                        });
                    }else{
						$('#wbsiow_'+rowid).hide();
						$('#wbsspec_'+rowid).addClass('active');
						$('#iowTable_'+rowid).hide();
						$('#reqspeTable_'+rowid).show();
					}
                });
            }
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $rowid.val(rowid);
            bindResourceAutocomplete();
            $('.content_wrapper').on('click','.mainTr',function(e){
                e.preventDefault();
                if(!$(this).closest("tr").next(".subTr").is(":visible")){
                    $(this).closest("tr").next(".subTr").show();
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                    $(this).find("i").addClass("tform");
                }
                else{
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                    $(this).closest("tr").next(".subTr").slideUp("slow");
                    $(this).find("i").removeClass("tform");
                }
            });
            nextAccordian(1);
            $('[data-toggle="tooltip"]').tooltip();
            if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
                //paging
                $('#workorderTable').paging({limit: 2});
                $('.paging-nav').children('a[data-page=0]').trigger('click');
            }
        });

        function bindResourceAutocomplete() {

            // bind resource autocomplete
            $('#workorderTable .resourceSuggest').autocomplete({
                lookup: tmp_arr_resources,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {

                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        var $this = $(this);
                        var rowid = $this[0].id.split('_')[1];
                        $this.prop('readonly', true).addClass('border-none');

                        $('#resourceid_' + rowid).val(suggestion.Data);
                        $('#unitname_' + rowid).val(suggestion.UnitName);
                        $('#code_' + rowid).val(suggestion.Code);
                        if(reqAdd == 0) {
                            $('#reqdate_' + rowid).val('');
                        } else {
                            var rDate = new Date();
                            var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                            $('#reqdate_' + rowid).val(endDate);
                        }
                        $('#unitid_' + rowid).val(suggestion.UnitId);
                        $('#rate_' + rowid).val(suggestion.Rate);
                        $('#rateType_' + rowid).val(suggestion.RateType);
                        $('#qty_' + rowid).val(suggestion.CurrentQty);
                        $('#hiddenqty_' + rowid).val(suggestion.HiddenQty);
                        $('#hqty_' + rowid).val(suggestion.HQty);
                        $('#expandTr_' + rowid).show();
                        $('#expandSt_' + rowid).show();
                        bindAResourceIOW($this);
                        addNewAResourceRow($this,suggestion.data);

                    }
                }, onSearchStart: function (suggestion) {
                    var rowid = $(this)[0].id.split('_')[1];

                    $('#unitname_' + rowid).val('');
                    $('#rate_' + rowid).val('');
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length) {
                        var rowid = $(this)[0].id.split('_')[1];

                        $('#unitname_' + rowid).val('');
                        $('#rate_' + rowid).val('');
                    }
                }
            });
        }
        function bindAResourceIOW(x) {
            var rowid = $(x)[0].id.split('_')[1];
            var $iowrowid = $('#iow_' + rowid + '_rowid');
            var resourceId = $('#resourceid_' + rowid).val();
            var costcentre=$('#CostCentre').val();
            $('.loading_area').show();
            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: {'Type': 'getIow-wbsdetails', 'ResourceId': resourceId, 'CostCentreId': costcentre},
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        data = JSON.parse(data);
                        var actTemplate = $('#act-template').html();
                        var wbscount =0;
                        if (data.wbs.length > 0) {
                            $('#iowTable_' + rowid).html('<thead> <tr> <th>Code</th> <th <th width="20%">Wbs Name</th>  <th width="20%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
                            $.each(data.wbs, function (i,l) {

                                if (l.ResourceId == resourceId) {
                                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                                    $('#iowTable_' + rowid).find('tbody.main').append(actTemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                    wbscount++;

                                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                                    $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                    $('#iow_' + rowid + '_iowid_' + iowrowid).val(l.IowId);
                                    $('#iow_' + rowid + '_resid_' + iowrowid).val(l.ResourceId);
                                    $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WBSName);
                                    $('#iow_' + rowid + '_qty_' + iowrowid).focus();
                                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.CurrentQty);
                                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                                    $('#iow_' + rowid + '_hqty_' + iowrowid).val(l.Qty);

                                    //WBS Estimate
                                    var AvailableQty1 = 0;
                                    $.each(data.aWBS, function (s,w) {
                                        if (l.ResourceId == w.IowId && l.WBSId == w.WbsId ) {
                                            $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(w.EstimateQty);
                                            $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(w.AvailableQty);
                                            if(w.AvailableQty < 0){
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(w.AvailableQty);
                                            } else{
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(000);
                                            }
                                            $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(w.BalRequestQty);
                                            $('#iow_' + rowid + '_reqwbsqty_' + iowrowid).html(w.RequestQty);
                                            $('#iow_' + rowid + '_wowbsqty_' + iowrowid).html(w.WOQty);
                                        }
                                    });
                                    // end of est-wbs
                                }
                            });
                        }else{
							$('#wbsiow_'+rowid).hide();
							$('#wbsspec_'+rowid).addClass('active');
							$('#iowTable_'+rowid).hide();
							$('#reqspeTable_'+rowid).show();
						}
                        if(wbscount == 0){
                            $('#qty_' + rowid).attr('readonly',false);
                            $('#qty_' + rowid).focus();
                        }
                    }
                    $('.loading_area').hide();
                }, error: function (jqXHR, textStatus, errorThrown) {
                    $('.loading_area').hide();
                }
            });
        }
        function addNewAResourceRow(x,v) {
            var $tr = $(x).closest('tr');
            if ($tr.next('tr:not(.subTr)').length != 0)
                return;

            var $rowid = $('#rowid'),
                rowid = parseInt($rowid.val()),
                $tbody = $('#workorderTable').find('> tbody.main');

            $('#deleteTr_' + rowid).show();
            var count = rowid + 1,
                template = $('#resource-template').html();
            var resspectemplate=$('#resspec-template').html();
            $("#click_"+count).hide();


            // var rTransId=$('#requestTransIds').val();
            // var rTransId=$('#requestTransIds').val();
//            if($('#requestTransIds').val().length > 0)
//            {
//                $('#requestTransIds').val(rTransId+","+v);
//                rTransId= $('#requestTransIds').val();
//            }
//            else
//            {
//                $('#requestTransIds').val(v);
//                rTransId=$('#requestTransIds').val();
//            }
            //  var arr_estdetails = <?php //echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;
            var ccid=<?php echo (isset($CostCentre)) ? $CostCentre : '';?>;
            var rTransId=$('#resourceid_' + rowid).val();
            $.ajax({
                type: "POST",
                url: getBaseURL() + 'ats/index/entry-sample',
                data: "ccid=" + ccid + "&resid=" + rTransId + "&Type=getIow-estDetails",
                dataType: "json",
                success: function (data) {
                    if (data.EstimateQty > 0) {
                        $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(data.EstimateQty, 3, true));
                    } else {
                        $('#estqty_' + rowid).text('Estimate Qty:  ');
                    }

                    if (data.AvailableQty > 0) {
                        $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(data.AvailableQty, 3, true));
                    } else {
                        $('#avaqty_' + rowid).text('Available Qty:  ');
                    }

                    if (data.AvailableQty < 0) {
                        $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(data.AvailableQty, 3, true));
                    } else {
                        $('#excessqty_' + rowid).text('Excess Qty:  ');
                    }

                    if (data.RequestQty < 0) {
                        $('#reqqty_' + rowid).text(data.RequestQty);
                    } else {
                        $('#reqqty_' + rowid).text('Request Qty:  ');
                    }

                    if (data.BalRequestQty < 0) {
                        $('#balreqqty_' + rowid).text(data.BalReqQty);
                    } else {
                        $('#balreqqty_' + rowid).text('Bal Request Qty:  ');
                    }

                    if (data.WOQty < 0) {
                        $('#woqty_' + rowid).text('WO Qty: ' + sanitizeNumber(data.WOQty, 3, true));
                    } else {
                        $('#woqty_' + rowid).text('WO Qty:  ');
                    }
                }

            });
            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            template = template.replace(/__/g, '_' + count);
            $tbody.append(template);
            $rowid.val(count);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            else{
                $("#click_"+count).show();
            }
        }
        function checkAResourceUsed(x) {
            var id = $(x)[0].id.split('_')[1];
            var reskeyid = $('input[id*=resourceid_]');
            tmp_arr_resources = arr_resources;
            tmp_arr_resources = $.grep(arr_resources, function (element, index) {
                var is_selected = true;
                $.each(reskeyid, function (i, obj) {

                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != id) {
                        if (element.data == $this.val()) {
                            is_selected = false;
                            return false;
                        }

                    }
                });
                return is_selected;
            });
            bindResourceAutocomplete();
        }
        function nextAccordian(id) {
            $('#panelheading-' + id).trigger('click');
        }
        function showtabs(type,id,event) {
            event.preventDefault();
            $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
            var rowid = id.split('_')[1];
            if (type=="wbs") {
                $('#iowTable_'+rowid).show();
                $('#reqspeTable_'+rowid).hide();

            } else{
                $('#reqspeTable_'+rowid).show();
                $('#iowTable_'+rowid).hide();
            }
            return false;
        }
        function checkActQty(x){
            var rowid = $(x)[0].id.split('_')[1];
            var abc = $('#iow_' + rowid + '_rowid');
            // var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var eststr = $('#estqty_' + rowid).text();
            var eststr = $('#estqty_' + rowid).text().split(':');
            var estqty = parseFloatVal(eststr[1]);
            var curQty = parseFloatVal($('#qty_' + rowid).val());
            var hiddenQty = parseFloatVal($('#hiddenqty_' + rowid).val());
            var avastr = $('#avaqty_' + rowid).text().split(':');
            var avaqty = parseFloatVal(avastr[1]);

            if(estqty == 'undefined' || estqty == null || isNaN(estqty)) { estqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || isNaN(hiddenQty)) { hiddenQty=0; }
            if(avaqty == 'undefined' || avaqty == null || isNaN(avaqty)) { avaqty=0; }

            if((curQty-hiddenQty) > avaqty) {
                alert("Request quantity is greater than Available Quantity");
                $('#qty_' + rowid).val(0);
                return false;
            }
        }
        function calcActQuantity(x) {

            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];

            var iowrowid=ids[3];
            var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var estqty = $('#iow_'+rowid+'_estwbsqty_' + iowrowid).text();
            var avaqty = $('#iow_'+rowid+'_avawbsqty_' + iowrowid).text();
            var curQty = parseFloat($('#iow_'+rowid+'_qty_' + iowrowid).val());
            var hiddenQty = parseFloat($('#iow_'+rowid+'_hiddenqty_' + iowrowid).val());


            if(estqty == 'undefined' || estqty == null || estqty == '' || isNaN(estqty)) { estqty=0; }
            if(avaqty == 'undefined' || avaqty == null || avaqty == '' || isNaN(avaqty)) { avaqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || hiddenQty == '' || isNaN(hiddenQty) == true ) { hiddenQty=0; }

            if((curQty-hiddenQty)  > avaqty){
                alert("Request quantity is greater than Available quantity");
                $('#iow_'+rowid+'_qty_' + iowrowid).val(0);
                return false;
            }
            //
            // calc total qty
            var totalQty=0.0;
            $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
                var qty=0.0;
                if($(this).val() != '' || $(this).val().length != 0 )
                {
                    qty = $(this).val();
                }
                if(isNaN(qty))
                    qty = 0;

                totalQty = parseFloat(totalQty) + parseFloat(qty);
            });

            $('#qty_'+rowid).val(sanitizeNumber(totalQty, 3,true));

            // calc total amount
            var rate = parseFloatVal($('#rate_'+rowid).val());
            $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate));
            calcTotal();
        }
        function calcTotal() {
            var total = 0;
            $.each($('input[id^=amount_]'), function (i,o) {
                total += parseFloatVal($(this).val());
            });
            $('#total').val(sanitizeNumber(total,3,true));
        }
        function checkActEstWbs(x) {
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowid = ids[3];
            var trowid = $('#iow_'+rowid+'_rowid');
            //tooltip show
            var estqty = $('#iow_' + rowid + '_estwbsqty_' + iowid).text();
            var avaqty = $('#iow_' + rowid + '_avawbsqty_' + iowid).text();
            var excessqty = $('#iow_' + rowid + '_excesswbsqty_' + iowid).text();
            var reqqty = $('#iow_' + rowid + '_reqwbsqty_' + iowid).text();
            var balreqqty = $('#iow_' + rowid + '_balreqwbsqty_' + iowid).text();
            var woqty = $('#iow_' + rowid + '_wowbsqty_' + iowid).text();
            //"1st line text" +"\n" + "2nd line text";
            $(x).attr('data-original-title',"Estimate Qty : " + sanitizeNumber(estqty,3,true) + "<br />"  +
            "Available Qty : " + sanitizeNumber(avaqty,3,true) + "<br />" +
            "Excess Qty : " + sanitizeNumber(excessqty,3,true) + "<br />" +
            "Request Qty : " + sanitizeNumber(reqqty,3,true) + "<br />" +
            "Bal Request Qty : " + sanitizeNumber(balreqqty,3,true) + "<br />" +
            "WO Qty : " + sanitizeNumber(woqty,3,true) + "<br />" );
            $(x).tooltip('show');
        }
        function clickTr(val){
            var data = ($(val).attr('id')).split('_');
            var resourceId = $('#resourceid_' + data[1]).val();
            var itemId = $('#itemid_' + data[1]).val();
            var costCentreId = $('#CostCentre').val();
        }
        function deleteRow(x,e) {
            e.preventDefault();
            var rowid = $('#rowid').val();
            var $x = $(x),
                key = $x[0].className.split('_')[1];
            if (!confirm('Do you want to Delete'))
                return false;
            var $tr = $x.closest('tr');
            $tr.next('.subTr').remove();
            $tr.remove();
            //rowid -= 1;
            $('#rowid').val(rowid);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            return false;
        }
        function stockReqDetails(x){

            var rowid = $(x)[0].id.split('_')[1];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var  mode="getstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockReqModal").show();
                        $("#estimateQty").val(sdata['EstimateQty']);
                        $("#availableQty").val(sdata['AvailableQty']);
                        $("#excessQty").val(sdata['ExcessQty']);
                        $("#balanceRequest").val(sdata['BalReqQty']);
                        $("#balancePO").val(sdata['BalPOQty']);
                        $("#totalPurchase").val(sdata['TotPurchase']);
                        $("#requestQty").val(sdata['ReqQty']);
                        $("#poQty").val(sdata['POQty']);
                        $("#minQty").val(sdata['MinQty']);
                        $("#billQty").val(sdata['BillQty']);
                        $("#issueQty").val(sdata['IssueQty']);
                        $("#transferQty").val(sdata['TransferQty']);
                        $("#billreturnQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
        function stockWBSDetails(x){
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowrowid = ids[3];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var WBSId = $('#iow_' + rowid + '_wbsid_' + iowrowid).val();
            var  mode="getwbsstockdetails";
            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockWBSModal").show();
                        $("#estimateWbsQty").val(sdata['EstimateQty']);
                        $("#availableWbsQty").val(sdata['AvailableQty']);
                        $("#excessWbsQty").val(sdata['ExcessQty']);
                        $("#balanceWbsRequest").val(sdata['BalReqQty']);
                        $("#balanceWbsPO").val(sdata['BalPOQty']);
                        $("#totalWbsPurchase").val(sdata['TotPurchase']);
                        $("#requestWbsQty").val(sdata['ReqQty']);
                        $("#poWbsQty").val(sdata['POQty']);
                        $("#minWbsQty").val(sdata['MinQty']);
                        $("#billWbsQty").val(sdata['BillQty']);
                        $("#billreturnWbsQty").val(sdata['ReturnQty']);
                    }
                }
            });
        }
    } // end of iow

    if(rType == 'Service') {
        $(function () {
            var $rowid = $('#rowid');
            var template = $('#resource-template').html();
            var actTemplate = $('#act-template').html();
            var resspectemplate=$('#resspec-template').html();
            var rowid = 0;
            var $tbody = $('#workorderTable').find('> tbody.main');
            $('#thQty').text('Amount');


            if(arr_requestResources.length != 0) {
                $.each(arr_requestResources, function (i, o) {
                    rowid += 1;
                    $tbody.append(template.replace(/__/g, '_' + rowid));
                    $('#code_' + rowid).val(o.Code).addClass('border-none').prop('disabled', false);
                    $('#desc_' + rowid).val(o.ResourceName).addClass('border-none').prop('readonly', true);
                    $('#resourceid_' + rowid).val(o.ResourceId);
                    $('#unitname_' + rowid).val(o.UnitName);
                    $('#unitid_' + rowid).val(o.UnitId);
                    $('#qty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
                    $('#hiddenqty_' + rowid).val(o.HiddenQty);
                    if(reqAdd == 1 && requestId > 0){
                        $('#reqdate_' + rowid).val(o.ReqDate);
                    } else if(reqAdd == 1) {
                        $('#reqdate_' + rowid).val('');
                    } else {
                        var rDate = new Date();
                        var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                        $('#reqdate_' + rowid).val(endDate);
                    }
                    $('#remarks_' + rowid).val(o.Remarks);
                    $('#rfrom_' + rowid).val(o.RFrom);
                    $('#expandTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#estqty_' + rowid).show();
                    $('#avaqty_' + rowid).show();
                    $('#excessqty_' + rowid).show();
                    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                    $('#resspec_' + rowid).val(o.Specification);
                    $('#wbsTabLink_' + rowid).hide();
                    $('#reqspeTable_' + rowid).show();
                    if (approve == "Y") {
                        $('#deleteTr_' + rowid).hide();
                    } else {
                        $('#deleteTr_' + rowid).show();
                    }
                    var availableQty =0;
                    $.each(arr_iowestimate, function (a, iKey) {
                        if (o.ResourceId == iKey['ServiceId']) {
                            if (iKey['EstimateQty'] > 0) {
                                $('#estqty_' + rowid).text('Estimate Amount:  ' + sanitizeNumber(iKey['EstimateQty'], 3, true));
                            } else {
                                $('#estqty_' + rowid).text('Estimate Amount:  0');
                            }

                            if (iKey['AvailableQty'] > 0) {
                                $('#avaqty_' + rowid).text('Available Amount:  ' + sanitizeNumber(iKey['AvailableQty'], 3, true));
                            } else {
                                $('#avaqty_' + rowid).text('Available Amount:  0');
                            }

                            if (iKey['AvailableQty'] < 0) {
                                $('#excessqty_' + rowid).text('Excess Amount:  ' + sanitizeNumber(iKey['AvailableQty'], 3, true));
                            } else {
                                $('#excessqty_' + rowid).text('Excess Amount:  0');
                            }

                            if (iKey['RequestQty'] > 0) {
                                $('#reqqty_' + rowid).text('Request Amount:  ' + sanitizeNumber(iKey['RequestQty'], 3, true));
                            } else {
                                $('#reqqty_' + rowid).text('Request Amount:  0');
                            }

                            if (iKey['BalRequestQty'] > 0) {
                                $('#balreqqty_' + rowid).text('Bal Request Amount:  ' + sanitizeNumber(iKey['BalRequestQty'], 3, true));
                            } else {
                                $('#balreqqty_' + rowid).text('Bal Request Amount:  0');
                            }

                            if (iKey['SOQty'] > 0) {
                                $('#woqty_' + rowid).text('SO Qty: ' + sanitizeNumber(iKey['SOQty'], 3, true));

                            } else {
                                $('#woqty_' + rowid).text('SO Qty:  0');
                            }
                        }
                    });
                });
            }
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $('#wbsTabLink_' + rowid).hide();
            $('#reqspeTable_' + rowid).show();
            $rowid.val(rowid);
            bindResourceAutocomplete();
            $('.content_wrapper').on('click','.mainTr',function(e){
                e.preventDefault();
                if(!$(this).closest("tr").next(".subTr").is(":visible")){
                    $(this).closest("tr").next(".subTr").show();
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                    $(this).find("i").addClass("tform");
                }
                else{
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                    $(this).closest("tr").next(".subTr").slideUp("slow");
                    $(this).find("i").removeClass("tform");
                }
            });
            nextAccordian(1);
            $('[data-toggle="tooltip"]').tooltip();
            if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
                //paging
                $('#workorderTable').paging({limit: 2});
                $('.paging-nav').children('a[data-page=0]').trigger('click');
            }
        });

        function bindResourceAutocomplete() {

            // bind resource autocomplete
            $('#workorderTable .resourceSuggest').autocomplete({
                lookup: tmp_arr_resources,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {

                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        var $this = $(this);
                        var rowid = $this[0].id.split('_')[1];
                        $this.prop('readonly', true).addClass('border-none');

                        $('#resourceid_' + rowid).val(suggestion.Data);
                        $('#unitname_' + rowid).val(suggestion.UnitName);
                        $('#code_' + rowid).val(suggestion.Code);
                        if(reqAdd == 1) {
                            $('#reqdate_' + rowid).val('');
                        } else {
                            var rDate = new Date();
                            var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                            $('#reqdate_' + rowid).val(endDate);
                        }
                        $('#unitid_' + rowid).val(suggestion.UnitId);
                        $('#rate_' + rowid).val(suggestion.Rate);
                        $('#rateType_' + rowid).val(suggestion.RateType);
                        $('#qty_' + rowid).val(suggestion.CurrentQty);
                        $('#hiddenqty_' + rowid).val(suggestion.HiddenQty);
                        $('#hqty_' + rowid).val(suggestion.HQty);
                        $('#expandTr_' + rowid).show();
                        $('#expandSt_' + rowid).show();
                        addNewAResourceRow($this,suggestion.data);

                    }
                }, onSearchStart: function (suggestion) {
                    var rowid = $(this)[0].id.split('_')[1];

                    $('#unitname_' + rowid).val('');
                    $('#rate_' + rowid).val('');
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length) {
                        var rowid = $(this)[0].id.split('_')[1];

                        $('#unitname_' + rowid).val('');
                        $('#rate_' + rowid).val('');
                    }
                }
            });
        }

        function addNewAResourceRow(x,v) {
            var $tr = $(x).closest('tr');
            if ($tr.next('tr:not(.subTr)').length != 0)
                return;

            var $rowid = $('#rowid'),
                rowid = parseInt($rowid.val()),
                $tbody = $('#workorderTable').find('> tbody.main');

            $('#deleteTr_' + rowid).show();
            var count = rowid + 1,
                template = $('#resource-template').html();
            var resspectemplate=$('#resspec-template').html();
            $("#click_"+count).hide();

            var ccid=<?php echo (isset($CostCentre)) ? $CostCentre : '';?>;
            var rTransId=$('#resourceid_' + rowid).val();
            $.ajax({
                type: "POST",
                url: getBaseURL() + 'ats/index/entry-sample',
                data: "ccid=" + ccid + "&resid=" + rTransId + "&Type=getService-estDetails",
                dataType: "json",
                success: function (data) {
                    if (data.EstimateQty > 0) {
                        $('#estqty_' + rowid).text('Estimate Amount:  ' + sanitizeNumber(data.EstimateQty, 3, true));
                    } else {
                        $('#estqty_' + rowid).text('Estimate Amount:  ');
                    }

                    if (data.AvailableQty > 0) {
                        $('#avaqty_' + rowid).text('Available Amount:  ' + sanitizeNumber(data.AvailableQty, 3, true));
                    } else {
                        $('#avaqty_' + rowid).text('Available Amount:  ');
                    }

                    if (data.AvailableQty < 0) {
                        $('#excessqty_' + rowid).text('Excess Amount:  ' + sanitizeNumber(data.AvailableQty, 3, true));
                    } else {
                        $('#excessqty_' + rowid).text('Excess Amount:  ');
                    }

                    if (data.RequestQty < 0) {
                        $('#reqqty_' + rowid).text('Request Amount: ' + sanitizeNumber(data.RequestQty,3,true));
                    } else {
                        $('#reqqty_' + rowid).text('Request Amount:  ');
                    }

                    if (data.BalRequestQty < 0) {
                        $('#balreqqty_' + rowid).text('Bal Request Amount: ' + sanitizeNumber(data.BalReqQty,3,true));
                    } else {
                        $('#balreqqty_' + rowid).text('Bal Request Amount:  ');
                    }

                    if (data.SOQty < 0) {
                        $('#woqty_' + rowid).text('SO Amount: ' + sanitizeNumber(data.SOQty, 3, true));
                    } else {
                        $('#woqty_' + rowid).text('SO Qty:  ');
                    }
                }

            });
            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            $('#wbsTabLink_' + rowid).hide();
            $('#reqspeTable_' + rowid).show();
            template = template.replace(/__/g, '_' + count);
            $tbody.append(template);
            $rowid.val(count);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            else{
                $("#click_"+count).show();
            }
        }
        function checkAResourceUsed(x) {
            var id = $(x)[0].id.split('_')[1];
            var reskeyid = $('input[id*=resourceid_]');
            tmp_arr_resources = arr_resources;
            tmp_arr_resources = $.grep(arr_resources, function (element, index) {
                var is_selected = true;
                $.each(reskeyid, function (i, obj) {

                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != id) {
                        if (element.data == $this.val()) {
                            is_selected = false;
                            return false;
                        }

                    }
                });
                return is_selected;
            });
            bindResourceAutocomplete();
        }
        function nextAccordian(id) {
            $('#panelheading-' + id).trigger('click');
        }
        function showtabs(type,id,event) {
            event.preventDefault();
            $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
            var rowid = id.split('_')[1];
            if (type=="wbs") {
                $('#iowTable_'+rowid).show();
                $('#reqspeTable_'+rowid).hide();

            } else{
                $('#reqspeTable_'+rowid).show();
                $('#iowTable_'+rowid).hide();
            }
            return false;
        }
        function checkActQty(x){
            var rowid = $(x)[0].id.split('_')[1];
            var abc = $('#iow_' + rowid + '_rowid');
            // var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var eststr = $('#estqty_' + rowid).text();
            var eststr = $('#estqty_' + rowid).text().split(':');
            var estqty = parseFloatVal(eststr[1]);
            var curQty = parseFloatVal($('#qty_' + rowid).val());
            var hiddenQty = parseFloatVal($('#hiddenqty_' + rowid).val());
            var avastr = $('#avaqty_' + rowid).text().split(':');
            var avaqty = parseFloatVal(avastr[1]);

            if(estqty == 'undefined' || estqty == null || isNaN(estqty)) { estqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || isNaN(hiddenQty)) { hiddenQty=0; }
            if(avaqty == 'undefined' || avaqty == null || isNaN(avaqty)) { avaqty=0; }

            if((curQty-hiddenQty) > avaqty) {
                alert("Request amount is greater than Available amount");
                $('#qty_' + rowid).val(0);
                return false;
            }
        }
        function calcActQuantity(x) {

            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];

            var iowrowid=ids[3];
            var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var estqty = $('#iow_'+rowid+'_estwbsqty_' + iowrowid).text();
            var avaqty = $('#iow_'+rowid+'_avawbsqty_' + iowrowid).text();
            var curQty = parseFloat($('#iow_'+rowid+'_qty_' + iowrowid).val());
            var hiddenQty = parseFloat($('#iow_'+rowid+'_hiddenqty_' + iowrowid).val());


            if(estqty == 'undefined' || estqty == null || estqty == '' || isNaN(estqty)) { estqty=0; }
            if(avaqty == 'undefined' || avaqty == null || avaqty == '' || isNaN(avaqty)) { avaqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || hiddenQty == '' || isNaN(hiddenQty) == true ) { hiddenQty=0; }

            if((curQty-hiddenQty)  > avaqty){
                alert("Request amount is greater than Available amount");
                $('#iow_'+rowid+'_qty_' + iowrowid).val(0);
                return false;
            }
            //
            // calc total qty
            var totalQty=0.0;
            $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
                var qty=0.0;
                if($(this).val() != '' || $(this).val().length != 0 )
                {
                    qty = $(this).val();
                }
                if(isNaN(qty))
                    qty = 0;

                totalQty = parseFloat(totalQty) + parseFloat(qty);
            });

            $('#qty_'+rowid).val(sanitizeNumber(totalQty, 2,true));

            // calc total amount
            var rate = parseFloatVal($('#rate_'+rowid).val());
            $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate));
            calcTotal();
        }
        function calcTotal() {
            var total = 0;
            $.each($('input[id^=amount_]'), function (i,o) {
                total += parseFloatVal($(this).val());
            });
            $('#total').val(sanitizeNumber(total,3,true));
        }

        function clickTr(val){
            var data = ($(val).attr('id')).split('_');
            var resourceId = $('#resourceid_' + data[1]).val();
            var itemId = $('#itemid_' + data[1]).val();
            var costCentreId = $('#CostCentre').val();
        }
        function deleteRow(x,e) {
            e.preventDefault();
            var rowid = $('#rowid').val();
            var $x = $(x),
                key = $x[0].className.split('_')[1];
            if (!confirm('Do you want to Delete'))
                return false;
            var $tr = $x.closest('tr');
            $tr.next('.subTr').remove();
            $tr.remove();
            //rowid -= 1;
            $('#rowid').val(rowid);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            return false;
        }
        function stockReqDetails(x){

            var rowid = $(x)[0].id.split('_')[1];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var  mode="getstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockReqModal").show();
                        $("#estimateQty").val(sdata['EstimateQty']);
                        $("#availableQty").val(sdata['AvailableQty']);
                        $("#excessQty").val(sdata['ExcessQty']);
                        $("#balanceRequest").val(sdata['BalReqQty']);
                        $("#balancePO").val(sdata['BalPOQty']);
                        $("#totalPurchase").val(sdata['TotPurchase']);
                        $("#requestQty").val(sdata['ReqQty']);
                        $("#poQty").val(sdata['POQty']);
                        $("#minQty").val(sdata['MinQty']);
                        $("#billQty").val(sdata['BillQty']);
                        $("#issueQty").val(sdata['IssueQty']);
                        $("#transferQty").val(sdata['TransferQty']);
                        $("#billreturnQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
    }

    if(rType == 'TurnKey') {
        $(function () {
            var $rowid = $('#rowid');
            var template = $('#resource-template').html();
            var actTemplate = $('#act-template').html();
            var resspectemplate=$('#resspec-template').html();
            var rowid = 0;
            var $tbody = $('#workorderTable').find('> tbody.main');
            $('#thQty').text('Percentage');
            $('#thCode').text('Parent Text');
            $('#thDesc').text('WBS Name');


            if(arr_requestResources.length != 0) {
                $.each(arr_requestResources, function (i, o) {
                    rowid += 1;
                    $tbody.append(template.replace(/__/g, '_' + rowid));
                    $('#code_' + rowid).val(o.Code).addClass('border-none').prop('disabled', false);
                    $('#desc_' + rowid).val(o.ResourceName).addClass('border-none').prop('readonly', true);
                    $('#resourceid_' + rowid).val(o.ResourceId);
                    $('#qty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
                    $('#hiddenqty_' + rowid).val(o.HiddenQty);
                    $('#expandTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#estqty_' + rowid).hide();
                    $('#avaqty_' + rowid).hide();
                    $('#excessqty_' + rowid).hide();
                    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                    $('#resspec_' + rowid).val(o.Specification);
                    $('#wbsTabLink_' + rowid).hide();
                    $('#reqspeTable_' + rowid).show();
                    if (approve == "Y") {
                        $('#deleteTr_' + rowid).hide();
                    } else {
                        $('#deleteTr_' + rowid).show();
                    }
                });
            }
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $('#wbsTabLink_' + rowid).hide();
            $('#reqspeTable_' + rowid).show();
            $rowid.val(rowid);
            bindResourceAutocomplete();
            $('.content_wrapper').on('click','.mainTr',function(e){
                e.preventDefault();
                if(!$(this).closest("tr").next(".subTr").is(":visible")){
                    $(this).closest("tr").next(".subTr").show();
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                    $(this).find("i").addClass("tform");
                }
                else{
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                    $(this).closest("tr").next(".subTr").slideUp("slow");
                    $(this).find("i").removeClass("tform");
                }
            });
            nextAccordian(1);
            $('[data-toggle="tooltip"]').tooltip();
            if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
                //paging
                $('#workorderTable').paging({limit: 2});
                $('.paging-nav').children('a[data-page=0]').trigger('click');
            }
        });

        function bindResourceAutocomplete() {

            // bind resource autocomplete
            $('#workorderTable .resourceSuggest').autocomplete({
                lookup: tmp_arr_resources,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {

                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        var $this = $(this);
                        var rowid = $this[0].id.split('_')[1];
                        $this.prop('readonly', true).addClass('border-none');

                        $('#resourceid_' + rowid).val(suggestion.Data);
                        $('#code_' + rowid).val(suggestion.Code);
                        if(reqAdd == 1) {
                            $('#reqdate_' + rowid).val('');
                        } else {
                            var rDate = new Date();
                            var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                            $('#reqdate_' + rowid).val(endDate);
                        }
                        $('#qty_' + rowid).val(suggestion.CurrentQty);
                        $('#hiddenqty_' + rowid).val(suggestion.HiddenQty);
                        $('#hqty_' + rowid).val(suggestion.HQty);
                        $('#expandTr_' + rowid).show();
                        $('#expandSt_' + rowid).show();
                        addNewAResourceRow($this,suggestion.data);

                    }
                }, onSearchStart: function (suggestion) {
                    var rowid = $(this)[0].id.split('_')[1];

                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length) {
                        var rowid = $(this)[0].id.split('_')[1];

                    }
                }
            });
        }

        function addNewAResourceRow(x,v) {
            var $tr = $(x).closest('tr');
            if ($tr.next('tr:not(.subTr)').length != 0)
                return;

            var $rowid = $('#rowid'),
                rowid = parseInt($rowid.val()),
                $tbody = $('#workorderTable').find('> tbody.main');

            $('#deleteTr_' + rowid).show();
            var count = rowid + 1,
                template = $('#resource-template').html();
            var resspectemplate=$('#resspec-template').html();
            $("#click_"+count).hide();

            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            $('#wbsTabLink_' + rowid).hide();
            $('#reqspeTable_' + rowid).show();
            template = template.replace(/__/g, '_' + count);
            $tbody.append(template);
            $rowid.val(count);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            else{
                $("#click_"+count).show();
            }
        }
        function checkAResourceUsed(x) {
            var id = $(x)[0].id.split('_')[1];
            var reskeyid = $('input[id*=resourceid_]');
            tmp_arr_resources = arr_resources;
            tmp_arr_resources = $.grep(arr_resources, function (element, index) {
                var is_selected = true;
                $.each(reskeyid, function (i, obj) {

                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != id) {
                        if (element.data == $this.val()) {
                            is_selected = false;
                            return false;
                        }

                    }
                });
                return is_selected;
            });
            bindResourceAutocomplete();
        }
        function nextAccordian(id) {
            $('#panelheading-' + id).trigger('click');
        }
        function showtabs(type,id,event) {
            event.preventDefault();
            $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
            var rowid = id.split('_')[1];
            if (type=="wbs") {
                $('#iowTable_'+rowid).show();
                $('#reqspeTable_'+rowid).hide();

            } else{
                $('#reqspeTable_'+rowid).show();
                $('#iowTable_'+rowid).hide();
            }
            return false;
        }

        function clickTr(val){
            var data = ($(val).attr('id')).split('_');
            var resourceId = $('#resourceid_' + data[1]).val();
            var itemId = $('#itemid_' + data[1]).val();
            var costCentreId = $('#CostCentre').val();
        }
        function deleteRow(x,e) {
            e.preventDefault();
            var rowid = $('#rowid').val();
            var $x = $(x),
                key = $x[0].className.split('_')[1];
            if (!confirm('Do you want to Delete'))
                return false;
            var $tr = $x.closest('tr');
            $tr.next('.subTr').remove();
            $tr.remove();
            //rowid -= 1;
            $('#rowid').val(rowid);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            return false;
        }
        function stockReqDetails(x){

            var rowid = $(x)[0].id.split('_')[1];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var  mode="getstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockReqModal").show();
                        $("#estimateQty").val(sdata['EstimateQty']);
                        $("#availableQty").val(sdata['AvailableQty']);
                        $("#excessQty").val(sdata['ExcessQty']);
                        $("#balanceRequest").val(sdata['BalReqQty']);
                        $("#balancePO").val(sdata['BalPOQty']);
                        $("#totalPurchase").val(sdata['TotPurchase']);
                        $("#requestQty").val(sdata['ReqQty']);
                        $("#poQty").val(sdata['POQty']);
                        $("#minQty").val(sdata['MinQty']);
                        $("#billQty").val(sdata['BillQty']);
                        $("#issueQty").val(sdata['IssueQty']);
                        $("#transferQty").val(sdata['TransferQty']);
                        $("#billreturnQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
    }

    if(rType == 'Material' || rType == 'Asset'){
        $(function () {
            var $rowid = $('#rowid');
            var template = $('#resource-template').html();
            var iowtemplate = $('#iow-template').html();
            var resspectemplate=$('#resspec-template').html();
            var rowid = 0;
            var $tbody = $('#workorderTable').find('> tbody.main');
            if(arr_requestResources.length != 0) {
                $.each(arr_requestResources, function(i, o) {
                    rowid += 1;
                    $tbody.append(template.replace(/__/g, '_' + rowid));
                    $('#code_' + rowid).val(o.Code).addClass('border-none').prop('disabled', false);
                    $('#desc_' + rowid).val(o.ResourceName).addClass('border-none').prop('readonly', true);
                    $('#resourceid_' + rowid).val(o.ResourceId);
                    $('#itemid_' + rowid).val(o.ItemId);
                    $('#unitname_' + rowid).val(o.UnitName);
                    $('#unitid_' + rowid).val(o.UnitId);

                    if(reqAdd == 1 && requestId > 0){
                        $('#reqdate_' + rowid).val(o.ReqDate);
                    } else if(reqAdd == 1) {
                        $('#reqdate_' + rowid).val('');
                    } else {
                        var rDate = new Date();
                        var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                        $('#reqdate_' + rowid).val(endDate);
                    }
                    $('#remarks_' + rowid).val(o.Remarks);
                    $('#qty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
                    $('#hiddenqty_' + rowid).val(o.HiddenQty);
                    $('#rfrom_' + rowid).val(o.RFrom);
                    $('#expandTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#estqty_' + rowid).show();
                    $('#avaqty_' + rowid).show();
                    $('#excessqty_' + rowid).show();
                    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                    $('#resspec_' + rowid).val(o.Specification);
                    if(approve=="Y"){
                        $('#deleteTr_' + rowid).hide();
                    } else {
                        $('#deleteTr_' + rowid).show();
                    }
                    $.each(arr_estdetails,function(s,k){
                        if(o.ResourceId == k.ResourceId)
                        {
                            if(k.EstimateQty > 0 || k.EstimateQty < 0) {
                                $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(k.EstimateQty,3,true));
                            }
                            else
                            {
                                $('#estqty_' + rowid).text('Estimate Qty:  0');
                            }
                            if(k.AvailableQty > 0 || k.AvailableQty < 0) {
                                $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(k.AvailableQty,3,true));
                            }
                            else
                            {
                                $('#avaqty_' + rowid).text('Available Qty:  0');
                            }
                            if(k.ExcessQty > 0 || k.ExcessQty < 0) {
                                $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(k.ExcessQty,3,true));
                            }
                            else
                            {
                                $('#excessqty_' + rowid).text('Excess Qty:  0');
                            }

                            if(k.BalReqQty > 0 || k.BalReqQty < 0)
                            {
                                $('#balreqqty_' + rowid).text(k.BalReqQty);
                            }
                            else
                            {
                                $('#balreqqty_' + rowid).text(0);
                            }
                            if(k.BalPOQty > 0 || k.BalPOQty < 0)
                            {
                                $('#balpoqty_' + rowid).text(k.BalPOQty);
                            }
                            else
                            {
                                $('#balpoqty_' + rowid).text(0);
                            }
                            if(k.TotPurchase > 0 || k.TotPurchase < 0)
                            {
                                $('#totpurchase_' + rowid).text(k.TotPurchase);
                            }
                            else
                            {
                                $('#totpurchase_' + rowid).text(0);
                            }
                            if(k.IsProj > 0)
                            {
                                $('#isproj_' + rowid).text(k.IsProj);
                            }
                            else
                            {
                                $('#isproj_' + rowid).text(0);
                            }
                        }
                    });
                    if(arr_resource_iows.length != 0) {
                        $('#iowTable_' + rowid).html('<thead> <tr> <th width="50%">Wbs Name</th>  <th width="50%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
                        $.each(arr_resource_iows, function (j, l) {
                            var findRes = arr_resource_wbs.filter(function (obj) {
                                return (obj.ResourceId === o.ResourceId && obj.WBSId === l.WBSId);
                            });

                            if (findRes.length > 0) {
                                if (l.ResourceId == 0 && l.ItemId == 0) {
                                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                                    $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                    $('#iowTable_' + rowid).show();
                                    $('#wbsTabLink_'+rowid).show();
                                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                                    $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                    $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
                                    $('#iow_' + rowid + '_qty_' + iowrowid).focus();
                                    $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty, 3, true));
                                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);

                                    var findestwbs = arr_wbsestimate.filter(function (obj) {
                                            return (obj.ResourceId === o.ResourceId && obj.WBSId === l.WBSId);
                                        }
                                    );

                                    if (findestwbs.length > 0) {
                                        $.each(arr_wbsestimate, function (s, n) {
                                            if (o.ResourceId == n.ResourceId && l.WBSId == n.WBSId) {

                                                $('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
                                                $('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                                $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(n.EstimateQty);
                                                $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(n.AvailableQty);
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(n.ExcessQty);
                                                $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(n.BalReqQty);
                                                $('#iow_' + rowid + '_balpowbsqty_' + iowrowid).html(n.BalPOQty);
                                                $('#iow_' + rowid + '_totpurchasewbsqty_' + iowrowid).html(n.TotPurchase);
                                                $('#iow_' + rowid + '_isprojwbsqty_' + iowrowid).html(n.IsProj);

                                            }
                                        });
                                    }
                                    else {
                                        $('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
                                        $('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                    }
                                    $('#iow_' + rowid + '_expandWbs_' + iowrowid).show();

                                }
                                else if (l.ResourceId == o.ResourceId && l.ItemId == o.ItemId) {
                                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                                    $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                                    $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                    $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
                                    $('#iow_' + rowid + '_qty_' + iowrowid).attr('autofocus', true);
                                    $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty, 3, true));
                                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                                    var findestwbs = arr_wbsestimate.filter(function (obj) {
                                            return (obj.ResourceId === l.ResourceId && obj.WBSId === l.WBSId);
                                        }
                                    );
                                    if (findestwbs.length > 0) {
                                        $.each(arr_wbsestimate, function (s, n) {
                                            if (l.ResourceId == n.ResourceId && l.WBSId == n.WBSId) {
                                                $('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
                                                $('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                                $('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(n.EstimateQty);
                                                $('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(n.AvailableQty);
                                                $('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(n.ExcessQty);
                                                $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(n.BalReqQty);
                                                $('#iow_' + rowid + '_balpowbsqty_' + iowrowid).html(n.BalPOQty);
                                                $('#iow_' + rowid + '_totpurchasewbsqty_' + iowrowid).html(n.TotPurchase);
                                                $('#iow_' + rowid + '_isprojwbsqty_' + iowrowid).html(n.IsProj);
                                            }
                                        });
                                    }
                                    else {
                                        $('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
                                        $('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                    }
                                    $('#iow_' + rowid + '_expandWbs_' + iowrowid).show();
                                }
                            } else {
                                $('#qty_' + rowid).removeAttr('readonly',false);
                                $('#qty_' + rowid).focus();
								$('#spec_'+rowid).addClass('active');
								$('#iowTable_'+rowid).hide();
                                $('#wbsTabLink_'+rowid).hide();
                                $('#reqspeTable_'+rowid).show();
                            }
                        });
                    } else {

                        $('#qty_' + rowid).removeAttr('readonly',false);
                        $('#qty_' + rowid).focus();
                        $('#spec_'+rowid).addClass('active');
                        $('#iowTable_'+rowid).hide();
                        $('#wbsTabLink_'+rowid).hide();
                        $('#reqspeTable_'+rowid).show();
                    }
                });
            }
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $rowid.val(rowid);
            bindResourceAutocomplete();
            $('.content_wrapper').on('click','.mainTr',function(e){
                e.preventDefault();
                if(!$(this).closest("tr").next(".subTr").is(":visible")){
                    $(this).closest("tr").next(".subTr").show();
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                    $(this).find("i").addClass("tform");
                }
                else{
                    $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                    $(this).closest("tr").next(".subTr").slideUp("slow");
                    $(this).find("i").removeClass("tform");
                }
            });
            nextAccordian(1);
            $('[data-toggle="tooltip"]').tooltip();
            if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
                //paging
                $('#workorderTable').paging({limit: 2});
                $('.paging-nav').children('a[data-page=0]').trigger('click');
            }
        });
        $('#jqxbutton').click(function () {
            $("#treeGrid").jqxTreeGrid('expandAll');
            $('#jqxbutton').hide();
            $('#jqxbuttorenn').show();
        });

        $('#jqxbuttorenn').click(function () {
            $("#treeGrid").jqxTreeGrid('render');
            $('#jqxbutton').show();
            $('#jqxbuttorenn').hide();
        });


        function bindResourceAutocomplete() {
            // bind resource autocomplete
            $('#workorderTable .resourceSuggest').autocomplete({
                lookup: tmp_arr_resources,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {

                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        var $this = $(this);
                        var rowid = $this[0].id.split('_')[1];
                        var reskeyid = $('input[id*=resourceid_] ') ;
                        var bRet=false;
                        $.each(reskeyid, function (i, obj) {
                            var $this = $(this),
                                name = $this[0].id;
                            var arrname = name.split('_');
                            var key1 = arrname[1];
                            if (key1 != rowid) {
                                if ($this.val() == suggestion.data && $('#itemid_' + key1).val() == suggestion.ItemId) {
                                    bRet = true;
                                }
                            }
                        });
                        if(bRet == false) {
                            $this.prop('readonly', true).addClass('border-none');
                            $('#resourceid_' + rowid).val(suggestion.data);
                            $('#unitname_' + rowid).val(suggestion.UnitName);
                            $('#code_' + rowid).val(suggestion.Code);
                            if(reqAdd == 1) {
                                $('#reqdate_' + rowid).val('');
                            } else {
                                var rDate = new Date();
                                var endDate = $.datepicker.formatDate('dd-mm-yy', rDate);
                                $('#reqdate_' + rowid).val(endDate);
                            }
                            $('#unitid_' + rowid).val(suggestion.UnitId);
                            $('#itemid_' + rowid).val(suggestion.ItemId);
                            $('#rfrom_' + rowid).val(suggestion.RFrom);
                            $('#qty_' + rowid).val(suggestion.Qty);
                            $('#expandTr_' + rowid).show();
                            $('#expandSt_' + rowid).show();
                            bindResourceIOW($this);
                            addNewResourceRow($this,suggestion.data);
                        } else{
                            alert('Already added in list');
                            $('#desc_' + rowid).val('');
                            return;
                        }
                    }
                }, onSearchStart: function (suggestion) {
                    var rowid = $(this)[0].id.split('_')[1];

                    $('#unitname_' + rowid).val('');
                    $('#rate_' + rowid).val('');
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length) {
                        var rowid = $(this)[0].id.split('_')[1];

                        $('#unitname_' + rowid).val('');
                        $('#rate_' + rowid).val('');
                    }
                }
            });
        }
        function bindResourceIOW(x) {
            var rowid = $(x)[0].id.split('_')[1];
            var $iowrowid = $('#iow_' + rowid + '_rowid');
            var resourceId = $('#resourceid_' + rowid).val();
            var costcentre=$('#CostCentre').val();
            $('.loading_area').show();
            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: {'Type': 'getwbsdetails', 'ResourceId': resourceId, 'CostCentre': costcentre},
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        data = JSON.parse(data);
                        var iowtemplate = $('#iow-template').html();
                        var wbscount =0;
						if(data.wbs.length!=0){
							$('#iowTable_' + rowid).html('<thead> <tr> <th width="50%">Wbs Name</th>  <th width="50%">Qty</th> <th>&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> <tr> <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td> </tr> </tbody>');
							$.each(data.wbs, function (i,l) {
								var findRes = arr_resource_wbs.filter(function (obj) {
									return (obj.ResourceId === resourceId && obj.WBSId === l.WBSId);
								});
								if (findRes.length > 0) {
									var iowrowid = parseInt($iowrowid.val()) + 1;
									$('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
									$iowrowid.val(iowrowid);
									wbscount++;
									console.log($('#iow_' + rowid + '_wbsname_' + iowrowid));
									$('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
									$('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
									$('#iow_' + rowid + '_qty_' + iowrowid).val(0000);
									$('#iow_' + rowid + '_qty_' + iowrowid).focus();
									$('#iow_' + rowid + '_expandWbs_' + iowrowid).show();

									//WBS Estimate
									var findwEst = data.estwbs.filter(function (obj) {
										return (obj.ResourceId === resourceId && obj.WBSId === l.WBSId);
									});
									if (findwEst.length > 0) {
										$.each(data.estwbs, function (i, p) {
											if(resourceId == p.ResourceId && l.WBSId == p.WBSId)
											{
												$('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
												$('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
												$('#iow_' + rowid + '_estwbsqty_' + iowrowid).html(p.EstimateQty);
												$('#iow_' + rowid + '_avawbsqty_' + iowrowid).html(p.AvailableQty);
												$('#iow_' + rowid + '_excesswbsqty_' + iowrowid).html(p.ExcessQty);
												$('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).html(p.BalReqQty);
												$('#iow_' + rowid + '_balpowbsqty_' + iowrowid).html(p.BalPOQty);
												$('#iow_' + rowid + '_totpurchasewbsqty_' + iowrowid).html(p.TotPurchase);
												$('#iow_' + rowid + '_isprojwbsqty_' + iowrowid).html(p.IsProj);
											}
										});
									} else {
										$('#iow_' + rowid + '_estwbsdetails_' + iowrowid).hide();
										$('#iow_' + rowid + '_estwbsarrow_' + iowrowid).hide();
									}
									//
								} else {
									$('#qty_' + rowid).attr('readonly',false);
									$('#qty_' + rowid).focus();
									$('#iow_'+rowid).hide();
									$('#spec_'+rowid).addClass('active');
									$('#iowTable_'+rowid).hide();
									$('#reqspeTable_'+rowid).show();
								}
	//                            if(wbscount == 0){
	//                                $('#qty_' + rowid).attr('readonly',false);
	//                                $('#qty_' + rowid).focus();
	//                            }
							});
						}
                    }
                    $('.loading_area').hide();
                }, error: function (jqXHR, textStatus, errorThrown) {
                    $('.loading_area').hide();
                }
            });
        }
        function addNewResourceRow(x,v) {
            var $tr = $(x).closest('tr');
            if ($tr.next('tr:not(.subTr)').length != 0)
                return;

            var $rowid = $('#rowid'),
                rowid = parseInt($rowid.val()),
                $tbody = $('#workorderTable').find('> tbody.main');

            $('#deleteTr_' + rowid).show();
            var count = rowid + 1,
                template = $('#resource-template').html();
            var resspectemplate=$('#resspec-template').html();

            $("#click_"+count).hide();

            var ccid=<?php echo (isset($CostCentre)) ? $CostCentre : '';?>;
            var rTransId=$('#requestTransIds').val();
            if($('#requestTransIds').val().length > 0)
            {
                $('#requestTransIds').val(rTransId+","+v);
                rTransId= $('#requestTransIds').val();
            }
            else
            {
                $('#requestTransIds').val(v);
                rTransId=$('#requestTransIds').val();
            }
            var arr_estdetails = <?php echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;
            $.ajax({
                type: "POST",
                url: getBaseURL()+'ats/index/entry-sample',
                data: "ccid="+ccid+"&resid="+v+"&reqTransIds="+ rTransId +"&Type=getresestdetails",
                dataType: "json",
                success: function(data){
                    arr_estdetails = data;
                    if(data != false) {
                        if(data["EstimateQty"] > 0 || data["EstimateQty"] < 0) {
                            $('#estqty_' + rowid).text('Estimate Qty:  ' + sanitizeNumber(data["EstimateQty"],3,true));
                        }
                        else
                        {
                            $('#estqty_' + rowid).text('Estimate Qty:  0');
                        }
                        if(data["AvailableQty"] > 0 || data["AvailableQty"] < 0) {
                            $('#avaqty_' + rowid).text('Available Qty:  ' + sanitizeNumber(data["AvailableQty"],3,true));
                        }
                        else
                        {
                            $('#avaqty_' + rowid).text('Available Qty:  0');
                        }
                        if(data["ExcessQty"] > 0 || data["ExcessQty"] < 0) {
                            $('#excessqty_' + rowid).text('Excess Qty:  ' + sanitizeNumber(data["ExcessQty"],3,true));
                        }
                        else
                        {
                            $('#excessqty_' + rowid).text('Excess Qty:  0');
                        }

                        if(data["BalReqQty"] > 0 || data["BalReqQty"] < 0) {
                            $('#balreqqty_' + rowid).text(data["BalReqQty"]);
                        }
                        else
                        {
                            $('#balreqqty_' + rowid).text(0);
                        }
                        if(data["BalPOQty"] > 0 || data["BalPOQty"] < 0) {
                            $('#balpoqty_' + rowid).text(data["BalPOQty"]);
                        }
                        else
                        {
                            $('#balpoqty_' + rowid).text(0);
                        }
                        if(data["TotPurchase"] > 0 || data["TotPurchase"] < 0) {
                            $('#totpurchase_' + rowid).text(data["TotPurchase"]);
                        }
                        else
                        {
                            $('#totpurchase_' + rowid).text(0);
                        }
                        if(data["IsProj"] > 0)
                        {
                            $('#isproj_' + rowid).text(data["IsProj"]);
                        }
                        else
                        {
                            $('#isproj_' + rowid).text(0);
                        }
                    }
                    else
                    {
                        $('#estqty_' + rowid).text('Estimate Qty: ' );
                        $('#avaqty_' + rowid).text('Available Qty: ' );
                        $('#excessqty_' + rowid).text('Excess Qty: ' );
                        $('#balreqqty_' + rowid).text(0);
                        $('#balpoqty_' + rowid).text(0);
                        $('#totpurchase_' + rowid).text(0);
                    }
                }
            });
            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            template = template.replace(/__/g, '_' + count);
            $tbody.append(template);
            $rowid.val(count);
            bindResourceAutocomplete();
            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            else{
                $("#click_"+count).show();
            }
        }
        function checkResourceUsed(x) {
            var id = $(x)[0].id.split('_')[1];
            var reskeyid = $('input[id*=resourceid_]');
            var itemkeyid=$('input[id*=itemid_]');

            tmp_arr_resources = arr_resources;
            tmp_arr_resources = $.grep(arr_resources, function (element, index) {
                var is_selected = true;
                $.each(reskeyid, function (i, obj) {

                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != id && itemkeyid[0].value != 0) {
                        if (element.data == $this.val() && itemkeyid[0].value == element.ItemId) {
                            is_selected = false;
                            return false;
                        }
                    }
                });
                return is_selected;
            });
            bindResourceAutocomplete();
        }
        function nextAccordian(id) {
            $('#panelheading-' + id).trigger('click');
        }
        function mShowtabs(type,id,event) {
            event.preventDefault();
            $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
            var rowid = id.split('_')[1];
            if (type=="wbs") {
                $('#iowTable_'+rowid).show();
                $('#reqspeTable_'+rowid).hide();

            } if(type == "reqspe") {
                $('#reqspeTable_'+rowid).show();
                $('#iowTable_'+rowid).hide();
            }
            return false;
        }
        function checkWbs(x){
            var rowid = $(x)[0].id.split('_')[1];
            var abc = $('#iow_' + rowid + '_rowid');
            var rfrom = $('#rfrom_' + rowid).val();
//        if(abc > 0){
//            $('#qty_' + rowid).attr('readonly',true);
//        }
//        else{
//            $('#qty_' + rowid).attr('readonly',false);
//        }
            //Estimate Qty Validation
            var eststr = $('#estqty_' + rowid).text();
            var eststr = $('#estqty_' + rowid).text().split(':');
            var estqty = eststr[1];
            var curQty = parseFloat($('#qty_' + rowid).val());
            var hiddenQty = parseFloat($('#hiddenqty_' + rowid).val());
            var breqqty = $('#balreqqty_' + rowid).text();
            var bpoqty = $('#balpoqty_' + rowid).text();
            var totpurchase= $('#totpurchase_' + rowid).text();
            var vqty = parseFloat($('#variantQty').val());

            if(estqty == 'undefined' || estqty == null) { estqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null) { hiddenQty=0; }
            if(breqqty == 'undefined' || breqqty == null) { breqqty=0; }
            if(bpoqty == 'undefined' || bpoqty == null) { bpoqty=0; }
            if(totpurchase == 'undefined' || totpurchase == null) { totpurchase=0; }

            var totqty = parseFloat(breqqty) + parseFloat(bpoqty) + parseFloat(totpurchase);
            estqty =  parseFloatVal(parseFloatVal(estqty) * ( 1 + vqty / 100));
            if(((totqty+curQty)-hiddenQty)  > estqty && rfrom == 'Project'){
                alert("Request quantity is greater than Estimate quantity");
                $('#qty_' + rowid).val(0);
                return false;
            }
            //


//    var ResourceId = $('#resourceid_' + rowid).val();
//    var estqty = $.grep(arr_estdetails,function(v) {
//       return v.ResourceId === ResourceId;
//    });
//    alert(estqty);

        }
        function calcQuantity(x) {
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];

            var iowrowid=ids[3];
            var rfrom = $('#rfrom_' + rowid).val();

            //Estimate Qty Validation
            var estqty = $('#iow_'+rowid+'_estwbsqty_' + iowrowid).text();
            var curQty = parseFloat($('#iow_'+rowid+'_qty_' + iowrowid).val());
            var hiddenQty = parseFloat($('#iow_'+rowid+'_hiddenqty_' + iowrowid).val());

            var breqqty = $('#iow_' + rowid + '_balreqwbsqty_' + iowrowid).text();
            var bpoqty = $('#iow_'+rowid+'_balpowbsqty_' + iowrowid).text();
            var totpurchase= $('#iow_'+rowid+'_totpurchasewbsqty_' + iowrowid).text();
            var vqty = parseFloat($('#variantQty').val());

            if(estqty == 'undefined' || estqty == null || estqty == '' || isNaN(estqty)) { estqty=0; }
            if(hiddenQty == 'undefined' || hiddenQty == null || hiddenQty == '' || isNaN(hiddenQty) == true ) { hiddenQty=0; }
            if(breqqty == 'undefined' || breqqty == null || breqqty == '' || isNaN(breqqty) ) { breqqty=0; }
            if(bpoqty == 'undefined' || bpoqty == null || bpoqty == '' || isNaN(bpoqty) ) { bpoqty=0; }
            if(totpurchase == 'undefined' || totpurchase == null || totpurchase == '' || isNaN(totpurchase) ) { totpurchase=0; }
            var totqty = parseFloat(breqqty) + parseFloat(bpoqty) + parseFloat(totpurchase);
            estqty = parseFloatVal(parseFloat(estqty) * (1+(vqty / 100)));

            if(((totqty+curQty)-hiddenQty)  > estqty && rfrom == 'Project'){
                alert("Request quantity is greater than Estimate quantity");
                $('#iow_'+rowid+'_qty_' + iowrowid).val(0);
                return false;
            }
            //
            // calc total qty
            var totalQty=0.0;
            $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
                var qty=0.0;
                if($(this).val() != '' || $(this).val().length != 0 )
                {
                    qty = $(this).val();
                }
                if(isNaN(qty))
                    qty = 0;

                totalQty = parseFloat(totalQty) + parseFloat(qty);
            });

            $('#qty_'+rowid).val(sanitizeNumber(totalQty, 3,true));

            // calc total amount
            var rate = parseFloatVal($('#rate_'+rowid).val());
            $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate));
            calcTotal();
        }
        function calcTotal() {
            var total = 0;
            $.each($('input[id^=amount_]'), function (i,o) {
                total += parseFloatVal($(this).val());
            });
            $('#total').val(sanitizeNumber(total,3,true));
        }
        function checkEstWbs(x) {
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowid = ids[3];
            var trowid = $('#iow_'+rowid+'_rowid');
            //tooltip show
            var estqty = "";
            var avaqty = "";
            var excessqty = "";
            estqty = $('#iow_' + rowid + '_estwbsqty_' + iowid).text();
            avaqty = $('#iow_' + rowid + '_avawbsqty_' + iowid).text();
            excessqty = $('#iow_' + rowid + '_excesswbsqty_' + iowid).text();
            //"1st line text" +"\n" + "2nd line text";
            $(x).attr('data-original-title',"Estimate Qty : " + sanitizeNumber(estqty,3,true) + "<br />" + "Available Qty : " + sanitizeNumber(avaqty,3,true) + "<br /> " + "Excess Qty : " + sanitizeNumber(excessqty,3,true) );
            $(x).tooltip('show');
            //
            for(var i=0; i<=trowid; i++) {
                if(i != iowid)
                {
                    $('#iow_' + rowid + '_estwbsarrow_' + i).hide();
                    $('#iow_' + rowid + '_estwbsdetails_' + i).hide();
                }
            }
            $('#iow_' + rowid + '_estwbsarrow_' + iowid).show();
            $('#iow_' + rowid + '_estwbsdetails_' + iowid).show();

        }
        function clickTr(val){
            var data = ($(val).attr('id')).split('_');
            var resourceId = $('#resourceid_' + data[1]).val();
            var itemId = $('#itemid_' + data[1]).val();
            var costCentreId = $('#CostCentre').val();
        }
        function deleteRow(x,e) {
            e.preventDefault();
            var rowid = $('#rowid').val();
            var $x = $(x),
                key = $x[0].className.split('_')[1];
            if (!confirm('Do you want to Delete'))
                return false;
            var $tr = $x.closest('tr');
            $tr.next('.subTr').remove();
            $tr.remove();
            //rowid -= 1;
            $('#rowid').val(rowid);

            bindResourceAutocomplete();

            //paging
            if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
                var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
                thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
                setTimeout(function () {
                    $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
                }, 100);
            }
            return false;
        }
        function stockReqDetails(x){

            var rowid = $(x)[0].id.split('_')[1];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();
            var  mode="getstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockReqModal").show();
                        $("#estimateQty").val(sdata['EstimateQty']);
                        $("#availableQty").val(sdata['AvailableQty']);
                        $("#excessQty").val(sdata['ExcessQty']);
                        $("#balanceRequest").val(sdata['BalReqQty']);
                        $("#balancePO").val(sdata['BalPOQty']);
                        $("#totalPurchase").val(sdata['TotPurchase']);
                        $("#requestQty").val(sdata['ReqQty']);
                        $("#poQty").val(sdata['POQty']);
                        $("#minQty").val(sdata['MinQty']);
                        $("#billQty").val(sdata['BillQty']);
                        $("#issueQty").val(sdata['IssueQty']);
                        $("#transferQty").val(sdata['TransferQty']);
                        $("#billreturnQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
        function stockWBSDetails(x){
            var $x = $(x);
            var ids = $x[0].id.split('_');
            var rowid = ids[1];
            var iowrowid = ids[3];
            var resourceid = $('#resourceid_' + rowid).val();
            var itemid = $('#itemid_' + rowid).val();
            var CostCenterId = $('#CostCentre').val();

            var WBSId = $('#iow_' + rowid + '_wbsid_' + iowrowid).val();

            var  mode="getwbsstockdetails";

            $.ajax({
                url: getBaseURL() + 'ats/index/entry-sample',
                type: "post",
                data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
                success: function (data, textStatus, jqXHR) {
                    if(jqXHR.status == 200) {
                        var sdata = JSON.parse(data);
                        $("#stockWBSModal").show();
                        $("#estimateWbsQty").val(sdata['EstimateQty']);
                        $("#availableWbsQty").val(sdata['AvailableQty']);
                        $("#excessWbsQty").val(sdata['ExcessQty']);
                        $("#balanceWbsRequest").val(sdata['BalReqQty']);
                        $("#balanceWbsPO").val(sdata['BalPOQty']);
                        $("#totalWbsPurchase").val(sdata['TotPurchase']);
                        $("#requestWbsQty").val(sdata['ReqQty']);
                        $("#poWbsQty").val(sdata['POQty']);
                        $("#minWbsQty").val(sdata['MinQty']);
                        $("#billWbsQty").val(sdata['BillQty']);
                        $("#billreturnWbsQty").val(sdata['ReturnQty']);
                    }
                }

            });
        }
    } // end of material and asset

    function validateLength($input) {
        if($.trim($input.val()).length == 0) {
            showError($input, 'required');
            return false;
        }
        removeError($input);
        return true;
    }
    function submitForm() {
        var bAns = true;

        var tCount =  $('#workorderTable tbody tr').length;
        if(tCount == 2){
            alert('Add Resource');
            bAns = false;
            return false;
        }
        var rowCountqty= parseInt($('#rowid').val()-1);
        for(var i=1;i<=rowCountqty;i++) {

            var checkDate = $('#reqdate_' + i).val();
            if(checkDate == ''){
                alert('Kindly choose the Required Date');
                if($('#panelheading-1').attr('aria-expanded')== 'true'){
                    $('.paging-nav').children('a[data-page=' + ((i)-1) + ']').trigger('click');
                    $('#reqdate_' + i).focus();
                    bAns = false;
                    return false;
                } else {
                    $('#accordion').children().find('#panelheading-1').trigger('click');
                    $('.paging-nav').children('a[data-page=' + ((i)-1) + ']').trigger('click');
                    $('#reqdate_' + i).focus();
                    bAns = false;
                    return false;
                }
            }
            if((parseFloatVal($('#qty_' + i).val()) == 0 || '') && parseInt($('#resourceid_' + i).val()) > 0 ) {
                alert('Kindly enter the Quantity or delete the unwanted resource');
				if($('#panelheading-1').attr('aria-expanded')== 'true'){
					$('.paging-nav').children('a[data-page=' + ((i)-1) + ']').trigger('click');
					$('#qty_' + i).focus();
                    bAns = false;
					return false;
				}else{
					$('#accordion').children().find('#panelheading-1').trigger('click');
					$('.paging-nav').children('a[data-page=' + ((i)-1) + ']').trigger('click');
					$('#qty_' + i).focus();
                    bAns = false;
					return false;
				}
            }
        }
        if(bAns == true) {
           $('#formWrapper').submit();
        }
    }
    function isqtyDecimal(evt, x) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (evt.key =="%") charCode=0;
        if (evt.key =="#") charCode=0;
        if (
            (charCode != 46 || $(element).val().indexOf('.') != -1) &&      // . CHECK DOT, AND ONLY ONE.
            (charCode < 48 || charCode > 57) && charCode!=39 && charCode!=37 && charCode!=8 && charCode!=35 && charCode!=9)
            return false;

        var rowid = $(x)[0].id.split('_')[1];
        var iowrowid=0;
        //var dWbs = parseInt($('#wbs_' + rowid + '_rowid').val())
        var reqDec = parseInt($('#iow_'+ rowid +'_rowid').val());

        if(reqDec > 0){
            $('#qty_' + rowid).attr('readonly',true);
        }
        else{
            $('#qty_' + rowid).attr('readonly',false);
        }
        return true;
    }

   $(document).ready(function() {
       $('.datepickerinput').datepicker({
           format: "dd-mm-yyyy",
           startDate: new Date(),
          // todayBtn: true,
           orientation: "top auto",
           autoclose: true
       }).on("changeDate", function(e){
           $("#dateSpan").text($(this).val());
       });
       $('.date_icon').click(function() {
           var input = $(this).parent().find('input').datepicker('show');
       });

        if('<?php echo (isset($approve)) ? $approve : '';?>' == 'Y')
        {
            $('#sub1').hide();
        }
        else if('<?php echo (isset($approve)) ? $approve : '';?>' == 'P')
        {
            $('#sub1').hide();
        }
        else{
            $('#sub1').show();
        }
    });
 $(document).ready(function(){
        $(".flip0").click(function(){
            $(".pane0").slideToggle("slow");
        });
    });
    function myFunction(x) {
        x.classList.toggle("change");
    }
</script>
