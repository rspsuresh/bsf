	<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />
	
	<style type="text/css">
	.jqx-widget-content{z-index:999 !important;}
	.mar_20{margin-top:20px!important;}
	.subDiv {background-color: #e7e9ec;border: 1px solid #ddd;float: left;margin-left: 2%;margin-top: 2px;position: relative;width: 98%;}
	.sub_tbl1 {color:#424141;font-weight: 600; background:#edefe2 !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
	.sub_tbl2{color: #424141;font-weight: 600; background: #efe2e2 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
	.sub_tbl3{color: #424141;font-weight: 600; background: #ceefe5 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
	.e_tex {border: 1px solid #ccc;font-size: 14px !important;height: 62px;padding: 5px;resize: none;width: 100%;border-radius:0px!important;}
	.sub_tab {background-color: #e7e9ec;border: 1px solid #ddd;float: left;margin-top: 2px;padding:8px;width:100%;}
	.table-responsive table.table tr td { padding: 10px !important;}
	.btnPrev:disabled {background-color:#ffffff;}
	.highlight{background-color:#eaecee;}
	.panel_heads {background: #e2ebef!important;}
	.blubg{background : #B0C3EB !important;}
	.card{margin-top:0% !important; margin-bottom:0px !important;}
	.top-30 { margin-top:20px!important;}

	</style>
<div class="container-fluid">
	<div class="row">
		<div class="col-lg-12 mar_20">
			<h1 style="margin-left:10px;">Request Detail</h1> 
		</div>
		<div class="col-lg-12">
			<div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear padlr0">
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CostCentreName">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status3">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-building-o fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CostCentreName; ?></div>
									<div class="cbhuge comnelips">Project Name</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="TypeName">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-cogs fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $TypeName; ?></div>
									<div class="cbhuge comnelips">Request Type</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="priority">
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $priority; ?></div>
									<div class="cbhuge comnelips">Request Priority</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="RequestDate">
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status2">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-calendar fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $RequestDate; ?></div>
									<div class="cbhuge comnelips">Requested Date</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="Approve">
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status5">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-registered fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $Approve; ?></div>
									<div class="cbhuge comnelips">Status</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="RequestNo">
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status6">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-gavel fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $RequestNo; ?></div>
									<div class="cbhuge comnelips">Request No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CCReqNo">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status7">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-usd fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CCReqNo; ?></div>
									<div class="cbhuge comnelips">CCRequest No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CReqNo">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status8">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-2">
									<i class="fa fa-share fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-10 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CReqNo; ?></div>
									<div class="cbhuge comnelips">CRequest No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-12 top-30">
				<div class="table-responsive">
					<!--Table 1-->
					<table id="decisionTable" class="table table-bordered tableView dataTable no-footer table-striped" style=" margin-bottom:0px;">
						<thead>
							<tr>
							<th  class="blubg">Code</th>
							<th  class="blubg">Resource</th>
							<th  class="blubg">Unit</th>
							<th  class="blubg">Quantity</th>
							<th  class="blubg">Req Date</th>
							<th  class="blubg">Remarks</th>
							<th  class="blubg">&nbsp;</th>
							</tr> 	
						</thead>
						<tbody class="main"></tbody>
						<tbody class="total">
						</tbody>
					</table>
					<input type="hidden" name="rowid" id="rowid" value="0"/>			
				</div>
			</div>
			<div class="col-lg-12">
				<div  id="nar">
					<div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads blubg">
						<h4 class="panel-title accordion-toggle">Narration</h4>
					</div>
					<div class="panel-collapse" id="collapseTwo" style="height: 0px;">
						<div class="panel-body bgcolr">
							<div class="clearfix"></div>
							<div class="col-lg-12">
								<div class="card">
									<div class="tab-pane" id="Note">
										<p>
										<div class="sub_tab" style="margin-bottom:12px; margin-top:12px;">
											<textarea class="exp-tex btnPrev" name="Narration" id="Narration" disabled><?php echo $Narration ?></textarea>
										</div>
										</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
	<div class="col-lg-12 savebtn_area">
		<ul>
			<li class="dropdown save_btn float_r">
				<a href="<?php echo $this->basePath();?>/ats/index/display-register" data-toggle="tooltip" class="ripple" title="Go to Register">Close</a>
			</li>
        </ul>
	</div> 		
<script id="resource-template"  type="text/template">
    <tr class="dont-hide">
        <td width="8%" class="" name="Code__" id="Code__"></td>
        <td width="22%" class="" name="ResourceName__" id="ResourceName__"></td>
        <td width="1%" class="" name="UnitName__" id="UnitName__"></td>
		<td width="1%" class="" name="Quantity__" id="Quantity__" style="text-align:right"></td>
        <td width="1%"  class="" name="ReqDateE__" id="ReqDateE__"></td>
        <td width="20%" class="" name="Remarks__" id="Remarks__"></td>
		<td width="1%" align="center" class="iow___requestfields">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr" id="expandTr__"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
	<tr class="subTr" id="total__" style="display:none">
		<td colspan="7" style="">
			<div class="col-lg-12 col-lg-offset-0 rdbt">
				<div class="card">
					<ul class="nav nav-tabs">
						<li  id="iow__" class="active"><a class="ripple has-ripple" id="wbsTabLink__" onclick="showtabs('wbs',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Wbs<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
						<li id= "spec__"class=""><a class="ripple has-ripple" id="reqspeTabLink__" onclick="showtabs('reqspe',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Resource Specification<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
					</ul>
				</div>
			</div>
			<div class=" div col-lg-12 clear">
				<div class="table-responsive sub_tab">
					<table class="table" style="margin-bottom:-4px; width:100%; margin-right:5px;" id="iowTable__" bgcolor="#00FF00">
						<thead class="">
						<tr>
							<th width="50%" class="worktype-activity sub_tbl3">WBS Name</th>
							<th width="50%" class="worktype-activity sub_tbl3" style="text-align:center">Quantity</th>
						</tr>
						</thead>
						<tbody class="main"></tbody>
						<tbody class="total">
						</tbody>
						<input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
					</table>
					<div class="tab-content">
						<div class="table-responsive topsp">
							<table class="table" style="margin-bottom:-4px; display: none;" id="reqspeTable__">

								<tbody class="main"></tbody>
								<tbody class="total">
								</tbody>

							</table>
						</div>
					</div>
				</div>
			</div>
		</td>
	</tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr>
        <td width="10%" style="" class="worktype-activity" name="iow___WbsName_0" id="iow___WbsName_0"></td>
        <td width="15%" name="iow___Quantity_0" id="iow___Quantity_0" style="text-align:center"></td>
		<input  type="hidden" name="iow___RequestAHTransId_0" id="iow___RequestAHTransId_0">
		<input  type="hidden" name="iow___Requesttransid_0" id="iow___Requesttransid_0">
	</tr>
</script>
<script id="resspec-template" type="text/template">
    <tr>
        <td width="100%" style="padding:0px!important;">
            <textarea class="exp-tex parent_txts newRow btnPrev"  name="resspec__" id="resspec__" disabled ></textarea>
        </td>
    </tr>
</script>
<script>
$(function () {
	var data1 =<?php echo json_encode($trans); ?>;
	var data2=<?php echo json_encode($anal); ?>;
	var template = $('#resource-template').html();
	var iowtemplate = $('#iow-template').html();
	var resspectemplate=$('#resspec-template').html();
	var rowid = 0;
	var $tbody = $('#decisionTable').find('> tbody.main');
	
	$.each(data1, function(i,o){ 
		rowid += 1;
		$tbody.append(template.replace(/__/g, '_' + rowid));
		$('#Code_' + rowid).html(o.Code);
		$('#ResourceName_' + rowid).html(o.ResourceName);
		$('#UnitName_' + rowid).html(o.UnitName);
		$('#Quantity_' + rowid).html(o.Quantity);
		$('#ReqDateE_' + rowid).html(o.ReqDateE);
		$('#Remarks_' + rowid).html(o.Remarks);
		$('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
		if(o.Specification==''|| o.Specification== null){
			$('#spec_'+rowid).hide();
			$('#resspec_'+rowid).hide();
		}
        $('#resspec_' + rowid).val(o.Specification);		
		/*Request*/
        var findRes = data2.filter(function(obj) {
            return (obj.Requesttransid === o.Requesttransid);
        });

        if(findRes.length > 0) {
            if (data2.length > 0) {
                $.each(data2, function (j, l) {
                    if ((l.Requesttransid != o.Requesttransid)) {
                        return;
                    }
                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    $('#iow_' + rowid + '_WbsName_' + iowrowid).html(l.WbsName);
                    $('#iow_' + rowid + '_Quantity_' + iowrowid).html(l.ReqQty);
                    $('#iow_' + rowid + '_RequestAHTransId_' + iowrowid).html(l.RequestAHTransId);
                    $('#iow_' + rowid + '_Requesttransid_' + iowrowid).html(l.Requesttransid);
                });
            }
        }
        else
        {
			if(o.Specification==''|| o.Specification== null){
				$('#expandTr_' + rowid).hide();
				//$('#Remarks_' + rowid).addClass('border-none');
			}
			//$('#expandTr_' + rowid).hide();
            $('#iowTable_'+rowid).hide();
			$('#iow_'+rowid).hide();
			$('#reqspeTable_'+rowid).show();
			$('#spec_'+rowid).addClass('active');
			
        }
	});
	var Narration= <?php echo json_encode ($Narration);?>;
	console.log(Narration);
	if(Narration == ''|| Narration == null) {
		$('#nar').hide();
	}
	$('.container-fluid').on('click','.mainTr',function(e){
	e.preventDefault();
		if(!$(this).closest("tr").next(".subTr").is(":visible")){
			$(this).closest("tr").next(".subTr").show('slow');
			$(this).closest("tr").next(".subTr").find(".div").slideDown("slow");
			$(this).find("i").addClass("tform");
		}
		else{
			$(this).closest("tr").next(".subTr").find(".div").slideUp("slow");
			$(this).closest("tr").next(".subTr").slideUp("slow");
			$(this).find("i").removeClass("tform");
		}
    });
});
function showtabs(type,id,event) {
	event.preventDefault();
	$('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
	var rowid = id.split('_')[1];
	if (type=="wbs") {
		$('#iowTable_'+rowid).show();
		$('#reqspeTable_'+rowid).hide();

	} else{
		$('#reqspeTable_'+rowid).show();
		$('#iowTable_'+rowid).hide();
	}
	return false;
}
var CostCentreName= <?php echo json_encode ($CostCentreName);?>;
var TypeName= <?php echo json_encode ($TypeName);?>;
var priority= <?php echo json_encode ($priority);?>;
var RequestDate= <?php echo json_encode ($RequestDate);?>;
var Approve= <?php echo json_encode ($Approve);?>;
var RequestNo= <?php echo json_encode ($RequestNo);?>;
var CCReqNo= <?php echo json_encode ($CCReqNo);?>;
var CReqNo= <?php echo json_encode ($CReqNo);?>;
if(CostCentreName == ''|| CostCentreName == null) {
	$('#CostCentreName').hide();
} 
if(TypeName == ''|| TypeName == null){
	$('#TypeName').hide();
} 
if(priority == ''|| priority == null){
	$('#priority').hide();
} 
if(RequestDate == ''|| RequestDate == null){
	$('#RequestDate').hide();
} 
if(Approve == ''|| Approve == null){
	$('#Approve').hide();
} 
if(RequestNo == ''|| RequestNo == null){
	$('#RequestNo').hide();
} 
if(CCReqNo == ''|| CCReqNo == null){
	$('#CCReqNo').hide();
} 
if(CReqNo == ''|| CReqNo == null){
	$('#CReqNo').hide();
}
</script>
