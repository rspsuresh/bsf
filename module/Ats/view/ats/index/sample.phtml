<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/wpm.css';?>"/>
<style type="text/css">
    #WorkTypeWrapper,
    #pref-details,
    #vendorServiceListWrapper {
        display: none;
    }
    .pagination-lg > li > a, .pagination-lg > li > span {
        font-size:15px !important;
        padding:5px 15px !important;
    }
    #WorkType + .select2,
    #vendorServiceList + .select2{
        width: 100% !important;
    }
    .fil-til h2		{font-weight:300!important;font-size:22px; color:#3f5fa2; padding-bottom: 20px; padding-left:0px !important; float:left;}
    .fil-til p		{font-weight:300!important;font-size:14px;color:#548301;padding-left:0px;float:left; padding-top: 13px;}
    .fil-til span	{font-weight:700!important;font-size:14px;color:#548301;padding-left:0px;float:left; padding-top: 16px; padding-left:5px;}
    .push_20		{margin-left:20px;}
    .push_15		{margin-left:15px;}
    .push_btm_20	{margin-bottom:20px !important;}
    .lbl_move		{height:40px !important;}
    .mar_tp			{margin-top:1%;}
    .filter-option	{margin-top:-5px !important;}
    /* Excel Floating Icon */
    .fixed-action-btn          	    {position:fixed;top:85px;right:5px;padding-top:15px;margin-bottom:0;z-index:998;}
    .fixed-action-btn:hover ul li a.btn-floating{transform: scaleY(1) scaleX(1) translateX(0px);opacity: 1;}
    .btn-floating.btn-large         {width:45px;height:45px;}
    .fixed-action-btn ul 			{left:-142px;right:0;text-align:center;position:absolute;margin:0;top:22px;}
    .fixed-action-btn ul li 		{margin-left:8px;list-style-type:none;float:left;}
    .fixed-action-btn ul li a.btn-floating {transform: scaleY(0.4) scaleX(0.4) translateX(40px);opacity: 0;}
    .fixed-action-btn ul a.btn-floating i  {font-size: 17px;line-height: 37px;}
    .btn-floating                   {display:inline-block;color:#fff;position:relative;overflow:hidden;z-index:1;width:37px;height:37px;line-height:37px;padding: 0;
        background-color: #26a69a;border-radius:50%;cursor:pointer;vertical-align: middle;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);text-decoration: none;transition: all .3s ease;
        -webkit-transition: all .3s ease; -moz-transition: all .3s ease; -o-transition: all .3s ease;}
    .btn-floating i                 {width: inherit;display: inline-block;text-align: center;color: #fff;font-size:20px;line-height: 45px; font-weight:normal; color:#fff;}
    .next-bt                        {text-align:center;}
    .next-bt a:hover                {border:1px solid #3580C4 !important; background:#fff !important; color:#3580C4 !important;}
    .next-bt a                      {background:#3580C4!important;border:1px solid #3580C4; border-radius: 4px;
        color:#fff!important; font-size:14px; padding: 5px 10px; text-align: center; transition: all 0.4s ease 0s;}
    .commargin_top 					{margin-top: 30px;}

    .jqx-grid-header {height:75px !important;}
	.jqx-grid-cell-alt {background: #6feee2 !important;}
    #jqxgrid									{min-height:200px !important;}
    .jqx-grid-groups-row						{padding-left:5px !important;}
    .jqx-grid-pager-input						{padding: 2px; text-align: center !important; width: 35px;}
    .jqx-dropdownlist-state-normal				{display: block;  float: right;height: 16px !important;margin-right: 7px;margin-top: 0;  padding-bottom: 2px !important;padding-top: 2px !important; width: 40px;}
    .jqx-button									{cursor: pointer;float: right;margin-right: 3px !important;margin-top: 0 !important;padding: 0 !important;width: 20px !important;}
    .jqx-button > .jqx-icon-arrow-left,
    .jqx-button >.jqx-icon-arrow-right			{height: 21px !important;margin-left: 0 !important;width: 20px !important;}
    .jqx-listitem-element						{height: 25px !important;}
    .jqx-input									{height: 25px !important; margin:2px 4px !important;}
    .jqx-grid-pager .jqx-grid-pager-input		{height:20px !important; margin:0px 4px !important;}
    #jqxgrid .jqx-grid-cell-right-align 		{text-align:right !important; padding-right:8px;}
    #jqxgrid .jqx-grid-cell-left-align 			{padding-left:8px;}
    .jqx-grid-column-menubutton::after			{left:4px;top:10px;}
    .yellowCell {background-color:#cbd9ef;}
	/*.clawCell {background-color:#8bece3;}*/
	.tri {margin-top:15px;}
	.tri_ul {float: left;margin-left: 30px;}
	.tri li {padding:1px 10px; display: inline-block;margin-right: 5px;background: #fff;border: 1px solid #000;border-radius: 6px;}
	.tri_label {color: #000;}
	.Eve{color:#ddd;}
	.Od{color:#uuu;}
	.tab {overflow: auto;-webkit-overflow-scrolling: touch;}
	/*@media only screen and (min-width : 320px) and (max-width : 767px) {
		.square {width: 12px !important;height: 12px !important;background: #fff;border:1px solid #000;border-radius:4px;display:inline-block;margin-right:10px;margin-top:18px;}
		.square1 {width: 12px !important;height: 12px !important;background:#cbd9ef;border:1px solid #000;border-radius:4px;display:inline-block;margin-right:10px;margin-top:18px;margin-left:10px;}
		.square_ul{float:left;margin-left:14px !important;}
		.square_label{color:#266aa8;font-size:14px !important;}
	}
	@media screen and (max-width: 640px) {
		.square {width: 12px !important;height: 12px !important;background: #fff;border:1px solid #000;border-radius:4px;display:inline-block;margin-right:10px;margin-top:18px;}
		.square1 {width: 12px !important;height: 12px!important;background:#cbd9ef;border:1px solid #000;border-radius:4px;display:inline-block;margin-right:10px;margin-top:18px;margin-left:10px;}
		.square_ul{float:left;margin-left:14px !important;}
		.square_label{color:#266aa8;font-size:14px !important;}
	}*/

</style>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqxgrid.grouping.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqxgrid.aggregates.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqx-all.js"></script>
<link rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/workorder.css"/>

<!--content-->
<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <form method="post" action="<?php echo $this->basePath(); ?>/ats/index/entry-sample"   id="formWrapper">
		<input type="hidden" name="requestTransIds" id="requestTransIds">
		<input type="hidden" name="itemTransIds" id="itemTransIds">
           <h1>Request Entry</h1>
            <div class="col-lg-12">
                <div class="col-lg-4 form-group">
                    <input type="text" class="form-control lbl_move"  placeholder="Request No." name="ReqNo" id="RequestNo" <?php if ($genType==true){ echo "readonly"; }?> value="<?php echo $vNo['voucherNo'];?>">
                    <div class="error_message" style="display:none;"><p>Please enter VoucherNo...</p> </div>
                </div>
                <div class="col-lg-4 form-group">
                    <select data-placeholder="Request Type"  data-toggle="tooltip" class="form-control single_dropdown lbl_move sortoption"  name="RequestType" id="RequestType" style="width:100%;">
                        <option value=""></option>
                        <option value="Activity">Activity</option>
                        <option value="Asset">Asset</option>
                        <option value="IOW">IOW</option>
                        <option value="Material">Material</option>
                        <option value="Service">Service</option>
                        <option value="TurnKey">TurnKey</option>
                    </select>
                </div>
                <div class="col-lg-4 form-group">
                    <span class="date_icon"><i class="fa fa-calendar"></i></span>
                    <input type="text" id="project_date" class="form-control lbl_move datepickerinput" name="ReqDate" value="<?php echo date('d-m-Y'); ?>" readonly />
                    <div class="error_message"><p>Please enter Request date...</p></div>
                </div>
                <div class="col-lg-4 form-group">
                    <select data-placeholder="Cost Centre" class="form-control single_dropdown lbl_move sortoption" name="CostCentre" id="CostCentre" style="width:100%;">
                        <option value=""></option>
                        <?php if(isset($arr_costcenter)):
                            foreach($arr_costcenter as $costcenter): ?>
                                <option value="<?php echo $costcenter['CostCentreId'];?>"><?php echo $costcenter['CostCentreName'];?></option>
                            <?php endforeach;
                        endif; ?>
                    </select>
                </div>
                <div class="col-lg-4 form-group">
                    <select class="form-control single_dropdown lbl_move sortoption" name="priority" id="priority" title="Choose priority..." style="width:100%;">
                        <option value="1">Low</option>
                        <option value="2" selected="true">Medium</option>
                        <option value="3">High</option>

                    </select>
                    <div class="error_message"><p>Please select the priority...</p></div>
                </div>
                <div class="col-lg-4 form-group">
                    <select class="form-control single_dropdown lbl_move sortoption" name="gridtype" id="gridtype" style="width:100%;" >
                        <option value="0" selected="true">Sequential View</option>
                        <option value="1">List View</option>
                    </select>
                    <div class="error_message"><p>Please select the priority...</p></div>
                </div>
                <div id="dservice" class="col-lg-4 form-group">
                    <select name="servicetype" id="servicetype" class="form-control single_dropdown lbl_move sortoption" data-placeholder="Service Type" style="width:100%;">
                        <option value="0" >Select Service Type</option>
                        <?php if(isset($arr_servicetype)):
                            foreach($arr_servicetype as $sertype): ?>
                                <option value="<?php echo $sertype['ServiceTypeId'];?>"><?php echo $sertype['ServiceTypeName'];?></option>
                            <?php endforeach;
                        endif; ?>
                    </select>
                </div>
            </div>
            <div class="col-lg-12 feed-bg mar_tp">
                <div class="fil-til push_btm_20">
                    <h2 class="h1-head">List of resources from the selected project.</h2>
                    <p class="h1-head push_15">Selected Resources</p>
                    <span class=" h1-head push_15" id="NoOfSelResource">0</span>
						<div class="tri">
							<ul class="tri_ul">
								<li><label class="tri_label">Project</label></li>
								<li style="background:#cbd9ef;"><label class="tri_label">Library</label></li>
							</ul>
						</div>
				</div>
                <div class="col-lg-12 clear">
                    <div class="table-responsive clear">
                        <div style='margin-top:10px;' id="resourceGrid"></div>
                    </div>
                </div>
            </div>
            <div id="requestTransInputsWrapper" class="hide"></div>
            <input type="hidden" name="frm_index" value="1"/>
        </form>
    </div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li id="continueButton" class="dropdown save_btn float_r">
            <a href="javascript:void(0);" onclick="validateOnSubmit();" data-toggle="tooltip" class="ripple" title="Continue to Next">Continue</a>
        </li>
        <li class="dropdown save_btn float_r"><a href="<?php echo $this->basePath() . '/ats/index/sample';?>" class="ripple" data-toggle="tooltip" title="Go to Cancel this Request">Cancel</a></li>
    </ul>
</div>

<script type="text/template" id="request-template">
    <div class="col-md-3">
        <div class="three-box hvr-overline-from-center request-box">
            <ul data-id="{{RequestId}}">
                <li><span>Request No</span>:&nbsp;{{RequestNo}}</li>
                <li><span>Cost Centre</span>:&nbsp;{{CostCentreName}}</li>
                <li><span>Approved On</span>:&nbsp;{{RequestDate}}</li>
            </ul>
            <span class="high-lit">R</span>
        </div>
    </div>
</script>
<script>
$(document).ready(function() {
  $('#dservice').hide();
});
var sel_resource_count = 0;
var tmpLocalData = [];
var $resourceGrid = $("#resourceGrid");
var $searchRequestNo = $('#searchRequestNo');
var resourceSource = {
    localdata: [],
    dataType: "json",
    dataFields: [
       // { name: 'Include', type: 'boolean' },
        { name: 'ResourceId', type: 'int' },
        { name: 'RFrom', type: 'string' },
        { name: 'Code', type: 'string' },
        { name: 'ResourceName', type: 'string' },
        { name: 'ItemId', type: 'string' },
        { name: 'Quantity', type: 'string' },
        { name: 'RequestNo', type: 'string' },
        { name: 'RequestDate', type: 'string' },
        { name: 'RequestId', type: 'int' }
    ],
    id: 'RequestTransId'
};
var resourceAdapter = new $.jqx.dataAdapter(resourceSource);
var cellclassname = function (row, column, value, data) {
    var val = $('#resourceGrid').jqxGrid('getcellvalue', row, "RFrom");
    if (val == 'Library') {
        return "yellowCell";
    }
	else{ 
	return "clawCell";
	}
};

$(document).on('focus', '.select2', function() {
    $(this).siblings('select').select2('open');
});

$(function () {
    $("#RequestNo").focus();
    $('#CostCentre').on('change',function(){ 
        $searchRequestNo.val('');
        var rtype = $('#RequestType').val();
        if(rtype == 'TurnKey') {
         bindTurnKey();
        } else {
            bindRequests();
        }
    });

    $('#RequestType').on('change',function(){
        $searchRequestNo.val('');

        if($(this).val() == 'service') {
            $('#vendorServiceListWrapper').show();
            $('#vendorServiceList').prop('disabled', false);

            $('#vendorContractListWrapper').hide();
            $('#vendorContractList').prop('disabled', true);
        } else {
            $('#vendorServiceListWrapper').hide();
            $('#vendorServiceList').prop('disabled', true);

            $('#vendorContractListWrapper').show();
            $('#vendorContractList').prop('disabled', false);
        }

        var rtype = $('#RequestType').val();
        if(rtype == 'TurnKey')
        {
            bindTurnKey();
        }
        else {
            bindOtherRequest();
        }
    });

//    $('#WorkType').on('change',function(){
//        $searchRequestNo.val('');
//        var rtype = $('#RequestType').val();
//        if(rtype == 'TurnKey')
//        {
//            bindTurnKey();
//        }
//        else {
//            bindOtherRequest();
//        }
//    });

    $('#servicetype').on('change',function(){
       $searchRequestNo.val('');
        var rtype = $('#RequestType').val();
        if(rtype == 'TurnKey')
        {
            bindTurnKey();
        }
        else {
            bindOtherRequest();
        }
    });

    $resourceGrid.jqxGrid({

        width: "100%",
        source: resourceAdapter,
        pageable: true,
        pagerMode: 'advanced',
        selectionMode: 'checkbox',
        pagerHeight: 40,
        rowsheight:40,
        autoheight: true,
        pagerButtonsCount: 8,
        sortable: true,
        editable: true,
        filterable: true,
        altrows: false,
        enabletooltips: true,
        showfilterrow: true,
        showaggregates: true,
        autorowheight: true,
        keyboardnavigation: true,

        columns: [
            { dataField: 'RequestTransId', hidden: true},
            { dataField: 'RequestId', hidden: true},
            { dataField: 'RFrom', hidden: true},
           // { text: '', dataField: 'Include', columntype: 'checkbox', align:'center',width:'15%',cellclassname: cellclassname},
            { text: 'Code', dataField: 'Code', editable:false,cellclassname: cellclassname,width:'20%'},
            { text: 'Description', dataField: 'ResourceName', editable:false,cellclassname: cellclassname,width:'77%'}
        ]

    });
	
    $("#resourceGrid").jqxGrid('showgroupsheader', false);
    $resourceGrid.on('cellvaluechanged', function (event) {
        var args = event.args;
        var datarow = $resourceGrid.jqxGrid('getrowdata', args.rowindex);
        if(args.newvalue === true)
            sel_resource_count++;
        else
            sel_resource_count--;
        $('#NoOfSelResource').html(sel_resource_count);
       // generateSelResourceInputs();
    });

    // $('#RequestType').on('change', function () {
        // if($(this).val() == 'work') {
            // $('#WorkTypeWrapper').show();
        // } else {
            // $('#WorkTypeWrapper').hide();
        // }
    // });
    // request check and uncheck
    $('#requestWrapper').on('click','.request-box', function () { 
        $(this).toggleClass('selected');
        renderSelectedResources();
    });
    // search by request no.
    $searchRequestNo.on('keyup', function () {
        var requestNo = $.trim($(this).val());
        if(requestNo.length != 0 && tmpLocalData.length != 0) {
            var filtered_data = $.grep(tmpLocalData, function (o) {
                return new RegExp('^'+requestNo,'gi').test(o.RequestNo);
            });
            renderRequests(filtered_data);
        } else {
            renderRequests(tmpLocalData);
        }
    });
    // vendor select2
    $(".single_dropdown_vendor").select2({
        placeholder: "",
        templateResult: formatState,
        templateSelection: formatState,
        allowClear: true
    });
});

function bindOtherRequest() {
    $resourceGrid.jqxGrid({

        width: "100%",
        source: resourceAdapter,
        pageable: true,
        pagerMode: 'advanced',
        selectionMode: 'checkbox',
        pagerHeight: 40,
        rowsheight:40,
        autoheight: true,
        pagerButtonsCount: 8,
        sortable: true,
        editable: true,
        altrows: false,
        enabletooltips: true,
        showfilterrow: true,
        filterable: true,
        showaggregates: true,
        autorowheight: true,
        keyboardnavigation: true,
        columns: [
            { dataField: 'RequestTransId', hidden: true},
            { dataField: 'RequestId', hidden: true},
            { dataField: 'RFrom', hidden: true},
            // { text: '', dataField: 'Include', columntype: 'checkbox', align:'center',width:'15%',cellclassname: cellclassname},
            { text: 'Code', dataField: 'Code', editable:false,cellclassname: cellclassname,width:'20%'},
            { text: 'Description', dataField: 'ResourceName', editable:false,cellclassname: cellclassname,width:'77%'}
        ]
    });

    $("#resourceGrid").jqxGrid('showgroupsheader', false);
    $resourceGrid.on('cellvaluechanged', function (event) {
        var args = event.args;
        var datarow = $resourceGrid.jqxGrid('getrowdata', args.rowindex);
        if(args.newvalue === true)
            sel_resource_count++;
        else
            sel_resource_count--;
        $('#NoOfSelResource').html(sel_resource_count);
        // generateSelResourceInputs();
    });

    // $('#RequestType').on('change', function () {
    // if($(this).val() == 'work') {
    // $('#WorkTypeWrapper').show();
    // } else {
    // $('#WorkTypeWrapper').hide();
    // }
    // });
    // request check and uncheck
    $('#requestWrapper').on('click','.request-box', function () {
        $(this).toggleClass('selected');
        renderSelectedResources();
    });
    // search by request no.
    $searchRequestNo.on('keyup', function () {
        var requestNo = $.trim($(this).val());
        if(requestNo.length != 0 && tmpLocalData.length != 0) {
            var filtered_data = $.grep(tmpLocalData, function (o) {
                return new RegExp('^'+requestNo,'gi').test(o.RequestNo);
            });
            renderRequests(filtered_data);
        } else {
            renderRequests(tmpLocalData);
        }
    });
    // vendor select2
    $(".single_dropdown_vendor").select2({
        placeholder: "",
        templateResult: formatState,
        templateSelection: formatState,
        allowClear: true
    });

bindRequests();
}

function bindTurnKey() {
    $resourceGrid.jqxGrid({

        width: "100%",
        source: resourceAdapter,
        pageable: true,
        pagerMode: 'advanced',
        selectionMode: 'checkbox',
        pagerHeight: 40,
        rowsheight:40,
        autoheight: true,
        pagerButtonsCount: 8,
        sortable: true,
        editable: true,
        altrows: false,
        enabletooltips: true,
        showfilterrow: true,
        filterable: true,
        showaggregates: true,
        autorowheight: true,
        keyboardnavigation: true,


        columns: [
            { dataField: 'RequestTransId', hidden: true},
            { dataField: 'RequestId', hidden: true},
            { dataField: 'RFrom', hidden: true},
            // { text: '', dataField: 'Include', columntype: 'checkbox', align:'center',width:'15%',cellclassname: cellclassname},
            { text: 'Parent Text', dataField: 'Code', editable:false,cellclassname: cellclassname,width:'50%'},
            { text: 'WBS Name', dataField: 'ResourceName', editable:false,cellclassname: cellclassname,width:'47%'}
        ]

    });

    $("#resourceGrid").jqxGrid('showgroupsheader', false);
    $resourceGrid.on('cellvaluechanged', function (event) {
        var args = event.args;
        var datarow = $resourceGrid.jqxGrid('getrowdata', args.rowindex);
        if(args.newvalue === true)
            sel_resource_count++;
        else
            sel_resource_count--;
        $('#NoOfSelResource').html(sel_resource_count);
        // generateSelResourceInputs();
    });

    // $('#RequestType').on('change', function () {
    // if($(this).val() == 'work') {
    // $('#WorkTypeWrapper').show();
    // } else {
    // $('#WorkTypeWrapper').hide();
    // }
    // });
    // request check and uncheck
    $('#requestWrapper').on('click','.request-box', function () {
        $(this).toggleClass('selected');
        renderSelectedResources();
    });
    // search by request no.
    $searchRequestNo.on('keyup', function () {
        var requestNo = $.trim($(this).val());
        if(requestNo.length != 0 && tmpLocalData.length != 0) {
            var filtered_data = $.grep(tmpLocalData, function (o) {
                return new RegExp('^'+requestNo,'gi').test(o.RequestNo);
            });
            renderRequests(filtered_data);
        } else {
            renderRequests(tmpLocalData);
        }
    });
    // vendor select2
    $(".single_dropdown_vendor").select2({
        placeholder: "",
        templateResult: formatState,
        templateSelection: formatState,
        allowClear: true
    });
    bindRequests();
}

function formatState (state) {
    if (!state.id) { return state.text; }
    var $state = $('<span class="img-select"><img src="<?php echo $this->basePath() . '/images/avatar.jpg';?>" class="img-flag" /> ' + state.text + '</span>');
    return $state;
}

function bindRequests() {
    var costCentreId = $('#CostCentre').val();
    var RequestType = $('#RequestType').val();
    var priority = $('#priority').val();
  //  var workType = $('#WorkType').val();
    var servicetype = $('#servicetype').val();

    if(costCentreId == 0 || RequestType == 0){
		$("#resourceGrid").jqxGrid('clear');
		return;
	}
    $.ajax({
        url:getBaseURL()+'ats/index/sample',
        type:"post",
        data:{'CostCentreId':costCentreId, 'RequestType': RequestType,'ServiceType':servicetype, 'priority': priority},
        dataType:"json",
        success:function(data, textStatus, jqXHR){
            if(jqXHR.status == 200) {
                renderRequestResources(data.resources);
            }
        }
    });
}

// function renderRequests(data) {
    // var $requestWrapper = $('#requestWrapper');
    // if(data.length == 0) {
        // $requestWrapper.html('<p style="text-align: center;padding-top: 88px;">No data to display.</p>');
    // } else {
        // var template = $('#request-template').html();
        // $requestWrapper.html('');
        // $.each(data, function (i,o) {
            // $requestWrapper.append(template.replace(/\{\{RequestNo\}\}/g,o.RequestNo)
                // .replace(/\{\{CostCentreName\}\}/g,o.CostCentreName)
                // .replace(/\{\{RequestDate\}\}/g,o.RequestDate)
                // .replace(/\{\{RequestId\}\}/g,o.RequestId));
        // });
    // }
// }

function renderRequestResources(data) {
    resourceSource.localdata = data;
    resourceAdapter.dataBind();
}
$('#resourceGrid').on('rowselect', function (event){
	var index = $("#resourceGrid").jqxGrid("getselectedrowindexes");
	$('#NoOfSelResource').html(index.length);
});	
$('#resourceGrid').on('rowunselect', function (event){
	var index = $("#resourceGrid").jqxGrid("getselectedrowindexes");
	$('#NoOfSelResource').html(index.length);
});	
$('#resourceGrid').on('rowclick', function (event){
	var args = event.args;
	var boundIndex = args.rowindex;
	var index = $('#resourceGrid').jqxGrid('selectedrowindexes'); 
	if($.inArray(boundIndex, index) == -1)
		$('#resourceGrid').jqxGrid('selectrow', boundIndex);
    else
		$('#resourceGrid').jqxGrid('unselectrow', boundIndex);
});	
// function renderSelectedResources() {
    // var $selRequests = $('.request-box.selected');
    // $('#NoOfSelRequest').html($selRequests.length);

   // select resources in grid
    // if($selRequests.length != 0) {
        // var arr_requestIds = [];
        // $.each($selRequests, function (i, o) {
            // var requestId = $(this).find('ul[data-id]').attr('data-id');
            // arr_requestIds.push(requestId);
        // });

        // $.each(resourceSource.localdata, function (j, r) {
            // if ($.inArray(r.RequestId, arr_requestIds) != -1) {
                // r.Include = '1';
                // sel_resource_count++;
                // return;
            // }

            // r.Include = '0';
        // });
    // } else {
        // $.each(resourceSource.localdata, function (j, r) {
            // r.Include = '0';
        // });
        // sel_resource_count = 0;
    // }
    // $('#NoOfSelResource').html(sel_resource_count);
    // resourceAdapter.dataBind();
    // generateSelResourceInputs();
// }

// function generateSelResourceInputs() {
    // var rows = $resourceGrid.jqxGrid('getrows');
    // var $inputs = '';
    // for(var i = 0; i < rows.length; i++) {
        // var row = rows[i];
        // if (row.Include === true) {
            // $inputs += '<input type="hidden" name="requestTransIds[]" class="requestTransIds" value="' + row.ResourceId + '"/>';
            // $inputs += '<input type="hidden" name="itemTransIds[]" class="itemTransIds" value="' + row.ItemId + '"/>';
        // }
    // }

    // $('#requestTransInputsWrapper').html($inputs);
// }
//function showError($input, msg) {
//    $input.addClass('error').attr('data-original-title', msg).attr('data-toggle', 'tooltip');
//    $input.tooltip('show');
//}
function validateOnSubmit() {
    if($('#RequestType').val() == '') {
        var id = $('#RequestType');
        showError(id, 'RequestType is required!');
        $(this).focus();
        return false;
    }
    else {
        removeError($('#RequestType'));
    }
    if($('#CostCentre').val() == '') {
        var id1 = $('#CostCentre');
        showError(id1, 'CostCentre is required!');
        $(this).focus();
        return false;
    }
    else {
        removeError($('#CostCentre'));
    }
    if($('#RequestType').val() != 'service' && $('#vendorContractList').val() == '') {
        alert('Please select Vendor');
        return false;
    }

    if($('#RequestType').val() == 'service' && $('#vendorServiceList').val() == '') {
        alert('Please select Vendor');
        return false;
    }

    if($('#priority').val() == -1) {
        alert('Please select priority');
        return false;
    }


    // if($('#NoOfSelResource').html() == 0) {
        // alert('Please select resources');
        // return false;
    // }
	var index = $('#resourceGrid').jqxGrid('getselectedrowindex');
	if(index==-1){
		alert('Please select atleast one resource to proceed further')
	}
	else{
		requestTransIds=[];
		itemTransIds=[];
		var index = $("#resourceGrid").jqxGrid("getselectedrowindexes");
		for(var i in index){
			var data =$("#resourceGrid").jqxGrid("getrowdata", index[i]);
			console.log(data);
			requestTransIds.push(data.ResourceId);
			itemTransIds.push(data.ItemId);
		}
		$("#requestTransIds").val(requestTransIds);				
		$("#itemTransIds").val(itemTransIds);		
		$('#formWrapper').submit();
	}
}
$('.datepickerinput').datepicker({
    format: "dd-mm-yyyy",
    startDate: new Date(),
   // todayBtn: true,
    orientation: "top auto",
    autoclose: true
});
$('.date_icon').click(function() {
    var input = $(this).parent().find('input').datepicker('show');
});

$('#RequestType').change(function() {

    var rtype = $(this).val();
    if(rtype == 'Service')
    {
        $('#dservice').show();
    }
    else
    {
        $('#dservice').hide();
    }
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/purchase/order-entry',
//        data: "ptypeId="+ptypeId+"&Type=selectAccount",
//        dataType: "json",
//        success: function(data){
//            $("#account_type").html('');
//            $("#account_type").append("<option value='0'>Select Account Type</option>");
//            $.each(data['resultAcc'], function(i,v){
//                $("#account_type").append("<option value='"+v.data+"'>"+v.value+"</option>");
//            });
//            $("#account_type").select2('refresh');
//        }
//
//    });
});

</script>