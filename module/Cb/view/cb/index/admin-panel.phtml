<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/workorder.css';?>" />
<style>
#treeGrid .jqx-grid-header {
	height:75px !important;
}
</style>
<div class="content_wrapper padlr0">
	<div class="container-fluid padlr0">
		<div class="col-lg-12">
			<div class="col-lg-12">
				<div class="row">
					<div class="col-lg-6">
						<h1>Subscribers</h1>
					</div>
				</div>
			</div>
			<div class="col-lg-12 clear top08">
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon"><i class="fa fa-thumbs-o-up"></i></div>
						<div class="status">
							<h4>50</h4>
							<span>New Orders</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon use-r"><i class="fa fa-users"></i></div>
						<div class="status">
							<h4>1000</h4>
							<span>Users</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon clie-en"><i class="fa fa-male"></i></div>
						<div class="status">
							<h4>35</h4>
							<span>Clients</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon total-sa"><i class="fa fa-floppy-o"></i></div>
						<div class="status">
							<h4>150</h4>
							<span>Total Sales</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon use-new"><i class="fa fa-tags"></i></div>
						<div class="status">
							<h4>258</h4>
							<span>Product View</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon profi"><i class="fa fa-inr"></i></div>
						<div class="status">
							<h4>562223</h4>
							<span>Profit</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon dali-vi"><i class="fa fa-bar-chart"></i></div>
						<div class="status">
							<h4>56</h4>
							<span>Daily Visits</span>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
					<div class="panelbodys">
						<div class="dsc-icon yer-grwo"><i class="fa fa-random"></i></div>
						<div class="status">
							<h4>75%</h4>
							<span>Year Growth</span>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-12 padlr0 tmss commargin_top clear">
				<div class="table-responsive clear">
					<div id="treeGrid"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--Edit Confirmation Modal-->
<div class="modal fade" id="EditModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times-circle-o clpot"></i></button>
				<h1>Edit</h1>
			</div>
			<div class="modal-body">
				<div class="padlr0">
					<div class="container-fluid">
						<div class="">
							<div class="col-lg-12 commargin_top_20">
								<form class="form-horizontal" id="editForm">
									<input type="hidden" name="subscriberId" id="subscriberId" class="form-control" />
									<input type="hidden" name="csrf" value="<?php echo isset($csrf)?$csrf:''; ?>">
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="businessName" name="businessName" class="form-control lbl_move" label="Business Name" readonly />
										</div>
									</div>
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="address" name="address" class="form-control lbl_move" label="Address" readonly />
										</div>
									</div>
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="city" name="city" class="form-control lbl_move" label="City" readonly />
										</div>
									</div>
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="email" name="email" class="form-control lbl_move" label="Email" readonly />
										</div>
									</div>
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="mobile" name="mobile" class="form-control lbl_move" label="Mobile" readonly />
										</div>
									</div>
									<div class="row">
										<div class="form-group req_flds col-lg-12">
											<input type="text" id="numberOfUsers" name="numberOfUsers" class="form-control lbl_move" label="Number Of Users" readonly />
										</div>
									</div>
									<div class="row">
										<div class="radio_check">
											<p>
												<input type="checkbox" id="isActive" name="isActive" value="0" />
												<label class="ripple" for="isActive">Unsubscribe</label>
											</p>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<div class="commargin_top commargin_bottom">
					<a href="#" data-dismiss="modal" aria-hidden="true" class="md_cance">Cancel</a>
					<a href="#" id="btnEditYes" class="md_ok">Update</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
var data = <?php echo (isset($subscribers)) ? json_encode($subscribers) : '' ?>,
	$treeGrid = $("#treeGrid"),
	$editModal = $('#EditModal'),
	$editForm = $('#editForm'),
	$businessName = $('#businessName'),
	$address = $('#address'),
	$city = $('#city'),
	$email = $('#email'),
	$mobile = $('#mobile'),
	$numberOfUsers = $('#numberOfUsers'),
	$isActive = $('#isActive');

$(function () {
	var source = {
		localdata:data,
		dataType: "json",
		dataFields: [
			{ name: 'SubscriberId', type: 'number' },
			{ name: 'IsActive', type: 'number' },
			{ name: 'BusinessName', type: 'string' },
			{ name: 'Address', type: 'string' },
			{ name: 'CityName', type: 'string' },
			{ name: 'Email', type: 'string' },
			{ name: 'Mobile', type: 'string' },
			{ name: 'NumberOfUsers', type: 'number' }
		],
		id: 'SubscriberId'
	};

	var dataAdapter = new $.jqx.dataAdapter(source);
	$treeGrid.jqxGrid({
		width: "100%",
		source: dataAdapter,
		sortable: true,
		pagerButtonsCount: 6,
		filterable:true,
		pageable:true,
		rowDetails: true,
		autoheight: true,
		selectionmode: 'singlerow',
		showfilterrow: true,
		editable: false,
		altrows: true,
		enabletooltips: true,
		showfilterrow: true,
		columns: [
			{ text: 'SubscriberId', datafield: 'SubscriberId', hidden: true, filterable: false},
			{ text: 'IsActive', datafield: 'IsActive', hidden: true, filterable: false},
			{ text: 'BusinessName', dataField: 'BusinessName'},
			{ text: 'Address', dataField: 'Address'},
			{ text: 'City', dataField: 'CityName'},
			{ text: 'Email', dataField: 'Email'},
			{ text: 'Mobile', dataField: 'Mobile'},
			{ text: 'Number Of Users', dataField: 'NumberOfUsers'},
			{ text: 'Action', sortable: false, filterable: false, align: 'center',
				cellsrenderer: function (row) {
					var editLink = '<a title="Edit" href="javascript: subscriberEdit('+row+')" style=" padding-left:40%;"><i class="fa fa-pencil-square-o reg-icon"></i></a>';
					return editLink;
				}
			}
		]
	});
	
	$('#btnEditYes').on('click', function () {
		var businessName = $businessName.val();
		var address = $address.val();
		var city = $city.val();
		var email = $email.val();
		var mobile = $mobile.val();
		var numberOfUsers = $numberOfUsers.val();
		var isActive = $isActive.val();
		
		$editModal.modal('hide');
		var rowData = $treeGrid.jqxGrid('getrowdata', $editModal.data('row'));
		$.ajax({
			url: getBaseURL() + 'cb/index/edit-subscriber',
			type: 'POST',
			data: $editForm.serialize(),
			success:function(data, textStatus, jqXHR){
				if (jqXHR.status == 200){
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'BusinessName', businessName);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'Address', address);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'CityName', city);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'Email', email);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'Mobile', mobile);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'NumberOfUsers', numberOfUsers);
					$treeGrid.jqxGrid("setcellvalue", $editModal.data('row'), 'IsActive', isActive);
				} else {
					alert('Failed to Edit the Subscriber!');
				}
			},
			error:function(jqXHR, textStatus, errorThrown){
				if (jqXHR.status == 403)
					alert(jqXHR.responseText);
				else
					alert(textStatus+"-----"+errorThrown);
			}
		});
	});
});

function subscriberEdit(row)
{
	var rowData = $treeGrid.jqxGrid('getrowdata', row);
	$editModal.data('row', row).modal('show');
	$businessName.val(rowData.BusinessName);
	$businessName.trigger('change');
	$address.val(rowData.Address);
	$address.trigger('change');
	$city.val(rowData.CityName);
	$city.trigger('change');
	$email.val(rowData.Email);
	$email.trigger('change');
	$mobile.val(rowData.Mobile);
	$mobile.trigger('change');
	$numberOfUsers.val(rowData.NumberOfUsers);
	$numberOfUsers.trigger('change');
	if(rowData.IsActive == 0) {
		$isActive.prop('checked', true);
	} else if(rowData.IsActive == 1) {
		$isActive.prop('checked', false);
	}
	$('#subscriberId').val(rowData.SubscriberId);
}
</script>