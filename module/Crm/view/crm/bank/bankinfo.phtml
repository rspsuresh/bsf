<style xmlns="http://www.w3.org/1999/html">
    .btn_clr {
        margin-top: 2px;
        padding: 2px 6px;
        background: #fff;
        border: 1px solid #3f6ac3;
        border-radius: 25px;
        color: #3f6ac3;
</style>


<form method="post" id="formWrapper" >
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1>Bank Details</h1>
        </div>
        <div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
            <div class="row">
                <div class="form-group col-lg-12" style="position: relative;">
                    <select name="bankname" id="bankname" class="form-control selectpicker show-tick" data-size="5" title="Bank Name">
                        <option value=""></option>
                        <?php if(isset($arr_bank)):
                            foreach($arr_bank as $bank): ?>
<!--                                <option value="--><?php //echo $bank['BankId'];?><!--">--><?php //echo $bank['BankName'];?><!--</option>-->
                                <option value="<?php echo $bank['BankId']; ?>" <?php echo ( (isset($bankid) && $bank['BankId'] == $bankid) ) ? 'selected' : ''; ?>><?php echo $bank['BankName']; ?></option>
                            <?php endforeach;
                        endif; ?>
                    </select>
                </div>
                <div class="btn pop" style="position: absolute;">
                    <button class="btn_clr" button type="button" data-toggle="modal" data-target="#myModal">
                        <span class=""><i class="fa fa-file-o"></i></span>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="form-group req_flds col-lg-12">
                    <input type="text" class="form-control lbl_move" label="Branch" name="branch" id="branch" value="<?php echo (isset($branchname)) ? $branchname : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group req_flds col-lg-12">
                    <input type="text" class="form-control lbl_move" label="Address 1" name="address1" id="address1" value="<?php echo (isset($address1)) ? $address1 : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-12">
                    <input type="text" class="form-control lbl_move" label="Address 2" name="address2" value="<?php echo (isset($address2)) ? $address2 : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group req_flds col-lg-12" style="position: relative;">
                    <select name="city" id="city" class="form-control selectpicker show-tick" data-size="5" title="City">
                        <option value="Select City"></option>
                        <?php if(isset($arr_city)):
                            foreach($arr_city as $city): ?>
<!--                                <option value="--><?php //echo $city['CityId'];?><!--">--><?php //echo $city['CityName'];?><!--</option>-->
                                <option value="<?php echo $city['CityId']; ?>" <?php echo ( (isset($cityid) && $city['CityId'] == $cityid) ) ? 'selected' : ''; ?>><?php echo $city['CityName']; ?></option>
                            <?php endforeach;
                        endif; ?>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move" id="state" label="State" name="state" value="<?php echo (isset($state)) ? $state : ''; ?>" >
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move" label="Country" name="country" id="country" value="<?php echo (isset($country)) ? $country : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group req_flds col-lg-12">
                    <input type="text" class="form-control lbl_move" maxlength="6" onkeypress="return isDecimal(event,this)" label="Pincode" name="pincode" id="pincode" value="<?php echo (isset($pincode)) ? $pincode : ''; ?>">
                </div>
            </div>

            <div class="row">
                <div class="form-group req_flds col-lg-12">
                    <input type="text" class="form-control lbl_move" onkeypress="return isDecimal(event,this)" label="Mobile" name="mobile" id="mobile" value="<?php echo (isset($mobile)) ? $mobile : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-12">
                    <input type="text" class="form-control lbl_move" onkeypress="return isDecimal(event,this)" label="Phone" name="phone" value="<?php echo (isset($phone)) ? $phone : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move" onkeypress="return isDecimal(event,this)" label="Fax" name="fax" value="<?php echo (isset($fax)) ? $fax : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move"   label="IFSC Code" id="ifsccode" name="ifsccode" value="<?php echo (isset($ifsccode)) ? $ifsccode : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move" label="MICR Code" name="micrcode" id="micrcode" value="<?php echo (isset($micrcode)) ? $micrcode : ''; ?>">
                </div>
            </div>
            <div class="row">
                <div class="form-group  col-lg-12">
                    <input type="text" class="form-control lbl_move" label="Contact Person" name="contactperson" value="<?php echo (isset($contactperson)) ? $contactperson : ''; ?>">
                </div>
            </div>

        </div>
        <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
            <ul>
                <li class="save_btn float_l">
                    <a href="<?php echo $this->basePath() . '/crm/bank/bankinfo';?>" data-slide="prev" data-stepno="4" class="ripple steps_btn">Cancel</a>
                </li>
                <li class="save_btn float_r">
                    <a href="#" data-slide="next" data-stepno="6" class="ripple carousel-next-btn" onclick="validateOnSubmit()">Submit</a>
                </li>
            </ul>
        </div>
        <div class="modal fade" id="myModal" role="dialog" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" onclick="bankClose()" class="close" data-dismiss="modal">&times;</button>

                        <h4 class="modal-title" style="color:#18439d;">Bank Master</h4>
                    </div>
                    <div class="modal-body">
                        <div class="col-md-12">
                            <div class="table-responsive clear">
                                <table class="table table-hover clear" id="contactTable" ">
                                    <thead>
                                    <tr>
                                        <th>BankName</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php
                                    $count=0;
                                    $cFirst=0;
                                    foreach($arr_bankmaster as $resu){
                                        $count=$count+1;
                                    if($count == 1){
                                        $cFirst=$resu['BankId'];
                                    }
                                        ?>
                                        <tr>
                                            <td width="60%">
                                                <input type="text" class="parent_txts newRow" name="BankName_<?php echo $resu['BankId']; ?>_rowid_<?php echo $count;?>" id="BankName_<?php echo $resu['BankId']; ?>_rowid_<?php echo $count;?>" tagname1="<?php echo $resu['BankId']; ?>"  onchange="bankSave(this)" tagname="BankName_<?php echo $resu['BankId']; ?>" value="<?php echo $resu['BankName'];?>" onkeypress="return alphaNumeric(event)"/>

                                            </td>
                                            <td width="6%">
                                                <a href="#" class="remove vendar_styles"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" tagbank="<?php echo $resu['BankId']; ?>"  onclick="deleteBank(<?php echo $resu['BankId']; ?>)" data-placement="top" data-original-title="Delete"></span></a>
                                            </td>
                                        </tr>
                                        <?php
                                   }
                                    if($count==0) { ?>
                                                    <tr>
                                                        <td width="15%"><input type="text" class="parent_txts newRow" name="BankName_0_rowid_1" id="BankName_0_rowid_1" tagname="BankName_0" tagname1="<?php echo '0' ?>" value="" onchange="bankSave(this)" /></td>
                                                        <td width="6%"><a href="#" class="remove vendar_styles"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a></td>
                                                    </tr>
                                                    <?php
                                               }
                                                else{
                                                    $count=$count+1;
                                                   ?>
                                                    <tr>
                                                        <td width="15%"> <input type="text" class="parent_txts newRow" name="BankName_<?php echo $count;?>_rowid_<?php echo $resu['BankId']; ?>" id="BankName_<?php echo $count;?>_rowid_<?php echo $resu['BankId']; ?>" tagname="BankName_<?php echo $resu['BankId']; ?>" value="<?php echo $resu['BankName'];?>" /></td>
                                                        <td width="6%"><a href="#" class="remove vendar_styles"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a></td>
                                                    </tr>
                                                    <?php
                                                }
                                       ?>
                                    </tbody>
                                </table>
                                <input type="hidden" class="parent_txts" name="RowCount" id="RowCount" value="<?php echo $count; ?>" />
                                <input type="hidden" class="parent_txts" name="RowECount" id="RowECount" value="<?php echo $cFirst; ?>" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer clear">
                        <div class="col-lg-12 savebtn_area no_border">
                            <ul>
                                <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple" onclick="bankClose()">Close</a></li>
                            </ul>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //removetr();
    function removetr(){
        $('.remove').click(function(){
            $rECount=$('#RowECount').val();
            if($(this).closest('tr').index() != 0){
                $(this).closest('tr').remove();
                $('#contactTable tbody tr').each(function(){
                    var index=$(this).index() + 1;
                    $(this).find('select, input:text').each(function(){
                        if($(this).attr("tagname1") == $('#RowECount').val() && index != 1)
                        {
                            $(this).attr("name", 'BankName_0' + '_rowid' + '_' + index);
                            $(this).attr("id", 'BankName_0' + '_rowid' + '_' + index);
                        }
                        else {
                            $(this).attr("name", $(this).attr("tagname") + '_rowid' + '_' + index);
                            $(this).attr("id", $(this).attr("tagname") + '_rowid' + '_' + index);
                        }
                        $('#RowCount').val(index);
                    })

                });
            }
        });
    }
    $('#submitdata').click(function(){
        var rowCount = $('#contactTable tbody tr').length;
        $('#RowCount').val(rowCount);
        $('form').submit();
    });

    addRow();
    function addRow(){
        $rECount=$('#RowECount').val();
        $( ".newRow" ).unbind();
        $( ".newRow" ).bind('keyup', function() {
            //alert($(this).closest("tr").index()+"------------"+$("#contactTable tbody tr:last").index())
            if($(this).val().length>0 && $(this).closest("tr").index() == $("#contactTable tbody tr:last").index()){
                $("#contactTable tbody").append("<tr>"+$("#contactTable tbody tr:first").html()+"</tr>");
                $("#contactTable tbody tr").each(function(){
                    var index=$(this).index() + 1;
                    var lastIndex=$("#contactTable tbody tr:last").index() + 1;
                    $(this).find("select, input:text").each(function(){
                        if(index==lastIndex){
                            if($(this).prop("tagName").toLowerCase() == 'input') {
                                $(this).val("");
                            }
                            else {
                                $(this).val("1");
                            }
                        }
                        if($(this).attr("tagname1") == $('#RowECount').val() && index != 1)
                        {
                            $(this).attr("name", 'BankName_0' + '_rowid' + '_' + index);
                            $(this).attr("id", 'BankName_0' + '_rowid' + '_' + index);
                        }
                        else {
                            $(this).attr("name", $(this).attr("tagname") + '_rowid' + '_' + index);
                            $(this).attr("id", $(this).attr("tagname") + '_rowid' + '_' + index);
                        }
                        $('#RowCount').val(index);
                    })
                });
                removetr();
                addRow();
            }
        });
    }
//    $('#city').change(function() {
//        var cityid = $(this).val();
//        $.ajax({
//            type: "POST",
//            url: getBaseURL() + 'crm/bank/bankinfo',
//            data: "cityid=" + cityid + "&Type=selectState",
//            dataType: "json",
//            success: function (data) {
//
//                $("#state").html('');
////                $("#state").append("<option value='0'>Select State</option>");
////                $.each(data['resultState'], function(i,v){
////                    $("#state").append("<option value='"+v.data+"'>"+v.value+"</option>");
////                });
////
////                $("#state").selectpicker('refresh');
////                $("#state").selectp
//                $.each(data['state'], function (i, v) {
//
//
//                });
//'"+  +"'
//
//            }
//
//
//        });
//    });
    $('#city').change(function() {
        var cityid = $(this).val();

        $.ajax({
            url: getBaseURL() + 'crm/bank/bankinfo',
            type: "post",
            data: "cityid=" + cityid + "&Type=selectState",
            async: false,
            success: function (data, textStatus, jqXHR) {
                if (jqXHR.status == 200) {
                    data = JSON.parse(data);
                    console.log(data);

                    $.each(data, function (i, l) {

                        $('#state').val(l.StateName);
                        $('#country').val(l.CountryName);
                    });
                }

            }, error: function (jqXHR, textStatus, errorThrown) {

            }
        });
    });

    function validateOnSubmit() {
        if($('#bankname').val() == '') {
            alert('Please select Bank Name');
            return false;
        }
        if($('#branch').val() == '') {
            alert('Please enter branch');
            return false;
        }
        if($('#address1').val() == '') {
            alert('Please enter address');
            return false;
        }
        if($('#city').val() == '') {
            alert('Please select city name');
            return false;
        }
        if($('#pincode').val() == '') {
            alert('Please enter pincode');
            return false;
        }
        if($('#mobile').val() == '') {
            alert('Please enter mobile');
            return false;
        }
        $('#formWrapper').submit();
    }
    function bankSave(x){
        console.log(x);
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var branchid = ids[1];
        var rowid=ids[3];
        var bankname=($('#BankName_' + branchid + '_rowid_' + rowid ).val());
        $.ajax({
            url: getBaseURL() + 'crm/bank/bankinfo',
            type: "post",
            data: "branchid=" + branchid + "&Type=selectBank&bankname="+ bankname +"",
            async: false,
            success: function (data, textStatus, jqXHR) {
                if (jqXHR.status == 200) {


                }

            }, error: function (jqXHR, textStatus, errorThrown) {
                alert('Already exists !');
                $('#BankName_' + branchid + '_rowid_' + rowid ).val('');
            }
        });

    }
    function deleteBank(x) {
        txt = "Do you want to delete this Bank?";
        var val = confirm(txt);
        if (val == true) {
            $.ajax({
                url: getBaseURL() + 'crm/bank/bankinfo',
                type: "post",
                data: "bankid=" + x + "&Type=deleteBank",
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if (jqXHR.status == 200) {

                        removetr();
                    }

                }, error: function (jqXHR, textStatus, errorThrown) {
                    alert('Already used do not delete !');
                }
            });

        }
    }
    function bankClose()
    {
        $.ajax({
            type: "POST",
            url: getBaseURL()+'crm/bank/bankinfo',
            data: "Type=refreshBank",
            dataType: "json",
            success: function(data){
                $("#bankname").html('');
                $("#bankname").append("<option value='0'>Select Bank</option>");
                $.each(data, function(i,v){
                    $("#bankname").append("<option value='"+v.data+"'>"+v.value+"</option>");
                });
                $("#bankname").selectpicker('refresh');
            }

        });
    }

</script>


</form>