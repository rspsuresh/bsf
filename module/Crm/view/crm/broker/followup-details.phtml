<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<form name="followup-details" class="form-horizontal stginner_cnt" method="post">
<div>
<div class="showDiv" id="Details"> 			
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1 data-bsfhead="Followup Details">Followup Details
						<div class="btn-group proname_btn">
						<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"><?php echo ucfirst($responseBroker['BrokerName']);?> <span class="edit_symbols" data-placement="right" data-toggle="tooltip" data-original-title="Change&nbsp;Followup&nbsp;Name"><i class="fa fa-caret-down "></i></span></a> 							
							<div class="dropdown-menu toolbar_ddown proname_ddown arrow" role="menu">
								<ul>
								<?php 
								foreach($responseBro as $leadData){?>
									<li><a href="javascript:void(0);" class="followupId" data-index="<?php echo $leadData['BrokerId'];?>"><?php echo ucfirst($leadData['BrokerName']);?></a></li>
								<?php }	?>
								</ul>
							</div>
						</div>
					</h1>
        </div> 
        <div class="col-lg-12 flwup_topcnt clear" id="followDetails">
            <div class="col-lg-6 col-md-6 col-sm-12 padlr0">
            	<div class="col-lg-4 flwup_proimg_area">
                    <div class="flwup_proimg brad_200">
                        
                </div>
					
                 </div>
            	<div class="col-lg-8 col-md-12 flwup_procnt">
                    <h1 data-bsfshare="BrokerName"><?php echo $responseBroker['BrokerName'];?>
                    </h1>
                    <ul>
                        <li data-bsfshare="View details"><a href="../full-details/<?php echo $responseBroker['BrokerId']?>" id="fullDetailId"><span><i class="fa fa-search-plus"></i></span> View details</a></li>
                        <li data-bsfshare="Edit details"><a href="javascript:void(0);" class="edit" data-index="<?php  echo $responseBroker['BrokerId'];?>"><span><i class="fa fa-pencil"></i></span> Edit Details</a></li>
					</ul>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 flwup_rightcnt">
                <h2 data-bsfhead="Contact Details">Contact Details
                    <div class="stgedit_btn h2_circle brad_50"><span><i class="fa fa-book"></i></span></div>
                </h2>
                <div class="clr_bbdr"></div>
                <div class="flwup_rightcnt_inner">
                    <ul class="flwup_rcnt_inrdetail">
                        <li><a href="javascript:void(0);" onclick="callModal('<?php echo $Brokerdet['Mobile']; ?>');" style="color:#3f4c5e;">+91<span data-bsfshare="Mobile" class="flwup_rcnt_num"><?php if(!empty($Brokerdet['Mobile'])){echo $Brokerdet['Mobile'];}else{echo"-";}?></span><span class="inner_ricon inr_ri_mt7 float_r"><i class="fa fa-phone"></i></span></a></li>
                        <li><span class="flwup_rcnt_mail" id="flwup_mail"> </span><?php if(!empty($Brokerdet['Email'])){echo $Brokerdet['Email'];}else{echo"-";}?><span class="inner_ricon float_r"><i class="fa fa-envelope"></i></span></li>
                    </ul>
                </div>
            </div>

             <div class="col-lg-3 col-md-6 col-sm-6 flwup_rightcnt">
						<h2 data-bsfshare="Projects">Projects
							<div class="stgedit_btn h2_circle brad_50"><span><i class="fa fa-briefcase"></i></span></div>
						</h2>
						<div class="clr_bbdr"></div>
						<div class="flwup_rightcnt_inner">
						<?php if(!empty($resultMultiProject) > 0){?>
							<ul class="flwup_rcnt_inrproject">
								<?php
								foreach($resultMultiProject as $resuCC){ ?>
								<li data-bsfshare="ProjectName" class="white_inner">
										<span class="pad_t3"><?php echo ucfirst($resuCC['ProjectName']['0']);?></span><p><?php echo $resuCC['ProjectName'];?></p>
									</li>						
								<?php }	?>							
								</ul> 
								<?php }else{echo'-';}?>
						</div>
					</div>
        </div>
        <div class="col-lg-12 clear">
        	<div class="col-lg-6 m_tb10">
            	<div class="col-lg-8 col-lg-offset-2">
                        <div class="row">
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <span class="date_icon"><i class="fa fa-calendar"></i></span>
                                    <input data-bsfshare="RefDate" type="text" name="RefDate" id="RefDate" readonly="readonly" value="<?php echo $responseBroker['RefDate'];?>" class="form-control lbl_move date_picker" label="RefDate"/>
                                <div class="error_message"><p>Choose RefDate...</p></div>
								</div>
                            </div>
                          <!--  <div class="form-group">
                                <div class="col-lg-12">
                                    <select name="Broker" id="Broker"  class="single_dropdown2 lbl_move"  style="width:100%;" data-size="5" label="Broker Name">
                                    	<option value="">select Broker...</option>			
									<?php				
												// foreach($responseBro as $type){
													// if(count($responseBroker)>0){
														// echo "<option ".($responseBroker['FollowupBrokerId']==$type['BrokerId']? 'selected':'')." value='".$type['BrokerId']."' >".$type['BrokerName']."</option>";
													// }
													// else{
														// echo "<option value='".$type['BrokerId']."' >".$type['BrokerName']."</option>";
													// }
												// }
											?> 
											</select>
                                <div class="error_message"><p>Choose BrokerName...</p></div>
								</div>
                            </div>-->
							<div>
							<input type ="hidden" name="bname" value=" <?php echo $responseBroker['BrokerId'];?>" /></div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <select data-bsfshare="Project Select" name="Project" id="Project" style="width:100%;" class="single_dropdown2 lbl_move" data-size="5" label="choose Project">
                                       <option value="">Choose project...</option>
									<?php				
												foreach($responseProject as $type){
													
													if(count($responseBroker)>0){
														echo "<option ".($responseBroker['ProjectsId']==$type['ProjectId']? 'selected':'')." value='".$type['ProjectId']."' >".$type['ProjectName']."</option>";
													}
													else{
														echo "<option value='".$type['ProjectId']."' >".$type['ProjectName']."</option>";
													}
												}
											?> 
                                    </select>  
                                <div class="error_message"><p>Choose Project...</p></div>
								</div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <select data-bsfshare="Lead Name" name="Lead" id="Lead" style="width:100%;" class="single_dropdown2 lbl_move" data-size="5" label="Lead Name">
                                       <option value="">Choose Lead Name...</option>
									<?php				
												foreach($responseLead as $type){
													if(count($responseBroker)>0){
														echo "<option ".($responseBroker['LeadId']==$type['LeadId']? 'selected':'')." value='".$type['LeadId']."' >".$type['LeadName']."</option>";
													}
													else{
														echo "<option value='".$type['LeadId']."' >".$type['LeadName']."</option>";
													}
												}
											?> 
                                    </select>  
                                <div class="error_message"><p>Choose LeadName...</p></div>
								</div>
                            </div>
							<div class="form-group">
                            <div class="col-lg-12">
                                <span class="date_icon"><i class="fa fa-calendar"></i></span>
                                <input  data-bsfshare="Next CallDate" type="text" name="nextcall" id="nextcall" class="form-control lbl_move date_picker" readonly="readonly" value="<?php echo date("d-m-Y",strtotime($responseBroker['NextCallDate'])); ?>" label="Next CallDate"/>
                            <div class="error_message"><p>Choose Next Call Date...</p></div>
                            </div>
                        </div>
							<div class="row">
                            <div class="form-group">
                                <div class="col-lg-12">
                                 <textarea data-bsfshare="Remarks" name="Remarks" value="" id="Remarks" class="form-control lbl_move" label="Remarks"><?php echo $responseBroker['Remarks'];?></textarea>
                                <div class="error_message"><p>Choose Remarks...</p></div>
								</div>
                            </div>
                            </div>
						<div class="col-lg-12 savebtn_area m3_auto no_border">
                                <ul>
                                    <li data-bsfshare="Proceed" class="save_btn m_auto">
                                       <a href="javascript:void(0);" class="ripple continue">Proceed</a>
                                    </li>
                                </ul>
                            </div>
                        </div> 

                </div>
        	</div>
            <div class="col-lg-6 m_tb10">
            	<div class="form-group">
                    <div class="col-lg-12">
                        <div class="stginner_h5">
                            <h5 data-bsfshare="Personal info">Last Followup Details
                                
                            </h5>
                        </div>
                       
                            <div class="row">   
                                <div class="col-lg-12">
                             <label for="first_name" class="col-lg-4 padlr0 col-md-4 txt_left control-label">RefDate</label>
							 <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                        <p data-bsfshare="Personal RefDate"><?php echo $responseBroker['RefDate'];?></p>
                                    </div>
                                 </div>
                            </div>
                          <!--  <div class="row">   
                                <div class="col-lg-12">
                                    <label for="first_name"  class="col-lg-4 padlr0 col-md-4 txt_left control-label">Followup BrokerName</label>
                                 <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                    <p><?php //echo $responseBroker['followupBroker'];?></p> 
                                    </div>
								</div>
                            </div>-->
                            <div class="row">   
                                <div class="col-lg-12">
                                    <label for="first_name"  class="col-lg-4 padlr0 col-md-4 txt_left control-label">Lead Name</label>
                                  <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                        <p data-bsfshare="Personal Lead Name"><?php echo $responseBroker['LeadName'];?></p>
                                    </div>
								 </div>
                            </div>
                            <div class="row">   
                                <div class="col-lg-12">
                                    <label for="first_name"  class="col-lg-4 padlr0 col-md-4 txt_left control-label">Project</label>
                                   <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                        <p data-bsfshare="Personal Project"><?php echo $responseBroker['ProjectName'];?></p>
                                    </div>
								  </div>
                            </div>

							<div class="row">   
                                <div class="col-lg-12">
                                    <label for="first_name"  class="col-lg-4 padlr0 col-md-4 txt_left control-label">Next Call Date</label>
                                    <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                        <p data-bsfshare="Personal Next Call Date"><?php  if(date("d-m-Y",strtotime($responseBroker['NextCallDate']))=='01-01-1970'){
                                                echo '';
                                            } else { echo date("d-m-Y",strtotime($responseBroker['NextCallDate'])); } ?></p>
                                    </div>
								   </div>
                            </div>
                           <div class="row">   
                                <div class="col-lg-12">
                                    <label for="first_name"  class="col-lg-4 padlr0 col-md-4 txt_left control-label">Remarks</label>
                                    <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                        <p data-bsfshare="Personal Remarks"><?php echo $responseBroker['Remarks'];?></p>
                                    </div>
								   </div>
                            </div>
					</div>
                </div>
            </div>
        </div>
	</div>
</div>
</div>
</form>
</div>
<div class="modal fade" id="call_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
    <div class="modal-dialog calling_dialog" role="document">
        <div class="modal-content calling_content">
            <div class="calling_content_inner">
                <p data-bsfshare="Make a call to">Make a call to <span id="calling_number"></span></p>
                <!--p>Dialing</p-->
                <img src="<?php echo $this->basePath(); ?>/images/calling_icon.png" />
                <div class="endcall_btn"><a href="javascript:void(0)" onclick="connectCall('9884002812','7200626470');" class="brad_3 ripple">Call</a></div>
            </div>
        </div>
    </div>
</div>

<script>
$(".showDiv").hide();
$("#Details").show();
$("#LeadId").hide();

  $(".continue").click(function(){
	var ele = $(".showDiv:visible");
	var bool = true;
	ele.find("input,checkbox, select, textarea").each(function(){
	var tagname = $(this).prop("tagName").toLowerCase();
		if(tagname =='input'){
			var type = $(this).attr("type");
			if(type =='text' ){
				if($(this).is(":visible") && $(this).val().trim() == ''){
					bool=false;
						$(this).closest('.polymer-form').next(".error_message").show();
						$(this).focus();
					return false;
				}else{
				$(this).closest('.polymer-form').next(".error_message").hide();	
			}
			}
	}
	else if(tagname =='select'){
				if(this.id != 'Lead'){
                 if ($(this).val() == "" || $(this).val() == null){
			        bool = false;
					$(this).closest('.polymer-form').next(".error_message").show();
					$(this).focus();
					return false;		
				 }}
       else{
			$(this).closest('.polymer-form').next(".error_message").hide();	
			}		
	}
	else if(tagname == 'textarea'){
				if($(this).val().trim().length == 0){
					bool = false;
					$(this).closest('.polymer-form').next(".error_message").show();
					$(this).focus();
					return false;
				}
				else{
				$(this).closest('.polymer-form').next(".error_message").hide();	
			}		

		}
		else {
		$(".error_message").remove();
		}
});
if(bool){
	if($(".showDiv:visible").index() != $(".showDiv:last").index()){
		$(".showDiv:visible").next(".showDiv").show();
		ele.hide();
		if($(".showDiv:Visible").index()){
		$(this).text("submit");
		}
	}
	else{
		$('form').submit(); 
	}
}
});
</script>

<script>
$(document).ready(function() {
		$(".single_dropdown2").select2({
			placeholder: "",
			allowClear: true
		});
	});

$('.fullDetails').on('click',function(){
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/broker/full-details/"+urlId);
});
$('.edit').on('click',function(){
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/broker/entry/"+urlId);
});

//onchange broker
$('.followupId').on('click',function(){
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/broker/followup-details/"+urlId);
});

function callModal(number) {
    $('#calling_number').html('');
    $('#calling_number').html(number);
    $('#call_modal').modal('show');
}

function connectCall(from,to) {
    var data = "action=connect_call_to_agent&from=" + from + "&to=" + to;
    $.ajax({
        type: 'POST',
        url: getBaseURL() + 'application/exotel/calls',
        data: data,
        success: function(data, status, xhr) {
            $('#call_modal').modal('hide');
            xmlDoc = $.parseXML( data ),
                $xml = $( xmlDoc ),
                $Sid = $xml.find( "Sid" ).text();
            $('#caller_sid').val($Sid);
        },
        error: function(xhr, status, errorThrown) {
            $('.loading_area').hide();
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
}
</script>
