<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<script src="<?php echo $this->basePath(); ?>/js/modernizr.js"></script> <!-- Modernizr -->
<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath(); ?>/css/component.css" />
  <form method="post" autocomplete="off">
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1 data-bsfhead="Executive Target" >Executive Target</h1>
        </div>
        <div class="col-lg-12 flwup_topcnt fmg_topcnt clear" id="target">
			<div class="col-lg-4 form-group" id="period">
                <select name="periodId" id="periodId" data-bsfshare="Choose Period" label="Choose Period" onChange = "stepsFormData();" class="single_dropdown lbl_move dont_edit"  style="width:100%;" >
				    <option></option>
                    <?php if(isset($resultsMonth)) {
                        foreach ($resultsMonth as $type) { ?>
                            <option value="<?php echo $type['MonthId'] ?>"><?php echo $type['MonthDivide'] ?></option>
                        <?php }
                    }?>
		        </select>
            </div>

            <div class="col-lg-4 form-group" id="project">
                <select name="projectId" id="targetprojectId" onChange = "stepsFormData();" class="single_dropdown lbl_move dont_edit" data-bsfshare="ProjectName" label="Choose Project" style="width:100%;" >
                    <option></option>
                    <?php if(isset($resultsProject)) {
                        foreach($resultsProject as $type){ ?>
                            <option value="<?php echo $type['ProjectId'] ?>" ><?php echo $type['ProjectName'] ?></option>
                        <?php }
                    } ?>
                </select>
            </div>

            <div class="col-lg-4 form-group" id="from">
            	<span class="date_icon"><i class="fa fa-calendar"></i></span>
                <input type="text" name="target_from" id="target_from" data-bsfshare="TargetFrom" onChange = "stepsFormData();" onKeyPress="return isDecimal(event);" readonly class="form-control lbl_move date_picker dont_edit" value="" label="Target From"/>
            </div>
            <div class="col-lg-4 form-group" id="count">
                <select name="target_count" id="target_count" data-bsfshare="TargetCount" class="single_dropdown lbl_move" onChange = "stepsFormData();" label="No of terms" style="width:100%;" >
                    <option></option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
            </div>
            <div class="col-lg-4 form-group" id="unit">
                <input type="text" name="target_unit" id="target_unit" data-bsfshare="TargetUnit" onChange = "stepsFormData();" onKeyPress="return isDecimal(event);" class="form-control lbl_move dont_edit" value="" label="Target Unit Per Executive"/>
            </div>
            <div class="col-lg-4 form-group" id="amount">
                <input type="text" name="target_amt" data-bsfshare="Target Amount" id="target_amt" onChange = "stepsFormData();" onblur="return FormatNum(this, 2);" onKeyPress="return isDecimal(event);" class="form-control lbl_move dont_edit"  value="" label="Target Amount Per Executive"/>
            </div>
        </div>
<!--        <div class="col-lg-12 clear treeView" style="display:none;">-->
<!--            <a class="agreement_preview_a m_btm20" href="javascript:void(0);" onclick="return treeView();"><span><i class="fa fa-sitemap" aria-hidden="true"></i></span> Tree View</a>-->
<!--        </div>-->
        <div class="col-lg-12 clear">
        	<div class="table-responsive clear col-lg-12" id="dataTable">
				</div>
            <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1" style="padding-bottom:90px;">
                <div class="row">
                    <section>
                         <div id="theForm" class="simform">
                            <div class="simform-inner">
                                <ul class="questions">
                                	<li>
                                        <span><label for="targetPeriod">Target Period </label></span>
                                        <select name="targetPeriod" id="targetPeriod" data-bsfshare="TargetPeriod" class="single_dropdown" style="width:93%;" >
										    <option></option>
										    <?php
                                            foreach($resultsMonth as $type){ ?>
                                                <option value="<?php echo $type['MonthId'] ?>" ><?php echo $type['MonthDivide']; ?></option>
                                            <?php } ?>
                                        </select>
                                    </li>
                                    <li>
                                        <span><label for="ProjectId">Choose your Project</label></span>
                                        <select name="projectId" id="projectId" data-bsfshare="ProjectName" class="single_dropdown" style="width:93%;" >
											<option></option>
											 <?php if(isset($resultsProject)) {
                                                 foreach($resultsProject as $type){ ?>
                                                     <option value="<?php echo $type['ProjectId'] ?>" ><?php echo $type['ProjectName'] ?></option>
                                                 <?php }
                                             } ?>
									    </select>
                                    </li>
                                    <li>
                                        <span><label for="targetfrom">Target From</label></span>
                                        <input id="targetfrom" name="targetfrom" data-bsfshare="TarhetFrom" readonly class="date_picker" type="text"/>
                                    </li>
                                    <li>
                                        <span><label for="targetcount">No of terms</label></span>
                                        <select name="targetcount" id="targetcount" data-bsfshare="Target Account" class="single_dropdown" style="width:93%;" >
                                            <option></option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </li>
                                    <li>
                                        <span><label for="targetUnit">Target Unit Per Executive</label></span>
                                        <input id="targetUnit" data-bsfshare="TargetUnit" name="targetUnit"  onkeypress="return isDecimal(event);" data-validate="novalidate" type="text"/>
                                    </li>
									<li>
                                        <span><label for="targetamt">Target Amount Per Executive</label></span>
                                        <input id="targetamt" name="targetamt" data-bsfshare="TargetAmount" onkeypress="return isDecimal(event);" type="text"/>
                                    </li>
                                </ul><!-- /questions -->
                                <button class="submit" type="submit">Send answers</button>
                                <div class="controls">
                                    <button class="next" onclick="formChange();"></button>
                                    <div class="progress"></div>
                                    <span class="number">
                                        <span class="number-current"></span>
                                        <span class="number-total"></span>
                                    </span>
                                    <span class="error-message"></span>
                                </div><!-- / controls -->
                            </div><!-- /simform-inner -->
                            </div><!-- /simform-inner -->
                            <span class="final-message"></span>
                       <!-- /simform -->
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
<!--button-->
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="save_btn float_r" style="width:inherit !important;">
            <input type="submit" value="save" class="ripple continue" style="width:120px !important;" >
        </li>
		<li class="cancel_btn float_r">
            <a href="target" class="ripple">cancel</a>
        </li>
    </ul>
</div>
 </form>
<script src="<?php echo $this->basePath(); ?>/js/classie.js"></script>
<script src="<?php echo $this->basePath(); ?>/js/stepsForm.js"></script>
<script>
$(function() {
    //multiple dropdown select}
    $(".multiple_dropdown").select2();

    //single dropdown
    $(".single_dropdown").select2({
        allowClear: false,
        placeholder: ""
    });

    //sim form submit//
    var theForm = document.getElementById('theForm');
    new stepsForm(theForm, {
        onSubmit: function (form) {
            stepsFormData();
        }
    });

    //hide target div
    $("#dataTable").hide();
    $("#target").hide();
    $("#period").hide();
    $("#project").hide();
    $("#from").hide();
    $("#amount").hide();
    $("#unit").hide();
    $("#count").hide();
    $(".savebtn_area").hide();

    //date picker fromate
    $('#targetfrom').datepicker({format: 'M-yyyy', todayHighlight: true}).on('changeDate', function () {
        $('.datepicker').hide();
    }).data('datepicker');

    $('#target_from').datepicker({format: 'M-yyyy', todayHighlight: true}).on('changeDate', function () {
        $('.datepicker').hide();
    }).data('datepicker');

});

$(document).on('keydown',function(event){
    var keyCode = (event.keyCode ? event.keyCode : event.which);
    if (keyCode == 13) {
        formChange();
    }
});
function stepsFormData() {
    var iCount = $.trim($(".number-current").html());
    if(iCount == 6) {
        var targetfrm = $.trim($("#target_from").val());
        var targetAmt = $.trim($("#target_amt").val());
        var targetunt = $.trim($("#target_unit").val());
        var targetType = $.trim($("#periodId").val());
        var projectType = $.trim($("#targetprojectId").val());
        var targetCount = $.trim($("#target_count").val());

        if (targetfrm.length == 0 || targetfrm == null) {
            return;
        }
        else if (targetType.length == 0 || targetType == null) {
            return;
        }
        else if (projectType.length == 0 || projectType == null) {
            return;
        }
        else if (targetCount.length == 0 || targetCount == null || !/^[1-9][0-2]?$/.test(targetCount)) {
            return;
        }
        else if (targetunt.length == 0 && targetAmt.length == 0) {
            return;
        }
        else {
            var target = 'tfrom=' + targetfrm + '&tamount=' + targetAmt + '&tunit=' + targetunt + '&targettype=' + targetType + '&project=' + projectType + '&count=' + targetCount;
            $.ajax({
                url: getBaseURL() + "crm/executive/target-trans",
                type: "POST",
                data: target,
                success: function (data, textStatus, jqXHR) {
                    $("#dataTable").html(data);
                }
            });
            classie.addClass(theForm.querySelector('.simform-inner'), 'hide');
            $("#dataTable").show();
            $(".savebtn_area").show();

        }
    } else {
        return;
    }
}
function formChange() {
    var iCount = $.trim($(".number-current").html());
    if(iCount == 1 && $("#targetPeriod").val() != "") {
        $("#periodId").val($("#targetPeriod").val()).trigger('change');
        $("#target").show();
        $("#period").show();
    }
    if(iCount == 2 && $("#projectId").val() != "") {
        $("#targetprojectId").val($("#projectId").val()).trigger('change');
        $("#project").show();
    }
    if(iCount == 3 && $("#targetfrom").val() != "") {
        $("#target_from").val($("#targetfrom").val()).trigger('change');
        $("#from").show();
    }
    if(iCount == 4 && $("#targetcount").val() != "") {
        $("#target_count").val($("#targetcount").val()).trigger('change');
        $("#count").show();
    }
    if(iCount == 5) {
        if($("#targetUnit").val()=='' || $("#targetUnit").val()== null) {
            $("#target_unit").val(0).trigger('change');
            $("#unit").show();
            $("#targetamt").removeAttr("data-validate");
        } else {
            $("#target_unit").val($("#targetUnit").val()).trigger('change');
            $("#unit").show();
            $('#targetamt').attr('data-validate', 'novalidate');
        }
    }
    if(iCount == 6) {
        //$('.treeView').show();
        if($("#targetUnit").val() == '' || $("#targetUnit").val() == 0) {
            if($.trim($("#targetamt").val()) != '') {
                $("#target_amt").val(sanitizeNumber($("#targetamt").val(), 2)).trigger('change');
                $("#amount").show();
            } else {
                $("#target_amt").val('');
                $("#amount").hide();
            }
        } else {
            if($.trim($("#targetamt").val()) == '') {
                $("#target_amt").val(0).trigger('change');
                $("#amount").show();
            } else {
                $("#target_amt").val(sanitizeNumber($("#targetamt").val(), 2)).trigger('change');
                $("#amount").show();
            }
        }
    }
}

function treeView()
{
    var projId = $("#projectId").val();
    window.location.href= getBaseURL() + "crm/executive/tree-view/"+projId;
}
</script>


