<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/bootstrap-datetimepicker.min.js"></script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/bootstrap-datetimepicker.min.css';?>"/>
<form name="followup-details" class="form-horizontal stginner_cnt" method="post">
	<div>
		<div class="showDiv" id="Details">
			<div class="content_wrapper padlr0">
				<div class="container-fluid padlr0">
					<div class="col-lg-12">
						<h1 class="float_l">Followup Details
                            <div class="btn-group proname_btn">
                       			<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"><?php echo ucfirst($responseLead['LeadName']);?> <span class="edit_symbols" data-placement="right" data-toggle="tooltip" data-original-label="Change&nbsp;Followup&nbsp;Name"><i class="fa fa-caret-down "></i></span></a> 							
                                <div class="dropdown-menu toolbar_ddown proname_ddown arrow" role="menu">
                                    <ul>
                                    <?php foreach($resultsLeadData as $leadData){?>
                                        <li><a href="javascript:void(0);" class="followupId" data-index="<?php echo $leadData['LeadId'];?>"><?php echo ucfirst($leadData['LeadName']);?></a></li>
                                    <?php }	?>
                                    </ul>
                                </div>
                            </div>
						</h1> 
                        <a class="clshvr float_r" href="<?php echo $this->basePath(); ?>/crm/lead/followup-entry"><span class="select2-selection__clear">Ã—</span> <span class="clscrm"> Close</span></a>
					</div>
					<div class="col-lg-12 flwup_topcnt clear" id="followDetails">
						<div class="col-lg-6 col-md-6 col-sm-12 padlr0">
							<div class="col-lg-4 flwup_proimg_area">
								<div class="flwup_proimg brad_200">
									<?php 
									if($responseLead['VIP'] == 1){ ?>
										<div class="img_star brad_50"> <span class="glyphicon glyphicon-star txt_center"></span> </div>
										<?php } 
									if($responseLead['Photo'] != '') {
										$photo="../".$responseLead['Photo'];?> <img src="<?php echo $this->basePath(); ?>/<?php echo $photo;?>" class="brad_200" alt="" label="" />
											<?php } else { ?> <img src="<?php echo $this->basePath(); ?>/images/avatar.jpg" class="brad_200" alt="" label="" />
												<?php } ?>
								</div>
								<p class="txt_center"><span class="p_label">Type :</span> <?php echo $responseLead['LeadTypeName'];?></p>
							</div>
							<div class="col-lg-8 col-md-12 flwup_procnt">
								<h1><?php echo ucfirst($responseLead['LeadName']);?><br />
								<span><?php echo $responseLead['LeadDate'];?></span>
							</h1>
								<p><span class="p_label">Executive Name :</span> <?php echo $responseLead['UserName'];?></p>
								<ul>
									<li><a href="javascript:void(0);" class="fullDetails" data-index="<?php echo $responseLead['LeadId'];?>"><span><i class="fa fa-search-plus"></i></span> View Details</a></li>
									<li><a href="javascript:void(0);" class="editId" data-index="<?php echo $responseLead['LeadId'];?>"><span><i class="fa fa-edit"></i></span> Edit Lead</a></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-3 col-md-6 col-sm-6 flwup_rightcnt">
							<h2>Contact Details
							<div class="stgedit_btn h2_circle brad_50"><span><i class="fa fa-book"></i></span></div>
						</h2>
							<div class="clr_bbdr"></div>
							<div class="flwup_rightcnt_inner">
								<ul class="flwup_rcnt_inrdetail">
									<li><a href="#call_modal" data-toggle="modal" style="color:#3f4c5e;">+91<span class="flwup_rcnt_num"> <?php if(!empty($responseLead['Mobile'])){echo $responseLead['Mobile'];}else{echo"-";}?></span><span class="inner_ricon inr_ri_mt7 float_r"><i class="fa fa-phone"></i></span></a></li>
									<li><span class="flwup_rcnt_mail" id="flwup_mail"> </span>
										<?php echo $responseLead['Email'];?><span class="inner_ricon float_r"><i class="fa fa-envelope"></i></span></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-3 col-md-6 col-sm-6 flwup_rightcnt">
							<h2>Projects
							<div class="stgedit_btn h2_circle brad_50"><span><i class="fa fa-briefcase"></i></span></div>
						</h2>
							<div class="clr_bbdr"></div>
							<div class="flwup_rightcnt_inner">
								<ul class="flwup_rcnt_inrproject">
									<?php foreach($resultMultiProject as $resuCC){?>
										<li class="white_inner"> <span class="pad_t3"><?php echo ucfirst($resuCC['ProjectName']['0']);?></span>
											<p>
												<?php echo $resuCC['ProjectName'];?>
											</p>
										</li>
										<?php }	?>
								</ul>
							</div>
						</div>
					</div>
					<div class="col-lg-12 clear">
						<div class="col-lg-6 m_tb10" id="lead_short_detail">
							<div class="col-lg-8 col-lg-offset-2">
								<div class="row">
									<div class="form-group">
										<div class="col-lg-12"> <span class="date_icon"><i class="fa fa-calendar"></i></span>
											<input type="text" name="LeadDate" id="LeadDate" readonly="readonly" class="form-control lbl_move date_picker" label="Date" value="<?php echo $responseFollow['FollowUpDate'];?>" />
											<div class="error_message">
												<p>please enter date...</p>
											</div>
										</div>
									</div>
									<div class="form-group">
									<div class="col-lg-12">
										<select name="callType" id="UnitTypeId" class="single_dropdown2 lbl_move" style="width:100%;" data-size="5" label="Call Type" disabled >
											<?php				
												foreach($resultsCall as $type){
													if(count($responseFollow)>0){
														echo "<option ".($responseFollow['CallTypeId']==$type['CallTypeId']? 'selected':'')." value='".$type['CallTypeId']."' >".$type['Description']."</option>";
													}
													else{
														echo "<option value='".$type['CallTypeId']."' >".$type['Description']."</option>";
													}
												}
											?>
											</select>
                                     <div class="error_message"><p>please select call type...</p></div>                    										
									</div>
								</div>
									<div class="form-group">
										<div class="col-lg-12">
											<select name="StatusId" id="StatusId" style="width:100%;" class="single_dropdown2 lbl_move" data-size="5" label="Status">
												<option value="">Choose Status</option>
												<?php
												foreach($resultsStatus as $type){
													if(count($responseFollow) > 0){
														echo "<option ".($responseFollow['StatusId']==$type['StatusId']? 'selected':'')." value='".$type['StatusId']."' >".$type['Description']."</option>";
													}
													else{
														echo "<option value='".$type['StatusId']."' >".$type['Description']."</option>";
													}
												}
											?>
											</select>
											<div class="error_message">
												<p>please select status...</p>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-lg-12">
											<select name="natureId" id="natureId" style="width:100%;" class="single_dropdown2 lbl_move" data-size="5" label="Nature">
												<option value="">Choose Nature</option>
												<?php
												foreach($resultsNature as $type){
													if(count($responseFollow) > 0){
														echo "<option ".($responseFollow['NatureId']==$type['NatureId']? 'selected':'')." value='".$type['NatureId']."' >".$type['Description']."</option>";
													}
													else{
														echo "<option value='".$type['NatureId']."' >".$type['Description']."</option>";
													}
												}
											?>
											</select>
											<div class="error_message">
												<p>please select Nature...</p>
											</div>
										</div>
									</div>
									 <input type="hidden" name="caller_sid" id="caller_sid"  data-bsfshare="caller" value="<?php echo $responseFollow['CallerSid']; ?>" />
                                    <div class="form-group">
                                        <div class="col-lg-12">
                                            <div class="datetimepicker">
                                                <span class="add-on datetimepicker_icon"><i class="fa fa-calendar"></i></span>
                                                <input type="text" data-format="dd/MM/yyyy HH:mm:ss PP" name="NextCallDate" id="NextCallDate" readonly="readonly" data-bsfshare="Next Call Date and Time" class="form-control lbl_move date_time_icon" label="Next Followup Date and Time" value="<?php echo (isset($responseFollow)) ? date('d/m/Y h:i:s a', strtotime($responseFollow['NextCallDate'])) : '';?>" />
                                                <div class="error_message">
                                                    <p>please enter next call date...</p>
                                                </div>
                                            </div>
                                            <script type="text/javascript">
                                                $('.date_time_icon').click(function() {
                                                    $('.datetimepicker_icon').trigger('click');
                                                });


                                                $(function() {
                                                    $('.datetimepicker').datetimepicker({
                                                        language: 'en',
                                                        pick12HourFormat: true
                                                    }).on('changeDate', function() {
                                                        //$('.bootstrap-datetimepicker-widget').hide();
                                                    });
                                                });

                                            </script>
                                        </div>
                                    </div>
									<div class="form-group">
									<div class="col-lg-12">
										<select name="nextFollowUpTypeId" id="FollowUp" class="single_dropdown2 lbl_move" style="width:100%;" data-size="5" label="Next Followup Type">
										   <option value="">Choose Next Followup Type</option>
										<?php				
												foreach($resultsCall as $type){
													if(count($responseFollow)>0){
														echo "<option ".($responseFollow['NextFollowUpTypeId']==$type['CallTypeId']? 'selected':'')." value='".$type['CallTypeId']."' >".$type['Description']."</option>";
													}
													else{
														echo "<option value='".$type['CallTypeId']."' >".$type['Description']."</option>";
													}
												}
											?>
											</select>
										<div class="error_message"><p>please select next followup type...</p></div>
									</div>
								</div>
									<div class="form-group" id="radios">
										<div class="col-lg-12">
											<label for="buyer" class="col-lg-6 txt_left col-md-6 control-label">Vehicle Required?</label>
											<div class="radio_check">
												<p>
													<input type="radio" value="1" id="yes" name="VehicleAllocation" <?php echo ((count($responseFollow)>0 && $responseFollow['VehicleAllocation'] == 1)?'checked':'')?> onclick="return showData();"/>
													<label for="yes" class="ripple">Yes</label>
												</p>
												<p>
													<input type="radio" value="2" id="no" name="VehicleAllocation" <?php echo (($responseFollow[ 'VehicleAllocation']==2 )? 'checked': '')?> onclick="return removeData();"/>
													<label for="no" class="ripple">No</label>
												</p>
											</div>
										</div>
									</div>
									<div class="form-group" id="pkTime">
										<div class="col-lg-12">
											<input type="text" name="PickUpTime" id="PickUpTime" class="form-control lbl_move" label="Enter Pickup Time" value="<?php echo $responseFollow['PickUpTime'];?>" />
											<div class="error_message">
												<p>please enter pickup time...</p>
											</div>
										</div>
									</div>
									<div class="form-group" id="pkAddress">
										<div class="col-lg-12">
											<input type="text" name="PickUpAddress" id="Address" class="form-control lbl_move" label="Enter Pickup Address" value="<?php echo $responseFollow['PickUpAddress'];?>" />
											<div class="error_message">
												<p>please enter pickup address...</p>
											</div>
										</div>
									</div>
									<div class="form-group">
									<div class="col-lg-12">
										<textarea name="nextfollowremarks" id="nextfollowremarks" class="form-control lbl_move" label="NextFollowupRemarks"><?php echo $responseFollow['NextFollowupRemarks'];?> </textarea>
										<div class="error_message"><p>please enter remarks...</p></div>
									</div>
								</div>
									
									<div class="form-group">
										<div class="col-lg-12">
											<select name="ExecutiveId" id="ActionRequiredBy" style="width:100%;" class="single_dropdown2 lbl_move" data-size="5" label="Choose Executive">
												<option value="">Choose Executive</option>
												<?php				
												foreach($resultsExecutive as $type){
													if(count($responseFollow)>0){
														echo "<option ".($responseFollow['ExecutiveId']==$type['UserId']? 'selected':'')." value='".$type['UserId']."' >".$type['UserName']."</option>";
													}
													else{
														echo "<option value='".$type['UserId']."' >".$type['UserName']."</option>";
													}
												}
											?>
											</select>
											<div class="error_message">
												<p>please select executive...</p>
											</div>
										</div>
									</div>
									<div>
										<div class="col-lg-12">
											<textarea id="remarks" name="Remarks" class="form-control lbl_move" label="Remarks" ><?php echo $responseFollow['Remarks'];?></textarea>
											<input type="hidden" id="leadFlag" name="leadFlag" value="<?php echo $responseFollow['LeadFlag'];?>" />
											<div class="error_message">
												<p>please enter remarks...</p>
											</div>
										</div>
									</div>
									<div class="col-lg-12 savebtn_area m3_auto no_border">
										<ul>
											<li class="save_btn m_auto">
												<!----<a class="ripple continue" id="continue" name="continue" href="javascript:void(0);">Proceed</a>
											<button type="button" class="continue ripple" id="continue" name="continue">Continue</button>---->
											<a href="javascript:void(0);" class="ripple continue ">Proceed</a>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-6 m_tb10">
							<div class="form-group">
								<div class="col-lg-12">
									<div class="stginner_h5">
										<h5>Last Followup Details
									</h5> </div>
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Executive Name</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['UserName'])){echo $responseFollow['UserName'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
									
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Call Type</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['call'])){echo $responseFollow['call'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Status</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['state'])){echo $responseFollow['state'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>

									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Nature</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['Nat'])){echo $responseFollow['Nat'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Followup Date</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['NextCallDate'])){echo $responseFollow['NextCallDate'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
									
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">NextFollowup Remarks</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['NextFollowupRemarks'])){echo $responseFollow['NextFollowupRemarks'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-12">
											<label for="" class="col-lg-4 padlr0 col-md-4 txt_left control-label">Remarks</label>
											<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
												<p>
													<?php if(!empty($responseFollow['Remarks'])){echo $responseFollow['Remarks'];}else{echo"-";}?>
												</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
</form>
</div>
<!--Call Modal-->
<div class="modal fade" id="call_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
    <div class="modal-dialog calling_dialog" role="document">
        <div class="modal-content calling_content">
            <div class="calling_content_inner">
            	<p>00.00</p>
                <p>Dialing</p>
                <img src="<?php echo $this->basePath(); ?>/images/calling_icon.png" />
                <div class="endcall_btn"><a href="javascript:void(0)" data-dismiss="modal" aria-label="Close" class="brad_3 ripple">End call</a></div>
            </div>
        </div>
    </div>
</div>
<!-- PAGE SCRIPTS-->
<script>
$(".showDiv").hide();
$("#Details").show();
$("#LeadId").hide();
$('#radios').hide();
$('#pkTime').hide();
$('#pkAddress').hide();
$('#ProjectsId').on('change', function() {
	//alert("hi");
	var id = $(this).val();
	if (id != -1) {
		$('#LeadId').show();
	} else {
		$('#LeadId').hide();
	}
 });
</script>
<script>
	$(document).ready(function() {
		$(".single_dropdown2").select2({
			placeholder: "",
			allowClear: true
		});
	}); 
</script>
<script>
$(".continue").click(function() {
	var ele = $(".showDiv:visible");
	var bool = true;
	ele.find("input,checkbox, select, textarea").each(function() {
		var tagname = $(this).prop("tagName").toLowerCase();
		if (tagname == 'input') {
			var type = $(this).attr("type");
			if (type == 'text') {
				if ($(this).is(":visible") && $(this).val().trim() == '') {
					bool = false;
					$(this).closest('.polymer-form').next(".error_message").show();
					$(this).focus();
					return false;
				}
				if ($(this).hasClass('Area')) {
					var area = $(this).val();
					if (area == 0) {
						$(this).next("span").text('Please enter greater than 0');
						return false;
					}
				}
			} else if (type == 'checkbox') {} else if (type == 'radio') {}
		} else if (tagname == 'select') {
			if ($(this).val() == "") {
				bool = false;
				$(this).closest('.polymer-form').next(".error_message").show();
				$(this).focus();
				return false;
			}
		} else if (tagname == 'textarea') {
			if ($(this).val().trim().length == 0) {
				bool = false;
				$(this).closest('.polymer-form').next(".error_message").show();
				$(this).focus();
				return false;
			}
		}
	});
	if (bool) {
		if ($(".showDiv:visible").index() != $(".showDiv:last").index()) {
			$(".showDiv:visible").next(".showDiv").show();
			ele.hide();
			if ($(".showDiv:Visible").index()) {
				$(this).text("submit");
			}
		} else {
			$('form').submit();
		}
	}
});
</script>
<script>
$('#FollowUp').on('change', function() {
	var sname = $("#FollowUp option:selected").text();
	if (sname == 'Sitevisit') {
		$('#radios').show();
	} else {
		$('#radios').hide().find('radio').val('');
		$('#pkTime').hide().find('input:text').val('');
		$('#pkAddress').hide().find('textarea').val('');
	}
}).change();

function showData() {
	$('#pkTime').show();
	$('#pkAddress').show();
}

function removeData() {
	$('#pkTime').hide().find('input:text').val('');
	$('#pkAddress').hide().find('textarea').val('');
}
</script>
<script>
</script>
<script>
$('.fullDetails').on('click', function() {
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/lead/full-details/" + urlId);
});
$('.editId').on('click', function() {
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/lead/entry-edit/" + urlId);
})
$('.followupId').on('click', function() {
	var urlId = $(this).attr('data-index');
	location.replace("<?php echo $this->basePath(); ?>/crm/lead/followup/" + urlId);
})

</script>
<!-- PAGE SCRIPTS-->