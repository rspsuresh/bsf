<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath(); ?>/css/project.css" />
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css"/>
<link rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/workorder.css"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/bootstrap-datetimepicker.min.js"></script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/bootstrap-datetimepicker.min.css';?>"/>
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1>Unit Pre-Booking</h1>
        </div>
        <div class="col-lg-12 clear">
            <div class="col-lg-12 clear">
                <div class="kickoff_area col-lg-12 clear">
                    <div class="col-lg-12 clear padlr0">
                        <div class="col-lg-12 col-md-12 col-sm-12 cnt_sliders padlr0">
                            <?php if(isset($err)): ?>
                                <h1 class="text-center" style="margin: 150px auto;">Error: <?php echo $err; ?></h1>
                            <?php elseif(isset($leadId)): ?>
                                <form id="pre-booking-form" method="post">
                                    <input type="hidden" name="csrf" value="<?php echo isset($csrf) ? $csrf : ''; ?>">
                                    <input type="hidden" name="lead_id" value="<?php echo (isset($leadId))?$leadId:''; ?>">
                                    <input type="hidden" name="preBookingId" value="<?php echo (isset($preBookingId))?$preBookingId:''; ?>">
                                    <input type="hidden" name="CallTypeId" value="<?php if(isset($CallTypeId)){ echo $CallTypeId ;}?>">
                                    <div id="carousel" class="carousel slide" data-ride="carousel">
                                        <!-- Wrapper for slides -->
                                        <div class="carousel-inner" role="listbox">
                                            <!--step 1-->
                                            <div class="item active">
                                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                                    <div class="">
                                                        <label for="booking_no" class="bk_lbl bk_lbl_inpt">Booking No <span class="colon_r">:</span></label>
                                                        <input type="text" class="bk_lbl_inpt inputbg_ef bk_inpt1" name="booking_no" id="booking_no" value="<?php echo $svNo; ?>" <?php if ($genType==true) { ?> readonly <?php } ?>  />
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 col-lg-pull-1 col-md-pull-1 col-sm-pull-1">
                                                    <div class="col-lg-offset-1">
                                                        <label for="booking_date" class="bk_lbl bk_lbl_inpt"><span class="bkspan_calendar"><i class="fa fa-calendar-o"></i></span> Booking Date <span class="colon_r">:</span></label>
                                                        <input type="text" class="date_picker bk_lbl_inpt bk_inpt inputbg_ef" name="booking_date" id="booking_date"
                                                               value="<?php  if($isEditMode){ echo date('d-m-Y', strtotime($preBooking['BookingDate'])); } else if(isset($dat)){ echo $dat ;}  ?>" disabled />
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 m_tb10">
                                                    <div class="col-lg-8 col-lg-offset-2">
                                                        <!--            <form class="form-horizontal">-->
                                                        <div class="row">
                                                            <div class="form-group m_top20 col-lg-12 padtop20">
                                                                <select id="leadid" name="leadid" class="form-control single_dropdown lbl_move" label="Select Lead..." style="width:100%;"disabled>
                                                                    <option value=""></option>
                                                                    <?php foreach($resultLeads as $type){?>
                                                                        <option value="<?php echo $type['LeadId']; ?>"><?php echo $type['LeadName']; ?></option>
                                                                    <?php  }?>
                                                                </select>
                                                            </div>
                                                            <div id="project-wrapper" class="form-group col-lg-12 padtop20  animated fadeInUp">
                                                                <?php if($isEditMode){ ?>
                                                                    <input type="text" class="form-control lbl_move" label="Project Name" readonly value="<?php echo $preBooking['ProjectName']; ?>"/>
                                                                    <input type="hidden" name="project_id" id="project_id" value="<?php echo $preBooking['ProjectId']; ?>">

                                                                <?php } else if(isset($saveproj)){  ?>
                                                                    <input type="text" name="project_name" class="form-control lbl_move"  data-bsfshare="ProjectName" label="Project Name" value="<?php echo $saveproj['ProjectName']; ?>" disabled>
                                                                    <input type="hidden" name="project_id" id="project_id" value="<?php echo $saveproj['ProjectId']; ?>">
                                                                <?php } else { ?>
                                                                    <select id="project_id" name="project_id" class="form-control single_dropdown lbl_move"
                                                                            label="Select Project..." style="width:100%;">
                                                                        <option value=""></option>
                                                                        <?php if (isset($arrProjects)): ?>
                                                                            <?php foreach ($arrProjects as $project): ?>
                                                                                <option
                                                                                    value="<?php echo $project['ProjectId']; ?>"><?php echo $project['ProjectName']; ?></option>
                                                                            <?php endforeach; ?>
                                                                        <?php endif; ?>
                                                                    </select>
                                                                    <?php } ?>

                                                            </div>
                                                            <div id="unitno-wrapper" class="form-group col-lg-12 padtop20 <?php if($isEditMode || isset( $saveproj)){ echo '';} else {echo 'hide';} ?>" animated fadeInUp">
                                                                <?php if($isEditMode) {
                                                                    if($preBooking['UnitId']!=0) {?>
                                                                        <input type="text" class="form-control lbl_move" label="Unit Name" readonly value="<?php echo $preBooking['UnitNo']; ?>"/>
                                                                        <input type="hidden" name="unit_no" id="unit_no" value="<?php echo $preBooking['UnitId']; ?>" />
                                                                    <?php } else { ?>
                                                                        <select id="unit_no" name="unit_no" class="form-control single_dropdown lbl_move"
                                                                                label="Select Unit No..." style="width:100%;">
                                                                            <option value=""></option>
                                                                            <?php if (isset($arrUnits)): ?>
                                                                                <?php foreach ($arrUnits as $Units): ?>
                                                                                    <option
                                                                                        value="<?php echo $Units['UnitId']; ?>"><?php echo $Units['UnitNo']; ?></option>
                                                                                <?php endforeach; ?>
                                                                            <?php endif; ?>
                                                                        </select>

                                                                    <?php } ?>
                                                                <?php } else if(isset($saveproj)){  ?>
                                                                    <input type="text" name="unit_name" class="form-control lbl_move"  data-bsfshare="UnitName" label="Unit Name" value="<?php echo $saveproj['UnitNo']; ?>" disabled>
                                                                    <input type="hidden" name="unit_no[]" id="unit_no" value="<?php echo $saveproj['UnitId']; ?>">
                                                                <?php } else { ?>
                                                                    <select id="unit_no" name="unit_no[]" class="form-control multiple_dropdown lbl_move" multiple="multiple"
                                                                            label="Select Unit No..." style="width:100%;"></select>
                                                                <?php } ?>
                                                            </div>
                                                            <div id="buyer-wrapper" class="form-group col-lg-12 <?php echo ($isEditMode)?'':'hide'; ?> animated fadeInUp">
                                                                <div class="radio_check col-lg-11 col-lg-offset-1 col-md-8 col-md-offset-2">
                                                                    <p class="col-lg-6">
                                                                        <input type="radio" name="buyer_investor" id="buyer" value="B" <?php echo ((!$isEditMode) || ($isEditMode && $preBooking['CustomerType'] == 'B'))?'checked':''; ?>>
                                                                        <label for="buyer">Buyer</label>
                                                                    </p>

                                                                    <p class="col-lg-6">
                                                                        <input type="radio" name="buyer_investor" id="investor" value="I" <?php echo ($isEditMode && $preBooking['CustomerType'] == 'I')?'checked':''; ?>>
                                                                        <label for="investor">Investor</label>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div id="discount-type-wrapper" class="form-group col-lg-12 padtop10 <?php if($isEditMode || isset( $saveproj)){ echo '';} else {echo 'hide';} ?>" animated fadeInUp">
                                                                <select id="discount_type" name="discount_type" class="form-control single_dropdown lbl_move"
                                                                        label="Select Discount Type" style="width:100%;">
                                                                    <option value=""></option>
                                                                    <option value="R" <?php echo ($isEditMode && $preBooking['DiscountType'] == 'R')?'selected':''; ?>>Rate/Sq.ft</option>
                                                                    <option value="L" <?php echo ($isEditMode && $preBooking['DiscountType'] == 'L')?'selected':''; ?>>Lumpsum</option>
                                                                </select>
                                                            </div>
                                                            <div id="lumpsum-type-wrapper" class="form-group col-lg-12 animated fadeInUp <?php echo ($isEditMode && $preBooking['DiscountType'] == 'L')?'':'hide'; ?>">
                                                                <div class="radio_check col-lg-11 col-lg-offset-1 col-md-8 col-md-offset-2">
                                                                    <p class="col-lg-6">
                                                                        <input type="radio" name="lumpsum_type" id="lumpsum_type_overall" value="O" <?php echo ($isEditMode && $preBooking['LumpsumReceiptId'] == 0)?'checked':''; ?>>
                                                                        <label for="lumpsum_type_overall">OverAll</label>
                                                                    </p>

                                                                    <p class="col-lg-6">
                                                                        <input type="radio" name="lumpsum_type" id="lumpsum_type_receiptwise" value="R" <?php echo ($isEditMode && $preBooking['LumpsumReceiptId'] != 0)?'checked':''; ?>>
                                                                        <label for="lumpsum_type_receiptwise">Receipt wise</label>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div id="lumpsum-receipt-wise-wrapper" class="form-group col-lg-12 padtop10 animated fadeInUp <?php echo ($unitBooking['LumpsumReceiptId'] == 0)?'hide':''; ?>">
                                                                <select id="lumpsum_receipt_wise" name="lumpsum_receipt_wise" class="form-control single_dropdown lbl_move"
                                                                        label="Select Receipt Type" style="width:100%;">
                                                                    <option value=""></option>
                                                                    <?php foreach($arrReceiptTypes as $receipt): ?>
                                                                        <option value="<?php echo $receipt['ReceiptTypeId']; ?>" data-type="<?php echo $receipt['Type']; ?>" <?php if(isset($unitBooking)){echo ($unitBooking['LumpsumReceiptId'] == $receipt['ReceiptTypeId'])?'selected':'';} ?>><?php echo $receipt['ReceiptTypeName']; ?></option>
                                                                    <?php endforeach; ?>
                                                                </select>
                                                            </div>
                                                            <div id="discount-wrapper" class="form-group col-lg-12 padtop10 <?php echo ($isEditMode && $preBooking['DiscountType'] != '')?'':'hide'; ?> animated fadeInUp">
                                                                <input type="text" name="discount" id="discount" class="form-control lbl_move"
                                                                       value="<?php echo ($isEditMode)?$this->commonHelper()->sanitizeNumber($preBooking['Discount'], 2):''; ?>"
                                                                       label="Discount" onkeypress="return isDecimal(event, this)"/>
                                                            </div>

                                                            <div id="advance-wrapper" class="form-group col-lg-12 padtop10 <?php if($isEditMode || isset( $saveproj)){ echo '';} else {echo 'hide';} ?>" animated fadeInUp">
                                                                <input type="text" name="advance_amt" id="advance_amt" class="form-control lbl_move"
                                                                       value="<?php echo ($isEditMode)?$this->commonHelper()->sanitizeNumber($preBooking['AdvAmount'], 2):''; ?>"
                                                                       label="Advance Amount" onkeypress="return isDecimal(event, this)"/>
                                                            </div>

                                                            <!--                    <div id="valid-wrapper" class="form-group col-lg-12 padtop10 --><?php //echo ($isEditMode)?'':'hide'; ?><!-- animated fadeInUp">-->
                                                            <!--                        <input type="text" name="valid_upto" id="valid_upto" class="form-control lbl_move date_picker"-->
                                                            <!--                               value="--><?php //echo ($isEditMode)?date('d-m-Y', strtotime($preBooking['ValidUpto'])):''; ?><!--"-->
                                                            <!--                               label="Valid Upto" />-->
                                                            <!--                    </div>-->
                                                        </div>
                                                        <!--            </form>-->
                                                    </div>
                                                </div>
                                    <div id="unit-detail-wrapper" class="col-lg-6 m_tb10 <?php if(isset( $saveproj)){ echo '';} else {echo 'hide';} ?>">
                                        <div class="form-group">
                                            <div class="col-lg-12">
                                                <div class="row stginner_h5">
                                                    <h5>Unit Detail</h5>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Unit Type</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_UnitTypeName"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Block Name</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_BlockName"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label
                                                            class="col-lg-5 padlr0 col-md-5 col-sm-5 col-md-4 txt_left control-label">Level</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_FloorName"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Area</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p><span id="unitdetail_UnitArea"></span> Sq.ft</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Rate</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_Rate"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Base Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_BaseAmt"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Advance
                                                            Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_AdvAmount"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Land Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_LandAmount"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Construction Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_ConstructionAmount"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">UDS Land
                                                            Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_UDSLandArea"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Other Cost
                                                            Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_OtherCostAmt"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--   <div class="row">
                                                       <div class="col-lg-12">
                                                           <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Gross Amont</label>

                                                           <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                               <p id="unitdetail_GrossAmount"></p>
                                                           </div>
                                                       </div>
                                                   </div>-->
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Qualifier
                                                            Amount</label>

                                                        <div class="col-lg-7 col-md-7 col-sm-7 padlr0">
                                                            <p id="unitdetail_QualifierAmount"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="net_amnt">
                                                    <h2>Gross Amount</h2>

                                                    <h1>Rs. <span id="unitdetail_NetAmt"></span></h1>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                                <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
                                                    <ul>
                                                        <?php if($isEditMode){?>
                                                            <li class="save_btn float_r">
                                                                <a id="submit" href="#" class="ripple">submit</a>
                                                                <div id="post-loader" class="post_loader ask_post_loader brad_50">
                                                                    <img title="" alt="" src="/bsf_v1.1/public/images/post-loader.gif">
                                                                </div>
                                                            </li>

                                                        <?php } else {?>
                                                            <li class="save_btn float_l">
                                                                <a href="<?php echo $this->basePath(); ?>/crm/lead/followup<?php echo (isset($leadId))?'/'.$leadId:'-entry'; ?>" class="ripple steps_btn">Back</a>
                                                            </li>
                                                            <li class="save_btn float_r">
                                                                <a href="#" data-slide="next" data-stepno="2" class="ripple carousel-next-btn">Next</a>
                                                            </li><?php } ?>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="item">
                                                <div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 padlr0 m_btm20 unit_kickoff">
                                                    <div class="unitkkoff_topimg"></div>
                                                    <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 padlr0 m_btm20">
                                                        <div class="form-group m_top20 padtop20 clear">
                                                            <input type="text" name="status_name" id="status_name" class="form-control lbl_move" label="Status" value=""/>
                                                            <input type="hidden" name="status_id" id="status_id"/>
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear">
                                                            <input type="text" name="nature_name" id="nature_name" class="form-control lbl_move special" label="Nature" value=""/>
                                                            <input type="hidden" name="nature_id" id="nature_id"/>
                                                        </div>
                                                        <div class="form-group padtop10" id="time">
                                                            <div class="datetimepicker">
                                                                <span class="add-on datetimepicker_icon"></span>
                                                                <input type="text" id="nextCallDate" data-format="dd/MM/yyyy HH:mm:ss PP" name="nextCallDate" readonly="readonly" data-bsfshare="Next Call Date and Time" class="form-control lbl_move date_time_icon" label="Next Call Date and Time" />
                                                            </div>
                                                            <script type="text/javascript">
                                                                $('.date_time_icon').click(function() {
                                                                    $('.datetimepicker_icon').trigger('click');
                                                                });

                                                                var dt=new Date();
                                                                $(function() {
                                                                    $('.datetimepicker').datetimepicker({
                                                                        language: 'en',
                                                                        pick12HourFormat: true,
                                                                        startDate:dt,
                                                                        todayBtn: true
                                                                    }).on('changeDate', function() {
                                                                        //$('.bootstrap-datetimepicker-widget').hide();
                                                                    });
                                                                });

                                                                $(document).ready(function(){
                                                                    var ldId=  <?php echo (isset($leadId)) ? $leadId : '0'; ?>

                                                                    if(ldId==0){
                                                                        $("#leadid").prop('disabled',false);
                                                                    }
                                                                    else{
                                                                        $("#leadid").prop('disabled',true);
                                                                    }
                                                                });

                                                            </script>
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear">
                                                            <select id="nextfollow_name" name="nextfollow_name" class="form-control single_dropdown lbl_move" style="width:100%;">
                                                                <option value="">Choose Next Followup Type</option>
                                                                <?php
                                                                foreach($arrCall as $type){ ?>
                                                                    <option value="<?php echo $type['data'] ?>" ><?php echo $type['value'] ?></option>
                                                                <?php } ?>
                                                            </select>
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear" id="requ">
                                                            <label for="buyer" class="col-lg-6 txt_left col-md-6 control-label">Vehicle Required?</label>
                                                            <div class="radio_check">
                                                                <p class="col-lg-6">
                                                                    <input type="radio" name="vehicleAllocation" id="allo_yes" value="1">
                                                                    <label for="allo_yes">Yes</label>
                                                                    <input type="radio" name="vehicleAllocation" id="allo_no" value="0">
                                                                    <label for="allo_no">No</label>
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear" id="timep">
                                                            <input type="text" name="pickUpTime" id="pickUpTime"  class="form-control lbl_move time_picker" readonly label="Pick Up Time" />
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear" id="addr">
                                                            <input type="text" name="pickUpAddress" id="pickUpAddress"  class="form-control lbl_move"label="PickUp Address" />
                                                        </div>
                                                        <div class="form-group m_top20 padtop20 clear">
                                                            <textarea name="nextfollowremarks" id="nextfollowremarks"  class="form-control lbl_move" label="Next Followup Remarks"></textarea>
                                                        </div>
                                                        <div class="form-group padtop10">
                                                            <textarea name="remarks" id="remarks"  class="form-control lbl_move" label="remarks"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
                                                        <ul>
                                                            <li class="save_btn float_l">
                                                                <a href="#carousel" data-slide="prev" data-stepno="1" class="ripple steps_btn">Back</a>
                                                            </li>
                                                            <li class="save_btn float_r">
                                                                <a id="finalise-btn" href="#" class="ripple">submit</a>
                                                                <div id="ask-post-loader" class="post_loader ask_post_loader brad_50">
                                                                    <img title="" alt="" src="/bsf_v1.1/public/images/post-loader.gif">
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="payment-schedule-template" type="text/template">
    <table class="table payment-schedule" data-id="payment_schedule_id__">
        <thead>
        <tr>
            <th>Description</th>
            <th>Date</th>
            <th>Round Off</th>
            <th>Schedule %</th>
            <th>Schedule Amount</th>
            <th>Tax</th>
            <th>Net Amount</th>
            <th></th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</script>
<script type="text/javascript">

    $(function () {
        $(".multiple_dropdown_1").select2({
            tags: true
        });
        var $project_id = $('#project_id'),
            $unit_no = $('#unit_no'),
            $unitnoWrapper = $('#unitno-wrapper'),
            $buyerWrapper = $('#buyer-wrapper'),
            $unitpriceWrapper = $('#unitprice-wrapper'),
            $discountWrapper = $('#discount-wrapper'),
            $advanceWrapper = $('#advance-wrapper'),
            $validWrapper = $('#valid-wrapper'),
            $unit_rate = $('#unit_rate'),
            $discount = $('#discount'),
            $advance_amt = $('#advance_amt'),

            $carousel = $('#carousel'),
            $unitDetailWrapper = $('#unit-detail-wrapper'),
            $booking_date = $('#booking_date'),
            $booking_no = $('#booking_no'),
            $discountTypeWrapper = $('#discount-type-wrapper'),
            $discount_type = $('#discount_type'),
            $unit_id = $('#unit_id'),
            $lumpsum_receipt_wise = $('#lumpsum_receipt_wise'),
            $lumpsumTypeWrapper = $('#lumpsum-type-wrapper'),
            $lumpsumReceiptWiseWrapper = $('#lumpsum-receipt-wise-wrapper'),
            $lumpsumType = $lumpsumTypeWrapper.find('input[name="lumpsum_type"]'),
            $constructionAmt = $('#unitdetail_ConstructionAprediscountmount'),
            $landAmt = $('#unitdetail_LandAmount'),

            $executiveId = $('#executive_id'),
            $projectWrapper = $('#project-wrapper'),
            $areaWrapper = $('#area-wrapper'),
            $unit_area = $('#unit_area'),
        //followup details//
            $status_name=$('#status_name'),
            $status_id=$('#status_id'),
            $nature_name=$('#nature_name'),
            $nature_id=$('#nature_id'),
            $nextfollow_name=$('#nextfollow_name'),
            $nextfollow_id=$('#nextfollow_id'),
            $nextCallDate=$('#nextCallDate'),
            $vehicleAllocation=$('#vehicleAllocation'),
            $pickUpTime=$('#pickUpTime'),
            $pickUpAddress=$('#pickUpAddress'),
            $nextfollowremarks=$('#nextfollowremarks'),
            $actionRequiredBy=$('#actionRequiredBy'),
            $remarks=$('#remarks'),
            $finaliseBtn = $('#finalise-btn'),
            $unitdetail_UnitArea = $('#unitdetail_UnitArea'),
            $unitdetail_Rate = $('#unitdetail_Rate'),
            $unitdetail_BaseAmt = $('#unitdetail_BaseAmt'),
            $unitdetail_GrossAmt = $('#unitdetail_GrossAmount'),
            $unitdetail_OtherCostAmt = $('#unitdetail_OtherCostAmt'),
            $unitdetail_NetAmt = $('#unitdetail_NetAmt'),
        //followup Details//
            isEditMode = <?php echo ($isEditMode)?'true':'false'; ?>;

        $('.datepickerinput').datepicker({
            format: "dd-mm-yyyy",
            startDate: new Date(),
            todayBtn: true,
            orientation: "top auto",
            autoclose: true
        }).on("changeDate", function(e){
            $("#nextCallDate").text($(this).val());
        });

        init();

        bindBookingNo_onChange();

        bindExecutive_onChange();
        bindProject_onChange();
        bindUnit_onChange();
        bindDiscount_onChange();
        bindnextfollowup_onChange();
        bindStatus_autoComplete();
        bindNature_autoComplete();
        bindyes_onChange();
        bindNextBtn_onClick();
        bindFinalise_onClick();
        bindDiscountType_onChange();

        bindLumpsumType_onChange();
        bindLumpsumReceiptWise_onChange();

        if(isEditMode) {
            $unit_no.trigger('change');
        }
        <?php if(isset($saveproj)){?>

        $unit_no.trigger('change');

        load_unitDetails();
        <?php }?>


        function load_unitDetails(callback) {

            var unit_id = $unit_no.val();
            if (/^\d+$/.test(unit_id) === false) {
                return;
            }

            $.ajax({
                url: getBaseURL() + 'crm/lead/unitdetail',
                data: {csrf: "<?php echo isset($csrf)?$csrf:''; ?>", UnitId: unit_id},
                type: 'POST',
                success: function (data, status, xhr) {

                    $.each(data.unit_detail, function (index, detail) {
                        var $tarDetail = $unitDetailWrapper.find('#unitdetail_' + index);

                        if (detail == 0 || detail == null || detail.trim() == '') {
                            $tarDetail.closest('.row').addClass('hide');
                        } else {
                            $tarDetail.closest('.row').removeClass('hide');
                            $tarDetail.text(detail).attr('data-original-value', detail);
                        }
                        if(index!="NetAmt") {
                            $tarDetail.text(detail).attr('data-original-value', detail);
                        } else {
                            $tarDetail.text(sanitizeNumber(detail,2,true)).attr('data-original-value', detail);
                        }
                        if(index=="AdvAmount" || index=="UDSLandArea" || index=="BaseAmt" || index=="GrossAmount" || index=="LandAmount" || index=="Rate" || index=="ConstructionAmount" || index=="GuideLinevalue" || index=="MarketLandValue" || index=="OtherCostAmt" || index=="QualifierAmount") {
                            $tarDetail.text(sanitizeNumber(detail,2,true)).attr('data-original-value', detail);
                        }
                    });

                    if (callback) {
                        callback();
                    }
                },
                error: function (xhr, status, error) {
                    alert(xhr.responseText);
                }
            });
        }


        function init() {

            $carousel.carousel({
                interval: false
            });

            $('.single_dropdown').select2();
            $nextfollow_name.select2();
        }

        function bindyes_onChange() {
            $('input[name="vehicleAllocation"]').on('change', function () {
                if ($('#allo_no').is(':checked')) {
                    $('#timep').hide().find('text').val('');
                    $('#addr').hide().find('textarea').val('');
                } else {
                    $('#timep').show();
                    $('#addr').show();
                }
            });
        }


        function bindnextfollowup_onChange() {
            $nextfollow_name.on('change', function() {
                var sname =$("#nextfollow_name option:selected").text();

                if(sname=='Site Visit'){
                    $('#requ').show();

                } else {
                    $('#requ').hide().find('radio').val('');
                    $('#addr').hide().find('textarea').val('');
                    $('#timep').hide().find('text').val('');
                }
            }).change();
        }


        function bindStatus_autoComplete() {
            $status_name.autocomplete({
                lookup: <?php echo (isset($arrStatus))?json_encode($arrStatus):'[]'; ?>,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        $status_id.val(suggestion.data);

                        removeError($(this));
                    }
                }, onSearchStart: function (suggestion) {
                    $status_id.val('');
                }, onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length) {
                        $status_id.val('');
                        showError($(this), 'Status not found!');
                    } else {
                        removeError($(this));
                    }
                }
            });
        }
        function bindNature_autoComplete() {
            $nature_name.autocomplete({
                lookup: <?php echo (isset($arrNature))?json_encode($arrNature):'[]'; ?>,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        $nature_id.val(suggestion.data);

                        removeError($(this));
                    }
                }, onSearchStart: function (suggestion) {
                    $nature_id.val('');
                }, onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length) {
                        $nature_id.val('');
                        showError($(this), 'Status not found!');
                    } else {
                        removeError($(this));
                    }
                }
            });
        }

        function bindExecutive_onChange() {
            $executiveId.on('change', function() {
                var executiveId = $executiveId.val();

                if(executiveId.length > 0) {
                    $projectWrapper.removeClass('hide');
                }
            });
        }

        function bindBookingNo_onChange() {
            $booking_no.on('change', function() {

                checkBookingNo(function(isSuccess, msg) {
                    if(isSuccess == false) {
                        alert(msg);
                        $booking_no.focus();
                    }
                });
            });

        }
        $('#submit').on('click', function (ev) {
            ev.preventDefault();
            $('#submit').hide();
            $('#post-loader').show();
            validate_step1(function (isSuccess) {
                if (isSuccess) {
                    $('#pre-booking-form').submit();
                } else {
                    $('#submit').show();
                    $('#post-loader').hide();
                }
            });
        });

        function checkBookingNo(callback) {
            var booking_no = $booking_no.val().trim();
            if(booking_no.length <= 0) {
                callback(false, 'Booking No is required!');
                return false;
            } else {
                $.ajax({
                    url: getBaseURL() + 'crm/lead/check-pre-booking-no',
                    data: {csrf: "<?php echo isset($csrf)?$csrf:''; ?>", BookingNo: booking_no},
                    type: 'POST',
                    success: function (data, status, xhr) {

                        if (data.unitPreBooking == false) {
                            $booking_no.addClass('already-exists');
                            callback(data.unitPreBooking, 'Booking No Already exists!');
                            return data.unitPreBooking;
                        } else {
                            $booking_no.removeClass('already-exists');
                            callback(true);
                            return true;
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(xhr.responseText);
                        $booking_no.addClass('already-exists');
                    }
                });
            }
        }
        function bindFinalise_onClick() {

            $finaliseBtn.on('click', function (ev) {
                ev.preventDefault();
                $finaliseBtn.hide();
                $('#ask-post-loader').show();
                validate(function (isSuccess) {
                    if (isSuccess) {
                        $('#pre-booking-form').submit();
                    } else {
                        $finaliseBtn.show();
                        $('#ask-post-loader').hide();
                    }
                });
            });

            function validate(callback) {
                var nextcalldate=$nextCallDate.val(),
                    status=$status_name.val(),
                    nature=$nature_name.val(),
                    nextfollow=$nextfollow_name.val(),
                    vehicle=$vehicleAllocation.val(),
                    timepic	=$pickUpTime.val(),
                    addrpic	=$pickUpAddress.val(),
                    nremarks=$nextfollowremarks.val(),
                    remark=$remarks.val();

                removeError($nextCallDate);
                removeError($status_name);
                removeError($nature_name);
                removeError($nextfollow_name);
                removeError($vehicleAllocation);
                removeError($pickUpTime);
                removeError($pickUpAddress);
                removeError($nextfollowremarks);
                removeError($remarks);


                if  (status.length <= 0) {
                    showError($status_name, 'status is required!');
                    callback(false);
                    return false;
                }
                else if  (nature.length <= 0) {
                    showError($nature_name, 'nature is required!');
                    callback(false);
                    return false;
                }
                else if (nextcalldate.length <= 0) {
                    showError($nextCallDate, 'nextcalldate is required!');
                    callback(false);
                    return false;
                }
                else if  (nextfollow.length <= 0) {
                    showError($nextfollow_name, 'next followup type is required!');
                    callback(false);
                    return false;
                }
                else if(nextfollow == 5 && $('#allo_yes').is(':checked')){

                    if(timepic.length <= 0) {
                        showError($pickUpTime, 'time is required!');
                        callback(false);
                        return false;
                    }
                    else if(addrpic.length <= 0) {
                        showError($pickUpAddress, 'address is required!');
                        callback(false);
                        return false;
                    }
                    else if(nremarks.length <= 0) {
                        showError($nextfollowremarks, 'followpremarks is required!');
                        callback(false);
                        return false;
                    }

                    else if(remarks.length <= 0) {
                        showError($remarks, 'remarks is required!');
                        callback(false);
                        return false;
                    }
                    else{
                        callback(true);
                        return;
                    }
                }
                else if  (nremarks.length <= 0) {
                    showError($nextfollowremarks, 'followpremarks is required!');
                    callback(false);
                    return false;
                }

                else if  (remarks.length <= 0) {
                    showError($remarks, 'remarks is required!');
                    callback(false);
                    return false;
                }
                else{

                    callback(true);
                    return;
                }
            }
        }

        function bindNextBtn_onClick() {
            $('.carousel-next-btn').on('click', function (ev) {

                ev.preventDefault();

                var stepno = parseInt($(this).attr('data-stepno'));
                switch (stepno) {
                    case 2:
                        validate_step1(function (isSuccess) {
                            if (isSuccess) {
                                $carousel.carousel('next');
                            }
                        });
                        break;
                }
            });
        }

        function validate_step1(callback) {
            var project_id = parseInt($project_id.val()),
                booking_no = $booking_no.val().trim(),
                booking_date = $booking_date.val().trim(),
                unit_no = parseInt($unit_no.val()),
                discount = parseFloat($discount.val()),
                discount_type = $discount_type.val(),
                lead_id = $("#leadid").val(),
                advance_amt = parseFloat($advance_amt.val()),
                net_amt = parseFloatVal($unitdetail_NetAmt.text()),

                executive_id = parseInt($executiveId.val());

            removeError($executiveId);
            removeError($project_id);
            removeError($unit_rate);
            removeError($unit_no);
            removeError($advance_amt);
            $discount.trigger('change');

                <?php if(isset($saveproj)) {?>
            if (isNaN(lead_id)|| lead_id==""||lead_id==0) {
                showError($("#leadid"), 'LeadName is required!');

                callback(false);
                return false;
            }
        if (parseFloatVal(advance_amt) > parseFloatVal(net_amt)) {

                showError($advance_amt, 'Advance amount exceeds NetAmount');
                callback(false);
                return false;
            }
            else {
                callback(true);
                return true;
            }

            <?php } ?>


         if(booking_no.length <= 0) {
                alert('Booking No is required!');
                $booking_no.focus();

                callback(false);
                return false;
            } else if($booking_no.hasClass('already-exists')) {
                alert('Booking No already exists!');
                $booking_no.focus();

                callback(false);
                return false;
            } else if(booking_date.length <= 0) {
                alert('Booking Date is required!');
                $booking_date.focus();

                callback(false);
                return false;
            }

            else if (isNaN(project_id)) {
                showError($project_id, 'Project is required!');

                callback(false);
                return false;
            } else if(discount_type != '' && isNaN(discount)) {
                showError($discount, 'Discount is required!');
                $discount.focus();

                callback(false);
                return false;
            } else if($discount.hasClass('error')) {
                callback(false);
                return false;
            }else if (isNaN(advance_amt)) {
                showError($advance_amt, 'Advance amount is required!');

                callback(false);
                return false;
            }


            else {
                callback(true);
                return true;
            }

        }

        function bindDiscount_onChange() {
            $discount.on('change', function () {

                removeError($discount);

                var discount = parseFloat($discount.val()),
                    area = parseFloat($unitdetail_UnitArea.attr('data-original-value')),
                    rate = parseFloat($unitdetail_Rate.attr('data-original-value')),
                    baseAmt = parseFloat($unitdetail_BaseAmt.attr('data-original-value')),
                    grossAmt = parseFloat($unitdetail_GrossAmt.attr('data-original-value')),
                    netAmt = parseFloat($unitdetail_NetAmt.attr('data-original-value')),
                    otherCostAmt = parseFloat($unitdetail_OtherCostAmt.attr('data-original-value'));

                $unitdetail_Rate.text(sanitizeNumber(rate,2,true));
                $unitdetail_BaseAmt.text(sanitizeNumber(baseAmt,2,true));
                $unitdetail_GrossAmt.text(sanitizeNumber(grossAmt,2,true));
                $unitdetail_NetAmt.text(sanitizeNumber(netAmt,2,true));

                if (isNaN(discount) ) {
                    return;
                }
                if ($discount_type.val() == 'L') {
                    // lumpsum
                    var lumpsumType = $lumpsumType.filter(':checked').val();
                    if (lumpsumType == 'O') {
                        // overall
                        if(discount > baseAmt) {
                            showError($discount, 'Discount should be lesser than Base Amount!');
                            return;
                        }

                        baseAmt = baseAmt - discount;
                        grossAmt = baseAmt;
                        netAmt = grossAmt;
                        if (!isNaN(otherCostAmt)) {
                            grossAmt = baseAmt + otherCostAmt;
                            netAmt = grossAmt;
                        }
                    } else {
                        // receipt wise
                        var receiptType = $lumpsum_receipt_wise.val();
                        if(receiptType.length <= 0) {
                            showError($lumpsum_receipt_wise, 'Select Receipt Type!');
                            return;
                        }

                        var $selReceiptType = $lumpsum_receipt_wise.find('option:selected'),
                            selReceipt = $selReceiptType.attr('data-type');

                        if(selReceipt == 'C') {
                            var constAmt = parseFloat($constructionAmt.attr('data-original-value'));
                            if(discount > constAmt) {
                                showError($discount, 'Discount should be lesser than Construction Amount!');
                                return;
                            }
                            constAmt -= discount;
                            $constructionAmt.text(constAmt.toFixed(2));
                        } else if(selReceipt == 'L') {
                            var landAmt = parseFloat($landAmt.attr('data-original-value'));
                            if(discount > landAmt) {
                                showError($discount, 'Discount should be lesser than Land Amount!');
                                return;
                            }
                            landAmt -= discount;
                            $landAmt.text(sanitizeNumber(landAmt,2,true));
                        }

                        baseAmt -= discount;
                    }
                } else if ($discount_type.val() == 'R') {
                    // unit rate
                    if (discount > rate) {
                        showError($discount, 'Discount should be lesser than Unit rate!');
                        return;
                    } else {
                        rate = rate - discount;
                        baseAmt = rate * area;
                    }
                }

                grossAmt = baseAmt;
                netAmt = grossAmt;
                if (!isNaN(otherCostAmt)) {
                    grossAmt = baseAmt + otherCostAmt;
                    netAmt = grossAmt;
                }

                $unitdetail_Rate.text(sanitizeNumber(rate,2,true));
                $unitdetail_BaseAmt.text(sanitizeNumber(baseAmt,2,true));
                $unitdetail_GrossAmt.text(sanitizeNumber(grossAmt,2,true));
                $unitdetail_NetAmt.text(sanitizeNumber(netAmt,2,true));
            });
        }

        function bindUnit_onChange() {
            $unit_no.on('change', function () {

                removeError($unit_no);



                $unit_no.removeAttr('disabled');


                $discountTypeWrapper.removeClass('hide');

            });
        }

        function bindDiscountType_onChange() {
            $discount_type.on('change', function() {

                var discountType = $discount_type.val().trim();

                $discountWrapper.addClass('hide');
                $lumpsumTypeWrapper.addClass('hide');
                $lumpsumReceiptWiseWrapper.addClass('hide');

                $discount.val('').trigger('change');
                $lumpsumType.removeAttr('checked');
                if(discountType.length > 0 ) {
                    if(discountType == 'L') {
                        $lumpsumTypeWrapper.removeClass('hide');
                    } else {
                        $discountWrapper.removeClass('hide');
                    }
                }
            });
        }

        function bindLumpsumType_onChange() {
            $lumpsumType.on('change', function() {

                var lumpsumType = $(this).val();
                if(lumpsumType == 'O') {
                    $discountWrapper.removeClass('hide');
                    $lumpsumReceiptWiseWrapper.addClass('hide');
                } else {
                    $discountWrapper.addClass('hide');
                    $lumpsumReceiptWiseWrapper.removeClass('hide');
                }
                $lumpsum_receipt_wise.find('option').removeAttr('selected');
                $discount.val('').trigger('change');
            });
        }

        function bindLumpsumReceiptWise_onChange() {
            $lumpsum_receipt_wise.on('change', function() {

                var receiptWise = $(this).val();
                if(receiptWise.length > 0) {
                    $discountWrapper.removeClass('hide');
                } else {
                    $discountWrapper.addClass('hide');
                }
                $discount.val('').trigger('change');
            });
        }



        function bindProject_onChange() {
            $project_id.on('change', function () {

                removeError($project_id);

                resetUnitData();

                load_units(function () {
                    $unitnoWrapper.removeClass('hide');
                    $advanceWrapper.removeClass('hide');
                });
            });
        }

        function resetUnitData() {
            $buyerWrapper.addClass('hide');

            $discountWrapper.addClass('hide');
            $discountTypeWrapper.addClass('hide');



            $unit_no.empty().trigger('change');
        }

        function load_units(callback) {

            var project_id = $project_id.val();
            if (/^\d+$/.test(project_id) === false) {
                return;
            }

            $unit_no.attr('disabled', true);

            $.ajax({
                url: getBaseURL() + 'crm/lead/units',
                data: {csrf: "<?php echo isset($csrf)?$csrf:''; ?>", ProjectId: project_id},
                type: 'POST',
                success: function (data, status, xhr) {
                    if (data.units.length > 0) {
                        var opHtml = '<option value=""></option>';
                        $.each(data.units, function (index, unit) {
                            opHtml += '<option value="' + unit.UnitId + '">' + unit.UnitNo + '</option>';
                        });
                        $unit_no.html(opHtml);
                    }

                    $unit_no.removeAttr('disabled');

                    if (callback) {
                        callback();
                    }
                },
                error: function (xhr, status, error) {
                    alert(xhr.responseText);
                }
            });
        }





    });
</script>