<?php $bsf = new \BuildsuperfastClass(); ?>
<div class="content_wrapper padlr0">
	<div class="container-fluid padlr0">
		<div class="col-lg-12">
			<h1 class="float_l">Project Info of
                <div class="btn-group proname_btn">
                    <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"><?php echo ucfirst($projectDetail['ProjectName']);?> <span class="edit_symbols" data-placement="right" data-toggle="tooltip" data-original-title="Choose&nbsp;your&nbsp;project"><i class="fa fa-caret-down "></i></span></a> 							
                    <div class="dropdown-menu toolbar_ddown proname_ddown arrow" role="menu">
                        <ul>
                            <?php foreach($projects as $project){?>
                                <li><a href="<?php echo $this->basePath(); ?>/crm/project/payment-schedule-register/<?php echo $bsf->encode($project['ProjectId']); ?>"><?php echo ucfirst($project['ProjectName']);?></a></li>
                            <?php }	?>
                        </ul>
                    </div>
                </div>
			</h1>
            <div class="promote_social float_r">
                <ul>
                    <span>Promote Project</span>
                    <li><a href="#" class="fb_c ripple"><i class="fa fa-facebook-square"></i></a></li>
                    <li><a href="#" class="twt_c ripple"><i class="fa fa-twitter-square"></i></a></li>
                    <li><a href="#" class="g_c ripple"><i class="fa fa-google-plus-square"></i></a></li>
                </ul>
            </div>
		</div>
		<div class="col-lg-12">
            <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1">
                <div class="col-lg-12">
                    <div class="row">
                        <div class="step_by_liner animated slideInDown"></div>
                        <ul class="step_by stepby_mb60">
                            <li>
                                <div class="step_by_sep animated_0_4s slideInRight"><p>4</p></div>
                                <p class="stepli_p1">Other Cost Details</p>
                            </li>
                            <li>
                                <div class="step_by_sep stepsep_active animated slideInRight"><p>5</p></div>
                                <p class="stepli_p2">Payment Schedule</p>
                            </li>
                            <li class="opacity_08">
                                <div class="step_by_sep animated_1_5s slideInRight"><p>6</p></div>
                                <p class="stepli_p3">Unit Type</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
		</div>
		<div class="col-lg-12 clear">
			<div class="col-lg-12">
                <div class="kickoff_area col-lg-12 clear cnt_slider" style="min-height:400px;">
                    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                        <!-- Wrapper for slides -->
                        <form class="form-horizontal" method="post" id="paymentScheduleForm">
                            <div class="carousel-inner" role="listbox">
                                <div class="item active">
                                    <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 padlr0 m_btm20 unit_kickoff">
                                    	<div class="unitkkoff_topimg unit_topimg_ps"></div>
                                        <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1 padlr0 m_btm20">
                                            <div class="form-group padtop20">
												<input type="hidden" id="paySchHide" name="paySchHide" value="<?php echo $paymentSchedule; ?>" />
                                                <input type="text" id="paymentSchedule" name="paymentSchedule" class="form-control lbl_move m_top10" label="Schedule Name" value="<?php echo $paymentSchedule; ?>" />
                                                <div class="error_message"><p>please enter schedule name...</p></div>
                                            </div>
                                            <div class="form-group">
                                                <select id="scheduleType" name="scheduleType" class="form-control single_dropdown lbl_move" label="Select Schedule Type" style="width:100%;" disabled>
                                                    <option value=""></option>
                                                    <?php foreach($scheduleType as $schType) { ?>
                                                        <option value="<?php echo $schType['ScheduleTypeId']; ?>" <?php if($schType['ScheduleTypeId']==$scheduleTypeId) { ?>selected<?php } ?>><?php echo $schType['ScheduleTypeName']; ?></option>
                                                    <?php } ?>
                                                </select>
                                                <div class="error_message"><p>please select schedule type...</p></div>
                                            </div>
											<div class="form-group">
												<select id="roTypes" name="roTypes[]" multiple="multiple" class="form-control multiple_dropdown lbl_move" label="Select Receipt Types" style="width:100%;">
													<?php foreach($receiptTypeMaster as $receiptType) { ?>
													<option value="<?php echo $receiptType['ReceiptTypeId']; ?>#S" <?php if(in_array($receiptType['ReceiptTypeId'],$selectedRT)) { ?>selected<?php } ?>><?php echo $receiptType['ReceiptTypeName']; ?></option>
													<?php } ?>
													<?php foreach($otherCostMaster as $otherCost) { ?>
													<option value="<?php echo $otherCost['OtherCostId']; ?>#O" <?php if(in_array($otherCost['OtherCostId'],$selectedOC)) { ?>selected<?php } ?>><?php echo $otherCost['OtherCostName']; ?></option>
													<?php } ?>
												</select>
												<div class="error_message"><p>please select receipt types...</p></div>
											</div>
											<div class="form-group">
												<label>Booking Advance Included?</label>
												<div class="radio_check">
													<p>
														<input type="radio" value="1" id="advanceIncludedYes" name="advanceIncluded" <?php if($includeAdvance==1) { ?>checked<?php } ?> />
														<label for="advanceIncludedYes" class="ripple" style="width:100%;">Yes</label>
													</p>
													<p>
														<input type="radio" value="0" id="advanceIncludedNo" name="advanceIncluded" <?php if($includeAdvance==0) { ?>checked<?php } ?> />
														<label for="advanceIncludedNo" class="ripple" style="width:100%;">No</label>
													</p>
												</div>
											</div>
                                    	</div>    
                                        <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
                                            <ul>
                                                <li class="dropdown save_btn float_r">
                                                    <a class="ripple" href="javascript:void(0);" onclick="return paymentScheduleValidate();" data-toggle="tooltip" data-placement="left" title="Continue">Continue</a>
												</li>	
                                            </ul>
                                        </div>    
                                    </div>
                                </div>
								<div class="item">
									<div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2">
                                        <div class="table-responsive clear">
											<h1>Selected Receipt Types</h1>
											<?php //$srtId = array(); ?>
											<table class="table table-hover m_btm0 clear" id="receiptTypeTable">
                                                <thead>
                                                    <tr>
                                                        <th style="width:50px;">Sl. No.</th>
                                                        <th>Name</th>
														<th style="display:none;"></th>
                                                    </tr>
                                                </thead>
                                                <tbody class="sorting">
													<?php
													$rot = 1;
													foreach($psReceiptTrans as $rTrans) {
														//$srtId[] = $rTrans['ReceiptTypeId'].'#'.$rTrans['ReceiptType'];
													?>
													<tr id="rtRowId_<?php echo $rot; ?>">
														<input type="hidden" id="rtSortId_<?php echo $rot; ?>" name="rtSortId_<?php echo $rot; ?>" value="<?php echo $rTrans['SortId']; ?>" />
														<input type="hidden" id="rtTypeId_<?php echo $rot; ?>" name="rtTypeId_<?php echo $rot; ?>" value="<?php echo $rTrans['ReceiptTypeId']; ?>" />
														<input type="hidden" id="rtTypeType_<?php echo $rot; ?>" name="rtTypeType_<?php echo $rot; ?>" value="<?php echo $rTrans['ReceiptType']; ?>" />
														<td id="rtRowSlNo_<?php echo $rot; ?>" style="width:50px;"><?php echo $rot; ?></td>
														<td><?php echo $rTrans['ReceiptTypeName']; ?></td>
														<td style="display:none;"><?php echo $rTrans['ReceiptTypeId'].'#'.$rTrans['ReceiptType']; ?></td>
													</tr>
													<?php $rot++;
													} ?>
                                                </tbody>
                                            </table>
										</div>
										<div class="col-lg-12 savebtn_area padlr0 marg0 clear">
                                            <ul>
                                                <li class="dropdown save_btn float_r">
                                                    <a class="ripple" href="javascript:void(0);" onclick="return continueNow();" data-toggle="tooltip" data-placement="left" title="Continue">Continue</a>
												</li>	
                                            </ul>
                                        </div>
									</div>
								</div>
                                <div class="item">
                                    <div id="percentError" class="error_message" style="right:15px;top:9px;"><p>(it should be equal to 100%...)</p></div>
									<div id="chkboxError" class="error_message" style="position:inherit !important;"><p>(please check booking advance deductible in any one of the stages)</p></div>
                                    <div class="col-lg-12">
                                        <div id="mainTableDiv" class="table-responsive clear">
                                            <table class="table table-hover m_btm0 clear" id="paySchTable">
                                                <thead>
                                                    <tr>
														<th style="width:50px;">Sl. No.</th>
                                                        <th style="width:150px;">Description</th>
                                                        <th style="width:300px;">Date</th>
                                                        <th style="width:100px;">Round Off</th>
                                                        <th style="width:300px;">Schedule %</th>
														<th style="width:150px;"></th>
                                                    </tr>
                                                </thead>
                                                <tbody class="psSorting">
													<?php
													$i = 1;
													foreach($paySchRes as $paySch) {
													?>
													<tr class="psClass" id="psRowId_<?php echo $i; ?>">
														<td id="psRowSlNo_<?php echo $i; ?>" style="width:50px;"><?php echo $i; ?></td>
														<td><input type="hidden" id="paySchDetId_<?php echo $i; ?>" name="paySchDetId_<?php echo $i; ?>" value="<?php echo $paySch['PaymentScheduleDetailId']; ?>" /><input type="hidden" id="scheduleId_<?php echo $i; ?>" name="scheduleId_<?php echo $i; ?>" value="<?php echo $paySch['StageId']; ?>" /> <input type="hidden" id="description_<?php echo $i; ?>" name="description_<?php echo $i; ?>" value="<?php echo $paySch['StageName']; ?>" class="auto-complete" /> <?php echo $paySch['StageName']; ?></td>
														<td class="tbl_input_td">
															<input type="hidden" id="psSortId_<?php echo $i; ?>" name="psSortId_<?php echo $i; ?>" value="<?php echo $paySch['SortId']; ?>" />
															<?php if($paySch['IsAdvance']==1) { ?>
																<div class="radio_check">
																	<p>
																		<input type="radio" value="1" id="advPercent_<?php echo $i; ?>" name="advAmount_<?php echo $i; ?>" <?php if($paySch['IsValue']==1) { ?>checked<?php } ?> onclick="return changeType('1', '<?php echo $i; ?>');" />
																		<label for="advPercent_<?php echo $i; ?>" class="ripple" style="width:100%;">Percentage</label>
																	</p>
																	<p>
																		<input type="radio" value="2" id="advAmt_<?php echo $i; ?>" name="advAmount_<?php echo $i; ?>" <?php if($paySch['IsValue']==2) { ?>checked<?php } ?> onclick="return changeType('2', '<?php echo $i; ?>');" />
																		<label for="advAmt_<?php echo $i; ?>" class="ripple" style="width:100%;">Amount</label>
																	</p>
																</div>
															<?php } else { ?>
																<a class="choosendate_a" id="showTag_<?php echo $i; ?>" href="javascript:void(0);" onclick="return showHideDiv('<?php echo $i; ?>', '1');"><span><i class="fa fa-pencil-square-o"></i></span> Edit</a>
																<div id="paySch_<?php echo $i; ?>" class="choosendate_div" style="display:none;">
																	<ul>
																		<li>
																			<label for="dateFrom_<?php echo $i; ?>">Date From</label>
																			<select id="dateFrom_<?php echo $i; ?>" name="dateFrom_<?php echo $i; ?>" onchange="return dateFromFn('<?php echo $i; ?>', this.value)">
																				<option value="0" <?php if($paySch['DateFrom']=='0') { ?>selected<?php } ?>>None</option>
																				<option value="F" <?php if($paySch['DateFrom']=='F') { ?>selected<?php } ?>>Finalize Date</option>
																				<option value="S" <?php if($paySch['DateFrom']=='S') { ?>selected<?php } ?>>Start Date</option>
																				<option value="E" <?php if($paySch['DateFrom']=='E') { ?>selected<?php } ?>>End Date</option>
																			</select>
																		</li>
																		<?php
																		$aChecked = '';
																		$bChecked = '';
																		if($paySch['DateFrom']=='S' || $paySch['DateFrom']=='E') {
																			if($paySch['DateAfterBefore']=='1') {
																				$aChecked = 'checked';
																			} else {
																				$bChecked = 'checked';
																			}
																		} else {
																			$aChecked = 'checked';
																		}
																		?>
																		<li id="radioDiv_<?php echo $i; ?>" style="display:none;">
																			<div class="radio_check">
																				<p>
																					<input type="radio" value="1" id="dateAf_<?php echo $i; ?>" name="dateAfBef_<?php echo $i; ?>" <?php echo $aChecked; ?> />
																					<label for="dateAf_<?php echo $i; ?>" class="ripple" style="width:100%;">Date After</label>
																				</p>
																				<p>
																					<input type="radio" value="2" id="dateBef_<?php echo $i; ?>" name="dateAfBef_<?php echo $i; ?>" <?php echo $bChecked; ?> />
																					<label for="dateBef_<?php echo $i; ?>" class="ripple" style="width:100%;">Date Before</label>
																				</p>
																			</div>
																		</li>
																		<li id="durationDiv_<?php echo $i; ?>" style="display:none;">
																			<label>Duration</label>
																			<select id="duration_<?php echo $i; ?>" name="duration_<?php echo $i; ?>" style="width:80px;">
																				<option value="0" <?php if($paySch['DurationType']=='0') { ?>selected<?php } ?>>None</option>
																				<option value="1" <?php if($paySch['DurationType']=='1') { ?>selected<?php } ?>>Day</option>
																				<option value="2" <?php if($paySch['DurationType']=='2') { ?>selected<?php } ?>>Month</option>
																			</select>
																			<input type="text" id="days_<?php echo $i; ?>" name="days_<?php echo $i; ?>" class="tbl_input dy_mn_input" value="<?php echo $paySch['DurationDays']; ?>" />
																		</li>
																		<li id="dateDiv_<?php echo $i; ?>">
																			<div class="dt_input_div">
																				<span class="date_icon"><i class="fa fa-calendar"></i></span>
																				<input type="text" id="date_<?php echo $i; ?>" name="date_<?php echo $i; ?>" class="date_picker tbl_input dt_input" value="<?php echo date('d-m-Y', strtotime($paySch['Date'])); ?>" />
																			</div>
																		</li>
																	</ul>
																</div>
																<a class="choosendate_a" id="hideTag_<?php echo $i; ?>" href="javascript:void(0);" onclick="return showHideDiv('<?php echo $i; ?>', '0');" style="display:none;"><span><i class="fa fa-check-square"></i><span> OK</a>
															<?php } ?>
														</td>
														<td class="tbl_input_td"><input type="hidden" id="chosenType_<?php echo $i; ?>" name="chosenType_<?php echo $i; ?>" value="<?php echo $paySch['StageType']; ?>" /><?php if($paySch['IsAdvance']==0) { ?><input type="text" class="tbl_input" id="roundOff_<?php echo $i; ?>" name="roundOff_<?php echo $i; ?>" value="<?php echo $paySch['RoundOff']; ?>" onKeyPress="return isNumberKey(event);" /><?php } ?></td>
														<td class="tbl_input_td">
															<?php if($paySch['IsAdvance']==1) { ?>
															<div id="amountDiv_<?php echo $i; ?>" <?php if($paySch['IsValue']==1) { ?>style="display:none;"<?php } ?>><input type="text" class="tbl_input" id="amount_<?php echo $i; ?>" name="amount_<?php echo $i; ?>" value="<?php if($paySch['IsValue']==2) { echo $paySch['Amount']; } ?>" onKeyPress="return isNumberKey(event);" onfocus="return showReceipt('<?php echo $i; ?>', '1')" /></div>
															<?php } ?>
															<div id="percentDiv_<?php echo $i; ?>" <?php if($paySch['IsValue']==2) { ?>style="display:none;"<?php } ?>>
																<input type="text" class="tbl_input" id="percentage_<?php echo $i; ?>" name="percentage_<?php echo $i; ?>" value="<?php echo $paySch['Percentage']; ?>" onfocus="return showReceipt('<?php echo $i; ?>', '1')" onblur="return calPercent();" />
															</div>
                                                            <input type="hidden" id="bookAdvDet_<?php echo $i; ?>" value="<?php echo $paySch['IsAdvanceDeductible']; ?>" />
															<div id="receiptDiv_<?php echo $i; ?>" style="display:none;">
															</div>
															<a class="choosendate_a" id="hidePerTag_<?php echo $i; ?>" href="javascript:void(0);" onclick="return showReceipt('<?php echo $i; ?>', '0');" style="display:none;"><span><i class="fa fa-check-square"></i><span> OK</a>
														</td>
														<td class="tbl_input_td"></td>
													</tr>
													<?php $i++;
													} ?>
                                                </tbody>
                                            </table>
                                        </div>
                                        <input type="hidden" id="psCount" name="psCount" value="<?php echo count($paySchRes); ?>" />
										<input type="hidden" id="projectId" name="projectId" value="<?php echo $bsf->encode($projectId); ?>" />
										<input type="hidden" id="paymentScheduleId" name="paymentScheduleId" value="<?php echo $paymentScheduleId; ?>" />
										<input type="hidden" id="psrtCount" name="psrtCount" value="<?php echo count($psReceiptTrans); ?>" />
										<input type="hidden" id="typeSch" name="typeSch" value="<?php echo $scheduleTypeId; ?>" />
										<input type="hidden" id="advBookId" name="advBookId" value="<?php echo $bookingAdvanceMaster['BookingAdvanceId']; ?>" />
										<input type="hidden" id="advBookName" name="advBookName" value="<?php echo $bookingAdvanceMaster['BookingAdvanceName']; ?>" />
										<input type="hidden" id="hidIncAdv" name="hidIncAdv" value="<?php echo $includeAdvance; ?>" />
										<input type="hidden" id="hidPsCount" name="hidPsCount" value="<?php echo count($paySchRes); ?>" />
										<?php $psId = array(); ?>
                                        <div>
                                            <table class="table table-hover m_btm0 clear">
                                                <tbody>
                                                <tr>
                                                    <td style="width:600px;text-align:right;font-weight:bold;">% Total</td>
                                                    <td style="width:300px;"><input type="text" class="tbl_input" id="totalPercent" value="" readonly /></td>
                                                    <td style="width:150px;"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <a id="addNewId" class="onbrd_addnew ripple float_l" href="javascript:void(0);" onclick="return addNewRow();">Add New</a>
                                        <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
                                            <ul>
                                                <li class="dropdown save_btn float_r">
                                                	<a href="javascript:void(0);" onclick="return paySchValidate();" data-toggle="tooltip" data-placement="left" class="ripple" title="Submit">Submit</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
								<!-- Controls -->
                                <ul class="prev_next">
                                    <li class="float_l" id="backPrev">
                                        <a href="#carousel-example-generic" data-slide="prev" onclick="return getValueOfSlider('prev');">
                                            <span><i class="fa fa-arrow-left"></i></span>
                                        </a>
                                    </li>
<!--                                    <li class="float_r" id="backNext">-->
<!--                                        <a href="#carousel-example-generic" role="button" data-slide="next" onclick="return getValueOfSlider('next');">-->
<!--                                            <span><i class="fa fa-arrow-right"></i></span>-->
<!--                                        </a>-->
<!--                                    </li>-->
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
		</div>
	</div>
</div>
<div class="col-lg-12 savebtn_area">
	<ul>
		<li class="goto">
			<label for="go_to" class="float_l">Go to</label> 
			<select id="projectSteps" name="go_to" class="float_l goto_select">
				<option value="general" <?php if($this->currentRequest()->get('action') == 'general') { echo 'selected'; } ?>>General</option>
				<option value="land-area" <?php if($this->currentRequest()->get('action') == 'land-area') { echo 'selected'; } ?>>Area Details</option>
				<option value="land-cost" <?php if($this->currentRequest()->get('action') == 'land-cost') { echo 'selected'; } ?>>Land Cost Calculation</option>
				<option value="other-cost" <?php if($this->currentRequest()->get('action') == 'other-cost') { echo 'selected'; } ?>>Other Cost Details</option>
				<option value="payment" <?php if($this->currentRequest()->get('action') == 'payment-schedule' || $this->currentRequest()->get('action') == 'payment-schedule-edit' || $this->currentRequest()->get('action') == 'payment-schedule-register' || $this->currentRequest()->get('action') == 'payment') { echo 'selected'; } ?>>Payment Schedule</option>
				<option value="unit-type-register" <?php if($this->currentRequest()->get('action') == 'unit-type-generation' || $this->currentRequest()->get('action') == 'unit-type') { echo 'selected'; } ?>>Unit Type</option>
				<option value="facility" <?php if($this->currentRequest()->get('action') == 'facility' || $this->currentRequest()->get('action') == 'car-park' || $this->currentRequest()->get('action') == 'other-facility') { echo 'selected'; } ?>>Facility Management</option>
				<option value="checklist" <?php if($this->currentRequest()->get('action') == 'checklist') { echo 'selected'; } ?>>Check List Management</option>
				<option value="penality-interestrate" <?php if($this->currentRequest()->get('action') == 'penality-interestrate') { echo 'selected'; } ?>>Penality & Interest Rate</option>
				<option value="incentive-register" <?php if($this->currentRequest()->get('action') == 'incentive-register') { echo 'selected'; } ?>>Incentive Management</option>
			</select> 
		</li>
	</ul>
</div>
<script type="text/javascript">
$('.cnt_slider .carousel').carousel({
	interval: false
});
$(document).ready(function() {
	$(".single_dropdown").select2({
		placeholder: "",
		allowClear: true,
	});
	$(".multiple_dropdown").select2({
	});
});

var paySchA = [];
var paySchTbContent = $('#paySchTable tbody.psSorting').html();

function paymentScheduleValidate()
{
	$('.error_message').hide();
	var sFlag = 0;
	if($.trim($('#paymentSchedule').val()) == '') {
		$('#paymentSchedule').closest('.form-group').find(".error_message").show();
		$('#paymentSchedule').focus();
		sFlag = 1;
		return false;
	}
	if($('#scheduleType').val() == '') {
		$('#scheduleType').closest('.form-group').find(".error_message").show();
		$('#scheduleType').focus();
		sFlag = 1;
		return false;
	}
	if($("#roTypes option:selected").length == 0){
		$('#roTypes').closest('.form-group').find(".error_message").show();
		$('#roTypes').focus();
		sFlag = 1;
		return false;
	}
	
	if(sFlag == 0) {
		if($('#paySchHide').val()!=$('#paymentSchedule').val()) {
			$.post(getBaseURL()+'crm/project/check-name', { psName: $('#paymentSchedule').val() },
			function(data) {
				var chkCount = JSON.parse(data);
				if(chkCount.Count != 0) {
					$('#paymentSchedule').closest('.form-group').find(".error_message").show();
					$('#paymentSchedule').closest('.form-group').find(".error_message").html('<p>this one already exists!</p>');
					$('#paymentSchedule').focus();
				} else {
					getValueOfSlider('next');
					continueNowRT();
					$('#carousel-example-generic').carousel({
						slide: "next"
					});
				}
			});
		} else {
			getValueOfSlider('next');
			continueNowRT();
			$('#carousel-example-generic').carousel({
				slide: "next"
			});
		}
	}
	return false;
}

function continueNowRT()
{
	$('#receiptTypeTable tbody').html('');
	var rti = 1;
	$('#roTypes :selected').each(function(){
		var roTypo = $(this).val().split("#");
		if(roTypo[1] == 'O') {
			paySchA.push($(this).text());
		}
		$('#receiptTypeTable tbody').append(
			'<tr id="rtRowId_'+rti+'">'+
				'<input type="hidden" id="rtSortId_'+rti+'" name="rtSortId_'+rti+'" value="'+rti+'" />'+
				'<input type="hidden" id="rtTypeId_'+rti+'" name="rtTypeId_'+rti+'" value="'+roTypo[0]+'" />'+
				'<input type="hidden" id="rtTypeType_'+rti+'" name="rtTypeType_'+rti+'" value="'+roTypo[1]+'" />'+
				'<td id="rtRowSlNo_'+rti+'" style="width:50px;">'+rti+'</td>'+
				'<td>'+$(this).text()+'</td>'+
				'<td style="display:none;">'+$(this).val()+'</td>'+
			'</tr>'
		);
		rti++;
	});
}

//for adding new rt and removing rt --- dont delete now
//var srtArr = [];
/*var srtId = <?php echo json_encode($srtId); ?>;
function continueNowRT()
{
	var rti = $('#psrtCount').val();
	$('#roTypes :selected').each(function(){
		srtArr.push($(this).val());
		if($.inArray($(this).val(), srtId) == -1) {
			var roTypo = $(this).val().split("#");
			if(roTypo[1] == 'O') {
				paySchA.push($(this).text());
			}
			$('#receiptTypeTable tbody').append(
				'<tr id="rtRowId_'+rti+'">'+
					'<input type="hidden" id="rtSortId_'+rti+'" name="rtSortId_'+rti+'" value="'+rti+'" />'+
					'<input type="hidden" id="rtTypeId_'+rti+'" name="rtTypeId_'+rti+'" value="'+roTypo[0]+'" />'+
					'<input type="hidden" id="rtTypeType_'+rti+'" name="rtTypeType_'+rti+'" value="'+roTypo[1]+'" />'+
					'<td id="rtRowSlNo_'+rti+'" style="width:50px;">'+rti+'</td>'+
					'<td>'+$(this).text()+'</td>'+
					'<td style="display:none;">'+$(this).val()+'</td>'+
				'</tr>'
			);
			rti++;
		}
	});
	var rot = 1;
	$('#receiptTypeTable tbody tr').each(function() {
		var rtIddd = $(this).find("td:last").text();
		if($.inArray(rtIddd, srtArr) == -1) {
			$('#rtRowId_'+rot).remove();
		}
		rot++;
	});
}*/

function continueNow()
{
	$('#paySchTable tbody.psSorting').html('');
	$('#paySchTable tbody.psSorting').html(paySchTbContent);
	$('#psCount').val($('#hidPsCount').val());
	autoRetainFn();
	
	if($('#scheduleType').val() == '1') {
		var advInc = $("input[name='advanceIncluded']:checked").val();
		var hidAdvInc = $('#hidIncAdv').val();
		
		if(hidAdvInc != advInc) {
			var psc = $('#psCount').val();
			var tpsc = (parseInt(psc) + parseInt(1));
			$('#psCount').val(tpsc);
		
			if(advInc == 0) {
				$('#psRowId_1').remove();
				for(k=2;k<=psc;k++) {
					var nk = (parseInt(k) - parseInt(1));
					$('#psRowSlNo_'+k).html(nk);
				}
			} else {
				var advId = $('#advBookId').val();
				var advName = $('#advBookName').val();
				
				$('#paySchTable tbody.psSorting').append(
					'<tr class="psClass" id="psRowId_'+tpsc+'">'+
						'<td id="psRowSlNo_'+tpsc+'" style="width:50px;">'+tpsc+'</td>'+
						'<td><input type="hidden" id="scheduleId_'+tpsc+'" name="scheduleId_'+tpsc+'" value="'+advId+'" /> <input type="hidden" id="description_'+tpsc+'" name="description_'+tpsc+'" value="'+advName+'" class="auto-complete" /> '+advName+'</td>'+
						'<td class="tbl_input_td">'+
							'<input type="hidden" id="psSortId_'+tpsc+'" name="psSortId_'+tpsc+'" value="'+tpsc+'" />'+
							'<div class="radio_check">'+
								'<p>'+
									'<input type="radio" value="1" id="advPercent_'+tpsc+'" name="advAmount_'+tpsc+'" checked onclick="return changeType(\'1\', \''+tpsc+'\');" />'+
									'<label for="advPercent_'+tpsc+'" class="ripple" style="width:100%;">Percentage</label>'+
								'</p>'+
								'<p>'+
									'<input type="radio" value="2" id="advAmt_'+tpsc+'" name="advAmount_'+tpsc+'" onclick="return changeType(\'2\', \''+tpsc+'\');" />'+
									'<label for="advAmt_'+tpsc+'" class="ripple" style="width:100%;">Amount</label>'+
								'</p>'+
							'</div>'+
						'</td>'+
						'<td class="tbl_input_td"><input type="hidden" id="chosenType_'+tpsc+'" name="chosenType_'+tpsc+'" value="A" /></td>'+
						'<td class="tbl_input_td">'+
							'<div id="amountDiv_'+tpsc+'" style="display:none;"><input type="text" class="tbl_input" id="amount_'+tpsc+'" name="amount_'+tpsc+'" value="" onKeyPress="return isNumberKey(event);" onfocus="return showReceipt(\''+tpsc+'\', \'1\')" /></div>'+
							'<div id="percentDiv_'+tpsc+'">'+
								'<input type="text" class="tbl_input" id="percentage_'+tpsc+'" name="percentage_'+tpsc+'" value="" onfocus="return showReceipt(\''+tpsc+'\', \'1\')" onblur="return calPercent();" />'+
							'</div>'+	
							'<div id="receiptDiv_'+tpsc+'" style="display:none;">'+
							'</div>'+
							'<a class="choosendate_a" id="hidePerTag_'+tpsc+'" href="javascript:void(0);" onclick="return showReceipt(\''+tpsc+'\', \'0\');" style="display:none;"><span><i class="fa fa-check-square"></i><span> OK</a>'+
						'</td>'+
						'<td class="tbl_input_td"></td>'+
					'</tr>'
				);
			}
		}
		
		var psc = $('#psCount').val();
		for(tpsc=1;tpsc<=psc;tpsc++) {
			var rta = 1;
			var receiptTypeData = '';
			receiptTypeData += '<div class="choosendate_div">'+
							'<table class="table table-hover m_btm0 clear" id="eachStageTable_'+tpsc+'">'+
								'<tbody class="esSorting">';
			$('#receiptTypeTable tbody tr').each(function() {
				var rtName = $(this).find("td").eq(1).text();
				var rtIddd = $(this).find("td:last").text();
				
				receiptTypeData += '<tr id="esRowId_'+tpsc+'_'+rta+'">'+
										'<input type="hidden" id="receiptType_'+tpsc+'_'+rta+'" name="receiptType_'+tpsc+'_'+rta+'" value="'+rtIddd+'" tagname="receiptType_'+tpsc+'" />'+
										'<input type="hidden" id="esSortId_'+tpsc+'_'+rta+'" name="esSortId_'+tpsc+'_'+rta+'" value="'+rta+'" tagname="esSortId_'+tpsc+'" />'+
										'<td>'+rtName+'</td>'+
									'</tr>';
				rta++;
			});
			
			receiptTypeData += '</tbody>'+
							'</table>';
			if(advInc == 0) {
                if($('#bookAdvDet_'+tpsc).val() == '1') {
                    var isAdvDec = 'checked';
                } else {
                    var isAdvDec = '';
                }
				receiptTypeData += '<ul><li><div class="radio_check"><p><input type="checkbox" '+isAdvDec+' class="tbl_input" id="isAdvanceDeductible_'+tpsc+'" name="isAdvanceDeductible_'+tpsc+'" value="1" tagname="isAdvanceDeductible" /> <label class="ripple" for="isAdvanceDeductible_'+tpsc+'" style="width:100%;">Booking Advance Deductible?</label></p></div></li></ul>';
			}
			receiptTypeData += '</div>';
		
			$('#receiptDiv_'+tpsc).html(receiptTypeData);
			
			var $esBody = $('table[id*=eachStageTable_'+tpsc+'] tbody.esSorting');
			$esBody.sortable({
				helper: fixHelperModified,
				stop: updateIndex,
				axis: 'y',
				distance: 40,
				update: function( event, ui ) {
					var ifrow = event.target.children[0].id.split("_")[1];
					esSortOrder(tpsc);
				}
			});
		}
		getValueOfSlider('next');
		$('#carousel-example-generic').carousel({
			slide: "next"
		});
	} else {
		$("#paymentScheduleForm").submit();
	}
	bindDatePicker();
}

function addNewRow()
{
	var advInc = $("input[name='advanceIncluded']:checked").val();
	
	var psc = $('#psCount').val();
	var tpsc = (parseInt(psc) + parseInt(1));
	$('#psCount').val(tpsc);
	
	var dateFromData = '';
	var receiptTypeData = '';
	var rta = 1;
	receiptTypeData += '<div class="choosendate_div">'+
							'<table class="table table-hover m_btm0 clear" id="eachStageTable_'+tpsc+'">'+
								'<tbody class="esSorting">';
				$('#receiptTypeTable tbody tr').each(function() {
					var rtName = $(this).find("td").eq(1).text();
					var rtIddd = $(this).find("td:last").text();
					
					receiptTypeData += '<tr id="esRowId_'+tpsc+'_'+rta+'">'+
										'<input type="hidden" id="receiptType_'+tpsc+'_'+rta+'" name="receiptType_'+tpsc+'_'+rta+'" value="'+rtIddd+'" tagname="receiptType_'+tpsc+'" />'+
										'<input type="hidden" id="esSortId_'+tpsc+'_'+rta+'" name="esSortId_'+tpsc+'_'+rta+'" value="'+rta+'" tagname="esSortId_'+tpsc+'" />'+
										'<td>'+rtName+'</td>'+
									'</tr>';
					rta++;
				});
				if(advInc == 0) {
					receiptTypeData += '<ul><li><div class="radio_check"><p><input type="checkbox" class="tbl_input" id="isAdvanceDeductible_'+tpsc+'" name="isAdvanceDeductible_'+tpsc+'" value="1" tagname="isAdvanceDeductible" /> <label class="ripple" for="isAdvanceDeductible_'+tpsc+'" style="width:100%;">Booking Advance Deductible?</label></p></div></li></ul>';
				}
			receiptTypeData += '</tbody>'+
							'</table>'+
						'</div>';
	
	if(advInc == 0) {
		var idfd = 1;
	} else {
		var idfd = 2;
	}
	if(tpsc > 1) {
		for(dfd=idfd;dfd<(tpsc);dfd++) {
			if($('#scheduleId_'+dfd).val() != '' && $('#chosenType_'+dfd).val() != 'A') {
				dateFromData += '<option value="'+$('#scheduleId_'+dfd).val()+'#'+$('#chosenType_'+dfd).val()+'">'+$('#description_'+dfd).val()+'</option>';
			}
		}
	}
	
	$('#paySchTable tbody.psSorting').append(
		'<tr class="psClass" id="psRowId_'+tpsc+'">'+
			'<td id="psRowSlNo_'+tpsc+'" style="width:50px;">'+tpsc+'</td>'+
			'<td class="tbl_input_td"><input type="hidden" id="scheduleId_'+tpsc+'" name="scheduleId_'+tpsc+'" value="" tagname="scheduleId" /> <input type="text" id="description_'+tpsc+'" name="description_'+tpsc+'" value="" class="auto-complete tbl_input" tagname="description" /></td>'+
			'<td class="tbl_input_td">'+
				'<input type="hidden" id="psSortId_'+tpsc+'" name="psSortId_'+tpsc+'" value="'+tpsc+'" />'+
				'<a class="choosendate_a" id="showTag_'+tpsc+'" href="javascript:void(0);" onclick="return showHideDiv(\''+tpsc+'\', \'1\');"><span><i class="fa fa-pencil-square-o"></i></span> Edit</a>'+
				'<div id="paySch_'+tpsc+'" class="choosendate_div" style="display:none;">'+
					'<ul>'+
						'<li>'+
							'<label for="dateFrom_'+tpsc+'">Date From</label>'+
							'<select id="dateFrom_'+tpsc+'" name="dateFrom_'+tpsc+'" onchange="return dateFromFn(\''+tpsc+'\', this.value)">'+
								'<option value="0">None</option>'+
								'<option value="F">Finalize Date</option>'+
								'<option value="S">Start Date</option>'+
								'<option value="E">End Date</option>'+
								dateFromData+
							'</select>'+
						'</li>'+
						'<li id="radioDiv_'+tpsc+'" style="display:none;">'+
							'<div class="radio_check">'+
								'<p>'+
									'<input type="radio" value="1" id="dateAf_'+tpsc+'" name="dateAfBef_'+tpsc+'" tagname="dateAfBef" checked />'+
									'<label for="dateAf_'+tpsc+'" class="ripple" style="width:100%;">Date After</label>'+
								'</p>'+
								'<p>'+
									'<input type="radio" value="2" id="dateBef_'+tpsc+'" name="dateAfBef_'+tpsc+'" tagname="dateAfBef" />'+
									'<label for="dateBef_'+tpsc+'" class="ripple" style="width:100%;">Date Before</label>'+
								'</p>'+
							'</div>'+
						'</li>'+
						'<li id="durationDiv_'+tpsc+'" style="display:none;">'+
							'<label>Duration</label>'+
							'<select tagname="duration" id="duration_'+tpsc+'" name="duration_'+tpsc+'" style="width:80px;">'+
								'<option value="0">None</option>'+
								'<option value="1">Day</option>'+
								'<option value="2">Month</option>'+
							'</select>'+
							'<input type="text" id="days_'+tpsc+'" class="tbl_input dy_mn_input" name="days_'+tpsc+'" value="" tagname="days" />'+
						'</li>'+
						'<li id="dateDiv_'+tpsc+'">'+
							'<div class="dt_input_div">'+
								'<span class="date_icon"><i class="fa fa-calendar"></i></span>'+
								'<input type="text" id="date_'+tpsc+'" name="date_'+tpsc+'" class="date_picker tbl_input dt_input" value="" tagname="date" />'+
							'</div>'+
						'</li>'+
					'</ul>'+
				'</div>'+
				'<a class="choosendate_a" id="hideTag_'+tpsc+'" href="javascript:void(0);" onclick="return showHideDiv(\''+tpsc+'\', \'0\');" style="display:none;"><span><i class="fa fa-check-square"></i><span> OK</a>'+
			'</td>'+
			'<td class="tbl_input_td"><input type="hidden" id="chosenType_'+tpsc+'" name="chosenType_'+tpsc+'" value="" tagname="chosenType" /><input type="text" class="tbl_input" id="roundOff_'+tpsc+'" name="roundOff_'+tpsc+'" value="" onKeyPress="return isNumberKey(event);" tagname="roundOff" /></td>'+
			'<td class="tbl_input_td">'+
				'<div id="percentDiv_'+tpsc+'">'+
					'<input type="text" class="tbl_input" id="percentage_'+tpsc+'" name="percentage_'+tpsc+'" value="" onfocus="return showReceipt(\''+tpsc+'\', \'1\')" onblur="return calPercent();" tagname="percentage" />'+
				'</div>'+
				'<div id="receiptDiv_'+tpsc+'" style="display:none;">'+
					'<div id="receiptPerError_'+tpsc+'" class="error_message" style="right:15px;"><p>please select atleast one receipt type...</p></div>'+
					receiptTypeData+
				'</div>'+
				'<a class="choosendate_a" id="hidePerTag_'+tpsc+'" href="javascript:void(0);" onclick="return showReceipt(\''+tpsc+'\', \'0\');" style="display:none;"><span><i class="fa fa-check-square"></i><span> OK</a>'+
			'</td>'+
			'<td class="tbl_input_td">'+
				'<select class="descript_select" id="chooseInsType_'+tpsc+'" name="chooseInsType_'+tpsc+'">'+
					'<option value="0">None</option>'+
					'<option value="S">Stage</option>'+
					'<option value="D">Description</option>'+
				'</select>'+
			'</td>'+
		'</tr>'
	);
	
	var $esBody = $('table[id*=eachStageTable_'+tpsc+'] tbody.esSorting');
	$esBody.sortable({
		helper: fixHelperModified,
		stop: updateIndex,
		axis: 'y',
		distance: 40,
		update: function( event, ui ) {
			var ifrow = event.target.children[0].id.split("_")[1];
			esSortOrder(tpsc);
		}
	});
	
	bindDatePicker();
	bindAutoComplete();
}

function changeType(chTy, chId)
{
	if(chTy==1) {
        $('#amount_'+chId).val('');
		$('#amountDiv_'+chId).hide();
		$('#percentDiv_'+chId).show();
	} else if(chTy==2) {
        $('#percentage_'+chId).val('');
        calPercent();
		$('#percentDiv_'+chId).hide();
		$('#amountDiv_'+chId).show();
	}
}

function showHideDiv(tagId, tagType)
{
	var psc = $('#psCount').val();
	if(tagType == 1) {
		for(i=1;i<=psc;i++) {
			if(tagId == i) {
				$('#showTag_'+tagId).hide();
				$('#hideTag_'+tagId).show();
				$('#paySch_'+tagId).show();
			} else {
				$('#paySch_'+i).hide();
				$('#hideTag_'+i).hide();
				$('#showTag_'+i).show();
			}
		}
	} else {
		$('#date_'+tagId).removeClass('red_bdr');
		$('#duration_'+tagId).removeClass('red_bdr');
		$('#days_'+tagId).removeClass('red_bdr');
		if($('#dateFrom_'+tagId).val()=='0') {
			if($('#date_'+tagId).val() == '') {
				$('#date_'+tagId).addClass('red_bdr');
				$('#date_'+tagId).focus();
				return false;
			}
		} else {
			if($('#duration_'+tagId).val() == '0') {
				$('#duration_'+tagId).addClass('red_bdr');
				$('#duration_'+tagId).focus();
				return false;
			} else {
				if($('#days_'+tagId).val() == '') {
					$('#days_'+tagId).addClass('red_bdr');
					$('#days_'+tagId).focus();
					return false;
				}
			}
		}
		
		$('#paySch_'+tagId).hide();
		$('#hideTag_'+tagId).hide();
		$('#showTag_'+tagId).show();
	}
}

function dateFromFn(tagId, selVal)
{
	if(selVal == 'S' || selVal == 'E') {
		$('#radioDiv_'+tagId).show();
	} else {
		$('#radioDiv_'+tagId).hide();
	}
	
	if(selVal == 0) {
		$('#durationDiv_'+tagId).hide();
		$('#dateDiv_'+tagId).show();
		
		$('#duration_'+tagId).val(0);
		$('#days_'+tagId).val('');
	} else {
		$('#dateDiv_'+tagId).hide();
		$('#durationDiv_'+tagId).show();
		
		$('#date_'+tagId).val('');
	}
}

function showReceipt(tagId, tagType)
{
	var psc = $('#psCount').val();
	if(tagType == 1) {
		for(i=1;i<=psc;i++) {
			if(tagId == i) {
				$('#receiptDiv_'+tagId).show();
				$('#hidePerTag_'+tagId).show();
			} else {
				$('#receiptDiv_'+i).hide();
				$('#hidePerTag_'+i).hide();
			}
		}
	} else {
		$('#percentage_'+tagId).removeClass('red_bdr');
		if($('#percentage_'+tagId).val() == '') {
			$('#percentage_'+tagId).addClass('red_bdr');
			$('#percentage_'+tagId).focus();
			return false;
		}
		$('#receiptDiv_'+tagId).hide();
		$('#hidePerTag_'+tagId).hide();
	}
}

function bindDatePicker()
{
	$(".date_picker").datepicker({
		format: 'dd-mm-yyyy',
	});
}

function paySchValidate()
{
	$('.error_message').hide();
	var errFlag = 0;
	var chkFlag = 0;
	if($('#scheduleType').val() == '1') {
		var psc = $('#psCount').val();
		var perCheck = 0;
		var advInc = $("input[name='advanceIncluded']:checked").val();
		
		for(i=1;i<=psc;i++) {
			var perFlag = 0;
			$('#date_'+i).removeClass('red_bdr');
			$('#duration_'+i).removeClass('red_bdr');
			$('#days_'+i).removeClass('red_bdr');
			
			if(i == 1) {
				$('#amount_'+i).removeClass('red_bdr');
				if(advInc == 1) {
					if($("input[name='advAmount_"+i+"']:checked").val() == 2) {
						if($('#amount_'+i).val() == '') {
							$('#amount_'+i).addClass('red_bdr');
							$('#amount_'+i).focus();
							errFlag = 1;
						}
					}
				}
			}
			if($('#description_'+i).val() != '') {
                if($('#scheduleId_'+i).val() == '') {
                    $.post(getBaseURL()+'crm/project/check-stage-name', { descName: $('#description_'+i).val() },
                        function(data) {
                            console.log(data);
                            var chkCount = JSON.parse(data);
                            if(chkCount.dCount != 0 || chkCount.sCount != 0 || chkCount.oCount != 0) {
                                $('#description_'+i).addClass('red_bdr');
                                $('#description_'+i).focus();
                                errFlag = 1;
                            }
                        });
                }
				/*if($('#dateFrom_'+i).val()=='0') {
					if($('#date_'+i).val() == '') {
						$('#date_'+i).addClass('red_bdr');
						$('#date_'+i).focus();
						errFlag = 1;
						$('#showTag_'+i).hide();
						$('#hideTag_'+i).show();
						$('#paySch_'+i).show();
					} else {
						$('#showTag_'+i).show();
						$('#hideTag_'+i).hide();
						$('#paySch_'+i).hide();
					}
				} else {*/
				if($('#dateFrom_'+i).val()!='0') {
					if($('#duration_'+i).val() == '0') {
						$('#duration_'+i).addClass('red_bdr');
						$('#duration_'+i).focus();
						errFlag = 1;
						$('#showTag_'+i).hide();
						$('#hideTag_'+i).show();
						$('#paySch_'+i).show();
					} else {
						if($('#days_'+i).val() == '') {
							$('#days_'+i).addClass('red_bdr');
							$('#days_'+i).focus();
							errFlag = 1;
							$('#showTag_'+i).hide();
							$('#hideTag_'+i).show();
							$('#paySch_'+i).show();
						} else {
							$('#showTag_'+i).show();
							$('#hideTag_'+i).hide();
							$('#paySch_'+i).hide();
						}
					}
				}

                if($('#percentage_'+i).length > 0 && $('#chosenType_'+i).val() != 'O') {
					if(i == 1 && advInc == 1 && $("input[name='advAmount_"+i+"']:checked").val() == 2) {
						perFlag = 1;
					}
					if(perFlag == 0) {
						if($('#percentage_'+i).val() != '') {
							perCheck = (parseFloat($('#percentage_'+i).val()) + parseFloat(perCheck));
							$('#percentage_'+i).removeClass('red_bdr');
						} else {
							$('#percentage_'+i).addClass('red_bdr');
							$('#percentage_'+i).focus();
							errFlag = 1;
						}
					}
				}
				
				if(advInc == 0) {
					if($('#receiptDiv_'+i).length > 0) {
						if($("input[name='isAdvanceDeductible_"+i+"']:checked").length == 0) {
							chkFlag = chkFlag + 1;
						}
					}
				}
				
				if($('#chooseInsType_'+i).length > 0) {
					if($('#scheduleId_'+i).val() == '') {
						if($('#chooseInsType_'+i).val() == 0) {
							$('#chooseInsType_'+i).addClass('red_bdr');
							$('#chooseInsType_'+i).focus();
							errFlag = 1;
						} else {
							$('#chooseInsType_'+i).removeClass('red_bdr');
						}
					}
				}
			}
		}
		
		if(chkFlag == psc) {
			$('#chkboxError').show();
			errFlag = 1;
		}
		
		if(errFlag == 0) {
			if(perFlag == 0 && (perCheck > 100 || perCheck < 100)) {
				$('#percentError').show();
				return false;
			} else {
				$("#paymentScheduleForm").submit();
			}
		}
	} else {
		$("#paymentScheduleForm").submit();
	}
}

/*schedule autocomplete start*/
var psArr = <?php echo json_encode($psResult); ?>;
var psArrCopy = [];
var psId = <?php echo json_encode($psId); ?>;

bindAutoComplete();
function sliceJson(curVal)
{
	$("#paySchTable tbody.psSorting tr.psClass").each(function(){
		var val = $(this).find(".auto-complete").val().trim();
		if(val != "")
			paySchA.push($(this).find(".auto-complete").val());
	});
	
	psArrCopy = $.grep(psArr, function(element, index) {
		if($.inArray(element.value, paySchA) != -1 && element.value != curVal)
			return false;
		return true;
	});
}
function fillPs(json, invoker, mode)
{
	var tr = $(invoker).closest("tr");
	if(mode == 1) {
		if($.inArray(json.data, psId) == -1) {
			psId.push(json.data);
		}
        var curId = tr.find("td:nth-child(1)").html();
		tr.find("td:nth-child(2) input:hidden").val(json.data);
		tr.find("td:nth-child(4) input:hidden").val(json.Type);
        if(json.Type == 'O') {
            //tr.find("td:nth-child(5)").html('');
            $('#percentDiv_'+curId).hide();
            $('#receiptDiv_'+curId).hide();
            $('#hidePerTag_'+curId).hide();
        } else {
            $('#percentDiv_'+curId).show();
            $('#receiptDiv_'+curId).show();
            $('#hidePerTag_'+curId).show();
        }
	} else {
		var hidVal = tr.find("td:nth-child(1) input:hidden").val();
		if(hidVal != '') {
			psId.splice($.inArray(hidVal, psId),1);
		}
		tr.find("td:nth-child(2) input:hidden").val('');
		tr.find("td:nth-child(4) input:hidden").val('');
	}
}
function bindAutoComplete()
{
	$('.auto-complete').unbind();
	$('.auto-complete').autocomplete({
		lookup: <?php echo json_encode($psResult); ?>,
		lookupFilter: function(suggestion, originalQuery, queryLowerCase){
			var re = new RegExp('\\b' + $.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
			return re.test(suggestion.value);
		},
		onSelect: function(suggestion){
			if(suggestion) {
				fillPs(suggestion, this, 1);
				$(this).removeClass('error');
			}
		},
		onSearchStart: function(suggestion) {
		
		},
		onSearchComplete: function (query, suggestion){
			if(!suggestion.length) {
				fillPs('', this, 2);
				$(this).addClass('error');
			} else {
				$(this).removeClass('error');
			}
		},
	});
	
	$('.auto-complete').bind("focus", function(){
		sliceJson($(this).val().trim());
		$(this).autocomplete().setOptions({
			lookup: psArrCopy
		});
	});
	
	/*$('.auto-complete').bind("blur", function(){
		if($.inArray($(this).val(), psArr) == -1){
			fillPs('', this, 2);
			$(this).addClass("error");
		}
	});*/
}
/*schedule autocomplete end*/

$("#projectSteps").change(function(){
	window.location.href= getBaseURL() + "crm/project/"+this.value+"/<?php echo $bsf->encode($projectId); ?>";
});

//receipt type sorting
var $rtBody = $('table[id*=receiptTypeTable] tbody.sorting');

$rtBody.sortable({
	helper: fixHelperModified,
	stop: updateIndex,
	axis: 'y',
	distance: 40,
	update: function( event, ui ) {
		var ifrow = event.target.children[0].id.split("_")[1];
		rtSortOrder();
	}
});

function rtSortOrder()
{
	var rows = $('tr[id*=rtRowId_]');
	var irefid = 1;
	$.each(rows, function() {
		var id = $(this)[0].id;
		var irow = id.split("_")[1];
		$('#rtSortId_'+ irow).val(irefid);
		$('#rtRowSlNo_'+ irow).html(irefid);
		irefid = + irefid+1;
	});
}

//payment schedule sorting
var $psBody = $('table[id*=paySchTable] tbody.psSorting');

$psBody.sortable({
	helper: fixHelperModified,
	stop: updateIndex,
	axis: 'y',
	distance: 40,
	update: function( event, ui ) {
		var ifrow = event.target.children[0].id.split("_")[1];
		psSortOrder();
	}
});

function psSortOrder()
{
	var rows = $('tr[id*=psRowId_]');
	var irefid = 1;
	$.each(rows, function() {
		var id = $(this)[0].id;
		var irow = id.split("_")[1];
		$('#psSortId_'+ irow).val(irefid);
		$('#psRowSlNo_'+ irow).html(irefid);
		irefid = + irefid+1;
	});
}

//Each Stage sorting
function esSortOrder(stId)
{
	var rows = $('tr[id*=esRowId_'+stId+'_]');
	var irefid = 1;
	$.each(rows, function() {
		var id = $(this)[0].id;
		var irow = id.split("_")[2];
		$('#esSortId_'+stId+'_'+ irow).val(irefid);
		irefid = + irefid+1;
	});
}

var fixHelperModified = function(e, tr) {
	var $originals = tr.children();
	var $helper = tr.clone();
	$helper.children().each(function(index) {
		$(this).width($originals.eq(index).width())
	});
	return $helper;
},
updateIndex = function(e, ui) {
	$('td.index', ui.item.parent()).each(function (i) {
		$(this).html(i + 1);
	});
};

autoRetainFn();
function autoRetainFn()
{
	var incAdv = $("input[name='advanceIncluded']:checked").val();
	<?php
	$i = 1;
	foreach($paySchRes as $paySch) {
	?>
	dateFromFn('<?php echo $i; ?>', '<?php echo $paySch['DateFrom']; ?>');

	var selectedDateFrom = '<?php echo $paySch['DateFrom']; ?>';
	var tagId = '<?php echo $i; ?>';
	var dateFromData = '';

	if(incAdv == 0) {
		var idfd = 1;
	} else {
		var hidAdvInc = $('#hidIncAdv').val();
		if(hidAdvInc != incAdv) {
			var idfd = 1;
		} else {
			var idfd = 2;
		}
	}
	if(tagId > 1) {
		for(i=idfd;i<tagId;i++) {
			var selectedVal = '';
			var optVal = $('#scheduleId_'+i).val()+'#'+$('#chosenType_'+i).val();
			if(selectedDateFrom != 'F' || selectedDateFrom != 'S' || selectedDateFrom != 'E') {
				if(selectedDateFrom == optVal) {
					var selectedVal = 'selected';
				}
			}
			if($('#scheduleId_'+i).val() != '' && $('#chosenType_'+i).val() != 'A') {
				dateFromData += '<option value="'+optVal+'" '+selectedVal+'>'+$('#description_'+i).val()+'</option>';
			}
		}
		$('#dateFrom_'+tagId).append(dateFromData);
	}
	<?php
		$i++;
	}
	?>
}

function getValueOfSlider(slType)
{
	var currentIndex = $('#carousel-example-generic .item.active').index();
	if(currentIndex == 1 && slType == 'next') {
		$("#backNext").hide();
	} else {
		$("#backNext").show();
	}
	if(currentIndex == 1 && slType == 'prev') {
		$("#backPrev").hide();
	} else {
		$("#backPrev").show();
	}
}

function calPercent(){
    var psc = $('#psCount').val();
    var perCheck = 0;
    for(i=1;i<=psc;i++) {
        if($('#percentage_'+i).length > 0) {
            if($('#percentage_'+i).val() != '') {
                perCheck = (parseFloat($('#percentage_' + i).val()) + parseFloat(perCheck));
                $('#totalPercent').val(parseFloat(perCheck));
            }
        }
    }
}

calPercent();
$("#backPrev").hide();
</script>