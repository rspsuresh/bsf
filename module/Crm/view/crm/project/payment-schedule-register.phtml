<?php $bsf = new \BuildsuperfastClass(); ?>
<!-- INLINE CSS -->
<style>
.tr_hot 						{background:#f9eaea;}
.tr_warm 						{background:#f8f1e4;}
.tr_cold 						{background:#e8f0f6;}
.flwup_proimg					{margin-top:12px;}
#dataTable .jqx-grid-header 	{height:75px !important;}
.top-ic5						{padding-top:10px !important; cursor:pointer;}
</style>
<!-- INLINE CSS -->
<div class="content_wrapper padlr0">
	<div class="container-fluid padlr0">
		<div class="col-lg-12">
			<h1 class="float_l">Project Info of
				<div class="btn-group proname_btn">
					<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"><?php echo ucfirst($projectDetail['ProjectName']);?> <span class="edit_symbols" data-placement="right" data-toggle="tooltip" data-original-title="Choose&nbsp;your&nbsp;project"><i class="fa fa-caret-down "></i></span></a>
                    <div class="dropdown-menu toolbar_ddown proname_ddown arrow" role="menu">
                        <ul>
                            <?php foreach($projects as $project){?>
                                <li><a href="<?php echo $this->basePath(); ?>/crm/project/<?php echo $this->currentRequest()->get('action'); ?>/<?php echo $bsf->encode($project['ProjectId']); ?>"><?php echo ucfirst($project['ProjectName']);?></a></li>
                            <?php }	?>
                        </ul>
                    </div>
                </div>
			</h1>
            <div class="promote_social float_r">
                <ul>
                    <span>Promote Project</span>
                    <li><a href="#" class="fb_c ripple"><i class="fa fa-facebook-square"></i></a></li>
                    <li><a href="#" class="twt_c ripple"><i class="fa fa-twitter-square"></i></a></li>
                    <li><a href="#" class="g_c ripple"><i class="fa fa-google-plus-square"></i></a></li>
                </ul>
            </div>
		</div>
		<div class="col-lg-12 clear">
            <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1">
                <div class="col-lg-12">
                    <div class="row">
                        <div class="step_by_liner animated slideInDown"></div>
                        <ul class="step_by stepby_mb60">
                            <li>
                                <div class="step_by_sep animated_0_4s slideInRight"><p>4</p></div>
                                <p class="stepli_p1">Other Cost Details</p>
                            </li>
                            <li>
                                <div class="step_by_sep stepsep_active animated slideInRight"><p>5</p></div>
                                <p class="stepli_p2">Payment Schedule</p>
                            </li>
                            <li class="opacity_08">
                                <div class="step_by_sep animated_1_5s slideInRight"><p>6</p></div>
                                <p class="stepli_p3">Unit Type</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="dataTable" class="m_btm30"></div>
			<ul>
				<li class="dropdown save_btn float_r">
					<a href="<?php echo $this->basePath(); ?>/crm/project/unit-type-register/<?php echo $bsf->encode($projectId); ?>" data-toggle="tooltip" data-placement="left" class="ripple" title="Continue">Continue</a>
				</li>
			</ul>
		</div>
	</div>
</div>
<div class="col-lg-12 savebtn_area">
	<ul>
		<li class="goto">
			<label for="go_to" class="float_l">Go to</label> 
			<select id="projectSteps" name="go_to" class="float_l goto_select">
				<option value="general" <?php if($this->currentRequest()->get('action') == 'general') { echo 'selected'; } ?>>General</option>
				<option value="land-area" <?php if($this->currentRequest()->get('action') == 'land-area') { echo 'selected'; } ?>>Area Details</option>
				<option value="land-cost" <?php if($this->currentRequest()->get('action') == 'land-cost') { echo 'selected'; } ?>>Land Cost Calculation</option>
				<option value="other-cost" <?php if($this->currentRequest()->get('action') == 'other-cost') { echo 'selected'; } ?>>Other Cost Details</option>
				<option value="payment" <?php if($this->currentRequest()->get('action') == 'payment-schedule' || $this->currentRequest()->get('action') == 'payment-schedule-edit' || $this->currentRequest()->get('action') == 'payment-schedule-register' || $this->currentRequest()->get('action') == 'payment') { echo 'selected'; } ?>>Payment Schedule</option>
				<option value="unit-type-register" <?php if($this->currentRequest()->get('action') == 'unit-type-generation' || $this->currentRequest()->get('action') == 'unit-type') { echo 'selected'; } ?>>Unit Type</option>
				<option value="facility" <?php if($this->currentRequest()->get('action') == 'facility' || $this->currentRequest()->get('action') == 'car-park' || $this->currentRequest()->get('action') == 'other-facility') { echo 'selected'; } ?>>Facility Management</option>
				<option value="checklist" <?php if($this->currentRequest()->get('action') == 'checklist') { echo 'selected'; } ?>>Check List Management</option>
				<option value="penality-interestrate" <?php if($this->currentRequest()->get('action') == 'penality-interestrate') { echo 'selected'; } ?>>Penality & Interest Rate</option>
				<option value="incentive-register" <?php if($this->currentRequest()->get('action') == 'incentive-register') { echo 'selected'; } ?>>Incentive Management</option>
			    <option value="property-management" <?php if($this->currentRequest()->get('action') == 'property-management') { echo 'selected'; } ?>>Property Management</option>
			</select>
		</li>
	</ul>
</div>
<div class="modal fade" id="mdlDelete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h1>Please provide a reason for deleting data</h1>
			</div>
			<div class="modal-body">
				<div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1">
					<form class="form-horizontal">
						<div class="row m_tb40">
							<div class="col-lg-12 form-group req_flds">
								<textarea id="remarks" maxlength="250" class="form-control lbl_move" label="Enter the remarks"/></textarea>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer clear">
				<div class="col-lg-12 savebtn_area no_border">
					<ul>
						<li class="save_btn float_r">
							<a href="javascript:void(0);" id="btnDelete" class="ripple">Delete</a>
						</li>
						<li class="cancel_btn float_r">
							<a href="javascript:void(0);" aria-hidden="true" data-dismiss="modal" class="ripple">Cancel</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- PAGE SCRIPTS-->
<script>
$(function(){
    $('.lead_table tr').click(function(){
		$('.right_lightbox').show();
		$('.left-panel').removeClass('collapsed');
		$('.l_menuicon_nav').removeClass('cross');
    });
	$('.right_lightbox_close').click(function(){
		$('.right_lightbox').hide();
		if ($(window).width() >=980){
			$('.left-panel').addClass('collapsed');
			$('.l_menuicon_nav').addClass('cross');
		}
	});
});

var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.document.location = $(this).data("href");
    });
});

$(document).ready(function () {
	$.ajax({
		url:"<?php echo $this->basePath(); ?>/crm/project/payment-schedule-register/<?php echo $bsf->encode($projectId); ?>",
		type:"post",
		data:"",
		dataType:"json",
		success:function(data, textStatus, jqXHR){
			var source = {
				localdata:data,
				dataType: "json",
				dataFields: [
					{ name: 'PaymentScheduleId', type: 'number' },
					{ name: 'ProjectName', type: 'string' },
					{ name: 'PaymentSchedule', type: 'string' },
					{ name: 'ScheduleTypeName', type: 'string' },
					{ name: 'CreatedDate', type: "date", format: 'dd-MM-yyyy' },
				],
				id: 'PaymentScheduleId'
			};
			
			var dataAdapter = new $.jqx.dataAdapter(source);
			
			$("#dataTable").jqxGrid({
				width: '100%',
				source: dataAdapter,
				pageable: true,
				selectionMode: 'singleRow',
				pagerButtonsCount: 6,
				autoheight:true,
				rowsheight:45,
				autorowheight: true,
				filterable: true,
				sortable: true,
				//filtermode: 'advanced',
				columnsResize: true,
				showfilterrow: true,
				ready:function(){
				},
				rendered: function () {
				},
				columns: [
					{ text: 'PaymentScheduleId', datafield: 'PaymentScheduleId', hidden: true, filterable: false},
					{ text: 'Project', dataField: 'ProjectName'},
					{ text: 'Schedule Name', dataField: 'PaymentSchedule'},
					{ text: 'Schedule Type', dataField: 'ScheduleTypeName'},
					{ text: 'Created Date', filtertype: 'date', dataField: 'CreatedDate', cellsformat: 'dd-MM-yyyy'},
					{ text: 'Action', sortable: false, filterable: false, align: 'left', width: '10%',
						cellsrenderer: function (row) {
							var PaymentScheduleId = $("#dataTable").jqxGrid('getCellValue', row, 'PaymentScheduleId');
							//var paramId = Base64.encode(Base64.encode(PaymentScheduleId));
							var hrefLink = "<?php echo $this->basePath(); ?>/crm/project/payment-schedule-edit/<?php echo $bsf->encode($projectId); ?>/"+PaymentScheduleId;
							return '<a title="Edit" href="'+hrefLink+'" style="padding-left: 15px; padding-top:10px;"><i class="fa fa-pencil-square-o reg-icon top-ic5"></i></a>&nbsp;&nbsp;<a title="Delete" onclick="payRowDelete(' + row + ');return false;"><i class="fa fa-trash-o reg-icon top-ic5"></i></a>';
						}
					}
				]
            });
			
			/*$('#dataTable').on('cellclick', function (event){
				// event arguments.
				var args = event.args;
				// row's bound index.
				var rowBoundIndex = args.rowindex;
				// row's visible index.
				var rowVisibleIndex = args.visibleindex;
				// right click.
				var rightclick = args.rightclick;
				// original event.
				var ev = args.originalEvent;
				// column index.
				var columnindex = args.columnindex;
				// column data field.
				var dataField = args.datafield;
				// cell value
				var value = args.value;
				var data = $("#dataTable").jqxGrid("getrowdata", rowBoundIndex);
				if(dataField != '')
					location.replace("<?php echo $this->basePath(); ?>/crm/project/payment-schedule-edit/<?php echo $bsf->encode($projectId); ?>/"+Base64.encode(Base64.encode(data.uid)));
			});*/
		},
		error:function(jqXHR, textStatus, errorThrown){
			alert(textStatus+"-----"+errorThrown);
		}
	});
});

$("#projectSteps").change(function(){
	window.location.href= getBaseURL() + "crm/project/"+this.value+"/<?php echo $bsf->encode($projectId); ?>";
});

$('#btnDelete').on('click', function(){
	var remarks = $("#remarks").val();
	if(remarks.length == 0) {
		showError($("#remarks"), 'Required!');
		return;
	} else {
		removeError($("#remarks"));
	}
	
	$('#mdlDelete').modal('hide');
	var rowData = $("#dataTable").jqxGrid('getrowdata', $('#mdlDelete').data('row'));
	$.ajax({
		url: getBaseURL() + 'crm/project/payment-schedule-delete',
		type: 'POST',
		async: false,
		data: {"paySchId": rowData.PaymentScheduleId, "remarks": remarks},
		success:function(data, textStatus, jqXHR){
			if (jqXHR.status == 200)
				$("#dataTable").jqxGrid("deleterow", rowData.PaymentScheduleId);
			else
			alert('Failed to delete!');
		},
		error:function(jqXHR, textStatus, errorThrown){
			alert('Failed to delete!');
		}
	});
	$("#remarks").val('');
});

function payRowDelete(row)
{
	var rowData = $("#dataTable").jqxGrid('getrowdata', row);
	$('#mdlDelete').data('row', row).modal('show');
	$("#remarks").val('');
}
</script>
<!-- PAGE SCRIPTS-->