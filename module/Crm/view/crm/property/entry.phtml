<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/cb.css" />
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<script>
                                    $(document).ready(function() {
                                        $(".single_dropdown").select2({
											placeholder: "",
                                            allowClear: true
                                        });
                                    });
                                </script>
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1 class="txt_center" data-bsfhead="Property Management">Property Management</h1>
        </div>
		<form method="post" action="" onsubmit = "return validation();">
        <div class="col-lg-12 clear padlr0">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                <div class="col-lg-offset-3">
                    <label for="refno" class="bk_lbl bk_lbl_inpt" data-bsfshare="Ref No">Ref No <span class="colon_r">:</span></label>
                    <input type="text" class="bk_lbl_inpt inputbg_ef bk_inpt1" name="refno" data-bsfshare="RefNo" id="refno" <?php if ($arrVNo["genType"] == true){ ?> readonly <?php } ?> value="<?php if(isset($regInfo) && $regInfo['PMNo']!="") { echo $regInfo['PMNo']; } elseif (isset($arrVNo["genType"]) && isset($arrVNo['voucherNo'])){ echo $arrVNo['voucherNo']; } else { echo ""; }?> " />
					<div class="col-lg-12 error_message"><p>Required</p></div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 col-lg-pull-1 col-md-pull-1 col-sm-pull-1">
                <div class="col-lg-offset-6">
                    <label for="refdate" class="bk_lbl bk_lbl_inpt" data-bsfshare="Ref Date" ><span class="bkspan_calendar"><i class="fa fa-calendar-o"></i></span> Ref Date <span class="colon_r">:</span></label>
                    <input type="text" class="date_picker bk_lbl_inpt bk_inpt inputbg_ef" readonly name="refdate" data-bsfshare="RefDate" id="refdate" value="<?php if(isset($regInfo) && $regInfo['PMDate']!="") { echo date('d-m-Y',strtotime($regInfo['PMDate'])); }  else { echo date('d-m-Y'); }?>" />
                </div>
            </div>
        </div>
        <div class="col-lg-12 clear">
        	<div class="liner"></div>
        </div>
        <div class="col-lg-12 clear" style="background-color:#fff;">
        	<div class="col-lg-6 padlr0 m_top10">
                <div class="signup_onebyone_content">
                    <div class="setup_form prop_mnmt_form">
                        <div class="flwup_rightcnt"><h2 data-bsfhead="Unit Details">Unit Details</h2></div>
                        <form method="post" action="" onsubmit = "return validation();">
                            <ul class="onebyone_form">										
                                <li id="q1" class="active focus">
                                    <div class="onebyone_wrapper">
                                        <div class="li_number">
                                            <span><i class="fa fa-flag-checkered" aria-hidden="true"></i></span>
                                            <div class="arrow">
                                                <span><i class="fa fa-arrow-right"></i></span>
                                            </div>
                                        </div>
                                        <div class="onebyone_question">
                                            <span class="span_b">What is the Project/Unit/Buyer?</span>
                                        </div>
                                        <div class="onebyone_content">
                                            <div class="input">
                                                <input type="text" data-bsfshare="Project Name" id="projectname" <?php if(isset($projectName)){ echo "readonly"; } ?> name="projectname" value="<?php if(isset($projectName) && $projectName['value']!="") { echo $projectName['value']; }  ?>" placeholder="Project/ Unit/ Buyer"  class="inputSetup" autocomplete="off" />
												<input type="hidden" name="unitId" id="unitid" value="<?php if(isset($regInfo) && $regInfo['UnitId']!="") { echo $regInfo['UnitId']; } ?>" />
                                            </div>
                                            <div class="col-lg-12 error_message"><p>Required</p></div>
                                        </div>
                                    </div>
                                </li>
                                <li id="q2" class="">
                                    <div class="onebyone_wrapper">
                                        <div class="li_number">
                                            <span><i class="fa fa-flag-checkered" aria-hidden="true"></i></span>
                                            <div class="arrow">
                                                <span><i class="fa fa-arrow-right"></i></span>
                                            </div>
                                        </div>
                                        <div class="onebyone_question">
                                            <span class="span_b">What is their Permanent Address?</span>
                                        </div>
                                        <div class="onebyone_content">
                                            <div class="input">
                                                <input type="text" id="address" name="address" data-bsfshare="Address" autocomplete="off" placeholder="Address" value="<?php if(isset($regInfo) && $regInfo['Address']!="") { echo $regInfo['Address']; } ?>" class="inputSetup"/>
                                            </div>
                                            <div class="col-lg-12 error_message"><p>Required</p></div>
                                        </div>
                                    </div>
                                </li>
                                <li id="q3" class="">
                                    <div class="onebyone_wrapper">
                                        <div class="li_number">
                                            <span><i class="fa fa-flag-checkered" aria-hidden="true"></i></span>
                                            <div class="arrow">
                                                <span><i class="fa fa-arrow-right"></i></span>
                                            </div>
                                        </div>
                                        <div class="onebyone_question">
                                            <span class="span_b">Has this Property is Ready for occupation?</span>
                                        </div>
                                        <div class="onebyone_content">
                                        	<div class="radio_check">
                                                <p>
                                                    <input type="radio" value="1"  id="yes" name="readyforoccupation" <?php if(isset($regInfo) && $regInfo['IsReady'] == 1) { echo "checked"; } if(!isset($regInfo)){ echo "checked";} ?> />
                                                    <label for="yes" class="ripple">Yes</label>
                                                </p>
                                                <p>
                                                    <input type="radio" value="0" id="no"  name="readyforoccupation" <?php if(isset($regInfo) && $regInfo['IsReady'] == 0) { echo "checked"; } ?> />
                                                    <label for="no" class="ripple">No</label>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li id="q4" class="">
                                    <div class="onebyone_wrapper">
                                        <div class="li_number">
                                            <span><i class="fa fa-flag-checkered" aria-hidden="true"></i></span>
                                            <div class="arrow">
                                                <span><i class="fa fa-arrow-right"></i></span>
                                            </div>
                                        </div>
                                        <div class="onebyone_question">
                                            <span class="span_b">When will Start under Maintenance Service?</span>
                                        </div>
                                        <div class="onebyone_content">
                                            <div class="input col-lg-12 padlr0">
                                            	<span class="date_icon"><i class="fa fa-calendar"></i></span>
                                                <input type="text" data-bsfshare="Start Date" id="Date" readonly name="StartDate" autocomplete="off" placeholder="dd/mm/yyyy" value="<?php if(isset($regInfo) && $regInfo['StartDate'] != "") { echo date('d-m-Y',strtotime($regInfo['StartDate'])); } else echo date('d-m-Y'); ?>" class="inputSetup date_picker"/>
                                            </div>
                                            <div class="col-lg-12 error_message"><p>Required</p></div>
                                        </div>
                                    </div>
                                </li>
                                <li id="q5" class="">
                                    <div class="onebyone_wrapper">
                                        <div class="li_number">
                                            <span><i class="fa fa-flag-checkered" aria-hidden="true"></i></span>
                                            <div class="arrow">
                                                <span><i class="fa fa-arrow-right"></i></span>
                                            </div>
                                        </div>
                                        <div class="onebyone_question">
                                            <span class="span_b">What is the Furnishing details of the Property?</span>
                                        </div>
                                        <div class="onebyone_content">
                                        	<div class="radio_check">
                                                <p>
                                                    <input type="radio"  value="F" <?php if(isset($regInfo) && $regInfo['FurnishType'] == "F") { echo "checked"; } ?> id="fullyfurnishing" name="Furnishing" checked />
                                                    <label for="fullyfurnishing"  >Fully Furnishing</label>
                                                </p>
                                                <p>
                                                    <input type="radio" value="S"  <?php if(isset($regInfo) && $regInfo['FurnishType'] == "S") { echo "checked"; } ?> id="semifurnishing" name="Furnishing" />
                                                    <label for="semifurnishing" class="ripple" >Semi Furnishing</label>
                                                </p>
                                                <p>
                                                    <input type="radio" value="U"   <?php if(isset($regInfo) && $regInfo['FurnishType'] == "U") { echo "checked"; } elseif(!isset($regInfo)){ echo "checked"; }?> id="unfurnishing" name="Furnishing" />
                                                    <label for="unfurnishing" class="ripple"  >Un Furnishing</label>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                
                            </ul>
                            <div class="col-lg-12 savebtn_area m_btm20 no_border clear">
                                <ul>
                                	<!--<li class="save_btn float_l">
                                        <a class="ripple" href="javascript:void(0);"  data-toggle="tooltip" data-placement="right" title="back">Back</a>
                                    </li>-->
                                    <li class="save_btn float_r">
                                        <input type="submit" class="ripple" href="javascript:void(0);" value="Continue"  data-toggle="tooltip" data-placement="left" title="to&nbsp;fill&nbsp;deposit&nbsp;and&nbsp;fees&nbsp;details" />
                                    </li>
                                </ul>
                            </div>
                        
                    </div>
                </div>
                <div class="clear"></div>
        	</div>
			</form>
            <div class="col-lg-6 m_top20" id="ProjectDetail">
            	<div class="form-group clear">
                    <div class="col-lg-12">
						<div class="row">   
							<div class="col-lg-12 clear">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label ">Project Name</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="dProjectName"><?php if(isset($unitInfo) && $unitInfo['ProjectName'] !=""){ echo $unitInfo['ProjectName']; } ?></p>   
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Block No</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="BlockName"><?php if(isset($unitInfo) && $unitInfo['BlockName'] !=""){ echo $unitInfo['BlockName']; } ?></p>
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Floor No</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="FloorName" ><?php if(isset($unitInfo) && $unitInfo['FloorName'] !=""){ echo $unitInfo['FloorName']; } ?></p> 
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Unit Type</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="UnitType" ><?php if(isset($unitInfo) && $unitInfo['UnitTypeName'] !=""){ echo $unitInfo['UnitTypeName']; } ?></p> 
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Unit No</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="UnitNo"><?php if(isset($unitInfo) && $unitInfo['UnitNo'] !=""){ echo $unitInfo['UnitNo']; } ?></p>
								</div>
							</div>
						</div>
						<!--div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Area</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="Area" >1267</p> 
								</div>
							</div>
						</div-->
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Unit Area</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="UnitArea" ><?php if(isset($unitInfo) && $unitInfo['UnitArea'] !=""){ echo $unitInfo['UnitArea']; } ?></p> 
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Face</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="Facing"><?php if(isset($unitInfo) && $unitInfo['Description'] !=""){ echo $unitInfo['Description']; } ?></p> 
								</div>
							</div>
						</div>
						<div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Owner Name</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="BuyerName" ><?php if(isset($unitInfo) && $unitInfo['BuyerName'] !=""){ echo $unitInfo['BuyerName']; } ?></p> 
								</div>
							</div>
						</div>
						<!--div class="row">   
							<div class="col-lg-12">
								<label class="col-lg-5 padlr0 col-md-5 col-sm-5 txt_left control-label">Address</label>
								<div class="col-lg-7 col-md-7 col-sm-7 padlr0">
									<p id="BuyerAddress" >1355 Market Street, Suite 900 San Francisco, CA 94103</p> 
								</div>
							</div>
						</div-->
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>
<script>
$("li").hover(
	function () {
		$(this).addClass("active focus").parent().next().addClass("active focus");
	},
	function () {
		$(this).removeClass("active focus").parent().next().removeClass("active focus");
	}
);

$(".inputSetup").focus(function(){
	$('.focus').removeClass('active focus');
	$(this).closest('li').addClass('active focus');
	$('body,html').animate({
		scrollTop: scrollPoint
	}, 600);
});

//newly addedd
<?php if(!isset($unitInfo)){ ?>
$('#ProjectDetail').hide();
<?php } ?>
var arr_Units = <?php echo (isset($unitList)) ? json_encode($unitList) : '[]';?>;
var $unitname = $('#projectname'),$UnitId = $('#unitid');
$unitname.autocomplete({
  lookup: arr_Units,
  showNoSuggestionNotice: false,
  lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
      if (queryLowerCase == '*') {
          return suggestion.value;
      } else {
          var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
          return re.test(suggestion.value);
      }
  }, onSelect: function (suggestion) {
      if (suggestion) {
          $UnitId.val(suggestion.data);
		  projectDetail(suggestion.data,suggestion.LeadId);
          $(this).removeClass('error');
      }
  }, onSearchStart: function (suggestion) {
      $UnitId.val(0);
  }, onSearchComplete: function (query, suggestions) {
      if (!suggestions.length) {
          $UnitId.val(0);
          $(this).addClass('error');
      } else $(this).removeClass('error');
  }
});
function projectDetail(unitId,leadId){
	$.ajax({
        url: getBaseURL() + 'crm/property/entry',
        data: {UnitId: unitId,LeadId: leadId},
        type: 'POST',
        success: function (data, status, xhr) {
            var res = JSON.parse(data);
            if(res[0] != false) {
                $('#address').val(res[0].Address1);
            }
            if (res[1] !=false ) {
					$("#dProjectName").html(res[1].ProjectName);
					$('#BlockName').html(res[1].BlockName);
                    $('#FloorName').html(res[1].FloorName);
                    $('#UnitType').html(res[1].UnitTypeName);
                    $('#UnitNo').html(res[1].UnitNo);
                    $('#UnitArea').html(res[1].UnitArea);
                    $('#Facing').html(res[1].Description);
                    $('#BuyerName').html(res[1].BuyerName);
                   // $('#BuyerAddress').html(data.ProjectName);
            } else {
				alert("No Records Found");
			}

            
        },
        error: function (xhr, status, error) {
            alert(xhr.responseText);
        }
    });
	
	
	$('#ProjectDetail').show();
}
function validation(){
	var errorFlag = 0;
	var errorFlagCount = 0;
	if($('#refno').val() == "" ){
		showErrorMsg($('#refno'), "Required");
		errorFlagCount = errorFlagCount + 1;
		errorFlag = 1;
		if(errorFlagCount == 1) {
			$('#refno').focus();
		}
	} else {
		removeErrorMsg($('#refno'));
	}
	if($('#projectname').val() == "" ){
		showErrorMsg($('#projectname'), "Required");
		errorFlagCount = errorFlagCount + 1;
		errorFlag = 1;
		if(errorFlagCount == 1) {
			$('#projectname').focus();
		}
	} else {
		removeErrorMsg($('#projectname'));
	}
	if($('#unitid').val() == "" ){
		showErrorMsg($('#projectname'), "Required");
		errorFlagCount = errorFlagCount + 1;
		errorFlag = 1;
		if(errorFlagCount == 1) {
			$('#projectname').focus();
		}
	} else {
		removeErrorMsg($('#projectname'));
	}
	if($('#address').val() == "" ){
		showErrorMsg($('#address'), "Required");
		errorFlagCount = errorFlagCount + 1;
		errorFlag = 1;
		if(errorFlagCount == 1) {
			$('#address').focus();
		}
	} else {
		removeErrorMsg($('#address'));
	}
	if($('#Date').val() == "" ){
		showErrorMsg($('#Date'), "Required");
		errorFlagCount = errorFlagCount + 1;
		errorFlag = 1;
		if(errorFlagCount == 1) {
			$('#Date').focus();
		}
	} else {
		removeErrorMsg($('#Date'));
	}
	
	if(errorFlag == 0) {
		return true;
	} else {
		return false;
	}
}
function showErrorMsg($tarIp, msg) {
	var $tarErrorMsg = $tarIp.closest('div').find('.error_message');
	$tarErrorMsg.find('p').text(msg);
	$tarErrorMsg.show();
}

function removeErrorMsg($tarIp) {
	var $tarErrorMsg = $tarIp.closest('div').find('.error_message');
	$tarErrorMsg.find('p').text('Please Enter ' + $tarIp.attr('label') + '...');
	$tarErrorMsg.hide();
}
</script>