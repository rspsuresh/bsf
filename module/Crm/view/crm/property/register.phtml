<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1>Property Register<?php if(isset($projectId)) { ?> of  <?php } ?>
                <div class="btn-group proname_btn">
                    <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"><?php if(isset($projectId)) { echo ucfirst($projectDetail['ProjectName']);  } ?><span class="edit_symbols" data-placement="right" data-toggle="tooltip" data-original-title="Change&nbsp;project&nbsp;name"><i class="fa fa-caret-down "></i></span></a>
                    <div class="dropdown-menu toolbar_ddown proname_ddown arrow" role="menu">
                        <ul>
                            <?php foreach($projects as $project){?>
                                <li>
                                    <a href="<?php echo $this->basePath(); ?>/crm/property/<?php echo $this->currentRequest()->get('action'); ?>/<?php echo $project['ProjectId']; ?>"><?php echo ucfirst($project['ProjectName']);?></a>
                                </li>
                            <?php }	?>
                        </ul>
                    </div>
                </div>
            </h1>
        </div>
        <div  class="col-lg-12">
            <div class="widthlg15 col-lg-2 col-md-6 col-sm-6 col-xs-6 mnimumwidthres ">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #0b9395;">
                    <div style="padding-left:10px !important;">
                        <h2 class="comtex tet-clr1">Total No of Units</h2>
                        <h5 class="tet-muted tet-mutedclr1 comnelips" ><?php echo $totalCount['PMRegisterId'];?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg10 col-lg-1 col-md-6 col-sm-6 col-xs-6 mnimumwidthres  ">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #d38241;">
                    <div style="padding-left:4px !important;">
                        <h2 class="comtex tet-clr2">Sold Units</h2>
                        <h5 class="tet-muted tet-mutedclr2	comnelips"><?php echo $totalSold['PMRegisterId']; ?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg17 col-lg-2 col-md-6 col-sm-6 col-xs-6 mnimumwidthres  ">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #788d5a;">
                    <div style="padding-left:10px !important;">
                        <h2 class="comtex tet-clr3">Ready for occupation</h2>
                        <h5 class="tet-muted tet-mutedclr3	comnelips"><?php echo $ReadyCount['IsReady'];?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg16 col-lg-2 col-md-6 col-sm-6 col-xs-6 mnimumwidthres  ">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #528ea8 ;">
                    <div style="padding-left:10px !important;">
                        <h2 class="comtex tet-clr4">Total Rental Service</h2>
                        <h5 class="tet-muted crmbrdrclrhed7 comnelips"><?php echo $totalrentout['IsRentOut'];?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg10 col-lg-1 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #685788;">
                    <div style="padding-left:5px !important;">
                        <h2 class="comtex tet-clr4">Rent Out</h2>
                        <h5 class="tet-muted tet-mutedclr4 comnelips"><?php echo $totalrent['RentalRegisterId'];?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg16 col-lg-2 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #bd86a6 ;">
                    <div style="padding-left:10px !important;">
                        <h2 class="comtex tet-clr4">Available for Rental</h2>
                        <h5 class="tet-muted tet-mutedclr5 comnelips"><?php echo $totalrentout['IsRentOut']-$totalrent['RentalRegisterId'];?></h5>
                    </div>
                </div>
            </div>
            <div class="widthlg16 col-lg-2 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                <div class="pnl pnl-overflow" style=" border-left:2px solid #bd86a6 ;">
                    <div style="padding-left:10px !important;">
                        <h2 class="comtex tet-clr4">MMC Receivable</h2>
                        <h5 class="tet-muted tet-mutedclr5 comnelips"><?php echo $sum['Amount']; ?> <!--<span style="font-size:10px; color:#666;">March 2016</span>--></h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="clear"></div>
        <div class="col-lg-12">
            <div class="col-lg-12">
                <ul>
                    <li class="rentli1">
                        <a href="#agreementnext" data-toggle="modal">
                            <span class="ln2" style="color:#000;">Agreement to be Expired Next 7 Days</span>
                            <span class="rentlispn1"><?php echo $Aggrementcount['RentalRegisterId'];?></span>
                        </a>
                        <div class="clear"></div>
                    </li>
                    <li class="rentli1 rentlibck1">
                        <span class="ln2">MMC Collection</span>
                        <span class="rentlispn1 rentlibckspn1"></span>
                        <div class="clear"></div>
                    </li>
                    <li class="rentli1 rentlibck1">
                        <a href="#rentcollection" data-toggle="modal">
                            <span class="ln2" style="color:#000;">Rent Collection</span>
                            <span class="rentlispn1 rentlibckspn1"><?php echo $rentalcount['RegisterId'];?></span>
                            <div class="clear"></div>
                        </a>
                    </li>
                </ul>
                <div class="float_r">
                    <div class="has-feedback">
                        <input name="search_all" id="search" type="text" placeholder="Search..."  class="form-control lbl_move" style="width:100%;" />
                    </div>
                </div>
            </div>
            <!--<span data-badge="4" class="mdl-badge mdl-badgeclr1" style="background: #d2dde3; padding: 10px; color: #5e5f60!important;"></span>
            <span data-badge="4" class="mdl-badge mdl-badgeclr2" style="background: #d2dde3; padding: 10px; color: #5e5f60!important;">MMC Collection</span>
            <span data-badge="4" class="mdl-badge mdl-badgeclr2" style="background: #d2dde3; padding: 10px; color: #5e5f60!important;">Rent Collection</span>-->
        </div>
        <div class="clear"></div>
        <div class="col-lg-12 commargin_top">
            <div class="col-lg-12">
                <div class="row">
                    <div class="table-responsive">
                        <table id="sequentialView" class="table  table-hover" style="width:100%;">
                            <thead>
                            <tr>
                                <th style="width:4%;">Unit No</th>
                                <th style="width:25%;">Owner Name</th>
                                <th>Address</th>
                                <th>Rental Details</th>
                                <th>MMC Details</th>
                                <th style="width:4%;">Deposit Amount</th>
                                <th style="width:2%;">&nbsp;</th>
                            </tr>
                            </thead>

                            <tbody>
                            <?php
                            if(!empty($registervalue)) {
                                $i=0;
                                foreach($registervalue as $reg){ ?>
                                    <tr>

                                    <td style="vertical-align:top !important;" id="unit_<?php echo $i; ?>"><?php echo $reg['UnitNo'];?></td>
                                    <td style="vertical-align:top !important;" id="bookingname_<?php echo $i; ?>">
                                        <p class="text-inherit"><?php echo $reg['BookingName'];?></p>
                                        <p class="text-inherit fntsz12">Booked On <?php echo $reg['BookingDate'];?></p>
                                        <ul>
                                            <li class="float_l"><a href="#"><span class="outbxchat"><i class="fa fa-envelope"></i></span></a></li>
                                            <li class="float_l"><a href="#"><span class="outbxchat"><i class="fa fa-comment"></i></span></a></li>
                                            <li class="float_l"><a href="#"><span class="outbxchat"><i class="fa fa-phone"></i></span></a></li>
                                        </ul>
                                    </td>
                                    <td style="vertical-align:top !important;"  id="address_<?php echo $i; ?>">
                                        <p class="text-inherit"><span class="p_label"><span class="mapaddress_icon"><i class="fa fa-map-marker"></i></span></span><?php echo $reg['Address'] ?></p>
                                    </td>
                                    <?php if($reg['IsRentOut']==1 && count($reg['rental'])>0 ){?>
                                        <td style="vertical-align:top !important;">
                                        <p class="text-inherit">Rental Service Required</p>
                                        <a href="javascript:void(0);" onclick= "return tenantshow('<?php echo $i;?>');" id="tenantshow"> <span class="text-inherit"><span style="color:#4f90d3;"><i class="fa fa-file-text-o"></i></span> <span class="tenantstyl">Tenant Details</span></span></a>
                                        </td><?php }
                                    else { ?>
                                        <td style="vertical-align:top !important;">
                                            <p class="text-inherit">Rental Service Not Required</p></td>
                                    <?php }?>

                                    <td style="vertical-align:top !important; text-align:inherit;" id="mamount_<?php echo $i; ?>"><?php echo $reg['MMAmount'];?></td>
                                    <td style="vertical-align:top !important; text-align:inherit;" id="amount_<?php echo $i; ?>"><?php echo $reg['DepositAmount'];?></td>
                                    <td style="vertical-align:top !important; text-align:inherit;" id="edit_<?php echo $i; ?>"><a title="Edit"  href="<?php echo $this->basePath(); ?>/crm/property/entry/<?php echo $reg['PMRegisterId'];?>" style="padding-left: 15px; margin-top:8px;"><i class="fa fa-pencil-square-o reg-icon"></i></a></td>
                                    <?php if($reg['IsRentOut']==1) { ?>
                                        <tr class="duplicateTr" style="background: #e6eaeb;" id="tenantdet_<?php echo $i; ?>">
                                            <td colspan="10" style="">
                                                <div class="subDiv">
                                                    <?php foreach($reg['rental'] as $rent) {
                                                        ?>
                                                        <table class="table"  style="margin-bottom: 0px ! important; border-bottom:1px solid #ddd;">
                                                            <tbody>
                                                            <tr style="border: unset !important;">
                                                                <td style="border: unset !important; vertical-align:top !important;">
                                                                    <span>Tenant Name</span>
                                                                    <p id="tenant_<?php echo $i; ?>"><?php echo $rent['LeaserName'];?></p>
                                                                    <p class="text-inherit fntsz13"><span class="p_label"><span class="mapaddress_icon"><i class="fa fa-map-marker"></i></span></span><?php echo $rent['Add'] ?></p>
                                                                </td>
                                                                <input type="hidden" id="trans" name="transid"  value="<?php echo $rent['TransId'];?>"/>
                                                                <td style="border: unset; vertical-align:top !important" id="aggree_<?php echo $i; ?>">
                                                                    <p class="text-inherit fntsz13">Agreement No :<?php echo $rent['RefNo'];?>  on <?php echo date('d-m-Y', strtotime($rent['AgtDate']));?> </p>
                                                                    <p class="text-inherit fntsz13">Renewal on :<?php if(date('d-m-Y', strtotime($rent['RefDate'])) =='01-01-1970'){ echo '-'; } else { echo  date('d-m-Y', strtotime($rent['RefDate']));} ?> </p>
                                                                    <p class="text-inherit fntsz13">Deposit Amount: Rs.<?php echo $rent['SDAmount'];?>/-</p>

                                                                    <p class="text-inherit fntsz13">Validity from <?php echo date('d-m-Y', strtotime($rent['StartDate']));?>to <?php echo date('d-m-Y', strtotime($rent['LeasePeriod'].' months', strtotime($rent['StartDate'])));?></p>
                                                                </td>
                                                                <td style="border: unset;vertical-align:top !important" id="rent_<?php echo $i; ?>">
                                                                    <p class="text-inherit fntsz13">Rental Rate: <?php echo $rent['RentAmount'];?> Month</p>
                                                                    <p class="text-inherit fntsz13">Rental Due Day: <?php echo $rent['DueDay'];?></p>
                                                                    <p class="text-inherit fntsz13">Grace Period: <?php echo $rent['GracePeriod'];?> Days</p>
                                                                    <p class="text-inherit fntsz13">Late Fees: Rs.<?php echo  $reg['rentalBill']['LateFees'];?> </p>
                                                                </td>
                                                                <td style="vertical-align:top !important; border: unset;">
                                                                    <p class="text-inherit fntsz13">Last Paid: Rs.<?php echo  $reg['rentalBill']['Amount']; ?></p>
                                                                    <p class="text-inherit fntsz13">Next Due: </p>
                                                                </td>
                                                                <td style="border: unset; vertical-align: top !important;" id="changes_<?php echo $i; ?>">
                                                                    <ul class="prop_reg_link">
                                                                        <li onclick="return tenantedit('<?php echo $i;?>','<?php echo $rent['RentalRegisterId'];  ?>','<?php echo $rent['RentalType'];?>');"><a href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i> Edit</a></li>
                                                                        <?php if($rent['RenewalType'] == 'Y'||'D'){ ?>
                                                                        <li onclick="return tenantrenew('<?php echo $i;?>','<?php echo $rent['RentalRegisterId'];  ?>','<?php echo $rent['RentalType'];?>');"><a title="renew" href="javascript:void(0);"><i class="fa fa-recycle"></i> Renew</a></li><?php } ?>
                                                                        <li onclick="return tenantcancel('<?php echo $i;?>','<?php echo $rent['RentalRegisterId'];  ?>','<?php echo $rent['RentalType'];?>');"><a title="cancel" href="javascript:void(0);"><i class="fa fa-times"></i> Cancel</a></li>
                                                                    </ul>
                                                                <td style="border: unset; vertical-align: top !important;">
                                                                    <ul class="chatboxcrm">
                                                                        <li style="padding: 0px 4px 0px 4px;" class="float_l"><a href="#"><span style="color:#fff;font-size:15px;"><i class="fa fa-envelope"></i></span></a></li>
                                                                        <li style="padding: 0px 4px 0px 4px;" class="float_l"><a href="#"><span style="color:#fff;font-size:15px;"><i class="fa fa-comment"></i></span></a></li>

                                                                        <li style="padding: 0px 4px 0px 4px;" class="float_l"><a href="#"><span style="color:#fff;font-size:15px;"><i class="fa fa-phone"></i></span></a></li>
                                                                    </ul>
                                                                </td>

                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    <?php } ?>
                                                </div>
                                            </td>
                                        </tr>
                                    <?php }
                                    $i++;

                                } ?>

                            <?php } ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="agreementnext" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog width865" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h1>Agreement to be Expired Next 7 Days<span id="delEntryName" class="bld-txt"></span>?</h1>
            </div>
            <div class="modal-body">
                <div class="padlr0">
                    <div class="container-fluid">
                        <div class="">
                            <div class="col-lg-12 commargin_top_20">
                                <div class="table-responsive">
                                    <div id="jqxGrid"> </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="commargin_top commargin_bottom">
                    <a href="javascript:void(0);" data-dismiss="modal" aria-hidden="true" class="md_ok">Cancel</a>
                    <!-- <a href="javascript:void(0);" id="btnDeleteYes" class="md_ok">Delete</a>--></div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="rentcollection" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1">
    <div class="modal-dialog width865" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h1>Rent collection<span id="RentName" class="bld-txt"></span>?</h1>
            </div>
            <div class="modal-body">
                <div class="padlr0">
                    <div class="container-fluid">
                        <div class="">
                            <div class="col-lg-12 commargin_top_20">
                                <div class="table-responsive">
                                    <div id="jqxGrid1"> </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="commargin_top commargin_bottom">
                    <a href="javascript:void(0);" data-dismiss="modal" aria-hidden="true" class="md_ok">Cancel</a>
                    <!-- <a href="javascript:void(0);" id="btnDeleteYes" class="md_ok">Delete</a>--></div>
            </div>
        </div>
    </div>
</div>
<script>
    $(".duplicateTr").hide();

    function tenantshow(i){
        var t=i;
//alert(t);
        $('#tenantdet_'+t).toggle();
    }
</script>
<script>
    //agreement expires in next 7 days//
    var data = <?php echo (isset($Aggrement)) ? json_encode($Aggrement) : ''?>,
        $jqxGrid = $("#jqxGrid");
    $(function () {
        var source = {
            localdata: data,
            dataType: "json",
            dataFields: [
                { name: 'RentalRegisterId', type: 'int'},
                { name: 'AgtDate', type: "date", format: 'MM/dd/yyyy'},
                { name: 'RefNo', type: 'int' },
                { name: 'UnitNo', type: 'string' },
                { name: 'BookingName', type: 'string' },
                { name: 'LeaserName', type: 'string' }
                // { name: 'ChequeDate', type: 'string' },
                // { name: 'BankName', type: 'string' },
                //  { name: 'Remarks', type: 'string' }
            ],
            id: 'RentalRegisterId'
        };

        var dataAdapter = new $.jqx.dataAdapter(source);
        $jqxGrid.jqxGrid({
            width: "100%",
            source: dataAdapter,
            sortable: true,
            pagerButtonsCount: 6,
            filterable: true,
            pageable: true,
            rowDetails: true,
            autoheight: true,
            showfilterrow: true,
            editable: false,
            altrows: true,
            enabletooltips: true,
            columns: [
                {text: 'RentalRegisterId', datafield: 'RentalRegisterId', hidden: true, filterable: false},
                {text: 'Unit No', datafield: 'UnitNo', width: '15%'},
                {text: 'AgtNo', datafield:'RefNo', width: '15%'},
                {text: 'AgtDate', datafield: 'AgtDate', filtertype: 'date', cellsformat: 'd' , width: '15%'},
                {text: 'OwnerName', datafield: 'BookingName', width: '20%'},
                {text: 'TenantName', datafield: 'LeaserName', width: '15%'},
                //{ text: 'Expired On', dataField: 'ChequeNo', width:'10%'},
                {text: 'Action', sortable: false, filterable: false, align: 'left', width: '20%',
                    cellsrenderer: function (row) {
                        var RegisterId = $jqxGrid.jqxGrid('getCellValue', row, 'RentalRegisterId'),
                            editLink = '<a title="Edit" style="vertical-align:top !important;" class="tenantstyl" href="'+ getBaseURL() + 'crm/property/agreement-renewal/add/'+RegisterId+'">RenewNow</a>';
                        return editLink ;
                    }
                }
            ]
        });
    });
    //Rental collection//
    var data1 = <?php echo (isset($payList)) ? json_encode($payList) : ''?>,
        $jqxGrid1 = $("#jqxGrid1");
    $(function () {
        var source1 = {
            localdata: data1,
            dataType: "json",
            dataFields: [
                { name: 'UnitNo', type: 'int'},
                { name: 'PVDate', type: "date", format: 'MM/dd/yyyy'},
                { name: 'PVNNo', type: 'int' },
                { name: 'LeadName', type: 'string' },
                { name: 'ProjectName', type: 'string' },
                { name: 'TotalAmountPayable', type: 'string' }
                // { name: 'ChequeDate', type: 'string' },
                // { name: 'BankName', type: 'string' },
                //  { name: 'Remarks', type: 'string' }
            ],
            id: 'RegisterId'
        };

        var dataAdapter1 = new $.jqx.dataAdapter(source1);
        $jqxGrid1.jqxGrid({
            width: "100%",
            source: dataAdapter1,
            sortable: true,
            pagerButtonsCount: 6,
            filterable: true,
            pageable: true,
            rowDetails: true,
            autoheight: true,
            showfilterrow: true,
            editable: false,
            altrows: true,
            enabletooltips: true,
            columns: [
                {text: 'RegisterId', datafield: 'RegisterId', hidden: true, filterable: false},
                {text: 'Unit No', datafield: 'UnitNo', width: '20%'},
                {text: 'Pv No', datafield:'PVNo', width: '20%'},
                {text: 'PV Date', datafield: 'PVDate', filtertype: 'date', cellsformat: 'd' , width: '20%'},
                {text: 'Tenant Name', datafield: 'LeadName', width: '20%'},
                {text: 'Amount', datafield: 'TotalAmountPayable', width: '20%'}
                //{ text: 'Expired On', dataField: 'ChequeNo', width:'10%'},

            ]
        });
    });


    $('.projectreg').on('click',function(){
        var urlId = $(this).attr('data-index');
        $.ajax({
            url:getBaseURL()+"crm/property/register",
            type:"post",
            data:"ProjectId="+urlId,
            success:function(data,textStatus,jqXHR){}});
    });


    function tenantedit(i,TransId,sname){

        var tname=TransId;
        if(sname=='R'){
           // console.log(sname);
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/rental-agreement/edit/"+tname);
        }
        else if(sname=='C'){
           // console.log(sname);
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/commercial-agreement/edit/"+tname);
        }

    }
    function tenantrenew(i,TransId,sname){

        var tname=TransId;

        $.ajax({
            url:getBaseURL()+"crm/property/register",
            type:"post",
            data:{'tname':tname,'mode' :'renew'},
            success:function(data){
                var dt = JSON.parse(data);

                if(data=='false'){
                    $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/agreement-renewal/add/"+tname);
                }
                else{
                    $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/agreement-renewal/edit/"+dt.RentalRegisterId);
                }

            },
            error:function(jqXHR, textStatus, errorThrown){
                alert(textStatus+"-----"+errorThrown);
            }
        });
    }
    function tenantcancel(i,TransId,sname){

        var tname=TransId;

        $.ajax({
            url:getBaseURL()+"crm/property/register",
            type:"post",
            data:{'tname':tname ,'mode' :'cancel'},
            success:function(data){

                if(data=='false'){
                    $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/agreement-cancellation/add/"+tname);
                }
                else{
                    $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/property/agreement-cancellation/edit/"+tname);
                }

            },
            error:function(jqXHR, textStatus, errorThrown){
                alert(textStatus+"-----"+errorThrown);
            }
        });
    }


    $("#search").keyup(function(){
        _this = this;
        // Show only matching TR, hide rest of them
        $.each($("#sequentialView tbody tr"), function() {
            if($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase()) === -1)
                $(this).hide();
            else
                $(this).show();
        });
    });


</script>
