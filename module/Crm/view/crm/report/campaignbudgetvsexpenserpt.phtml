<script type="text/javascript"  src="<?php echo $this->basePath(); ?>/library/amcharts/amcharts.js"></script>
<script type="text/javascript"  src="<?php echo $this->basePath(); ?>/library/amcharts/pie.js"></script>
<script type="text/javascript"  src="<?php echo $this->basePath(); ?>/library/amcharts/themes/light.js"></script>
<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/workorder.css"/>
<style type="text/css">
.total_executive_amt	{width:auto !important; height:inherit !important; border:0px !important; background:none !important; padding:0px 10px !important;}
.total_executive_amt li label	{width:auto !important;}
.pnnal_amt_p			{ font-size:14px;}
#chartdiv {
	width		: 100%;
	height		: 300px;
	font-size	: 13px;
}
#chartdiv1 {
    width		: 100%;
    height		: 300px;
    font-size	: 13px;
}
.mini-stat {
    background: #fff none repeat scroll 0 0;
    border-radius: 3px;
    margin-bottom: 20px;
    padding: 10px;
    -webkit-box-shadow: 1px 1px 0px 0px rgba(50, 50, 50, 0.23);
    -moz-box-shadow:    1px 1px 0px 0px rgba(50, 50, 50, 0.23);
    box-shadow:         1px 1px 0px 0px rgba(50, 50, 50, 0.23);
}
.mini-stat-icon {
    border-radius: 100%;
    color: #fff;
    display: inline-block;
    float: left;
    font-size: 20px;
    height: 40px;
    line-height: 40px;
    text-align: center;
    width: 40px;
	margin-top: 7px;
}
.mini-stat-info {
    font-size: 13px !important;
    padding-top: 10px;
    text-align:right;
}
.mini-stat-info span {
    display: block;
    font-size: 15px;
    font-weight: 600;
}
.orange {
    background: #fa8564!important;
}
.tar {
    background: #1fb5ac!important;
}
.pink {
    background: #a48ad4!important;
}
.green {
    background: #aec785!important;
}
.proname_btn .select2-container{ background-color:#efefef;color:#244996;}
.proname_btn .select2-container .select2-selection--single .select2-selection__rendered{padding-top:0px; padding-bottom:5px;}
.proname_btn .select2-container--default .select2-selection--single{font-size:26px; line-height:28px;}
</style>
<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="col-lg-6 col-md-6 col-sm-5 padlr0"><div class="btn-group proname_btn">
                        <select name="project_filter"  id="project_filter"  class="form-control single_dropdown" onchange="reportSearch($(this).val());" style="width:auto; min-width:410px !important;max-width:420px !important;">
                            <option <?php if(isset($reportId) && $reportId==1) { echo 'selected'; } ?> value="1">Project Wise Sales</option>
                            <option <?php if(isset($reportId) && $reportId==2) { echo 'selected'; } ?> value="2">Stage Wise Receivable Statement</option>
                            <option <?php if(isset($reportId) && $reportId==3) { echo 'selected'; } ?> value="3">Executive Analysis</option>
                            <option <?php if(isset($reportId) && $reportId==4) { echo 'selected'; } ?> value="4">Rent Receivable</option>
                            <option <?php if(isset($reportId) && $reportId==5) { echo 'selected'; } ?> value="5">Unit Transfer History</option>
                            <option <?php if(isset($reportId) && $reportId==6) { echo 'selected'; } ?> value="6">Receivable Statement</option>
                            <option <?php if(isset($reportId) && $reportId==7) { echo 'selected'; } ?> value="7">Ageing Report</option>
                            <option <?php if(isset($reportId) && $reportId==8) { echo 'selected'; } ?> value="8">Marketing Analysis</option>
                            <option <?php if(isset($reportId) && $reportId==9) { echo 'selected'; } ?> value="9">Maintenance Receivable</option>
                            <option <?php if(isset($reportId) && $reportId==10) { echo 'selected'; } ?> value="10">Unit Cancel History</option>
                            <option <?php if(isset($reportId) && $reportId==11) { echo 'selected'; } ?> value="11">Project Wise Receivable</option>
                            <option <?php if(isset($reportId) && $reportId==12) { echo 'selected'; } ?> value="12">Buyer Wise Receivable</option>
                            <option <?php if(isset($reportId) && $reportId==13) { echo 'selected'; } ?> value="13">Customer Info Report</option>
                            <option <?php if(isset($reportId) && $reportId==14) { echo 'selected'; } ?> value="14">Payable to Broker</option>
                            <option <?php if(isset($reportId) && $reportId==15) { echo 'selected'; } ?> value="15">Unit Block History</option>
                            <option <?php if(isset($reportId) && $reportId==16) { echo 'selected'; } ?> value="16">Project Status</option>
                            <option <?php if(isset($reportId) && $reportId==17) { echo 'selected'; } ?> value="17">Sales Team Performance</option>
                            <option <?php if(isset($reportId) && $reportId==18) { echo 'selected'; } ?> value="18">Customer Classification Report</option>
                            <option <?php if(isset($reportId) && $reportId==19) { echo 'selected'; } ?> value="19">Campaign Budget vs Expense</option>
                            <option <?php if(isset($reportId) && $reportId==20) { echo 'selected'; } ?> value="20">Unit PreBook History</option>
                            <option <?php if(isset($reportId) && $reportId==21) { echo 'selected'; } ?> value="21">Executive Wise Next Followup Analysis</option>
							<option <?php if(isset($reportId) && $reportId==22) { echo 'selected'; } ?> value="22">Cost Impact</option>
                        </select>
                    </div></h1>
                <div class="col-lg-6 col-md-6 col-sm-7 padlr0">
                    <label class="col-lg-3 col-lg-offset-3 col-md-3 col-md-offset-3 col-sm-4 col-sm-offset-2 control-label text-right">Project Name</label>
                    <div class="col-lg-6 col-md-6 col-sm-6 m_btm10"> 
						<select name="projectId" id="projectId" class="form-control single_dropdown lbl_move sortoption" style="width:100%;" >
							<option value="0">All</option>
							<?php foreach($projectList as $project){ ?>
									<option value="<?php echo $project['ProjectId'] ?>" <?php if($project['ProjectId']==$projectId ) { echo 'selected';} ?> ><?php echo $project['ProjectName'] ?></option>
							<?php } ?>
						</select>						
                    </div>
                </div>
            </div>
            
            <div class="col-lg-12">
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                    <div class="mini-stat clearfix" data-bsfshare="Campaign Cost">
                        <span class="mini-stat-icon tet-cllr4"><i class="fa fa-gavel"></i></span>
                        <div class="mini-stat-info comnelips">
                            <span class="comnelips">Rs.<?php echo $this->commonHelper()->sanitizeNumber($totTurnaroundCost,2,true); ?></span>
                            Budget Amount
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                    <div class="mini-stat clearfix">
                        <span class="mini-stat-icon orange"><i class="fa fa-usd"></i></span>
                        <div class="mini-stat-info comnelips">
                            <span class="comnelips">Rs.<?php echo $this->commonHelper()->sanitizeNumber($totCampaignCost,2,true); ?></span>
                            Campaign Expense
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-6 mnimumwidthres">
                    <div class="mini-stat clearfix" data-bsfshare="Expected Revenue">
                        <span class="mini-stat-icon tar"><i class="fa fa-bolt"></i></span>
                        <div class="mini-stat-info comnelips">
                            <span class="comnelips">Rs.<?php echo $this->commonHelper()->sanitizeNumber($balCampaignCost,2,true); ?></span>
                            Balance Amount 
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-12 clear">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <section class="pnnal">
                        <header class="pnnal-heading"><i class="fa fa-bar-chart"></i> <span class="fntsz16">&nbsp;Campaign Expense Breakup</span></header>
                        <div class="pnnal-body">
                            <div id="chartdiv"></div>
                            <div class="table-responsive clear">
                                <div style='margin-top: 10px;' id="jqxgrid"> </div>
                            </div>	
                        </div>
                    </section>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <section class="pnnal">
                        <header class="pnnal-heading"><i class="fa fa-bar-chart"></i> <span class="fntsz16">&nbsp;Budget Spent</span></header>
                        <div class="pnnal-body">
                            <div id="chartdiv1"></div>
                            <div class="table-responsive clear">
                                <div style='margin-top: 10px;' id="jqxgrid1"> </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
var arr_Lists = <?php echo (isset($campaignList)) ? json_encode($campaignList) : '[]';?>;
var arr_Cost = <?php echo (isset($arrCostList)) ? json_encode($arrCostList) : '[]';?>;

$('#projectId').on('change', function(){
	var projectId = $(this).val();
	if(projectId !=  '') {
		window.location.replace(getBaseURL() + "crm/report/campaignbudgetvsexpenserpt/" + projectId);
	} else{
		window.location.replace(getBaseURL() + "crm/report/campaignbudgetvsexpenserpt/0");
	}
});
function reportSearch(rId) {

    switch (parseInt($.trim(rId))) {
        case 1:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/projectwisesalesrpt");
            break;
        case 2:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/stagewisereceivablerpt/0/0");
            break;

        case 3:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/executiveanalysisrpt");
            break;
        case 4:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/rentreceivablerpt");
            break;
        case 5:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/unittransferhistory");
            break;
        case 6:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/receivablestatementrpt");
            break;
        case 7:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/ageingrpt");
            break;
        case 8:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/marketinganalysisrpt");
            break;
        case 9:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/maintenancereceivablerpt");
            break;
        case 10:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/unitcancelhistory");
            break;
        case 11:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/projectwisereceivablerpt");
            break;
        case 12:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/buyerwisereceivablerpt");
            break;
        case 13:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/customerinforpt");
            break;
        case 14:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/payabletobrokerrpt");
            break;
        case 15:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/block-history");
            break;
        case 16:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/projectstatus");
            break;
        case 17:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/salesteamperformancerpt");
            break;
        case 18:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/customerclasificationrpt");
            break;
        case 19:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/campaignbudgetvsexpenserpt");
            break;
        case 20:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/prebook-history");
            break;
        case 21:
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/executive-next-followup");
            break;
        default :
            $(location).attr('href',"<?php echo $this->basePath(); ?>/crm/report/reportlist");
            break;
    }

}

var chart = AmCharts.makeChart( "chartdiv", {
    "type": "pie",
    "theme": "light",
    "innerRadius": "40%",
    "gradientRatio": [-0.4, -0.4, -0.4, -0.4, -0.4, -0.4, 0, 0.1, 0.2, 0.1, 0, -0.2, -0.5],
    "dataProvider": <?php echo (isset($campaignList)) ? json_encode($campaignList) : '[]';?>,
    "valueField": "Amount",
    "titleField": "OpportunityName",
    "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
//    "balloon": {
//        "drop": true,
//        "adjustBorderColor": false,
//        "color": "#FFFFFF",
//        "fontSize": 12
//    },
    "export": {
        "enabled": true
    }
} );


var chart1= AmCharts.makeChart( "chartdiv1", {
    "type": "pie",
    "theme": "light",
    "dataProvider": <?php echo (isset($arrbal)) ? json_encode($arrbal) : '[]';?>,
    "valueField": "Amount",
    "titleField": "Type",
    //"balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
    "balloon":{
        "fixedPosition":true
    },
    "export": {
        "enabled": true
    }
} );


$(document).ready(function () {
	// Load Grid
	var source = {
		localdata: arr_Lists,
		datatype: "json",
		pagesize: 15,
		datafields:
		[	
			{ name: "OpportunityName", type: "string" },
			{ name: "Amount", type: "number" }
		]
	};

	var dataAdapter = new $.jqx.dataAdapter(source);
	$("#jqxgrid").jqxGrid(
	{
		width: "100%",
		source: dataAdapter,
		sortable: true,
		pagerButtonsCount: 6,
		showfilterrow: true,
		filterable: true,
		pageable: true,
		rowDetails: true,
		autoheight: true,
		selectionmode: 'singlerow',
		editable: false,
		altrows: true,
		enabletooltips: true,
		autorowheight: true,
		columns: [	
			{ text: 'CampaignCategory', dataField: 'OpportunityName', align: 'center', pinned: true ,width:"60%" },
			/*{ text: 'Amount', dataField: 'Amount', align: 'right', cellsalign: 'right',width:"40%", cellsformat: "d", aggregates: ['sum'],
                      aggregatesrenderer: function (aggregates, column, element, summaryData) {
                          var renderstring = "<div>";
                          $.each(aggregates, function (key, value) {
                              var name = key == 'Amount';
                              renderstring += '<div><strong>' + value + '</div></strong>';
                          });
                          renderstring += "</div>";
                          return renderstring;
                      }
			}*/
			{text: 'Amount', dataField: 'Amount', width: '40%', align: 'right', cellsalign: 'right', cellsformat: "d2"}
		]
	});

    //Budget spent source
    var budgetSource = {
        localdata: arr_Cost,
        datatype: "json",
        pagesize: 15,
        datafields:
            [
                { name: "BudgetSpent", type: "string" },
                { name: "Amount", type: "number" }
            ]
    };
    var dataAdapter1 = new $.jqx.dataAdapter(budgetSource);
    $("#jqxgrid1").jqxGrid(
        {
            width: "100%",
            source: dataAdapter1,
            sortable: true,
            pagerButtonsCount: 6,
            showfilterrow: true,
            filterable: true,
            pageable: true,
            rowDetails: true,
            autoheight: true,
            selectionmode: 'singlerow',
            editable: false,
            altrows: true,
            enabletooltips: true,
            autorowheight: true,
            columns: [
                {text: 'BudgetSpent', dataField: 'BudgetSpent', align: 'center', pinned: true ,width:"60%" },
                {text: 'Amount', dataField: 'Amount', width: '40%', align: 'right', cellsalign: 'right', cellsformat: "d2"}
            ]
        });


	//bindJqxGridAutoResize();
});

</script>