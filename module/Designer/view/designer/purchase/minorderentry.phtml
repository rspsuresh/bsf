
<style type="text/css">
	.lbl_btm {padding-bottom:10px!important;}
	.lbl_tp {padding-top:10px!important;}
	.pan_box	{display:block; width:100%; background:#fff; box-shadow: inset 0 0 1em #ccc; height:200px;border-bottom:3px solid #2d74b4; position:relative;transition: all 0.5s ease; margin-bottom:15px;cursor:pointer;}
	.pan_box ul {width:100%;  padding:13px; margin-left:10px; float:left; padding-top:8px;}
	.pan_box ul li  {width:100%; padding-bottom:5px; float:left;}
	.pan_box ul li label {font-size:13px; color:#009688;  float:left; width:55%; padding-left: 6px;}
	.pan_box ul li span input[type=text] {border:none;font-size:13px; color:#266aa8;white-space: nowrap;overflow: hidden;text-overflow: ellipsis; }
	.top-20	{margin-top:20px;}
	.pad_rt-10	{padding-right:10px;}
	.tick	{margin-left:20px; color:#266aa8;}
	.triangle-r {
		border-color: transparent transparent transparent #2d74b4;
		border-style: solid;
		border-width: 12px;
		height: 0px;
		width: 0px;
		position: absolute;
		left: 340px;
		top: 187px;
		z-index: -1;
		}
	.pan_box:hover{cursor:pointer;border-bottom:3px solid #74aadc;}
	.triangle-r:hover {
		border-color: transparent transparent transparent #74aadc;}
	
</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/mms/purchase/">
<input type="hidden" name="CostCenterId" value="<?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>">
<input type="hidden" name="PORegId" value="<?php echo (isset($poRegId)) ? $poRegId : 0;?>">
<input type="hidden" name="VendorId" value="<?php echo (isset($vendor)) ? $vendor['VendorId'] : '';?>">
<!-- <input type="hidden" name="OrderType" id="OrderType" value="<?php ?>"> -->
<div class="col-lg-12">
    <h1>Min Order</h1>
</div>
<div class="col-lg-12">
    <div class="col-lg-4">
        <div class="pan_box">
            <ul>
                <li>
                    <label class="lbl_btm lbl_tp">DC.NO</label>
                    <span><?php echo (isset($DCNO)) ? $DCNO['DCNO'] : '';?></span>
                </li>
                <li>
                    <label  class="lbl_btm">CCD.NO</label>
                    <span><?php echo (isset($CCDNO)) ? $CCDNO['CCDNO'] : '';?></span>
                </li>
                <li class="pad_rt-10">
                    <select data-placeholder="PO Type" class="form-control single_dropdown sortoption"  name="PO Type" id="PO Type" style="width:100%;">
                    </select>    
                </li>
                <li class="pad_rt-10">
                    <select data-placeholder="Account" class="form-control single_dropdown sortoption"  name="Account" id="Account" style="width:100%;">
                    </select>
                </li> 
            </ul>
			<div class="triangle-r"></div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="pan_box">
            <ul>
                <li>
                    <label class="lbl_btm lbl_tp">Ref.No</label>
                    <span><?php echo (isset($RefNo)) ? $RefNo['RefNo'] : '';?></span>
                </li>
                <li>
                    <label class="lbl_btm">Ref.Date</label>
                    <span><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="RefDate" name="RefDate" value="<?php echo (isset($RefDate)) ? $RefDate : date('d-m-Y');?>" onChange="validateDate(this)"/></span>
                </li>
                <li>
                    <label  class="lbl_btm">CDC.NO</label>
                    <span><?php echo (isset($CCDNO)) ? $CCDNO['CDCNO'] : '';?></span>
                </li>
               	<li class="lbl_hgt pad_rt-10">
            		<select name="named[]" id="multiple_status" class="form-control selectpicker sortoption" data-size="5" multiple="multiple" data-placehodler="Distributor">
						<option>1</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
					</select>  
                </li>
            </ul>
			<div class="triangle-r"></div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="pan_box">
            <ul>
                <li class="checkbox-styled lbl_tp">
                	<label>
                    <input type="checkbox"class="chkbx" >
                    <span><p class="tick">Include Tax</p></span>
                    </label>
         		</li>	
                <li class="pad_rt-10">
                    <select data-placeholder="Gate Pass No" class="form-control single_dropdown sortoption"  name="Gate Pass No" 
                    id="Gate Pass No" style="width:100%;">
                    </select>    
                </li>
                <li class="pad_rt-10">
                    <select data-placeholder="Vehicle No" class="form-control single_dropdown sortoption"  name="Vehicle No" 
                    id="Vechile No" style="width:100%;">
                    </select>
                </li> 
            </ul>
			<div class="triangle-r"></div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div class="col-lg-12 clear top-20">
    <div id="accordion" class="panel-group">
        <!-------------------------------Bill of Quantities------------------------------->
        <div class="panel panel-info">
            <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                <h4 class="panel-title accordion-toggle defa_panels">Purchase Quantity</h4>
            </div>
            <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                <div class="panel-body bgcolr">
                    <div class="col-lg-12">
                        <div class="table-responsive top-30">
                            <table class="table" style=" margin-bottom:0px;" id="workorderTable">
                                <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>Unit</th>
                                    <th>Qty</th>
                                    <th>Rate</th>
                                    <th>QRate</th>
                                    <th>BaseAmount</th>
                                    <th>Amount</th>
                                    <th>&nbsp; </th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                <tr>
                                    <td colspan="5">&nbsp;</td>
                                    <td align="right" class="rate_pri">Total Amount</td>
                                    <td width="10%" ><input class="parent_text border-none" type="text" name="total" id="total" readonly/></td>
                                    <td>&nbsp;</td>
                                </tr>
                                </tbody>
                            </table>
                            <input type="hidden" name="rowid" id="rowid" value="0"/>
                        </div>
                        <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                            <ul>
                                <li><a href="javascript:nextAccordian(2)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-------------------------------Bill of Quantities end------------------------------->
        <!-------------------------------Terms and Condition------------------------------->
        <div class="panel panel-info">
            <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
                <h4 class="panel-title accordion-toggle defa_panels">Terms and Condition</h4>
            </div>
            <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
                <div class="panel-body bgcolr">
                    <div class="clearfix"></div>
                    <div class="col-lg-12">
                        <div class="table-responsive topsp" style="margin-top:20px;">
                            <table class="table tableWithFloatingHeader highlightTable" style=" margin-bottom:0px;" id="otherTermsTable">
                                <thead>
                                <tr>
                                    <th>Terms Title</th>
                                    <th>Terms Description</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <input type="hidden" name="termrowid" id="termrowid" value="0"/>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-lg-12">
                        <div class="card">
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#home1" aria-controls="home" role="tab" data-toggle="tab">Price Escalation</a></li>
                                <li><a href="#profile1" aria-controls="profile" role="tab" data-toggle="tab">Client Supply Materials</a></li>
                                <li><a href="#messages1" aria-controls="messages" role="tab" data-toggle="tab">Material Advance</a></li>
                                <li><a href="#tech-tem" aria-controls="settings" role="tab" data-toggle="tab">Technical Specification</a></li>
                                <li><a href="#Note" aria-controls="settings" role="tab" data-toggle="tab">Note</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="home1">
                                    <p>
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp">
                                            <table class="table highlightTable" style=" margin-bottom:0px;" id="materialTable">
                                                <thead>
                                                <tr>
                                                    <th>Material Name</th>
                                                    <th class="text-center">Unit</th>
                                                    <th class="text-right">Rate</th>
                                                    <th class="text-right">Escalation %</th>
                                                    <th class="text-right">Condition</th>
                                                    <th class="text-right">Esc. Rate</th>
                                                    <th class="text-center">Action</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                            <input type="hidden" name="materialrowid" id="materialrowid" value="0"/>
                                        </div>
                                    </div>
                                    </p>
                                </div>
                                <div class="tab-pane" id="profile1">
                                    <p>
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp">
                                            <table class="table highlightTable" style=" margin-bottom:0px;" id="materialExcTable">
                                                <thead>
                                                <tr>
                                                    <th>Material Name</th>
                                                    <th>Unit</th>
                                                    <th class="text-right">Rate</th>
                                                    <th>Supply Type</th>
                                                    <th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                            <input type="hidden" name="materialExcrowid" id="materialExcrowid" value="0"/>
                                        </div>
                                    </div>
                                    </p>
                                </div>
                                <div class="tab-pane" id="messages1">
                                    <p>
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp">
                                            <table class="table highlightTable" style="margin-bottom:0px;" id="materialAdvTable">
                                                <thead>
                                                <tr>
                                                    <th>Material Name</th>
                                                    <th class="text-left">Percentage</th>
                                                    <th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                            <input type="hidden" name="materialAdvrowid" id="materialAdvrowid" value="0"/>
                                        </div>
                                    </div>
                                    </p>
                                </div>
                                <div class="tab-pane" id="tech-tem">
                                    <p>
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp">
                                            <table class="table tableWithFloatingHeader highlightTable" style=" margin-bottom:0px;" id="techTitleTable">
                                                <thead>
                                                <tr>
                                                    <th>Title</th>
                                                    <th>Specification</th>
                                                    <th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                            <input type="hidden" name="techrowid" id="techrowid" value="0"/>
                                        </div>
                                    </div>
                                    </p>
                                </div>
                                <div class="tab-pane" id="Note">
                                    <p>
                                    <div class="col-lg-12">
                                        <textarea class="exp-tex" name="Notes" id="Notes"> <?php echo (isset($woterms['Notes'])) ? $woterms['Notes'] : '';?> </textarea>
                                    </div>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-------------------------------Terms and Condition------------------------------->
    </div>
</div>
<div class="clearfix"></div>
</form>
</div>
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r"><a onClick="submitForm()" data-toggle="tooltip" class="ripple" title="Submit">Submit</a>
        <li class="cancel_btn float_r"><a href="<?php echo $this->basePath();?>/designer/purchase/minorder" data-toggle="tooltip" class="ripple" title="Go back!">Back</a></li>
    </ul>
</div>
<script id="resource-template"  type="text/template" class="hide">
    <tr>
        <td width="25%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);"/>
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td width="15%">
            <input class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="10%"><input class="parent_text border-none" type="text" name="qty__" id="qty__" readonly/></td>
        <td width="18%"><input class="parent_text border-none" type="text" name="rate__" id="rate__" readonly/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="qrate__" id="qrate__" readonly/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="baseamount__" id="baseamount__" readonly/></td>
        <td width="20%"><input class="parent_text border-none" type="text" name="amount__" id="amount__" readonly/></td>
        <td width="15%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
	<div class="modal fade" id="myModal" role="dialog">
	<div class="modal-dialog"> 
    	<div class="modal-content">
        	<div class="modal-header">
            	<button type="button" class="close" data-dismiss="modal">&times;</button>
               	<h4 class="modal-title" style="color:#18439d;">Successfully Import</h4>
            </div>
            <div class="modal-body">
            	<div class="txt_center col-lg-8 col-lg-offset-4">
               	</div>
             	<div class="modal-footer clear"> 
            </div>
      	</div>  
  	</div>
</div>   
</div>
    <tr style="display:none;" class="subTr">
        <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"> </div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="iowTable__">
                            <thead>
                            <tr>
                                <th class="worktype-activity">Decision No</th>
                                <th class="worktype-activity">BalQty</th>
                                <th>Qty</th>
                                <th class="iow___requestfields" style="display: none;">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            <tr>
                                <td>&nbsp;</td>
                                <td class="worktype-activity">&nbsp;</td>
                                <td class="worktype-activity">&nbsp;</td>
                                <td class="iow___requestfields" style="display: none;"></td>
                                <td align="right" class="rate_pri">Total Qty</td>
                                <td width="6%"><input class="parent_text border-none" type="text" name="totalqty__" id="totalqty__" readonly/></td>
                            </tr>
                            </tbody>
                            <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                        </table>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr>
        <td width="20%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___decisionno_0" id="iow___decisionno_0" readonly/>
            <input type="hidden" name="iow___decisionid_0" id="iow___decisionid_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
        </td>
        <td width="10%"><input class="parent_text border-none" type="text" name="iow___balqty_0" id="iow___balqty_0" readonly/></td>
        <td width="10%"><input class="parent_text" type="text" name="iow___qty_0" id="iow___qty_0" onkeypress="return isNumberKey(event,this)" onchange="calcQuantity(this);"/></td>
        <td width="10%" align="center" class="action_btns_td iow___requestfields" style="display: none;">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="iow___request_0_reqno">
                            <thead>
                            <tr>
                                <th>WBS Name</th>
                                <th>Bal Qty</th>
                                <th>Qty</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            <tr>
                                <td colspan="5">
                                    <ul class="total-qty">
                                        <li>
                                            <label>Estimate Qty: </label>
                                            <input class="parent_text border-none" type="text" name="iow___request_0_estimateqty" id="iow___request_0_estimateqty" value="50" readonly/>
                                        </li>
                                        <li>
                                            <label>Workorder Qty: </label>
                                            <input class="parent_text border-none" type="text" name="iow___request_0_workorderqty" id="iow___request_0_workorderqty" value="10" readonly/>
                                        </li>
                                        <li>
                                            <label>Total Billed Qty: </label>
                                            <input class="parent_text border-none" type="text" name="iow___request_0_totbilledqty" id="iow___request_0_totbilledqty" value="0" readonly/>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            </tbody>
                            <input type="hidden" name="iow___request_0_rowid" id="iow___request_0_rowid" value="0"/>
                        </table>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="request-template"  type="text/template" class="hide">
    <tr>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="iow___request_0_wbsname__9" id="iow___request_0_wbsname__9" readonly/>
            <input type="hidden" name="iow___request_0_wbsid__9" id="iow___request_0_wbsid__9"/>
            <input type="hidden" name="iow___request_0_resourceid__9" id="iow___request_0_resourceid__9"/>
            <input type="hidden" name="iow___request_0_itemid__9" id="iow___request_0_itemid__9"/>
        </td>
        <td width="5%"><input class="parent_text border-none" type="text" name="iow___request_0_balqty__9" id="iow___request_0_balqty__9" readonly/></td>
        <td width="5%"><input class="parent_text" type="text" name="iow___request_0_qty__9" id="iow___request_0_qty__9"  onkeypress="return isNumberKey(event,this)" onchange="calcRequestQuantity(this);"/></td>
    </tr>
</script>
<script id="otherterms-template"  type="text/template" class="hide">
    <tr>
        <td width="15%"><input class="parent_text" type="text" name="termTitle__" id="termTitle__" maxlength="155" onchange="addNewTermRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="termDesc__" id="termDesc__"></textarea></td>
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTermTr__" onclick="deleteTerm(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a></li>
            </ul>
        </td>
    </tr>
</script>
<script id="material-template"  type="text/template" class="hide">
    <tr class="padi05">
        <td width="13%">
            <input class="parent_text" type="text" name="materialName__" id="materialName__" onfocus="return checkMaterialPriceUsed(this)"/>
            <input type="hidden" class="materialNameInputs" name="materialId__" id="materialId__"/>
        </td>
        <td width="2%"><input class="parent_padi05" type="text" name="materialUnit__" id="materialUnit__" value="" readonly/></td>
        <td width="3%"><input class="parent_text text-right" type="text" name="materialRate__" id="materialRate__" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="2%"><input class="parent_text text-right" type="text" name="escalationper__" id="escalationper__"  onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="2%">
            <div class="select-style heg30">
                <select name="materialbase__" id="materialbase__" >
                    <option value=">">&gt;</option>
                    <option value="<">&lt;</option>
                </select>
            </div>
        <td width="8%"><input class="parent_text text-right" type="text" name="materialnewRate__" id="materialnewRate__" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="1%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a class="materialDeleteTr__" onclick="deleteMaterial(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script id="materialexc-template"  type="text/template" class="hide">
    <tr class="padi05">
        <td width="15%"><input class="parent_text" type="text" name="materialExcName__" id="materialExcName__" onfocus="return checkMaterialSupplyUsed(this)"/>
            <input type="hidden" class="materialExcNameInputs" name="materialExcId__" id="materialExcId__"/></td>
        <td width="3%"><input class="parent_padi05" type="text" name="materialExcUnit__" id="materialExcUnit__" readonly/>
        <td width="3%"><input class="parent_text" type="text" name="materialExcRate__" id="materialExcRate__" onkeypress="return isDecimal(event,this)" onchange="addNewMaterialExcRow(this)" onblur="return FormatNum(this, 2, true)"/>
        <td width="6%">
            <div class="select-style heg30">
                <select name="materialExcType__" id="materialExcType__">
                    <option value="C">Chargeable</option>
                    <option value="F">Free</option>
                </select>
            </div>
        <td width="1%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a class="materialExcDeleteTr__" onclick="deleteMaterialExc(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script id="materialadv-template"  type="text/template" class="hide">
    <tr>
        <td width="7%">
            <input class="parent_text" type="text" name="materialAdvName__" id="materialAdvName__" onchange="addNewMaterialAdvRow(this)" onfocus="return checkMaterialAdvUsed(this)"/>
            <input type="hidden" class="materialAdvNameInputs" name="materialAdvId__" id="materialAdvId__"/>
        </td>
        <td width="2%"><input class="parent_text text-left" type="text" name="materialAdvRate__" id="materialAdvRate__" onchange="addNewMaterialAdvRow(this)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="1%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a class="materialAdvDeleteTr__"  onclick="deleteMaterialAdv(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script id="techtitle-template"  type="text/template" class="hide">
    <tr>
        <td width="15%"><input class="parent_text" type="text" name="techTitle__" id="techTitle__" maxlength="155" onchange="addNewTechRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="techDesc__" id="techDesc__"></textarea></td>
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a class="deleteTechTr__" onclick="deleteTech(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul>
        </td>
    </tr>
</script>

<script type="text/javascript">
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var tmp_arr_resources = arr_resources;

var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;

var materiallists = <?php echo (isset($materiallists)) ? json_encode($materiallists) : '[]';?>;
var materialPrice = materiallists;
var materialSupply = materiallists;
var materialaAdv = materiallists;

var arr_otherTerms = <?php echo (isset($arr_otherTerms)) ? json_encode($arr_otherTerms) : '[]';?>;
var arr_materials = <?php echo (isset($arr_materials)) ? json_encode($arr_materials) : '[]';?>;
var arr_exc_materials = <?php echo (isset($arr_exc_materials)) ? json_encode($arr_exc_materials) : '[]';?>;
var arr_adv_materials = <?php echo (isset($arr_adv_materials)) ? json_encode($arr_adv_materials) : '[]';?>;

var WorkType = $('#WorkType').val();
var OrderType = $('#OrderType').val();

$(function () {
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();
    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.main');
    if(arr_requestResources.length != 0) {
        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));

            $('#desc_' + rowid).val(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).val(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#rate_' + rowid).val(o.Rate);
            $('#qrate_' + rowid).val(o.QRate);
            $('#baseamount_' + rowid).val();
            $('#amount_' + rowid).val();
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();

            $.each(arr_resource_iows, function(j, l) {
                if( (l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                    return;
                }
//|| (l.ProjectIOWId != o.DescId && OrderType == 'work' && WorkType == 'iow')
                var iowrowid = parseInt($('#iow_'+rowid+'_rowid').val()) + 1;
                $('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                $('#iow_'+rowid+'_rowid').val(iowrowid);

                $('#iow_'+ rowid +'_decisionid_'+ iowrowid).val(l.DecisionId);
                $('#iow_'+ rowid +'_decisionno_'+ iowrowid).val(l.DecisionNo);
                $('#iow_'+ rowid +'_balqty_'+ iowrowid).val(l.BalQty);
                $('#iow_'+ rowid +'_qty_'+ iowrowid).val(l.Qty);

                if(WorkType == 'activity') {
                    $('#iow_'+ rowid +'_agtno_'+ iowrowid).val(l.SerialNo);
                    $('#iow_'+ rowid +'_spec_'+ iowrowid).val(l.Specification);
                } else if(WorkType == 'iow') {
                    $('.worktype-activity').remove();
                }
                $.each(arr_resource_iow_requests, function(k, r) {
                    if(l.DecisionId != r.DecisionId || l.ResourceId != r.ResourceId || l.ItemId != r.ItemId) {
                        return;
                    }

                        $('#iow_' + rowid + '_qty_' + iowrowid).addClass('border-none').prop('readonly', true);
                        $('.iow_' + rowid + '_requestfields').show();
                        var requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                        $('#iow_' + rowid + '_request_' + iowrowid + '_reqno').find('> tbody.main').append(requesttemplate
                            .replace(/__9/g, '_' + requestrowid)
                            .replace(/_0/g, '_' + iowrowid)
                            .replace(/__/g, '_' + rowid));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);

                        $('#iow_' + rowid + '_request_' + iowrowid + '_wbsname_' + requestrowid).val(r.WBSName);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val(r.WBSId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_resourceid_' + requestrowid).val(r.ResourceId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_itemid_' + requestrowid).val(r.ItemId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber((r.BalQty)));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val(sanitizeNumber(r.Qty));
                });
            });
        });
    }
    rowid += 1;
    //$tbody.append(template.replace(/__/g, '_' + rowid));
    $rowid.val(rowid);
    //bindDescAutocomplete();
    //terms & condition start
    // other terms
    var $termrowid = $('#termrowid');
    var template = $('#otherterms-template').html();
    var termrowid = 0;
    var $tbody = $('#otherTermsTable').find('> tbody');
    if(arr_otherTerms.length != 0) {
        $.each(arr_otherTerms, function(i, o) {
            termrowid += 1;
            $tbody.append(template.replace(/__/g, '_' + termrowid));

            $('#termTitle_' + termrowid).val(o.Title);
            $('#termDesc_' + termrowid).val(o.Desc);
            $('#deleteTermTr_' + termrowid).show();
        });
    }
    termrowid += 1;
    $tbody.append(template.replace(/__/g, '_' + termrowid));
    $termrowid.val(termrowid);

    // material
    var $materialrowid = $('#materialrowid');
    var template = $('#material-template').html();
    var materialrowid = 0;
    var $tbody = $('#materialTable').find('> tbody');
    if(arr_materials.length != 0) {
        $.each(arr_materials, function(i, o) {
            materialrowid += 1;
            $tbody.append(template.replace(/__/g, '_' + materialrowid));

//                $('#materialName_' + materialrowid).val(o.Title);
//                $('#materialId_' + materialrowid).val(o.Desc);
//                $('#materialUnit_' + materialrowid).val(o.Desc);
//                $('#materialRate_' + materialrowid).val(o.Desc);
//                $('#escalationper_' + materialrowid).val(o.Desc);
//                $('#materialbase_' + materialrowid).val(o.Desc);
//                $('#materialnewRate_' + materialrowid).val(o.Desc);
            $('#materialDeleteTr_' + materialrowid).show();
        });
    }
    materialrowid += 1;
    $tbody.append(template.replace(/__/g, '_' + materialrowid));
    $materialrowid.val(materialrowid);
    bindMaterialBaseAutoComplete();

    // exc material
    var $materialExcrowid = $('#materialExcrowid');
    var template = $('#materialexc-template').html();
    var materialExcrowid = 0;
    var $tbody = $('#materialExcTable').find('> tbody');
    if(arr_exc_materials.length != 0) {
        $.each(arr_exc_materials, function(i, o) {
            materialExcrowid += 1;
            $tbody.append(template.replace(/__/g, '_' + materialExcrowid));

//                $('#materialExcName_' + materialExcrowid).val(o.Title);
//                $('#materialExcId_' + materialExcrowid).val(o.Desc);
//                $('#materialExcUnit_' + materialExcrowid).val(o.Desc);
//                $('#materialExcRate_' + materialExcrowid).val(o.Desc);
//                $('#materialExcType_' + materialExcrowid).val(o.Desc);
            $('#materialExcDeleteTr_' + materialExcrowid).show();
        });
    }
    materialExcrowid += 1;
    $tbody.append(template.replace(/__/g, '_' + materialExcrowid));
    $materialExcrowid.val(materialExcrowid);
    bindMaterialExcAutoComplete();

    // adv material
    var $materialAdvrowid = $('#materialAdvrowid');
    var template = $('#materialadv-template').html();
    var materialAdvrowid = 0;
    var $tbody = $('#materialAdvTable').find('> tbody');
    if(arr_adv_materials.length != 0) {
        $.each(arr_adv_materials, function(i, o) {
            materialAdvrowid += 1;
            $tbody.append(template.replace(/__/g, '_' + materialAdvrowid));

//                $('#materialExcName_' + materialAdvrowid).val(o.Title);
//                $('#materialExcId_' + materialAdvrowid).val(o.Desc);
//                $('#materialExcUnit_' + materialAdvrowid).val(o.Desc);
//                $('#materialExcRate_' + materialAdvrowid).val(o.Desc);
//                $('#materialExcType_' + materialAdvrowid).val(o.Desc);
            $('#materialAdvDeleteTr_' + materialAdvrowid).show();
        });
    }
    materialAdvrowid += 1;
    $tbody.append(template.replace(/__/g, '_' + materialAdvrowid));
    $materialAdvrowid.val(materialAdvrowid);
    bindMaterialAdvAutoComplete();

    // tech title
    var $techrowid = $('#techrowid');
    var template = $('#techtitle-template').html();
    var techrowid = 0;
    var $tbody = $('#techTitleTable').find('> tbody');
    if(arr_adv_materials.length != 0) {
        $.each(arr_adv_materials, function(i, o) {
            techrowid += 1;
            $tbody.append(template.replace(/__/g, '_' + techrowid));

//                $('#materialExcName_' + techrowid).val(o.Title);
//                $('#materialExcId_' + techrowid).val(o.Desc);
//                $('#materialExcUnit_' + techrowid).val(o.Desc);
//                $('#materialExcRate_' + techrowid).val(o.Desc);
//                $('#materialExcType_' + techrowid).val(o.Desc);
            $('#deleteTechTr_' + techrowid).show();
        });
    }
    techrowid += 1;
    $tbody.append(template.replace(/__/g, '_' + techrowid));
    $techrowid.val(techrowid);

    //terms &condition end

    $('.content_wrapper').on('click','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });

    nextAccordian(1);
});

function submitForm() {
   /* if(!validateLength($('#PODate')))
        return false;

    if(!validateLength($('#RefDate')))
        return false;


    if(!validateLength($('#CCWONo')))
        return false;

    if(!validateLength($('#CompWONo')))
        return false;

    if(!validateLength($('#RefNo')))
        return false;

    if($('#formWrapper .error').length != 0) {
        alert('Kindly notice the errors!');
        return false;
    }*/
    $('#formWrapper').submit();
}

function validateLength($input) {
    if($.trim($input.val()).length == 0) {
        showError($input, 'required');
        return false;
    }

    removeError($input);
    return true;
}

function bindDescAutocomplete() {
    // bind resource autocomplete
    $('#workorderTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_resources,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {
            if (suggestion) {
                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                $this.prop('readonly', true).addClass('border-none');
                $('#descid_' + rowid).val(suggestion.data);
                $('#unitname_' + rowid).val(suggestion.UnitName);
                $('#rate_' + rowid).val(sanitizeNumber(suggestion.Rate,2));

                $('#expandTr_' + rowid).show();
                bindResourceIOW($this);
                addNewResourceRow($this);
            }
        }, onSearchStart: function (suggestion) {
            var rowid = $(this)[0].id.split('_')[1];
            $('#unitname_' + rowid).val('');
            $('#rate_' + rowid).val('');
        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                var rowid = $(this)[0].id.split('_')[1];
                $('#unitname_' + rowid).val('');
                $('#rate_' + rowid).val('');
            }
        }
    });
}

function bindResourceIOW(x) {
    var rowid = $(x)[0].id.split('_')[1];
    var $iowrowid = $('#iow_' + rowid + '_rowid');
    var descId = $('#descid_' + rowid).val();
    var data = {};

    if(OrderType == 'work' && WorkType == 'activity') {
        data.Type = 'getresourcedetails';
        data.ResourceId = descId;
    } else if (OrderType == 'work' && WorkType == 'iow') {
        data.Type = 'getiowdetails';
        data.IOWId = descId;
    }

    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/purchase/order-entry',
        type: "post",
        data: data,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);
                var iowtemplate = $('#iow-template').html();
                $.each(data, function (i,l) {
                    var iowrowid = parseInt($iowrowid.val()) + 1;
                    $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $iowrowid.val(iowrowid);

                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
                });
            }
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }
    });
}

function addNewResourceRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val()),
        $tbody = $('#workorderTable').find('> tbody.main');

    $('#deleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#resource-template').html();

    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);

    $rowid.val(count);
    bindDescAutocomplete();
}

function deleteRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    $tr.next('.subTr').remove();
    $tr.remove();

    bindDescAutocomplete();
    return false;
}

function checkResourceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=descid_]');
    tmp_arr_resources = arr_resources;
    tmp_arr_resources = $.grep(arr_resources, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindDescAutocomplete();
}

function nextAccordian(id) {
    $('#panelheading-' + id).trigger('click');
}

function calcQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];

    // calc total qty
    var totalQty=0;
    $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
        var qty = parseInt($(this).val());
        if(isNaN(qty))
            qty = 0;

        totalQty += qty;
    });

    $('#qty_'+rowid).val(sanitizeNumber(totalQty,0));

    // calc total amount
    var rate = parseFloatVal($('#rate_'+rowid).val());
    $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate));
    calcTotal();
}

function calcRequestQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    // calc total qty
    var totalQty=0;
    $.each($('input[id^=iow_'+rowid+'_request_'+iowrowid+'_qty_'), function (i,o) {
        var qty = parseInt($(this).val());
        if(isNaN(qty))
            qty = 0;

        totalQty += qty;
    });

    if(totalQty > $('#iow_'+rowid+'_request_'+iowrowid+'_estimateqty').val()) {
        showError($x, 'Qty should not exceed estimate qty!');
        return;
    } else {
        removeError($x);
    }

//        $('#iow_'+rowid+'_request_'+iowrowid+'_totbilledqty').val(sanitizeNumber(totalQty,0));
    $('#iow_'+rowid+'_qty_'+iowrowid).val(sanitizeNumber(totalQty,0)).trigger('change');
}

function calcTotal() {
    var total = 0;
    $.each($('input[id^=amount_]'), function (i,o) {
        total += parseFloatVal($(this).val());
    });
    $('#total').val(sanitizeNumber(total));
}

function addNewTermRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#termrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteTermTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#otherterms-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
}

function deleteTerm(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    $tr.remove();
    return false;
}

function addNewTechRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#techrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteTechTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#techtitle-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
}

function deleteTech(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    $tr.remove();
    return false;
}

function addNewMaterialRow(x) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if ($tr.next('tr').length != 0)
        return;

    if ($('#materialName_' + key).val().length == 0 || $('#materialRate_' + key).val().length == 0)
        return;

    var $rowid = $('#materialrowid'),
        rowid = parseInt($rowid.val());
    $('.materialDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#material-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialBaseAutoComplete();
}

function deleteMaterial(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialId_' + key).val();

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr'),
        $tbody = $tr.parent('tbody');

    $tr.remove();
    materialPrice = materiallists;

    bindMaterialBaseAutoComplete();
    return false;
}

function addNewMaterialExcRow(x) {
    var $tr = $(x).closest('tr');

    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#materialExcrowid'),
        rowid = parseInt($rowid.val());
    $('.materialExcDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#materialexc-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialExcAutoComplete();
}

function deleteMaterialExc(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialExcId_' + key).val(),
        type = $('#materialExcType_' + key).val();

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    $tr.remove();
    bindMaterialExcAutoComplete();
    return false;
}

function addNewMaterialAdvRow(x) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if ($tr.next('tr').length != 0)
        return;

    if ($('#materialAdvName_' + key).val().length == 0 || $('#materialAdvRate_' + key).val().length == 0)
        return;

    var $rowid = $('#materialAdvrowid'),
        rowid = parseInt($rowid.val());
    $('.materialAdvDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#materialadv-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialAdvAutoComplete();
}

function deleteMaterialAdv(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialAdvId_' + key).val();

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr'),
        $tbody = $tr.parent('tbody');


    $tr.remove();
    bindMaterialAdvAutoComplete();
    return false;
}

function bindMaterialBaseAutoComplete() {
    var $matertialName = $('input[id^=materialName_]');
    $matertialName.unbind('autocomplete');
    var addedMaterials = [];
    $.each($matertialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];

        $this.autocomplete({
            lookup: materialPrice,
//                showNoSuggestionNotice:true,
//                noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matpricenew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialId_" + key1);
                    $el.val(suggestion.data);
                    $('#materialUnit_' + key1).val(suggestion.unit);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialId_" + key1).val(0);
                } else
                    removeError($(this));
            }
        });
    });
}

function bindMaterialExcAutoComplete() {
    var $materialName = $('input[id^=materialExcName_]');
    $materialName.unbind('autocomplete');

    $.each($materialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];

        $this.autocomplete({
            lookup: materialSupply,
//                showNoSuggestionNotice:true,
//                noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matsupplynew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialExcId_" + key1);
                    $el.val(suggestion.data);
                    $('#materialExcUnit_' + key1).val(suggestion.unit);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialExcId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialExcId_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function bindMaterialAdvAutoComplete() {
    var $matertialName = $('input[id^=materialAdvName_]');
    $matertialName.unbind('autocomplete');
    $.each($matertialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];

        $this.autocomplete({
            lookup: materialaAdv,
//                showNoSuggestionNotice:true,
//                noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matadvnew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialAdvId_" + key1);
                    $el.val(suggestion.data);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialAdvId_" + key1).val(0);
                } else
                    removeError($(this));
            }
        });
    });
}

function checkMaterialPriceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=materialId_]');
    materialPrice = materiallists;

    materialPrice = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];

            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindMaterialBaseAutoComplete();
}

function checkMaterialSupplyUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=materialExcId_]');
    materialSupply = materiallists;

    materialSupply = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindMaterialExcAutoComplete();
}

function checkMaterialAdvUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=materialAdvId_]');
    materialaAdv = materiallists;
    materialaAdv = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
    bindMaterialAdvAutoComplete();
}
//multiple_dropdown//
	$(document).ready(function() {
   		$(".multiple_dropdown").select2({
   		});
   	});
	//
	function popup(xy){
		var id=($(xy).attr ('id')).split('_');
		console.log(id);
		}
</script>
