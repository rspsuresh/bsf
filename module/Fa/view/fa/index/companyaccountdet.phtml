<style type="text/css">
    tr[data-role="row-details"] {
        display: none;
    }
    /*--------------Jqx Grid jqx All-------------------*/
    #treeGrid									{min-height:200px !important;}
    .jqx-widget .jqx-grid-columngroup-header	{border-top:0px !important;}
    .jqx-widget .jqx-grid-columngroup-header > div	{ margin-top:7px !important;}
    .jqx-dropdownlist-state-normal  			{margin:2px 4px !important;}
    .jqx-grid-pager .jqx-dropdownlist-state-normal  			{margin-top: 0 !important;}
    .jqx-widget-header							{border-bottom: 1px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;}
    .jqx-grid-pager-input						{margin-top: 2px !important; padding: 2px;text-align: center !important; width: 35px;}
    .jqx-dropdownlist-state-normal				{display: block;  float: right;height: 16px;margin-right: 7px;margin-top: 0;  padding-bottom: 2px;padding-top: 2px; width: 40px;}
    .jqx-button									{cursor: pointer;float: right;margin-right: 3px !important;margin-top: 0 !important;padding: 0 !important;width: 20px !important;}
    .jqx-button > .jqx-icon-arrow-left,
    .jqx-button >.jqx-icon-arrow-right			{height: 21px !important;margin-left: 0 !important;width: 20px !important;}
    .jqx-listitem-element						{height: 25px !important;}
    .proname_btn .select2-container{ background-color:#efefef;color:#244996;}
    .proname_btn .select2-container .select2-selection--single .select2-selection__rendered{padding-top:0px; padding-bottom:5px;}
    .proname_btn .select2-container--default .select2-selection--single{font-size:26px; line-height:28px;}

    /* Excel Floating Icon */
    .fixed-action-btn          	    {position:fixed;top:85px;right:5px;padding-top:15px;margin-bottom:0;z-index:998;}
    .fixed-action-btn:hover ul li a.btn-floating{transform: scaleY(1) scaleX(1) translateX(0px);opacity: 1;}
    .btn-floating.btn-large         {width:45px;height:45px;}
    .fixed-action-btn ul 			{left:-142px;right:0;text-align:center;position:absolute;margin:0;top:22px;}
    .fixed-action-btn ul li 		{margin-left:8px;list-style-type:none;float:left;}
    .fixed-action-btn ul li a.btn-floating {transform: scaleY(0.4) scaleX(0.4) translateX(40px);opacity: 0;}
    .fixed-action-btn ul a.btn-floating i  {font-size: 17px;line-height: 37px;}
    .btn-floating                   {display:inline-block;color:#fff;position:relative;overflow:hidden;z-index:1;width:37px;height:37px;line-height:37px;padding: 0;
        background-color: #26a69a;border-radius:50%;cursor:pointer;vertical-align: middle;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);text-decoration: none;transition: all .3s ease;
        -webkit-transition: all .3s ease; -moz-transition: all .3s ease; -o-transition: all .3s ease;}
    .btn-floating i                 {width: inherit;display: inline-block;text-align: center;color: #fff;font-size:20px;line-height: 45px; font-weight:normal; color:#fff;}
    .next-bt                        {text-align:center;}
    .next-bt a:hover                {border:1px solid #3580C4 !important; background:#fff !important; color:#3580C4 !important;}
    .next-bt a                      {background:#3580C4!important;border:1px solid #3580C4; border-radius: 4px;
									color:#fff!important; font-size:14px; padding: 5px 10px; text-align: center; transition: all 0.4s ease 0s;}
	.commargin_bottom				{margin-bottom:20px !important;}
	.req_addbtn a {padding: 6px 8px 9px 9px !important;}

    /* Excel Floating Icon end*/
</style>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqx-all.js"></script>
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1 class="col-lg-6 padlr0">
                Companywise Account<!--<div class="stgedit_btn req_addbtn brad_50">
                    <a href="<?php echo $this->basePath(); ?>/fa/index/accountentry" class="ripple" data-toggle="tooltip" data-placement="right" title="Add&nbsp;New&nbsp;Account"><i class="fa fa-plus"></i></a>
                </div>-->
            </h1>
            <input type="hidden" id="g_lCNYearId" name="g_lCNYearId" value="<?php echo $g_lCNYearId; ?>"/>
            <div class="form-group col-lg-12 clear padtop20 commargin_ttop_20 commargin_bottom">
                <div class=" col-lg-4">
                    <select name="fiscalId" id="fiscalId" class="single_dropdown lbl_move" style="width:100%;" disabled label="Select FiscalYear..." >
                        <option value="0">Select FiscalYear</option>
                        <?php foreach($accFiscalList as $FiscalList){ ?>
                            <option value="<?php echo $FiscalList['FYearId'] ?>" <?php if($FiscalList['FYearId']==$fYearId ) { echo 'selected';} ?> ><?php echo $FiscalList['FName'] ?></option>
                        <?php } ?>
                    </select>
                </div>
                <div class="col-lg-4">
                    <select name="compId" id="compId" class="single_dropdown lbl_move" disabled style="width:100%;" label="Select Company..." >
                        <option value="0" >Select Company</option>
                        <?php foreach($accCompMasterList as $compMasterList){ ?>
                            <option value="<?php echo $compMasterList['CompanyId'] ?>" <?php if($compMasterList['CompanyId']==$companyId ) { echo 'selected';} ?> ><?php echo $compMasterList['CompanyName'] ?></option>
                        <?php } ?>
                    </select>
                </div>
				<div class="col-lg-1">
					<div class="stgedit_btn req_addbtn brad_50">
						<a href="javascript:void(0)" onclick="showTags()"  class="ripple" data-toggle="tooltip" data-placement="top" title="Select Account"><i class="fa fa-plus"></i></a>
					</div>
				</div>
				<div class="col-lg-2">
					<a class="btn btn-default" id="jqxbutton">Expand<i class="fa fa-sitemap" style="margin-left:5px;color:#337ab7;"></i></a>
					<a class="btn btn-default"  id="jqxbuttorenn">Collapse<i class="fa fa-sitemap" style="margin-left:5px;color:#337ab7;"></i></a>
				</div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6">
            <div class="fixed-action-btn active">
                <a class="btn-floating btn-large">
                    <i class="fa fa-print"></i>
                </a>
                <ul>
                    <li>
                        <a class="btn-floating hide-input-file" id="print" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Print Report">
                            <i class="fa fa-print"></i>

                        </a>
                    </li>
                    <li>
                        <a class="btn-floating" id="excelExport" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Download Excel">
                            <i class="fa fa-download"></i>
                        </a>
                    </li>
                    <li>
                        <a class="btn-floating" id="csvExport" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Export CSV">
                            <i class="fa fa-file-archive-o"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12 clear">
            <div class="table-responsive clear">
                <div id="treeGrid">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalTree" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal_vendorwidth" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h1 class="modal-title" id="myModalLabel">Select Account</h1>
            </div>
            <div class="modal-body">
                <div class="content_wrapper padlr0">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="modalTreeGrid">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--table header script end-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="color:#06C;">Close</button>
                <button type="button" class="btn btn-primary" id="btnSave" onclick="saveTags()">Save changes</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var arr_Lists = <?php echo (isset($accDirectoryList)) ? json_encode($accDirectoryList) : "[]";?>;
    var accCheckedList = <?php echo (isset($accCheckedList)) ? json_encode($accCheckedList) : "[]";?>;
    var fYearId = <?php echo (isset($fYearId)) ? json_encode($fYearId) : "0";?>;
    var companyId = <?php echo (isset($companyId)) ? json_encode($companyId) : "0";?>;

    $treeGrid =$("#treeGrid");
    $('#jqxbuttorenn').hide();
    // prepare the data
    $(document).ready(function () {
        $(".single_dropdown").select2({
            placeholder: "",
            allowClear: true
        });
    });

    $('#compId').on('change', function(){
        var compyId = $(this).val();//fiscalId
        var fyearId = $('#fiscalId').val();
        if(compyId !=  '') {
            window.location.replace(getBaseURL() + "fa/index/companyaccountdet/" + fyearId + "/" + compyId);
        } else{
            window.location.replace(getBaseURL() + "fa/index/companyaccountdet/" + fyearId + "/0");
        }
    });
    $('#fiscalId').on('change', function(){
        var fyearId = $(this).val();//fiscalId
        var compyId = $('#compId').val();
        if(fyearId !=  '') {
            window.location.replace(getBaseURL() + "fa/index/companyaccountdet/" + fyearId + "/" + compyId);
        } else{
            window.location.replace(getBaseURL() + "fa/index/companyaccountdet/0/0");
        }
    });

    if(arr_Lists == "[]"){
        $treeGrid.jqxTreeGrid('clear');
    } else {
        var source =
        {
            dataType: "json",  //"json",
            dataFields: [
                { name: "AccountId", type: "number" },
                { name: "AccountName", type: "string" },
                { name: "ParentAccountId", type: "number" },
                //{ name: "TypeName", type: "string" },
                { name: "LastLevel", type: "string" },
                //{ name: "AccountType", type: "string" },
                { name: "Debit", type: "number" },
                { name: "Credit", type: "number" },
                { name: "FromCC", type: "number" },
                { name: "FromSL", type: "number" },
                { name: "TypeId", type: "number" }
                //{ name: "expanded", type: "bool" }
            ],
            hierarchy:
            {
                keyDataField: { name: 'AccountId' },
                parentDataField: { name: 'ParentAccountId' }
            },
            id: 'AccountId',
            localData: arr_Lists
        };
        var dataAdapter = new $.jqx.dataAdapter(source, {
            loadComplete: function () {
                // data is loaded.
            }
        });

        $treeGrid.jqxTreeGrid({
            width: "100%",
            source: dataAdapter,
            pageable: true,
            pagerMode: 'advanced',
            pagerHeight: 40,
            filterable: true,
            filterMode: 'simple',//advanced
            editable: false,
            showAggregates: true,
            aggregatesHeight: 35,
            altRows: true,
            ready: function()
            {
                $("#treeGrid").jqxTreeGrid('hideColumn', 'AccountId');
                $("#treeGrid").jqxTreeGrid('hideColumn', 'ParentAccountId');
            },
            columns: [
                { text: 'Account', dataField: "AccountName", align: 'left', cellsAlign: 'left' , width: '40%' },
                { text: 'AccountId', dataField: "AccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
                { text: 'ParentAccountId', dataField: "ParentAccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false },
                //{ text: 'Type Name', dataField: "TypeName", align: 'left', cellsAlign: 'left' , width: '30%' },
                { text: 'LastLevel', dataField: "LastLevel", align: 'right', cellsAlign: 'right', hidden:true, filterable: false},
                { text: 'Debit', dataField: "Debit", align: 'right', cellsAlign: 'right' , cellsFormat: 'd2', width: '30%'},
                { text: 'Credit', dataField: "Credit", align: 'right', cellsAlign: 'right' , cellsFormat: 'd2', width: '30%'},
                { text: 'FromCC', dataField: "FromCC", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
                { text: 'FromSL', dataField: "FromSL", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
                { text: 'TypeId', dataField: "TypeId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
                //{ text: 'AccountType', dataField: "AccountType", align: 'left', cellsAlign: 'left' , width: '30%' }
            ]
        });

        $treeGrid.on('rowDoubleClick', function (event) {
            var args = event.args;
            var row = args.row;
            var fromSL=row.FromSL;
            var lastLevel=row.LastLevel;
            if(fromSL==0 && lastLevel=="Y") {
                var id = row.AccountId;
                var g_lCNYearId = $('#g_lCNYearId').val();
                window.location.replace(getBaseURL() + "fa/index/ccbalance/" + id +"/" + g_lCNYearId);
            } else if(fromSL==1 && lastLevel=="Y") {
                var id = row.AccountId;
                //var g_lCNYearId = $('#g_lCNYearId').val();
                window.location.replace(getBaseURL() + "fa/index/slbalance/" + id);
            }
         });

        //Print option
        $("#excelExport").click(function () {
            $("#treeGrid").jqxTreeGrid('exportData', 'xls');
        });
        $("#csvExport").click(function () {
            $("#treeGrid").jqxTreeGrid('exportData', 'csv');
        });
        $("#htmlExport").click(function () {
            $("#treeGrid").jqxTreeGrid('exportData', 'html');
        });

        $("#print").click(function () {
            $("#treeGrid").jqxTreeGrid('exportData', 'html');
        });

        $('#jqxbutton').click(function () {
            $("#treeGrid").jqxTreeGrid('expandAll');
            $('#jqxbutton').hide();
            $('#jqxbuttorenn').show();
        });

        $('#jqxbuttorenn').click(function () {
            $("#treeGrid").jqxTreeGrid('render');
            $('#jqxbutton').show();
            $('#jqxbuttorenn').hide();
        });
    }

    /*Modal Tree Grid Start*/
    $modalTreeGrid=$('#modalTreeGrid');
    if(accCheckedList == "[]"){
        $modalTreeGrid.jqxTreeGrid('clear');
    } else {
        var source =
        {
            dataType: "json",
            dataFields: [
                { name: "AccountId", type: "number" },
                { name: "AccountName", type: "string" },
                { name: "ParentAccountId", type: "number" },
               // { name: "TypeName", type: "string" },
                { name: "LastLevel", type: "string" }
                //{ name: "AccountType", type: "string" },
                //{ name: "expanded", type: "bool" }
            ],
            hierarchy:
            {
                keyDataField: { name: 'AccountId' },
                parentDataField: { name: 'ParentAccountId' }
            },
            id: 'AccountId',
            localData: accCheckedList
        };
        var dataAdapter = new $.jqx.dataAdapter(source, {
            loadComplete: function () {
                // data is loaded.
            }
        });

        $modalTreeGrid.jqxTreeGrid({
            width: "100%",
//            checkboxes: true,
//            hierarchicalCheckboxes: true, //for selecting sub and parent row
            checkboxes: function (rowKey, dataRow) {
                var level = dataRow.LastLevel;
                if (level == 'Y') {
                    return true;
                }
                return false;
            },
            source: dataAdapter,
            pageable: true,
            pagerMode: 'advanced',
            pagerHeight: 40,
            filterable: true,
            filterMode: 'simple',//advanced
            editable: false,
            showAggregates: true,
            aggregatesHeight: 35,
            altRows: true,
            ready: function()
            {
                $("#modalTreeGrid").jqxTreeGrid('hideColumn', 'AccountId');
                $("#modalTreeGrid").jqxTreeGrid('hideColumn', 'ParentAccountId');
            },
            columns: [
                { text: 'Account', dataField: "AccountName", align: 'left', cellsAlign: 'left' , width: '100%' },
                { text: 'AccountId', dataField: "AccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
                { text: 'ParentAccountId', dataField: "ParentAccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false },
                /*{ text: 'Type Name', dataField: "TypeName", align: 'left', cellsAlign: 'left' , width: '30%' },*/
                { text: 'LastLevel', dataField: "LastLevel", align: 'right', cellsAlign: 'right', hidden:true, filterable: false},
                /*{ text: 'AccountType', dataField: "AccountType", align: 'left', cellsAlign: 'left' , width: '30%' }*/
            ]
        });
    }
    /*Modal Tree Grid end*/

    function showTags(){
        if(fYearId == 0 || companyId == 0){
            alert('Please select Fiscal year and Company');
            return false;
        }
        $('#modalTree').modal('show');
    }

    function saveTags(){
        var checkboxes = $('#modalTreeGrid').jqxTreeGrid('getCheckedRows');
        var accIds=[];
        $.each(checkboxes,function(i,o){
            accIds.push(o.AccountId);
        });
//        accIds=accIds.toString();
        $.ajax({
            url: getBaseURL() + 'fa/index/companyaccountdet',
            data: {'accIds':accIds,'companyListId':companyId,'fYearListId':fYearId},
            type: 'POST',
            success: function (data, status, xhr) {
                var data = JSON.parse(data);
                if(data == 'Success'){
                    $('#modalTree').modal('hide');
                    $("#modalTreeGrid").jqxTreeGrid('refresh');
                    window.location.reload();
                }
            },
            error: function (xhr, status, error) {
            }
        });
    }
</script>