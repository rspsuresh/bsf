<style type="text/css">
	
	.feed_bg {border: 1px solid #ddd;background: #fff;margin-bottom: 20px;box-shadow: 0 0 1px rgba(0, 0, 0, 0, 0.12);padding-bottom: 10px;float: left;}
	.blu_bg{background:#c2ecfd;border:1px solid #3f8ba9;padding:3px;color:#000;text-align:center;}
	.collpse-btn {width: 100%;margin: 10px 8px;}
	.collpse-btn li {float: left;background: #A2E0F5;padding: 4px 30px;margin-right: 10px;box-shadow: 0 0 0 1px #ffffff, 0 0 0 2px #6CBED9;font-size: 14px;margin-bottom: 18px;cursor: pointer;}
	.collpse-btn li:hover {background: #BED96C;box-shadow: 0 0 0 1px #ffffff, 0 0 0 2px #BED96C;}
   tr[data-role="row-details"] {
        display: none;
    }
    /*--------------Jqx Grid jqx All-------------------*/
    #treeGrid									{min-height:200px !important;}
    .jqx-widget .jqx-grid-columngroup-header	{border-top:0px !important;}
    .jqx-widget .jqx-grid-columngroup-header > div	{ margin-top:7px !important;}
    .jqx-dropdownlist-state-normal  			{margin:2px 4px !important;}
    .jqx-grid-pager .jqx-dropdownlist-state-normal  			{margin-top: 0 !important;}
    .jqx-widget-header							{border-bottom: 1px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;}
    .jqx-grid-pager-input						{margin-top: 2px !important; padding: 2px;text-align: center !important; width: 35px;}
    .jqx-dropdownlist-state-normal				{display: block;  float: right;height: 16px;margin-right: 7px;margin-top: 0;  padding-bottom: 2px;padding-top: 2px; width: 40px;}
    .jqx-button									{cursor: pointer;float: right;margin-right: 3px !important;margin-top: 0 !important;padding: 0 !important;width: 20px !important;}
    .jqx-button > .jqx-icon-arrow-left,
    .jqx-button >.jqx-icon-arrow-right			{height: 21px !important;margin-left: 0 !important;width: 20px !important;}
    .jqx-listitem-element						{height: 25px !important;}
    .proname_btn .select2-container{ background-color:#efefef;color:#244996;}
    .proname_btn .select2-container .select2-selection--single .select2-selection__rendered{padding-top:0px; padding-bottom:5px;}
    .proname_btn .select2-container--default .select2-selection--single{font-size:26px; line-height:28px;}

    /* Excel Floating Icon */
    .fixed-action-btn          	    {position:fixed;top:85px;right:5px;padding-top:15px;margin-bottom:0;z-index:998;}
    .fixed-action-btn:hover ul li a.btn-floating{transform: scaleY(1) scaleX(1) translateX(0px);opacity: 1;}
    .btn-floating.btn-large         {width:45px;height:45px;}
    .fixed-action-btn ul 			{left:-142px;right:0;text-align:center;position:absolute;margin:0;top:22px;}
    .fixed-action-btn ul li 		{margin-left:8px;list-style-type:none;float:left;}
    .fixed-action-btn ul li a.btn-floating {transform: scaleY(0.4) scaleX(0.4) translateX(40px);opacity: 0;}
    .fixed-action-btn ul a.btn-floating i  {font-size: 17px;line-height: 37px;}
    .btn-floating                   {display:inline-block;color:#fff;position:relative;overflow:hidden;z-index:1;width:37px;height:37px;line-height:37px;padding: 0;
        background-color: #26a69a;border-radius:50%;cursor:pointer;vertical-align: middle;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12);text-decoration: none;transition: all .3s ease;
        -webkit-transition: all .3s ease; -moz-transition: all .3s ease; -o-transition: all .3s ease;}
    .btn-floating i                 {width: inherit;display: inline-block;text-align: center;color: #fff;font-size:20px;line-height: 45px; font-weight:normal; color:#fff;}
    .next-bt                        {text-align:center;}
    .next-bt a:hover                {border:1px solid #3580C4 !important; background:#fff !important; color:#3580C4 !important;}
    .next-bt a                      {background:#3580C4!important;border:1px solid #3580C4; border-radius: 4px;
        color:#fff!important; font-size:14px; padding: 5px 10px; text-align: center; transition: all 0.4s ease 0s;}
    .commargin_bottom				{margin-bottom:20px !important;}
    .req_addbtn a {padding: 6px 8px 9px 9px !important;}
	.top-30{margin-top:30px;}

    /* Excel Floating Icon end*/
</style>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqx-all.js"></script>
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12">
            <h1 class="col-lg-6 padlr0">
                Trial Balance<?php echo (isset($companyName)) ? ' - '.$companyName : '';?>
            </h1>
            <input type="hidden" id="g_lCNYearId" name="g_lCNYearId" value="<?php echo $g_lCNYearId; ?>"/>
            <div class="form-group col-lg-12 clear padtop20 commargin_ttop_20 commargin_bottom">
                <div class=" col-lg-4">
                    <span class="date_icon"><i class="fa fa-calendar"></i></span>
                    <input type="text" name="fromDate" id="fromDate" class="form-control lbl_move datepickerinput" onchange="loadTransfers()" label="From Date" value="<?php echo (isset($fromDate)) ? $fromDate : $prevMonth;?>" />
                </div>
                <div class="col-lg-4">
                    <span class="date_icon"><i class="fa fa-calendar"></i></span>
                    <input type="text" name="toDate" id="toDate" class="form-control lbl_move datepickerinput" onchange="loadTransfers()" label="To Date" value="<?php echo (isset($toDate)) ? $toDate: $curDate;?>" />
                </div>
                <div class="col-lg-2">
                    <a class="btn btn-default" id="jqxbutton">Expand<i class="fa fa-sitemap" style="margin-left:5px;color:#337ab7;"></i></a>
                    <a class="btn btn-default"  id="jqxbuttorenn">Collapse<i class="fa fa-sitemap" style="margin-left:5px;color:#337ab7;"></i></a>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6">
            <div class="fixed-action-btn active">
                <a class="btn-floating btn-large">
                    <i class="fa fa-print"></i>
                </a>
                <ul>
                    <li>
                        <a class="btn-floating hide-input-file" id="print" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Print Report">
                            <i class="fa fa-print"></i>
                        </a>
                    </li>
                    <li>
                        <a class="btn-floating" id="excelExport" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Download Excel">
                            <i class="fa fa-download"></i>
                        </a>
                    </li>
                    <li>
                        <a class="btn-floating" id="csvExport" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" data-original-title="Export CSV">
                            <i class="fa fa-file-archive-o"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12 clear">
            <div class="table-responsive clear">
                <div id="treeGrid">
                </div>
            </div>
        </div>
		<div class="col-lg-12 top-30 form-group" >
			<div class="col-lg-9 feed_bg">
                <ul class="collpse-btn" id="accText"></ul>
			</div>
			<div class="col-lg-3 blu_bg">
				<input type="hidden" id="accNames" name="accNames" />
				<input type="hidden" id="accIds" name="accIds" />
				<a class="btn" style="color:#000;" onclick="sendSelectedAccount()" id="selectedAcc">View Report for Selected Accounts<i class="fa fa-long-arrow-right" style="font-size:18px; margin-left:8px;color:#000;"></i></a>
			</div>
		</div>
    </div>
</div>
<script type="text/javascript">
var arr_Lists = <?php echo (isset($accDirectoryList)) ? json_encode($accDirectoryList) : "[]";?>;
var accCheckedList = <?php echo (isset($accCheckedList)) ? json_encode($accCheckedList) : "[]";?>;
var fYearId = <?php echo (isset($fYearId)) ? json_encode($fYearId) : "0";?>;
var companyId = <?php echo (isset($companyId)) ? json_encode($companyId) : "0";?>;

var startDate="<?php echo (isset($fiscalfromDate)) ? $fiscalfromDate : '';?>";
var endDate="<?php echo (isset($fiscaltoDate)) ? $fiscaltoDate : '';?>";
var start_date =startDate.split('-');
var end_date =endDate.split('-');

$('.datepickerinput').datepicker({
    'format': 'dd-mm-yyyy',
    startDate: new Date(start_date[2],start_date[1]-1,start_date[0]),
    endDate: new Date(end_date[2],end_date[1]-1,end_date[0])
}).on('changeDate', function() {
    $('.datepicker').hide();
}).data('datepicker');

$treeGrid =$("#treeGrid");
$('#jqxbuttorenn').hide();

$(document).ready(function () {
    $(".single_dropdown").select2({
        placeholder: "",
        allowClear: true
    });
});

function loadTransfers(){
    window.location = getBaseURL() + 'fa/report/trialbalancerpt/'+$('#fromDate').val()+'/'+$('#toDate').val();
}

if(arr_Lists == "[]"){
    $treeGrid.jqxTreeGrid('clear');
} else {
    var source =
    {
        dataType: "json",  //"json",
        dataFields: [
            { name: "AccountId", type: "number" },
            { name: "AccountName", type: "string" },
            { name: "ParentAccountId", type: "number" },
            //{ name: "TypeName", type: "string" },
            { name: "LastLevel", type: "string" },
            //{ name: "AccountType", type: "string" },
            { name: "Debit", type: "number" },
            { name: "Credit", type: "number" },
            // { name: "FromCC", type: "number" },
            // { name: "FromSL", type: "number" },
            { name: "TypeId", type: "number" }
            //{ name: "expanded", type: "bool" }
        ],
        hierarchy:
        {
            keyDataField: { name: 'AccountId' },
            parentDataField: { name: 'ParentAccountId' }
        },
        id: 'AccountId',
        localData: arr_Lists
    };
    var dataAdapter = new $.jqx.dataAdapter(source, {
        loadComplete: function () {
            // data is loaded.
        }
    });

    $treeGrid.jqxTreeGrid({
        width: "100%",
        source: dataAdapter,
        pageable: true,
        pagerMode: 'advanced',
        pagerHeight: 40,
        filterable: true,
        filterMode: 'simple',//advanced
        editable: false,
        showAggregates: true,
        aggregatesHeight: 35,
        altRows: true,
        ready: function()
        {
            $("#treeGrid").jqxTreeGrid('hideColumn', 'AccountId');
            $("#treeGrid").jqxTreeGrid('hideColumn', 'ParentAccountId');
        },
        columns: [
            { text: 'Account', dataField: "AccountName", align: 'left', cellsAlign: 'left' , width: '30%' },
            { text: 'AccountId', dataField: "AccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
            { text: 'ParentAccountId', dataField: "ParentAccountId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false },
            { text: 'LastLevel', dataField: "LastLevel", align: 'right', cellsAlign: 'right', hidden:true, filterable: false},
            { text: 'Debit', dataField: "Debit", align: 'right', cellsAlign: 'right' , cellsFormat: 'd2', width: '30%', aggregates: ['sum'],
                aggregatesRenderer: function (aggregatesText, column, element, aggregates, type) {
                    if (type == "aggregates") {
                        var renderString = "<div style='margin: 8px; float: right;  height: 100%;'>";
                    } else {
                        var renderString = "<div style='float: right;  height: 100%;'>";
                    }
                    //var euro = dataAdapter.formatNumber(0.74 * aggregates.Total, "f2");;
                    var usd = 0;
                    if(aggregates != null){
                        usd = dataAdapter.formatNumber(aggregates.sum, "f2");
                    }
                    renderString += "<table><tr><td rowspan='2'></td><td align='right'><strong>" + sanitizeNumber(parseFloatVal(usd,0),2,true) + "</strong></td></table>";
                    return renderString;
                }
            },
            { text: 'Credit', dataField: "Credit", align: 'right', cellsAlign: 'right' , cellsFormat: 'd2', width: '30%', aggregates: ['sum'],
                aggregatesRenderer: function (aggregatesText, column, element, aggregates, type) {
                    if (type == "aggregates") {
                        var renderString = "<div style='margin: 8px; float: right;  height: 100%;'>";
                    } else {
                        var renderString = "<div style='float: right;  height: 100%;'>";
                    }
                    //var euro = dataAdapter.formatNumber(0.74 * aggregates.Total, "f2");;
                    var usd = 0;
                    if(aggregates != null){
                        usd = dataAdapter.formatNumber(aggregates.sum, "f2");
                    }
                    renderString += "<table><tr><td rowspan='2'></td><td align='right'><strong>" + sanitizeNumber(parseFloatVal(usd,0),2,true) + "</strong></td></table>";
                    return renderString;
                }
            },
            { text: 'TypeId', dataField: "TypeId", align: 'right', cellsAlign: 'right' , cellsFormat: 'd', hidden:true, filterable: false},
            { text: 'Action', sortable: false, filterable: false, align: 'left', width:'10%',
                cellsrenderer: function (event) {
                    var editLink = '<a title="View Report" href="javascript:void(0);" onclick="viewReport('+event+');" style="padding-left: ;"><i class="fa fa-eye reg-icon" style="font-size:17px;"></i></a>';
                    return editLink += "&nbsp;&nbsp;" + '<a><button style="background: transparent;" title="Add to Report" onclick="addReportList('+event+'); return false;"><i class="fa fa-plus-square reg-icon" style="font-size:17px;"></i></button></a>' + "&nbsp;&nbsp;"+'<a><button style="background: transparent;" title="Remove to Report" onclick="('+event+'); "><i class="fa fa-minus-square-o reg-icon" style="font-size:17px;"></i></button></a>';
                    return editLink;
                }
            }
        ]
    });

    /*$treeGrid.on('rowDoubleClick', function (event) {
        var args = event.args;
        var row = args.row;
        var fromSL=row.FromSL;
        var lastLevel=row.LastLevel;
        if(fromSL==0 && lastLevel=="Y") {
            var id = row.AccountId;
            var g_lCNYearId = $('#g_lCNYearId').val();
            window.location.replace(getBaseURL() + "fa/report/ccbalance/" + id +"/" + g_lCNYearId);
        } else if(fromSL==1 && lastLevel=="Y") {
            var id = row.AccountId;
            //var g_lCNYearId = $('#g_lCNYearId').val();
            window.location.replace(getBaseURL() + "fa/report/slbalance/" + id);
        }
    });*/

    //Print option
    $("#excelExport").click(function () {
        $("#treeGrid").jqxTreeGrid('exportData', 'xls');
    });
    $("#csvExport").click(function () {
        $("#treeGrid").jqxTreeGrid('exportData', 'csv');
    });
    $("#htmlExport").click(function () {
        $("#treeGrid").jqxTreeGrid('exportData', 'html');
    });

    $("#print").click(function () {
        $("#treeGrid").jqxTreeGrid('exportData', 'html');
    });

    $('#jqxbutton').click(function () {
        $("#treeGrid").jqxTreeGrid('expandAll');
        $('#jqxbutton').hide();
        $('#jqxbuttorenn').show();
    });

    $('#jqxbuttorenn').click(function () {
        $("#treeGrid").jqxTreeGrid('render');
        $('#jqxbutton').show();
        $('#jqxbuttorenn').hide();
    });
}
function viewReport(event) {
    var args = event.args;
    var AccountId=$treeGrid.jqxTreeGrid('getCellValue', event, 'AccountId');
    if(AccountId!=0){
        //        window.location.replace(getBaseURL() + "fa/index/trialbalancetrans/" + AccountId + '/'+$('#fromDate').val()+'/'+$('#toDate').val());
        window.open(getBaseURL() + "fa/report/trialbalancetrans/" + AccountId + '/'+$('#fromDate').val()+'/'+$('#toDate').val());
    }
}
var accountIds=[];
var accountNames=[];
function addReportList(event){
    var args = event.args;
    var AccountId=$treeGrid.jqxTreeGrid('getCellValue', event, 'AccountId');
    var AccountName=$treeGrid.jqxTreeGrid('getCellValue', event, 'AccountName');
    if($.inArray(AccountId,accountIds) === -1) {
        accountIds.push(AccountId);
        accountNames.push(AccountName);
    }
    $('#accIds').val(accountIds.toString());
    $('#accNames').val(accountNames);
	$('#accText').html('');
	$.each(accountNames,function(i,o){
		$('#accText').append('<li><span>'+o+'</span></li></div>');
	});
}
function sendSelectedAccount(){
    var accIds=$('#accIds').val();
    if(accIds.length != 0){
//            window.location.replace(getBaseURL() + "fa/report/trialbalancetrans/" + accIds + '/'+$('#fromDate').val()+'/'+$('#toDate').val());
        window.open(getBaseURL() + "fa/report/trialbalancetrans/" + accIds + '/'+$('#fromDate').val()+'/'+$('#toDate').val());
    }
}

</script>