<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />
	
<style type="text/css">
	.mar_20{margin-top:20px!important;}
	.jqx-widget-content {z-index:999 !important;}
	.blubg{background : #B0C3EB !important;}
	.card{margin-top:0% !important; margin-bottom:0px !important;}
	.btnPrev:disabled {background-color:#ffffff;}
	.sub_tab {background-color: #e7e9ec !important;border: 1px solid #ddd !important;float: left;margin-top: 0px;padding:8px;width:100%;}
	.highlight1{background : #e6bfcb !important;}
	.subDiv {background-color: #fff !important;border: 0px solid #ddd !important;}
</style>

<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 mar_20">
                <h1 style="margin-left:10px;">ReturnBill Detail</h1>
            </div>
			<div class="col-lg-12 top_ct">
				<div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear">
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="costcenter">
						<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status3">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-bandcamp fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $costcenter; ?></div>
										<div class="cbhuge comnelips">CostCentre Name</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="supplier">
						<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-certificate fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $supplier; ?></div>
										<div class="cbhuge comnelips">Vendor Name</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="PRDate">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $PRDate; ?></div>
										<div class="cbhuge comnelips">PR Date</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="vNo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $vNo; ?></div>
										<div class="cbhuge comnelips">PR No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="BillDate">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $BillDate; ?></div>
										<div class="cbhuge comnelips">Bill Date</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="BillNo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status2">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-calendar fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $BillNo; ?></div>
										<div class="cbhuge comnelips">Bill No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres " id="CPRNo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status5">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-registered fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $CPRNo; ?></div>
										<div class="cbhuge comnelips">CPR No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres " id="CCPRNo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status6">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-money fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $CCPRNo; ?></div>
										<div class="cbhuge comnelips">CCPR No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="col-lg-12 clear top-20">
				<div id="accordion" class="panel-group">
					<div class="panel panel-info">
						<div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
							<h4 class="panel-title accordion-toggle defa_panels">Enter Return Quantity</h4>
						</div>
						<div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
							<div class="panel-body bgcolr">
								<div class="col-lg-12">
									<div class="table-responsive top-30">
										<table class="table table-bordered" style=" margin-bottom:0px;" id="workorderTable">
											<thead>
											<tr>
												<th class="blubg" >Code</th>
												<th class="blubg" >Resource</th>
												<th class="blubg" >Unit</th>
												<th class="blubg" style="text-align:center">Qty</th>
												<th class="blubg" style="text-align:center" >BaseRate</th>
												<th class="blubg" style="text-align:center" >QRate</th>
												<th class="blubg" style="text-align:center" >BaseAmount</th>
												<th class="blubg" style="text-align:center" >Amount</th>
												<th class="blubg" >Purchase A/C</th>
												<th class="blubg" >&nbsp;</th>
											</tr>
											</thead>
											<tbody class="main"></tbody>
											<tbody class="total">
											<tr>
												<td colspan="6"></td>
												<td align="right" class="rate_pri">Total Amount</td>
												<td><input class="parent_text border-none" type="text" name="total" value="<?php echo (isset($BillAmount)) ? $BillAmount : '';?>" id="total" onkeypress="return isNumberKey(event,this);" disabled /></td>
												<td>&nbsp;</td>
											</tr>
											</tbody>
										</table>
										<input type="hidden" name="rowid" id="rowid" value="0"/>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-------------------------------Bill of Quantities end------------------------------->
					<div class="panel panel-info">
						<div data-target="#collapseTwo"  data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
							<h4 class="panel-title accordion-toggle defa_panels">Qualifier Details</h4>
						</div>
						<div class="panel-collapse collapse collapseTwo" id="collapseTwo" style="height: 0px;">
							<div class="panel-body bgcolr">
								<div class="clearfix"></div>
								<div class="col-lg-12">
									<div class="card">
										<div class="table-responsive clear">
											<table class="table table-hover clear table-bordered">
												<thead>
												<tr>
													<th class="blubg" >Qualifier Name</th>
													<th class="blubg" >Account Name</th>
													<th style="text-align:center" class="blubg" >Sign</th>
													<th class="blubg" >%</th>
													<th style="text-align:right" class="blubg" >Amount</th>
												</tr>
												</thead>
												<tbody class="main" id="QualifierAccTable"></tbody>
												<tbody class="total">
												<tr>
													<td colspan="3"></td>
													<td class="rate_pri">Total Amount</td>
													<td width="30%" ><input class="parent_text border-none " type="text" name="qutotal" id="qutotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" disabled /></td>
												</tr>
												</tbody>
											</table>
											<input type="hidden" name="Qrowid" id="Qrowid" value="0"/>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-------------------------------Other Details------------------------------->
					<div class="panel panel-info">
						<div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
							<h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
						</div>
						<div class="panel-collapse collapse" id="collapseThree" style="height: 0px;">
							<div class="panel-body bgcolr">
								<div class="clearfix"></div>
								<div class="col-lg-12">
									<div class="card">
										<ul class="nav nav-tabs">
											<li  class="active"><a href="#Note" aria-controls="settings" role="tab" data-toggle="tab">Narration</a></li>
										</ul>
										<div class="tab-pane" id="Note">
											<p>
											<div class="col-lg-12 sub_tab">
												<?php
												if(isset($Narration)){
													?>
													<textarea class="exp-tex btnPrev" name="Notes" id="Notes" disabled > <?php echo (isset($Narration)) ? $Narration : '';?> </textarea>
												<?php }else{ ?>
													<textarea class="exp-tex btnPrev" name="Notes" id="Notes" placeholder="Enter your Notes..." disabled ></textarea>
												<?php } ?>
											</div>
											</p>
										</div>
										<div id="Question"></div>
									</div>
								</div>
							</div>
						</div>
					<!-------------------------------Other Details------------------------------->
						<div class="clearfix"></div>
					</div>
				</div>
			</div>
			
			
            <div class="col-lg-12 clear">
                <div class="table-responsive clear">
                    <div id="dataTable"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r">
            <a href="<?php echo $this->basePath("/mms/billreturn/returnbill-register");?>" class="ripple">Close</a>
        </li>
    </ul>
</div>
<script id="Qual-template" type="text/template" class="hide">
    <tr>
        <td width="15%" name="qualifiername__7" id="qualifiername__8">
            <input type="hidden" name="QualifierExist___qu__0_per__9" id="QualifierExist___qu__0_per__9" value=""/>
            <input type="hidden" name="QualifierId__7" id="QualifierId__8" value=""/>
        </td>
        <td width="30%">
			<select data-placeholder="" class="form-control single_dropdown lbl_move sortoption qchk " tabindex="7" onchange="getAccountData(this);"  name="accountname__7" id="accountname__8" disabled></select>
		</td>
        <td width="15%"><input style="text-align:center" class="parent_text red-non qualmainTrInput qualpop" type="text" name="sign__7" id="sign__8" value="" disabled /></td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="percentage__7" id="percentage__8" value="" disabled /></td>
        <td width="30%"><input class="parent_text red-non qualmainTrInput qualpop qualamount" type="text" name="qualamount__7" id="qualamount__8" style="text-align:right;" value="" disabled /></td>
    </tr>
</script>
<script id="resource-template"  type="text/template" class="hide">
    <tr id="click__"  class="count-tr">
        <td class="mar_20 border-none"  width="12%" name="code__" id="code__"></td>
        <td width="15%" name="desc__" id="desc__" class="border-none">
            <input type="hidden" name="resourceid__" id="resourceid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="8%" name="unitname__" id="unitname__" class="border-none">
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td width="10%" style="text-align:right" name="qty__" id="qty__" class="border-none"></td>
        <td width="15%" style="text-align:right"  name="rate__" id="rate__"class="border-none"></td>
        <td width="10%" style="text-align:right" name="qrate__" id="qrate__"class="border-none"></td>
        <td width="12%" style="text-align:right" name="baseamount__" id="baseamount__" class="border-none"></td>
        <td width="20%" style="text-align:right" name="amount__" id="amount__"class="border-none"></td>
        <td width="12%" class="border-none"><select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="PurchaseAccount__" id="PurchaseAccount__">
            </select></td>
        <td width="3%" align="center" class="action_btns_td border-none">
            <ul class="action_btns">
                <li> <a class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>

    <tr id="subTr__" style="display:none" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="">
                <div class="col-lg-12 col-lg-offset-0 rdbt">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="wbsTabLink__" onclick="showtabs('wbs',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Wbs<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li class=""><a class="ripple has-ripple" id="qualifierTabLink__" onclick="showtabs('qualifier',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Qualifier<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                            <li class="" style="display:none;"><a class="ripple has-ripple" id="whTabLink__" onclick="showtabs('wh',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Ware House<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12" style="margin-bottom:10px;">
                    <div class="tab-content">
                        <div class="table-responsive topsp sub_tab">
                            <table class="table" style="margin-bottom:0px;" id="iowTable__">
                                <thead>
                                <tr>
                                    <th width="50%" class="sub_tbl3">WBS Name</th>
                                    <th width="50%" class="sub_tbl3">WBS Qty</th>
                                    <th class="sub_tbl3" >&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main">
                                </tbody>
                                <tbody class="total">
                                <tr>
                                    <td width="10%"><input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/></td>
                                </tr>
                                </tbody>
                                <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                            </table>
                            <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable__" onchange="CalculateRate(this.id)">

                            </table>
                            <table class="table table-bordered" style="margin-bottom:0px;" id="whTable__">
                                <thead>
                                <tr>
                                    <th class="highlight1">Warehouse</th>
                                    <th class="highlight1">Description</th>
                                    <th class="highlight1" style="text-align:center">ClosingStock</th>
                                    <th class="highlight1" style="text-align:center">Qty </th>
                                    <th class="highlight1" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="wh___rowid" id="wh___rowid" value="0"/>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="30%">
            <input type="hidden"  name="iow___wbsid_0" id="iow___wbsid_0" readonly/>
            <input class="parent_text border-none" type="text" name="iow___wbsname_0" id="iow___wbsname_0" readonly/>
        </td>
        <td width="25%"><input class="parent_text <?php echo $displaymaintr; ?>" type="text" name="iow___qty_0" id="iow___qty_0"  style="text-align:right;" onkeypress="return isDecimal(event,this)" onfocus="checkWarehouse(this);" readonly/></td>
    </tr>
    <tr id="warech__" style="" class="subTr dont-hide">
        <td colspan="9" style="padding:0px !important;">
            <div class="subDiv all" style="">
                <div class="table-responsive topsp">
                    <table class="table" style="margin-bottom:0px;" id="whTable___wbs_0_whreqno">
                        <thead>
                        <tr>
                            <th class="worktype-activity sub_tbl2">Warehouse Name </th>
                            <th class="worktype-activity sub_tbl2">Description </th>
                            <th class="worktype-activity sub_tbl2">ClosingStock </th>
                            <th class="worktype-activity sub_tbl2">Qty </th>
                            <th class="sub_tbl2" style="display: none;">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="ware"></tbody>
                        <tbody class="total">
                        </tbody>

                    </table>
                    <input type="hidden" name="wh___wbs_0_wrowid" id="wh___wbs_0_wrowid" value="0"/>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="iow-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="20%" name="wh___wbs_0_warehousename__7" id="wh___wbs_0_warehousename__7">
            <input type="hidden" name="wh___wbs_0_warehouseid__7" id="wh___wbs_0_warehouseid__7"/>
            <input  type="hidden" name="wh___wbs_0_stockid__7" id="wh___wbs_0_stockid__7" />
        </td>
        <td width="20%" name="wh___wbs_0_desc__7" id="wh___wbs_0_desc__7"></td>
        <td width="20%" name="wh___wbs_0_closingstock__7" id="wh___wbs_0_closingstock__7"></td>
        <td width="20%" name="wh___wbs_0_qty__7" id="wh___wbs_0_qty__7">
            <input type="hidden" name="wh___wbs_0_hiddenqty__7" id="wh___wbs_0_hiddenqty__7" value="0"/>
        </td>
    </tr>
</script>
<script id="request-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="40%" name="wh___warehousename_0" id="wh___warehousename_0">
            <input type="hidden" name="wh___warehouseid_0" id="wh___warehouseid_0"/>
            <input  type="hidden" name="wh___stockid_0" id="wh___stockid_0" />
        </td>
        <td width="30%" name="wh___desc_0" id="wh___desc_0"></td>
        <td width="15%" name="wh___closingstock_0" id="wh___closingstock_0" style="text-align:right"></td>
        <td width="15%" name="wh___qty_0" id="wh___qty_0" style="text-align:right">
            <input type="hidden" name="iow__hiddenqty_0" id="iow__hiddenqty_0" value="0"/>
        </td>
    </tr>
</script>
<script type="text/javascript">
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_sel_warehouse = <?php echo (isset($arr_sel_warehouse)) ? json_encode($arr_sel_warehouse) : '[]';?>;
var WarehouseCheck = <?php echo (isset($WarehouseCheck)) ? json_encode($WarehouseCheck) : '[]';?>;
var arr_warehouseQty = <?php echo (isset($arr_warehouseQty)) ? json_encode($arr_warehouseQty) : '[]';?>;
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var arr_accountType = <?php echo (isset($arr_accountType)) ? json_encode($arr_accountType) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var qualiferHTML = <?php echo (isset($qualHtml)) ? json_encode($qualHtml) : '[]';?>;
var qual_Acc = <?php echo (isset($Qual_Acc)) ? json_encode($Qual_Acc) : '[]';?>;
var qualList = <?php echo (isset($qualList)) ? json_encode($qualList) : '[]';?>;
var arr_wbs = <?php echo (isset($arr_res_wbs)) ? json_encode($arr_res_wbs) : '[]';?>;
var arr_res_selwbs = <?php echo (isset($arr_res_selwbs)) ? json_encode($arr_res_selwbs) : '[]';?>;
var arr_sel_wbswarehouse = <?php echo (isset($arr_sel_wbswarehouse)) ? json_encode($arr_sel_wbswarehouse) : '[]';?>;
var arr_sels_wbswarehouse = <?php echo (isset($arr_sels_wbswarehouse)) ? json_encode($arr_sels_wbswarehouse) : '[]';?>;
var qualAccList = <?php echo (isset($qualAccList)) ? json_encode($qualAccList) : '[]';?>;
var sampleQual = [];

$.each(qualAccList, function (k, j) {
    var sign = 0;
    if(j.Sign == '+'){
        sign = 1;
    } else{
        sign = 2;
    }
    var aId = j.AccountId;
    var qId = j.QualifierId;
    var arrKey = qId +'AA'+ sign ;
    sampleQual[arrKey] = aId;
});


$(function () {
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var waretemplate = $('#iow-warehouse').html();
    var requestwarehouse = $('#request-warehouse').html();
    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.main');

    if (arr_requestResources.length != 0) {
        $.each(arr_requestResources, function (i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            var opt = '<option></option>';
            if (arr_accountType.length > 0) {
                $.each(arr_accountType, function (j, p) {
                    opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
                });
            }
            $('#PurchaseAccount_' + rowid).html(opt);
            if (<?php echo (isset($PRRegisterId)) ? $PRRegisterId : 0;?> >0)
            {
                $('#PurchaseAccount_' + rowid).val(o.PurchaseTypeId).addClass('border-none').prop('disabled', true);
            }
            $('#code_' + rowid).html(o.Code).addClass('border-none').prop('disabled', false);
            $('#desc_' + rowid).html(o.ResourceName).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#qty_' + rowid).html(o.Qty);
            $('#unitname_' + rowid).html(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#rate_' + rowid).html(o.Rate);
            $('#qrate_' + rowid).html(o.QRate);
            $('#amount_' + rowid).html(o.QAmount);
            $('#baseamount_' + rowid).html(o.Amount);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            var whsCount = 0;
            if (arr_sel_warehouse.length != 0) {
                $.each(arr_sel_warehouse, function (m, n) {
                    if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId) {
                        return;
                    }
                    whsCount = whsCount+1;
                    var whrowid = parseInt($('#wh_' + rowid + '_rowid').val()) + 1;
                    $('#whTable_' + rowid).find('> tbody.main').append(requestwarehouse
                        .replace(/__/g, '_' + rowid)
                        .replace(/_0/g, '_' + whrowid));

                    $('#wh_' + rowid + '_rowid').val(whrowid);
                    $('#wh_' + rowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                    $('#wh_' + rowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                    $('#wh_' + rowid + '_stockid_' + whrowid).val(n.StockId);
                    $('#wh_' + rowid + '_desc_' + whrowid).html(n.Description);
                    $('#wh_' + rowid + '_qty_' + whrowid).html(n.Qty);
                    $('#wh_' + rowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                    $('#wh_' + rowid + '_hiddenqty_' + whrowid).val(n.Qty);

                });
            }
            //////////////////////////Qualifier-start /////////////////////////////
            if (<?php echo (isset($PRRegisterId)) ? $PRRegisterId : 0;?> >0)
            {
                var RId = o.ResourceId;
                var ItId = o.ItemId;
                var poId =<?php echo (isset($PRRegisterId)) ? $PRRegisterId : 0;?>;
                $.ajax({
                    url: getBaseURL() + 'mms/billreturn/returnbill-detailed',
                    type: "post",
                    data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&poId=" + poId + "",
                    async: false,
                    success: function (data, textStatus, jqXHR) {
                        if (jqXHR.status == 200) {
                            data = JSON.parse(data);
                            $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                        }
                        $('.loading_area').hide();
                    }, error: function (jqXHR, textStatus, errorThrown) {
                        $('.loading_area').hide();
                    }
                });
            }
            else
            {
                $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
            }
            ////////////// Qualifier - end /////////////////////////////////////

            var wbsCount = 0;
            //wbs start
            if(arr_resource_iows.length != 0){
                $.each(arr_resource_iows, function (j, l) {
                var findRes = arr_wbs.filter(function (obj) {
                    return (obj.ResourceId === o.ResourceId && obj.WBSId === l.WBSId);
                });
                if (findRes.length != 0) {
                        wbsCount = wbsCount+1;
                        $('#wbsTabLink_' + rowid).closest("li").addClass('active');
                        $('#whTabLink_' + rowid).hide();
                        $('#whTable_' + rowid).hide();
                        var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                        $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                        $('#iow_' + rowid + '_rowid').val(iowrowid);
                        $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                        $('#iow_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
                        $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
                        $.each(arr_res_selwbs, function (h, j) {
                            var resoid = parseInt(j.ResourceId);
                            var itmid = parseInt(j.ItemId);
                            if (o.ResourceId == resoid && o.ItemId == itmid && l.WBSId == j.WBSId) {
                                $('#iow_' + rowid + '_qty_' + iowrowid).val(j.Qty);
                            }
                        });

                        //start of warehouse
                        if (<?php echo (isset($PRRegisterId)) ? $PRRegisterId : 0;?> >0)
                        {
                            if (arr_sel_wbswarehouse.length != 0) {
                                $.each(arr_sel_wbswarehouse, function (m, n) {

                                    var findWHH = arr_sel_wbswarehouse.filter(function (obj) {
                                        return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                                    });
                                    if (findWHH.length != 0) {
                                        var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(waretemplate
                                            .replace(/__7/g, '_' + whrowid)
                                            .replace(/_0/g, '_' + iowrowid)
                                            .replace(/__/g, '_' + rowid));

                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).html(n.Description);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(n.Qty).attr('data-find', n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(n.Qty);
                                        $.each(arr_sels_wbswarehouse, function (s, t) {
                                            if (n.WareHouseId == t.WareHouseId && t.AnalysisId == l.WBSId && o.ResourceId == t.ResourceId && o.ItemId == t.ItemId && t.Qty > 0) {
                                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(t.Qty);
                                            }
                                        });
                                    }
                                });
                            } else {
                                $('.all').hide();
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                                $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcQuantity(this)');
                                $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                            } //end of warehouse
                        } else{
                            if (arr_sel_warehouse.length != 0) {
                                $.each(arr_sel_warehouse, function (m, n) {
                                    var findWH = arr_sel_warehouse.filter(function (obj) {
                                        return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                                    });

                                    if (findWH.length != 0) {
                                        var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(waretemplate
                                            .replace(/__7/g, '_' + whrowid)
                                            .replace(/_0/g, '_' + iowrowid)
                                            .replace(/__/g, '_' + rowid));

                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).html(n.Description);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(n.Qty).attr('data-find', n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(n.Qty);
                                    }
                                });
                            } else {
                                $('.all').hide();
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                                $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcQuantity(this)');
                                $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                            } //end of warehouse
                        }

                } else{
                    $('#iowTable_' + rowid).hide();
                    $('#wbsTabLink_' + rowid).closest("li").removeClass('active');
                    $('#whTabLink_' + rowid).closest("li").addClass('active').show();
                    $('#whTable_' + rowid).show();
                }
                });
            } // wbs end
            if(wbsCount == 0){
                $('#wbsTabLink_' + rowid).hide();
            }
            //no wbs and no warehouse
            if(whsCount == 0 && wbsCount == 0) {
                $('#expandTr_' + rowid).hide();
                $('#qty_' + rowid).attr('onkeypress','return isDecimal(event,this);');
                $('#qty_' + rowid).attr('onchange','calcResQuantity(this)');
                $('.subDiv').hide();
            } else {
                $('#qty_' + rowid).attr('readOnly','readOnly');
            }
            if(wbsCount > 0) {
                $('#iowTable_' + rowid).show();
            }
        });
    }
    rowid += 1;
    //$tbody.append(template.replace(/__/g, '_' + rowid));

    var opt = '<option></option>';
    if (arr_accountType.length > 0) {
        $.each(arr_accountType, function (j, p) {
            opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
        });
    }
    $('#PurchaseAccount_' + rowid).html(opt);
    $('#issueAccount_' + rowid).html(opt);
    var rowIdval = parseInt(arr_requestResources.length + 1);
    $('#rowid').val(rowIdval);

    $('.content_wrapper').on('click', '.mainTr', function (e) {
        e.preventDefault();
        if (!$(this).closest("tr").next(".subTr").is(":visible")) {
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else {
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });
	nextAccordian(1);
	

    var qual1 =0;
    $('#qualClick').attr("disabled", false);
    $('#QualifierAccTable').html('');
    var totalQualRows = $('#rowid').val();
    var Qtemplate = $('#Qual-template').html();
    var qualCheck=0;

    for (var i = 1; i < totalQualRows; i++) { console.log(qualList);
        $.each(qualList,function(m,o) {
            var qualRowCount = m+1;
            if ($('#Qual_'+i+'_YesNo_'+qualRowCount).is(':checked') == true) {
                var vatAmt = $('#Qual_'+i+'_Amount_'+qualRowCount).val();
                var QualName = $('#Qual_'+i+'_Desc_'+qualRowCount).val();
                var percent = $('#Qual_'+i+'_ExpPer_'+qualRowCount).val();
                var qId = $('#Qual_'+i+'_Id_'+qualRowCount).val();
                var dot = sanitizeNumber(percent,2,true).replace('.','_');
                var sSign = isNullCheck($('#Qual_'+i+'_Sign_'+qualRowCount).val(), 'string');
                if (sSign == '+') {
                    aSign = 1;
                } else {
                    aSign = 2;
                }
                var commonVar = 'QualifierExist_'+ qId +'_qu_' + aSign + '_per_'+ dot;
                abc = $('#QualifierExist_'+ qId +'_qu_' + aSign +'_per_'+ dot);
                if (abc.length) {
                    var prevAmt= $('#qualamount_' + commonVar).val();
                    var newAmt=parseFloat(prevAmt)+parseFloat(vatAmt);
                    $('#qualamount_' + commonVar).val(sanitizeNumber(newAmt,3,true));
                }
                else{
                    $('#QualifierAccTable').append(Qtemplate
                            .replace(/__8/g, '_' + commonVar)
                            .replace(/__7/g, '_' + qualCheck)
                            .replace(/__9/g, '_' + dot)
                            .replace(/__0/g, '_' + aSign)
                            .replace(/__/g, '_' + qId)
                    );
                    $(".single_dropdown1").select2({
                    });
                    abc.val('QualifierExist_'+ qId +'_qu_' + aSign);
                    $('#qualifiername_' + commonVar).html(QualName);
                    $('#QualifierId_' + commonVar).val(qId);
                    $('#percentage_' + commonVar).val(sanitizeNumber(percent,2,true));
                    $('#sign_' + commonVar).val(sSign);
                    $('#qualamount_' + commonVar).val(sanitizeNumber(vatAmt,3,true));
                    var arrkey =  qId + 'AA' + aSign;
                    var opt = '<option value=""></option>';
                    if (qual_Acc.length > 0) {
                        $.each(qual_Acc, function (j, p) {
                            if(sampleQual[arrkey]== p.AccountId) {
                                opt += '<option selected value="' + p.AccountId + '">' + p.AccountName + '</option>';
                            } else {
                                opt += '<option value="' + p.AccountId + '">' + p.AccountName + '</option>';
                            }
                        });
                    }
                    $('#accountname_' + commonVar).html(opt).trigger('change');
                    qualCheck++;
                    $('#Qrowid').val(qualCheck);
                }
            }
        });
    }
    $('.qualamount').each(function (i, o) {
        var curId = $(this).attr('id');
        var signId = curId.replace('qualamount','sign');
        var aSignVal = $('#'+signId).val();
        if(aSignVal == '-'){
            qual1 -= parseFloat($(this).val());
        }
        else{
            qual1 += parseFloat($(this).val());
        }
    });
    $('#qutotal').val(sanitizeNumber(qual1, 2));
});
function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];

    if (type=="wbs") {
        $('#qualifierTable_'+rowid).hide();
        $('#whTable_' + rowid).hide();
        $('#iowTable_'+rowid).show();
    } else if (type=="qualifier"){
        $('#qualifierTable_'+rowid).show();
        $('#iowTable_'+rowid).hide();
        $('#whTable_' + rowid).hide();
    }
    else{
        $('#whTable_' + rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#iowTable_'+rowid).hide();
    }
    return false;
}
function getAccountData(x){
    if($(x).val() != ''){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid = ids[2];
        var iowrowid = ids[4];
        var qper = ids[6];
        var fa=ids[7];

        var accId = $('#accountname_' + 'QualifierExist_' + rowid + '_qu_' + iowrowid + '_per_' + qper + '_' + fa).val();
        var arrkey = rowid + 'AA' + iowrowid;
        sampleQual[arrkey]=accId;
    }
}
function nextAccordian(id) {
	$('#panelheading-1').trigger('click');
}
var costcenter= <?php echo json_encode ($costcenter);?>;
var supplier= <?php echo json_encode ($supplier);?>;
var PRDate= <?php echo json_encode ($PRDate);?>;
var vNo= <?php echo json_encode ($vNo);?>;
var BillDate= <?php echo json_encode ($BillDate);?>;
var BillNo= <?php echo json_encode ($BillNo);?>;
var CPRNo= <?php echo json_encode ($CPRNo);?>;
var CCPRNo= <?php echo json_encode ($CCPRNo);?>;
if(costcenter == ''|| costcenter == null) {
	$('#costcenter').hide();
} 
if(supplier == ''|| supplier == null){
	$('#supplier').hide();
} 
if(PRDate == ''|| PRDate == null){
	$('#PRDate').hide();
} 
if(vNo == ''|| vNo == null){
	$('#vNo').hide();
} 
if(BillDate == ''|| BillDate == null){
	$('#BillDate').hide();
} 
if(BillNo == ''|| BillNo == null){
	$('#BillNo').hide();
} 
if(CPRNo == ''|| CPRNo == null){
	$('#CPRNo').hide();
} 
if(CCPRNo == ''|| CCPRNo == null){
	$('#CCPRNo').hide();
}
</script>