<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />

<style>
#allResource .jqx-grid-header 	{height:75px !important;}
#mostResource .jqx-grid-header 	{height:75px !important;}
#recentResource .jqx-grid-header 	{height:75px !important;}
#wbsGrid .jqx-grid-header 	{height:75px !important;}

.jqx-grid-column-header .jqx-checkbox-default{
	display:none;
}
.input-group-addon{
	background-color:#fff !important;
	border:none !important;
}
.error{
	border-color:red;
	background-color:red !important;
}
.nav-list{padding-right:15px;padding-left:15px;margin-bottom:0;}
.nav-list-main{padding-left:0px;padding-right:0px;margin-bottom:0;}
span.nav-toggle-icon{font-size:7px !important;top:-2px !important;color:#888 !important;}
.rmks_ara { border: 1px dashed #afbecc; font-size: 15px; height: 158px;padding: 10px;resize: none;width: 100% !important;margin-top:10px;margin-bottom:10px;}
.btn-pop{ float:right;padding:6px 12px !important; font-size:14px; margin-right:20px; background:#d1eaff; color:#054d6b; border-radius:10px; margin-bottom:20px !important;}
.btn-pop:hover{background:#87ceeb;}

/**.nav-list-main li>label.nav-toggle::before {
  position: absolute;
  top: 6px;
  right: 10px;
  display: inline-block;
  border-bottom: 4px solid transparent;
  border-top: 4px solid transparent;
  border-left: 4px solid #ccc;
  border-left-color: rgba(0, 0, 0, 0.4);
  content: '';
}
.nav-list-main li>label.nav-toggle::after {
  position: absolute;
  top: 0px;
  right: 10px;
  display: inline-block;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid red;
  border-left-color: rgba(0, 0, 0, 0.4);
  content: '';
}*/

</style>


<div class="content_wrapper padlr0">
	<div class="container-fluid">
		<div class="col-lg-12 clear">
			<form class="form-horizontal" method="post">
			<div class="row" id="zerothStep">
			<h1 class="txt_center form_main_h1 frmwrk_h1">Issue Entry</h1>
			<div class="form-group">
						<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
						<div class="row">
						  <div class="form-group req_flds col-lg-12">
							<input type="text" name="issue_no" id="issue_no" data-bsfshare="Issue No" value="" class="form-control lbl_move" label="Issue No" />									
							<div class="error_message"><p>Please select issueno...</p> </div> 
						</div>
						</div>
						<div class="row">
								<div class="form-group req_flds col-lg-12">
									<span class="date_icon"><i class="fa fa-calendar"></i></span>
									  <input type="text" name="issue_date" id="issue_date" data-bsfshare="Issue Date" value="" readonly class="form-control lbl_move datepickerinput" label="Request date" />									
									<div class="error_message"><p>Please select Issue Date...</p> </div> 
									</div>
								</div>
						
						</div>
					</div>
			</div>
				<div class="row" id="firstStep" style="display:none;">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Issue Entry</h1>
					<div class="form-group">
						<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<select class="single_dropdown2 lbl_move" data-bsfshare="Issue Type" style="width:100%;" label="Select Issue type"  name="issue_type" id="issue_type">
										<option value=""></option>
										<option value="1">Internal</option>
										<option value="2">Contractor</option>
									</select>
									<div class="error_message"><p>Please select Issue Type...</p> </div>
								</div>
							</div>
							<div style="display:none;" id="contract">
								<div class="form-group req_flds col-lg-12">
									<select class="single_dropdown2 lbl_move" data-bsfshare="Contractor" style="width:100%;" label="Select contractor" name="contractor" id="contractor">
										<option value=""></option>
										<option value="1">contractor1</option>
										<option value="2">Contractor2</option>
									</select>
									<div class="error_message"><p>Please select contract...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<select class="single_dropdown2 lbl_move" data-bsfshare="Issue" style="width:100%;" label="Select Issue"  name="issue" id="issue">
										<option value=""></option>
										<option value="1">Issue</option>
										<option value="2">Return</option>
									</select>
									<div class="error_message"><p>Please select Issue ...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<select class="single_dropdown2 lbl_move" data-bsfshare="Cost Centre" style="width:100%;" label="Select Projects"  name="proj_name" id="proj_name">
										<option value=""></option>
										<?php foreach($resourceproj as $proj): ?>
											<option value="<?php echo $proj['CostCentreId'];?>" ><?php echo $proj['CostCentreName'];?></option>
												<?php endforeach; ?>
									</select>
									<div class="error_message"><p>Please select project...</p> </div> 
								</div>
							</div>
							<input type="hidden" name="resourceId" id="resourceId">
							<input type="hidden" name="all_wbsId" id="all_wbsId">
						</div>
					</div>
				</div>
				<div class="row" id="excludeFirst" style="display:none;">
				   <div class="col-lg-12">
						<h1>Issue Entry-<span id="VoucherSpan"><?php// echo $vNo['voucherNo']; ?></span></h1> 
						<div class="col-lg-12 clear" style="margin:10px;">
							<div class="col-lg-6 col-md-6">
								<div class="row">
									<div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p">Project<span class="colon_r">:</span></p></div>
									<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p" id="projectSpan"></p></div> 
								</div>
								<div class="row">
									<div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p">Selected Issue Type<span class="colon_r">:</span></p></div>
									<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p" id="materialSpan"></p></div> 
							   </div>
							</div>
							<div class="col-lg-6 col-md-6">
								<div class="row">
									<div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p">Contractor<span class="colon_r">:</span></p></div>
									<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p" id="dateSpan"></p></div> 
								</div>
								<div class="row">
									<div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6"><p class="space_p">Issue<span class="colon_r">:</span></p></div>
									<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"> <p class="space_p" id="prioritySpan"></p></div> 
								</div>
							</div>  
						</div>
					</div>
				</div>						
									
				<div class="row" id="fourthStep" style="display:none;">
					
					<div class="col-lg-12">
						<nav class="navbar inrmdltab_navbar navbar-default">
							<div class="navbar-header">
								<button type="button" class="navbar-toggle mdlnvbr_tgl collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a class="navbar-brand inrmdl_navbrand" href="javascript:void(0);">Select Menus</a>
							</div>
							<div id="navbar" class="navbar-collapse padlr0 collapse">
								<ul class="nav nav-tabs innermdl_tabs">
									<li class="active"><a href="#allresources" data-toggle="tab">All Resource</a></li>
									<li><a href="#mostused" data-toggle="tab">Most used</a></li>
									<li><a href="#recent" data-toggle="tab">Recent</a></li>
								</ul>
							</div>
						</nav>
						<div class="tab-content">
							<div class="tab-pane fade in active" id="allresources">
								<div class="table-responsive">
									<div id="jqxWidget">
										<div id="allResource" style="width:100%;">
										</div>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="mostused">
								<div class="table-responsive">
									<div id="jqxWidget">
										<div id="mostResource" style="width:100%;">
										</div>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="recent">
							   <div class="table-responsive">
									<div id="jqxWidget">
										<div id="recentResource" style="width:100%;">
										</div>
									</div>
								</div> 
							</div>
						</div>								
					</div>
				</div>
				<div class="row" id="fifthStep" style="display:none;">
					<div class="col-lg-12">
						<input type="hidden" name="all_wbsId" id="all_wbsId">
						<div class="col-lg-1 col-lg-offset-11">
							<div class="form-group">
								<ul class="grid_change">
									<li class="matrixView"><a class="grid_change_line grid_change_active" data-original-title="Grid View" href="javascript:void(0)" data-placement="top" data-toggle="tooltip"><span><i class="fa fa-th"></i></span></a></li>
								</ul>
							</div>		
						</div>
                        <div class="form-group hideView" style="margin-top:20px;display:none;" id="sequentialViewDiv">
                            <div>
                                <div class="col-lg-12 clear">
                                    <div class="table-responsive clear">						
										<table id="sequentialView" class="table table-bordered tableView" style="width:100%;">
											<thead>
												<tr>
													<th data-bsfshare="Contractor">Code</th>
													<th data-bsfshare="ResourceName">ResourceName</th>
													<th data-bsfshare="Unit">Unit</th>
													<th data-bsfshare="ClosingQuantity">Closing Quantity</th>
													<th data-bsfshare="CurrentQunatity">Current Qunatity</th>
													<th data-bsfshare="Rate">Rate</th>
													<th data-bsfshare="Amount">Amount</th>
													<th data-bsfshare="Warehouse">Warehouse</th>
												</tr>
											</thead>
											<tbody class="appendData">
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div class="table-responsive clear col-lg-12 hideView" id="matrixView">
							<div class="matrix_table_area">
								<table class="table matrix_table clear">
									<thead>
										<tr>
											<th class="headcol_l headcol_l1">Resource Description</th>
										</tr>
									</thead>
									<tbody class="appendDataMatrix">
									</tbody>
								</table>
							</div>
						</div>
						<table id="sequentialViewSub" class="table table-bordered table-hover tableView" style="margin-top:20px;display:none;">
							<thead>
								<tr>
									<th>Sample</th>
								</tr>
							</thead>
							<tbody class="subTable">
							</tbody>
						</table>							
					</div>
               </div>
			</form>
		</div>
	</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li id="continueButton" class="dropdown save_btn float_r">
            <a href="javascript:void(0);" class="ripple">Continue</a>
        </li>
        <li id="backButton" class="cancel_btn float_r" style="display:none;"><a href="javascript:void(0);" class="ripple">back</a></li>
		 <li class="cancel_btn cancel_btn_bluecolor float_l"><a id="cancelbutton" class="ripple" onclick="alert confirm();">cancel</a></li>
    </ul>
</div>
<script>
var apptextare="";
$(document).ready(function() {
		$(".single_dropdown2").select2({
			placeholder: "",
			allowClear: true
		}); });
$(".checkboxNarration").change(function() {
    if(this.checked) {
		apptextare += this.value+'&#13';
		$('#narration').html(apptextare);
    } else {
		if(apptextare !=""){
			var isIn = apptextare.indexOf(this.value+'&#13');
			if(isIn != -1){
				apptextare = apptextare.replace(this.value+'&#13','');
				$('#narration').html(apptextare);
			}
		}
	}
});
$("#cancelbutton").click(function(){
    if(confirm("Are you sure you want to Cancel this entry?")){
        $("#cancelbutton").attr("href", "<?php echo $this->basePath();?>/ats/index/display-register");
    }
    else{
        return false;
    }
});


	$(".error_message").hide();
	var allWbs=[];
	var oTable = $("#sequentialView").dataTable({"aLengthMenu": [[5, 10, 15], [5, 10, 15]], "order": [],
		"initComplete": function(settings, json) {
			$("select[name=sequentialView_length]").addClass("show-tick").selectpicker();
		},	
		"drawCallback": function( settings ){
			if($('#sequentialView_next').hasClass('disabled') && $('#fifthStep').is(':visible'))
				$("#continueButton a").text("Submit");
			else
				$("#continueButton a").text("Continue");
		}	
	});
	$("#voucherNo").blur(function(){
		$("#VoucherSpan").text($(this).val());
	});
	$("#priority").change(function(){
		$("#prioritySpan").text($("#priority option:selected").text());
	});
  var change=false;
	//var oTable = $("#decisionTable").dataTable();
	var request='';
	var requestold='';

	$(".grid_change li").click(function(){
		if($(this).find("a").hasClass("grid_change_box")){
			$(".grid_change li a").removeClass("grid_change_box").addClass("grid_change_line").attr("data-original-title",'Sequential View');
			$(".grid_change li a span i").removeClass("fa-th").addClass("fa-list-ul");
			$(".hideView").hide();
			$("#matrixView").show();
			$('#continueButton a').text('submit');
		}
		else {
			$(".grid_change li a").removeClass("grid_change_line").addClass("grid_change_box").attr("data-original-title",'Grid View');
			$(".grid_change li a span i").removeClass("fa-list-ul").addClass("fa-th");
			$(".hideView").hide();
			$("#sequentialViewDiv").show();
			if($('#sequentialView_next').hasClass('disabled'))
				$("#continueButton a").text("Submit");
			else
				$("#continueButton a").text("Continue");			
		}
	});
	$('.datepickerinput').datepicker({
		format: "dd-mm-yyyy",
		startDate: new Date(),
		todayBtn: true,
		orientation: "top auto",
		autoclose: true
	}).on("changeDate", function(e){
		$("#dateSpan").text($(this).val());
	});	
	$('.date_icon').click(function() {
		var input = $(this).parent().find('input').datepicker('show');
	});	
	
	var parseInput = function(val) {
		var floatValue = parseFloat(val);
		return isNaN(floatValue) ? '' : floatValue;
	}
	function trimNumber(s){
	  while (s.substr(0,1) == '0' && s.length>1) { s = s.substr(1,9999); }
	  return s;
	}	
	
	function trClick(){
		oTable.$("tr.mainTr").find(".totQuantity").unbind();
		oTable.$("tr.mainTr").find(".totQuantity").bind('click', function(){
			if(!($(this).closest("tr.mainTr").next("tr").hasClass("duplicateTr"))){
				$(this).closest("tr.mainTr").after("<tr class='duplicateTr'>"+$(".subTr_"+$(this).closest("tr.mainTr").attr("id")).html()+"</tr>");
				//changePage();
			}
		});
		oTable.$("tr.mainTr").find('.date_icon').unbind('click');
		oTable.$("tr.mainTr").find(".changeVal").unbind('change');
		$(".changeVal").unbind('blur');
		
		oTable.$("tr.mainTr").find('.date_icon').bind('click', function() {
			var input = $(this).parent().find('input').datepicker('show');
		});
		oTable.$("tr.mainTr").find(".changeVal").bind('change', function(){
			var bname = $(this).attr("name");
			$("input[name="+bname+"]").val($(this).val());
		});
		$(".changeVal").bind('blur', function(){
			var bname = $(this).attr("name");
			oTable.$("tr.mainTr").find("input[name="+bname+"]").val($(this).val());
		});		
	}	
	function checkClick(id, mode){
		var rid=id;
		if(mode == 1){
			//$("#allResource").jqxGrid('selectrow', rid);						
			$.ajax({
				url:getBaseURL()+"mms/issue/entry",
				type:"post",
				data:"rid="+rid+"&mode=pickList",
				dataType:"json",
				success:function(data, textStatus, jqXHR){
					
					var trlength = 	$("#matrixView thead tr th").length;	
					$.each(data['results'], function(i,v){
							var ai = oTable.fnAddData([v.Code+"<input type='hidden' name='resourceCode_"+v.ResourceId+"' id='resourceCode_"+v.ResourceId+"' value='"+v.Code+"'>",
												v.ResourceName+"<input type='hidden' name='resourceName_"+v.ResourceId+"' id='resourceName_"+v.ResourceId+"' value='"+v.ResourceName+"'>",
												v.UnitName+"<input type='hidden' name='unitName_"+v.ResourceId+"' id='unitName_"+v.ResourceId+"' value='"+v.UnitName+"'><input type='hidden' name='unitId_"+v.ResourceId+"' id='unitId_"+v.ResourceId+"' value='"+v.UnitId+" '>",
												"<input type='text' class='tbl_input changeVal' name='rate_"+v.ResourceId+"' id='rate_"+v.ResourceId+"' value=''>",
												"<input type='text' class='tbl_input changeVal' name='closing_quantity_"+v.ResourceId+"' id='closing_quantity_"+v.ResourceId+"' value=''>",
												"<input type='text' class='tbl_input changeVal' name='current_quantity_"+v.ResourceId+"' id='current_quantity_"+v.ResourceId+"'>",
												"<input type='text' class='tbl_input changeVal' name='remarks_"+v.ResourceId+"' id='remarks_"+v.ResourceId+"'>",
												"<input type='text' class='tbl_input totQuantity' value='"+parseFloat(0).toFixed(6)+"' "+((data['wbsResults'].length>0)?'readonly':'')+" name='quantity_"+v.ResourceId+"' id='quantity_"+v.ResourceId+"'>",
												]);	
												
							
							var n = oTable.fnSettings().aoData[ai[0]].nTr;
							n.setAttribute('id', v.ResourceId);
							n.setAttribute('class', 'mainTr deleteTr_'+v.ResourceId);
							//alert(JSON.stringify(n))
																
					$("#sequentialViewSub tbody:first").append("<tr res_id='"+v.ResourceId+"' class='deleteTr_"+v.ResourceId+" subTr_"+v.ResourceId+"' style=''>"+
																	"<td colspan=7>"+
																		"<div class='subDiv' style=''>"+
																			"<table class='table table-bordered table-hover col-lg-6 quanTable'>"+
																				"<thead>"+
																					"<tr>"+
																						"<th>WBS Name</th>"+
																						"<th>Quantity</th>"+
																					"</tr>"+
																				"</thead>"+
																				"<tbody>");

						/*Matrix view*/														
						$("#matrixView tbody").append("<tr res_id='"+v.ResourceId+"' id='quantityRow_"+v.ResourceId+"' class='deleteTr_"+v.ResourceId+" showData'>"+
															"<td class='headcol_l'>"+v.ResourceName+"<input type='hidden' name='resourceName_"+v.ResourceId+"' id='resourceName_"+v.ResourceId+"' value='"+v.ResourceName+"'>");
												
									$.each(data['wbsResults'], function(wbsi,wv){
										var style = 'display:none;';
										if($.inArray(wv.WbsId, allWbs) != -1)
												style="";
										
										
										
										$("#sequentialViewSub tbody:last").append("<tr style='"+((allWbs.length > 0)? style: '')+"'>"+
																					"<td width='76%'>"+wv.WbsName+" <input type='hidden' class='tbl_input' name='wbsName_"+v.ResourceId+"_"+wv.WbsId+"' value='"+wv.WbsName+"'></td>"+
																					"<td class='tbl_input_td' width='24%'><input type='text' resourceId='"+v.ResourceId+"' elename='quantity_"+v.ResourceId+"' class='tbl_input quantityVal' name='wbsQuantity_"+v.ResourceId+"_"+wv.WbsId+"' value='"+parseFloat(0).toFixed(6)+"' autocomplete='off'></td>"+
																				"</tr>");
									
																				
										$("#sequentialViewSub tbody:last").append("</tbody>"+
																			"</table>"+
																		"</div>"+
																	"</td>"+
																"</tr>");
																
																
										/*Matrix view*/
										if(trlength == 1){
											$("#matrixView thead tr").append("<th style='"+((allWbs.length > 0)? style: '')+"'><span data-placement='bottom' data-toggle='tooltip' data-original-title='"+wv.WbsName+"'>"+wv.WbsName+"</span></th>");
										}
										
										
										
										$("#matrixView tbody tr:last").append("<td class='tbl_input_td' style='"+((allWbs.length > 0)? style: '')+"'><input type='text' resourceId='"+v.ResourceId+"' elename='quantity_"+v.ResourceId+"' class='form-control quantityVal' name='wbsQuantity_"+v.ResourceId+"_"+wv.WbsId+"' value='"+parseFloat(0).toFixed(6)+"' autocomplete='off'></td>");
										
									});

						/*Matrix view*/				
						$("#matrixView tbody tr:last").append("<td class='bdr_left1ddd'>"+v.Code+"<input type='hidden' name='resourceCode_"+v.ResourceId+"' id='resourceCode_"+v.ResourceId+"' value='"+v.Code+"'></td>"+
																"<td class='bdr_left1ddd'>"+v.UnitName+"<input type='hidden' name='unitName_"+v.ResourceId+"' id='unitName_"+v.ResourceId+"' value='"+v.UnitName+"'>"+
																"<input type='hidden' name='unitId_"+v.ResourceId+"' id='unitId_"+v.ResourceId+"' value='"+v.UnitId+" '></td>"+
																"<td class='bdr_left1ddd'>"+"<input type='hidden' name='rate_"+v.ResourceId+"' id='rate_"+v.ResourceId+"' value='"+v.Rate+"'>"+
																"<td class='bdr_left1ddd'>"+"<input type='hidden' name='closing_quantity_"+v.ResourceId+"' id='closing_quantity_"+v.ResourceId+"' value=''>"+
																"<td class='bdr_left1ddd'>"+"<input type='hidden' name='current_quantity_"+v.ResourceId+"' id='current_quantity_"+v.ResourceId+"' value=''>"+
																"<td class='bdr_left1ddd'>"+"<input type='hidden' name='amount_"+v.ResourceId+"' id='amount_"+v.ResourceId+"' value=''>"+
																
																"<td class='all_remarks tbl_input_td'><input type='text' class='changeVal matrix_remarks_input' name='remarks_"+v.ResourceId+"' id='remarks_"+v.ResourceId+"'></td>"+
																"<td class='tbl_input_td'><input type='text' class='quantityCheck matrix_total_input' value='"+parseFloat(0).toFixed(6)+"' readonly name='quantity_"+v.ResourceId+"' id='quantity_"+v.ResourceId+"'></td>"+
															"</tr>");
															
										$("#mat_requireddate_"+v.ResourceId).datepicker({
											format: "dd-mm-yyyy",
											startDate: new Date(),
											todayBtn: true,
											orientation: "top auto",
											autoclose: true
										}).on("changeDate", function(e){
											if($(this).is(":visible"))
												oTable.$("tr.mainTr").find("input[name="+$(this).attr('name')+"]").datepicker("setDate", $(this).val());
										});
										
										oTable.$("tr.mainTr").find("#seq_requireddate_"+v.ResourceId).datepicker({
											format: "dd-mm-yyyy",
											startDate: new Date(),
											todayBtn: true,
											orientation: "top auto",
											autoclose: true
										}).on("changeDate", function(e){
											if($(this).is(":visible"))
												$("#matrixView input[name="+$(this).attr('name')+"]").datepicker("setDate", $(this).val());
										});								
									
					});
						// newly added line for spec
						$("#sequentialViewSub tr:last").append("<tr><td class='tbl_input_td'  colspan='2' width='100%'><input type='text' class='tbl_input' name='specs_s_"+rid+"' value='' resourceid='"+rid+"'/></td></tr>");

					if(trlength == 1)
						$("#matrixView thead tr").append("<th>Code</th><th>Unit</th><th class='all_date'>Date</th><th class='all_remarks'>Remarks</th><th>Total</th>");
					trClick();
				},
				complete:function(data){
					$('.date_icon').unbind("click");
					$(".changeVal").unbind("change");
				
					$('.date_icon').bind('click', function() {
						var input = $(this).parent().find('input').datepicker('show');
					});
					$(".changeVal").bind('change', function(){
						var bname = $(this).attr("name");
						$("input[name="+bname+"]").val($(this).val());
					});
				},
				error:function(jqXHR, textStatus, errorThrown){
					alert(textStatus+"-----"+errorThrown);
				}
			});
		}
		else{
			$("#sequentialViewSub .deleteTr_"+rid).remove();
			$("#matrixView .deleteTr_"+rid).remove();
			oTable.$("tr.deleteTr_"+rid).each(function(){
				var target_row = $(this).get(0); 
				var aPos = oTable.fnGetPosition(target_row); 
				oTable.fnDeleteRow(aPos);
			});
			//changePage();	
		}
	}
	$("input[name=customize]").change(function(){
		allWbs=[];
		$("#selected_wbs").prop("checked", false);
		var index1 = $('#wbsGrid').jqxGrid('selectedrowindexes'); 
		if(index1.length > 0)
			$('#wbsGrid').jqxGrid('clearselection');
		
		oTable.fnClearTable();
		$("#fifthStep table .subTable").html("");
		$("#fifthStep table .appendDataMatrix").html("");

		if($("#matrixView thead tr th").lenght != 1)
			$("#matrixView thead tr").html("<th class='headcol_l headcol_l1'>Resource <br />Description</th>");
	
		var index2 = $('#mostResource').jqxGrid('selectedrowindexes'); 
		if(index2.length > 0)
			$('#mostResource').jqxGrid('clearselection');

		var index3 = $('#recentResource').jqxGrid('selectedrowindexes'); 
		if(index3.length > 0)
			$('#recentResource').jqxGrid('clearselection');	

		var index1 = $('#allResource').jqxGrid('selectedrowindexes'); 
		if(index1.length > 0)
			$('#allResource').jqxGrid('clearselection');
	});
	$(".setting_check").click(function(){
		var id = $(this).attr("id");
		if(id == "selected_wbs"){
			$("#sequentialViewSub .subDiv tbody tr").hide();
			if($(this).is(":checked")){
				if($("#matrixView tbody tr").length > 0){
					$("#sequentialViewSub .subDiv tbody tr").hide();
					$("#matrixView tbody tr td:not(:last-child) input:text").prop("readonly", true);
				}
			}
			else{
				allWbs=[];
				if($("#matrixView tbody tr").length > 0){
					$("#sequentialViewSub .subDiv tbody tr").show();
					$("#matrixView tbody tr td:not(:last-child) input:text").prop("readonly", false);
				}
				
				$("#sel_wbsId").val("none");
				var index1 = $('#wbsGrid').jqxGrid('selectedrowindexes'); 
				if(index1.length > 0)
					$('#wbsGrid').jqxGrid('clearselection');
			}
		}
	});
	$("#continueButton").click(function(){
		$(".error_message").hide();
		if($("#zerothStep").is(":visible")){
			bool=false;
			if($("#issue_no").val() == ""){
				$("#issue_no").closest(".req_flds").find(".error_message").show();
				bool=false;
			}
			else if($("#issue_date").val() == ""){
				$("#issue_date").closest(".req_flds").find(".error_message").show();
				bool=false;
			}
			else{
				   $("#zerothStep").hide();
					$("#firstStep").show();
					$("#backButton").show();
                    $("#excludeFirst").hide();					
					
				}
		}
		else if($("#firstStep").is(":visible")){
			bool=false;
			
			if($("#proj_name").val() == null || $("#proj_name").val()== "" ){
				
				$("#proj_name").closest(".req_flds").find(".error_message").show();
				bool=false;				
			}
			else if($("#issue_type").val() == null || $("#issue_type").val()==""){
				
				$("#issue_type").closest(".req_flds").find(".error_message").show();
				bool=false;				
			}			
			else if($('#contractor').is(":visible") && $("#contractor").val()==""){
				$("#contractor").closest(".req_flds").find(".error_message").show();
				$("#contractor").focus();
				bool=false;
			}
			else if($("#issue").val() == null || $("#issue").val()==""){
				$("#issue").closest("div").find(".error_message").show();
				$("#issue").focus();
				bool=false;
			}
			  else{
				  var sname = $("#proj_name option:selected").text();
				   var iname = $("#issue_type option:selected").text();
				   var ename = $("#contractor option:selected").text();
				   var tname = $("#issue option:selected").text();
				    $('p#projectSpan').text(sname);
				    $('p#materialSpan').text(iname);
				    $('p#dateSpan').text(ename);
				    $('p#prioritySpan').text(tname);
				   $("#excludeFirst").show();
					$("#firstStep").hide();
					$("#fourthStep").show();
					$("#backButton").show();	
					pageNext();
				}				
			}			
			
		else if($("#fourthStep").is(":visible")){
			var index = $('#allResource').jqxGrid('getselectedrowindex');
		
			if(index==-1){
				alert('Atleast select one Resource')
			}
			else{
				oTable.fnSetColumnVis(3, true);
				oTable.fnSetColumnVis(4, true);
				$(".all_remarks").show();
				$(".all_date").show();
				
				resourceId=[];
				var index = $("#allResource").jqxGrid("getselectedrowindexes");
				
				for(var i in index){
					resourceId.push($("#allResource").jqxGrid("getrowid", index[i]));
				}
				
				$("#resourceId").val(resourceId);
				//alert(JSON.stringify(resourceId))
				$("#fourthStep").hide();
				$("#fifthStep").show();
				
				if($("#all_remarks").is(":checked")){
					oTable.fnSetColumnVis(4, false);
					$(".all_remarks").hide();
				}
				if($("#all_date").is(":checked")){
					oTable.fnSetColumnVis(3, false);
					$(".all_date").hide();
				}
				$("#continueButton a").text("Submit");
				
				//oTable.$("tr.mainTr").find(".totQuantity").trigger("click");
				if(!$('#sequentialView_next').hasClass('disabled') && $('#sequentialViewDiv').is(':visible'))
					$("#continueButton a").text("Continue");
			}
		}
		else if($("#fifthStep").is(":visible")){
			if(!$('#sequentialView_next').hasClass('disabled')){
				$('#sequentialView_next').trigger('click');
				if($('#sequentialView_next').hasClass('disabled'))
					$("#continueButton a").text("Submit");
			}
			else{
				$("form").submit();
			}
		}
	});

	$("#backButton").click(function(){
		if($("#firstStep").is(":visible")){
			$("#firstStep").hide();
			$("#zerothStep").show();
			$("#backButton").hide();
			$("#excludeFirst").hide();
		}
		
		if($("#secondStep").is(":visible")){
			$("#secondStep").hide();
			$("#firstStep").show();
			$("#backButton").hide();
			$("#excludeFirst").hide();
		}
		if($("#thirdStep").is(":visible")){
			$("#thirdStep").hide();
			$("#secondStep").show();
		}
		if($("#fourthStep").is(":visible")){
			$("#fourthStep").hide();
			if($("#selected_wbs").is(":checked")){
				$("#thirdStep").show();
			}
			else if($("input[name=customize]:checked").val() == 1){
				$("#secondStep").show();
			}
			else{
				$("#firstStep").show();
				$("#backButton").hide();
				$("#excludeFirst").hide();
			}
		}
		else if($("#fifthStep").is(":visible")){
			$("#continueButton a").text("Continue");	
			$("#fifthStep").hide();
			$("#fourthStep").show();
		}
	});


    // Initialize ajax autocomplete:
	var project = $('#project_name').select2();
	var type = $('#request_type').select2();
	
  /*grid start*/
	var sourceAllRes =
	{
		localData: [],
		dataType: "json",
		dataFields:
		[
			
			{ name: 'Code', type: 'string' },
			{ name: 'ResourceName', type: 'string' },
			//{ name: 'ResourceGroupName', type: 'string' }
			
		],
		id:'ResourceId'
	};

	var dataAdapterAllRes = new $.jqx.dataAdapter(sourceAllRes,{
		autoBind: true,
		loadComplete: function (data) {
			
		},
		loadError: function (xhr, status, error) {
			
		}
	});
  
	$("#allResource").jqxGrid({
		width: '100%',
		pageable: true,
		selectionMode: 'singleRow',
		pagerButtonsCount: 6,
		autoheight:true,
		//rowsheight:60,
		autorowheight: true,
		filterable: true,
		sortable: true,
		//filtermode: 'advanced',				
		columnsResize: true,
		showfilterrow: true,
		ready: function(){
			
			var localizationobj = {};
			localizationobj.emptydatastring = "No resource to display";
			$("#allResource").jqxGrid('localizestrings', localizationobj);
		},
		selectionmode: 'checkbox',						
		source: dataAdapterAllRes,
		columns: [
					
				  { text: 'Code', editable: false,datafield: 'Code'},
				  { text: 'ResourceName', editable: false,datafield: 'ResourceName'},
				 // { text: 'ResourceGroupName', editable: false,datafield: 'ResourceGroupName'}
		  
		]
	});
	
	$("#allResource").on('rowselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row; 
			var rid = rowData.uid;
		
			checkClick(rid, '1');	
			var mindex = $('#mostResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#mostResource').jqxGrid('selectrow', mindex);
			var rindex = $('#recentResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#recentResource').jqxGrid('selectrow', rindex);							
		}
		
	});	

	$('#allResource').on('rowunselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row;
			var rid = rowData.uid;
			
			checkClick(rid, '2');
			var mindex = $('#mostResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#mostResource').jqxGrid('unselectrow', mindex);
			var rindex = $('#recentResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#recentResource').jqxGrid('unselectrow', rindex);	
		}								
	});
	$('#allResource').on('rowclick', function (event){
		var args = event.args;
		// row's bound index.
		var boundIndex = args.rowindex;
		var index = $('#allResource').jqxGrid('selectedrowindexes'); 
		//alert($.inArray(boundIndex, index))
		if($.inArray(boundIndex, index) == -1)
			$('#allResource').jqxGrid('selectrow', boundIndex);
		else
			$('#allResource').jqxGrid('unselectrow', boundIndex);
	});					


	/*2.mostResource*/
	var sourceMostRes =
	{
		localData: [],
		dataType: "json",
		dataFields:
		[
			
			{ name: 'Code', type: 'string' },
			{ name: 'ResourceName', type: 'string' },
			//{ name: 'ResourceGroupName', type: 'string' }
			
		],
		id:'ResourceId'
	};

	var dataAdapterMostRes = new $.jqx.dataAdapter(sourceMostRes,{
		autoBind: true,
		loadComplete: function (data) {
			
		},
		loadError: function (xhr, status, error) {
			
		}						
	
	});

	$("#mostResource").jqxGrid({
		width: '100%',
		pageable: true,
		selectionMode: 'singleRow',
		pagerButtonsCount: 6,
		autoheight:true,
		//rowsheight:60,
		autorowheight: true,
		filterable: true,
		sortable: true,
		//filtermode: 'advanced',				
		columnsResize: true,
		showfilterrow: true,
		ready: function(){
			var localizationobj = {};
			localizationobj.emptydatastring = "No resource to display";
			$("#mostResource").jqxGrid('localizestrings', localizationobj);
		},							
		selectionmode: 'checkbox',						
		source: dataAdapterMostRes,
		columns: [
					
				  { text: 'Code', editable: false,datafield: 'Code'},
				  { text: 'ResourceName', editable: false,datafield: 'ResourceName'},
				 // { text: 'ResourceGroupName', editable: false,datafield: 'ResourceGroupName'}
		  
		]
	});
	


	$("#mostResource").on('rowselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row; 
			var rid = rowData.uid;
			checkClick(rid, '1');
			var mindex = $('#allResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#allResource').jqxGrid('selectrow', mindex);
			var rindex = $('#recentResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#recentResource').jqxGrid('selectrow', rindex);			
		}								
	});	

	$('#mostResource').on('rowunselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row;
			var rid = rowData.uid;
			checkClick(rid, '2');
			var mindex = $('#allResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#allResource').jqxGrid('unselectrow', mindex);
			var rindex = $('#recentResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#recentResource').jqxGrid('unselectrow', rindex);
		}								
	});

	$('#mostResource').on('rowclick', function (event){
		var args = event.args;
		// row's bound index.
		var boundIndex = args.rowindex;
		var index = $('#mostResource').jqxGrid('selectedrowindexes'); 
		//alert($.inArray(boundIndex, index))
		if($.inArray(boundIndex, index) == -1)
			$('#mostResource').jqxGrid('selectrow', boundIndex);
		else
			$('#mostResource').jqxGrid('unselectrow', boundIndex);
	});						

	/*3.recentResource*/
	var sourceRecentRes =
	{
		localData: [],
		dataType: "json",
		dataFields:
		[
			
			{ name: 'Code', type: 'string' },
			{ name: 'ResourceName', type: 'string' },
			{ name: 'ResourceGroupName', type: 'string' }
			
		],
		id:'ResourceId'
	};

	var dataAdapterRecentRes = new $.jqx.dataAdapter(sourceRecentRes,{
		autoBind: true,
		loadComplete: function (data) {
			
		},
		loadError: function (xhr, status, error) {
			
		}						
	});

	$("#recentResource").jqxGrid({
		width: '100%',
		pageable: true,
		selectionMode: 'singleRow',
		pagerButtonsCount: 6,
		autoheight:true,
		//rowsheight:60,
		autorowheight: true,
		filterable: true,
		sortable: true,
		//filtermode: 'advanced',				
		columnsResize: true,
		showfilterrow: true,
		ready: function(){
			var localizationobj = {};
			localizationobj.emptydatastring = "No resource to display";
			$("#recentResource").jqxGrid('localizestrings', localizationobj);
		},								
		selectionmode: 'checkbox',						
		source: dataAdapterRecentRes,
		columns: [
					
				  { text: 'Code', editable: false,datafield: 'Code'},
				  { text: 'ResourceName', editable: false,datafield: 'ResourceName'},
				 // { text: 'ResourceGroupName', editable: false,datafield: 'ResourceGroupName'}
		  
		]
	});
	

	
	$("#recentResource").on('rowselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row; 
			var rid = rowData.uid;
			checkClick(rid, '1');	
			var mindex = $('#allResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#allResource').jqxGrid('selectrow', mindex);
			var rindex = $('#mostResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#mostResource').jqxGrid('selectrow', rindex);	
		}								
	});	

	$('#recentResource').on('rowunselect', function (event){
		if($(this).is(":visible")){
			// event arguments.
			var args = event.args;
			// row's bound index.
			var rowBoundIndex = args.rowindex;
			// row's data. The row's data object or null(when all rows are being selected or unselected with a single action). If you have a datafield called "firstName", to access the row's firstName, use var firstName = rowData.firstName;
			var rowData = args.row;
			var rid = rowData.uid;
			checkClick(rid, '2');
			var mindex = $('#allResource').jqxGrid('getrowboundindexbyid', rid);
			if(mindex!=-1)
				$('#allResource').jqxGrid('unselectrow', mindex);
			var rindex = $('#mostResource').jqxGrid('getrowboundindexbyid', rid);
			if(rindex!=-1)
				$('#mostResource').jqxGrid('unselectrow', rindex);		
		}								
	});

	$('#recentResource').on('rowclick', function (event){
		var args = event.args;
		// row's bound index.
		var boundIndex = args.rowindex;
		var index = $('#recentResource').jqxGrid('selectedrowindexes'); 
		//alert($.inArray(boundIndex, index))
		if($.inArray(boundIndex, index) == -1)
			$('#recentResource').jqxGrid('selectrow', boundIndex);
		else
			$('#recentResource').jqxGrid('unselectrow', boundIndex);
	});							

						

	/*grid end*/
	function pageNext(){
		//alert(JSON.stringify(formData))
		$("#navbar li:first a").trigger("click");
		request = $('#proj_name').val();
		if(request != requestold){
			oTable.fnClearTable();
			$("#fifthStep table .subTable").html("");
			$("#fifthStep table .appendDataMatrix").html("");			
			
			var formData = $("form").serializeArray();
			formData.push({name:"mode", value:"firstStep"});
			requestold = request;
			//$('.loading_area').show();
			$("#allResource").jqxGrid("showloadelement");
	
			$.ajax({
				url:getBaseURL()+"mms/issue/entry",
				type:"post",
				data:formData,
				dataType:"json",
				success:function(data, textStatus, jqXHR){
			       sourceAllRes.localdata = data;
				   dataAdapterAllRes.dataBind();
					$('#allResource').jqxGrid({ source: dataAdapterAllRes});
					
					sourceMostRes.localdata = data
					dataAdapterMostRes.dataBind();
					//$('#mostResource').jqxGrid({ source: dataAdapterMostRes,selectedrowindexes: [] });

					sourceRecentRes.localdata = data;
					dataAdapterRecentRes.dataBind();
					//$('#recentResource').jqxGrid({ source: dataAdapterRecentRes, selectedrowindexes: [] });

					var index1 = $('#allResource').jqxGrid('selectedrowindexes'); 
					if(index1.length > 0)
						$('#allResource').jqxGrid('clearselection');
					
					var index2 = $('#mostResource').jqxGrid('selectedrowindexes'); 
					if(index2.length > 0)
						$('#mostResource').jqxGrid('clearselection');

					var index3 = $('#recentResource').jqxGrid('selectedrowindexes'); 
					if(index3.length > 0)
						$('#recentResource').jqxGrid('clearselection');					
				},
				complete:function(data){
					/* $('.loading_area').fadeOut(1000, function() {
						$(this).hide();
					}); */
					$("#allResource").jqxGrid("hideloadelement");
					
				},
				error:function(jqXHR, textStatus, errorThrown){
					alert(textStatus+"-----"+errorThrown);
				}
			});
		}
	}
	
	$('#issue_type').on('change', function() {
        var sname = $("#issue_type option:selected").text();
        if(sname=='Contractor'){
            $('#contract').show();
        } else {
            $('#contract').hide();
        }
    }).change();

</script>