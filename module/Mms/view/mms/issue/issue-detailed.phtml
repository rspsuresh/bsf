<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />
	
<style type="text/css">
	.mar_20{margin-top:20px!important;}
	.sub_tbl1 {color:#424141;font-weight: 600; background:#edefe2 !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{background : #e6bfcb !important;}
    .sub_tbl3{color: #424141;font-weight: 600; background: #ceefe5 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
	.top-30 {padding-top: 15px !important; padding-bottom: 15px !important; }
	.blubg{background : #B0C3EB !important;}
	.card{margin-top:0% !important; margin-bottom:0px !important;}
	.top-10 { margin-top:10px!important;}
	.sub_tab {background-color: #e7e9ec;border: 1px solid #ddd;float: left;margin-top: 2px;padding:8px;width:100%;}
	.subDiv{background-color:#fff!important;border:0px !important;}
	.btnPrev:disabled {background-color:#ffffff;}
</style>

<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 mar_20">
                <h1>Issue Detail<span class="edit_symbl">_<?php echo $IssueNo; ?></span>&nbsp;&nbsp;</h1>
            </div>
			
			<div class="col-lg-12 top_ct">
				<div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear">
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="ProjectName">
						<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status3">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-bandcamp fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $ProjectName; ?></div>
										<div class="cbhuge comnelips">Cost Centre</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="IssueNo">
						<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-certificate fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $IssueNo; ?></div>
										<div class="cbhuge comnelips">Issue No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="issue_datess">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $issue_datess; ?></div>
										<div class="cbhuge comnelips">Issue Date</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="contractor">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $contractorName; ?></div>
										<div class="cbhuge comnelips">Contractor</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CINo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $CINo; ?></div>
										<div class="cbhuge comnelips">CIssue No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CCINo">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status2">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-calendar fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $CCINo; ?></div>
										<div class="cbhuge comnelips">CCIssue No</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="issue_typename">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status5">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-registered fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $issue_typename; ?></div>
										<div class="cbhuge comnelips">Issue Type</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="issue">
						<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status6">
							<div class="padding-none">
								<div class="row">
									<div class="col-xs-3">
										<i class="fa fa-money fa-5x cbpln-status-icon"></i>
									</div>
									<div class="col-xs-9 text-right">
										<div class="cbhuge comnelips fntwt600"><?php echo $issue; ?></div>
										<div class="cbhuge comnelips">Issue</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="col-lg-12 clear top-20">
                <div id="accordion" class="panel-group">
                    <?php if($issue=="issue"){?>
                        <div class="panel panel-info">
                            <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                                <h4 class="panel-title accordion-toggle defa_panels">Issue Quantity</h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                                <div class="panel-body bgcolr">
                                    <div class="col-lg-12">
                                        <div class="table-responsive top-10">
                                            <table class="table" style=" margin-bottom:10px;" id="workorderTable">
                                                <thead>
                                                <tr>
                                                    <th class="blubg">Code</th>
                                                    <th class="blubg">Resource</th>
                                                    <th class="blubg" style="text-align:center">F/C</th>
                                                    <th class="blubg">Unit</th>
                                                    <th class="blubg" style="text-align:center">Qty</th>
                                                    <th class="blubg" style="text-align:center">Rate</th>
                                                    <th class="blubg" style="text-align:center">Amount</th>
                                                    <th class="blubg" style="text-align:center">Remarks</th>
                                                    <th class="blubg" style="text-align:center">Issue A/C</th>
                                                    <th class="blubg" style="text-align:center">Purchase A/C</th>
                                                    <th class="blubg">&nbsp;</th>
                                                </tr>
                                                </thead>
                                                <tbody class="main"></tbody>
                                            </table>
                                            <input type="hidden" name="rowid" id="rowid" value="0"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php }else{?>
                        <div class="panel panel-info">
                            <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                                <h4 class="panel-title accordion-toggle defa_panels">Return Quantity</h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                                <div class="panel-body bgcolr">
                                    <div class="col-lg-12">
                                        <div class="table-responsive top-10">
                                            <table class="table" style=" margin-bottom:10px;" id="workorderTable">
                                                <thead>
                                                <tr>
                                                    <th class="blubg">Code</th>
                                                    <th class="blubg">Desc</th>
                                                    <th class="blubg" style="text-align:center">Qty</th>
                                                    <th class="blubg">Unit</th>
                                                    <th class="blubg" style="text-align:center">Rate</th>
                                                    <th class="blubg" style="text-align:center">Amount</th>
                                                    <th class="blubg" style="text-align:center">F/C</th>
                                                    <th class="blubg" style="text-align:center">Remarks</th>
                                                    <th class="blubg" style="text-align:center">Issue A/C</th>
                                                    <th class="blubg" style="text-align:center">Purchase A/C</th>
                                                    <th class="blubg">&nbsp;</th>
                                                </tr>
                                                </thead>
                                                <tbody class="main"></tbody>
                                            </table>
                                            <input type="hidden" name="rowid" id="rowid" value="0"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php }?>

                    <!-------------------------------Bill of Quantities end------------------------------->
                    <!-------------------------------Terms and Condition------------------------------->

                    <div class="panel panel-info" id="nar">
                        <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
                            <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
                        </div>
                        <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
                            <div class="panel-body bgcolr">
                                <div class="clearfix"></div>
                                <div class="col-lg-12">
                                    <div class="card">
                                        <ul class="nav nav-tabs">
                                            <li><a href="#Note" aria-controls="settings" role="tab" data-toggle="tab">Narration</a></li>
                                        </ul>
                                        <div class="tab-pane" id="Note">
                                            <p>
                                            <div class="col-lg-12 sub_tab">
                                                <?php
                                                if($Narration != ''){
                                                    ?>
                                                    <textarea class="exp-tex btnPrev" name="Notes" id="Notes" disabled > <?php echo ($Narration != '') ? $Narration : 'Enter Your Notes.......';?> </textarea>
                                                <?php }else{ ?>
                                                    <textarea class="exp-tex" name="Notes" id="Notes" placeholder="Enter your Notes..." disabled ></textarea>
                                                <?php } ?>
                                            </div>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-------------------------------Terms and Condition------------------------------->
			
        </div>
    </div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r">
            <a href="<?php echo $this->basePath("/mms/issue/issue-register");?>" class="ripple">Close</a>
        </li>
    </ul>
</div>
<script id="resource-template"  type="text/template" class="hide">
    <?php if($issue=="issue"){
    ?>
    <tr id="click__" onclick="clickTr(this);" class="count-tr">
        <td class="mar_20 border_none" width="10%" name="code__" id="code__"></td>
        <td width="20%" name="desc__" id="desc__" class="border_none">
            <input type="hidden" name="resourceid__" id="resourceid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="9%" class="border-none">
            <select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="FC__" id="FC__">
                <option value="C">Chargeable</option>
                <option value="F">Free</option>
            </select>
        </td>
        <td width="7%" name="unitname__" id="unitname__" class="border-none">
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td width="8%" style="text-align:right"  name="qty__" id="qty__" class="border-none"></td>
        <td width="8%" style="text-align:right" name="rate__" id="rate__" class="border-none"></td>
        <td width="8%" style="text-align:right" name="amount__" id="amount__" class="border-none"></td>
        <td width="8%" name="remarks__" id="remarks__" class="border-none"></td>
        <td width="8%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="issueAccount__" id="issueAccount__"></select>
		</td>
        <td width="12%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="PurchaseAccount__" id="PurchaseAccount__"></select>
		</td>
        <td width="2%" align="center" class="action_btns_td border-none">
            <ul class="action_btns">
                <li> <a  class="mainTr" id="expandTr__" style="display:none;cursor:pointer;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>

    <tr style="display:none;" id="click1__"  class="subTr count-tr">
        <td colspan="12" style="padding:0px !important; ">
            <div class="subDiv" style="margin-bottom:10px;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="showtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> WBS<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li class=""><a class="ripple has-ripple" id="whTableLink__" onclick="showtabs('wh',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Warehouse<span class="ripple-wrapper animated"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
					<div class="tab-content">
						<div class="table-responsive table-bordered  sub_tab">
							<table class="table table-bordered " style="margin-bottom:0px;" id="iowTable__">
								<thead>
								<tr>
									<th width="50%" class="sub_tbl3">WBS Name</th>
									<th width="50%" class="sub_tbl3" style="text-align:center">WBS Qty</th>
									<th class="sub_tbl3"></th>
								</tr>
								</thead>
								<tbody class="main"></tbody>
								<tbody class="total">
									<!--<tr>
										<td width="10%">
											<input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/>
										</td>
									</tr>-->
								</tbody>
								<input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
							</table>
							<table class="table table-bordered " style="margin-bottom:0px; display:none;" id="whTable__">
								<thead>
								<tr>
									<th class="worktype-activity sub_tbl2">Warehouse Name </th>
									<th class="worktype-activity sub_tbl2">Description </th>
									<th class="worktype-activity sub_tbl2">ClosingStock </th>
									<th class="worktype-activity sub_tbl2">Qty </th>
									<th class="sub_tbl2">&nbsp;</th>
								</tr>
								</thead>
								<tbody class="main"></tbody>
								<tbody class="total">
								</tbody>
								<input type="hidden" name="wh___rowid" id="wh___rowid" value="0"/>
							</table>
							<div class="tab-content">
								<div class="table-responsive topsp">
									<table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">
										<tbody class="main"></tbody>
										<tbody class="total">
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
                </div>
            </div>
        </td>
    </tr>
</script>

<script id="iow-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="25%">
            <input  type="text" name="wh___warehousename_0" id="wh___warehousename_0" />
            <input type="hidden" name="wh___warehouseid_0" id="wh___warehouseid_0"/>
            <input  type="hidden" name="wh___stockid_0" id="wh___stockid_0" />
        </td>
        <td width="25%">
            <input  type="text" name="wh___desc_0" id="wh___desc_0" readonly/>
        </td>
        <td width="25%">
            <input  type="text" name="wh___closingstock_0" id="wh___closingstock_0"  readonly/>
        </td>
        <td width="25%">
            <input class="parent_text chqty" type="text" name="wh___qty_0" id="wh___qty_0" style="text-align: right;" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)" onchange="checkWHQuantity(this);" />
            <input type="hidden" name="iow__hiddenqty_0" id="iow__hiddenqty_0" value="0"/>
        </td>
    </tr>
</script>
<script id="wbs-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="20%" name="wh___wbs_0_warehousename__7" id="wh___wbs_0_warehousename__7">
            <input type="hidden" name="wh___wbs_0_warehouseid__7" id="wh___wbs_0_warehouseid__7"/>
            <input  type="hidden" name="wh___wbs_0_stockid__7" id="wh___wbs_0_stockid__7" />
        </td>
        <td width="20%" name="wh___wbs_0_desc__7" id="wh___wbs_0_desc__7"></td>
        <td width="20%" name="wh___wbs_0_closingstock__7" id="wh___wbs_0_closingstock__7"></td>
        <td width="20%" name="wh___wbs_0_qty__7" id="wh___wbs_0_qty__7" style="text-align:center;">
            <input type="hidden" name="wh___wbs_0_hiddenqty__7" id="wh___wbs_0_hiddenqty__7" value="0"/>
        </td>
    </tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="30%" name="iow___wbsname_0" id="iow___wbsname_0" class="border-none">
            <input type="hidden"  name="iow___wbsid_0" id="iow___wbsid_0" readonly/>
        </td>
        <td width="25%" style="text-align:center" name="iow___qty_0" id="iow___qty_0" class="border-none">
            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0" value="0"/>
        </td>
		<td width="2%" align="center" class="action_btns_td border-none iow___requestfields" style="display:none;">
            <ul class="action_btns">
                <li> <a  class="mainTr" style="display:show;cursor:pointer;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr dont-hide">
        <td colspan="9" style="padding:0px !important;">
            <div class="subDiv" style="margin-bottom:10px; margin-left:10px;">
                <div class="table-responsive sub_tab">
                    <table class="table table-bordered " style="margin-bottom:0px;" id="whTable___wbs_0_whreqno">
                        <thead>
                        <tr>
                            <th class="worktype-activity sub_tbl2">Warehouse Name </th>
                            <th class="worktype-activity sub_tbl2">Description </th>
                            <th class="worktype-activity sub_tbl2">ClosingStock </th>
                            <th class="worktype-activity sub_tbl2" style="text-align:center">Qty </th>
                            <th class="sub_tbl2" style="display: none;">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="ware"></tbody>
                        <tbody class="total">
                        </tbody>
                    </table>
                    <input type="hidden" name="wh___wbs_0_wrowid" id="wh___wbs_0_wrowid" value="0"/>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="techtitle-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="15%"><input class="parent_text" type="text" name="techTitle__" id="techTitle__" maxlength="155" onchange="addNewTechRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="techDesc__" id="techDesc__"></textarea></td>
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTechTr__" onclick="deleteTech(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul>
        </td>
    </tr>
    <?php }
    else{
		?>
    <tr id="click__" class="count-tr border-none">
		<td class="mar_20 border_none" width="9%" name="code__" id="code__"></td>
        <td width="15%" name="desc__" id="desc__" class="border-none">
            <input type="hidden" name="resourceid__" id="resourceid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="12%" style="text-align:right" name="qty__" id="qty__" class="border-none"></td>
        <td width="8%" name="unitname__" id="unitname__" class="border-none">
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td width="8%" name="rate__" id="rate__" class="border-none" style="text-align:right"></td>
        <td width="9%" name="amount__" id="amount__" class="border-none" style="text-align:right"></td>
        <td width="10%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="FC__" id="FC__">
                <option value="C">Chargeable</option>
                <option value="F">Free</option>
			</select>
		</td>

        <td width="8%" name="remarks__" id="remarks__" class="border-none"></td>
        <td width="10%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="issueAccount__" id="issueAccount__"></select>
		</td>
        <td width="10%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="PurchaseAccount__" id="PurchaseAccount__"></select>
		</td>
        <td width="9%" align="center" class="action_btns_td border-none">
            <ul class="action_btns">
                <li> <a class="mainTr" id="expandTr__" style="display:none;cursor:pointer;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>

    <tr id="subTr__"style="display:none;" class="subTr count-tr">
        <td colspan="12" style="padding:0px !important; ">
            <div class="subDiv" style="margin-bottom:10px;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:0px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="navtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Return<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="tab-content">
                        <div class="table-responsive topsp sub_tab">
                            <table class="table table-bordered" style="margin-bottom:5px;" id="iowTables__">
                                <thead>
                                <tr>
                                    <th class="sub_tbl3" width="20%">Issue No</th>
                                    <th class="sub_tbl3" width="20%">Issue Date</th>
                                    <th class="sub_tbl3" width="10%" style="text-align:center">IssueQty</th>
                                    <th class="sub_tbl3" width="10%" style="text-align:center">Bal Issue Qty</th>
                                    <th class="sub_tbl3" width="10%" style="text-align:center">Rate</th>
                                    <th class="sub_tbl3" width="20%" style="text-align:center">Return Qty</th>
                                    <th class="sub_tbl3" width="10%" style="text-align:center">Adjustment Qty</th>
                                    <th class="sub_tbl3" style="text-align:center"></th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
									<!--<tr>
										<td width="10%">
											<input class="parent_text border-none" type="hidden" name="totalqty__" id="totalqty__" readonly/>
										</td>
									</tr>-->
                                </tbody>
                                <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>

<script id="issue-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide" >
        <td width="10%" name="wh___wbs_0_warehousename__7" id="wh___wbs_0_warehousename__7">
            <input type="hidden" name="wh___wbs_0_warehouseid__7" id="wh___wbs_0_warehouseid__7"/>
            <input  type="hidden" name="wh___wbs_0_stockid__7" id="wh___wbs_0_stockid__7" />
        </td>
        <td width="10%" name="wh___wbs_0_desc__7" id="wh___wbs_0_desc__7"> </td>
        <td width="10%" name="wh___wbs_0_issueqty__7" id="wh___wbs_0_issueqty__7" style="text-align:right;"></td>
        <td width="10%" name="wh___wbs_0_bissueqty__7" id="wh___wbs_0_bissueqty__7" style="text-align:right;"></td>
        <td width="10%" name="wh___wbs_0_qty__7" id="wh___wbs_0_qty__7" style="text-align:right;">
            <input type="hidden" name="wh___wbs_0_hiddenqty__7" id="wh___wbs_0_hiddenqty__7" value="0"/>
        </td>
        <td width="10%" name="wh___wbs_0_adqty__7" id="wh___wbs_0_adqty__7" style="text-align:right;">
            <input type="hidden" name="wh___wbs_0_hiddenadqty__7" id="wh___wbs_0_hiddenadqty__7" value="0"/>
        </td>
    </tr>
</script>

<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="15%" name="iow___issueNo_0"  id="iow___issueNo_0" class="border-none">
            <input class="parent_text" type="hidden"  name="iow___TransId_0"  id="iow___TransId_0" />
        </td>
        <td width="15%" name="iow___IssueDate_0" id="iow___IssueDate_0" class="border-none"></td>
        <td width="15%" name="iow___IssueQty_0" id="iow___IssueQty_0" class="border-none" style="text-align:right"></td>
        <td width="15%" name="iow___BalQty_0" id="iow___BalQty_0" class="border-none" style="text-align:right"></td>
        <td width="15%"  name="iow___Rate_0" id="iow___Rate_0" class="border-none" style="text-align:right"></td>
        <td width="15%" name="iow___ReturnQty_0" id="iow___ReturnQty_0" class="border-none" style="text-align:right"></td>
        <td width="10%" name="iow___AdjustmentQty_0" id="iow___AdjustmentQty_0" class="border-none" style="text-align:right"></td>
		<td width="9%" align="center" class="action_btns_td border-none iow___requestfields" style="display:none;">
            <ul class="action_btns">
                <li> <a class="mainTr" style="cursor:pointer;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr  dont-hide">
        <td colspan="9" style="padding:0px !important;">
            <div class="subDiv" style="margin-bottom:10px; margin-left:10px;">
                <div class="table-responsive sub_tab">
                    <table class="table table-bordered" style="margin-bottom:0px;" id="whTable___wbs_0_whreqno">
                        <thead>
                        <tr>
                            <th class="worktype-activity sub_tbl2">Warehouse Name </th>
                            <th class="worktype-activity sub_tbl2">Description </th>
                            <th class="worktype-activity sub_tbl2" style="text-align:center;">IssueQty </th>
                            <th class="worktype-activity sub_tbl2"  style="text-align:center;">BalIssueQty </th>
                            <th class="worktype-activity sub_tbl2"  style="text-align:center;">Qty </th>
                            <th class="worktype-activity sub_tbl2"  style="text-align:center;">AdjustmentQty</th>
                            <th class="sub_tbl2" style="display: none;">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="ware"></tbody>
                        <tbody class="total">
                        </tbody>

                    </table>
                    <input type="hidden" name="wh___wbs_0_wrowid" id="wh___wbs_0_wrowid" value="0"/>
                </div>
            </div>
        </td>
    </tr>
</script>

<script id="techtitle-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="15%"><input class="parent_text" type="text" name="techTitle__" id="techTitle__" maxlength="155" onchange="addNewTechRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="techDesc__" id="techDesc__"></textarea></td>
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTechTr__" onclick="deleteTech(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul>
        </td>
    </tr>
    <?php }?>
</script>

<script type="text/javascript">
// var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
// var tmp_arr_resources = arr_resources;
var arr_wbs = <?php echo (isset($arr_res_wbs)) ? json_encode($arr_res_wbs) : '[]';?>;
var issue = <?php echo (isset($issue)) ? json_encode($issue) : '';?>;
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_accountType = <?php echo (isset($arr_accountType)) ? json_encode($arr_accountType) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_sel_warehouse = <?php echo (isset($arr_sel_warehouse)) ? json_encode($arr_sel_warehouse) : '[]';?>;
var arr_wbs_warehouse = <?php echo (isset($arr_wbs_warehouse)) ? json_encode($arr_wbs_warehouse) : '[]';?>;
var arr_selwbs_warehouse = <?php echo (isset($arr_selwbs_warehouse)) ? json_encode($arr_selwbs_warehouse) : '[]';?>;
var arr_resel_warehouse = <?php echo (isset($arr_resel_warehouse)) ? json_encode($arr_resel_warehouse) : '[]';?>;
var arr_resel_iswarehouse = <?php echo (isset($arr_resel_iswarehouse)) ? json_encode($arr_resel_iswarehouse) : '[]';?>;
var arr_resource_closingstock = <?php echo (isset($arr_resource_closingstock)) ? json_encode($arr_resource_closingstock) : '[]';?>;
var mode = <?php echo $IssueRegisterId; ?>;


if(issue == "issue")
{ 
    ///////////////////////////////////////////   ISSUE     /////////////////////////////////////
    $(function () {
        var $rowid = $('#rowid');
        var template = $('#resource-template').html();
        var iowtemplate = $('#iow-template').html();
        var waretemplate = $('#iow-warehouse').html();
        var requestTemplate = $('#wbs-warehouse').html();
        var rowid = 0;
        var $tbody = $('#workorderTable').find('> tbody.main');

        if (arr_requestResources.length != 0) {
            $.each(arr_requestResources, function (i, o) {
                rowid += 1;
                $tbody.append(template.replace(/__/g, '_' + rowid));
                var opt = '<option></option>';
                if (arr_accountType.length > 0) {
                    $.each(arr_accountType, function (j, p) {
                        opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
                    });
                }
                $('#PurchaseAccount_' + rowid).html(opt);
                $('#issueAccount_' + rowid).html(opt);

                $('#code_' + rowid).html(o.Code);
                $('#desc_' + rowid).html(o.ResourceName);
                $('#resourceid_' + rowid).val(o.ResourceId);
                $('#itemid_' + rowid).val(o.ItemId);
                $('#rate_' + rowid).html(o.Rate);
                if (typeof(o.PurchaseAccount) != 'undefined') {
                    $('#PurchaseAccount_' + rowid).val(o.PurchaseAccount).trigger('change').addClass('border-none').prop('disabled', true);
                }
                if (typeof(o.issueAccount) != 'undefined') {
                    $('#issueAccount_' + rowid).val(o.issueAccount).trigger('change').addClass('border-none').prop('disabled', true);
                }
                if (typeof(o.rate) != "undefined") {
                    $('#rate_' + rowid).html(o.rate);
                }
                if (typeof(o.Amount) != "undefined") {
                    $('#amount_' + rowid).html(o.Amount);
                }
                if (typeof(o.Remarks) != "undefined") {
                    $('#remarks_' + rowid).html(o.Remarks);
                }
                if (typeof(o.Qty) != "undefined") {
                    $('#qty_' + rowid).html(o.Qty);
                }

                if(typeof(o.HiddenQty) != "undefined")
                {
                    $('#hiddenqty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
                }
                if (typeof(o.FreeOrCharge) != "undefined") {
                    $('#FC_' + rowid).val(o.FreeOrCharge).addClass('border-none').prop('disabled', true);
                }
                $('#unitname_' + rowid).html(o.UnitName);
                $('#unitid_' + rowid).val(o.UnitId);
                $('#expandTr_' + rowid).show();

                //ClosingStock

                if(arr_resource_closingstock.length != 0) {
                    var findClstock = arr_resource_closingstock.filter(function(obj) {
                        return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                    });

                    if(findClstock.length > 0) {

                        $.each(arr_resource_closingstock, function (s, t) {
                            if (o.ResourceId != t.ResourceId || o.ItemId != t.ItemId) {
                                return;
                            }

                            $('#qty_' + rowid).next('span').html('closing Stock: ' + sanitizeNumber(t.Qty,3,true));
                            $('#qty_' + rowid).next('span').attr('data-stock', sanitizeNumber(t.Qty,3,true));
                        });
                    }
                }
                //

                var wbsCount = 0;
                var whsCount = 0;

                $.each(arr_resource_iows, function (j, l) {
                    var findRes = arr_wbs.filter(function(obj) {
                        return (obj.ResourceId === o.ResourceId && obj.WBSId === l.WBSId);
                    });
                    if(findRes.length > 0) {
                        wbsCount = wbsCount + 1;
                        if(mode != 0) { // Edit Section
                            //if (l.ResourceId == o.ResourceId && l.ItemId == o.ItemId) { // edit mode -issue
                                var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                                $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                $('#iow_' + rowid + '_rowid').val(iowrowid);
                                $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                $('#iow_' + rowid + '_wbsname_' + iowrowid).html(l.WbsName);
                                $('#iow_' + rowid + '_qty_' + iowrowid).html(l.Qty);
                                $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(sanitizeNumber(l.HiddenQty,3,true));

                                // start wbs-warehouse

                                if (arr_wbs_warehouse.length != 0) {
                                    var findWHH11 = arr_wbs_warehouse.filter(function (obj) {
                                        return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                                    });
                                    if(findWHH11.length == 0){
                                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                                        $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcQuantity(this)');
                                        $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                                    } else{
                                        $.each(arr_wbs_warehouse, function (m, n) {
                                            if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId ) {
                                                return;
                                            }
                                            var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;

                                            $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requestTemplate
                                                .replace(/__7/g, '_' + whrowid)
                                                .replace(/_0/g, '_' + iowrowid)
                                                .replace(/__/g, '_' + rowid));

                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).html(n.Description);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(n.Qty);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                                            $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).html(n.Qty);
											$('.iow_' + rowid + '_requestfields').show();
                                            $.each(arr_selwbs_warehouse, function (s,t) {
                                                if (n.WareHouseId == t.WareHouseId && l.WBSId == t.AnalysisId && o.ResourceId == t.ResourceId && o.ItemId == t.ItemId && t.Qty>0) {
                                                    $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(t.Qty);
                                                }
                                            });
                                        });
                                    }
                                }else{
									$('.iow_' + rowid + '_requestfields').hide();
								}
                                //end wbs-warehouse
                           // }
                        } else { //Add Section
                            var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                            $('#iowTable_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                            $('#iow_' + rowid + '_rowid').val(iowrowid);
                            $('#iow_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                            $('#iow_' + rowid + '_wbsname_' + iowrowid).html(l.WbsName);
                            $('#iow_' + rowid + '_qty_' + iowrowid).html(l.Qty);
                            $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                            // start wbs-warehouse
                            if (arr_sel_warehouse.length != 0) {
                                var findWHH = arr_sel_warehouse.filter(function (obj) {
                                    return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                                });
                                if(findWHH.length == 0){
                                    $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                                    $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcQuantity(this)');
                                    $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                                } else{
                                    $.each(arr_sel_warehouse, function (m, n) {
                                        if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId ) {
                                            return;
                                        }
                                        var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requestTemplate
                                            .replace(/__7/g, '_' + whrowid)
                                            .replace(/_0/g, '_' + iowrowid)
                                            .replace(/__/g, '_' + rowid));

                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).html(n.Description);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(n.Qty).attr('data-find', n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(sanitizeNumber(n.Qty,3,true));

                                    });

                                }
                            }
                        }
                        $('#iowTable_' + rowid).show();
                        $('#decisionTabLink_' + rowid).show();
                        $('#whTableLink_' + rowid).hide();
                        $('#whTable_' + rowid).hide();
                    }
                });
                if(wbsCount == 0) {
                    if(arr_sel_warehouse.length != 0) {
                        $.each(arr_sel_warehouse, function (m, n) {
                            if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId ) {
                                return;
                            }
                            whsCount = whsCount+1;
                            var whrowid = parseInt($('#wh_' + rowid + '_rowid').val()) + 1;
                            $('#whTable_' + rowid).find('> tbody.main').append(waretemplate
                                .replace(/__/g, '_' + rowid)
                                .replace(/_0/g, '_' + whrowid));

                            $('#wh_' + rowid + '_rowid').val(whrowid);
                            $('#wh_' + rowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                            $('#wh_' + rowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                            $('#wh_' + rowid + '_stockid_' + whrowid).val(n.StockId);
                            $('#wh_' + rowid + '_desc_' + whrowid).html(n.Description);
                            $('#wh_' + rowid + '_qty_' + whrowid).html(n.Qty);
                            $('#wh_' + rowid + '_closingstock_' + whrowid).html(n.ClosingStock);
                            $('#wh_' + rowid + '_hiddenqty_' + whrowid).val(sanitizeNumber(n.Qty,3,true));
                        });
                    }
                    $('#iowTable_' + rowid).hide();
                    $('#decisionTabLink_' + rowid).hide();
                    $('#whTableLink_' + rowid).show();
                    $('#whTable_' + rowid).show();
                }


                if(whsCount == 0 && wbsCount == 0) {
                    $('#qty_' + rowid).attr('onkeypress','return isDecimal(event,this);');
                    $('#qty_' + rowid).attr('onchange','calcResQuantity(this)');
                    $('#iowTable_' + rowid).hide();
                    $('#decisionTabLink_' + rowid).hide();
                    $('#whTableLink_' + rowid).hide();
                    $('#whTable_' + rowid).hide();
                } else {
                    $('#qty_' + rowid).attr('readOnly','readOnly');
                }

            });
        }
        rowid += 1;


        var opt = '<option></option>';
        if (arr_accountType.length > 0) {
            $.each(arr_accountType, function (j, p) {
                opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
            });
        }
        $('#PurchaseAccount_' + rowid).html(opt);
        $('#issueAccount_' + rowid).html(opt);
        var rowIdval = parseInt(arr_requestResources.length + 1);
        $('#rowid').val(rowIdval);

        $('.content_wrapper').on('click', '.mainTr', function (e) {
            e.preventDefault();
            if (!$(this).closest("tr").next(".subTr").is(":visible")) {
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else {
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        });

        nextAccordian(1);

    });
    ////////////////////////////////////////////////////  ISSUE END  //////////////////////////////////////
}
else
{
    /////////////////////////////////////////////// ISSUE-RETURN  /////////////////////////
    $(function () {
        var $rowid = $('#rowid');
        var template = $('#resource-template').html();
        var iowtemplate = $('#iow-template').html();
        var requesttemplate = $('#issue-warehouse').html();
        var rowid = 0;
        var $tbody = $('#workorderTable').find('> tbody.main');
        if(arr_requestResources.length != 0) {
            $.each(arr_requestResources, function(i, o) {
                rowid += 1;
                $tbody.append(template.replace(/__/g, '_' + rowid));
                var opt = '<option></option>';
                if (arr_accountType.length > 0) {
                    $.each(arr_accountType, function (j, p) {
                        opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
                    });
                }
                $('#PurchaseAccount_' + rowid).html(opt);
                $('#issueAccount_' + rowid).html(opt);

                if (typeof(o.PurchaseAccount) != 'undefined') {
                    $('#PurchaseAccount_' + rowid).val(o.PurchaseAccount).trigger('change').addClass('border-none').prop('disabled', true);
                }
                if (typeof(o.issueAccount) != 'undefined') {
                    $('#issueAccount_' + rowid).val(o.issueAccount).trigger('change').addClass('border-none').prop('disabled', true);
                }
                if (typeof(o.rate) != "undefined") {
                    $('#rate_' + rowid).html(sanitizeNumber(o.rate,2,true));
                }
                if (typeof(o.Amount) != "undefined") {
                    $('#amount_' + rowid).html(sanitizeNumber(o.Amount,2,true));
                }
                if (typeof(o.Remarks) != "undefined") {
                    $('#remarks_' + rowid).html(o.Remarks);
                }
                if (typeof(o.Qty) != "undefined") {
                    $('#qty_' + rowid).html(sanitizeNumber(o.Qty,3,true));
                }
                if (typeof(o.FreeOrCharge) != "undefined") {
                    $('#FC_' + rowid).val(o.FreeOrCharge).addClass('border-none').prop('disabled', true);
                }

                $('#code_' + rowid).html(o.Code);
                $('#desc_' + rowid).html(o.ResourceName);
                $('#resourceid_' + rowid).val(o.ResourceId);
                $('#itemid_' + rowid).val(o.ItemId);
                $('#unitname_' + rowid).html(o.UnitName);
                $('#unitid_' + rowid).val(o.UnitId);
                $('#expandTr_' + rowid).show();
                $('#deleteTr_' + rowid).show();
				
                var IssueCount = 0;
                if(arr_resource_iows.length > 0) {
                    $.each(arr_resource_iows, function (j, l) {
                        if (l.ResourceId == o.ResourceId && l.ItemId == o.ItemId) {
                            var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                            IssueCount = IssueCount+1;
                            $('#iowTables_' + rowid).find('tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                            $('#iow_' + rowid + '_rowid').val(iowrowid);
                            $('#iow_' + rowid + '_issueNo_' + iowrowid).html(l.IssueNo);
                            $('#iow_' + rowid + '_TransId_' + iowrowid).val(l.AIssueTransId);
                            $('#iow_' + rowid + '_IssueDate_' + iowrowid).html(l.IssueDate);
                            $('#iow_' + rowid + '_BalQty_' + iowrowid).html(l.BalQty);
                            $('#iow_' + rowid + '_IssueQty_' + iowrowid).html(l.Qty);
                            $('#iow_' + rowid + '_Rate_' + iowrowid).html(l.Rate);
                            $('#iow_' + rowid + '_ReturnQty_' + iowrowid).html(l.CurrentQty);
                            $('#iow_' + rowid + '_AdjustmentQty_' + iowrowid).html(l.AdjustmentQty);

                            //start warehouse
                            var wareCount = 0;
                            if (arr_resel_warehouse.length != 0) {
                                var findReturnWH = arr_resel_warehouse.filter(function (obj) {
                                    return (obj.ResourceId === o.ResourceId) && (obj.ItemId === o.ItemId) && (obj.IssueTransId === l.AIssueTransId);
                                });
                                if (findReturnWH.length > 0) {
                                    $.each(arr_resel_warehouse, function (m, n) {
                                        if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId || n.IssueTransId != l.AIssueTransId) {
                                            return;
                                        }
                                        wareCount = wareCount+1;
                                        var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requesttemplate
                                            .replace(/__7/g, '_' + whrowid)
                                            .replace(/_0/g, '_' + iowrowid)
                                            .replace(/__/g, '_' + rowid));

                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).html(n.WareHouseName);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).html(n.Description);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(n.Qty);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_bissueqty_' + whrowid).html(n.BalIssueQty);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_issueqty_' + whrowid).html(n.IssueQty);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).html(n.Qty);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_adqty_' + whrowid).html(n.AdjustmentQty);
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenadqty_' + whrowid).val(sanitizeNumber(n.HAdjustmentQty,3,true));
										$('.iow_' + rowid + '_requestfields').show();
                                        $.each(arr_resel_iswarehouse, function (s, t) {
                                            if (n.WareHouseId == t.WareHouseId && l.AIssueTransId == t.RIssueTransId && o.ResourceId == t.ResourceId && o.ItemId == t.ItemId && t.Qty > 0) {
                                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).html(t.Qty);
                                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_adqty_' + whrowid).html(t.AdjustmentQty);

                                            }
                                        });
                                    });
                                }
                            }else{
								$('.iow_' + rowid + '_requestfields').hide();
							}
                            if(wareCount == 0) {
                                $('#iow_' + rowid + '_ReturnQty_' + iowrowid).removeClass('mainTr');
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                                $('#iow_' + rowid + '_ReturnQty_' + iowrowid).attr('onchange', 'calcQuantity(this)');
                                $('#iow_' + rowid + '_ReturnQty_' + iowrowid).prop("readonly", false);
                                $('#iow_' + rowid + '_AdjustmentQty_' + iowrowid).attr('onkeyup', 'calc(this)');
                                $('#iow_' + rowid + '_AdjustmentQty_' + iowrowid).prop("readonly", false);
                            }
                            //end of warehouse
                        }
                    });
                }
                if(IssueCount == 0){
                    $('#expandTr_' + rowid).hide();
                    $('#qty_' + rowid ).attr('onfocus', 'calcResQty(this)');
                    $('#qty_' + rowid).prop("readonly", false);

                }
            });
        }
        rowid += 1;
        $rowid.val(rowid);
		
        var opt = '<option></option>';
        if (arr_accountType.length > 0) {
            $.each(arr_accountType, function (j, p) {
                opt += '<option value="' + p.TypeId + '">' + p.Typename + '</option>';
            });
        }
        $('#PurchaseAccount_' + rowid).html(opt);
        $('#issueAccount_' + rowid).html(opt);
        var rowIdval = parseInt(arr_requestResources.length + 1);
        $('#rowid').val(rowIdval);

        $('.content_wrapper').on('click','.mainTr',function(e){
            e.preventDefault();
            if(!$(this).closest("tr").next(".subTr").is(":visible")){
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else{
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        });

        $('.content_wrapper').on('keyup','.mainTr',function(e){
            e.preventDefault();
            if(!$(this).closest("tr").next(".subTr").is(":visible")){
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else{
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        });

        nextAccordian(1);
    });

    ////////////////////////////////////////////////// ISSUE-RETURN END  ////////////////////
}
function nextAccordian(id) {
    $('#panelheading-' + id).trigger('click');
}
var Narration= <?php echo json_encode ($Narration);?>;
if(Narration == ''|| Narration == null) {
	$('#nar').hide();
}

var ProjectName= <?php echo json_encode ($ProjectName);?>;
var IssueNo= <?php echo json_encode ($IssueNo);?>;
var issue_datess= <?php echo json_encode ($issue_datess);?>;
var contractor= <?php echo json_encode ($contractor);?>;
var CINo= <?php echo json_encode ($CINo);?>;
var CCINo= <?php echo json_encode ($CCINo);?>;
var issue_typename= <?php echo json_encode ($issue_typename);?>;
var issue= <?php echo json_encode ($issue);?>;
if(ProjectName == ''|| ProjectName == null) {
	$('#ProjectName').hide();
} 
if(IssueNo == ''|| IssueNo == null){
	$('#IssueNo').hide();
} 
if(issue_datess == ''|| issue_datess == null){
	$('#issue_datess').hide();
} 
if(contractor == ''|| contractor == null){
	$('#contractor').hide();
} 
if(CINo == ''|| CINo == null){
	$('#CINo').hide();
} 
if(CCINo == ''|| CCINo == null){
	$('#CCINo').hide();
} 
if(issue_typename == ''|| issue_typename == null){
	$('#issue_typename').hide();
} 
if(issue == ''|| issue == null){
	$('#issue').hide();
}
</script>