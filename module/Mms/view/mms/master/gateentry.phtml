<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />

<style>
	.mar_tp{margin-top:25px;}
	.mar_lft{margin-left:18%;}
    .mtrl_txt:focus,.mtrl_txt:hover,.mtrl_txt.active {border: 1px solid #39F;}
    .mtrl_txt{border:1px solid #CCC;padding:8px 4px;font-size:14px!important;font-weight:normal !important;width:100%;-webkit-transition: border-color 1s ease;-moz-transition:border-color 1s ease; -o-transition: border-color 1s ease;-ms-transition: border-color 1s ease;transition: border-color 1s ease;background:#fff;}
    .tx_ara 		{border: 1px dashed #afbecc; font-size: 15px;height:100px;width:100%;resize:none;padding:8px 0px 8px 8px;}
    .rmx_ara 		{border: 1px dashed #afbecc; font-size: 15px;height:80px;width:100%;resize:none;padding:8px 0px 8px 8px;}
    .pagination-lg > li > a, .pagination-lg > li > span {font-size:15px !important; padding:5px 15px !important;}
    .jqx-grid-header {height:75px !important;}

    #jqxgrid									{min-height:200px !important;}
    .jqx-grid-groups-row						{padding-left:5px !important;}
    .jqx-grid-pager-input						{padding: 2px; text-align: center !important; width: 35px;}
    .jqx-dropdownlist-state-normal				{display: block;  float: right;height: 16px !important;margin-right: 7px;margin-top: 0;  padding-bottom: 2px !important;padding-top: 2px !important; width: 40px;}
    .jqx-button									{cursor: pointer;float: right;margin-right: 3px !important;margin-top: 0 !important;padding: 0 !important;width: 20px !important;}
    .jqx-button > .jqx-icon-arrow-left,
    .jqx-button >.jqx-icon-arrow-right			{height: 21px !important;margin-left: 0 !important;width: 20px !important;}
    .jqx-listitem-element						{height: 25px !important;}
    .jqx-input									{height: 25px !important; margin:2px 4px !important;}
    .jqx-grid-pager .jqx-grid-pager-input		{height:20px !important; margin:0px 4px !important;}
    #jqxgrid .jqx-grid-cell-right-align 		{text-align:right !important; padding-right:8px;}
    #jqxgrid .jqx-grid-cell-left-align 			{padding-left:8px;}
    .jqx-grid-column-menubutton::after			{left:4px;top:10px;}
	.bar{height:0px !important;}
	.lbl_move{height:45px!important;}
</style>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqxgrid.grouping.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqxgrid.aggregates.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqx-all.js"></script>

<form class="" method="post" action="<?php echo $this->basePath(); ?>/mms/master/gateentry-edit" id="formWrapper" enctype="">
    <div class="content_wrapper padlr0">
        <div class="container-fluid">
			<div class="col-lg-12">
				<h1>GatePass Entry<?php echo ($genType==true) ? '-' : ''; ?><?php echo $vNo['voucherNo']; ?></h1>
			</div>
			<!--<step-1>-->
			<div class="visible showdiv" id="gateentry_1">
				<div class="col-lg-12">
					<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
						<label for="Type" class="stat">Type</label>
						<div class="radio_check">
							<p class="stat_lbl">
								<input type="radio" value="1" id="In" name="Type" checked="checked" onclick="return showNewKf('n');" /> 
								<label for="In" class="">In</label>
							</p>
							<p class="stat_lbl">
								<input type="radio" value="2" id="Out" name="Type" onclick="return showNewKf('e');" />
								<label for="Out" class="">Out</label>
							</p>
						</div>
					</div>
					<div class="form-group col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
						<input type="hidden" class="" name="GatePassNo" id="GatePassNo" value="<?php echo $vNo['voucherNo'];?>">
						<div class="error_message" style="display:none;"><p>Please enter GatePassNo...</p></div>
					</div>
					<div class="form-group col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 clear divfive" style="display:none">
						<select class="single_dropdown lbl_move" name="GatePassNO" id="GatePassNO" data-bsfshare="GatePassNO" style="width:100%;"  label="Select GatePassNo">
							<option value="">Select GatePassNo</option>
							<?php
							foreach($gatepassnumber as $d){
								echo '<option value="'.$d['GateRegId'].'">'.$d['GatePassNo'].'</option>';
							}
							?>
						</select>
					</div>
				</div>
				<div class="col-lg-10 col-lg-offset-2">
                    <div class="row">
						<div class="form-group col-lg-5">
							<select name="Project" id="Project" class=" lbl_move single_dropdown select2-hidden-accessible" data-size="5"
									title="Project" style="width:100%;" label="Project" tabindex="-1" aria-hidden="true" >
								<option value="">Select Project </option>
								<?php
								foreach($arr_costcenter as $d){
									echo '<option value="'.$d['CostCentreId'].'">'.$d['CostCentreName'].'</option>';
								}
								?>
							</select>
						</div>
						<div class="form-group col-lg-5">
							<select name="GateName" id="GateName" class=" lbl_move single_dropdown select2-hidden-accessible" data-size="5"
									title="GateName" style="width:100%;" label="GateName" tabindex="-1" aria-hidden="true">

							</select>
							<div class="error_message">
								<p>Please select the Gate Name...</p>
							</div>
						</div>
						<div class="form-group col-lg-5">
							<input type="text" name="SecurityName" id="SecurityName" onchange = "" class="lbl_move mtrl_txt" label="SecurityName" placeholder="" onkeypress="" value="">
						</div>
                        <div class="form-group col-lg-5">
                            <select name="SupplierName" id="SupplierName"  class=" lbl_move single_dropdown select2-hidden-accessible" data-size="5"
                                    title="SupplierName" style="width:100%;" label="SupplierName" tabindex="-1" aria-hidden="true" >
                                <option value="">Select SuppliersName</option>
                                <?php
                                foreach($SupplierResults1 as $d){
                                    echo '<option value="'.$d['SupplierId'].'">'.$d['SupplierName'].'</option>';
                                }
                                ?>
                            </select>
                        </div>
                        <div class="form-group col-lg-5 clear">
                            <input type="text" class="form-control  lbl_move resourceSuggest " label="Vehicle Registration No." maxlength="20" name="VehicleRegNo" id="VehicleRegNo" value ="">
                            <div class="error_message">
                                <p>Please select the Vehicle Reg.No...</p>
                            </div>
                        </div>
                        <div class="form-group col-lg-5">
                            <input type="text" name="VehicleType" id="VehicleType" onchange = "" class="lbl_move mtrl_txt" placeholder="" label="Vehicle Type" onkeypress="" value="">
                        </div>
						<div class="form-group col-lg-5">					
							<?php if(((isset($rd)) ? $rd['genType'] : 0)==0){?>
								<span><input type="text"  class="lbl_move mtrl_txt" placeholder="" label="CGateNo" id="CGateEntryNo" name="CGateEntryNo" value="" /></span>
							<?php }else{ ?>
								<span><input type="text"  class="lbl_move mtrl_txt" placeholder="" label="CGateNo" id="CGateEntryNo" name="CGateEntryNo" value="" readonly /></span>
							<?php } ?>
						</div>
						<div class="form-group col-lg-5">								
							<?php if(((isset($rs)) ? $rs['genType'] : 0)==0){?>
								<span><input type="text"  class="lbl_move mtrl_txt" placeholder="" label="CCGateNo" id="CCGateEntryNo" name="CCGateEntryNo" value="" /></span>
							<?php }else{ ?>
								<span><input type="text"  class="lbl_move mtrl_txt" placeholder="" label="CCGateNo" id="CCGateEntryNo" name="CCGateEntryNo" value="" readonly /></span>
							<?php } ?>
						</div>
						<div class="cleafix"></div>
					</div>
                </div>
            </div>
			<!--<step-2>-->
			<div class="visible shrIdowdiv" id="gateentry_2" style="display:none;" >
				<div class="col-lg-10 col-lg-offset-2 mar_tp">
                    <div class="row">
						<div class="form-group col-lg-5 mar_tp" id="pkTime Vi">
							<input type="text" name="TimeIn" id="TimeIn" style="width:100%;" class="form-control lbl_move time_picker" data-bsfshare="" readonly label="Vehicle TimeIn" />
							<div class="error_message"><p>please enter vehicle time in...</p></div>
						</div>
						<div class="form-group col-lg-5 mar_tp" id="pkTime Vo">
							<input type="text" name="TimeOut" id="TimeOut" style="width:100%;" class="form-control lbl_move time_picker" data-bsfshare=""  readonly label="Vehicle TimeOut" />
							<div class="error_message"><p>please enter vehicle time out...</p></div>
						</div>
						<div class="form-group req_flds col-lg-5">
							<span class="date_icon"><i class="fa fa-calendar"></i></span>
							<input type="text" name="GDate" id="GDate" class="form-control lbl_move datepickerinput" label="GDate" value='<?php echo date('d-m-Y'); ?>' />
							<div class="error_message"><p>Please enter Request date...</p></div>
						</div>
						<div class="form-group col-lg-5">
							<select name="PoNo" id="PoNo" class=" lbl_move single_dropdown select2-hidden-accessible"
									title="PoNo" style="width:100%;" label="PoNo" tabindex="-1" aria-hidden="true" >
<!--								<option value="-1">Select PoNo</option>-->
<!--								<option value="1">10</option>-->
<!--								<option value="2">11</option>-->
<!--								<option value="3">12</option>-->
<!--								<option value="4">13</option>-->
							</select>
						</div>
					</div>
				</div>
				<div class="col-lg-10 col-lg-offset-2">
                    <div class="row">
						<div class="form-group col-lg-5">
							<input type="text" name="ContactNo" id="ContactNo" label="Supplier ContactNo" class="lbl_move mtrl_txt" placeholder="" value="" readonly />
						</div>
						<div class="form-group col-lg-5">
							<input type="text" name="DriverName" id="DriverName" class="lbl_move mtrl_txt" data-bsfshare="" label="Driver Name" placeholder="" value="">
						</div>
						<div class="form-group col-lg-5">
							<textarea rows="3" id="Address" class=" lbl_move exp-tex" name="Address" label="Supplier Address" readonly ></textarea>
						</div>
						<div class="form-group col-lg-5">
							<textarea rows="3" id="Remarks" class="lbl_move exp-tex" name="Remarks" label="Remarks" data-bsfshare=""></textarea>
						</div>
					</div>
				</div>
			</div>
			<!--<step-3>-->
			<div class="visible showdiv" id="gateentry_3" style="display:none;">
				<div class="col-lg-12 feed-bg">
					<div class="col-lg-8">
						<div class="fil-til mar_btm">
							<h2 class="h1-head ">List of resources from the selected project.</h2>
							<p>Selected Resources </p>
							<span id="NoOfSelResource">0</span>
						</div>
					</div>
					<div class="col-lg-3 form-group mar-tp">
						<select class="form-control selectpicker show-tick" name="gridtype" id="gridtype">
							<option value="0" selected="true">Sequentival View</option>
							<option value="1">List View</option>
						</select>
						<div class="error_message"><p>Please select the priority...</p></div>
					</div>
					<div class="mar_btm" id="dataTable"></div>
				</div>
				<div class="clearfix"></div>
			</div>
				<div id="requestTransInputsWrapper" class="hide"></div>
				<input type="hidden" name="frm_index" value="1"/>
        </div>
	</div>
	<div class="col-lg-12 savebtn_area">
		<ul>
			<li class="cancel_btn cancel_btn_bluecolor float_l"><a class="ripple has-ripple" style="position: relative; overflow: hidden; cursor:pointer;" button type="button" onclick="backsample(this)"
			data-rid="1" id="backRid" class="ripple">back<span class="ripple-wrapper"></span></a></li>
			</li>
			<li id="Continue" class="save_btn float_r">
				<a class="ripple><button type="button" onclick="sample(this);" data-rid="1" id="continueRid" class="ripple">continue</button></a>
			</li>
		</ul>
	</div>
</form>
<script type="text/template" id="request-template">
    <div class="col-md-3">
        <div class="three-box hvr-overline-from-center request-box">
            <ul data-id="{{RequestId}}">
                <li><span>ResourceName</span>:&nbsp;{{ResourceName}}</li>
                <li><span>Request No</span>:&nbsp;{{RequestNo}}</li>
            </ul>
            <span class="high-lit">R</span>
        </div>
    </div>
</script>
<script>
$(document).ready(function() {
    $('#TimeOut').prop('disabled',true);
});
$('#backRid').hide();
function sample(val){
    var dt = parseInt($(val).data('rid'));
    if(dt==1) {
        if($('#Project').val() == '') {
            alert('Please select Project');
            return false;
        }

        if($('#SupplierName').val() == '') {
            alert('Please select SupplierName');
            return false;
        }

        if($('#VehicleRegNo').val() == '') {
            alert('Please select VehicleRegNo');
            return false;
        }
        if($('#GateName').val() == '' || $('#GateName').val() == null ) {
            alert('Please select GateName');
            return false;
        }
        var selected = $("input[type='radio'][name='Type']:checked");

        if (selected.val() == 1) {
            $('#TimeOut').prop('readonly', true);
        }
		 $('#backRid').show();
        $('#gateentry_1').hide();
        $('#gateentry_2').show();
        $('#gateentry_3').hide();
        $('#backRid').data('rid',2);
        $('#continueRid').data('rid',2);
    }else if(dt==2) {
		var selected = $("input[type='radio'][name='Type']:checked"); 
        if (selected.val() == 2) {
			$('.dis').prop('disabled', false);
			$('#formWrapper').submit();
		}
		else {
		$('#gateentry_1').hide();
        $('#gateentry_2').hide();
        $('#gateentry_3').show();
        $('#backRid').data('rid',3);
        $('#continueRid').data('rid',3);
		}
    } else if(dt==3) {
//        if($('#NoOfSelResource').html() == 0) {
//            alert('Please select resources');
//            return false;
//        }
        $('#formWrapper').submit();
    }
}
function backsample(val){
    var dt = parseInt($(val).data('rid'));
    if(dt==1){
        return;
    }else if(dt==2){
		$('#backRid').hide();
        $('#backRid').data('rid',1);
        $('#continueRid').data('rid',1);
        $('#gateentry_1').show();
        $('#gateentry_2').hide();
        $('#gateentry_3').hide();
    } else if(dt==3) {
        $('#backRid').data('rid',2);
        $('#continueRid').data('rid',2);
        $('#gateentry_2').show();
        $('#gateentry_1').hide();
        $('#gateentry_3').hide();
    }
}


$('#SupplierName').on('change',function() {
    var target = $('#SupplierName').val();
    var ccid = $('#Project').val();
    $.ajax({
        url: getBaseURL() + "mms/master/gateentry",
        type: "post",
		async: false,
        data:"SupplierId="+target+"&CostCentreId="+ccid+"&mode=Vehicle",
        success: function (data, textStatus, jqXHR) {
            var suppdet = JSON.parse(data);
//            $('#VehicleRegNo').html('');
//            var toAppend = '<option value=""></option>';
//            $.each(vehicleDetails, function (i, o) {
//                toAppend += '<option value="' + o.VehicleId + '">' + o.VehicleRegNo + '</option>';
//            });
//            $('#VehicleRegNo').append(toAppend);
//            $('#VehicleRegNo').select2();
            bindVehicleRegAutocomplete(suppdet["vehicle"]);
            //Populate PO
            $("#PoNo").html('');
            $("#PoNo").append("<option value='0'>Select PONo</option>");
            $.each(suppdet['gatepo'], function(i,v){
                $("#PoNo").append("<option value='" + v.data + "'>" + v.value + "</option>");
            });

            $("#PoNo").selectpicker('refresh');
            //
            //Supplier Address
            if(Object.keys(suppdet["suppadd"]).length > 0)
            {
                $("#Address").val(suppdet["suppadd"]["Address"]);
                $("#ContactNo").val(suppdet["suppadd"]["Mobile"]);
            }
            //


        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(textStatus + "-----" + errorThrown);
        }
    });
});

function bindVehicleRegAutocomplete(x) {

    // bind resource autocomplete
    $('#VehicleRegNo').autocomplete({
        lookup: x,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {

                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },

        onSelect: function (suggestion) {
            if (suggestion) {
                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];

                //$('#rowid').val(rowid);

//                $this.prop('readonly', true).addClass('border-none');
//
//                //desc__
//                $('#resourceid_' + rowid).val(suggestion.data);
//                $('#unitname_' + rowid).val(suggestion.UnitName);
//                $('#code_' + rowid).val(suggestion.Code);
//                $('#unitid_' + rowid).val(suggestion.UnitId);
//                $('#expandTr_' + rowid).show();
//                $('#expandSt_' + rowid).show();
                //$('#veh_type').val(suggestion.data);
                $('#VehicleType').val(suggestion.VehicleName);
                $('#VehicleType').trigger('change');
                //$('#VehicleType').focus();


            }
        }, onSearchStart: function (suggestion) {
            var rowid = $(this)[0].id.split('_')[1];


        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                var rowid = $(this)[0].id.split('_')[1];


            }
        }
    });
}

//$('#autocomplete-vehicleRegNo').autocomplete({
//    lookup: <?php //echo json_encode($quotationType); ?>//,
//    lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//        if (queryLowerCase == '*') {
//            return suggestion.value;
//        } else {
//            var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//            return re.test(suggestion.value);
//        }
//    },
//    onSelect: function(suggestion){
//        request = suggestion.data;
//        $("#qtn_type").val(suggestion.data);
//        $("#qtnType").val(suggestion.value);
//        $("#materialSpan").text(suggestion.value);
//    },
//    onHint: function (hint) {
//        $(this).val(hint);
//    },
//    onSearchComplete: function (query, suggestion){
//    }
//});

$('#Project').on('change',function() {
    var target = $('#Project').val();
	if($.trim(target)!="") {
		$.ajax({
			url: getBaseURL() + "mms/master/gateentry",
			type: "post",
			async: false,
			data:"PId="+target+"&mode=Gate",
			success: function (data, textStatus, jqXHR) {
				var gateDetails = JSON.parse(data);
                var selected = $("input[type='radio'][name='Type']:checked");
                if (selected.val() == 1) {
                    $('#CCGateEntryNo').val(gateDetails[1]['voucherNo']);
                    $('#CGateEntryNo').val(gateDetails[2]['voucherNo']);
                }
				$('#GateName').html('');
				var toAppend = '<option value=""></option>';
				if(gateDetails[0].length>0) {
					$.each(gateDetails[0], function (i, o) {
						toAppend += '<option value="' + o.GateId + '">' + o.GateName + '</option>';
					});
					$('#GateName').append(toAppend);
					$('#GateName').select2();
				}
			},
			error: function (jqXHR, textStatus, errorThrown) {
				alert(textStatus + "-----" + errorThrown);
			}
		});
	} else {
        var selected = $("input[type='radio'][name='Type']:checked");
        if (selected.val() == 1) {
            $('#CCGateEntryNo').val('');
            $('#CGateEntryNo').val('');
        }
	}
});


//$("#VehicleRegNo").change(function(){
//    var target = $('#VehicleRegNo').val();
//    $.ajax({
//        url:getBaseURL()+"mms/master/gateentry",
//        type:"post",
//		async: false,
//        data:"VId="+target+"&mode=Vehicle1",
//        success:function(data, textStatus, jqXHR){
//            //alert(JSON.stringify(data))
//            var valu=JSON.parse(data);
//            $('#VehicleType').val(valu[0]['VehicleName']);
//        },
//        error:function(jqXHR, textStatus, errorThrown){
//            alert(textStatus+"-----"+errorThrown);
//        }
//    });
//});


$("#GateName").change(function(){
    var target = $('#GateName').val();
    $.ajax({
        url:getBaseURL()+"mms/master/gateentry",
        type:"post",
		async: false,
        data:"GId="+target+"&mode=Gate1",
        success:function(data, textStatus, jqXHR){
            //alert(JSON.stringify(data))
            var valu=JSON.parse(data);
            $('#SecurityName').val(valu[0]['SecurityAgency']);
        },
        error:function(jqXHR, textStatus, errorThrown){
            alert(textStatus+"-----"+errorThrown);
        }
    });
});
var sel_resource_count = 0;
var tmpLocalData = [];
var $resourceGrid = $("#dataTable");
var resourceSource = {
    localdata: [],
    dataType: "json",
    dataFields: [
        { name: 'ResourceId', type: 'int' },
        { name: 'ItemId', type: 'int' },
        { name: 'Code', type: 'string' },
        { name: 'ResourceName', type: 'string' },
        { name: 'Include', type: 'boolean' },
        { name: 'ResourceGroupName', type: 'string' },
        { name: 'RequestNo', type: 'number' }
    ],
    id: 'CostCentreId'
};
var resourceAdapter = new $.jqx.dataAdapter(resourceSource);

$(function () {
    $('.div-overallscroll').slimScroll({
        position: 'right',
        height: '100%',
        width: '100%',
        alwaysVisible: false,
        railVisible: true,
        railColor: '#d7dabd',
        color: '#009688',
        railOpacity: 1
    });

    $('#Project').on('change',function(){
        bindRequests();
    });
    $resourceGrid.jqxGrid({

        width: '100%',
        pageable: true,
        source: resourceAdapter,
        pagerHeight: 40,
        rowsheight:40,
        columnsresize: true,
        pagerMode: 'advanced',
        autoheight: true,
        sortable: true,
        altrows: true,
        enabletooltips: true,
        selectionMode: 'singleRow',
        pagerButtonsCount: 6,
        autoheight:true,
        editable: true,
        showfilterrow: true,
        filterable: true,
        autorowheight: true,

        columns: [
            { dataField: 'CostCentreId', hidden: true},
            { dataField: 'ResourceId', hidden: true},
            { text: '', dataField: 'Include', columntype: 'checkbox', align:'center',width:'15%'},
            { text: 'ResourceName', dataField: 'ResourceName',width:'85%', editable:false}
        ]
    });
    $resourceGrid.on('cellvaluechanged', function (event) {
        var args = event.args;
        var datarow = $resourceGrid.jqxGrid('getrowdata', args.rowindex);
        if(args.newvalue === true)
            sel_resource_count++;
        else
            sel_resource_count--;
        $('#NoOfSelResource').html(sel_resource_count);
        generateSelResourceInputs();
    });
    $(".single_dropdown_vendor").select2({
        placeholder: "",
        templateResult: formatState,
        templateSelection: formatState,
        allowClear: true
    });
});

function formatState (state) {
    if (!state.id) { return state.text; }
    var $state = $('<span class="img-select"><img src="<?php echo $this->basePath() . '/images/avatar.jpg';?>" class="img-flag" /> ' + state.text + '</span>');
    return $state;
}

function bindRequests() {
    var target = $('#Project').val();
    $.ajax({
        url:getBaseURL()+"mms/master/gateentry",
        type:"post",
        data:"CostCentreId="+target+"&mode=Grid",
        dataType:"json",
        success:function(data, textStatus, jqXHR){
            if(jqXHR.status == 200) {
                renderRequestResources(data.resources);
            }
        }
    });
}
function renderRequests(data) {
    var $requestWrapper = $('#requestWrapper');
    if(data.length == 0) {
        $requestWrapper.html('<p style="text-align: center;padding: 88px;">No data to display</p>');
    } else {
        var template = $('#request-template').html();
        $requestWrapper.html('');
        $.each(data, function (i,o) {
            $requestWrapper.append(template.replace(/\{\{ResourceName\}\}/g,o.ResourceName)
                .replace(/\{\{RequestNo\}\}/g,o.RequestNo));
        });
    }
}

function renderRequestResources(data) {
    resourceSource.localdata = data;
    resourceAdapter.dataBind();
}

function renderSelectedResources() {
    var $selRequests = $('.request-box.selected');
    $('#NoOfSelRequest').html($selRequests.length);

    // select resources in grid
    if($selRequests.length != 0) {
        var arr_requestIds = [];
        $.each($selRequests, function (i, o) {
            var requestId = $(this).find('ul[data-id]').attr('data-id');
            arr_requestIds.push(requestId);
        });

        $.each(resourceSource.localdata, function (j, r) {
            if ($.inArray(r.RequestId, arr_requestIds) != -1) {
                r.Include = '1';
                sel_resource_count++;
                return;
            }

            r.Include = '0';
        });
    } else {
        $.each(resourceSource.localdata, function (j, r) {
            r.Include = '0';
        });
        sel_resource_count = 0;
    }
    $('#NoOfSelResource').html(sel_resource_count);
    resourceAdapter.dataBind();
    generateSelResourceInputs();
}

function generateSelResourceInputs() {
    var rows = $resourceGrid.jqxGrid('getrows');
    var $inputs = '';
    for(var i = 0; i < rows.length; i++) {
        var row = rows[i];
        if (row.Include === true) {
            $inputs += '<input type="hidden" name="requestTransIds[]" class="requestTransIds" value="' + row.ResourceId + '"/>';
            $inputs += '<input type="hidden" name="itemTransIds[]" class="itemTransIds" value="' + row.ItemId + '"/>';
        }
    }

    $('#requestTransInputsWrapper').html($inputs);
}

$('.datepickerinput').datepicker({
    format: "dd-mm-yyyy",
    startDate: new Date(),
    todayBtn: true,
    orientation: "top auto",
    autoclose: true
}).on("changeDate", function(e){
    $("#dateSpan").text($(this).val());
});
$('.date_icon').click(function() {
    var input = $(this).parent().find('input').datepicker('show');
});

$(".time_picker").timepicker({
	minuteStep: 1,
	showSeconds: true,
	showMeridian: false
});
</script>
<script>
function showNewKf(ktype)
{
	if(ktype == 'n') {
        $("#TimeOut").prop('disabled',true);
        $("#TimeIn").prop('disabled',false);
		$('.divfive').hide();
		window.location.replace(getBaseURL() + "mms/master/gateentry");
	} else {
        $("#TimeIn").prop('disabled',true);
        $("#TimeOut").prop('disabled',false);
		$('.divfive').show();
		$("#CCGateEntryNo").show();
		$("#CGateEntryNo").show();
	}
}
$("#GatePassNO").change(function(){
    var target = $('#GatePassNO').val(); 
    $.ajax({
        url:getBaseURL()+"mms/master/gateentry",
        type:"post",
		async: false,
        data:"RId="+target+"&mode=Entry",
        success:function(data, textStatus, jqXHR){
            //alert(JSON.stringify(data))
            var valu=JSON.parse(data);
			if(valu!= false){ 
            $('#Project').val(valu['CostCentreId']).trigger('change');
            $('#SupplierName').val(valu['VendorId']).trigger('change');
			$('#VehicleRegNo').val(valu['VehicleRegNo']).trigger('change');
            $('#VehicleType').val(valu['VehicleName']);
            $('#CCGateEntryNo').val(valu['CCGatePassNo']);
            $('#CGateEntryNo').val(valu['CGatePassNo']);
            $('#GatePassNo').val(valu['GatePassNo']);
            $('#TimeIn').val(valu['TimeIn']);

            $('#TimeOut').val(valu['TimeOut']);
            $('#GDate').val( valu['GDate']);

            $("#PoNo option[value='"+ valu['PoNo'] +"'").attr("selected", "selected");
            $("#PoNo").trigger('change');
            $('#Remarks').val(valu['Remarks']);
            $('#DriverName').val(valu['DriverName']);
            $('#gridtype').val(valu['GridType']);
			$('#Project').addClass('dis');
			$('#SupplierName').addClass('dis');
			$('#VehicleRegNo').addClass('dis');
            $('#VehicleType').addClass('dis');
            $('#CCGateEntryNo').addClass('dis');
            $('#CGateEntryNo').addClass('dis');
			}
			$('.dis').prop('disabled', true);
        },
        error:function(jqXHR, textStatus, errorThrown){
            alert(textStatus+"-----"+errorThrown);
        }
    });
});
</script>

