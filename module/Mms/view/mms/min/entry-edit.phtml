<style>
#poGrid .jqx-grid-header 	{height:75px !important;}
#resourceGrid .jqx-grid-header 	{height:75px !important;}
.jqx-grid-column-header .jqx-checkbox-default{
	display:none;
}
</style>
<div class="content_wrapper padlr0">
	<div class="container-fluid">
		<div class="col-lg-12 clear">
			<form class="form-horizontal" method="post">
				<div class="row showDiv" id="firstStep">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Min Entry<?php echo ($vNo['genType']==true) ? '-' : ''; ?><?php echo $registerResults['GRNNo']; ?></h1>
					<div class="form-group">
						<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
							<div class="row" style="<?php echo ($vNo['genType']==true) ? 'display:none' : ''; ?>">
								<div class="form-group req_flds col-lg-12">
									<input type="text" name="grn_no" id="grn_no" class="form-control lbl_move" label="Enter GRN No" value="<?php echo $registerResults['GRNNo']; ?>">
									<div class="error_message" style="display:none;"><p>Please enter GRN No...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<span class="date_icon"><i class="fa fa-calendar"></i></span>
									<input type="text" name="grn_date" id="grn_date" class="form-control lbl_move datepickerinput" label="Enter GRN Date" value="<?php echo $registerResults['GRNDate']; ?>">
									<div class="error_message" style="display:none;"><p>Please enter GRN Date...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<input type="text" name="grnsite_no" id="grnsite_no" class="form-control lbl_move" label="Enter GRN Site No" value="<?php echo $registerResults['GRNSiteNo']; ?>">
									<div class="error_message" style="display:none;"><p>Please enter GRN Site No...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<span class="date_icon"><i class="fa fa-calendar"></i></span>
									<input type="text" name="grnsite_date" id="grnsite_date" class="form-control lbl_move datepickerinput" label="Enter GRN Site Date" value="<?php echo $registerResults['GRNSiteDate']; ?>">
									<div class="error_message" style="display:none;"><p>Please enter GRN Site Date...</p> </div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row showDiv" id="secondStep" style="display:none;">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Min Entry</h1>
					<div class="form-group">
						<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<select class="form-control selectpicker show-tick" name="project_name" id="project_name" title="Choose project...">
										<option value="-1" selected>Select Project</option>
										<?php
										foreach($proResults as $projData){
											echo '<option value="'.$projData['data'].'">'.$projData['value'].'</option>';
										}
										?>
									</select>
									<div class="error_message" style="display:none;"><p>Please Select Project...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<select class="form-control selectpicker show-tick" name="warehouse_name" id="warehouse_name" title="Choose Warehouse...">
										<option value="-1">Select Warehouse</option>
										<option value="1" selected>Warehouse1</option>
									</select>
									<div class="error_message" style="display:none;"><p>Please Select Warehouse...</p> </div> 
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row showDiv" id="thirdStep" style="display:none;">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Min Entry</h1>
					<div class="col-lg-12">
						<input type="hidden" name="sel_poId" id="sel_poId" value="">
						<div class="jqxWidget">
							<div id="poGrid" style="width:100%;">
							</div>
						</div>
					</div>
				</div>
				<div class="row showDiv" id="fourthStep" style="display:none;">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Min Entry</h1>
					<div class="col-lg-12">
						<input type="hidden" name="sel_resourceId" id="sel_resourceId" value="">
						<div class="jqxWidget">
							<div id="resourceGrid" style="width:100%;">
							</div>
						</div>
					</div>
				</div>
				<div class="row showDiv" id="fifthStep" style="display:none;">
					<div class="col-lg-12">
                        <div class="form-group" style="margin-top:20px;" id="sequentialViewDiv">
                            <div>
                                <div class="col-lg-12 clear">
                                    <div class="table-responsive clear">						
										<table id="sequentialView" class="table table-bordered tableView" style="width:100%;">
											<thead>
												<tr>
													<th>Code</th>
													<th>Resource Name</th>
													<th>Unit</th>
													<th>Quantity</th>
													<th>Accepted Quantity</th>
													<th>Rejected Quantity</th>
													<th>Expiry Date</th>
													<th>Warehouse</th>
												</tr>
											</thead>
											<tbody class="appendData">
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<table id="subTableView" class="table table-bordered table-hover tableView" style="margin-top:20px;display:none;">
							<thead>
								<tr>
									<th>Sample</th>
								</tr>
							</thead>
							<tbody class="subTable">
							</tbody>
						</table>
						<table id="cloneTable" class="table table-bordered tableView" style="margin-top:20px;">
						</table>
						<table id="sequentialViewOrg" class="table table-bordered table-hover tableView" style="margin-top:20px;display:none;">
							<thead>
								<tr>
									<th>Code</th>
									<th>Resource Name</th>
									<th>Unit</th>
									<th>Quantity</th>
									<th>Accepted Quantity</th>
									<th>Rejected Quantity</th>
									<th>Expiry Date</th>
									<th>Warehouse</th>
								</tr>
							</thead>
							<tbody class="appendData">
							</tbody>
						</table>						
					</div>
					<input type="hidden" name="hidjson" id="hidjson">
				</div>
				<div class="row showDiv" id="sixthStep" style="display:none;">
					<h1 class="txt_center form_main_h1 frmwrk_h1">Quality Testing</h1>
					<div class="form-group">
						<div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
							<div class="row">						
								<div class="form-group req_flds col-lg-12">
									<div class="checkbox">
									  <label><input type="checkbox" name="Tested" id="Tested" value="1">Tested</label>
									</div>
								</div>	
							</div>	
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<input type="text" name="Testedby" id="Testedby" class="form-control lbl_move" label="Enter Tested By">
									<div class="error_message" style="display:none;"><p>Please enter Tested By...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<input type="text" name="Testingmethod" id="Testingmethod" class="form-control lbl_move" label="Enter Testing method">
									<div class="error_message" style="display:none;"><p>Please enter Testing method...</p> </div> 
								</div>
							</div>
							<div class="row">
								<div class="form-group req_flds col-lg-12">
									<input type="text" name="Testresult" id="Testresult" class="form-control lbl_move" label="Enter Test results">
									<div class="error_message" style="display:none;"><p>Please enter Test results...</p> </div> 
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="col-lg-12 savebtn_area">
    <ul>
        <li id="continueButton" class="dropdown save_btn float_r">
            <a href="javascript:void(0);" class="ripple">Continue</a>
        </li>
        <li id="backButton" class="cancel_btn float_r" style="display:none;"><a href="javascript:void(0);" class="ripple">back</a></li>
		 <li class="cancel_btn cancel_btn_bluecolor float_l"><a id="cancelbutton" class="ripple" onclick="alert confirm();">cancel</a></li>
    </ul>
</div>

<script>
var resId= [];
var resOldId = [];
var poId= [];
var poOldId = [];
var poResId = [];
var cost = '';
var nextStep = false;
$("#cancelbutton").click(function(){
    if(confirm("Are you sure you want to Cancel this min?"))
        $("#cancelbutton").attr("href", "<?php echo $this->basePath();?>/mms/min/display-register");
});

$('.datepickerinput').datepicker({
	format: "dd-mm-yyyy",
	todayBtn: true,
	orientation: "top auto",
	autoclose: true
}).on("changeDate", function(e){
	
});
function arrequal(arr1, arr2){
	var is_equal = arr1.length==arr2.length && arr1.every(function(v,i) { return ($.inArray(v,arr2) != -1)});
	return is_equal;
}
/*DataTable Start*/
var oTable = $("#sequentialView").dataTable({"aLengthMenu": [[1, 5, 10], [1, 5, 10]], "order": [],
	"initComplete": function(settings, json) {
		$("select[name=sequentialView_length]").addClass("show-tick").selectpicker();
	},	
	"drawCallback": function( settings ){
		$(this).find("tr.mainTr .totQuantity").trigger('click');
		if($('#sequentialView_next').hasClass('disabled') && $('#fifthStep').is(':visible'))
			$("#continueButton a").text("Submit");
		else
			$("#continueButton a").text("Continue");
	}	
});
function trimNumber(s){
  while (s.substr(0,1) == '0' && s.length>1) { s = s.substr(1,9999); }
  return s;
}
function changePage(){
	$(".quantityVal").unbind();
	$(".quantityVal").bind('focusin', function(e){
		var totWbsVal = $(this).closest("tr").find("td:nth-child(5)").text();
		var wbsVal = 0;
		var name = $(this).attr('name');
		$(this).closest("tr").find("input:text").each(function(){
			if($(this).attr('name') != name)
				wbsVal = parseFloat(wbsVal) + parseFloat($(this).val());
		});
		var total = parseFloat(totWbsVal) - parseFloat(wbsVal);			
		$(this).attr('data-original-title', 'Enter the value less than or equal to '+total);
		$(this).tooltip('show');
	});
	$(".quantityVal").bind('keyup keydown', function(e){
		var key = e.which || e.keyCode;
		var name = $(this).attr("name");
		var classname = $(this).attr('class-name');
		var eleName = $(this).attr('eleName');
		var resourceName = $(this).attr("resourceName");
		//$(this).tooltip('show');
		if(key != 9){
			var sum = 0;
			if($(this).val().indexOf(' ') > -1){
				$(this).val($(this).val().trim());
			}				
			if(isNaN($(this).val())){
				this.value = this.value.replace(/[^0-9\.]/g,'');
				if($(this).val().indexOf('.') > -1){
					var index = $(this).val().indexOf( '.' );
					this.value = this.value.substr( 0, index + 1 ) + this.value.slice( index ).replace( /\./g, '' );
				}
			}
			var ex = /^\d*(\.\d{0,6})?$/;
			if(!ex.test($(this).val())){
				$(this).val($(this).val().substring(0,$(this).val().length-1));
			}
			
			/*Total value validation*/	
			var totWbsVal = $(this).closest("tr").find("td:nth-child(5)").text();
			var wbsVal = 0;
			$(this).closest("tr").find("input:text").each(function(){
				wbsVal = parseFloat(wbsVal) + parseFloat($(this).val());
			});
			
			if(totWbsVal < wbsVal){
				 $(this).val(orgVal);
			}
			else{
				orgVal = $(this).val();
				$(this).closest('table').find("."+classname).each(function() {
					//add only if the value is number
					if (!isNaN(this.value) && this.value.length != 0) {
						sum += parseFloat(this.value);
					}
				});
				$("input[name="+eleName+"]").val(sum.toFixed(6));
				
				var posum = 0;
				$(this).closest('.poSubTr').find("."+$(this).attr('poclass-name')).each(function() {
					//add only if the value is number
					if (!isNaN(this.value) && this.value.length != 0) {
						posum += parseFloat(this.value);
					}
				});
				oTable.$("tr.mainTr").find("input[name="+resourceName+"]").val(posum.toFixed(6));				
			}
		}
	});
	$(".quantityVal").bind('blur', function(){
		var name = $(this).attr("name");
		var classname = $(this).attr('class-name');
		var eleName = $(this).attr('eleName');
		var resourceName = $(this).attr("resourceName");
		var sum = 0;
		if (!isNaN($(this).val()) && $(this).val().length != 0) {

		}
		else{
			$(this).val($(this).val().substring(0,$(this).val().length-1));
		}
		var ex = /^\d*(\.\d{0,6})?$/;
		if(!ex.test($(this).val())){
			$(this).val($(this).val().substring(0,$(this).val().length-1));
		}
		
		/*Total value validation*/	
		var totWbsVal = $(this).closest("tr").find("td:nth-child(5)").text();
		var wbsVal = 0;
		$(this).closest("tr").find("input:text").each(function(){
			wbsVal = parseFloat(wbsVal) + parseFloat($(this).val());
		});
		
		if(totWbsVal < wbsVal){
			  $(this).val(orgVal);
		}
		else{
			orgVal = $(this).val();
			$(this).closest('table').find("."+classname).each(function() {
				//add only if the value is number
				if (!isNaN(this.value) && this.value.length != 0) {
					sum += parseFloat(this.value);
				}
			});
			$("input[name="+eleName+"]").val(sum.toFixed(6));
			$("input[name="+eleName+"]").attr('value', sum.toFixed(6));
			
			var posum = 0;
			$(this).closest('.poSubTr').find("."+$(this).attr('poclass-name')).each(function() {
				//add only if the value is number
				if (!isNaN(this.value) && this.value.length != 0) {
					posum += parseFloat(this.value);
				}
			});
			oTable.$("tr.mainTr").find("input[name="+resourceName+"]").val(posum.toFixed(6));
			$("input[name="+resourceName+"]").val(posum.toFixed(6));
			$("input[name="+resourceName+"]").attr('value', posum.toFixed(6));
		}
		
		//$(this).val(parseInput($(this).val()));
		var val = 0;
		if($(this).val() == '' || $(this).val() == 0){
			val = val+'.000000';
		}
		else{
			$(this).val(trimNumber($(this).val()));
			val1 = $(this).val();
			var str = '000000';
			var splitVal = val1.split('.');
			var len = 6;
			if(splitVal[1]){
				len -= splitVal[1].length;
			}
			if(len == 6)
				val = val1+'.000000';
			else if(len < 0)
				val = splitVal[0]+'.'+splitVal[1].substring(0,6);
			else
				val = val1+str.substring(0,len);
			
			if(val.charAt(0) == '.')
				val = '0' + val;
		}

		
		$("input[name="+name+"]").attr("value", val);
		$("input[name="+name+"]").val(val);	
	});
}
function trClick(){
	oTable.$("tr.mainTr").find(".totQuantity").unbind();
	oTable.$("tr.mainTr").find(".totQuantity").bind('click', function(){
		if(!($(this).closest("tr.mainTr").next("tr").hasClass("duplicateTr"))){
			$(this).closest("tr.mainTr").after("<tr class='duplicateTr poSubTr'>"+$(".subTr_"+$(this).closest("tr.mainTr").attr("tid")).html()+"</tr>");
			changePage();
		}
	});
}
/*DataTable End*/
/*PO Grid Start*/
var poSource =
{
	localData: []/*<?php echo json_encode($wbsResult); ?>*/,
	dataType: "json",
	dataFields:
	[
		{ name: 'PONo', type: 'string' },
		{ name: 'PODate',  type: "date", format: 'MM/dd/yyyy' },
	],
	id:'PORegisterId'
};

var poDataAdapter = new $.jqx.dataAdapter(poSource,{
	loadComplete: function (data) {
		
	},
	loadError: function (xhr, status, error) {
		
	}
});
$("#poGrid").jqxGrid({
	width: '100%',
	pageable: true,
	selectionMode: 'singleRow',
	pagerButtonsCount: 6,
	autoheight:true,
	autorowheight: true,
	filterable: true,
	sortable: true,
	columnsResize: true,
	showfilterrow: true,
	ready: function(){
		var localizationobj = {};
		localizationobj.emptydatastring = "No PO to display";
		$("#poGrid").jqxGrid('localizestrings', localizationobj);
	},
	selectionmode: 'checkbox',						
	source: poDataAdapter,
	columns: [
	  { text: 'PO No', editable: false,datafield: 'PONo'},
	  { text: 'PO Date', filtertype: 'date', cellsformat: 'dd-MM-yyyy', editable: false,datafield: 'PODate'},
	]
});	
$('#poGrid').on('rowclick', function (event){
	var args = event.args;
	// row's bound index.
	var boundIndex = args.rowindex;
	var index = $('#poGrid').jqxGrid('selectedrowindexes'); 
	//alert($.inArray(boundIndex, index))
	if($.inArray(boundIndex, index) == -1)
		$('#poGrid').jqxGrid('selectrow', boundIndex);
	else
		$('#poGrid').jqxGrid('unselectrow', boundIndex);
});	
/*PO Grid End*/
/*Resource Grid Start*/
var resSource =
{
	localData: []/*<?php echo json_encode($wbsResult); ?>*/,
	dataType: "json",
	dataFields:
	[
		{ name: 'Resource', type: 'string' },
		{ name: 'PONo', type: 'string' },
		{ name: 'POQty', type: 'string' },
	],
	id:'ResourceId'
};

var resDataAdapter = new $.jqx.dataAdapter(resSource,{
	loadComplete: function (data) {
		
	},
	loadError: function (xhr, status, error) {
		
	}
});
$("#resourceGrid").jqxGrid({
	width: '100%',
	pageable: true,
	selectionMode: 'singleRow',
	pagerButtonsCount: 6,
	autoheight:true,
	autorowheight: true,
	filterable: true,
	sortable: true,
	columnsResize: true,
	showfilterrow: true,
	ready: function(){
		var localizationobj = {};
		localizationobj.emptydatastring = "No Resource to display";
		$("#resourceGrid").jqxGrid('localizestrings', localizationobj);
	},
	selectionmode: 'checkbox',						
	source: resDataAdapter,
	columns: [
	  { text: 'Resource', editable: false,datafield: 'Resource'},
	  { text: 'PO Number & Project', editable: false,datafield: 'PONo'},
	  { text: 'Total Quantity', editable: false,datafield: 'POQty'},
	]
});	
$('#resourceGrid').on('rowclick', function (event){
	var args = event.args;
	// row's bound index.
	var boundIndex = args.rowindex;
	var index = $('#resourceGrid').jqxGrid('selectedrowindexes'); 
	//alert($.inArray(boundIndex, index))
	if($.inArray(boundIndex, index) == -1)
		$('#resourceGrid').jqxGrid('selectrow', boundIndex);
	else
		$('#resourceGrid').jqxGrid('unselectrow', boundIndex);
});	
/*Resource Grid End*/
/*Back Button Start*/
$('#backButton').click(function(){
	var ele = $(".showDiv:visible");
	$('#continueButton').find('a').text("continue");
	if($(".showDiv:visible").index() != $(".showDiv:first").index()){
		$(".showDiv:visible").prev(".showDiv").show();
		ele.hide();
		if($(".showDiv:visible").index() == $(".showDiv:first").index())
			$(this).hide();
	}
});
/*Back Button End*/
/*Continue Button Start*/
$('#continueButton').click(function(){
	$('.error_message').hide();
	$('#backButton').show();
	var ele = $(".showDiv:visible");
	var bool = true;
	var formData = [];
	ele.find("input, select, textarea").each(function(){
		var tagname = $(this).prop("tagName").toLowerCase();
		if(tagname =='input'){
			var type = $(this).attr("type");
			if(type =='text' ){
				if($(this).is(":visible") && $(this).val().trim() == ''){
					bool=false;
					$(this).focus();
					$(this).closest('.row').find('.error_message').show();
					return false;
				}
			}
		}
		else if(tagname =='select'){
			if($(this).val() == -1){
				bool = false;
				$(this).focus();
				$(this).closest('.row').find('.error_message').show();
				return false;		
			}
		}
	});
	if($('#poGrid').is(':visible')){
		var index = $("#poGrid").jqxGrid("getselectedrowindexes");
		if(index.length == 0){
			alert('Atleaset select one po to proceed further');
			return false;
		}
	}
	else if($('#resourceGrid').is(':visible')){
		var index = $("#resourceGrid").jqxGrid("getselectedrowindexes");
		if(index.length == 0){
			alert('Atleaset select one Resource to proceed further');
			return false;
		}
	}
	if(bool){
		if($(".showDiv:visible").index() != $(".showDiv:last").index()){
			$(".showDiv:visible").next(".showDiv").show();
			ele.hide();
			if($(".showDiv:visible").index() == $(".showDiv:last").index())
				$(this).find('a').text("submit");
		}
		else{
			$('form').submit(); 
		}
	}
	if($(".showDiv:visible").index() >= 2){
		var ajaxStatus = false;
		if($(".showDiv:visible").index() == 2){
			if(cost != $('#project_name').val()){
				$('#poGrid').jqxGrid("showloadelement");
				formData.push({name:'cost', value: $('#project_name').val()}, {name:'mode', value:'poList'});
				ajaxStatus = true;
				cost = $('#project_name').val();
				nextStep=true;
			}
		}
		else if($(".showDiv:visible").index() == 3){
			poId=[];
			var index = $("#poGrid").jqxGrid("getselectedrowindexes");
			for(var i in index){
				poId.push($("#poGrid").jqxGrid("getrowid", index[i]));
			}
			if(!arrequal(poOldId, poId) || nextStep){
				$('#resourceGrid').jqxGrid("showloadelement");
				ajaxStatus = true;
				formData.push({name:'cost', value:$('#project_name option:selected').text()}, {name:'poId', value:poId}, {name:'mode', value:'resList'});
				$("#sel_poId").val(poId);
			}
			nextStep = false;
		}
		else if($(".showDiv:visible").index() == 4){
			resId=[];
			var index = $("#resourceGrid").jqxGrid("getselectedrowindexes");
			for(var i in index){
				resId.push($("#resourceGrid").jqxGrid("getrowid", index[i]));
			}
			if(!arrequal(resOldId, resId) || !arrequal(poResId, poId)){
				ajaxStatus = true;
				$('#sel_resourceId').val(resId);
				formData.push({name:'resId', value:resId}, {name:'poId', value:poId}, {name:'mode', value:'dataList'});
			}
		}
		if(ajaxStatus){
			$.ajax({
				url:getBaseURL()+"mms/min/entry-edit",
				type:"post",
				data:formData,
				dataType:"json",
				success:function(data, textStatus, jqXHR){
					if($(".showDiv:visible").index() == 2){
						/*PO Grid data bind Start*/
						var poRowId = [];
						var index1 = $('#poGrid').jqxGrid('selectedrowindexes'); 
						for(var i in index1){
							poRowId.push($('#poGrid').jqxGrid('getrowid', index1[i]));
						}
						
						poSource.localdata = data['data'];
						poDataAdapter.dataBind();
						var index1 = $('#poGrid').jqxGrid('selectedrowindexes'); 
						if(index1.length > 0)
							$('#poGrid').jqxGrid('clearselection');
						
						for(var id in poRowId){
							var ind = $('#poGrid').jqxGrid('getrowboundindexbyid', poRowId[id]);
							if(ind != -1)
								$('#poGrid').jqxGrid('selectrow', ind);
						}
						$('#poGrid').jqxGrid("hideloadelement");
						/*PO Grid data bind End*/
					}
					else if($(".showDiv:visible").index() == 3){
						/*Resource Grid data bind Start*/
						var resRowId = [];
						var index1 = $('#resourceGrid').jqxGrid('selectedrowindexes'); 
						for(var i in index1){
							resRowId.push($('#resourceGrid').jqxGrid('getrowid', index1[i]));
						}
						
						resSource.localdata = data;
						resDataAdapter.dataBind();
						
						if(index1.length > 0)
							$('#resourceGrid').jqxGrid('clearselection');
						
						for(var id in resRowId){
							var ind = $('#resourceGrid').jqxGrid('getrowboundindexbyid', resRowId[id]);
							if(ind != -1)
								$('#resourceGrid').jqxGrid('selectrow', ind);
						}
						$('#resourceGrid').jqxGrid("hideloadelement");
						/*Resource Grid data bind End*/
					}
					else if($(".showDiv:visible").index() == 4){
						/*DataTable Grid Start*/
						var json = [];
						oTable.fnClearTable();
						$("#cloneTable").html($("#subTableView").html());
						$("#subTableView tbody:first").html("");
						$('#sequentialViewOrg tbody').html('');
						$.each(data, function(i,v){
							var jsonObj = {};
							jsonObj.resId = v.ResourceId;
							var ai = oTable.fnAddData([v.Code,
												v.ResourceName,
												v.UnitName,
												parseFloat(v.Quantity).toFixed(6),
												"<input type='text' readonly class='tbl_input totQuantity' value='"+parseFloat(0).toFixed(6)+"' name='acceptedQty_"+v.ResourceId+"' id='acceptedQty_"+v.ResourceId+"'>",
												"<input type='text' readonly class='tbl_input' value='"+parseFloat(0).toFixed(6)+"' name='rejectedQty_"+v.ResourceId+"' id='rejectedQty_"+v.ResourceId+"'>",
												"<div class='row'>"+
													"<div class='form-group col-lg-12'>"+
														"<span class='date_icon'><i class='fa fa-calendar'></i></span>"+
														"<input type='text' name='expiryddate_"+v.ResourceId+"' id='expiryddate_"+v.ResourceId+"' class='tbl_input datepickerinput changeVal' value='<?php echo Date('d-m-Y'); ?>' />"+
													"</div>"+
												"</div>",
												"<input type='text' class='tbl_input changeVal' name='warehouse_"+v.ResourceId+"' id='warehouse_"+v.ResourceId+"'>",
											]);
					
							var n = oTable.fnSettings().aoData[ai[0]].nTr;
							n.setAttribute('tid', v.ResourceId);
							n.setAttribute('class', "mainTr deleteTr_"+v.ResourceId);
							$('#sequentialViewOrg tbody').append(
								'<tr>'+
									'<td>'+v.Code+'</td>'+
									'<td>'+v.ResourceName+'</td>'+
									'<td>'+v.UnitName+'<input type="hidden" name="unitId_'+v.ResourceId+'" id="unitId_'+v.ResourceId+'" value="'+v.UnitId+'"></td>'+
									'<td>'+parseFloat(v.Quantity).toFixed(6)+'</td>'+
									'<td><input type="text" class="tbl_input changeVal" value="'+parseFloat(0).toFixed(6)+'" name="acceptedQty_'+v.ResourceId+'" id="acceptedQty_'+v.ResourceId+'"></td>'+
									'<td><input type="text" class="tbl_input totQuantity" value="'+parseFloat(0).toFixed(6)+'" name="rejectedQty_'+v.ResourceId+'" id="rejectedQty_'+v.ResourceId+'"></td>'+
									'<td>'+
										'<div class="row">'+
											'<div class="form-group col-lg-12">'+
												'<span class="date_icon"><i class="fa fa-calendar"></i></span>'+
												'<input type="text" name="expiryddate_'+v.ResourceId+'" id="expiryddate_'+v.ResourceId+'" class="tbl_input datepickerinput" value="<?php echo Date('d-m-Y'); ?>" />'+
											'</div>'+
										'</div>'+
									'</td>'+
									'<td><input type="text" class="tbl_input changeVal" name="warehouse_'+v.ResourceId+'" id="warehouse_'+v.ResourceId+'"></td>'+
								'</tr>');
							
							$('#subTableView tbody:first').append(
								'<tr class="subTr_'+v.ResourceId+'">'+
									'<td colspan=8>'+
										'<div class="subDiv">'+
											'<table class="table table-bordered">'+
												'<thead>'+
													'<tr>'+
														'<th>Order Date</th>'+
														'<th>Order No</th>'+
														'<th>Req Date</th>'+
														'<th>Order Qty</th>'+
														'<th>Accepted Qty</th>'+
														'<th>Rejected Qty</th>'+
													'</tr>'+
												'</thead>'+
												'<tbody>');
							jsonObj.poId = [];
							$.each(v['poList'], function(poi,pov){
								poRegisterIdObj = {};
								if($.inArray(pov.PORegisterId, poResId) == -1 || $.inArray(v.ResourceId, resOldId) == -1){
									poRegisterIdObj.PORegisterId = pov.PORegisterId;
									$("#subTableView .subTr_"+v.ResourceId+" tbody:first").append(
														'<tr style="background-color:#f0f2f2;" id="poTr_'+v.ResourceId+'_'+pov.PORegisterId+'">'+
															'<td></td>'+
															'<td>'+pov.PONo+'</td>'+
															'<td></td>'+
															'<td>'+parseFloat(pov.Quantity).toFixed(6)+'</td>'+
															'<td class="tbl_input_td"><input type="text" class-name="acceptPOQty" '+((pov['wbs'].length>0)?'readonly':'')+' class="parent_txts tbl_input acceptPOQty" eleName="acceptQty_'+v.ResourceId+'" name="acceptPOQty_'+v.ResourceId+'_'+pov.PORegisterId+'" value="'+parseFloat(0).toFixed(6)+'"></td>'+
															'<td class="tbl_input_td"><input type="text" class-name="rejectPOQty" '+((pov['wbs'].length>0)?'readonly':'')+' class="parent_txts tbl_input rejectPOQty" eleName="rejectQty_'+v.ResourceId+'" name="rejectPOQty_'+v.ResourceId+'_'+pov.PORegisterId+'" value="'+parseFloat(0).toFixed(6)+'"></td>'+
														"</tr>");
												
										$("#subTableView .subTr_"+v.ResourceId+" tbody:first").append(
														'<tr class="backgroundtr_vendor">'+
															'<td colspan=7>'+
																'<div class="subDiv">'+
																	'<table class="table">'+
																		'<thead>'+
																			'<tr>'+
																				'<th width="8%" style="border-left:none !important; border-top:none !important; border-bottom:none !important; background-color:#eefdfe !important; border-right:1px solid #ddd !important;"></th>'+
																				'<th class="vendor_entrytableborder">WBS Name</th>'+
																				'<th class="vendor_entrytableborder">Order Qty</th>'+
																				'<th class="vendor_entrytableborder">GRN Qty</th>'+
																				'<th class="vendor_entrytableborder">Balance qty</th>'+
																				'<th class="vendor_entrytableborder">Accepted Qty</th>'+
																				'<th class="vendor_entrytableborder">Rejected Qty</th>'+
																			'</tr>'+
																		'</thead>'+
																		'<tbody>');	
											poRegisterIdObj.wbsId = [];
											$.each(pov['wbs'], function(wi,wv){
												poRegisterIdObj.wbsId.push(wv.AnalysisId);
												$('#subTableView tbody:last').append(
																			'<tr>'+
																				'<td width="8%" class="vendor_entryfortable"></td>'+
																				'<td class="vendor_entrytableborder">'+wv.WBSName+' <input type="hidden" class="form-control" name="wbsName_'+v.ResourceId+'_'+pov.PORegisterId+'_'+wv.AnalysisId+'" value="'+wv.AnalysisId+'"></td>'+
																				'<td class="vendor_entrytableborder"></td>'+
																				'<td class="vendor_entrytableborder"></td>'+
																				'<td class="vendor_entrytableborder">'+parseFloat(wv.Quantity).toFixed(6)+'</td>'+
																				'<td class="tbl_input_td vendor_entrytableborder"><input type="text" class-name="acceptWBSQty" poclass-name="acceptPOQty" class="parent_txts tbl_input quantityVal acceptWBSQty" resourceName="acceptedQty_'+v.ResourceId+'" eleName="acceptPOQty_'+v.ResourceId+'_'+pov.PORegisterId+'" name="acceptWbs_'+v.ResourceId+'_'+pov.PORegisterId+'_'+wv.AnalysisId+'" value="'+parseFloat(0).toFixed(6)+'" autocomplete="off" data-toggle="tooltip" data-title="zsdfzdf" data-placement="top" data-trigger=""></td>'+
																				'<td class="tbl_input_td vendor_entrytableborder"><input type="text" class-name="rejectWBSQty" poclass-name="rejectPOQty" class="parent_txts tbl_input quantityVal rejectWBSQty" resourceName="rejectedQty_'+v.ResourceId+'" eleName="rejectPOQty_'+v.ResourceId+'_'+pov.PORegisterId+'" name="rejectWbs_'+v.ResourceId+'_'+pov.PORegisterId+'_'+wv.AnalysisId+'" value="'+parseFloat(0).toFixed(6)+'" autocomplete="off" data-toggle="tooltip" data-title="zsdfzdf" data-placement="top" data-trigger=""></td>'+
																			"</tr>");											
											});
											$('#poTr_'+v.ResourceId+'_'+pov.PORegisterId).attr('jsonVal', JSON.stringify(poRegisterIdObj));
											$("#subTableView tbody:last").append(
																		'</tbody>'+
																	'</table>'+
																'</div>'+
															'</td>'+
														'</tr>');
								}
								else{
									$('#subTableView .subTr_'+v.ResourceId+' tbody:first').append($('#cloneTable #poTr_'+v.ResourceId+'_'+pov.PORegisterId).clone());
									$('#subTableView .subTr_'+v.ResourceId+' tbody:first').append($('#cloneTable #poTr_'+v.ResourceId+'_'+pov.PORegisterId).next("tr").clone());
									
									
									var acceptPOQty = parseFloat($('#cloneTable #poTr_'+v.ResourceId+'_'+pov.PORegisterId).find('.acceptPOQty').val()) + parseFloat($('#sequentialViewOrg input[name=acceptedQty_'+v.ResourceId+']').val());
									var rejectPOQty = parseFloat($('#cloneTable #poTr_'+v.ResourceId+'_'+pov.PORegisterId).find('.rejectPOQty').val()) + parseFloat($('#sequentialViewOrg input[name=rejectedQty_'+v.ResourceId+']').val());
									
									oTable.$('input[name=acceptedQty_'+v.ResourceId+']').val(acceptPOQty.toFixed(6))
									oTable.$('input[name=rejectedQty_'+v.ResourceId+']').val(rejectPOQty.toFixed(6))
									
									$('input[name=acceptedQty_'+v.ResourceId+']').val(acceptPOQty.toFixed(6));
									$('input[name=acceptedQty_'+v.ResourceId+']').attr('value', acceptPOQty.toFixed(6));
									$('input[name=rejectedQty_'+v.ResourceId+']').val(rejectPOQty.toFixed(6));
									$('input[name=rejectedQty_'+v.ResourceId+']').attr('value', rejectPOQty.toFixed(6));
									poRegisterIdObj = $.parseJSON($('#cloneTable #poTr_'+v.ResourceId+'_'+pov.PORegisterId).attr("jsonVal"));
								}
								
							});
							
							$(".subTr_"+v.ResourceId+" tbody:first").append(
												'</tbody>'+
											'</table>'+
										'</div>'+
									'</td>'+
								'</tr>');
							
							oTable.$("tr.mainTr").find("#expiryddate_"+v.ResourceId).datepicker({
								format: "dd-mm-yyyy",
								startDate: new Date(),
								todayBtn: true,
								orientation: "top auto",
								autoclose: true
							}).on("changeDate", function(e){
								$('#sequentialViewOrg input[name='+$(this).attr('name')+']').val($(this).val());
							});
							jsonObj.poId.push(poRegisterIdObj);
							json.push(jsonObj);
						});
						$("#hidjson").val(JSON.stringify(json));
						trClick();
						oTable.$("tr.mainTr").find(".totQuantity").trigger("click");
						$("#cloneTable").html('');
						$('input[data-toggle="tooltip"]').tooltip();
						poResId = poId;
						/*DataTable Grid End*/
					}
				},
				complete:function(data){
					poOldId = poId;
					resOldId = resId;
				},
				error:function(jqXHR, textStatus, errorThrown){
					console.log(textStatus+"-----"+errorThrown);
				}
			});
		}
	}
});
/*Continue Button End*/
</script>