<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css';?>"/>

<style type="text/css">
    .sub_tbl1 {color:#424120;font-weight: 600; background: #c4d2ef !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{color: #424141;font-weight: 600; background: #9ac4d1 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl3{color: #424141;font-weight: 600; background: #97d5b0 !important;border-bottom: 2px solid #bfefd6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .diff_txt{height:42px !important;}
    .pan_box{height:100px !important;}
    .lbl_stl{margin-bottom: 10px;}
    .date_icon{top:10px!important;right:22px !important;}
    .table-responsive {overflow-x: inherit !important;}
    .bar1, .bar2, .bar3 {width: 18px;height: 3px;background-color: #009688;margin: 3px 0;transition: 0.4s;}
    .change .bar1 {-webkit-transform: rotate(-45deg) translate(-6px, 5px);transform: rotate(-45deg) translate(-6px,5px);}
    .change .bar2 {opacity: 0;}
    .change .bar3 {-webkit-transform: rotate(45deg) translate(-3px, -3px);transform: rotate(45deg) translate(-3px, -3px);}
    .flip0{float:right;margin-top:5px;cursor:pointer;}
    .lbl_ptb {padding-top: 5px!important;padding-bottom:5px !important;}
    .selected-xs{width:50%!important;border:0px solid #babdb8!important;}
    .selected-xs select{height:20px;color: #266aa8; padding-left:0px !important; font-size:13px !important;cursor:pointer;}
    .select-style {float: left;width: 100%;padding: 0;margin: 0;border: 1px solid #c2c2c2;overflow: hidden;background-color: #fff;border-radius: 0px;}
    .margn_8{margin-bottom:8px;}
</style>
<!--STYLE-->
<!--content-->
<?php
echo $this->headLink(array('rel' => 'shortcut icon', 'type' => 'image/vnd.microsoft.icon', 'href' => $this->basePath() . '/images/favicon.ico'))
    ->appendStylesheet($this->basePath() . '/library/fileupload/css/demo.css')
    ->appendStylesheet($this->basePath() . '/library/fileupload/css/uploader.css')
    ->appendStylesheet($this->basePath() . '/css/select2.min.css');
?>
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/mms/min/minsave">
<input type="hidden" name="CostCenterId"  id="CostCenterId"value="<?php echo (isset($CostCentre)) ? $CostCentre : '';?>">
<input type="hidden" name="DcId" value="<?php echo (isset($dcid)) ? $dcid : 0;?>">
<input type="hidden" name="VendorId" id="VendorId" value="<?php echo (isset($Supplier)) ? $Supplier : $VendorId;?>">
<input type="hidden" name="Type" id="Type" value="<?php echo (isset($Type)) ? $Type : '';?>">
<input type="hidden" name="DCdate" id="DCdate" value="<?php echo (isset($DCdate)) ? $DCdate : '';?>">
<input type="hidden" name="poTransIds[]" id="poTransIds" value="<?php echo (isset($poTransIds)) ? $poTransIds : '';?>">
<input type="hidden" name="isWareHouse" id="isWareHouse" value="<?php echo (isset($isWareHouse)) ? $isWareHouse : '';?>">
<input type="hidden" id="gridtype" name="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : 0;?>">



<div class="col-lg-12">
    <h1 class="col-lg-3">MIN Entry
        <div class="flip0">
            <div class="click" onclick="myFunction(this)">
                <div class="bar1"></div>
                <div class="bar2"></div>
                <div class="bar3"></div>
            </div>
        </div>
    </h1>
</div>
<div class="col-lg-12">
    <div class="pane0">
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>
                    <li class="lbl_ptb">
                        <label>MIN No</label>
                        <span class="mgic"><input type="text" placeholder="xxxxx" id="PONo" name="PONo" value="<?php echo (isset($vNo)) ? $vNo : ''; ?> "readonly /></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Cost Centre</label>
                        <span class="mgic"><?php echo (isset($CostCentreName)) ? $CostCentreName : '';?></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Vendor</label>
                        <span class="mgic"><?php echo (isset($VendorName)) ? $VendorName : '';?></span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>
                    <li class="lbl_ptb">
                        <label >Site MIN No</label>
                        <span class="mgic"><input type="text" placeholder="" id="SiteDCNo" name="SiteDCNo" value="<?php echo (isset($SiteDCNo)) ? $SiteDCNo : '';?> "/></span>
                    </li>
                    <li class="lbl_ptb">
                        <label >Site MIN Date</label>
                        <span class="mgic"><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="SiteDCDate" name="SiteDCDate" value="<?php echo (isset($SiteDCDate)) ? $SiteDCDate : date('d-m-Y');?>" onChange="validateDate(this)" readonly/></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Ref No</label>
                        <span class="mgic"><input type="text" placeholder="" id="RefNo" name="RefNo" value="<?php echo (isset($RefNo)) ? $RefNo : '';?>"/></span>
                    </li>

                </ul>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>

                    <li class="lbl_ptb">
                        <label>Gate Pass No</label>
						<span>
							<div class="select-style selected-xs margn_8">
                                <select name="GatePassNo" id="GatePassNo" class="" data-placeholder="GatePass No">
                                    <option value="">Select Gate Pass No</option>
                                    <option> None </option>
                                    <?php
                                    foreach ($arr_gatepass as $gatepass) {
                                        if(isset($GatePassNo)) { ?>
                                            <option value="<?php echo $gatepass['GatePassNo']; ?>" <?php echo ($gatepass['GatePassNo'] == $GatePassNo) ? 'selected' : ''; ?>><?php echo $gatepass['GatePassNo']; ?></option>

                                        <?php  }
                                        else{ ?>
                                            <option value="<?php echo $gatepass['GatePassNo']; ?>" >  <?php echo $gatepass['GatePassNo']; ?> </option>
                                        <?php    }
                                    } ?>

                                </select>
                            </div>
						</span>
                    </li>
                    <li class="lbl_ptb">
                        <label >CMIN No</label>
                        <?php if((((isset($dcid)) ? $dcid : 0) >0  || $CMin['genType']==0)){?>
                            <span class="mgic"><input type="text" placeholder="" id="CDCNo" name="CDCNo" value="<?php echo (isset($CDCNo)) ? $CDCNo : '';?> "/></span>
                        <?php }else{ ?>
                            <span class="mgic"><input type="text" placeholder="" id="CDCNo" name="CDCNo" value="<?php echo (isset($CDCNo)) ? $CDCNo : '';?> " readonly/></span>
                        <?php } ?>
                    </li>
                    <li class="lbl_ptb">
                        <label  >CC MIN No</label>
                        <?php if((((isset($dcid)) ? $dcid : 0) >0  || $CCMin['genType']==0)){?>
                            <span class="mgic"><input type="text" placeholder="" id="CCDCNo" name="CCDCNo" value="<?php echo (isset($CCDCNo)) ? $CCDCNo : '';?> "/></span>
                        <?php }else{ ?>
                            <span class="mgic"><input type="text" placeholder="" id="CCDCNo" name="CCDCNo" value="<?php echo (isset($CCDCNo)) ? $CCDCNo : '';?> " readonly /></span>
                        <?php } ?>
                    </li>
                    <li class="lbl_ptb">
                        <input type="hidden"  id="approve" name="approve" value="<?php echo (isset($approve)) ? $approve : '';?> ">
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div class="col-lg-12 clear top-20">
<div id="accordion" class="panel-group">
<!-------------------------------Bill of Quantities------------------------------->
<div class="panel panel-info">
    <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
        <h4 class="panel-title accordion-toggle defa_panels">MIN Quantity</h4>
    </div>
    <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-12">
                <div class="table-responsive top-30">
                    <table class="table" style=" margin-bottom:0px;" id="workorderTable">
                        <thead>
                        <tr>
                            <th>Resource</th>
                            <th>Unit</th>
                            <th>MIN Qty</th>
                            <th>Accept Qty</th>
                            <th>Reject Qty</th>
                            <th>Expiry Date</th>
                            <th>Remarks</th>
                            <th>&nbsp;</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="main"></tbody>
                        <tbody class="total">
                        </tbody>
                    </table>
                    <input type="hidden" name="rowid" id="rowid" value="0"/>
                </div>
                <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                    <ul>
                        <li><a href="javascript:void(0);" onclick="validateResource();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-------------------------------/Bill of Quantities end------------------------------->
<!-------------------------------Trip Sheet------------------------------->

<div class="panel panel-info">
    <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
        <h4 class="panel-title accordion-toggle defa_panels">Trip Sheet</h4>
    </div>
    <div class="panel-collapse collapse collapseTwo" id="" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-12">
                <div class="col-lg-4 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-2 col-sm-offset-0 col-xs-12 col-xs-offset=0 mar_tpbm">
                    <div class="polymer-form">
                        <select name="vehicleId" id="vehicleId"  class="single_dropdown lbl_move select2-hidden-accessible"
                                style="width:100%;" label="Vehicle Reg.No." tabindex="-1" aria-hidden="true">
                            <option value="">Select vehicle</option>
                            <option>None</option>
                            <?php if(isset($arr_vehicle)) {
                                foreach ($arr_vehicle as $vehicles) {
                                    if(isset($vehicleData)){ ?>
                                        <option value="<?php echo $vehicles['VehicleId']; ?>" <?php echo ($vehicles['VehicleId'] == $vehicleData['VehicleId']) ? 'selected' : ''; ?>><?php echo $vehicles['VehicleRegNo']; ?></option>
                                    <?php }
                                    else{ ?>
                                        <option value="<?php echo $vehicles['VehicleId']; ?>"><?php echo $vehicles['VehicleRegNo']; ?></option>
                                    <?php }
                                }
                            }?>
                        </select>
                        <div class="error_message">
                            <p>Please select the vehicle...</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-2 col-sm-offset-0 col-xs-12 col-xs-offset=0 mar_tpbm">
                    <input type="text" name="VehicleName" id="VehicleName" class="diff_txt" placeholder="Vehicle Name" value="<?php echo isset($vehicleData['VehicleName']) ? $vehicleData['VehicleName']:''; ?>" readonly>
                    <div class="error_message">
                        <p>Please select the vehicle Name...</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive">
                    <p class="par_stl">a)Body Level Measurement Above Body Level</p>
                    <table class="table bm" id="b1">
                        <tr>
                            <div class="col-lg-3">
                                <input type="text" name="bLength" id="bLength" style="text-align:right;" onchange = "btotal();"  class="vhle_txt" placeholder="Length" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"   value="<?php echo isset($vehicleData['BLLen']) ? $vehicleData['BLLen']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="bBreadth" id="bBreadth" style="text-align:right;" onchange="btotal();"  class="vhle_txt" placeholder="Breadth" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['BLBreadth']) ? $vehicleData['BLBreadth']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="bHeight" id="bHeight" style="text-align:right;" onchange="btotal();"  class="vhle_txt" placeholder="Height"onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['BLHeight']) ? $vehicleData['BLHeight']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="bQty" id="bQty"  style="text-align:right;" readonly class="vhle_txt" placeholder="Qty" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['BLQty']) ? $vehicleData['BLQty']:''; ?>">
                            </div>
                        </tr>
                    </table>
                </div>
                <div class="table-responsive">
                    <p class="par_stl">b)Tapper Size Maximum</p>
                    <table class="table bm" id="t1">
                        <tr>
                            <div class="col-lg-3">
                                <input type="text" name="tMaxLength" id="tMaxLength" style="text-align:right;" onchange = "tMaxTot();" class="vhle_txt" placeholder="Length"onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMAXLen']) ? $vehicleData['TSMAXLen']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMaxBreadth" id="tMaxBreadth" style="text-align:right;"  onchange = "tMaxTot();" class="vhle_txt" placeholder="Breadth" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMAXBreadth']) ? $vehicleData['TSMAXBreadth']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMaxHeight" id="tMaxHeight" style="text-align:right;"  onchange = "tMaxTot();" class="vhle_txt"  placeholder="Height"  onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMAXHeight']) ? $vehicleData['TSMAXHeight']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMaxQty" id="tMaxQty" style="text-align:right;" readonly class="vhle_txt" placeholder="Qty" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMAXQty']) ? $vehicleData['TSMAXQty']:''; ?>">
                            </div>
                        </tr>
                    </table>
                </div>
                <div class="table-responsive">
                    <p class="par_stl">c)Tapper Size Minimum</p>
                    <table class="table bm" id="t2">
                        <tr>
                            <div class="col-lg-3">
                                <input type="text" name="tMinLength" id="tMinLength"  style="text-align:right;" onchange = "tMinTot();" class="vhle_txt" placeholder="Length" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMinLen']) ? $vehicleData['TSMinLen']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMinBreadth" id="tMinBreadth" style="text-align:right;" onchange = "tMinTot();" class="vhle_txt"  placeholder="Breadth" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  value="<?php echo isset($vehicleData['TSMinBreadth']) ? $vehicleData['TSMinBreadth']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMinHeight" id="tMinHeight" style="text-align:right;"  onchange = "tMinTot();" class="vhle_txt" placeholder="Height"onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"   value="<?php echo isset($vehicleData['TSMinHeight']) ? $vehicleData['TSMinHeight']:''; ?>">
                            </div>
                            <div class="col-lg-3">
                                <input type="text" name="tMinQty" id="tMinQty" style="text-align:right;"  readonly class="vhle_txt" placeholder="Qty" value="<?php echo isset($vehicleData['TSMinQty']) ? $vehicleData['TSMinQty']:''; ?>">
                            </div>
                        </tr>
                    </table>
                </div>
                <div class="table-responsive">
                    <table class="table bl" id="total">
                        <tr>
                            <div class="col-lg-4 mar_tb">
                                <label class="lbl_stl" style="text-align:center;"> d) Total (b+c) <label>
                            </div>
                            <div class="col-lg-4 mar_tb">
                                <label class="lbl_stl" style="text-align:center;">e) 50% Above of (d) Quantity<label>
                            </div>
                            <div class="col-lg-4 mar_tb">
                                <label class="lbl_stl" style="text-align:center;">Net Quantity for the Trip (a+e)<label>
                            </div>
                        </tr>
                        <tr>
                            <div class="col-lg-4 mar_tb">
                                <input type="text" name="bctotal" id="bctotal" readonly class="vhle_txt" style="text-align:right;"  placeholder="Qty" value="<?php echo isset($vehicleData['Total1']) ? $vehicleData['Total1']:''; ?>">
                            </div>
                            <div class="col-lg-4 mar_tb">
                                <input type="text" name="perQty" id="perQty" readonly class="vhle_txt"  style="text-align:right;" placeholder="Qty" value="<?php echo isset($vehicleData['Total2']) ? $vehicleData['Total2']:''; ?>">
                            </div>
                            <div class="col-lg-4 mar_tb">
                                <input type="text" name="netQty" id="netQty" readonly class="vhle_txt"  style="text-align:right;"  placeholder="Qty" value="<?php echo isset($vehicleData['NetTotal']) ? $vehicleData['NetTotal']:''; ?>">
                            </div>
                        </tr>
                    </table>
                </div>
                <div class="table-responsive">
                    <table class="table tx" id="total">
                        <tr>
                            <label class="lbl_stl" style="text-align:center;">Trip Sheet Remarks<label>
                        </tr>
                        <tr>
                            <div class="col-lg-12">
                                <textarea class="exp-tex" name="remarks" id="remarks"><?php echo isset($vehicleData['Remarks']) ? $vehicleData['Remarks']:''; ?></textarea>
                            </div>
                        </tr>
                    </table>
                </div>
                <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5 top-5">
                    <ul>
                        <li><a href="javascript:void(0);" onclick="nextAccordian(4,2);">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-------------------------------/Trip Sheet------------------------------->
<!-------------------------------Others Details------------------------------->
<div class="panel panel-info">
    <div data-target="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-4">
        <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
    </div>
    <div class="panel-collapse collapse " id="collapseFour" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="clearfix"></div>
            <div class="col-lg-12">
                <div class="card">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#nar" aria-controls="naration" role="tab" data-toggle="tab">Narration</a></li>
                        <li class=""><a href="#sample1" aria-controls="sample1" role="tab" data-toggle="tab">Weigh Bridge</a></li>
                        <li class=""><a href="#sample2" aria-controls="sample2" role="tab" data-toggle="tab">Quality Testing Details</a></li>
                        <li class=""><a href="#sample3" aria-controls="sample3" role="tab" data-toggle="tab">Vehicle Images</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="nar">
                            <p>
                            <div class="col-lg-12">
                                <?php
                                if(isset($Narration)){
                                    ?>
                                    <textarea class="exp-tex" name="Narration" id="Narration"><?php echo (isset($Narration)) ? $Narration : 'Enter your Notes.......';?></textarea>
                                <?php }else{ ?>
                                    <textarea class="exp-tex" name="Narration" id="Narration" placeholder="Enter your Notes..."></textarea>
                                <?php } ?>
                            </div>
                            </p>
                        </div>
                        <div class="tab-pane" id="sample1">
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <table class="table" style=" margin-bottom:0px;" id="taskTable">
                                        <thead>
                                        <tr>
                                            <td align="left" class="atr_clr">With Load(a)</td>
                                            <td width="25%" ><input type="text" name="WithLoad" id="WithLoad" style="text-align:right;"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)" onchange = "loadTot();" class="diff_txt" placeholder="" value="<?php echo (isset($WithLoad)) ? $WithLoad : '';?>"/>
                                            <td align="left" class="atr_clr"> Without Load(b)</td>
                                            <td width="25%" ><input type="text" name="WithOutLoad" id="WithOutLoad" style="text-align:right;"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)"   onchange = "loadTot();" class="diff_txt" placeholder="" value="<?php echo (isset($WithOutLoad)) ? $WithOutLoad : '';?>"/>
                                            <td align="left" class="atr_clr">Material Weigh(c=a-b)</td>
                                            <td width="25%" ><input type="text" name="MaterialWeigh" id="MaterialWeigh"  style="text-align:right;"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)"  onchange = "loadTot();" class="diff_txt" placeholder="" value="<?php echo (isset($MaterialWeigh)) ? $MaterialWeigh : '';?>"/>
                                        </tr>
                                        </thead>
                                        <tbody class="main"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="sample2">
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <table class="table" style=" margin-bottom:0px;" id="branchdetTable">
                                        <thead>
                                        <tr>
                                            <th>Tested</th>
                                            <th>Agency</th>
                                            <th>Testing Method</th>
                                            <th>Testing Result</th>
                                        </tr>
                                        <tr>
                                            <td width="20%">
                                                <div class="checkbox-styled">
                                                    <label for="Tested" >
                                                        <input type="checkbox" name="Tested" id="Tested"  value="1" <?php echo (isset($Tested) && $Tested==1) ? 'checked':'' ; ?>/>
                                                        <span><p class="tick">Is Tested </p></span>
                                                    </label>
                                                </div>
                                            </td>
                                            <td width="25%">
                                                <select name="AgencyId" id="AgencyId" class="form-control single_dropdown sortoption" data-placeholder="Please Select" style="width:100%;">
                                                    <option value="">Select Agency....</option>
                                                    <?php if(isset($arr_agency)) {
                                                        foreach ($arr_agency as $agency) {
                                                            if(isset($AgencyId)) {
                                                                ?>
                                                                <option value="<?php echo $agency['VendorId']; ?>" <?php echo ($agency['VendorId'] == $AgencyId) ? 'selected' : ''; ?>><?php echo $agency['VendorName']; ?></option>
                                                            <?php } else{?>
                                                                <option value="<?php echo $agency['VendorId']; ?>" >  <?php echo $agency['VendorName']; ?> </option>
                                                            <?php  }
                                                        }}?>
                                                </select>
                                            </td>
                                            <td width="25%">
                                                <input type="text" name="TestingMethod" id="TestingMethod" class="parent_txts"  value="<?php echo (isset($TestingMethod)) ? $TestingMethod : '';?> "/>
                                            </td>
                                            <td width="25%">
                                                <input type="text" name="TestResults" id="TestResults" class="parent_txts"  value="<?php echo (isset($TestResults)) ? $TestResults : '';?> "/>
                                            </td>
                                        </tr>
                                        </thead>
                                        <tbody class="main"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <div class="row demo-columns">
                                        <div class="col-md-6">
                                            <!-- D&D Zone-->
                                            <input type="hidden" name="qualfileList" id="qualfileList">
                                            <div id="drag-and-drop-zone1" class="uploader">
                                                <div>Drag &amp; Drop Files Here</div>
                                                <div class="or">-or-</div>
                                                <div class="browser">
                                                    <label>
                                                        <span>Click to upload Files</span>
                                                        <input type="file" name="qfiles[]"  multiple="multiple" title='Click to add your Files'>
                                                    </label>
                                                </div>
                                            </div>
                                            <!-- /D&D Zone -->
                                        </div>
                                        <!-- / Left column -->
                                        <div class="col-md-6">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title">Files</h3>
                                                </div>
                                                <?php if (isset($dcid) > 0) {?>
                                                    <?php
                                                    $dir = 'public/uploads/mms/QT-files/'.$dcid;
                                                    $files1 = glob($dir.'/*'); // get all file names
                                                   ?>
                                                    <div class="panel-body demo-panel-files demo-panel-files1 " id='demo-files1' file-counter="<?php echo count($files1); ?>">
                                                        <?php
//                                                        function filesize_formatted($path){
//                                                            $size = filesize($path);
//                                                            $units = array( 'B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
//                                                            $power = $size > 0 ? floor(log($size, 1024)) : 0;
//                                                            return number_format($size / pow(1024, $power), 2, '.', ',') . ' ' . $units[$power];
//                                                        }
                                                        if(count($files1) > 0){
                                                            foreach($files1 as $file2){ // iterate files
                                                                if(is_file($file2)){
                                                                    ?>
                                                                    <div class="file_content" style="background-color:#f5f5f5; border-color:1px solid #dcdcdc !important; padding:12px 16px 12px 16px;margin-top:10px;">
                                                                        <a download="<?php echo basename($file2); ?>" href="<?php echo $this->basePath().'/uploads/uploads/mms/QT-files/'.$dcid.'/'.basename($file2); ?>"><?php echo basename($file2); ?></a>
<!--                                                                        <span class="demo-file-size">(--><?php //echo filesize_formatted($file2); ?><!--)</span>-->
                                                                        <div id=":197" role="button" class="vq1" tabindex="-1" f1name="<?php echo basename($file2); ?>"></div>
<!--                                                                        <div class="progress progress-striped active" style="width:200px;float:right;display:none;">-->
<!--                                                                            <div class="progress-bar" role="progressbar" style="width: 0%;">-->
<!--                                                                            </div>-->
<!--                                                                        </div>-->
                                                                    </div>
                                                                <?php
                                                                }
                                                            }
                                                        } else {
                                                            echo '<span class="demo-note">No Files have been selected/droped yet...</span>';
                                                        }
                                                       ?>
                                                    </div>
                                                <?php } else { ?>
                                                    <div class="panel-body demo-panel-files demo-panel-files1" id='demo-files1' file-counter="0">
                                                        <span class="demo-note">No Files have been selected/droped yet...</span>
                                                    </div>
                                                <?php } ?>
                                            </div>
                                        </div>
                                        <!-- / Right column -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="sample3">
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <div class="row demo-columns">
                                        <div class="col-md-6">
                                            <!-- D&D Zone-->
                                            <input type="hidden" name="fileList" id="fileList">
                                            <div id="drag-and-drop-zone" class="uploader">
                                                <div>Drag &amp; Drop Images Here</div>
                                                <div class="or">-or-</div>
                                                <div class="browser">
                                                    <label>
                                                        <span>Click to upload Images</span>
                                                        <input type="file" name="files[]"  multiple="multiple" title='Click to add Images'>
                                                    </label>
                                                </div>
                                            </div>
                                            <!-- /D&D Zone -->
                                        </div>
                                        <!-- / Left column -->

                                        <div class="col-md-6">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title">Images</h3>
                                                </div>
                                                <?php if (isset($dcid) > 0) {?>
                                                    <?php
                                                    $dir = 'public/uploads/mms/'.$dcid;
                                                    $files = glob($dir.'/*'); // get all file names
                                                    ?>
                                                    <div class="panel-body demo-panel-files" id='demo-files' file-counter="<?php echo count($files); ?>">
                                                        <?php
                                                        function filesize_formatted($path){
                                                            $size = filesize($path);
                                                            $units = array( 'B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
                                                            $power = $size > 0 ? floor(log($size, 1024)) : 0;
                                                            return number_format($size / pow(1024, $power), 2, '.', ',') . ' ' . $units[$power];
                                                        }
                                                        if(count($files) > 0){
                                                            foreach($files as $file){ // iterate files
                                                                if(is_file($file)){
                                                                    ?>
                                                                    <div class="file_content" style="background-color:#f5f5f5; border-color:1px solid #dcdcdc !important; padding:12px 16px 12px 16px;margin-top:10px;">
                                                                        <a download="<?php echo basename($file); ?>" href="<?php echo $this->basePath().'/uploads/mms/'.$dcid.'/'.basename($file); ?>"><?php echo basename($file); ?></a>
                                                                        <span class="demo-file-size">(<?php echo filesize_formatted($file); ?>)</span>
                                                                        <div id=":197" role="button" class="vq" tabindex="-1" fname="<?php echo basename($file); ?>"></div>
<!--                                                                        <div class="progress progress-striped active" style="width:200px;float:right;display:none;">-->
<!--                                                                            <div class="progress-bar" role="progressbar" style="width: 0%;">-->
<!--                                                                            </div>-->
<!--                                                                        </div>-->
                                                                    </div>
                                                                <?php
                                                                }
                                                            }
                                                        }
                                                        else{
                                                            echo '<span class="demo-note">No Files have been selected/droped yet...</span>';
                                                        }
                                                        ?>
                                                    </div>
                                                <?php } else { ?>
                                                    <div class="panel-body demo-panel-files" id='demo-files' file-counter="0">
                                                        <span class="demo-note">No Files have been selected/droped yet...</span>
                                                    </div>
                                                <?php } ?>
                                            </div>
                                        </div>
                                        <!-- / Right column -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-------------------------------Others Details------------------------------->
</div>
<div class="clearfix"></div>
</form>
</div>
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r"><a onClick="submitForm()" data-toggle="tooltip" id="sub1" class="ripple" title="Submit">Submit</a> </li>
        <li class="dropdown save_btn float_r">
            <?php if(isset($approve) && $approve=="No"): ?>
                <a href="<?php echo $this->basePath();?>/mms/min/register" data-toggle="tooltip" class="ripple" title="Go to Register!">Close</a>
            <?php elseif (isset($approve) && $approve=='Partial'): ?>
                <a href="<?php echo $this->basePath();?>/mms/min/register" data-toggle="tooltip" class="ripple" title="Go to Register!">Back</a>
            <?php else: ?>
                <a href="<?php echo $this->basePath();?>/mms/min/min-wizard" data-toggle="tooltip" class="ripple" title="Close!">Close</a>
            <?php endif; ?>
        </li>
    </ul>
</div>

<!-- stock details for desc -->
<div class="modal fade" id="stockPOModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable">
                            <thead>
                            </thead>
                            <tbody>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Available Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="availableQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>

                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Excess Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="excessQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Total MINQty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="totMinQty" style="text-align:right;" class="parent_txts newRow" value=""  readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Total BillQty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="totBillQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>

                            </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>


<!------stock details- pop up--------->
<div class="modal fade" id="stockWBSModal" role="dialog" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details-wbs</h4>
            </div>
            <div class="modal-body">
                <div class="padlr0">
                    <div class="container-fluid">
                        <div class="">
                            <div class="col-lg-12 commargin_top_20">
                                <form class="form-horizontal">
                                    <div class="row">
                                        <div class="form-group req_flds">
                                            <div class="modal-body">
                                                <div class="col-lg-12">
                                                    <div class="table-responsive clear">
                                                        <table class="table table-hover clear" id="contactTable">
                                                            <thead>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td width="50%">
                                                                    <label class="pop_label">Estimate Qty</label>
                                                                </td>
                                                                <td width="50%">
                                                                    <input type="text" id="westimateQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="50%">
                                                                    <label class="pop_label">Available Qty</label>
                                                                </td>
                                                                <td width="50%">
                                                                    <input type="text" id="wavailableQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                                                </td>

                                                            </tr>
                                                            <tr>
                                                                <td width="50%">
                                                                    <label class="pop_label">Excess Qty</label>
                                                                </td>
                                                                <td width="50%">
                                                                    <input type="text" id="wexcessQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="50%">
                                                                    <label class="pop_label">Total MINQty</label>
                                                                </td>
                                                                <td width="50%">
                                                                    <input type="text" id="wtotMinQty" style="text-align:right;" class="parent_txts newRow" value=""  readonly />
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="50%">
                                                                    <label class="pop_label">Total BillQty</label>
                                                                </td>
                                                                <td width="50%">
                                                                    <input type="text" id="wtotBillQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                                                </td>
                                                            </tr>

                                                            </tbody>
                                                        </table>
                                                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class= "modal-footer">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>
<?php
echo $this->InlineScript()
    ->appendFile($this->basePath() . '/library/fileupload/js/demo-preview.min.js')
    ->appendFile($this->basePath() . '/library/fileupload/js/dmuploader.min.js')
    ->appendFile($this->basePath() . '/js/select2.full.min.js')
?>
<script id="resource-template"  type="text/template" class="hide">
    <?php
    $displayscreen="display:none";
    $displaymaintr="mainTr";
    if($gridtype == 1) {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }  ?>
    <tr class="count-tr">
        <td width="30%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);"/>
            <input type="hidden" name="resourceid__" id="resourceid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>

        </td>
        <td width="8%">
            <input class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
        </td>
        <td width="10%"><input class="parent_text border-none <?php echo $displaymaintr; ?>" type="text" name="qty__" id="qty__" style="text-align:right;"  readonly/>
            <input type="hidden" name="hiddenqty__" id="hiddenqty__">
        </td>
        <td width="15%"><input class="parent_text border-none <?php echo $displaymaintr; ?>" type="text" name="AcceptQty__" id="AcceptQty__" style="text-align:right;" readonly/>
        </td>
        <td width="10%"><input class="parent_text border-none" type="text" name="RejectQty__" id="RejectQty__" style="text-align:right;" readonly/>
        </td>
        <td width="15%">
            <div class="col-lg-12 padlr0">
                <input type="text" name="RefDate__" id="RefDate__" class='tbl_input date_picker' value="<?php echo date('d-m-Y'); ?>" onChange="validateDate(this)" readonly />
                <span class='date_icon'><i class='fa fa-calendar'></i></span>
            </div>
        </td>
        <td width="17%">
            <input class="parent_text border-none" type="text" name="Remarks__" id="Remarks__" />
        </td>
        <td width="2%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
        <td width="2%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li><a onclick="return stockPODetails(this);" class="mainTr" id="expandSt__" style="display:none !important;" ><i class="fa fa-hand-o-up" data-toggle="modal" data-target="#stockPOModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>

    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div id="subMaintd__" class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="iowTableLink__" onclick="showtabs('po',this.id,event)" style="position: relative; overflow: hidden; cursor:pointer;">PO<span class="ripple-wrapper animated"></span></a></li>
<!--                            							<li class=""><a class="ripple has-ripple" id="whTableLink__" onclick="showtabs('wh',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;">Warehouse<span class="ripple-wrapper animated"></span></a></li>-->
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="tab-content">
                        <div class="table-responsive topsp">
                            <table class="table" style="margin-bottom:0px;" id="iowTable__" bgcolor="#00FF00">
                                <thead>
                                <tr>
                                    <th class="worktype-activity sub_tbl1">PO No</th>
                                    <th class="worktype-activity sub_tbl1">PO Date</th>
                                    <th class="worktype-activity sub_tbl1">Req Date</th>
                                    <th class="worktype-activity sub_tbl1">Order Qty</th>
                                    <th class="worktype-activity sub_tbl1">Prev MIN Qty</th>
                                    <th class="worktype-activity sub_tbl1">Bal Qty</th>
                                    <th class="worktype-activity sub_tbl1">MIN Qty</th>
                                    <th class="worktype-activity sub_tbl1">Accept Qty</th>
                                    <th class="worktype-activity sub_tbl1">Reject Qty</th>
                                    <th class="iow___requestfields sub_tbl1" style="display: none;">&nbsp;</th>
                                    <th class="sub_tbl1">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="10%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___PONo_0" id="iow___PONo_0" readonly/>
            <input type="hidden" name="iow___decisionid_0" id="iow___decisionid_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
            <input type="hidden" name="iow___potransid_0" id="iow___potransid_0"/>
            <input type="hidden" name="iow___poprojtransid_0" id="iow___poprojtransid_0"/>
            <input type="hidden" name="iow___PORegisterId_0" id="iow___PORegisterId_0"/>
        </td>

        <td width="20%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input date_picker" type="text" name="iow___PODate_0" id="iow___PODate_0" readonly/>
                <span class='date_icon'><i class='fa fa-calendar'></i></span>
            </div>
        </td>
        <td width="20%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input date_picker" type="text" name="iow___ReqDate_0" id="iow___ReqDate_0" readonly/>
                <span class='date_icon'><i class='fa fa-calendar'></i></span>
            </div>
        </td>

        <td width="13%">
            <input class="parent_text border-none" type="text" name="iow___OrderQty_0" id="iow___OrderQty_0" style="text-align:right;" readonly/>
        </td>
        <td width="13%">
            <input class="parent_text border-none" type="text" name="iow___MINQty_0" id="iow___MINQty_0" style="text-align:right;" readonly/>
        </td>
        <td width="13%"><input class="parent_text border-none" type="text" name="iow___balqty_0" id="iow___balqty_0" style="text-align:right;" readonly/></td>
        <td width="22%">
            <input class="parent_text border-none mainTr" type="text" name="iow___SupplierMIN_0" id="iow___SupplierMIN_0" style="text-align:right;" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)"  readonly/>
            <input type="hidden" name="iow___hiddenSMQty_0" id="iow___hiddenSMQty_0" >
        </td>
        <td width="22%">
            <!--            <input class="parent_text border-none mainTr subTable" type="text" name="iow___AcceptQty_0" id="iow___AcceptQty_0" style="text-align:right;" onkeypress="return isDecimal(event,this)" onfocus="checkPOWareHouse(this);" readonly />-->
            <input class="parent_text border-none  subTable" type="text" name="iow___AcceptQty_0" id="iow___AcceptQty_0" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  readonly />
            <input type="hidden" name="iow___hiddenAQty_0" id="iow___hAQty_0">
        </td>
        <td width="22%">
            <input class="parent_text border-none" type="text" name="iow___RejectQty_0" id="iow___RejectQty_0" style="text-align:right;" readonly/>
            <input type="hidden" name="iow___hiddenRQty_0" id="iow___hiddenRQty_0">
        </td>
        <td width="8%" align="center" class="action_btns_td iow___requestfields" style="display:none">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr" id="expandTr__"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>

    <tr style="display:none;" class="subTr dont-hide" id="iow___request_0_trwbsid" >
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv all" style="display:none;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="sec___po_0_whreqno">

                        </table>
                        <input type="hidden" name="iow___request_0_rowid" id="iow___request_0_rowid" value="0"/>
                        <input type="hidden" name="wh___po_0_wrowid" id="wh___po_0_wrowid" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>

</script>
<script id="iow-po-warehouse"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%">
            <input  type="text" name="wh___po_0_warehousename_4" id="wh___po_0_warehousename_4" readonly />
            <input type="hidden" name="wh___po_0_warehouseid_4" id="wh___po_0_warehouseid_4"/>
            <input  type="hidden" name="wh___po_0_costcentreid_4" id="wh___po_0_costcentreid_4" />
        </td>
        <td width="20%">
            <input  type="text" name="wh___po_0_desc_4" id="wh___po_0_desc_4" readonly/>
        </td>
        <td width="20%">
            <input class="parent_text mainTr whsum__" type="text" name="wh___po_0_qty_4" id="wh___po_0_qty_4" style="text-align:right;"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)" />
            <input type="hidden" name="wh___po_0_hdqty_4" id="wh___po_0_hdqty_4" value="0"/>
        </td>
    </tr>
</script>
<script id="request-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%">
            <input class="parent_text border-none" type="text" name="iow___request_0_wbsname__9" id="iow___request_0_wbsname__9" readonly/>
            <input type="hidden" name="iow___request_0_wbsid__9" id="iow___request_0_wbsid__9"/>
            <input type="hidden" name="iow___request_0_poregisterid__9" id="iow___request_0_poregisterid__9"/>
            <input type="hidden" name="iow___request_0_potransid__9" id="iow___request_0_potransid__9"/>
            <input type="hidden" name="iow___request_0_poanaltransid__9" id="iow___request_0_poanaltransid__9"/>
            <input type="hidden" name="iow___request_0_itemid__9" id="iow___request_0_itemid__9"/>
            <input type="hidden" name="iow___request_0_resourceid__9" id="iow___request_0_resourceid__9"/>
        </td>

        <td width="15%"><input class="parent_text border-none" type="text" name="iow___request_0_orderqty__9" id="iow___request_0_orderqty__9" style="text-align:right;" readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="iow___request_0_minqty__9" id="iow___request_0_minqty__9" style="text-align:right;" readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="iow___request_0_balqty__9" id="iow___request_0_balqty__9" style="text-align:right;" readonly/></td>
        <td width="13%"><input class="parent_text border-none" type="text" name="iow___request_0_suppliermin__9" id="iow___request_0_suppliermin__9" style="text-align:right;" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)"  onchange="calcRequestQuantity(this);"/>
            <input type="hidden" name="iow___request_0_hiddenSMqty__9" id="iow___request_0_hiddenSMqty__9" >
        </td>
        <td width="11%">
            <!--            <input class="parent_text border-none  mainTr" type="text" name="iow___request_0_acceptqty__9" id="iow___request_0_acceptqty__9" style="text-align:right;" value="0" onkeypress="return isDecimal(event,this)"  onchange="calcSubQty(this);"  onfocus="checkPOWareHouse(this);" readonly />-->
            <input class="parent_text border-none " type="text" name="iow___request_0_acceptqty__9" id="iow___request_0_acceptqty__9" style="text-align:right;" value="0" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"   onchange="calcSubQty(this);"   readonly />
            <input type="hidden" name="iow___request_0_hiddenAqty__9" id="iow___request_0_hiddenAqty__9" >
        </td>
        <td width="11%"><input class="parent_text border-none" type="text" name="iow___request_0_rejectqty__9" id="iow___request_0_rejectqty__9" style="text-align:right;"  readonly/>
            <input type="hidden" name="iow___request_0_hiddenRqty__9" id="iow___request_0_hiddenRqty__9"  >
        </td>
        <td width="1%" align="center" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
                <li><a href="" class="mainTr" id="expandTr_1 "> <i class="fa fa-chevron-circle-down" data-toggle="modal" data-target="#myModal" data-placement="left"></i></a> </li>
            </ul>
        </td>
        <td width="1%" align="center" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
                <li><a  onclick=" return stockWBSDetails(this);" class="mainTr" id="iow___request_0_expandWbs__9"><i class="fa fa-question-circle" data-toggle="modal" data-target="#stockWBSModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>

    <tr style="<?php echo $displayscreen; ?>;" class="subTr dont-hide" id="wh___po_0_wbs_45_trpowbswh">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="thr___request_0_wbs__9_whreqno">
                        </table>
                        <input type="hidden" name="wh___po_0_wbs_45_wrowid" id="wh___po_0_wbs_45_wrowid" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/paging.css';?>"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/paging.js"></script>

<script type="text/javascript">
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var tmp_arr_resources = arr_resources; //autocomplete
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;
var arr_sel_warehouse = <?php echo (isset($arr_sel_warehouse)) ? json_encode($arr_sel_warehouse) : '[]';?>;
var arr_dcwbswarehouse = <?php echo (isset($arr_dcwbswarehouse)) ? json_encode($arr_dcwbswarehouse) : '[]';?>;
var arr_dcpowarehouse = <?php echo (isset($arr_dcpowarehouse)) ? json_encode($arr_dcpowarehouse) : '[]';?>;
var arr_vehicle = <?php echo (isset($arr_vehicle)) ? json_encode($arr_vehicle) : '[]';?>;


$(function () {
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();
    var warepotemplate = $('#iow-po-warehouse').html();
    var gridtype = $('#gridtype').val();

    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.main');


    if(arr_requestResources.length != 0) {
        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));

            $('#desc_' + rowid).val(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).val(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);

            $('#qty_' + rowid).val(sanitizeNumber(parseFloat(o.Qty,0),3,true));
            $('#AcceptQty_' + rowid).val(sanitizeNumber(parseFloat(o.AcceptQty,0),3,true));
            $('#RejectQty_' + rowid).val(sanitizeNumber(parseFloat(o.RejectQty,0),3,true));
            $('#RefDate_' + rowid).val(o.ExpiryDate);
            $('#Remarks_' + rowid).val(o.Remarks);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            $('#expandSt_' + rowid).show();

            var pocount = 0;
            if(arr_resource_iows.length > 0) {
                $.each(arr_resource_iows, function (j, l) {
                    if ((l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                        return;
                    }
                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    pocount++;
                    $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
                    $('#iow_' + rowid + '_PONo_' + iowrowid).val(l.PONo);
                    $('#iow_' + rowid + '_potransid_' + iowrowid).val(l.POTransId);
                    $('#iow_' + rowid + '_poprojtransid_' + iowrowid).val(l.POProjTransId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_PORegsiterId_' + iowrowid).val(l.PORegisterId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(parseFloat(l.BalQty,0),3,true));
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(parseFloat(l.Qty,0),3,true));
                    $('#iow_' + rowid + '_PODate_' + iowrowid).val(l.PODate);
                    $('#iow_' + rowid + '_ReqDate_' + iowrowid).val(l.ReqDate);
                    $('#iow_' + rowid + '_OrderQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.OrderQty,0),3,true));
                    $('#iow_' + rowid + '_MINQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.MINQty,0),3,true));
                    $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).val(sanitizeNumber(parseFloat(l.SupplierMIN,0),3,true));
                    $('#iow_' + rowid + '_AcceptQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.AcceptQty,0),3,true));
                    $('#iow_' + rowid + '_RejectQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.RejectQty,0),3,true));
                    $('#iow_' + rowid + '_hiddenSMQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.SupplierMIN,0),3,true));
                    $('#iow_' + rowid + '_hiddenAQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.AcceptQty,0),3,true));
                    $('#iow_' + rowid + '_hiddenRQty_' + iowrowid).val(sanitizeNumber(parseFloat(l.RejectQty,0),3,true));

                    requestrowid = 0;
                    var wRequest = arr_resource_iow_requests.filter(function (obj) {
                        return ((obj.ResourceId === o.ResourceId) && (obj.PORegisterId === l.PORegisterId) && (obj.ItemId === o.ItemId) && (obj.BalQty > 0 || obj.SupplierMIN > 0));
                    });
                    if (wRequest.length > 0) {
                        $('#iow_' + rowid + '_request_' + iowrowid + '_trwbsid').addClass('subTr');
                        $('#sec_' + rowid + '_po_' + iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl3">WBS Name</th>  <th class="worktype-activity sub_tbl3">Order Qty</th> <th class="worktype-activity sub_tbl3">Prev MIN Qty</th> <th class="worktype-activity sub_tbl3">Bal Qty</th><th class="worktype-activity sub_tbl3">MIN Qty</th> <th class="worktype-activity sub_tbl3">Accept Qty</th> <th class="worktype-activity sub_tbl3">Reject Qty</th> <th class="worktype-activity sub_tbl3"></th><th class="worktype-activity sub_tbl3">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody> ');
                        $.each(arr_resource_iow_requests, function (k, r) {
                            if (l.PORegisterId != r.PORegisterId || l.ResourceId != r.ResourceId || l.ItemId != r.ItemId) {
                                return;
                            }
                            $('.iow_' + rowid + '_requestfields').show();
                            requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                            $('#wh_' + rowid + '_po_' + iowrowid + '_whreqno').hide();
                            $('#sec_' + rowid + '_po_' + iowrowid + '_whreqno').find('> tbody.main').append(requesttemplate
                                .replace(/__9/g, '_' + requestrowid)
                                .replace(/_0/g, '_' + iowrowid)
                                .replace(/__/g, '_' + rowid)
                                .replace(/_45/g, '_' + requestrowid));

                            $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_wbsname_' + requestrowid).val(r.WBSName);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val(r.WBSId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_potransid_' + requestrowid).val(r.POTransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_poanaltransid_' + requestrowid).val(r.POAnalTransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_poregisterid_' + requestrowid).val(r.PORegisterId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_resourceid_' + requestrowid).val(r.ResourceId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_itemid_' + requestrowid).val(r.ItemId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_orderqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.OrderQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_minqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.MINQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.BalQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid).val(sanitizeNumber(parseFloat(r.SupplierMIN,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.AcceptQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_rejectqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.RejectQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenAqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.HAcceptQty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenSMqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.HSMqty,0),3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenRqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.RejectQty,0),3,true));
                            //start wbs warehouse
                            if (arr_sel_warehouse.length != 0) {
                                $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_'+ requestrowid +'_trpowbswh').addClass('subTr');
                                $('#thr_' + rowid + '_request_' + iowrowid + '_wbs_' + requestrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl2">Warehouse Name </th> <th class="worktype-activity sub_tbl2">Description </th> <th class="worktype-activity sub_tbl2">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody>');
                                $.each(arr_sel_warehouse, function (u, v) {
                                    var whrowid = parseInt($('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val()) + 1;
                                    $('#thr_' + rowid + '_request_' + iowrowid + '_wbs_' + requestrowid + '_whreqno').find('> tbody.main').append(warepotemplate
                                        .replace(/_4/g, '_' + whrowid)
                                        .replace(/_0/g, '_' + iowrowid + '_wbs_' + requestrowid)
                                        .replace(/__/g, '_' + rowid));

                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val(whrowid);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_warehouseid_' + whrowid).val(v.WareHouseId);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_warehousename_' + whrowid).val(v.WareHouseName);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_costcentreid_' + whrowid).val(v.CostCentreId);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_desc_' + whrowid).val(v.Description);
                                    if(<?php echo (isset($dcid)) ? $dcid : 0;?> === 0 && whrowid === 1) {
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(sanitizeNumber(parseFloat(r.SupplierMIN,0),3,true));
                                    }
                                    else
                                    {
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(sanitizeNumber(parseFloat(v.Qty, 0), 3, true));
                                    }
                                    $.each(arr_dcwbswarehouse, function (m, n) {
                                        if (v.WareHouseId == n.WareHouseId && r.POAnalTransId == n.POAnalTransId && o.ResourceId == n.ResourceId && o.ItemId == n.ItemId && n.Qty > 0) {
                                            $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(sanitizeNumber(parseFloat(n.Qty,0),3,true));
                                        }
                                    });
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).attr('onchange', 'checkWBSWHQuantity(this)');
                                });
                            }
                            else {
                                $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_'+ requestrowid +'_trpowbswh').removeClass('subTr');
                            }
                            // end of wbs-warehouse

                        });
                    } else {
                        $('.iow_' + rowid + '_requestfields').hide();


                        //start po warehouse
                        if (arr_sel_warehouse.length != 0) {
                            $('#sec_' + rowid + '_po_' + iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl2">Warehouse Name </th> <th class="worktype-activity sub_tbl2">Description </th> <th class="worktype-activity sub_tbl2">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody>');
                            $.each(arr_sel_warehouse, function (u, v) {
                                var whrowid1 = parseInt($('#wh_' + rowid + '_po_' + iowrowid + '_wrowid').val()) + 1;
                                $('#sec_' + rowid + '_po_' + iowrowid + '_whreqno').find('> tbody.main').append(warepotemplate
                                    .replace(/_4/g, '_' + whrowid1)
                                    .replace(/_0/g, '_' + iowrowid)
                                    .replace(/__/g, '_' + rowid));

                                $('#wh_' + rowid + '_po_' + iowrowid + '_wrowid').val(whrowid1);
                                $('#wh_' + rowid + '_po_' + iowrowid + '_warehouseid_' + whrowid1).val(v.WareHouseId);
                                $('#wh_' + rowid + '_po_' + iowrowid + '_warehousename_' + whrowid1).val(v.WareHouseName);
                                $('#wh_' + rowid + '_po_' + iowrowid + '_costcentreid_' + whrowid1).val(v.CostCentreId);
                                $('#wh_' + rowid + '_po_' + iowrowid + '_desc_' + whrowid1).val(v.Description);
                                if(<?php echo (isset($dcid)) ? $dcid : 0;?> === 0 && whrowid1 === 1) {
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).val(sanitizeNumber(parseFloat(l.SupplierMIN,0),3,true));
                                }
                                else
                                {
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).val(sanitizeNumber(parseFloat(v.Qty, 0), 3, true));
                                }

                                $.each(arr_dcpowarehouse, function (m, n) {
                                    if (v.WareHouseId == n.WareHouseId && l.POTransId == n.POTransId && o.ResourceId == n.ResourceId && o.ItemId == n.ItemId && n.Qty > 0) {
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).val(sanitizeNumber(parseFloat(n.Qty,0),3,true));
                                    }
                                });
                                $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).attr('onchange', 'checkPOWHQuantity(this)');
                            });
                        }
                        else {
                             $('#iow_' + rowid + '_request_' + iowrowid + '_trwbsid').removeClass('subTr');
                        }
                        //end of po-warehouse
                    }
                    if (requestrowid <= 0) {
                        if(gridtype == 0){
                            $('.all').hide();
                        } else {
                            $('.all').show();
                        }
                        $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).attr('onchange', 'calcPoQuantity(this)');
                        $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).prop("readonly", false);
                        $('#iow_' + rowid + '_AcceptQty_' + iowrowid).attr('onchange', 'calcPO(this)');
                        $('#iow_' + rowid + '_AcceptQty_' + iowrowid).prop("readonly", false);
                    }
                });
            }
            if(pocount == 0){
                $('#expandTr_' + rowid).hide();
                $('#qty_' + rowid).removeClass('mainTr');
                showError($('#qty_' + rowid), "No PO Avaliable");
            }
            $('#subMaintd_' + rowid).hide();
        });

    }
    rowid += 1;
    $tbody.append(template.replace(/__/g, '_' + rowid));
    $rowid.val(rowid);
    bindDescAutocomplete();


    $('.content_wrapper').on('click','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").prevAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").prevAll(".subTr").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").slideUp("slow");

            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            if($(this).closest("tr").next(".subTr").find(".subDiv").is(":visible") == false) {
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else {
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        }
    });
    nextAccordian(1);

    if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
        $('#workorderTable').paging({limit: 2});
        $('.paging-nav').children('a[data-page=0]').trigger('click');
        $('#subMaintd_' + rowid).hide();
    }
});
$(document).ready(function(){
    $(".flip0").click(function(){
        $(".pane0").slideToggle("slow");
    });
});
function myFunction(x) {
    x.classList.toggle("change");
}
function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];
    if (type=="po") {
        $('#whTable_'+rowid).hide();
        $('#iowTable_'+rowid).show();

    } else {
        $('#whTable_'+rowid).show();
        $('#iowTable_'+rowid).hide();
    }
    return false;
}

function submitForm(){
    if($('#formWrapper .error').length != 0) {
        alert('Kindly notice the errors!');
        return false;
    }
    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 3){
        alert('Add Resource');
        return false;
    }
    var rowCountqty=$('#rowid').val()-1;
    var netqty = parseFloatVal( $('#netQty').val());
    var add=0;

    for(var i=1;i<=rowCountqty;i++){
        var q1 = $.trim($('#qty_' + i).val());
        var desc1 = $('#desc_' + i).val();
        if(typeof desc1 !== '' && typeof desc1 !== 'undefined') {
            if ((q1 == 0 || q1 == '')) {
                alert('Kindly enter the Quantity or delete the unwanted resource');
                if ($('#panelheading-1').attr('aria-expanded') == 'true') {
                    $('.paging-nav').children('a[data-page=' + ((i) - 1) + ']').trigger('click');
                    $('#qty_' + i).focus();
                    return false;
                } else {
                    $('#accordion').children().find('#panelheading-1').trigger('click');
                    $('.paging-nav').children('a[data-page=' + ((i) - 1) + ']').trigger('click');
                    $('#qty_' + i).focus();
                    return false;
                }
                return false;

            }
        }
        add += parseFloatVal(q1);
    }

    if($('#isWareHouse').val() == 1) {
        for(var i=1;i<=rowCountqty;i++){
            var q1 = $.trim($('#qty_' + i).val());
            var acceptqty = $.trim($('#AcceptQty_' + i).val());
            var desc1 = $('#desc_' + i).val();
            var whqty = 0;
            if(typeof desc1 !== '' && typeof desc1 !== 'undefined') {
                if ((q1 > 0) && desc1 != '') {
                    $('.whsum_' + i).each(function () {
                        //add only if the value is number
                        if (!isNaN(this.value) && this.value.length != 0) {
                            whqty += parseFloat(this.value);
                        }
                    });
                    if (whqty < acceptqty) {
                        alert("Warehouse quanity not adjusted properly in - " + desc1);
                        return false;
                    }
                }
            }
        }

    }
//    if($('#vehicleId').val() > 0 && netqty==0 ){
//        alert('Adjust the value in tripsheet');
//        return false;
//    }
    if((add!=netqty) && $('#vehicleId').val() > 0) {
        alert('Adjust the value in tripsheet');
        return false;
    }
    $('#fileList').val(JSON.stringify(fileList));
    $('#qualfileList').val(JSON.stringify(qfileList));
    $('#formWrapper').submit();
}

function validateLength($input) {
    if($.trim($input.val()).length == 0) {
        showError($input, 'required');
        return false;
    }
    removeError($input);
    return true;
}

function bindDescAutocomplete() {
    // bind resource autocomplete
    $('#workorderTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_resources,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {
            if (suggestion) {

                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                var reskeyid = $('input[id*=resourceid_] ') ;
                var bRet=false;
                $.each(reskeyid, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != rowid) {
                        if ($this.val() == suggestion.data && $('#itemid_' + key1).val() == suggestion.ItemId) {
                            bRet = true;
                        }
                    }
                });
                if(bRet == false) {
                    $this.prop('readonly', true).addClass('border-none');
                    $('#descid_' + rowid).val(suggestion.data);
                    $('#resourceid_' + rowid).val(suggestion.data);
                    $('#unitid_' + rowid).val(suggestion.UnitId);
                    $('#itemid_' + rowid).val(suggestion.ItemId);
                    $('#unitname_' + rowid).val(suggestion.UnitName);
                    $('#rate_' + rowid).val(sanitizeNumber(suggestion.Rate,2,true));
                    $('#expandTr_' + rowid).show();
                    $('#deleteTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    bindResourceIOW($this);
                    addNewResourceRow($this);
                } else {
                    alert('Already added in list');
                    $('#desc_' + rowid).val('');
                    return;
                }
            }
        }
    });
}

function bindResourceIOW(x){
    var rowid = $(x)[0].id.split('_')[1];
    var descId = $('#descid_' + rowid).val();
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var VendorId = $('#VendorId').val();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();


    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/min/minentry',
        type: "post",
        data: "CostCenterId=" + CostCenterId +"&resourceid=" + resourceid +"&itemid=" + itemid + "&VendorId=" + VendorId,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);
                if ((data.po).length != 0) {
                    $.each(data.po, function (i, l) {
                        var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                        $('#iowTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                        $('#iow_'+rowid+'_rowid').val(iowrowid);
                        $('#iow_'+ rowid +'_decisionid_'+ iowrowid).val(l.DecisionId);
                        $('#iow_'+ rowid +'_PONo_'+ iowrowid).val(l.PONo);
                        $('#iow_'+ rowid +'_potransid_'+ iowrowid).val(l.POTransId);
                        $('#iow_'+ rowid +'_poprojtransid_'+ iowrowid).val(l.POProjTransId);
                        $('#iow_'+ rowid +'_resourceid_'+ iowrowid).val(l.ResourceId);
                        $('#iow_'+ rowid +'_PORegsiterId_'+ iowrowid).val(l.PORegisterId);
                        $('#iow_'+ rowid +'_itemid_'+ iowrowid).val(l.ItemId);
                        $('#iow_'+ rowid +'_balqty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.BalQty,0),3,true));
                        $('#iow_'+ rowid +'_qty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.Qty,0),3,true));
                        $('#iow_'+ rowid +'_PODate_'+ iowrowid).val(l.PODate);
                        $('#iow_'+ rowid +'_ReqDate_'+ iowrowid).val(l.ReqDate);
                        $('#iow_'+ rowid +'_OrderQty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.OrderQty,0),3,true));
                        $('#iow_'+ rowid +'_MINQty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.MINQty,0),3,true));
                        $('#iow_'+ rowid +'_SupplierMIN_'+ iowrowid).val(sanitizeNumber(parseFloat(l.SupplierMIN,0),3,true));
                        $('#iow_'+ rowid +'_AcceptQty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.AcceptQty,0),3,true));
                        $('#iow_'+ rowid +'_RejectQty_'+ iowrowid).val(sanitizeNumber(parseFloat(l.RejectQty,0),3,true));
                        $('#iow_'+ rowid +'_hAQty_'+ iowrowid).val(l.HiddenAQty);
                        $('#iow_'+ rowid +'_hSMQty_'+ iowrowid).val(l.HiddenSMQty);


                        requestrowid = 0;
                        var requesttemplate = $('#request-template').html();
                        var warepotemplate = $('#iow-po-warehouse').html();

                        var wRequest = data.wbs.filter(function(obj) {
                            return (obj.ResourceId === resourceid) && (obj.PORegisterId === l.PORegisterId) && (obj.ItemId === itemid && (obj.BalQty > 0 || obj.Qty > 0));
                        });
                        if (wRequest.length != 0) {
                            $.each(data.wbs, function (k, r) {
                                if (l.PORegisterId != r.PORegisterId || l.ResourceId != r.ResourceId || l.ItemId != r.ItemId) {
                                    return;
                                }
                                $('#sec_' + rowid + '_po_' +  iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl3">WBS Name</th> <th class="worktype-activity sub_tbl3">Order Qty</th> <th class="worktype-activity sub_tbl3">Prev MIN Qty</th><th class="worktype-activity sub_tbl3">Bal Qty</th>  <th class="worktype-activity sub_tbl3">MIN Qty</th> <th class="worktype-activity sub_tbl3">Accept Qty</th> <th class="worktype-activity sub_tbl3">Reject Qty</th> <th class="worktype-activity sub_tbl3">&nbsp;</th> <th class="worktype-activity sub_tbl3">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody> ');
                                $('.iow_' + rowid + '_requestfields').show();
                                $('#wh_' + rowid + '_po_' +  iowrowid + '_whreqno').hide();
                                requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                                $('#sec_' + rowid + '_po_' +  iowrowid + '_whreqno').find('> tbody.main').append(requesttemplate
                                    .replace(/__9/g, '_' + requestrowid)
                                    .replace(/_0/g, '_' + iowrowid)
                                    .replace(/__/g, '_' + rowid)
                                    .replace(/_45/g, '_' + requestrowid));

                                $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_wbsname_' + requestrowid).val(r.WBSName);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val(r.WBSId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_potransid_' + requestrowid).val(r.POTransId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_poanaltransid_' + requestrowid).val(r.POAnalTransId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_poregisterid_' + requestrowid).val(r.PORegisterId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_resourceid_' + requestrowid).val(r.ResourceId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_itemid_' + requestrowid).val(r.ItemId);
                                $('#iow_' + rowid + '_request_' + iowrowid + '_orderqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.OrderQty,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_minqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.MINQty,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.BalQty,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid).val(sanitizeNumber(parseFloat(r.SupplierMIN,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.AcceptQty,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_rejectqty_' + requestrowid).val(sanitizeNumber(parseFloat(r.RejectQty,0),3,true));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenAqty_' + requestrowid).val(sanitizeNumber(r.HAcceptQty));
                                $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenSMqty_' + requestrowid).val(sanitizeNumber(r.HSMqty));

                                //start wbs warehouse
                                if(arr_sel_warehouse.length != 0) {
                                    $('#thr_' + rowid + '_request_' +  iowrowid + '_wbs_'+ requestrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity sub_tbl2">Warehouse Name </th> <th class="worktype-activity sub_tbl2">Description </th> <th class="worktype-activity sub_tbl2">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody>');
                                    $.each(arr_sel_warehouse, function (u, v){
                                        var whrowid = parseInt($('#wh_' + rowid + '_po_' +  iowrowid + '_wbs_' + requestrowid + '_wrowid').val()) + 1;
                                        $('#thr_' + rowid + '_request_' +  iowrowid +'_wbs_'+ requestrowid + '_whreqno').find('> tbody.main').append(warepotemplate
                                            .replace(/_4/g, '_' + whrowid)
                                            .replace(/_0/g, '_' + iowrowid + '_wbs_' + requestrowid)
                                            .replace(/__/g, '_' + rowid));

                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid +'_wrowid').val(whrowid);
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_warehouseid_' + whrowid).val(v.WareHouseId);
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_warehousename_' + whrowid).val(v.WareHouseName);
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_costcentreid_' + whrowid).val(v.CostCentreId);
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_desc_' + whrowid).val(v.Description);
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(sanitizeNumber(parseFloat(v.Qty,0),3,true));

                                        $.each(arr_dcwbswarehouse, function (m, n) {
                                            if (v.WareHouseId == n.WareHouseId && r.POAnalTransId == n.POAnalTransId && o.ResourceId == n.ResourceId && o.ItemId == n.ItemId && n.Qty>0) {
                                                $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(sanitizeNumber(parseFloat(n.Qty,0),3,true));
                                            }
                                        });
                                        $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).attr('onchange', 'checkWBSWHQuantity(this)');
                                    });
                                }
                                // end of wbs-warehouse
                            });
                        } else {
                            $('.iow_' + rowid + '_requestfields').hide();
                            //start po warehouse
                            if(arr_sel_warehouse.length != 0) {
                                $('#sec_' + rowid + '_po_' +  iowrowid + '_whreqno').html('<thead> <tr> <th class="worktype-activity">Warehouse Name </th> <th class="worktype-activity">Description </th> <th class="worktype-activity">Qty </th> <th class="" style="display: none;">&nbsp;</th> </tr> </thead> <tbody class="main"></tbody> <tbody class="total"> </tbody>');
                                $.each(arr_sel_warehouse, function (u, v){
                                    var whrowid1 = parseInt($('#wh_' + rowid + '_po_' +  iowrowid + '_wrowid').val()) + 1;
                                    $('#sec_' + rowid + '_po_' +  iowrowid + '_whreqno').find('> tbody.main').append(warepotemplate
                                        .replace(/_4/g, '_' + whrowid1)
                                        .replace(/_0/g, '_' + iowrowid)
                                        .replace(/__/g, '_' + rowid));

                                    $('#wh_' + rowid + '_po_' + iowrowid +'_wrowid').val(whrowid1);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_warehouseid_' + whrowid1).val(v.WareHouseId);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_warehousename_' + whrowid1).val(v.WareHouseName);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_costcentreid_' + whrowid1).val(v.CostCentreId);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_desc_' + whrowid1).val(v.Description);
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).val(sanitizeNumber(parseFloat(v.Qty,0),3,true));

                                    $.each(arr_dcpowarehouse, function (m, n) {
                                        if (v.WareHouseId == n.WareHouseId && l.POTransId == n.POTransId && o.ResourceId == n.ResourceId && o.ItemId == n.ItemId && n.Qty>0) {
                                            $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).val(sanitizeNumber(parseFloat(n.Qty,0),3,true));
                                        }
                                    });
                                    $('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + whrowid1).attr('onchange', 'checkPOWHQuantity(this)');
                                });
                            }
                            //end of po-warehouse
                        }
                        if (requestrowid <= 0) {
                            if(gridtype == 0){
                                $('.all').hide();
                            } else {
                                $('.all').show();
                            }
                            $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).attr('onchange', 'calcPoQuantity(this)');
                            $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).prop("readonly", false);
                            $('#iow_' + rowid + '_AcceptQty_' + iowrowid).attr('onchange', 'calcPO(this)');
                            $('#iow_' + rowid + '_AcceptQty_' + iowrowid).prop("readonly", false);
                        }
                        // end of wbs
                    });
                } else {
                    $('#expandTr_' + rowid).hide();
                    $('#qty_' + rowid).removeClass('mainTr');
                    showError($('#qty_' + rowid), "No PO Avaliable");
                }
                //end of po
            }
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }

    });
}
function addNewResourceRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val()),
        $tbody = $('#workorderTable').find('> tbody.main');

    $('#deleteTr_' + rowid).show();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        $('#subMaintd_' + rowid).hide();
    }
    var count = rowid + 1,
        template = $('#resource-template').html();
    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        $('#subMaintd_' + count).hide();
    }
    $rowid.val(count);
    bindDescAutocomplete();

    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
}

function deleteRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    $tr.next('.subTr').remove();
    $tr.remove();

//    var rId = $('#rowid').val();
//    console.log(rId);
//    rId--;
//    console.log(rId);
//    $('#rowid').val(rId);
    bindDescAutocomplete();

    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
    return false;
}
function stockPODetails(x){

    var rowid = $(x)[0].id.split('_')[1];
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var VendorId = $('#VendorId').val();
    var  mode="spo";

    $.ajax({
        url: getBaseURL() + 'mms/min/minentry',
        type: "post",
        data: "mode="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid +"&itemid=" + itemid + "&VendorId=" + VendorId,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockPOModal").show();
                if (sdata.poStock == '') {
                    alert('No stocks Available');
                }
                var pstocks=sdata.poStock;
                $("#estimateQty").val(sanitizeNumber(pstocks.EstimateQty,3,true));
                $("#totMinQty").val(sanitizeNumber(pstocks.TotMinQty,3,true));
                $("#totBillQty").val(sanitizeNumber(pstocks.TotBillQty,3,true));
                $("#availableQty").val(sanitizeNumber(pstocks.AvailableQty,3,true));
                $("#excessQty").val(sanitizeNumber(pstocks.ExcessQty,3,true));
            }
        }

    });
}
function stockWBSDetails(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var VendorId = $('#VendorId').val();
    var WBSId = $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val();
    var  mode="swbs";

    $.ajax({
        url: getBaseURL() + 'mms/min/minentry',
        type: "post",
        data: "mode="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid +"&itemid=" + itemid + "&VendorId=" + VendorId,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var wdata = JSON.parse(data);
                $("#stockWBSModal").show();
                if (wdata.wbsStock == '') {
                    alert('No stocks Available');
                }
                var wstocks=wdata.wbsStock;
                $("#westimateQty").val(sanitizeNumber(wstocks.EstimateQty,3,true));
                $("#wtotMinQty").val(sanitizeNumber(wstocks.TotMinQty,3,true));
                $("#wtotBillQty").val(sanitizeNumber(wstocks.TotBillQty,3,true));
                $("#wavailableQty").val(sanitizeNumber(wstocks.AvailableQty,3,true));
                $("#wexcessQty").val(sanitizeNumber(wstocks.ExcessQty,3,true));
            }
        }

    });
}


function checkResourceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=resourceid_]');
    var itemkeyid=$('input[id*=itemid_]');
    tmp_arr_resources = arr_resources;
    tmp_arr_resources = $.grep(arr_resources, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val() && itemkeyid[0].value == element.ItemId) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindDescAutocomplete();
}

function nextAccordian(id,s) {
    if(id==2 && s==1){
        $(".collapseTwo").attr('id','collapseTwo');
    }
    else if(id==4 && s==2) {
        $(".collapseFour").attr('id','collapseFour');
    }
    $('#panelheading-' + id).trigger('click');
}

function calcQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    // calc total qty
    var totalQty=0;
    $.each($('input[id^=iow_'+rowid+'_SupplierMIN_'), function (i,o) {
        var qty = parseInt($(this).val());
        if(isNaN(qty))
            qty = 0;
        totalQty += qty;
    });

    $('#qty_'+rowid).val(sanitizeNumber(totalQty,3,true));

    // calc total amount
    var rate = parseFloatVal($('#rate_'+rowid).val());
    $('#amount_'+rowid).val(sanitizeNumber(totalQty * rate,3,true));
    calcTotal();
}
function calcPoQuantity(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var whrowid = 1;


    var $orderqty = $('input[id^=iow_'+ rowid +'_OrderQty_'+ iowrowid);
    var $supmqty = $('input[id^=iow_'+ rowid +'_SupplierMIN_'+ iowrowid);

    orderqty = parseFloat($orderqty.val());
    supmqty = parseFloat($supmqty.val());
    if (!isNaN(supmqty) && orderqty < supmqty){

        alert('MIN Quantity is greater than PO Quanity');
        $('input[id^=iow_'+ rowid +'_SupplierMIN_'+ iowrowid).val(0);
        $('input[id^=iow_'+ rowid +'_AcceptQty_'+ iowrowid).val(0);
        $('input[id^=iow_'+ rowid +'_RejectQty_'+ iowrowid).val(0);
        $('#wh_'+ rowid +'_po_'+ iowrowid + '_qty_' + whrowid).val(0);
        $('input[id^=qty_' + rowid).val(0);
        $('input[id^=AcceptQty_' + rowid).val(0);
        $('input[id^=RejectQty_' + rowid).val(0);
    }
    else{
        $('input[id*=wh_'+ rowid +'_po_'+ iowrowid + '_qty_' + whrowid).val(0);
        $('#iow_'+ rowid +'_AcceptQty_'+ iowrowid).val(sanitizeNumber(supmqty,3,true)).trigger('change');
        $('#wh_'+ rowid +'_po_'+ iowrowid + '_qty_' + whrowid).val(sanitizeNumber(supmqty,3,true)).trigger('change');
        $('#iow_'+ rowid +'_RejectQty_'+ iowrowid).val(0).trigger('change');
    }
}
function calcPO(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var whrowid = 1;

    var posap = 0; //suppliermin
    var poaptQty = 0;//acceptqty
    var porejQty = 0; // rejectQty

    hideqty  = parseInt($('input[id^=iow_'+ rowid +'_hSMQty_'+ iowrowid).val());

    if(isNaN(hideqty)){
        hideqty =0;
    }

    var $balqty = $('input[id^=iow_'+ rowid +'_balqty_'+ iowrowid);
    balqty = parseInt($balqty.val());

    var poSub =  parseFloat($('input[id^=iow_'+ rowid +'_SupplierMIN_'+ iowrowid).val());
    var poacp = parseFloat($('input[id^=iow_'+ rowid +'_AcceptQty_'+ iowrowid).val());

    var total = parseFloat(poacp - hideqty);

    if( poSub < total ){
        alert('AcceptQty should not exceed supplierMin');
        $('input[id^=iow_'+ rowid +'_AcceptQty_'+ iowrowid).val(0);
        $('input[id^=iow_'+ rowid +'_RejectQty_'+ iowrowid).val(0);
        $('#wh_'+ rowid +'_po_'+ iowrowid + '_qty_' + whrowid).val(0);
        $('#AcceptQty_' + rowid).val(0);
        $('#RejectQty_' + rowid).val(0);
    }
    else {
        var posub = parseInt(poSub - poacp);
        $('#iow_' + rowid + '_RejectQty_' + iowrowid).val(sanitizeNumber(posub,3,true));
        $('input[id*=wh_'+ rowid +'_po_'+ iowrowid + '_qty_').val(000);
        if(poacp > 0 || poacp != ''){
            $('#wh_'+ rowid +'_po_'+ iowrowid + '_qty_' + whrowid).val(parseFloatVal(poacp, 0));
            //$('input[id*=wh_'+ rowid +'_po_' + iowrowid + '_qty_').prop('readonly', false);

        } else if (poacp == 0){
           // $('input[id*=wh_'+ rowid +'_po_' + iowrowid + '_qty_').prop('readonly', true);
        }

        //qty calc
        $('input[id^=iow_' + rowid + '_SupplierMIN_').each(function (i, o) {

            posap += parseInt($(this).val()) || 0;
        });
        $('#qty_' + rowid).val(sanitizeNumber(posap,3,true));

        //Acceptqty calc
        $('input[id^=iow_' + rowid + '_AcceptQty_').each(function (i, o) {

            poaptQty += parseInt($(this).val()) || 0;
        });
        $('#AcceptQty_' + rowid).val(sanitizeNumber(poaptQty,3,true));

        //RejectQty calc
        $('input[id^=iow_' + rowid + '_RejectQty_').each(function (i, o) {

            porejQty += parseInt($(this).val()) || 0;
        });
        $('#RejectQty_' + rowid).val(sanitizeNumber(porejQty,3,true));
    }
}
function calcRequestQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];
    var whrowids = $('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val();
    var whrowid = 1;

    // calc total qty
    $('#iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).prop('readonly',false);
    var $qty = $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid);
    var $order = $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid);
    var $hqty = $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_hiddenSMqty_' + requestrowid);
    qty = parseFloat($qty.val());
    order = parseFloat($order.val());
    hqty = parseFloat($hqty.val());
    $('input[id*=wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_').off("onchange");
    if (!isNaN(qty) && order < (qty-hqty)){
        alert('MIN Quantity is greater than PO Quantity');
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid).val(0);
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val(0).trigger('change');
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_rejectqty_' + requestrowid).val(0);
        $('input[id^=wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(0).trigger('change');
    }
    else {
        $('input[id*=wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_').val(0);
        $('#iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val(qty).trigger('change');
        $('#wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(qty);
        $('#iow_' + rowid + '_request_' + iowrowid + '_rejectqty_' + requestrowid).val(0);
    }
}
function calcSubQty(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];
    var sup = 0;
    var sap = 0; //suppliermin
    var apt = 0;
    var aptQty = 0;//acceptqty
    var rej = 0;
    var rejQty = 0; // rejectQty
    var whrowid = 1;

    hiddenSMqty  = parseFloat($('input[id^=iow_' + rowid + '_request_' + iowrowid + '_hiddenSMqty_' + requestrowid).val());
    if(isNaN(hiddenSMqty)){
        hiddenSMqty =0;
    }

    var supMin =  parseFloatVal($('input[id^=iow_' + rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid).val());

    var acp = parseFloatVal($('input[id^=iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val());
    var tot= parseFloatVal(supMin - hiddenSMqty);

    if( supMin < acp ){
        alert('AcceptQty should not exceed SupplierMin');
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_acceptqty_' + requestrowid).val(0000).trigger('change');

    }else {
        var sub = parseFloatVal(supMin - acp);
        $('#iow_' + rowid + '_request_' + iowrowid + '_rejectqty_' + requestrowid).val(parseFloatVal(sub, 0));
        $('input[id*=wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_').val(00);
        if(acp > 0 || acp != ''){
            $('#wh_'+ rowid +'_po_'+ iowrowid + '_wbs_' + requestrowid + '_qty_' + whrowid).val(parseFloatVal(acp, 0));
            //$('input[id*=wh_'+ rowid +'_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_').prop('readonly', false);
        } else if(acp == 0){
            //$('input[id*=wh_'+ rowid +'_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_').prop('readonly', true);
        }

        //supplierMin calc
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_suppliermin_').each(function (i, o) {

            sup += parseFloatVal($(this).val()) || 0;

        });
        $('#iow_' + rowid + '_SupplierMIN_' + iowrowid).val(sanitizeNumber(parseFloatVal(sup, 0),3,true));
        $('#qty_' + rowid).val(sanitizeNumber(parseFloatVal(sup, 0),3,false));
        $('input[id^=iow_' + rowid + '_SupplierMIN_').each(function (i, o) {

            sap += parseFloatVal($(this).val()) || 0;

        });
        $('#qty_' + rowid).val(sanitizeNumber(parseFloatVal(sap, 0),3,true));

        //AcceptQty calc
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_acceptqty_').each(function (i, o) {

            apt += parseFloatVal($(this).val()) || 0;

        });
        $('#iow_' + rowid + '_AcceptQty_' + iowrowid).val(sanitizeNumber(parseFloatVal(apt, 0),3,true));
        $('#AcceptQty_' + rowid).val(sanitizeNumber(parseFloatVal(apt, 0),3,true));

        $('input[id^=iow_' + rowid + '_AcceptQty_').each(function (i, o) {

            aptQty += parseFloatVal($(this).val()) || 0;

        });
        $('#AcceptQty_' + rowid).val(sanitizeNumber(parseFloatVal(aptQty, 0),3,true));

        //rejectQty calc
        $('input[id^=iow_' + rowid + '_request_' + iowrowid + '_rejectqty_').each(function (i, o) {

            rej += parseFloatVal($(this).val()) || 0;

        });
        $('#iow_' + rowid + '_RejectQty_' + iowrowid).val(sanitizeNumber(parseFloatVal(rej, 0),3,true));
        $('#RejectQty_' + rowid).val(sanitizeNumber(parseFloatVal(rej, 0),3,true));

        $('input[id^=iow_' + rowid + '_RejectQty_').each(function (i, o) {

            rejQty += parseFloatVal($(this).val()) || 0;

        });
        $('#RejectQty_' + rowid).val(sanitizeNumber(parseFloatVal(rejQty, 0),3,true));
    }
}
errorFlag=0;
function checkWBSWHQuantity(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var add=0;
    var whrow = parseInt($('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_wrowid').val());
//    var aqty  = parseFloatVal($('#iow_'+ rowid +'_AcceptQty_'+ iowrowid).val());
    var aqty  = parseFloatVal($('#iow_'+ rowid +'_request_'+iowrowid+'_acceptqty_'+ requestrowid).val());


    if(aqty > 0){
        for (var j = 1; j <= whrow; j++) {
            add += parseFloatVal($('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + j).val());
        }
        if(!isNaN(add) && add != aqty || add > aqty){
            showError($('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + 1) ,"Not Equal to WBS-AcceptQty");
            errorFlag = 1;
        } else {
            removeError($('#wh_' + rowid + '_po_' + iowrowid + '_wbs_' + requestrowid + '_qty_' + 1));
            errorFlag = 0;
        }
    }
}

function checkPOWHQuantity(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var whrow = ids[5];

    var whrow = parseInt($('#wh_' + rowid + '_po_' + iowrowid + '_wrowid').val());
    var aqty = parseFloatVal($('#iow_' + rowid + '_AcceptQty_' + iowrowid).val());
    var add=0;

    if(aqty > 0){
        for (var j = 1; j <= whrow; j++) {
            add += parseFloatVal($('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + j).val());
        }
        if (!isNaN(add) && add > aqty || add != aqty ) {
            showError($('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + 1) ,"Not Equal to PO-AcceptQty");
            errorFlag = 1;
        } else {
            removeError($('#wh_' + rowid + '_po_' + iowrowid + '_qty_' + 1));
            errorFlag = 0;
        }

    }
}
function calcQty(){
    var totalQty = 0;
    $('iow_'+ rowid + '_request_' + iowrowid + '_suppliermin_' + requestrowid).each(function(){
        if(!isNaN(this.value) && this.value.length!=0) {
            totalQty += parseFloat(this.value);
        }
    });
    $('#iow_'+rowid+'_SupplierMIN_'+iowrowid).val(sanitizeNumber(totalQty,3,true));
}

function calcTotal() {
    var total = 0;
    $.each($('input[id^=amount_]'), function (i,o) {
        total += parseFloatVal($(this).val());
    });
    $('#total').val(sanitizeNumber(total,3,true));
}

//multiple_dropdown//
$(document).ready(function() {
    $(".multiple_dropdown").select2({
    });
});
//tripsheet

$("#vehicleId").change(function(e){
    var vehicleId = $("#vehicleId").val();
    $.ajax({
        url: getBaseURL() + 'mms/min/minentry',
        type: "post",
        data: "vehicleId=" + vehicleId,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);
                var vName = data.vehicleid;

                $("#VehicleName").val(vName.VehicleName);
                $("#bLength").val(sanitizeNumber(vName. BLLen,3,true));
                $("#bBreadth").val(sanitizeNumber(vName.BLBreadth,3,true));
                $("#bHeight").val(sanitizeNumber(vName.BLHeight,3,true));
                $("#bQty").val(sanitizeNumber(vName.BLQty,3,true));
                $("#tMaxLength").val(sanitizeNumber(vName.TSMAXLen,3,true));
                $("#tMaxBreadth").val(sanitizeNumber(vName.TSMAXBreadth,3,true));
                $("#tMaxHeight").val(sanitizeNumber(vName.TSMAXHeight,3,true));
                $("#tMaxQty").val(sanitizeNumber(vName.TSMAXQty,3,true));
                $("#tMinLength").val(sanitizeNumber(vName.TSMinLen,3,true));
                $("#tMinBreadth").val(sanitizeNumber(vName.TSMinBreadth,3,true));
                $("#tMinHeight").val(sanitizeNumber(vName.TSMinHeight,3,true));
                $("#tMinQty").val(sanitizeNumber(vName.TSMinQty,3,true));
                $("#bctotal").val(sanitizeNumber(vName.Total1,3,true));
                $("#perQty").val(sanitizeNumber(vName.Total2,3,true));
                $("#netQty").val(sanitizeNumber(vName.NetTotal,3,true));
                $("#remarks").val(vName.Remarks);

            }

        } , error: function (jqXHR, textStatus, errorThrown) {

        }
    });
});
function formValidate() {
    var errorFlag = 0;
    var errorFlagCount = 0;
    if($('#vehicleId').val() == "" || $('#vehicleId').val() == null){
        $('#vehicleId').closest('.form-group').find(".error_message").show();
        errorFlagCount = errorFlagCount + 1;
        errorFlag = 1;
        if(errorFlagCount == 1) {
            $('#vehicleId').focus();
        }
    }
    if(errorFlag == 0) {
        return true;
    } else {
        return false;
    }
}

function btotal(){
    var len,breadth,height,tot;
    len = parseFloatVal($("#bLength").val());
    breadth = parseFloatVal($("#bBreadth").val());
    height = parseFloatVal($("#bHeight").val());
    tot = parseFloatVal(len * breadth * height);
    $("#bQty").val(sanitizeNumber(tot,3,true));
    totalCalulation()
}

function tMaxTot(){
    var tMaxLen,tMaxBreadth,tMaxHeight,tMaxTot;
    tMaxLen = parseFloatVal($("#tMaxLength").val());
    tMaxBreadth = parseFloatVal($("#tMaxBreadth").val());
    tMaxHeight = parseFloatVal($("#tMaxHeight").val());
    tMaxTot = parseFloatVal(tMaxLen * tMaxBreadth * tMaxHeight);
    $("#tMaxQty").val(sanitizeNumber(tMaxTot,3,true));
    totalCalulation()
}

function tMinTot(){
    var tMinLen,tMinBreadth,tMinHeight,tMinTot;
    tMinLen = parseFloatVal($("#tMinLength").val());
    tMinBreadth = parseFloatVal($("#tMinBreadth").val());
    tMinHeight = parseFloatVal($("#tMinHeight").val());
    tMinTot = parseFloatVal(tMinLen * tMinBreadth * tMinHeight);
    $("#tMinQty").val(sanitizeNumber(tMinTot,3,true));
    totalCalulation()
}

function totalCalulation(){
    var bctot,tMaxQty,tMinQty,bQty,perQty,netQty,bctot;
    tMaxQty = parseFloatVal($("#tMaxQty").val());
    bQty = parseFloatVal($("#bQty").val());
    tMinQty = parseFloatVal($("#tMinQty").val());
    bctot = parseFloatVal(tMaxQty + tMinQty);
    perQty = parseFloatVal(bctot/2);
    netQty = parseFloatVal(bQty + perQty);
    $("#bctotal").val(sanitizeNumber(bctot,3,true));
    $("#perQty").val(sanitizeNumber(perQty,3,true));
    $("#netQty").val(sanitizeNumber(netQty,3,true));


}
/*weigh bridge*/
function loadTot(){
    var a,b,c;
    a = parseFloatVal($("#WithLoad").val());
    b = parseFloatVal($("#WithOutLoad").val());
    c = parseFloatVal(a - b);
    $("#MaterialWeigh").val(sanitizeNumber(c,3,true));
}
$('textarea').focus(function(){
    $(this).removeAttr('placeholder');
});

function validateResource(){
    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 3){
        alert('Add Resource');
        return false;
    } else {
        nextAccordian(2,1);
    }
}

var fileList = [];
function removeFile(){
    $('.vq').unbind('click');
    $('.vq').bind('click', function(){
        var ele = $(this);
        var fname = ele.attr('fname');
        $.ajax({
            <?php if(isset ($dcid)){ ?>
            url:getBaseURL()+"mms/min/uploadfile/<?php echo $dcid; ?>",
            <?php } else { ?>
            url:getBaseURL()+"mms/min/uploadfile/0",
            <?php } ?>
            type:'post',
            data:'mode=delete&fname='+fname,
            success:function(data, textStatus, errorThrown){
                fileList.splice($.inArray(fname, fileList),1);
                ele.closest('div.file_content').fadeOut(500, function(){
                    $(this).remove();
                })
            },
            erorr:function(jqXHR, textStatus, errorThrown){

            }
        });
    });
}
removeFile();
$('#drag-and-drop-zone').dmUploader({
    <?php if(isset ($dcid)){ ?>
    url:getBaseURL()+"mms/min/uploadfile/<?php echo $dcid; ?>",
    <?php } else { ?>
    url:getBaseURL()+"mms/min/uploadfile/0",
    <?php } ?>
    dataType: 'json',
    //allowedTypes: 'image/*',
    onInit: function(){

    },
    onBeforeUpload: function(id){
    },
    onNewFile: function(id, file){
        $.danidemo.addFile('#demo-files', id, file);

        /*** Begins Image preview loader ***/
        if (typeof FileReader !== "undefined"){

            var reader = new FileReader();

            // Last image added
            var img = $('#demo-files').find('.demo-image-preview').eq(0);

            reader.onload = function (e) {
                img.attr('src', e.target.result);
            };

                reader.readAsDataURL(file);

        } else {
            // Hide/Remove all Images if FileReader isn't supported
            $('#demo-files').find('.demo-image-preview').remove();
        }
        /*** Ends Image preview loader ***/

    },
    onComplete: function(){
        $.danidemo.addLog('#demo-debug', 'default', 'All pending tranfers completed');
        removeFile();
    },
    onUploadProgress: function(id, percent){
        var percentStr = percent + '%';

        $.danidemo.updateFileProgress(id, percentStr);
    },
    onUploadSuccess: function(id, data){
        fileList.push(data.fname);
        $.danidemo.updateFileProgress(id, '100%');
        <?php if(isset ($dcid)){ ?>
            $('#demo-file'+id).find('a').attr('href', '<?php echo $this->basePath(); ?>/uploads/mms/<?php echo isset ($dcid); ?>/'+data.fname);
        <?php } else {?>
            $('#demo-file'+id).find('a').attr('href', '<?php echo $this->basePath(); ?>/uploads/doc_files/'+data.fname);
        <?php }?>
        $('#demo-file'+id).find('a').attr('download', data.fname);
        $('#demo-file'+id).find('a').text((data.fname.length > 50)?data.fname.substring(0, 50)+'...':data.fname);
        $('#demo-file'+id).find('.vq').attr('fname', data.fname);
    },
    onUploadError: function(id, message){

    },
    onFileTypeError: function(file){

    },
    onFileSizeError: function(file){

    },
    onFallbackMode: function(message){

    }
});

/*Quality Files upload*/
var qfileList = [];
function removeFile(){
    $('.vq1').unbind('click');
    $('.vq1').bind('click', function(){
        var ele = $(this);
        var f11name = ele.attr('f1name');
        $.ajax({
            <?php if(isset ($dcid)){ ?>
            url:getBaseURL()+"mms/min/quality-test-upload/<?php echo $dcid; ?>",
            <?php } else { ?>
            url:getBaseURL()+"mms/min/quality-test-upload/0",
            <?php } ?>
            type:'post',
            data:'mode=delete&f11name='+f11name,
            success:function(data, textStatus, errorThrown){
                qfileList.splice($.inArray(f11name, qfileList),1);
                ele.closest('div.file_content').fadeOut(500, function(){
                    $(this).remove();
                })
            },
            erorr:function(jqXHR, textStatus, errorThrown){

            }
        });
    });
}
removeFile();
$('#drag-and-drop-zone1').dmUploader({
    <?php if(isset ($dcid)){ ?>
    url:getBaseURL()+"mms/min/quality-test-upload/<?php echo $dcid; ?>",
    <?php } else { ?>
    url:getBaseURL()+"mms/min/quality-test-upload/0",
    <?php } ?>
    dataType: 'json',

    onInit: function(){},
    onBeforeUpload: function(id){},
    onNewFile: function(id, file){
        $.danidemo.addFile('#demo-files1', id, file);

        /*** Begins Image preview loader ***/
        if (typeof FileReader !== "undefined"){
            var reader = new FileReader();
            // Last image added

            var img = $('#demo-files1').find('.demo-image-preview').eq(0);

            reader.onload = function (e) {
                img.attr('src', e.target.result);
            };

            reader.readAsDataURL(file);

        } else {
            // Hide/Remove all Images if FileReader isn't supported
            $('#demo-files1').find('.demo-image-preview').remove();
        }
        /*** Ends Image preview loader ***/

    },
    onComplete: function(){
        $.danidemo.addLog('#demo-debug', 'default', 'All pending tranfers completed');
        removeFile();
    },
    onUploadProgress: function(id, percent){
        var percentStr = percent + '%';

        $.danidemo.updateFileProgress(id, percentStr);
    },
    onUploadSuccess: function(id, data){
        qfileList.push(data.f1name);
        $.danidemo.updateFileProgress(id, '100%');
        <?php if(isset ($dcid)){ ?>
            $('#demo-file'+id).find('a').attr('href', '<?php echo $this->basePath(); ?>/uploads/mms/QT-files/<?php echo isset ($dcid); ?>/'+data.f1name);
        <?php } else {?>
            $('#demo-file'+id).find('a').attr('href', '<?php echo $this->basePath(); ?>/uploads/doc_files/'+data.f1name);
        <?php }?>
        $('#demo-file'+id).find('a').attr('download', data.f1name);
        $('#demo-file'+id).find('a').text((data.f1name.length > 50)?data.f1name.substring(0, 50)+'...':data.f1name);
        $('#demo-file'+id).find('.vq1').attr('f1name', data.f1name);
    },
    onUploadError: function(id, message){

    },
    onFileTypeError: function(file){

    },
    onFileSizeError: function(file){

    },
    onFallbackMode: function(message){

    }
});
/*end of the files upload*/

$( document ).ready(function() {
    if('<?php echo (isset($approve)) ? $approve : '';?>' == 'Yes')
    {
        $('#sub1').hide();
    }
    else if('<?php echo (isset($approve)) ? $approve : '';?>' == 'Partial')
    {
        $('#sub1').hide();
    }
    else{
        $('#sub1').show();
    }

});



</script>
