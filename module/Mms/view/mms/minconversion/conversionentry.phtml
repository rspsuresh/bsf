<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css';?>"/>

<!--STYLE-->
<style>
    .sub_tbl1 {color:#424141;font-weight: 600; background:#edefe2 !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{color: #424141;font-weight: 600; background: #efe2e2 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl3{color: #424141;font-weight: 600; background: #ceefe5 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .date_icon{top:10px!important;right:22px !important;}
	.selected-xs{width:50%!important;border:0px solid #babdb8!important;}
    .selected-xs select{height:20px;color: #266aa8; padding-left:0px !important; font-size:13px !important;cursor:pointer;}
    .select-style {float: left;width: 100%;padding: 0;margin: 0;border: 1px solid #c2c2c2;overflow: hidden;background-color: #fff;border-radius: 0px;}
    .bar1, .bar2, .bar3 {width: 18px;height: 3px;background-color: #009688;margin: 3px 0;transition: 0.4s;}
    .change .bar1 {-webkit-transform: rotate(-45deg) translate(-6px, 5px);transform: rotate(-45deg) translate(-6px,5px);}
    .change .bar2 {opacity: 0;}
    .change .bar3 {-webkit-transform: rotate(45deg) translate(-3px, -3px);transform: rotate(45deg) translate(-3px, -3px);}
    .flip0{float:right;margin-top:5px;cursor:pointer;}
    .margn_8{margin-bottom:8px;}
	.lbl_ptb {padding-top: 5px!important;padding-bottom:5px !important;}
	.pan_box{height:135px !important;}
</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/mms/minconversion/conversionsave">
<input type="hidden" id="costcentreId" name="costcentreId" value="<?php echo (isset($CostCentre)) ? $CostCentre['CostCentreId'] : '';?>">
<input type="hidden" name="vendorId" id="vendorId" value="<?php echo (isset($Vendor)) ? $Vendor['VendorId'] : '';?>">
<input type="hidden" name="pvId" value="<?php echo (isset($pvId)) ? $pvId : 0;?>">
<input type="hidden" id="gridtype" name="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : 0;?>">
<input type="hidden" id="dcgId" name="dcgId" value="<?php echo (isset($dcGroupIds)) ? $dcGroupIds : 0;?>">
<div class="col-lg-12">
    <h1 class="col-lg-3">MIN Conversion
		<div class="flip0">
			<div class="click" onclick="myFunction(this)">
				<div class="bar1"></div>
				<div class="bar2"></div>
				<div class="bar3"></div>
			</div>
		</div>	
	</h1>
</div>
<div class="col-lg-12">
	<div class="pane0">
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>CostCentre</label>
						<span class="mgic"><input type="text" id="costCentre" name="costCentre" value="<?php echo (isset($CostCentre)) ? $CostCentre['CostCentreName'] : ''; ?> "readonly /></span>
					</li>
					<li class="lbl_ptb">
						<label>Vendor</label>
						<span class="mgic"><input type="text" id="vendor" name="vendor" value="<?php echo (isset($Vendor)) ? $Vendor['VendorName'] : ''; ?> "readonly /></span>
					</li>
					<li class="lbl_ptb">
						<label>Purchase Type</label>
						<span>
							<div class="select-style selected-xs margn_8">
								<select name="purchase_type" id="purchase_type" onchange="selAccount();" data-placeholder="Select Purchase Type">
									<option value="" >Select Purchase Type</option>
									<?php foreach($purchaseType as $Purtype):
                                        if($Purtype['Default'] != 1){?>
                                        <option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ( (isset($purchasetype) && $Purtype['PurchaseTypeId'] == $purchasetype ) ) ? 'selected' : ""; ?>   ><?php echo $Purtype['PurchaseTypeName']; ?></option>
                                        <?php  } else { ?>
                                            <option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ($Purtype['Default'] == 1 ) ? 'selected' : ""; ?>><?php echo $Purtype['PurchaseTypeName']; ?></option>
                                        <?php  } ?>
									<?php endforeach; ?>
								</select>
							</div>
							<script>
								$(document).ready(function() {
									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
					</li>
					<li class="lbl_ptb">
						<label>Account Type</label>
						<span>
							<div class="select-style selected-xs margn_8">
								<select name="account_type" id="account_type" class="" data-placeholder="Select Account Type">
									<option value="" >Select Account Type</option>
									<?php if(isset($accType)) :?>
										<?php foreach($accType as $aType):?>
											<option value="<?php echo $aType['data']; ?>" <?php echo ( (isset($accounttype) && $aType['data'] == $accounttype) ) ? 'selected' : ''; ?>><?php echo $aType['value']; ?></option>
										<?php endforeach; ?>
									<?php endif; ?>
								</select>
							</div>
							<div class="error_message"><p>Please enter Account type...</p></div>
							<script>
								$(document).ready(function() {
									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>PV Date</label>
						<span><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="pvdate" name="pvdate" style="cursor:pointer;" value="<?php echo (isset($PVDate)) ? date('d-m-Y',strtotime(str_replace("/","-",$PVDate))) : date('d-m-Y');?>" readonly onchange="validateDate(this)"/></span>
					</li>
					<li class="lbl_ptb">
						<label>Bill No</label>
						<span><input type="text" placeholder="xxxx" id="billno" name="billno" value="<?php echo (isset($BillNo)) ? $BillNo : '';?>"/></span>
					</li>
					<li class="lbl_ptb">
						<label>Bill Date</label>
						<span><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="billdate" name="billdate" style="cursor:pointer;" value="<?php echo (isset($BillDate)) ? date('d-m-Y',strtotime(str_replace("/","-",$BillDate))) : date('d-m-Y');?>" onchange="validateDate(this)" readonly/></span>
					</li>
					<li class="lbl_ptb">
						<label>Currency</label>
						<span>
							<div class="select-style selected-xs margn_8">
								<select id="currency" name="currency"  class="" data-placeholder="Select currency">
									<option value="" >Select Currency Type</option>
									<?php foreach($currencyList as $Curtype):?>
										<option value="<?php echo $Curtype['CurrencyId']; ?>" <?php echo ( (isset($currency) && $Curtype['CurrencyId'] == $currency) || (!isset($currency) && $Curtype['CurrencyId'] == 1 )) ? 'selected' : ''; ?>><?php echo $Curtype['CurrencyName']; ?></option>
									<?php endforeach; ?>
								</select>
							</div>
							<script>
								$(document).ready(function() {
									$(".single_dropdowncur").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>PV No</label>
						<span><input type="text" placeholder="xxxxx" id="pvno" name="pvno" value="<?php echo (isset($vNo)) ? $vNo : ''; ?> "readonly /></span>
					</li>
					<li class="lbl_ptb">
						<label>CCPV No</label>
						<?php if((((isset($pvId)) ? $pvId : 0) >0  || $CCPV['genType']==0)){?>
							<span><input type="text" placeholder="xxxxx" id="ccpvno" name="ccpvno" value="<?php echo (isset($CCPVNo)) ? $CCPVNo : '';?>"/></span>
						<?php }else{ ?>
							<span><input type="text" placeholder="xxxxx" id="ccpvno" name="ccpvno" value="<?php echo (isset($CCPVNo)) ? $CCPVNo : '';?>" readonly/></span>
						<?php } ?>
					</li>
					<li class="lbl_ptb">
						<label>CPV No</label>
						<?php if((((isset($pvId)) ? $pvId : 0) >0  || $CPV['genType']==0)){?>
							<span><input type="text" placeholder="xxxxx" id="cpvno" name="cpvno" value="<?php echo (isset($CPVNo)) ? $CPVNo : '';?>"/></span>
						<?php }else{ ?>
							<span><input type="text" placeholder="xxxxx" id="cpvno" name="cpvno" value="<?php echo (isset($CPVNo)) ? $CPVNo : '';?>" readonly/></span>
						<?php } ?>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="clearfix"></div>
<div class="col-lg-12 clear top-20">
<div id="accordion" class="panel-group">
    <!-------------------------------Bill of Quantities------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
            <h4 class="panel-title accordion-toggle defa_panels">BILL Quantity</h4>
        </div>
        <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="col-lg-12">
                    <div class="table-responsive top-30">
                        <table class="table" style=" margin-bottom:0px;" id="workorderTable">
                            <thead>
                            <tr>
                                <th>Resource</th>
                                <th>Unit</th>
                                <th>Bill Qty</th>
                                <th>Actual Qty</th>
                                <th>Rate</th>
                                <th>QRate</th>
                                <th>Base Amount</th>
                                <th>Qual Amount</th>
                                <th>&nbsp;</th>
                                <th>&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            <tr>
                                <td>&nbsp;</td>
                                <td colspan="5">&nbsp;</td>
                                <td align="right" class="rate_pri">Base Amount</td>
                                <td width="10%">
                                    <input class="parent_text border-none" type="text" name="basetotal" style="text-align:right;" id="basetotal" readonly/>
                                    <input type="hidden" name="basetotal" id="basetotal"/>
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td colspan="5">&nbsp;</td>
                                <td align="right" class="rate_pri">Amount</td>
                                <td width="10%">
                                    <input class="parent_text border-none" type="text" name="total"
                                           style="text-align:right;" id="total" data-tot="0" readonly/>
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td colspan="5">&nbsp;</td>
                                <td align="right" class="rate_pri">Net Amount</td>
                                <td width="10%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="nettotal" id="nettotal"
                                           value="" readonly/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="rowid" id="rowid" value="0"/>
                    </div>
                    <!----- sequantial view total --------->
                    <div class="col-lg-12 padlr0">
                        <table class="table" style=" margin-bottom:0px;display:none;" id="seqTotal">
                            <tbody class="total">
                            <tr>
                                <td align="right" class="rate_pri">Base Amount</td>
                                <td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="basetotal1" id="basetotal1" readonly/>
                                </td>
                                <td align="right" class="rate_pri">Qual Amount</td>
                                <td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="total1" id="total1" readonly/>
                                </td>
                                <td align="right" class="rate_pri">Net Amount</td>
                                <td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="nettotal1" id="nettotal1" readonly/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--------- end --------------->
                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:void(0);" onclick="checkAdvance();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
<!--                            <li><a href="javascript:nextAccordian(2)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>-->

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-------------------------------Bill of Quantities end------------------------------->
    <!-------------------------------Advance Adjustment Tab ------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
            <h4 class="panel-title accordion-toggle defa_panels">Advance Adjustment</h4>
        </div>
        <div class="panel-collapse collapse collapseTwo" id="" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="col-lg-12">
                    <div class="table-responsive top-30">
                        <table class="table table-hover clear" id="AdvanceTable">
                            <thead>
                            <tr>
                                <th>PO NO</th>
                                <th style="text-align: left;">PO Date</th>
                                <th style="text-align: left;">Title</th>
                                <th style="text-align: right;">Amount</th>
                                <th style="text-align: right;">Paid Amount</th>
                                <th style="text-align: right;">Balance</th>
<!--                                <th>Deduction Balance</th>-->
                                <th style="text-align: right;">Current Amount</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            <tr>
                                <td colspan="5"></td>
                                <td class="rate_pri">Total Amount</td>
                                <td width="25%" ><input class="parent_text border-none" type="text" name="advtotal" id="advtotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" readonly/></td>

                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="Arowid" id="Arowid" value="0"/>

                    </div>
                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:void(0);" onclick="calQualList();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>

<!--                            <li><a href="javascript:nextAccordian(3)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>-->
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-------------------------------End of Advance --------------------------------------->
    <!-------------------------------QualifierTab----------------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
            <h4 class="panel-title accordion-toggle defa_panels">Qualifier Details</h4>
        </div>
        <div class="panel-collapse collapse collapseThree" id="" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="col-lg-12">
                    <div class="table-responsive top-30">
<!--                        <table class="table" style=" margin-bottom:0px;" id="termsTable">-->
<!--                            <thead>-->
<!--                            <tr>-->
<!--                                <th>Terms</th>-->
<!--                                <th>Value</th>-->
<!--                                <th>Account</th>-->
<!--                            </tr>-->
<!--                            </thead>-->
<!--                            <tbody class="main"></tbody>-->
<!--                        </table>-->
<!--                        <input type="hidden" name="trowid" id="trowid" value="0"/>-->

                        <table class="table table-hover" >
                            <thead>
                            <tr>
                                <th>Qualifier Name</th>
                                <th>Account Name</th>
                                <th style="text-align: right;">Sign</th>
                                <th style="text-align: right;">%</th>
                                <th style="text-align: right;">Amount</th>
                            </tr>
                            </thead>
                            <tbody class="main" id="QualifierAccTable"></tbody>
                            <tbody class="total">
                            <tr>
                                <td colspan="3"></td>
                                <td class="rate_pri">Total Amount</td>
                                <td width="30%" ><input class="parent_text border-none " type="text" name="qutotal" id="qutotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" readonly/></td>
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="Qrowid" id="Qrowid" value="0"/>

                    </div>
                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:void(0);" onclick="submitForm();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
<!--                            <li><a href="javascript:nextAccordian(4)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>-->
                        </ul>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-------------------------------end of qualifierTab---------------------------------->
    <!-------------------------------Terms and Condition------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-4">
            <h4 class="panel-title accordion-toggle defa_panels">Terms And Conditions</h4>
        </div>
        <div class="panel-collapse collapse" id="collapseFour" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="col-lg-12">
                    <div class="table-responsive top-30">
                        <table class="table" style=" margin-bottom:0px;" id="termsTable">
                            <thead>
                            <tr>
                                <th>Terms</th>
                                <th>Value</th>
                                <th>Account</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                        </table>
                        <input type="hidden" name="trowid" id="trowid" value="0"/>
                    </div>
                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:void(0);" onclick="checkTermsAcc();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!------------------------------- END OF Terms and Condition------------------------------->
    <!-------------------------------Others Details------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseFive" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-5">
            <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
        </div>
        <div class="panel-collapse collapse" id="collapseFive" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="clearfix"></div>
                <div class="col-lg-12">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#nar" id="narrationTabLink" onclick="showotherstabs('narration')" aria-controls="naration" role="tab" data-toggle="tab">Narration</a></li>
                        </ul>
                        <div class="tab-content" id="narration">
                            <div class="tab-pane active" id="nar">
                                <p>
                                <div class="col-lg-12">
                                    <?php
                                    if(isset($Narration)){
                                        ?>
                                        <textarea class="exp-tex" name="narration" id="narration"><?php echo (isset($Narration)) ? $Narration : '';?></textarea>
                                    <?php }else{ ?>
                                        <textarea class="exp-tex" name="narration" id="narration" placeholder="Enter your Notes..."></textarea>
                                    <?php } ?>
                                </div>
                                </p>
                            </div>
                            <div class="col-lg-12 savebtn_area">
                                <ul>
									<li class="dropdown save_btn float_r"><a onclick="validateForm()" data-toggle="model" id="sub1" title="submit">Submit</a> </li>
									<li class="cancel_btn float_r">
										<?php if(isset($Approve) && $Approve=="N"): ?>
											<a href="<?php echo $this->basePath();?>/mms/minconversion/conversionregister" data-toggle="tooltip" class="ripple" title="Go to Register!">Close</a>
										<?php elseif (isset($Approve) && $Approve=='P'): ?>
											<a href="<?php echo $this->basePath();?>/mms/minconversion/conversionregister" data-toggle="tooltip" class="ripple" title="Go to Register!">Back</a>
										<?php else: ?>
											<a href="<?php echo $this->basePath();?>/mms/minconversion/conversion" data-toggle="tooltip" class="ripple" title="Close!">Close</a>
										<?php endif; ?>
									</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!------------------------------- end of Others Details------------------------------->
<!-------------------------------Qualifier And Advance Adjustment-------------->

<!--------------------------------------Qualacc-pop up--------->
<!--<div class="modal fade"  id="QualaccModal" role="dialog" data-backdrop="static">-->
<!--    <div class="modal-dialog">-->
<!--        <div class="modal-content" style="width:750px !important;">-->
<!--            <div class="modal-header">-->
<!--                <button data-dismiss="modal" aria-hidden="true" class="close"></button>-->
<!--                <h4 class="modal-title" style="color:#18439d;">Qualifier Account</h4>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <div class="row">-->
<!--                    <div class="container-fluid">-->
<!--                        <div class="col-lg-12">-->
<!--                            <div class="table-responsive clear">-->
<!--                                <table class="table table-hover clear">-->
<!--                                    <thead>-->
<!--                                    <tr>-->
<!--                                        <th>Qualifier Name</th>-->
<!--                                        <th>Account Name</th>-->
<!--                                        <th>Sign</th>-->
<!--                                        <th>%</th>-->
<!--                                        <th>Amount</th>-->
<!--                                    </tr>-->
<!--                                    </thead>-->
<!--                                    <tbody class="main" id="QualifierAccTable"></tbody>-->
<!--                                    <tbody class="total">-->
<!--                                    <tr>-->
<!--                                        <td colspan="3"></td>-->
<!--                                        <td class="rate_pri">Total Amount</td>-->
<!--                                        <td width="30%" ><input class="parent_text border-none " type="text" name="qutotal" id="qutotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" readonly/></td>-->
<!--                                    </tr>-->
<!--                                    </tbody>-->
<!--                                </table>-->
<!--                                <input type="hidden" name="Qrowid" id="Qrowid" value="0"/>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class= "modal-footer">-->
<!--                <div class="col-lg-12 savebtn_area no_border">-->
<!--                    <ul>-->
<!--                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>-->
<!--                        <li class="dropdown save_btn float_r"><a onclick="submitForm()" data-toggle=model" title="submit"> Submit</a> </li>-->
<!--                    </ul>-->
<!--                </div>-->
<!--                <div class="clear"></div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<script id="Qual-template"  type="text/template" class="hide">
    <tr>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="qualifiername__7" id="qualifiername__8" value="" readonly/>
            <input type="hidden" name="QualifierExist___qu__0_per__9" id="QualifierExist___qu__0_per__9" value=""/>
            <input type="hidden" name="QualifierId__7" id="QualifierId__8" value=""/>
        </td>
        <td width="30%"><select data-placeholder="" class="form-control single_dropdown lbl_move sortoption qchk " tabindex="7" onchange="getAccountData(this);"  name="accountname__7" id="accountname__8">
            </select></td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="sign__7" id="sign__8" value="" readonly/></td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="percentage__7" id="percentage__8" value="" readonly/></td>
        <td width="30%"><input class="parent_text red-non qualmainTrInput qualpop qualamount" style="text-align: right;" type="text" name="qualamount__7" id="qualamount__8" value="" readonly/></td>
    </tr>
</script>
<!------Qualacc-pop up--------->
<!------advance adjustment-pop up--------->
<!--<div class="modal fade"  id="adajModal" role="dialog" data-backdrop="static">-->
<!--    <div class="modal-dialog" style="width:850px !important;">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>-->
<!--                <h4 class="modal-title" style="color:#18439d;">Advance Adjustment</a></h4>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <div class="row">-->
<!--                    <div class="container-fluid">-->
<!--                        <div class="col-lg-12">-->
<!--                            <div class="table-responsive clear">-->
<!--                                <table class="table table-hover clear" id="AdvanceTable">-->
<!--                                    <thead>-->
<!--                                    <tr>-->
<!--                                        <th>PONO</th>-->
<!--                                        <th>PODate</th>-->
<!--                                        <th>Title</th>-->
<!--                                        <th>Amount</th>-->
<!--                                        <th>Paid Amount</th>-->
<!--                                        <th>Balance</th>-->
<!--                                        <th>Current Amount</th>-->
<!--                                    </tr>-->
<!--                                    </thead>-->
<!--                                    <tbody class="main"></tbody>-->
<!--                                    <tbody class="total">-->
<!--                                    <tr>-->
<!--                                        <td colspan="5"></td>-->
<!--                                        <td class="rate_pri">Total Amount</td>-->
<!--                                        <td width="25%" ><input class="parent_text border-none" type="text" name="advtotal" id="advtotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" readonly/></td>-->
<!---->
<!--                                    </tr>-->
<!--                                    </tbody>-->
<!--                                </table>-->
<!--                                <input type="hidden" name="Arowid" id="Arowid" value="0"/>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class= "modal-footer">-->
<!--                <div class="col-lg-12 savebtn_area no_border">-->
<!--                    <ul>-->
<!--                        <li class="dropdown save_btn float_r"><a onclick="checkQualifier()" data-dismiss="modal">Continue</a></li>-->
<!--                    </ul>-->
<!--                </div>-->
<!--                <div class="clear"></div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<script id="Advance-template"  type="text/template" class="hide">
    <tr>
        <td width="5%"><input class="parent_text red-non qualmainTrInput" type="text" name="pono__" id="pono__" readonly/></td>
        <td width="15%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input date_picker red-non qualmainTrInput" type="text" name="podate__" id="podate__" readonly />
                <span class="date_icon"><i class="fa fa-calendar"></i></span>
            </div>
        </td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput" type="text" name="title__" id="title__" readonly/></td>
        <td width="12%"><input class="parent_text red-non qualmainTrInput" type="text" style="text-align: right;"  name="aamount__" id="aamount__" readonly /></td>
        <td width="12%"><input class="parent_text red-non qualmainTrInput" type="text" style="text-align: right;" name="paidamount__" id="paidamount__" readonly /></td>
        <td width="12%"><input class="parent_text red-non qualmainTrInput" type="text"  style="text-align: right;" name="balance__" id="balance__" readonly /></td>
<!--        <td width="12%"><input class="parent_text red-non qualmainTrInput" type="text"  style="text-align:right;" name="deductbal__" id="deductbal__" readonly /></td>-->
        <td width="12%"><input class="parent_text red-non qualmainTrInput" type="text" style="text-align:right;" name="currentamount__" id="currentamount__"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 2, true)" onchange="advamount(this);"/>
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="poregisterid__" id="poregisterid__" />
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="advtermsid__" id="advtermsid__" />
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="hiddenamt__" id="hiddenamt__" /></td>
    </tr>
</script>
<!------/advance adjustment-pop up--------->
<!---------------------------------end of qual&advance------------------------->

<script id="resource-template"  type="text/template" class="hide">
    <?php
    $displayscreen="display:show";
    $displaymaintr="";
    if($gridtype==1) {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }  ?>
    <tr class="count-tr">
        <td width="25%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);" />
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td width="8%">
            <input class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="11%">
            <input class="parent_text border-none" type="text" name="bqty__" id="bqty__"  style="text-align:right;"  onkeypress="return isqtyDecimal(event,this)" onblur="return FormatNum(this, 3, true)"   onchange="return bQtyChange(this);"/>
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" >
        </td>
        <td width="11%">
            <input class="parent_text border-none <?php echo $displaymaintr; ?>" type="text" name="aqty__" id="aqty__" style="text-align:right;"  readonly />
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" >
        </td>
        <td width="11%"><input class="parent_text border-none" type="text" name="rate__" id="rate__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" maxlength="20" onchange="rateChange(this.id)"/></td>
        <td width="11%"><input class="parent_text border-none" type="text" name="qrate__" id="qrate__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" maxlength="20"  readonly/></td>
        <td width="12%"><input class="parent_text border-none" type="text" name="baseamount__" style="text-align:right;" id="baseamount__" readonly/></td>
        <td width="12%"><input class="parent_text border-none" type="text" name="amount__" style="text-align:right;" id="amount__" readonly/></td>

        <td width="2%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>

        <!--            <td width="2%" align="center" class="action_btns_td">-->
        <!--                <ul class="action_btns">-->
        <!--                    <li><a onclick="return stockPODetails(this);"  id="expandSt__" style="display:none !important;" ><i class="fa fa-suitcase" data-toggle="modal" data-original-title="Stock Details" data-target="#stockPOModal" data-placement="left"></i></a></li>-->
        <!--                    <li><a onclick="return prerateDetails(this);"  id="expandRt__" style="display:none !important;" ><i class="fa fa-star-half-o" data-toggle="modal" data-original-title="Previous Rate" data-target="#preRateModal" data-placement="left"></i></a></li>-->
        <!--                </ul>-->
        <!--            </td>-->

    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="showtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;">Min<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li class=""><a class="ripple has-ripple" id="qualifierTabLink__" onclick="showtabs('qualifier',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Qualifier<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="tab-content">
                        <div class="tab-pane active">
                            <div class="table-responsive topsp">
                                <table class="table" style="margin-bottom:0px;" id="decisionTable__">
                                    <thead>
                                    <tr>
                                        <th class="worktype-activity sub_tbl3">MIN No</th>
                                        <th class="worktype-activity sub_tbl3">MIN Date</th>
<!--                                        <th class="worktype-activity sub_tbl3">Site Min No</th>-->
<!--                                        <th class="worktype-activity sub_tbl3">Site Min Date</th>-->
                                        <th class="worktype-activity sub_tbl3">MIN Qty</th>
                                        <th class="worktype-activity sub_tbl3">Accept Qty</th>
                                        <th class="worktype-activity sub_tbl3">Prev Bill Qty</th>
                                        <th class="worktype-activity sub_tbl3">Bal Qty</th>
<!--                                        <th class="worktype-activity sub_tbl3">Qty</th>-->
                                        <th class="worktype-activity sub_tbl3">&nbsp;</th>
                                        <th class="iow___requestfields" style="display: none;">&nbsp;</th>
                                    </tr>
                                    </thead>


                                    <tbody class="main"></tbody>
                                    <tbody class="total" id="balTotal">
                                    <tr class="dont-hide" id="bmintotal__" style="display: show;">
                                        <td colspan="5"align="right" class="rate_pri">Balance MIN Quantity</td>
                                        <td width="18%">
                                            <input class="parent_text border-none" style="text-align:right;" type="text" name="bminbaltotal__" id="bminbaltotal__" readonly/>
                                            <input class="parent_text border-none" style="text-align:right;" type="hidden" name="bminhiddentotal__" id="bminhiddentotal__" readonly/>
                                        </td>
                                    </tr>
                                    </tbody>
                                    <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                                </table>

                                <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable__" onchange="CalculateRate(this.id)">
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </td>
    </tr>
</script>

<script id="iow-template"  type="text/template" class="hide">
    <?php
    $displayscreen="display:show";
    $displaymaintr="";
    if($gridtype==1)
    {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }  ?>
    <tr class="dont-hide">
        <td width="10%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___minno_0" id="iow___minno_0" readonly/>
            <input type="hidden" name="iow___dcregisterid_0" id="iow___dcregisterid_0"/>
            <input type="hidden" name="iow___dcgroupid_0" id="iow___dcgroupid_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
            <input type="hidden" name="iow___unitid_0" id="iow___unitid_0"/>
        </td>
        <td width="15%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input date_picker" type="text" name="iow___mindate_0" id="iow___mindate_0" readonly/>
                <span class="date_icon"><i class="fa fa-calendar"></i></span>
            </div>
        </td>

<!--        <td width="10%">-->
<!--            <input class="parent_text border-none" type="text" name="iow___siteminno_0" id="iow___siteminno_0" readonly/>-->
<!--        </td>-->
<!--        <td width="15%">-->
<!--            <div class="col-lg-12 padlr0">-->
<!--                <input class="parent_text border-none" type="text" name="iow___sitemindate_0" id="iow___sitemindate_0" readonly/>-->
<!--                <span class="date_icon"><i class="fa fa-calendar"></i></span>-->
<!--            </div>-->
<!--        </td>-->
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___minqty_0" id="iow___minqty_0" style="text-align:right;" readonly/></td>
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___acceptqty_0" id="iow___acceptqty_0" style="text-align:right;" readonly/></td>
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___prevbillqty_0" id="iow___prevbillqty_0" style="text-align:right;" readonly/></td>
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___balqty_0" id="iow___balqty_0" style="text-align:right;" readonly/></td>
<!--        <td width="20%">-->
<!--            <input class="parent_text --><?php //echo $displaymaintr; ?><!--" type="text" name="iow___qty_0" id="iow___qty_0" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"   onchange="calcPoQuantity(this);"/>-->
<!--            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0" value="0"/>-->
<!--        </td>-->
        <td width="5%" align="center" class="action_btns_td iow___requestfields">
            <ul class="action_btns">
                <li><a href="#" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
</script>

<script id="terms-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="33%">
            <input class="parent_text resourceSuggest" type="text" name="terms__" id="terms__" onfocus="checkTermsUsed(this);"/>
            <input type="hidden" name="termsid__" id="termsid__"  value=""/>
            <input type="hidden"  name="isvalue__" id="isvalue__" value=""/>
            <input type="hidden"  name="isaccount__" id="isaccount__" value=""/>
        </td>
        <td width="33%"><input class="parent_text border-none cal" type="text" name="value__" id="value__" style="text-align:right;" onkeypress="return isNumberKey(event,this)" onchange="valueTotal();"/></td>

        <td width="33%"><select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="account__" id="account__">

                <td width="15%" align="center" class="action_btns_td">
                    <ul class="action_btns">
                        <li> <a  id="termsdeleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                    </ul>
                </td>
    </tr>
</script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/paging.css';?>"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/paging.js"></script>
<script type="text/javascript">
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var tmp_arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;

var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_advance = <?php echo (isset($arr_advance)) ? json_encode($arr_advance) : '[]';?>;

var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;

var terms_ent = <?php echo (isset($terms_ent)) ? json_encode($terms_ent) : '[]';?>;
var Account = <?php echo (isset($Account)) ? json_encode($Account) : '[]';?>;
var qualList = <?php echo (isset($qualList)) ? json_encode($qualList) : '[]';?>;
var qual_Acc = <?php echo (isset($Qual_Acc)) ? json_encode($Qual_Acc) : '[]';?>;
var qualAccList = <?php echo (isset($qualAccList)) ? json_encode($qualAccList) : '[]';?>;
var qualiferHTML = '<?php echo (isset($qualHtml)) ? preg_replace('~>\s+<~', '><',$qualHtml) : '';?>';
var sampleQual = [];

$.each(qualAccList, function (k, j) {
    var sign = 0;
    if(j.Sign == '+'){
        sign = 1;
    } else{
        sign = 2;
    }
    var aId = j.AccountId;
    var qId = j.QualifierId;
    var arrKey = qId +'AA'+ sign ;
    sampleQual[arrKey] = aId;
});
 $(document).ready(function(){
        $(".flip0").click(function(){
            $(".pane0").slideToggle("slow");
        });
    });
    function myFunction(x) {
        x.classList.toggle("change");
    }
$(function () {
    $('#balTotal').show();
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var termstemplate = $('#terms-template').html();
    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.main');

    if(arr_requestResources.length != 0) {
        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $('#desc_' + rowid).val(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).val(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#bqty_' + rowid).val(sanitizeNumber(o.BillQty,3,true));
            $('#aqty_' + rowid).val(sanitizeNumber(o.ActualQty,3,true));
            $('#rate_' + rowid).val(sanitizeNumber(o.Rate,2,true));
            $('#qrate_' + rowid).val(sanitizeNumber(o.QRate,2,true));
            $('#baseamount_' + rowid).val(sanitizeNumber(o.Amount,2,true));
            $('#amount_' + rowid).val(sanitizeNumber(o.QAmount,2,true));
            $('#hiddenqty_' + rowid).val(o.HiddenQty);
            $('#total').val(o.BillAmount);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            $('#expandSt_' + rowid).show();

            var findRes = arr_resource_iows.filter(function(obj) {
                return (obj.ResourceId === o.ResourceId) && (obj.ItemId === o.ItemId && (obj.BalQty > 0 || obj.Qty > 0));
            });
            if(findRes.length > 0) {
                var minbaltot = 0;
                $.each(arr_resource_iows, function (j, l) {
                    if ((l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                        return;
                    }

                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate
                        .replace(/__/g, '_' + rowid)
                        .replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    $('#decisionTable_' + rowid).show();


                    $('#iow_' + rowid + '_dcregisterid_' + iowrowid).val(l.DCRegisterId);
                    $('#iow_' + rowid + '_dcgroupid_' + iowrowid).val(l.DCGroupId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_unitid_' + iowrowid).val(l.UnitId);
                    $('#iow_' + rowid + '_minno_' + iowrowid).val(l.MINNo);
                    $('#iow_' + rowid + '_mindate_' + iowrowid).val(l.MINDate);
//                    $('#iow_' + rowid + '_siteminno_' + iowrowid).val(l.SiteMINNo);
//                    $('#iow_' + rowid + '_sitemindate_' + iowrowid).val(l.SiteMINDate);
                    $('#iow_' + rowid + '_minqty_' + iowrowid).val(sanitizeNumber(l.MINQty,3,true));
                    $('#iow_' + rowid + '_acceptqty_' + iowrowid).val(sanitizeNumber(l.AcceptQty,3,true));
                    $('#iow_' + rowid + '_prevbillqty_' + iowrowid).val(sanitizeNumber(l.PrevBillQty,3,true));
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(l.BalQty,3,true));
                    //$('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                    $('#bmintotal_' + rowid).show();
                    $('#bminbaltotal_' + rowid).show();

                    $('#bminbaltotal_' + rowid).val(sanitizeNumber(parseFloatVal($('#bminbaltotal_' + rowid).val()) + parseFloatVal(l.BalQty),3,true))
                    $('#bminhiddentotal_' + rowid).val(sanitizeNumber(parseFloatVal($('#bminhiddentotal_' + rowid).val()) + parseFloatVal(l.HiddenQty),3,true))
                    if (<?php echo (isset($pvId)) ? $pvId : 0;?> >0){

                        var RId = o.ResourceId;
                        var ItId = o.ItemId;
                        var pvId =<?php echo (isset($pvId)) ? $pvId : 0;?>;
                        $.ajax({
                            url: getBaseURL() + 'mms/minconversion/conversionentry',
                            type: "post",
                            data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&pvId=" + pvId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });
                    } else {
                       //$('#qualifierTabLink_' + rowid).show();
                        var resId = o.ResourceId;
                        var itemId = o.ItemId;
                        var dcgrpId  = $('#dcgId').val();
                        $.ajax({
                            url: getBaseURL() + 'mms/minconversion/conversionentry',
                            type: "post",
                            data: "resourceId=" + resId + "&Type=getAddqualdetails& itemId=" + itemId + "&dcgrpId=" + dcgrpId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });

                        //$('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
                    }
                    CalculateRate('#qualifierTable_' + rowid);
                });
            }
            calcTotal();
            rateChange('#rate_' + rowid);
            TermsAutoRefresh();
        });
    }
    rowid += 1;
    $tbody.append(template.replace(/__/g, '_' + rowid));
    $rowid.val(rowid);
    bindDescAutocomplete();


    var $arowid = $('#Arowid');
    var atemplate = $('#Advance-template').html();
    var arowid = 0;
    var $tbody = $('#AdvanceTable').find('> tbody.main');
    var advtot=0;

    if(arr_advance.length > 0){
        $.each(arr_advance, function (j, p) {
            arowid += 1;
            $tbody.append(atemplate.replace(/__/g, '_' + arowid));
            $('#pono_' + arowid).val(p.PONo);
            $('#poregisterid_' + arowid).val(p.PORegisterId);
            $('#advtermsid_' + arowid).val(p.TermsId);
            $('#podate_' + arowid).val(p.PODate);
            $('#title_' + arowid).val(p.Title);
            $('#aamount_' + arowid).val(sanitizeNumber(p.Amount,2,true));
            $('#paidamount_' + arowid).val(sanitizeNumber(p.PaidAmount,2,true));
            $('#currentamount_' + arowid).val(sanitizeNumber(p.CurrentAmount,2,true));
            $('#balance_' + arowid).val(sanitizeNumber(p.Balance,2,true));
            $('#deductbal_' + arowid).val(sanitizeNumber(p.DeductionBalance,2,true));
            $('#hiddenamt_' + arowid).val(p.HiddenAmount);
            $arowid.val(arr_advance.length);
            advtot=parseFloatVal(advtot)+parseFloatVal($('#currentamount_' + arowid).val());
        });
    }
    $('#advtotal').val(advtot);

    //terms &condition end
    var $trowid = $('#trowid');
    var template = $('#terms-template').html();
    var trowid = 0;
    var $tbody = $('#termsTable').find('> tbody');
    if(terms_ent.length > 0){
        $.each(terms_ent, function (j, p) {
            trowid += 1;
            $tbody.append(template.replace(/__/g, '_' + trowid));
            var opt = '<option></option>';
            if (Account.length > 0) {
                $.each(Account, function (m, n) {
                    opt += '<option value="' + n.AccountId + '">' + n.AccountName + '</option>';
                });
            }
            $('#account_' + trowid).html(opt);

            $('#terms_' + trowid).val(p.Terms);
            $('#value_' + trowid).val(sanitizeNumber(p.Value,2,true));
            $('#termsid_' + trowid).val(p.TermsId);
            $trowid.val(terms_ent.length);
            $('#account_' + trowid).val(p.AccountId);
        });
    }


    $('.content_wrapper').on('click','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").prevAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").prevAll(".subTr").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").slideUp("slow");

            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            if($(this).closest("tr").next(".subTr").find(".subDiv").is(":visible") == false) {
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else {
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        }
    });

    nextAccordian(1);
    valueTotal();
    if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
        $('#workorderTable').paging({limit: 2});
        $('.paging-nav').children('a[data-page=0]').trigger('click');
        $('#seqTotal').show();
    }
});
function nextAccordian(id,s) {
    if(id==2 && s==1){
        $(".collapseTwo").attr('id','collapseTwo');
    } else if(id==3 && s==2){
        $(".collapseThree").attr('id','collapseThree');
    }
    $('#panelheading-' + id).trigger('click');
}
function calcPoQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];

    // calc total qty
    var totalQty = 0;
    var poQty = 0;
    var billqty = 0;
    var hideqty = 0;
    var curQty = 0;
    var $q1   = $('#iow_' + rowid + '_qty_' + iowrowid);
    var $blqty =  $('#iow_' + rowid + '_balqty_' + iowrowid);
    var $hqty = $('#iow_' + rowid + '_hiddenqty_' + iowrowid);

    poQty =parseFloat($q1.val());
    billqty =parseFloat($blqty.val());
    hideqty =parseFloat($hqty.val());
    curQty = billqty+hideqty ;
    if (!isNaN(curQty) && curQty < poQty ){
        alert('entered the high value from BalQTY!!!please check this!!!');
        $('#iow_' + rowid + '_qty_' + iowrowid).val(0).trigger('change');
    }
    else {
        $.each($('input[id^=iow_' + rowid + '_qty_'), function (i, o) {
            var qty = parseFloatVal($(this).val());
            if (isNaN(qty))
                qty = 0;
            totalQty += qty;
        });
        totalQty = sanitizeNumber(totalQty,3,true);

        $('#bqty_' + rowid).val(parseFloatVal(totalQty, 0));
        $('#aqty_' + rowid).val(parseFloatVal(totalQty, 0));

        // calc total amount
        var rate = parseFloatVal($('#rate_' + rowid).val(),0);
        var qrate = parseFloatVal($('#rate_' + rowid).val(),0);

        $('#amount_' + rowid).val(sanitizeNumber(parseFloatVal(totalQty * qrate,0),2,true));
        $('#baseamount_' + rowid).val(sanitizeNumber(parseFloatVal(totalQty * rate,0),2,true));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
        TermsAutoRefresh();
    }

}
function calcTotal() {
    var total = 0;
    var btotal = 0;
    var gtype = $('#gridtype').val();

    $.each($('input[id^=amount_]'), function (i,o) {
        total += parseFloatVal($(this).val());
    });

    $.each($('input[id^=baseamount_]'), function (i,o) {
        btotal += parseFloatVal($(this).val());
    });
    var tsum = 0;
    $('input[id^=value_]').each(function (i, o) {
        tsum += parseFloatVal($(this).val());
    });

    if(gtype == 0){
        $('#basetotal1').val(sanitizeNumber(btotal,2,true));
        $('#total1').val(sanitizeNumber(total,2,true)).data('tot',total);
        $('#nettotal1').val(sanitizeNumber(tsum + total,2,true));
    } else {
        $('#basetotal').val(sanitizeNumber(btotal,2,true));
        $('#total').val(sanitizeNumber(total,2,true)).data('tot',total);
        $('#nettotal').val(sanitizeNumber(tsum + total,2,true));
    }

    var tCount =  $('#termsTable tbody tr').length;

    if(tCount > 1){
        $('#valuefrom').attr("disabled", true);
    }
    else
    {
        $('#valuefrom').attr("disabled", false);
    }
}

function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];

    if (type=="decision") {
        $('#decisionTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();

    } else if (type=="qualifier") {
        $('#qualifierTable_'+rowid).show();
        $('#decisionTable_'+rowid).hide();
    }
    return false;
}
function rateChange(x)
{
    var iFocusRowId= x.split("_")[1];
    var bRate=parseFloatVal($('#rate_' + iFocusRowId).val());
    var bQty=parseFloatVal($('#bqty_' + iFocusRowId).val());
    $('#qrate_' + iFocusRowId).val(parseFloatVal(bRate));

    $('#baseamount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    var vname = '#qualifierTable_' + iFocusRowId;
    CalculateRate(vname);
}
function bQtyChange(x){
    var iFocusRowId= $(x).attr('id').split("_")[1];
    var bRate=parseFloatVal($('#rate_' + iFocusRowId).val());
    var bQty=parseFloat($(x).val());
    var aQty=parseFloat($('#aqty_' + iFocusRowId).val());

    var minbaltot = parseFloatVal($('#bminbaltotal_' + iFocusRowId).val())
    var  minhiddentot = parseFloatVal($('#bminhiddentotal_' + iFocusRowId).val())
   if(bQty > (minbaltot+minhiddentot)) {
       alert("Bill quantity is greater than Actual quantity");
       $('#bqty_' + iFocusRowId).val(sanitizeNumber(minbaltot+minhiddentot,3,true));
       $('#aqty_' + iFocusRowId).val(sanitizeNumber(minbaltot+minhiddentot,3,true));
   }

//    if(aQty>bQty){
//        alert("check your billqty");
//        $('#bqty_' + iFocusRowId).val(0);
//        return false;
//    }
    bQty = sanitizeNumber(parseFloatVal($('#bqty_' + iFocusRowId).val()),3,true);
    $('#aqty_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty),3,true));
    $('#qrate_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bRate),2,true));
    $('#baseamount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    var vname = '#qualifierTable_' + iFocusRowId;
    CalculateRate(vname);
}

function CalculateRate(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#desc_' + iFocusRowId,
        iRows = $('#rowid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sQualName = "Qual";
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {

        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";

    }
    var qty=$('#bqty_'+iFocusRowId).val();
    var dbaseAmt=$('#baseamount_'+iFocusRowId).val();
    var dQAmt =  CalculateQualifier(dbaseAmt,iFocusRowId,sQualName);
    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt),2,true));
    $('#qrate_' + iFocusRowId).val(sanitizeNumber((parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt))/parseFloatVal(qty)),2,true);
    calcTotal();
    TermsAutoRefresh();
}
var abc;
var aSign=0;
function CalculateQualifier(baseValue, key1,sQualName) {
    var sQName = sQualName + '_';
    var rows = $('#' + sQualName +  'RowId_' + key1).val();
    var sformula="";
    var dbaseAmt=parseFloatVal(isNullCheck(baseValue,'number'));
    var dTotalQualAmt=0;

    for (i = 1; i <= rows; i++) {
        var sRef = $('#' + sQName + key1 + '_Ref_' + i).val().trim();
        var sFormula = isNullCheck($('#' + sQName + key1 + '_Exp_'+ i).val(),'string');
        var dPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_ExpPer_'+ i).val(),'number'));
        var sbaseRef = 'R0';
        if (parseFloatVal(dPer) ==0) dPer=100;
        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
        for (j = 1; j <= rows; j++) {
            var sFRef = $('#' + sQName + key1 + '_Ref_' + j).val().trim();
            var dFamt = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_Amount_'+ j).val(),'number'));
            sFormula = sFormula.replace(new RegExp(sFRef, 'g'), dFamt);
        }
        var fvaule = computeEval(sFormula);
        $('#' + sQName + key1 + '_ExpValue_' + i).val(numberFormat(fvaule,'C'));

        var iQualTypeid = $('#' + sQName + key1 + '_TypeId_' + i).val();

        if (iQualTypeid==1 || iQualTypeid==2) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(),'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(),'number'));
            var dCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_CessPer_' + i).val(),'number'));
            var dEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_EduCessPer_' + i).val(),'number'));
            var dHEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_HEduCessPer_' + i).val(),'number'));
            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(numberFormat(dNetPer,'C'));
            $('#' + sQName + key1 + '_ExpPer_'+ i).val(numberFormat(dNetPer,'C'));

            var dTaxableAmt =  fvaule* (dTaxablePer/100);
            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
            var dCessAmt =  dTaxAmt* (dCess/100);
            var dEDAmt =  dTaxAmt* (dEDCess/100);
            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;

            $('#' + sQName + key1 + '_TaxableAmt_'+ i).val(numberFormat(dTaxableAmt,'C'));
            $('#' + sQName + key1 + '_TaxPerAmt_'+ i).val(numberFormat(dTaxAmt,'C'));
            $('#' + sQName + key1 + '_CessAmt_'+ i).val(numberFormat(dCessAmt,'C'));
            $('#' + sQName + key1 + '_EduCessAmt_'+ i).val(numberFormat(dEDAmt,'C'));
            $('#' + sQName + key1 + '_HEduCessAmt_'+ i).val(numberFormat(dHEDAmt,'C'));
            $('#' + sQName + key1 + '_NetAmt_'+ i).val(numberFormat(dNetAmt,'C'));

            dAmt = dNetAmt;
        } else {

            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
        }

        $('#' + sQName + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
        if ($('#' + sQName + key1 + '_YesNo_' + i).is(':checked') == true) {
            sSign = isNullCheck($('#' + sQName + key1 + '_Sign_' + i).val(),'string');
            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);

        }
    }

    $('#'+ sQualName + 'TotalAmt_' + key1).val(numberFormat(dTotalQualAmt,'C'));
    return dTotalQualAmt;
}


function calQualList() {
    var qual1 =0;
    $('#qualClick').attr("disabled", false);
    $('#QualifierAccTable').html('');
    var totalQualRows = $('#rowid').val()-1;
    var Qtemplate = $('#Qual-template').html();
    var qualCheck=0;
    for (var i = 1; i <= totalQualRows; i++) {
        $.each(qualList,function(m,o) {
            var qualRowCount = m+1;

            if ($('#Qual_'+i+'_YesNo_'+qualRowCount).is(':checked') == true) {

                var vatAmt = parseFloatVal($('#Qual_'+i+'_Amount_'+qualRowCount).val());
                var QualName = $('#Qual_'+i+'_Desc_'+qualRowCount).val();
                var qId = $('#Qual_'+i+'_Id_'+qualRowCount).val();
                var percent = $('#Qual_'+i+'_ExpPer_'+qualRowCount).val();
                var dot = sanitizeNumber(percent,2,true).replace('.','_');
                var sSign = isNullCheck($('#Qual_'+i+'_Sign_'+qualRowCount).val(), 'string');
                if (sSign == '+') {
                    aSign = 1;
                } else {
                    aSign = 2;
                }
                var commonVar = 'QualifierExist_'+ qId +'_qu_' + aSign + '_per_'+ dot;
                abc = $('#QualifierExist_'+ qId +'_qu_' + aSign +'_per_'+ dot);
                if (abc.length) {
                    var prevAmt= parseFloatVal($('#qualamount_' + commonVar).val());
                    var newAmt=parseFloatVal(prevAmt)+parseFloatVal(vatAmt);
                    $('#qualamount_' + commonVar).val(sanitizeNumber(newAmt,3,true));
                }
                else {
                    $('#QualifierAccTable').append(Qtemplate
                            .replace(/__8/g, '_' + commonVar)
                            .replace(/__7/g, '_' + qualCheck)
                            .replace(/__9/g, '_' + dot)
                            .replace(/__0/g, '_' + aSign)
                            .replace(/__/g, '_' + qId)
                    );
                    $(".single_dropdown1").select2({});
                    abc.val('QualifierExist_' + qId + '_qu_' + aSign);
                    $('#qualifiername_' + commonVar).val(QualName);
                    $('#QualifierId_' + commonVar).val(qId);
                    $('#percentage_' + commonVar).val(sanitizeNumber(percent, 2, true));
                    $('#sign_' + commonVar).val(sSign);
                    $('#qualamount_' + commonVar).val(sanitizeNumber(vatAmt, 3, true));
                    var arrkey = qId + 'AA' + aSign;
                    var opt = '<option value=""></option>';
                    if (qual_Acc.length > 0) {
                        $.each(qual_Acc, function (j, p) {
                            if(sampleQual[arrkey]== p.AccountId) {
                                opt += '<option selected value="' + p.AccountId + '">' + p.AccountName + '</option>';
                            } else {
                                opt += '<option value="' + p.AccountId + '">' + p.AccountName + '</option>';
                            }
                        });
                    }
                    $('#accountname_' + commonVar).html(opt).trigger('change');
                    qualCheck++;
                    $('#Qrowid').val(qualCheck);
                }
            }
        });
    }
    $('.qualamount').each(function (i, o) {
        var curId = $(this).attr('id');
        var signId = curId.replace('qualamount','sign');
        var aSignVal = $('#'+signId).val();
        if(aSignVal == '-'){
            qual1 -= parseFloat($(this).val());
        }
        else{
            qual1 += parseFloat($(this).val());
        }
    });
    $('#qutotal').val(sanitizeNumber(qual1, 2));
    clickQualifier();
}

function CalculateTax(id) {
    var sname = id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#rateanal_' + key1;
    if (sname == "QualR")  name = '#rateanalR_' + key1;

    CalculateRate(name);
}
function bindTaxCalculation() {
    var $mainTr = $(".qualChange");
    $mainTr.change(function (e) {
        CalculateTax($(this)[0].id);
    });
}
function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateTax($this[0].id);
}

function TermsAutoRefresh() {
    var netAmt = 0;
    var ggtype =$('#gridtype').val();
    if(ggtype == 0){
        netAmt= parseFloat(isNullCheck($('#total1').val(), 'number'));
    } else {
        netAmt= parseFloat(isNullCheck($('#total').val(), 'number'));
    }

    var iKey = 0;
    var dFAmt = 0.0;
    var sTerms = '';
    $.each($('input[id^=terms_]'), function (i, o) {
        iKey = iKey + 1;
        sTerms = $(this).val();

        if (sTerms == 'Advance' || sTerms == 'Against Delivery' || sTerms == "Against Work" || sTerms == "Against Bill" || sTerms == "Against Certification") {
            dCurPer = parseFloat(isNullCheck($('#per_' + iKey).val(), 'number'));
            if (parseFloat(isNullCheck(netAmt, 'number')) > 0 && parseFloat(isNullCheck(dCurPer, 'number')) > 0) {
                dFAmt = (parseFloat(isNullCheck(dCurPer, 'number')) / 100) * parseFloat(isNullCheck(netAmt, 'number'));
            }
            $('#value_' + iKey).val(dFAmt);
        }
    });
    var tCount =  $('#termsTable tbody tr').length;

    if(tCount > 1){
        $('#valuefrom').attr("disabled", true);
    }
    else
    {
        $('#valuefrom').attr("disabled", false);
    }

}
function bindDescAutocomplete() {
    // bind resource autocomplete
    $('#workorderTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_resources,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if ($.trim(queryLowerCase) == '*') {

                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {
            if (suggestion) {

                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                $this.prop('readonly', true).addClass('border-none');
                $('#descid_' + rowid).val(suggestion.data);
                $('#resourceid_' + rowid).val(suggestion.data);
                $('#unitid_' + rowid).val(suggestion.UnitId);
                $('#itemid_' + rowid).val(suggestion.ItemId);
                $('#unitname_' + rowid).val(suggestion.UnitName);
                $('#rate_' + rowid).val(sanitizeNumber(suggestion.Rate,2,true));
                $('#qrate_' + rowid).val(sanitizeNumber(suggestion.QRate,2,true));
                $('#deleteTr_' + rowid).show();
                $('#expandRt_' + rowid).show();
                $('#expandTr_' + rowid).show();
                $('#expandSt_' + rowid).show();
                bindResourceIOW($this);
                addNewResourceRow($this);
            }
        }, onSearchStart: function (suggestion) {
            var rowid = $(this)[0].id.split('_')[1];
            $('#unitname_' + rowid).val('');
            $('#rate_' + rowid).val('');
        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                var rowid = $(this)[0].id.split('_')[1];
                $('#unitname_' + rowid).val('');
                $('#rate_' + rowid).val('');
            }
        }
    });
}
function bindResourceIOW(x){
    var rowid = $(x)[0].id.split('_')[1];
    var descId = $('#descid_' + rowid).val();
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCentreId = $('#costcentreId').val();
    var VendorId = $('#vendorId').val();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();

    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/minconversion/conversionentry',
        type: "post",
        data: "CostCentreId=" + CostCentreId +"&resourceid=" + resourceid +"&itemid=" + itemid + "&VendorId=" + VendorId + "&Type=selectPo",
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);

                if ((data.arr_resource_iows).length != 0) {
                    $.each(data.arr_resource_iows, function (i, l) {

                        var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                        $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                        $('#iow_'+rowid+'_rowid').val(iowrowid);
                        $('#decisionTabLink_' + rowid).show();
                        $('#decisionTable_' + rowid).show();
                        $('#iow_' + rowid + '_dcregisterid_' + iowrowid).val(l.DCRegisterId);
                        $('#iow_' + rowid + '_dcgroupid_' + iowrowid).val(l.DCGroupId);
                        $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                        $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                        $('#iow_' + rowid + '_minno_' + iowrowid).val(l.MINNo);
                        $('#iow_' + rowid + '_mindate_' + iowrowid).val(l.MINDate);
//                        $('#iow_' + rowid + '_siteminno_' + iowrowid).val(l.SiteMINNo);
//                        $('#iow_' + rowid + '_sitemindate_' + iowrowid).val(l.SiteMINDate);
                        $('#iow_' + rowid + '_minqty_' + iowrowid).val(sanitizeNumber(l.MINQty,3,true));
                        $('#iow_' + rowid + '_acceptqty_' + iowrowid).val(sanitizeNumber(l.AcceptQty,3,true));
                        $('#iow_' + rowid + '_prevbillqty_' + iowrowid).val(sanitizeNumber(l.PrevBillQty,3,true));
                        $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(l.BalQty,3,true));
                        //$('#iow_' + rowid + '_qty_' + iowrowid).val();
                        $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val();

                        var resId = resourceid;
                        var itemId = itemid;
                        var dcgrpId  = l.DCGroupId;

                        $.ajax({
                            url: getBaseURL() + 'mms/minconversion/conversionentry',
                            type: "post",
                            data: "resourceId=" + resId + "&Type=getAddqualdetails& itemId=" + itemId + "&dcgrpId=" + dcgrpId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });

                        //$('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));

                        $('#bmintotal_' + rowid).show();
                        $('#bminbaltotal_' + rowid).show();

                        $('#bminbaltotal_' + rowid).val(sanitizeNumber(parseFloatVal($('#bminbaltotal_' + rowid).val()) + parseFloatVal(l.BalQty),3,true))
                        $('#bminhiddentotal_' + rowid).val(sanitizeNumber(parseFloatVal($('#bminhiddentotal_' + rowid).val()) + parseFloatVal(l.HiddenQty),3,true))

                    });

                }
                $('.loading_area').hide();}
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }

    });
}
function addNewResourceRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val()),
        $tbody = $('#workorderTable').find('> tbody.main');

    $('#deleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#resource-template').html();

    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);

    $rowid.val(count);
    bindDescAutocomplete();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        $('.paging-nav').remove();
        thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
}


function checkResourceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=resourceid_]');
    tmp_arr_resources = arr_resources;
    tmp_arr_resources = $.grep(arr_resources, function (element, index) {

        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindDescAutocomplete();
}

function deleteRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    $tr.next('.subTr').remove();
    $tr.remove();
//    var rId = $('#rowid').val();
//    rId--;
//    $('#rowid').val(rId);
    calcTotal();
    TermsAutoRefresh();
    bindDescAutocomplete();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        $('.paging-nav').remove();
        thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
    return false;
}
function validateForm() {
    if ($('#purchase_type').val() == '') {
        alert('Please select Purchase Type');
        return false;
    }

    if ($('#account_type').val() == 0 || '' ) {
        alert('Please select Account Type');
        return false;
    }
    if ($('#currency').val() == '' || 0) {
        alert('Please select currency Type');
        return false;
    }

    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 4){
        alert('Add Resource');
        return false;
    }
    var drow = parseInt($('#rowid').val() - 1);
    for (var d = 1; d <= drow; d++) {
        var q1 = $.trim($('#bqty_' + d).val());
        var desc1 = $('#desc_' + d).val();
        if(String($('#desc_' + d).val()) != 'undefined') {
            if ((q1 == 0 || q1 == '') && desc1 != '') {
                alert('Kindly enter the Quantity or delete the unwanted resource');
                if ($('#panelheading-1').attr('aria-expanded') == 'true') {
                    $('.paging-nav').children('a[data-page=' + ((d) - 1) + ']').trigger('click');
                    $('#qty_' + d).focus();
                    return false;
                } else {
                    $('#accordion').children().find('#panelheading-1').trigger('click');
                    $('.paging-nav').children('a[data-page=' + ((d) - 1) + ']').trigger('click');
                    $('#qty_' + d).focus();
                    return false;
                }
                return false;
            }
        }
    }

    var trow = $('#trowid').val();
    for (var r = 1; r <= trow; r++) {
        if ($('#account_' + r).val() == 0 && parseInt($('#value_' + r).val()) > 0) {
            nextAccordian(4);
            showError($('#account_' + r), "Select the Account Name");
            return false;
        } else {
            removeError($('#account_' + r));
        }
    }

    $('#formWrapper').submit();
    $('#valuefrom').attr("disabled", false);

}
function submitForm() {
    var checkSubmit = 0;
    $('select[name*=accountname_]').each(function (i, o) {
        var id = $(this).attr('name').split('_')[1];
        var accName = $.trim($(this).val());
        var qualAmt = parseFloat($('input[name=qualamount_'+id+']').val());
        if(accName == '' && qualAmt > 0) {
            checkSubmit = 1;
        }
    });
    if(checkSubmit == '1'){
        alert('Kindly Select your Qualifier AccountName');
        return false;
    }
    else{
        nextAccordian(4);
    }
}
function checkAdvance(){
    var arow = parseInt($('#Arowid').val());
    if(arow > 0){
        var flagcheck = 0;
        for (var a = 1; a <= arow; a++) {
            var balance = parseFloat($('#balance_' + a).val());
            if (balance > 0) {
                flagcheck = 1;
            }
        }
        if(flagcheck == 1){
            nextAccordian(2,1);
        }
    } else {
        alert("No Advance Adjustment");
        calQualList();
        nextAccordian(3,2);
    }
}
function clickQualifier(){
    var qrow = parseInt($('#Qrowid').val());
    console.log(qrow);
    if(qrow == 0 || qrow == ''){
        alert("No Qualifier Avaliable");
        nextAccordian(4);
    } else {
        nextAccordian(3,2);
    }
}
function checkTermsAcc(){
    var checkFlag = 0;
    var trow = $('#trowid').val();
    for (var r = 1; r <= trow; r++) {
        if ($('#account_' + r).val() == 0 && parseInt($('#value_' + r).val()) > 0) {
            showError($('#account_' + r), "Select the Account Name");
            checkFlag = 1;
            return false;
        } else {
            removeError($('#account_' + r));
            checkFlag = 0;
        }
    }
    if(checkFlag == 0){
        nextAccordian(5);
    }
}

//ajax for populate accounttype
//$('#purchase_type').change(function() {
//    $("#account_type").select2('val', '');
//    var ptypeId = $(this).val();
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/minconversion/conversionentry',
//        data: "ptypeId="+ptypeId+"&Type=selectAccount",
//        dataType: "json",
//        success: function(data){
//            $("#account_type").html('');
//            $("#account_type").append("<option value='0'>Select Account Type</option>");
//            $.each(data['resultAcc'], function(i,v){
//                $("#account_type").append("<option value='"+v.data+"'>"+v.value+"</option>");
//            });
//            $("#account_type").selectpicker('refresh');
//        }
//
//    });
//});
function selAccount(){
    var ptypeId = $('#purchase_type').val();
    if(ptypeId == ''){
        return false;
    } else {
        $("#account_type").html('');
        $("#account_type").append("<option value=''>Select Account Type</option>");
        $.ajax({
            type: "POST",
            url: getBaseURL()+'mms/minconversion/conversion-entry',
            data: "ptypeId="+ptypeId+"&Type=selectAccount",
            dataType: "json",
            success: function(data){
                $.each(data['resultAcc'], function(i,v){
                    $("#account_type").append("<option value='"+v.data+"' selected>"+v.value+"</option>");
                });
                $("#account_type").trigger("change");
                //  $("#account_type").select2('refresh');
            }

        });
    }
}
$( document ).ready(function() {
    var pId=<?php echo (isset($pvId)) ? $pvId:0; ?>;
    if(pId==0) {
        selAccount();
    }
});
// terms and condition
function  valueTotal(){
    var g2type = $('#gridtype').val();
    if( g2type == 0 ){
        var totals = parseFloat($("input#total1").data('tot'));

        $('input[id^=value_]').each(function (i, o) {
            totals += parseFloat($(this).val());
        });
        $("input#nettotal1").val(totals.toFixed(2));
    } else {
        var totalss = parseFloat($("input#total").data('tot'));
        $('input[id^=value_]').each(function (i, o) {
            totalss += parseFloat($(this).val());
        });
        $("input#nettotal").val(totalss.toFixed(2));
    }
}

function advamount(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var agType = $('#gridtype').val();
    var overtot = 0;
    calcTotal();
    if(agType == 0){
        overtot = parseFloatVal($('#total1').val());
    } else {
        overtot = parseFloatVal($('#total').val());
    }
    var cur = $('#Arowid').val();
    var aTotal =0;

    var advtot = 0;
    if (overtot > 0) {
        for (var j = 1; j <= cur; j++) {
            var advtot = parseFloatVal($('#currentamount_' + j).val());
            var baltot = parseFloatVal($('#balance_' + j).val());
            if(!isNaN(advtot) && baltot < advtot ){
                alert('current amount is exceed from BalanceAmount');
                $('#currentamount_'+rowid).val(0).trigger('change');
                return false;
            }else
            {
                aTotal += advtot;
                $('#advtotal').val(sanitizeNumber(parseFloatVal(aTotal, 0),2,true));

                if (!isNaN(advtot) && advtot > overtot) {
                    alert('current amount is exceed from Total');
                    $('#currentamount_'+rowid).val(0).trigger('change');
                    return false;
                }
            }
        }
    }
}
$('textarea').focus(function(){
    $(this).removeAttr('placeholder');
});

function isqtyDecimal(evt, x) {
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (evt.key =="%") charCode=0;
    if (evt.key =="#") charCode=0;
    if (
        (charCode != 46 || $(element).val().indexOf('.') != -1) &&      // . CHECK DOT, AND ONLY ONE.
        (charCode < 48 || charCode > 57) && charCode!=39 && charCode!=37 && charCode!=8 && charCode!=35 && charCode!=9)
        return false;

    var rowid = $(x)[0].id.split('_')[1];

    var iowrowid=0;
    var reqDec = parseInt($('#iow_'+ rowid +'_rowid').val());

    if(reqDec > 0){
        //$('#bqty_' + rowid).attr('readonly',true);

    }
    else{
        //$('#bqty_' + rowid).attr('readonly',false);
    }

    return true;
}
$( document ).ready(function() {
    if('<?php echo (isset($Approve)) ? $Approve : '';?>' == 'Y')
    {
        $('#sub1').hide();
    }
    else if('<?php echo (isset($Approve)) ? $Approve : '';?>' == 'P')
    {
        $('#sub1').hide();
    }
    else{
        $('#sub1').show();
    }

});
function getAccountData(x){
    if($(x).val() != ''){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid = ids[2];
        var iowrowid = ids[4];
        var qper = ids[6];
        var fa=ids[7];

        var accId = $('#accountname_' + 'QualifierExist_' + rowid + '_qu_' + iowrowid + '_per_' + qper + '_' + fa).val();
        var arrkey = rowid + 'AA' + iowrowid;
        sampleQual[arrkey]=accId;
    }
}
</script>
