<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css';?>"/>

<style>
    .sub_tbl1 {color:#424141;font-weight: 600; background:#edefe2 !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{color: #424141;font-weight: 600; background: #efe2e2 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl1{color: #424141;font-weight: 600; background: #ceefe5 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .pan_box{height:133px !important;}
    .lbl_move{height:40px!important;}
    .subDiv {border: 0px !important;margin-top: 9px !important;}
    .exp-tex{margin-bottom:-5px !important;}
    .mar_10{margin-bottom:10px;}
    .date_icon{top:10px!important;right:22px !important;}
    .lbl_ptb {padding-top: 5px!important;padding-bottom: 5px!important;}
    #sequentialView tr th{ width:auto !important;}
    .selected-xs{width:55%!important;border:0px solid #babdb8!important;}
    .selected-xs select{height:22px;color: #266aa8;font-size:13px !important;cursor:pointer;}
    .select-style {float: left;width: 100%;padding: 0;margin: 0;border: 1px solid #c2c2c2;overflow: hidden;background-color: #fff;border-radius: 0px;}
    .bar1, .bar2, .bar3 {width: 18px;height: 3px;background-color: #009688;margin: 3px 0;transition: 0.4s;}
    .change .bar1 {-webkit-transform: rotate(-45deg) translate(-6px, 5px);transform: rotate(-45deg) translate(-6px,5px);}
    .change .bar2 {opacity: 0;}
    .change .bar3 {-webkit-transform: rotate(45deg) translate(-3px, -3px);transform: rotate(45deg) translate(-3px, -3px);}
    .flip0{float:right;margin-top:5px;cursor:pointer;}
    .margn_5{margin-bottom:5px;}
    .tx_lbl{font-size : 14px; padding-bottom: 5px;}
	.top-10{margin-top:10px;}
	.mgic {margin-left: 3px !important;}
	.card {margin-top: 0% !important;}
	.floor_name_area {width: 100%;background: rgb(255, 240, 232);clear: both;margin: auto;margin-top: 10px;border-left: 3px solid #a8503c;border-bottom: 3px solid #a8503c;}

	.tooltip-inner {
		min-width: 100px;
		max-width: 100%; 
	}
	.tooltip-inner {
		min-width: initial;
		max-width: 320px;
	}


/*------x-button--------*/
.mobile-menu-btn {
  position: relative;
  width: 18px;
  height: 14px;
  cursor: pointer;
  top:5px;
}
.mobile-menu-btn span {
  display: inline-block;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 2px;
  background-color: black;
  opacity: 1;
  transition: opacity .5s ease;
}
.mobile-menu-btn:before, .mobile-menu-btn:after {
  content: '';
  display: inline-block;
  width: 18px;
  height: 2px;
  background-color: black;
  position: absolute;
}
.mobile-menu-btn:before {
  top: 0;
  transform: rotate(0deg);
  transition: transform .25s ease, top .25s ease .25s;
}
.mobile-menu-btn:after {
  bottom: 0;
  transform: rotate(0deg);
  transition: transform .25s ease, bottom .25s ease .25s;
}
.mobile-menu-btn.open span {
  opacity: 0;
  transition: opacity .5s ease;
}
.mobile-menu-btn.open:before {
  top: 6px;
  transform: rotate(45deg);
  transition: transform .25s ease .25s, top .25s ease;
}
.mobile-menu-btn.open:after {
  bottom: 6px;
  transform: rotate(-45deg);
  transition: transform .25s ease .25s, bottom .25s ease;
}
</style>
<?php
function calculateCurrency($fromCurrency, $toCurrency, $amount) {
     $amount = urlencode($amount);
     $fromCurrency = urlencode($fromCurrency);
    $toCurrency = urlencode($toCurrency);
    $rawdata = file_get_contents("https://www.google.com/finance/converter?a=$amount&from=$fromCurrency&to=$toCurrency");
    $data = explode('bld>', $rawdata);
    $data = explode($toCurrency, $data[1]);
    return round($data[0], 2);
}
?>



<!--STYLE-->
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/mms/purchase/ordersave">
<input type="hidden" id="CostCenterId" name="CostCenterId" value="<?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>">
<input type="hidden" name="PORegId" value="<?php echo (isset($poRegId)) ? $poRegId : 0;?>">
<input type="hidden" name="VendorId" id="VendorId">
<input type="hidden" name="OrderType" id="OrderType" value="<?php echo (isset($OrderType)) ? $OrderType : '';?>">
<input type="hidden" name="gridtype" id="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : '';?>">
<input type="hidden" name="dCurrencyId" id="dCurrencyId" value="<?php echo (isset($dCurrencyId)) ? $dCurrencyId : 0;?>">
<input type="hidden" name="dCurrName" id="dCurrName" value="<?php echo (isset($dCurrName)) ? $dCurrName : '';?>">
<input type="hidden" name="fCurrName" id="fCurrName" value="<?php echo (isset($fCurrName)) ? $fCurrName : '';?>">
<input type="hidden" name="flag" id="flag" value="<?php echo (isset($flag)) ? $flag : '';?>">

<div class="col-lg-12">
    <h1 class="col-lg-3">Purchase Order
        <div class="flip0">
            <div class="click" onclick="myFunction(this)">
                <div class="mobile-menu-btn">
					<span></span>
				</div>
				<!--<div class="bar1"></div>
                <div class="bar2"></div>
                <div class="bar3"></div>-->
            </div>
        </div>
    </h1>
</div>
<div class="col-lg-12">
    <div class="pane0">
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>
                    <li class="lbl_ptb" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">
                        <label>Cost Centre</label>
                        <span class="mgic hel" data-toggle="tooltip" class="poa-head" data-html="true" data-original-title='<?php echo (isset($costcenter)) ? $costcenter['CostCentreName'] : '';?>' data-placement="top"><?php echo (isset($costcenter)) ? $costcenter['CostCentreName'] : '';?></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Vendor</label>
						<span>
							<div class="select-style selected-xs margn_5">
								<select name="vendor" id="vendor"  label="Vendor" placeholder="vendor">
                                    <option value="0">Select Vendor</option>
									<?php foreach($arr_vendors as $ven):?>
										<option value="<?php echo $ven['VendorId']; ?>"  <?php echo ( (isset($vendor) && $ven['VendorId'] == $vendor['VendorId']) ) ? 'selected' : ''; ?>><?php echo $ven['VendorName'];  ?></option>
									<?php endforeach; ?>
								</select>
							</div>
							<script>
								$(document).ready(function() {
//									if('<?php //echo (isset($poRegId)) ? $poRegId : 0;?>//' > 0) {
//										document.getElementById("vendor").disabled = true;
//									} else {
//										document.getElementById("vendor").disabled = true;
//									}
                                    document.getElementById("vendor").disabled = true;

									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});

								});
							</script>
						</span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Purchase Type</label>
						<span>
							<div class="select-style selected-xs margn_5 poa-ps">
								<select name="purchase_type" id="purchase_type"  onchange="selAccount();" data-placeholder="Select Purchase Type">
									<option value="" >Select Purchase Type</option>
									<?php foreach($purchaseType as $Purtype):
										if($Purtype['Default'] != 1){?>
											<option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ( (isset($purchasetype) && $Purtype['PurchaseTypeId'] == $purchasetype ) ) ? 'selected' : ""; ?>   ><?php echo $Purtype['PurchaseTypeName']; ?></option>
										<?php  } else { ?>
											<option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ($Purtype['Default'] == 1 ) ? 'selected' : ""; ?>><?php echo $Purtype['PurchaseTypeName']; ?></option>
										<?php  } ?>
									<?php endforeach; ?>
								</select>
							</div>
							<script>
								$(document).ready(function() {
									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Account Type</label>
						<div class="select-style selected-xs margn_5 poa-acc">
							<select name="account_type" id="account_type"  placeholder="" style="width:100%;">
								<option value=''>Select Account Type</option>
								<?php if(isset($accType)) :?>
									<?php foreach($accType as $aType):?>
										<option value="<?php echo $aType['data']; ?>" <?php echo ( (isset($accounttype) && $aType['data'] == $accounttype) ) ? 'selected' : ''; ?>><?php echo $aType['value']; ?></option>
									<?php endforeach; ?>
								<?php endif; ?>
							</select>
						</div>
                        <script>
                            $(document).ready(function() {
                                $(".single_dropdown").select2({
                                    placeholder: "",
                                    allowClear: true
                                });
                            });
                        </script>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>
                    <li class="lbl_ptb">
                        <label>PO Date</label>
                        <span class="poa-date"><input type="text" placeholder="DD-MM-YYYY" class="date_picker poa-head" id="PODate" name="PODate" style="cursor:pointer;" value="<?php echo (isset($PODate)) ? $PODate : date('d-m-Y');?>" readonly onchange="validateDate(this)"/></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Request Date</label>
                        <span class="poa-rdate"><input type="text" placeholder="DD-MM-YYYY" class="date_picker poa-head" id="RefDate" name="RefDate" style="cursor:pointer;" value="<?php echo (isset($RefDate)) ? $RefDate : date('d-m-Y');?>" readonly onchange="validateDate(this)"/></span>
                    </li>
                    <li class="lbl_ptb">
                        <label>Currency</label>
						<span>
							<div class="select-style selected-xs margn_5 poa-cur">
								<select id="currency" name="currency"  class="poa-head">
									<?php foreach($currencyList as $Curtype):?>
										<option value="<?php echo $Curtype['CurrencyId']; ?>" <?php echo ( (isset($currency) && $Curtype['CurrencyId'] == $currency) || (!isset($currency) && $Curtype['CurrencyId'] == 1 )) ? 'selected' : ''; ?>><?php echo $Curtype['CurrencyName']; ?></option>
									<?php endforeach; ?>
								</select>
							</div>
							<div class="error_message"><p>Please enter Currency Type...</p> </div>
							<script>
								$(document).ready(function() {
									$(".single_dropdowncur").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
                    </li>
					<li class="lbl_ptb" style="">
                        <label>PO No</label>
                        <span class="mgic"><input type="text" class="poa-head" placeholder="" id="PONo" name="PONo" value="<?php echo (isset($vNo)) ? $vNo : ''; ?> "readonly /></span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="pan_box zoomIn animated">
                <ul>
                    <li class="lbl_ptb" style="">
                        <label>CCPO No</label>
                        <?php if((((isset($poRegId)) ? $poRegId : 0) > 0 || $CCPo['genType'] == 0)){?>
                            <span class="mgic"><input type="text" placeholder="" class="poa-head" id="CCPONo" name="CCPONo" value="<?php echo (isset($CCPONo)) ? $CCPONo : '';?>"/></span>
                        <?php }else{ ?>
                            <span class="mgic"><input type="text" placeholder="" class="poa-head" id="CCPONo" name="CCPONo" value="<?php echo (isset($CCPONo)) ? $CCPONo : '';?>" readonly /></span>
                        <?php } ?>
                    </li>
                    <li class="lbl_ptb " style="">
                        <label>CPO No</label>
                        <?php if((((isset($poRegId)) ? $poRegId : 0) > 0 || $CPo['genType'] == 0)){?>
                            <span class="mgic"><input type="text" placeholder="" class="poa-head" id="CPONo" name="CPONo" value="<?php echo (isset($CPONo)) ? $CPONo : '';?>"/></span>
                        <?php }else{ ?>
                            <span class="mgic"><input type="text" placeholder="" class="poa-head" id="CPONo" name="CPONo" value="<?php echo (isset($CPONo)) ? $CPONo : '';?>" readonly/></span>
                        <?php } ?>
                    </li>
                    <li class="lbl_ptb " style="">
                        <label>PO Req. No</label>
                        <span class="mgic"><input type="text" placeholder="" id="RefNo" class="poa-head" name="RefNo" value="<?php echo (isset($RefNo)) ? $RefNo : '';?>"/></span>
                    </li>
                    <li class="" style="">
                        <input type="hidden" id="approve" id="approve"  name="approve" value="<?php echo (isset($approve)) ? $approve : '';?>"/>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div class="col-lg-12 clear top-20">
<div id="accordion" class="panel-group">
<!-----Bill of Quantities----->
<div class="panel panel-info">
    <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
        <h4 class="panel-title accordion-toggle defa_panels">Purchase Quantity</h4>
    </div>
    <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
        <div class="panel-body bgcolr">
			<div class="col-lg-12">
                <div class="table-responsive top-30">
                    <table class="table table-bordered tableView dataTable no-footer" style=" margin-bottom:0px;" id="workorderTable">
                        <thead>
                        <tr>
                            <th tabindex="0" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Resource</th>
                            <th tabindex="1" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Unit</th>
                            <th tabindex="2" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Delivery Date</th>
                            <th tabindex="3" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Qty</th>
                            <th tabindex="4" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Rate</th>
                            <th tabindex="5" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">QRate</th>
                            <th tabindex="6" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Base Amount</th>
                            <th tabindex="7" aria-controls="sequentialView" rowspan="1" colspan="1" style="width: 200px;">Qual Amount</th>
                            <th>&nbsp;</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="main seq-class"></tbody>
<!--                        <tbody class="total" id="listTotal">-->
<!--                        <tr>-->
<!--                            <td colspan="5">&nbsp;</td>-->
<!--                            <td align="right" class="t_amt">Base Amount</td>-->
<!--                            <td width="10%" >-->
<!--                                <input class="parent_text border-none" style="text-align:right;" type="text" name="basetotal" id="basetotal" readonly/>-->
<!--                            </td>-->
<!--                            <td>&nbsp;</td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <td colspan="5">&nbsp;</td>-->
<!--                            <td align="right" class="t_amt">Qual Amount</td>-->
<!--                            <td width="10%" >-->
<!--                                <input class="parent_text border-none" style="text-align:right;" type="text" name="total" id="total" readonly/>-->
<!--                            </td>-->
<!--                            <td>&nbsp;</td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <td colspan="5">&nbsp;</td>-->
<!--                            <td align="right" class="t_amt">Net Amount</td>-->
<!--                            <td width="10%" >-->
<!--                                <input class="parent_text border-none" style="text-align:right;" type="text" name="nettotal" id="nettotal" readonly/>-->
<!--                            </td>-->
<!--                            <td>&nbsp;</td>-->
<!--                        </tr>-->
<!--                        </tbody>-->
                    </table>
                    <input type="hidden" name="rowid" id="rowid" value="0"/>
                </div>
                <!----- sequantial view total --------->
				<div class="col-lg-12 padlr0">
					<table class="table" style=" margin-bottom:0px;display:none;" id="seqTotal">
						<tbody class="total" id="listTotal">
							<tr>
								<td align="right" class="rate_pri">Base Amount</td>
								<td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="basetotal" id="basetotal" readonly/>
                                </td>
								<td align="right" class="rate_pri">Qual Amount</td>
								<td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="total" id="total" readonly/>
                                </td>
                                <td align="right" class="rate_pri">Net Amount</td>
								<td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="nettotal" id="nettotal" readonly/>
                                </td>
							</tr>
                            <tr id="ex">
                                <td align="right" class="rate_pri" id="eRatelbl">Exchange Rate</td>
                                <td width="18%">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="exchangeRate" id="exchangeRate" readonly/>
                                </td>
                                <td></td>
                                <td></td>
                                <td align="right" class="rate_pri" id="dNetLbl">Base Currency Net Amount</td>
                                <td align="right">
                                    <input class="parent_text border-none" style="text-align:right;" type="text" name="bCurrencyNet" id="bCurrencyNet" readonly/>
                                </td>
                            </tr>
						</tbody>
					</table>
				</div>
                <!--------- end --------------->
                <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5 top-5">
                    <ul>
<!--                        <li><a href="javascript:nextAccordian(2)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>-->
                        <li><a href="javascript:void(0);" onclick="validateResource();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-------/Bill of Quantities end/------->
<!-------Terms and Condition--------->
<!-- Terms remove -->
<div class="panel panel-info">
    <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
        <h4 class="panel-title accordion-toggle defa_panels">Terms And Conditions</h4>
    </div>
    <div class="panel-collapse collapse collapseTwo" id="" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-12">
                <div class="col-lg-3" style="margin-top:10px;">
                    <select name="valuefrom" id="valuefrom" class="form-control single_dropdown sortoption" data-placeholder="Amount" style="width:100%;">
                        <option value="BaseAmount" <?php if($valuefrom == 0) echo "selected";  ?>>Base Amount</option>
                        <option value="NetAmount" <?php if($valuefrom == 1) echo "selected";  ?>>Net Amount</option>
                        <option value="GrossAmount" <?php if($valuefrom == 2) echo "selected";  ?>>Gross Amount</option>
                    </select>
                    <script>
                        $(document).ready(function(){

                            var tCount =  $('#termsTable tbody tr').length;
                            if(tCount > 1){
                                $('#valuefrom').attr("disabled", true);
                            } else {
                                $('#valuefrom').attr("disabled", false);
                            }
                        });
                    </script>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive top-30 bot-20">
                    <table class="table table-bordered tableView dataTable no-footer" style=" margin-bottom:0px;" id="termsTable" >
                        <thead>
                        <tr>
                            <th>Sl.No</th>
                            <th>Terms</th>
                            <th>Percentage</th>
                            <th>Value</th>
                            <th>Period</th>
                            <th>Date</th>
                            <th>Description</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody class="main"></tbody>
                    </table>
                    <input type="hidden" name="trowid" id="trowid" value="0"/>
                </div>
                <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5 top-5">
                    <ul>
<!--                        <li><a href="javascript:nextAccordian(3)" >Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>-->
                        <li><a href="javascript:void(0);" onclick="validateTerms();">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>

                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-------Others Details-------->
<div class="panel panel-info">
    <div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
        <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
    </div>
    <div class="panel-collapse collapse collapseThree" id="" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="clearfix"></div>
            <div class="col-lg-12 floor_name_area">
                <div class="card">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#nar" id="narrationTabLink" onclick="showotherstabs('narration')" aria-controls="naration" role="tab" data-toggle="tab">Narration</a></li>
                        <li class=""><a href="#branchdetails" id="branchTabLink" onclick="showotherstabs('branch')" aria-controls="branchdetails" role="tab" data-toggle="tab">Branch Details</a></li>
                        <li class=""><a href="#deliverydetails" id="deliveryTabLink" onclick="showotherstabs('delivery')" aria-controls="deliverydetails" role="tab" data-toggle="tab">Delivery Details</a></li>
                        <li class=""><a href="#cccontactdetails" id="cccontactTabLink" onclick="showotherstabs('cccontact')" aria-controls="cccontact" role="tab" data-toggle="tab">CostCentre Contact Info</a></li>
                        <li class=""><a href="#ccontactdetails" id="ccontactTabLink" onclick="showotherstabs('ccontact')" aria-controls="ccontact" role="tab" data-toggle="tab">Company Contact Info</a></li>
						<li class=""><a href="#distributordetails" id="distributorTabLink" onclick="showotherstabs('distributor')" aria-controls="distributor" role="tab" data-toggle="tab">Distributor</a></li>
                    </ul>
                    <div class="tab-content" id="narration">
                        <div class="tab-pane active" id="nar">
                            <p>
                            <div class="col-lg-12">
                                <?php
                                if(isset($narration)){ ?>
                                    <textarea class="exp-tex" name="Narration" id="Narration"><?php echo (isset($narration)) ? $narration : 'Enter your Notes.......';?></textarea>
                                <?php }else{ ?>
                                    <textarea class="exp-tex" name="Narration" id="Narration" placeholder="Enter your Notes..."></textarea>
                                <?php } ?>
                            </div>
                            </p>
                        </div>
                    </div>
                    <div class="tab-pane" id="branchdetails"  style="display: none;">
                        <div class="col-lg-12 top-30">
                            <div class="col-lg-6">
                                <select name="branchname" id="branchname" class="form-control single_dropdown lbl_move " label="Branch" style="width:100%;">
                                    <option value="" >Select Branch</option>
                                    <?php foreach($branch as $bran):?>
                                        <option value="<?php echo $bran['BranchId']; ?>" <?php echo ( (isset($branchid) && $bran['BranchId'] == $branchid) ) ? 'selected' : ''; ?>><?php echo $bran['BranchName']; ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <div class="col-lg-6">
                                <select name="cperson" id="cperson" class="form-control single_dropdown lbl_move" label="Contact Person" style="width:100%;">
                                    <option value="" >Contact Person</option>
                                    <?php if(isset($cPerson)) :?>
                                        <?php foreach($cPerson as $cPer):?>
                                            <option value="<?php echo $cPer['data']; ?>" <?php echo ( (isset($branchtransid) && $cPer['data'] == $branchtransid) ) ? 'selected' : ''; ?>><?php echo $cPer['value']; ?></option>
                                        <?php endforeach; ?>
                                    <?php endif; ?>
                                </select>
                            </div>
                            <input type="hidden" name="" id="" value="0"/>
                        </div>
                    </div>
                    <!----------Delivery Details ----->
                    <div class="tab-pane" id="deliverydetails"  style="display: none;">
                        <div class="col-lg-12 top-30 bot-20">
                            <div class="col-lg-4">
                                <select name="warehouse" id="warehouse" class="form-control single_dropdown lbl_move" label="Select WareHouse" style="width:100%;">
                                    <option value="" >Select WareHouse</option>
                                    <?php foreach($warehouse as $wh):?>
                                        <option value="<?php echo $wh['data']; ?>" <?php echo ( (isset($whid) && $wh['data'] == $whid) ) ? 'selected' : ''; ?>><?php echo $wh['value']; ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="col-lg-6">
                                <label class="tx_lbl">Delivery Address</label>
                                <textarea class="exp-tex" name="deladdress" id="deladdress" placeholder="Delivery Address"> <?php echo (isset($deladd)) ? $deladd : 'Enter Delivery Address';?> </textarea>
                            </div>
                            <div class="col-lg-6">
                                <label class="tx_lbl">WareHouse Address</label>
                                <textarea class="exp-tex" readonly="true" name="whaddress" id="whaddress" placeholder="WareHouse Address"> <?php echo (isset($whadd)) ? $whadd : '';?> </textarea>
                            </div>
                            <input type="hidden" name="" id="" value="0"/>
                        </div>
                    </div>
                    <!----------CostCentre Contact Details ----->
                    <div class="tab-pane" id="cccontact"  style="display: none;">
                        <div class="col-lg-12 top-30">
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move special" type="text" name="cccontact" id="cccontact" label="Contact Person" value="<?php echo (isset($cccontact)) ? $cccontact : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="text" name="ccphone" id="ccphone" label="Phone No" maxlength="10" onkeypress="return isNumberKey(event);" value="<?php echo (isset($ccphone)) ? $ccphone : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="text" name="ccmobile" id="ccmobile" label="Mobile" maxlength="10" onkeypress="return isNumberKey(event);" value="<?php echo (isset($ccmobile)) ? $ccmobile : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="email"  name="ccemail" id="ccemail" onChange="return mailCheck(this);" label="Email"value="<?php echo (isset($ccemail)) ? $ccemail : '';?>" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{1,63}$"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!----------Company Contact Details ----->
                    <div class="tab-pane" id="ccontact"  style="display: none;">
                        <div class="col-lg-12 top-30">
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move special" type="text" name="ccontact" id="ccontact" label="Contact Person" value="<?php echo (isset($ccontact)) ? $ccontact : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="text" name="cphone" id="cphone" label="Phone" maxlength="10" onkeypress="return isNumberKey(event);" value="<?php echo (isset($cphone)) ? $cphone : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="text" name="cmobile" id="cmobile" onkeypress="return isNumberKey(event);" maxlength="10"  label="Mobile" value="<?php echo (isset($cmobile)) ? $cmobile : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="polymer-form">
                                    <input class="form-control lbl_move" type="text" name="cemail" id="cemail" label="Email" onChange="return mailCheck1(this);" value="<?php echo (isset($cemail)) ? $cemail : '';?>" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{1,63}$"/>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="tab-pane" id="distributor"  style="display: none;">
						<div class="col-lg-3 top-10">
							<select name="distributor[]" id="distributor" class="form-control selectpicker sortoption"  multiple="multiple"  title="Distributor">
								<?php if(isset($data)) :?>
									<?php foreach($distributorList as $dist):?>
										<option value="<?php echo $dist['VendorId']; ?>" <?php echo ( in_array($dist['VendorId'],$data)) ? 'selected' : ''; ?>><?php echo $dist['VendorName']; ?></option>
									<?php endforeach; ?>
								<?php else :?>
									<?php foreach($distributorList as $dist):?>
										<option value="<?php echo $dist['VendorId']; ?>"><?php echo $dist['VendorName']; ?></option>
									<?php endforeach; ?>
								<?php endif; ?>
							</select>
							<script>
								$(document).ready(function() {

								});
							</script>
						</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</form>
</div>
</div>
</div>
<!-------------------------------Others Details------------------------------->
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r"><a onClick="submitForm()"  style="" data-toggle="tooltip" id="sub1" class="ripple" title="Submit">Submit</a></li>
        <li class="cancel_btn float_r">
            <?php if(isset($approve) && $approve=="No"): ?>
                <a href="<?php echo $this->basePath();?>/mms/purchase/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Close</a>
            <?php elseif (isset($approve) && $approve=='Partial'): ?>
                <a href="<?php echo $this->basePath();?>/mms/purchase/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Back</a>
            <?php else: ?>
                <a href="<?php echo $this->basePath();?>/mms/purchase/order" data-toggle="tooltip" class="ripple" title="Close!">Close</a>
            <?php endif; ?>
        </li>
    </ul>
</div>
<!-- stock details for desc -->
<div class="modal fade" id="stockPOModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable">
                            <thead>
                            </thead>
                            <tbody>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Rate</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateRate" style="text-align:right;" class="parent_txts newRow" value=""  readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Available Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="availableQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Excess Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="excessQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>

                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Requested Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="requestQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal Requested Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balrequestQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">PO Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="poQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal PO Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balancePO" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Min Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="minQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Issue Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="issueQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Transfer Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="transferQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Return Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billreturnQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>

                            </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>
<!-------------------------------------------------------------------------------------->
<!------------ Previous Purchase Rate ------------>
<div class="modal fade" id="preRateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document" style="width:850px !important;">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Previous Purchase Rates</h4>
            </div>
            <div class="modal-body">
                <h4 class="modal-title" style="color:#18300d;">Over All</h4>
                <div id="orateGrid">
                </div>

            </div>
            <div class="modal-body">
                <h4 class="modal-title" style="color:#18300d;">Company</h4>
                <div id="comprateGrid">
                </div>
            </div>
            <div class="modal-body">
                <h4 class="modal-title" style="color:#18300d;">CostCentre</h4>
                <div id="ccrateGrid">
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<!----------------------------------------------------------------------------------->
<div class="modal fade" id="stockWBSModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable">
                            <tbody>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateWbsQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Estimate Rate</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="estimateWbsRate" style="text-align:right;" class="parent_txts newRow" value=""  readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Available Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="availableWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Excess Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="excessWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>

                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Requested Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="requestWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal Requested Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balrequestWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">PO Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="poWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bal PO Qty</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="balanceWbsPO" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>

                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Min Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="minWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            <tr>
                                <td width="50%">
                                    <label class="pop_label">Bill Return Quantity</label>
                                </td>
                                <td width="50%">
                                    <input type="text" id="billreturnWbsQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<script id="resource-template"  type="text/template" class="hide">
    <?php
    $displayscreen="display:none";
    $displaymaintr="parent_text mainTr";
    if($gridtype==1) {
        $displayscreen="display:none";
        $displaymaintr="parent_text mainTr";
    }  ?>
    <tr class="count-tr">
        <td width="25%">
            <input class="parent_text resourceSuggest" onmouseover="getCurValue(this);" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);" />
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="unitname__" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="12%">
            <input type="text" name="deldate__" id="deldate__" class='tbl_input date_picker' value="<?php echo Date('d-m-Y'); ?>" onChange="deliveryDateValidate(this)" readonly />
        </td>
        <td width="10%">
            <input class="border-none <?php echo $displaymaintr; ?>" type="text" name="qty__" id="qty__" maxlength="50" style="text-align:right;" onkeypress="return isqtyDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  onchange="calcResQuantity(this)" autocomplete="off"   />
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" >
            <input type="hidden" name="rfrom__" id="rfrom__" >
            <input type="hidden" name="dcqty__" id="dcqty__" >
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="rate__" id="rate__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" autocomplete="off"   onchange="rateChange(this.id)"/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="qrate__" id="qrate__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" autocomplete="off"  readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="baseamount__" style="text-align:right;" id="baseamount__" readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="amount__" style="text-align:right;" id="amount__" readonly/></td>

        <td width="10%" align="center" class="action_btns_td" style="border:none !important;">
            <ul class="action_btns">
                <li> <a onclick="deleteMainRow(this, event);"  id="deleteTr__" style="display:none;cursor:pointer;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;cursor:pointer;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>

        <td width="2%" align="center" class="action_btns_td" style="border:none !important;">
            <ul class="action_btns">
                <li><a onclick="return stockPODetails(this);"  id="expandSt__" style="display:none;cursor:pointer;"><i class="fa fa-suitcase" data-toggle="modal" data-original-title="Stock Details" data-target="#stockPOModal" data-placement="left"></i></a></li>
                <li><a onclick="return prerateDetails(this);"  id="expandRt__" style="display:none;cursor:pointer;"><i class="fa fa-star-half-o" data-toggle="modal" data-original-title="Previous Rate" data-target="#preRateModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div id="subMaintd__" class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li id="liDec__" class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="showtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Decision<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li id="liWbs__" class=""><a class="ripple has-ripple" id="wbsTabLink__" onclick="showtabs('wbs',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Wbs<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li id="liQual__" class=""><a class="ripple has-ripple" id="qualifierTabLink__" onclick="showtabs('qualifier',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Qualifier<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                            <li id="liResSpec__" class=""><a class="ripple has-ripple" id="reqspeTabLink__" onclick="showtabs('reqspe',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Resource Specification<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="tab-content">
                        <div class="table-responsive topsp">
                            <table class="table table-bordered tableView dataTable no-footer" style="margin-bottom:0px;" bgcolor="#00FF00" id="decisionTable__">
                                <thead>
                                <tr>
                                    <th class="worktype-activity sub_tbl1">Decision No</th>
                                    <th style="text-align: center"  class="worktype-activity sub_tbl1">Bal Qty</th>
                                    <th style="text-align: center"  class="sub_tbl1">Qty</th>
                                    <th class="iow___requestfields sub_tbl1" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                            </table>
                            <table class="table table-bordered tableView dataTable no-footer" style="margin-bottom:0px;<?php echo $displayscreen; ?>;" id="wbsTable__">
                                <thead>
                                <tr>
                                    <th class="worktype-activity sub_tbl2">WBS Name</th>
                                    <th style="text-align: center"  class="sub_tbl2">Qty</th>
                                    <th class="wbs___requestfields" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="wbs___rowid" id="wbs___rowid" value="0"/>
                            </table>
                            <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable__" onchange="CalculateRate(this.id)">
                            </table>
                            <div class="tab-content">
                                <div class="table-responsive topsp">
                                    <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">
                                        <tbody class="main"></tbody>
                                        <tbody class="total">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-xs-12 mar_10">
                    <span class="est1 mr_lt" id="estqty__" ></span>
                    <span class="est2 mr_lt" id="estrate__" ></span>
                    <span class="est3 mr_lt" id="avaqty__" ></span>
                    <span class="est3 mr_lt" id="balpoqty__" hidden="true" ></span>
                    <span class="est3 mr_lt" id="totpurchase__" hidden="true" ></span>
                </div>
            </div>
        </td>
    </tr>
</script>

<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___decisionno_0" id="iow___decisionno_0" readonly/>
            <input type="hidden" name="iow___decisionid_0" id="iow___decisionid_0"/>
            <input type="hidden" name="iow___dectransid_0" id="iow___dectransid_0"/>
            <input type="hidden" name="iow___reqtransid_0" id="iow___reqtransid_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
        </td>
        <td width="30%" align="right"><input class="parent_text border-none" type="text" style="text-align:right;" name="iow___balqty_0" id="iow___balqty_0" readonly/></td>
        <td width="40%" align="right">
            <input class="<?php echo $displaymaintr; ?>" type="text" name="iow___qty_0" id="iow___qty_0" maxlength="50" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  autocomplete="off"  onchange="calcQuantity(this);"/>
            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0"/>
        </td>
        <td width="10%" align="right" class="action_btns_td iow___requestfields" style="display: none;">
            <ul class="action_btns">
                <li><a href="#" id="iow___expandSubTr_0" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr dont-hide">
        <td colspan="9" style="padding:0px !important;" id="iow___request_0_decWbs">
            <div class="subDiv scrl" style="<?php echo $displayscreen; ?>;" >
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="table-responsive topsp">
                        <table class="table table-bordered tableView dataTable no-footer" style="margin-bottom:0px;" id="iow___request_0_reqno">
                            <thead>
                            <tr>
                                <th class="sub_tbl2">WBS Name</th>
                                <th style="text-align: center"  class="sub_tbl2">Bal Qty</th>
                                <th style="text-align: center"  class="sub_tbl2">Qty</th>
                                <th class="sub_tbl2">&nbsp;</th>
                                <th class="sub_tbl2">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                            <input type="hidden" name="iow___request_0_rowid" id="iow___request_0_rowid" value="0"/>
                        </table>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="request-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="50%">
            <input class="parent_text border-none" type="text" name="iow___request_0_wbsname__9" id="iow___request_0_wbsname__9" readonly/>
            <input type="hidden" name="iow___request_0_wbsid__9" id="iow___request_0_wbsid__9"/>
            <input type="hidden" name="iow___request_0_dectransid__9" id="iow___request_0_dectransid__9"/>
            <input type="hidden" name="iow___request_0_decatransid__9" id="iow___request_0_decatransid__9"/>
            <input type="hidden" name="iow___request_0_reqtransid__9" id="iow___request_0_reqtransid__9"/>
            <input type="hidden" name="iow___request_0_reqahtransid__9" id="iow___request_0_reqahtransid__9"/>
            <input type="hidden" name="iow___request_0_resourceid__9" id="iow___request_0_resourceid__9"/>
            <input type="hidden" name="iow___request_0_itemid__9" id="iow___request_0_itemid__9"/>
        </td>
        <td width="24%"><input class="parent_text border-none" type="text" style="text-align:right;" name="iow___request_0_balqty__9" id="iow___request_0_balqty__9" readonly/></td>
        <td width="24%">
            <input class="<?php echo $displaymaintr; ?>" type="text" name="iow___request_0_qty__9" id="iow___request_0_qty__9" maxlength="50" style="text-align:right;"  onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  onchange="calcRequestQuantity(this);" onclick="estwbsclick(this);" data-html="true" data-placement="left" data-toggle="tooltip" data-original-title='' />
            <input type="hidden" name="iow___request_0_hiddenqty__9" id="iow___request_0_hiddenqty__9"/>
            <span class="nos" id="iow___request_0_estwbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___request_0_avawbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___request_0_excesswbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___request_0_balpowbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___request_0_totpurchasewbsqty__9" hidden="true"></span>
        </td>
        <td width="2%" align="right" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
                <li><a  onclick="stockWBSDetails(this);" class="mainTr" id="iow___request_0_expandWbs__9" style="cursor:pointer;"><i class="fa fa-star" data-toggle="modal" data-target="#stockWBSModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>
</script>
<script id="resspec-template" type="text/template">
    <tr class="dont-hide">
        <td width="100%">
            <textarea class="exp-tex"  name="resspec__" id="resspec__" class="parent_txts newRow"  value=""></textarea>
        </td>
    </tr>
</script>
<script id="wbs-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="70%" class="worktype-activity">
            <input class="parent_text border-none" type="text"  name="wbs___wbsname_0" id="wbs___wbsname_0" readonly/>
            <input type="hidden" name="wbs___wbsid_0" id="wbs___wbsid_0"/>
        </td>
        <td width="30%">
            <input class="parent_text" type="text" name="wbs___qty_0" id="wbs___qty_0" maxlength="50" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)" onchange="calcWbsQuantity(this);" onclick="estwbsclick1(this);" data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' />
            <input type="hidden" name="wbs__hiddenqty_0" id="wbs__hiddenqty_0"/>
            <span class="nos" id="wbs___estwbsqty_0" hidden="true"></span>
            <span class="nos" id="wbs___avawbsqty_0" hidden="true"></span>
            <span class="nos" id="wbs___excesswbsqty_0" hidden="true"></span>
            <span class="nos" id="wbs___balpowbsqty_0" hidden="true"></span>
            <span class="nos" id="wbs___totpurchasewbsqty_0" hidden="true"></span>
            <span class="nos" id="wbs___isprojwbsqty_0" hidden="true"></span>
        </td>
        <td width="2%" align="right" class="action_btns_td iow_1_requestfields">
            <ul class="action_btns">
                <li><a  onclick="stockOWBSDetails(this);" class="mainTr" id="wbs___expandWbs_0" style="cursor:pointer;"><i class="fa fa-star" data-toggle="modal" data-target="#stockWBSModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>
</script>
<script id="otherterms-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="15%"><input class="parent_text" type="text" name="termTitle__" id="termTitle__" maxlength="155" onchange="addNewTermRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="termDesc__" id="termDesc__"></textarea></td>
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTermTr__" onclick="deleteTerm(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a></li>
            </ul>
        </td>
    </tr>
</script>

<script id="terms-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="10%">
            <input class="parent_text border-none" type="text" name="slno__" id="slno__" />
        </td>
        <td width="26%">
            <input class="parent_text resourceSuggest" type="text" name="terms__" id="terms__"  onfocus="checkTermsUsed(this);" />
            <input type="hidden" name="termsid__" id="termsid__"/>
            <input type="hidden"  name="isper__" id="isper__"/>
            <input type="hidden"  name="isvalue__" id="isvalue__"/>
            <input type="hidden"  name="isperiod__" id="isperiod__"/>
            <input type="hidden"  name="istdate__" id="istdate__"/>
            <input type="hidden"  name="iststring__" id="iststring__"/>
            <input type="hidden"  name="includegross__" id="includegross__"/>
        </td>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="per__" id="per__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" onchange="TermsCalculation(this.id);"/>
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="value__" style="text-align:right;" id="value__" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)" onchange="TermsCalculation(this.id);"/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="period__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 1, true)" id="period__"/></td>
        <td width="14%">
            <div class="col-lg-12 padlr0">
                <input type="text" name="date__" id="date__" class="tbl_input date_picker" value="<?php echo date("d/m/Y"); ?>" onkeypress="return isNumberKey(event);" readonly/>
                <span class="date_icon"><i class="fa fa-calendar"></i></span>
            </div>
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="string__" id="string__"/></td>
        <td width="15%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="termsdeleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script id="branchdet-template"  type="text/template" class="hide">
    <tr class="padi05 dont-hide">
        <td width="33%">
            <div class="select-style heg30">
                <select name="branch__" id="branch__">
                    <option value="C">Chargeable</option>
                    <option value="F">Free</option>
                </select>
            </div>
        </td>
        <td width="34%"><input class="parent_padi05" type="text" name="materialExcUnit__" id="contactno__" readonly/>
    </tr>
    <tr class="dont-hide">
        <td width="33%">
            <div class="select-style heg30">
                <select name="contactperson__" id="contactperson__">
                    <option value="C">Chargeable</option>
                    <option value="F">Free</option>
                </select>
            </div>
        </td>
    </tr>

</script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/paging.css';?>"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/paging.js"></script>
<script>
    $(document).ready(function(){
          var check2 = $('#flag').val();
        if(check2 == 1){
            $('.poa-head input:text').attr('readonly',true);
            var ptName = $("#purchase_type option:selected").text();
            var poAPurchase = '<input type="text" id="purchase_type" name="purchase_type"  width="100%" value="'+ ptName +'" readonly>';
            $('.poa-ps').html(poAPurchase);

            var atName = $("#account_type option:selected").text();
            var poAAccount = '<input type="text" id="account_type" name="account_type" width="100%" value="'+ atName +'" readonly>';
            $('.poa-acc').html(poAAccount);

            var curName = $("#currency option:selected").text();
            var currName = '<input type="text" id="currency" name="currency"  width="100%" value="'+ curName +'" readonly>';
            $('.poa-cur').html(currName);

            var podate = $("#PODate").datepicker({ dateFormat: 'yy-mm-dd' }).val();
            var poADate = '<input type="text" id="PODate" name="PODate" width="100%" value="'+ podate +'" readonly>';
            $('.poa-date').html(poADate);

            var rqdate = $("#RefDate").datepicker({ dateFormat: 'yy-mm-dd' }).val();
            var poARqDate = '<input type="text" id="RefDate" name="RefDate" width="100%" value="'+ rqdate +'" readonly>';
            $('.poa-rdate').html(poARqDate);
        }
        if(check2 == 2){
            document.getElementById("vendor").disabled = false;
        }

        $(".flip0").click(function(){
            $(".pane0").slideToggle("slow");
        });
    });
    function myFunction(x) {
        x.classList.toggle("change");
    }
</script>
<script type="text/javascript">

//var vamt = <?php
//echo calculateCurrency('USD','INR',1);
//?>//;
$("#dNetLbl").hide();
$("#bCurrencyNet").hide();
$("#eRatelbl").hide();
$("#exchangeRate").hide();
$("#ex").hide();

var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;

var tmp_arr_resources = arr_resources;

var arr_wbs =  <?php echo (isset($arr_res_wbs)) ? json_encode($arr_res_wbs) : '[]';?>;
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;

var arr_terms=<?php echo (isset($arr_terms)) ? json_encode($arr_terms) : '[]';?>;
var tmp_arr_terms=arr_terms;
var arr_edit_terms=<?php echo (isset($arr_edit_terms)) ? json_encode($arr_edit_terms) : '[]';?>;
var arr_qual_list=<?php echo (isset($arr_qual_list)) ? json_encode($arr_qual_list) : '[]';?>;
var arr_estdetails = <?php echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;//arr_estimate
var arr_wbsestimate = <?php echo (isset($arr_wbsestimate)) ? json_encode($arr_wbsestimate) : '[]';?>;
var qualList = <?php echo (isset($qualList)) ? json_encode($qualList) : '[]';?>;
var WorkType = $('#WorkType').val();
var OrderType = $('#OrderType').val();

var qualiferHTML = '<?php echo (isset($qualHtml)) ? preg_replace('~>\s+<~', '><',$qualHtml) : '';?>';
$(function () {
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();
    var termstemplate = $('#terms-template').html();
    var resspectemplate=$('#resspec-template').html();
    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.seq-class');
    if(arr_requestResources.length != 0) {
        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $('#desc_' + rowid).val(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).val(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#qty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
            $('#rate_' + rowid).val(sanitizeNumber(o.Rate,2,true));
            $('#qrate_' + rowid).val(sanitizeNumber(o.QRate,2,true));
            $('#baseamount_' + rowid).val(sanitizeNumber(o.BaseAmount,2,true));
            $('#amount_' + rowid).val(sanitizeNumber(o.Amount,2,true));
            $('#hiddenqty_' + rowid).val(o.HiddenQty);
            $('#dcqty_' + rowid).val(o.DCQty);
            $('#rfrom_' + rowid).val(o.RFrom);
            $('#deldate_' + rowid).val(o.ReqDate);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            $('#expandSt_' + rowid).show();
            $('#expandRt_' + rowid).show();
            $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
            $('#resspec_' + rowid).val(o.ResSpec);

            $.each(arr_estdetails,function(s,k){
                if(o.ResourceId == k.ResourceId) {
//                    $('#estqty_' + rowid).val('Estimate Qty: '+ k.EstimateQty);
//                    $('#estrate_' + rowid).val('Estimate Rate: '+ k.EstimateRate);
//                    $('#avaqty_' + rowid).val('Available Qty: '+ k.AvailableQty);
                    if(k.EstimateQty > 0 || k.EstimateQty < 0) {
                        $('#estqty_' + rowid).text('Estimate Qty: ' + sanitizeNumber(k.EstimateQty,3,true));
                    } else {
                        $('#estqty_' + rowid).text('Estimate Qty: 0');
                    }
                    if(k.EstimateRate > 0 || k.EstimateRate < 0) {
                        $('#estrate_' + rowid).text('Estimate Rate: ' + sanitizeNumber(k.EstimateRate,3,true));
                    } else {
                        $('#estrate_' + rowid).text('Estimate Rate: 0');
                    }
                    if(k.AvailableQty > 0 || k.AvailableQty < 0) {
                        $('#avaqty_' + rowid).text('Available Qty: ' + sanitizeNumber(k.AvailableQty,3,true));
                    } else {
                        $('#avaqty_' + rowid).text('Available Qty: 0');
                    }
                    if(k.BalPOQty > 0 || k.BalPOQty < 0) {
                        $('#balpoqty_' + rowid).text(k.BalPOQty);
                    } else {
                        $('#balpoqty_' + rowid).text(0);
                    }
                    if(k.TotPurchase > 0 || k.TotPurchase <0) {
                        $('#totpurchase_' + rowid).text(k.TotPurchase);
                    } else {
                        $('#totpurchase_' + rowid).text(0);
                    }

                }
            } );
            var findRes = arr_resource_iows.filter(function(obj) {
                return (obj.ResourceId === o.ResourceId) && (obj.ItemId === o.ItemId && (obj.BalQty > 0 || obj.Qty > 0));
            });

            if(findRes.length > 0) {
                $.each(arr_resource_iows, function (j, l) {
                    if ((l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                        return;
                    }
                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    /////////////////
                    $('#wbsTable_' + rowid).hide();
                    $('#decisionTable_' + rowid).show();
                    $('#decisionTabLink_' + rowid).show();
                    $('#wbsTabLink_' + rowid).hide();
                    if (<?php echo (isset($poRegId)) ? $poRegId : 0;?> >0) {
                        var RId = o.ResourceId;
                        var ItId = o.ItemId;
                        var poRegId =<?php echo (isset($poRegId)) ? $poRegId : 0;?>;

                        $.ajax({
                            url: getBaseURL() + 'mms/purchase/orderentry',
                            type: "post",
                            data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&poId=" + poRegId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));

                                    if (data.length > 0) {
                                        $('#qualifierTabLink_' + rowid).show();
                                    }
                                    else {
                                        $('#qualifierTabLink_' + rowid).hide();
                                    }
                                }
//
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });
                    } else {
                        $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
                        //$('#resspec-template_' + rowid).append(resspectemplate.replace(/__1/g, '_' + rowid));
                        // $('#resspec-template_' + rowid).find('> tbody.main').append(resspectemplate.replace(/__/g, '_' + rowid));
                    }
                    ////////////////


                    $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
                    $('#iow_' + rowid + '_dectransid_' + iowrowid).val(l.DecTransId);
                    $('#iow_' + rowid + '_reqtransid_' + iowrowid).val(l.ReqTransId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);

                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(l.BalQty,3,true));
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);

                    if (WorkType == 'activity') {
                        $('#iow_' + rowid + '_agtno_' + iowrowid).val(l.SerialNo);
                        $('#iow_' + rowid + '_spec_' + iowrowid).val(l.Specification);
                    } else if (WorkType == 'iow') {
                        $('.worktype-activity').remove();
                    }

                    var findAnal = arr_resource_iow_requests.filter(function(obj) {
                        return (obj.DecisionId === l.DecisionId  && obj.ResourceId === l.ResourceId &&  obj.ItemId === l.ItemId && (obj.BalQty > 0 || obj.Qty > 0));
                    });
                    if(findAnal.length > 0) {
                        $.each(arr_resource_iow_requests, function (k, r) {
                            if (l.DecisionId != r.DecisionId || l.ResourceId != r.ResourceId || l.ItemId != r.ItemId) {
                                return;
                            }

                            $('#iow_' + rowid + '_qty_' + iowrowid).addClass('border-none').prop('readonly', true);
                            $('.iow_' + rowid + '_requestfields').show();
                            var requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                            $('#iow_' + rowid + '_request_' + iowrowid + '_reqno').find('> tbody.main').append(requesttemplate
                                .replace(/__9/g, '_' + requestrowid)
                                .replace(/_0/g, '_' + iowrowid)
                                .replace(/__/g, '_' + rowid));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);

                            $('#iow_' + rowid + '_request_' + iowrowid + '_wbsname_' + requestrowid).val(r.WBSName);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val(r.WBSId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_dectransid_' + requestrowid).val(r.DecTransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_decatransid_' + requestrowid).val(r.DecATransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_reqtransid_' + requestrowid).val(r.ReqTransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_reqahtransid_' + requestrowid).val(r.ReqAHTransId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_resourceid_' + requestrowid).val(r.ResourceId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_itemid_' + requestrowid).val(r.ItemId);
                            $('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber(r.BalQty,3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val(sanitizeNumber(r.Qty,3,true));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenqty_' + requestrowid).val(r.HiddenQty);

                            $('#iow_' + rowid + '_request_' + iowrowid + '_expandWbs_' + requestrowid).show();

                            //Wbs Estimate
                            var findestwbs = arr_wbsestimate.filter(function(obj)
                                {
                                    return (obj.ResourceId === r.ResourceId && obj.WBSId === r.WBSId);
                                }
                            );

                            if(findestwbs.length > 0) {
                                $.each(arr_wbsestimate, function (s, n) {
                                    if (r.ResourceId == n.ResourceId && r.WBSId == n.WBSId) {


                                        $('#iow_' + rowid + '_request_' + iowrowid + '_reqahtransid_' + requestrowid).val(r.ReqAHTransId);
//                                        $('#iow_' + rowid + '_request_' + iowrowid +  '_estwbsdetails_' + requestrowid).hide();
//                                        $('#iow_' + rowid + '_request_' + iowrowid + '_estwbsarrow_' + requestrowid).hide();
                                        $('#iow_' + rowid + '_request_'+ iowrowid + '_estwbsqty_' + requestrowid).text(n.EstimateQty);
                                        $('#iow_' + rowid + '_request_'+ iowrowid + '_avawbsqty_' + requestrowid).text(n.AvailableQty);
                                        $('#iow_' + rowid + '_request_' + iowrowid + '_excesswbsqty_' + requestrowid).text(n.ExcessQty);
                                        $('#iow_' + rowid + '_request_' + iowrowid + '_balpowbsqty_' + requestrowid).text(n.BalPOQty);
                                        $('#iow_' + rowid + '_request_' + iowrowid + '_totpurchasewbsqty_' + requestrowid).text(n.TotPurchase);
                                        $('#iow_' + rowid + '_request_' + iowrowid + '_isprojwbsqty_' + requestrowid).text(n.IsProj);
                                    }
                                });
                            } else {
//                                $('#iow_' + rowid + '_request_' + iowrowid +  '_estwbsdetails_' + requestrowid).hide();
//                                $('#iow_' + rowid + '_request_' + iowrowid + '_estwbsarrow_' + requestrowid).hide();
                            }
                            //
                        });
                    } else {
                        $('#iow_'+ rowid +'_request_'+ iowrowid +'_decWbs').hide();
                        $('#iow_'+ rowid +'_request_'+ iowrowid +'_reqno').hide();
                        $('#iow_'+ rowid +'_expandSubTr_'+iowrowid).hide();
                    }
                    CalculateRate('#qualifierTable_' + rowid);
                });
                if(<?php echo (isset($poRegId)) ? $poRegId : 0;?> == 0)
                {
                    if (qualList.length > 0) {
                        $('#qualifierTabLink_' + rowid).show();
                    }
                    else {
                        $('#qualifierTabLink_' + rowid).hide();
                    }
                }
            }
            /////
            else {
                $('#wbsTable_' + rowid).show();
                $('#decisionTable_' + rowid).hide();
                $('#decisionTabLink_' + rowid).hide();
                $('#wbsTabLink_' + rowid).show();
                $('#liWbs_' + rowid).addClass('active');

                //Without Request Decision Wbs Populate
                var ResId = o.ResourceId;
                var IteId = o.ItemId;
                var PoRegId = <?php echo (isset($poRegId)) ? $poRegId : 0;?>;
                var CcId = $('#CostCenterId').val();
                $.ajax({
                    url: getBaseURL() + 'mms/purchase/orderentry',
                    type: "post",
                    data: "ResourceId=" + ResId + "&Type=wbsEdit&ItemId=" + IteId + "&PORegId=" + PoRegId + "&CCId=" + CcId + "",
                    async: false,
                    success: function (data, textStatus, jqXHR) {
                        if (jqXHR.status == 200) {
                            data = JSON.parse(data);
                            if(Object.keys(data).length > 1) {
                                var wbstemplate = $('#wbs-template').html();
                                $.each(data.wbs, function (i, l) {
                                    var iowrowid = parseInt($('#wbs_' + rowid + '_rowid').val()) + 1;
                                    $('#wbsTable_' + rowid).find('> tbody.main').append(wbstemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                    $('#wbsTable_' + rowid).show();
                                    $('#decisionTable_' + rowid).hide();
                                    $('#decisionTabLink_' + rowid).hide();
                                    $('#wbsTabLink_' + rowid).show();
                                    $('#wbs_' + rowid + '_rowid').val(iowrowid);
                                    $('#wbs_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                    $('#wbs_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
                                    $('#wbs_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                                });
                            }
                            else
                            {
                                $('#wbsTable_' + rowid).hide();
                                $('#decisionTable_' + rowid).hide();
                                $('#decisionTabLink_' + rowid).hide();
                                $('#wbsTabLink_' + rowid).hide();
                                if(qualList.length > 0) {
                                    $('#qualifierTabLink_' + rowid).show();
                                    $('#qualifierTable_' + rowid).show();
                                    $('#liQual_' + rowid).addClass('active');
                                } else {
                                    $('#qualifierTabLink_' + rowid).hide();
                                    $('#qualifierTable_' + rowid).hide();
                                }
                            }
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('.loading_area').hide();
                    }

                });
                if (<?php echo (isset($poRegId)) ? $poRegId : 0;?> >0) {
                    var RId = o.ResourceId;
                    var ItId = o.ItemId;
                    var poRegId =<?php echo (isset($poRegId)) ? $poRegId : 0;?>;

                    $.ajax({
                        url: getBaseURL() + 'mms/purchase/orderentry',
                        type: "post",
                        data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&poId=" + poRegId + "",
                        async: false,
                        success: function (data, textStatus, jqXHR) {
                            if (jqXHR.status == 200) {
                                data = JSON.parse(data);
                                $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                            }
                            $('.loading_area').hide();
                        }, error: function (jqXHR, textStatus, errorThrown) {
                            $('.loading_area').hide();
                        }
                    });
                } else {
                    $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
                    //$('#resspec-template_' + rowid).append(resspectemplate.replace(/__1/g, '_' + rowid));
                    // $('#resspec-template_' + rowid).find('> tbody.main').append(resspectemplate.replace(/__/g, '_' + rowid));
                }

            }
            /////
            $('#subMaintd_' + rowid).hide();
            calcTotal();
            rateChange('#rate_' + rowid);
            TermsAutoRefresh();
        });
    }

    rowid += 1;
    $tbody.append(template.replace(/__/g, '_' + rowid));
    $rowid.val(rowid);
    $('#seqTotal').show();
    $('#subMaintd_' + rowid).hide();
    bindResourceAutocomplete();
    //terms &condition end
    var $trowid = $('#trowid');
    var template = $('#terms-template').html();
    var trowid = 0;
    var $tbody = $('#termsTable').find('> tbody');

    if(arr_edit_terms.length != 0) {

        $.each(arr_edit_terms, function(i, o) {
            trowid += 1;
            $tbody.append(termstemplate.replace(/__/g, '_' + trowid));
            $('#slno_' + trowid).val(o.SlNo).addClass('border-none').prop('disabled', true);
            $('#termsid_' + trowid).val(o.data);
            $('#terms_' + trowid).val(o.value);
            $('#per_' + trowid).val(o.Per);
            $('#value_' + trowid).val(o.Val);
            $('#period_' + trowid).val(o.Period);
            $('#date_' + trowid).val(o.Dte);
            $('#string_' + trowid).val(o.Strg);
            $('#isper_' + trowid).val(o.IsPer);
            $('#isvalue_' + trowid).val(o.IsValue);
            $('#isperiod_' + trowid).val(o.IsPeriod);
            $('#istdate_' + trowid).val(o.IsTDate);
            $('#iststring_' + trowid).val(o.IsTString);
            $('#includegross_' + trowid).val(o.IncludeGross);
            $('#termsdeleteTr_' + trowid).show();
        });
    }
    trowid += 1;
    $tbody.append(template.replace(/__/g, '_' + trowid));
    $trowid.val(trowid);


    $('.content_wrapper').on('click', '.mainTr', function (e) {
        e.preventDefault();
        if (!$(this).closest("tr").next(".subTr").is(":visible")) {
            $(this).closest("tr").prevAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").prevAll(".subTr").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").nextAll(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");

            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        } else {
            if($(this).closest("tr").next(".subTr").find(".subDiv").is(":visible") == false) {
                $(this).closest("tr").next(".subTr").show();
                $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
                $(this).find("i").addClass("tform");
            }
            else {
                $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".subTr").slideUp("slow");
                $(this).find("i").removeClass("tform");
            }
        }
    });
    nextAccordian(1);
    calcTotal();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        $('#workorderTable').paging({limit: 2});
    }
});
$( document ).ready(function() {
//    if('<?php //echo (isset($approve)) ? $approve : '';?>//' == 'Yes')
//    {
//        $('#sub1').hide();
//    }
//    else if('<?php //echo (isset($approve)) ? $approve : '';?>//' == 'Partial')
//    {
//        $('#sub1').hide();
//    }
//    else{
//        $('#sub1').show();
//    }
    if(<?php echo (isset($poRegId)) ? $poRegId : 0;?> > 0) {
        $("#currency").trigger("change");
    }

});
function submitForm() {
    var selVen = $('#vendor').val();
    $('#VendorId').val(selVen);
    if(errorflag1 == 1){
        alert("Please Enter PO Date Greater than Required Date");
        return false;
    }
    if(errorflag2 == 1){
        alert("Please Enter Required Date Less than PO Date");
        return false;
    }
    if( errorFlag3 == 1){
        alert('Kindly Notice the Error Notifications');
        return false;
    }
    if( errorFlag4 == 1){
        alert('Kindly Notice the Error Notifications');
        return false;
    }
    if ($('#vendor').val() == 0 || '') {
        $('#vendor').focus();
        alert("Select valid vendor");
        //$('#purchase_type').parent().find('.error_message').show();
        return false;
    }

    if ($('#purchase_type').val() == '' || 0) {
        $('#purchase_type').focus();
        alert("Select valid purchase type");
        //$('#purchase_type').parent().find('.error_message').show();
        return false;
    }

    else if ($('#account_type').val() == '' || 0 ) {
        $('#account_type').focus();
        alert("Select valid account type");
        //$('#account_type').parent().find('.error_message').show();
        return false;
    }

    else if($('#currency').val() == '') {
        $('#currency').focus();
        alert("Select valid currency");
        //$('#currency').parent().find('.error_message').show();
        return false;
    }
    else{
        $('.error_message').hide();
    }
    $('.error_message').hide();
    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 7){
        alert('Add Resource');
        return false;
    }
    var rowCountqty= parseInt($('#rowid').val()-1);
    for(var i=1;i<=rowCountqty;i++) {
        if ($('#qty_' + i).val() == "" || $('#qty_' + i).val() == 0) {
            alert('Kindly enter the values or delete the unwanted resource');
            return false;
        }
    }

    for(var i=1;i<=rowCountqty;i++) {
        if ($('#rate_' + i).val() == "" || $('#rate_' + i).val() == 0) {
            alert('Zero Rate Exists!');
            return false;
        }
    }

    for(var i=1;i<=rowCountqty;i++) {
        if ($('#qrate_' + i).val() < 0) {
            alert('Cannot accept negative values in qualified rate!');
            return false;
        }
    }

    var rowCount= parseInt($('#trowid').val()-1);
    for(var i=1;i<=rowCount;i++) {
        var termsname = $('#terms_'+ i).val();
        if ($('#istdate_'+ i).val() == 1) {
            if ($('#date_'+ i).val() == 0 || '') {
                alert('Kindly enter the date in Terms And Conditions ('+ termsname +')');
                nextAccordian(2);
                return false;
            }
        }
        if ($('#isper_'+ i).val() == 1) {
            if ($('#per_'+ i).val() == 0 || '') {
                alert('Kindly enter the percentage(%) in Terms And Conditions ('+ termsname +')');
                nextAccordian(2);
                return false;
            }
        }
        if ($('#isvalue_'+ i).val() == 1) {
            if ($('#value_'+ i).val() == 0 || '') {
                alert('Kindly enter the value in Terms And Conditions ('+ termsname +')');
                nextAccordian(2);
                return false;
            }
        }
        if ($('#isperiod_'+ i).val() == 1) {
            if ($('#period_'+ i).val() == 0 || '') {
                alert('Kindly enter the period in Terms And Conditions ('+ termsname +')');
                nextAccordian(2);
                return false;
            }
        }
        if ($('#iststring_'+ i).val() == 1) {
            if ($('#string_'+ i).val() == '') {
                alert('Kindly enter the description in Terms And Conditions ('+ termsname +')');
                nextAccordian(2);
                return false;
            }
        }
    }
    $('#valuefrom').attr("disabled", false);
    $('#formWrapper').submit();
}
function validateResource(){
    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 7){
        alert('Add Resource');
        return false;
    } else {
        nextAccordian(2,1);
    }

}
function validateTerms(){
    var rowCount= parseInt($('#trowid').val()-1);
    for(var i=1;i<=rowCount;i++) {
        var termsname = $('#terms_'+ i).val();
        if ($('#istdate_'+ i).val() == 1) {
            if ($('#date_'+ i).val() == 0 || '') {
                alert('Kindly enter the date in Terms And Conditions ('+ termsname +')');
                return false;
            }
        }
        if ($('#isper_'+ i).val() == 1) {
            if ($('#per_'+ i).val() == 0 || '') {
                alert('Kindly enter the percentage(%) in Terms And Conditions ('+ termsname +')');
                return false;
            }
        }
        if ($('#isvalue_'+ i).val() == 1) {
            if ($('#value_'+ i).val() == 0 || '') {
                alert('Kindly enter the value in Terms And Conditions ('+ termsname +')');
                return false;
            }
        }
        if ($('#isperiod_'+ i).val() == 1) {
            if ($('#period_'+ i).val() == 0 || '') {
                alert('Kindly enter the period in Terms And Conditions ('+ termsname +')');
                return false;
            }
        }
        if ($('#iststring_'+ i).val() == 1) {
            if ($('#string_'+ i).val() == '') {
                alert('Kindly enter the description in Terms And Conditions ('+ termsname +')');
                return false;
            }
        }
    }
    nextAccordian(3,2);
}
function validateLength($input) {
    if($.trim($input.val()).length == 0) {
        showError($input, 'required');
        return false;
    }

    removeError($input);
    return true;
}

function bindTermsAutocomplete() {
    // bind resource autocomplete
    $('#termsTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_terms,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {
            if (suggestion) {
                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                $this.prop('readonly', true).addClass('border-none');
                $('#termsid_' + rowid).val(suggestion.data);
                $('#slno_' + rowid).val(suggestion.SlNo).attr("readonly",true);
                $('#terms_' + rowid).val(suggestion.value);
                $('#per_' + rowid).val(sanitizeNumber(suggestion.Per,2,true));
                $('#value_' + rowid).val(sanitizeNumber(suggestion.Val,2,true));
                $('#period_' + rowid).val(sanitizeNumber(suggestion.Period,1,true));
            //    $('#date_' + rowid).val(suggestion.Dte);
                $('#string_' + rowid).val(suggestion.Strg);
                $('#isper_' + rowid).val(suggestion.IsPer);
                $('#isvalue_' + rowid).val(suggestion.IsValue);
                $('#isperiod_' + rowid).val(suggestion.IsPeriod);
                $('#istdate_' + rowid).val(suggestion.IsTDate);
                $('#iststring_' + rowid).val(suggestion.IsTString);
                $('#includegross_' + rowid).val(suggestion.IncludeGross);
                $('#termsdeleteTr_' + rowid).show();
                if(parseInt($('#isper_' + rowid).val())==0){$('#per_' + rowid).attr("readonly",true);}
                if(parseInt($('#isvalue_' + rowid).val())==0) {$('#value_' + rowid).attr("readonly",true);}
                if(parseInt($('#isperiod_' + rowid).val())==0) {$('#period_' + rowid).attr("readonly",true);}
                if(parseInt($('#istdate_' + rowid).val())==0) {$('#date_' + rowid).attr("readonly",true);}
                if(parseInt($('#iststring_' + rowid).val())==0) {$('#string_' + rowid).attr("readonly",true);}
                addNewTermsRow($this);
            }
        }, onSearchStart: function (suggestion) {
            //var rowid = $(this)[0].id.split('_')[1];
            ////$('#terms_' + rowid).val('');
        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                // var rowid = $(this)[0].id.split('_')[1];
                // $('#terms_' + rowid).val('');
            }
        }
    });
}

//function bindResourceDecisionTrans(x) {
//    var rowid = $(x)[0].id.split('_')[1];
//    //var $iowrowid = $('#iow_' + rowid + '_rowid');
//    //var descId = $('#iow_' + rowid + '_decisionid_' + iowrowid).val();
//    //var iowrowid = parseInt($('#iow_'+rowid+'_rowid').val()) + 1;
//    var resid=$('#resourceid_'+rowid).val();
//    var itemid=$('#itemid_'+rowid).val();
//    var data = {};
//    var ccid=<?php //echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>//;
//
//
//    data.Type='getNewDecisionTrans';
//    data.ResourceId=resid;
//    data.ItemId=itemid;
//    data.CostCentreId=ccid;
//    $('.loading_area').show();
//    $.ajax({
//        url: getBaseURL() + 'mms/purchase/order-entry',
//        type: "post",
//        data: data,
//        async: false,
//        success: function (data, textStatus, jqXHR) {
//            if(jqXHR.status == 200) {
//                data = JSON.parse(data);
//                var iowtemplate = $('#iow-template').html();
//                var resspectemplate=$('#resspec-template').html();
//                $.each(data, function (i,l) {
//                    var iowrowid = parseInt($('#iow_'+rowid+'_rowid').val()) + 1;
//                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
//                    $('#iow_'+rowid+'_rowid').val(iowrowid);
//                    $('#iow_'+ rowid +'_decisionid_'+ iowrowid).val(l.DecisionId);
//                    $('#iow_'+ rowid +'_dectransid_'+ iowrowid).val(l.DecTransId);
//                    $('#iow_'+ rowid +'_reqtransid_'+ iowrowid).val(l.ReqTransId);
//                    $('#iow_'+ rowid +'_resourceid_'+ iowrowid).val(l.ResourceId);
//                    $('#iow_'+ rowid +'_itemid_'+ iowrowid).val(l.ItemId);
//                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
//                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
//                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
//                    bindResourceDecisionAnalTrans(x);
//
//                });
//            }
//            $('.loading_area').hide();
//        }, error: function (jqXHR, textStatus, errorThrown) {
//            $('.loading_area').hide();
//        }
//    });
//
//}

function bindResourceDecisionTrans(x) {
    var rowid = $(x)[0].id.split('_')[1];
    //var $iowrowid = $('#iow_' + rowid + '_rowid');
    //var descId = $('#iow_' + rowid + '_decisionid_' + iowrowid).val();
    //var iowrowid = parseInt($('#iow_'+rowid+'_rowid').val()) + 1;
    var resid=$('#resourceid_'+rowid).val();
    var itemid=$('#itemid_'+rowid).val();

    var ccid=$('#CostCenterId').val();


    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/purchase/order-entry',
        type: "post",
        data: "CostCentreId=" + ccid +"&Type=wbs&ResourceId=" + resid +"&ItemId=" + itemid ,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);
                if((data.dec).length != 0) {
                    var iowtemplate = $('#iow-template').html();
                    var resspectemplate = $('#resspec-template').html();
                    $.each(data.dec, function (i, l) {
                        var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                        $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                        $('#wbsTable_'+rowid).hide();
                        $('#decisionTable_'+rowid).show();
                        $('#decisionTabLink_'+rowid).show();
                        $('#wbsTabLink_'+rowid).hide();
                        $('#iow_' + rowid + '_rowid').val(iowrowid);
                        $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
                        $('#iow_' + rowid + '_dectransid_' + iowrowid).val(l.DecTransId);
                        $('#iow_' + rowid + '_reqtransid_' + iowrowid).val(l.ReqTransId);
                        $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                        $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                        $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
                        $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(l.BalQty,3,true));
                        $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                        bindResourceDecisionAnalTrans(x);

                        if(qualList.length > 0) {
                            $('#qualifierTabLink_' + rowid).show();
                        }
                        else {
                            $('#qualifierTabLink_' + rowid).hide();
                        }
                    });
                }
                else
                {
                    if((data.wbs).length != 0)
                    {
                        var wbstemplate =  $('#wbs-template').html();

                        $.each(data.wbs, function (i, l) {

                            var findRes = arr_wbs.filter(function(obj) {
                                return (obj.ResourceId === resid && obj.WBSId === l.WBSId);
                            });
                            if(findRes.length > 0) {
                                var iowrowid = parseInt($('#wbs_' + rowid + '_rowid').val()) + 1;
                                $('#wbsTable_' + rowid).find('> tbody.main').append(wbstemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                                $('#wbsTable_' + rowid).show();
                                $('#decisionTable_' + rowid).hide();
                                $('#decisionTabLink_' + rowid).hide();
                                $('#wbsTabLink_' + rowid).show();
                                $('#wbs_' + rowid + '_rowid').val(iowrowid);
                                $('#wbs_' + rowid + '_wbsid_' + iowrowid).val(l.WBSId);
                                $('#wbs_' + rowid + '_wbsname_' + iowrowid).val(l.WbsName);
                                $('#wbs_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));

                                var findwEst = data.estwbs.filter(function (obj) {
                                    return (obj.ResourceId === resid && obj.WBSId === l.WBSId);
                                });
                                if(findwEst.length > 0)
                                {
                                    $.each(data.estwbs, function (i, p) {
                                        if(resid == p.ResourceId && l.WBSId == p.WBSId)
                                        {
//                                            $('#wbs_' + rowid + '_estwbsdetails_' + iowrowid).hide();
//                                            $('#wbs_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                            $('#wbs_' + rowid + '_estwbsqty_' + iowrowid).text(p.EstimateQty);
                                            $('#wbs_' + rowid + '_avawbsqty_' + iowrowid).text(p.AvailableQty);
                                            $('#wbs_' + rowid + '_excesswbsqty_' + iowrowid).text(p.ExcessQty);
                                            $('#wbs_' + rowid + '_balreqwbsqty_' + iowrowid).text(p.BalReqQty);
                                            $('#wbs_' + rowid + '_balpowbsqty_' + iowrowid).text(p.BalPOQty);
                                            $('#wbs_' + rowid + '_totpurchasewbsqty_' + iowrowid).text(p.TotPurchase);
                                            $('#wbs_' + rowid + '_isprojwbsqty_' + iowrowid).text(p.IsProj);
                                        }
                                    });
                                }
                                else {
//                                    $('#wbs_' + rowid + '_estwbsdetails_' + iowrowid).hide();
//                                    $('#wbs_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                }
                                $('#liWbs_' + rowid).addClass('active');
                            }
                            else
                            {
//                                $('#wbs_' + rowid + '_estwbsdetails_' + iowrowid).hide();
//                                $('#wbs_' + rowid + '_estwbsarrow_' + iowrowid).hide();
                                $('#wbsTabLink_' + rowid).hide();
                                $('#decisionTabLink_' + rowid).hide();
                                $('#wbsTable_' + rowid).hide();
                                $('#decisionTable_' + rowid).hide();
                                if(qualList.length > 0) {
                                    $('#qualifierTabLink_' + rowid).show();
                                    $('#qualifierTable_' + rowid).show();
                                    $('#liQual_' + rowid).addClass('active');
                                }
                                else {
                                    $('#qualifierTabLink_' + rowid).hide();
                                    $('#qualifierTable_' + rowid).hide();
                                    $('#reqspeTabLink_' + rowid).show();
                                    $('#reqspeTable_' + rowid).show();
                                    $('#liResSpec_' + rowid).addClass('active');

                                }
                            }
                        });
                        if(qualList.length > 0) {
                            $('#qualifierTabLink_' + rowid).show();
                        }
                        else {
                            $('#qualifierTabLink_' + rowid).hide();
                        }
                    }
                    else
                    {
                        $('#wbsTabLink_' + rowid).hide();
                        $('#decisionTabLink_' + rowid).hide();
                        $('#wbsTable_' + rowid).hide();
                        $('#decisionTable_' + rowid).hide();
                        if(qualList.length > 0) {
                            $('#qualifierTabLink_' + rowid).show();
                            $('#qualifierTable_' + rowid).show();
                            $('#liQual_' + rowid).addClass('active');
                        }
                        else {
                            $('#qualifierTabLink_' + rowid).hide();
                            $('#qualifierTable_' + rowid).hide();
                        }
                    }
                }
            }
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {

            $('.loading_area').hide();
        }
    });

}


function bindResourceDecisionAnalTrans(x) {
    var rowid = $(x)[0].id.split('_')[1];
    var iowrowid = $('#iow_' + rowid + '_rowid').val();
    var decid=$('#iow_' + rowid + '_decisionid_' + iowrowid).val();
    var dectransid=$('#iow_' + rowid + '_dectransid_' + iowrowid).val();
    var CcId = <?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>;
    var data = {};
    data.Type='getNewDecAnalTrans';
    data.DecisionId=decid;
    data.DecTransId=dectransid;
    data.CostCentre=CcId;
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/purchase/order-entry',
        type: "post",
        data: data,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);
                var requesttemplate = $('#request-template').html();
                if(data.anal.length > 0) {
                    $.each(data.anal, function (i, l) {
                        $('#iow_' + rowid + '_qty_' + iowrowid).addClass('border-none').prop('readonly', true);
                        $('.iow_' + rowid + '_requestfields').show();
                        var requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                        $('#iow_' + rowid + '_request_' + iowrowid + '_reqno').find('> tbody.main').append(requesttemplate
                            .replace(/__9/g, '_' + requestrowid)
                            .replace(/_0/g, '_' + iowrowid)
                            .replace(/__/g, '_' + rowid));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);

                        $('#iow_' + rowid + '_request_' + iowrowid + '_wbsname_' + requestrowid).val(l.WBSName);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val(l.WBSId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_dectransid_' + requestrowid).val(l.DecTransId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_decatransid_' + requestrowid).val(l.DecATransId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_reqtransid_' + requestrowid).val(l.ReqTransId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_reqahtransid_' + requestrowid).val(l.ReqAHTransId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_resourceid_' + requestrowid).val(l.ResourceId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_itemid_' + requestrowid).val(l.ItemId);
                        $('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber(l.BalQty,3,true));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val(sanitizeNumber(l.Qty,3,true));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_hiddenqty_' + requestrowid).val(sanitizeNumber(0));
                        $('#iow_' + rowid + '_request_' + iowrowid + '_expandWbs_' + requestrowid).show();

                        //Wbs Estimate
                        var findestwbs = data.estwbs.filter(function(obj)
                            {
                                return (obj.ResourceId === l.ResourceId && obj.WBSId === l.WBSId);
                            }
                        );

                        if(findestwbs.length > 0) {
                            $.each(data.estwbs, function (s, n) {
                                if (l.ResourceId == n.ResourceId && l.WBSId == n.WBSId) {
//                                    $('#iow_' + rowid + '_request_' + iowrowid + '_reqahtransid_' + requestrowid).val(l.ReqAHTransId);
//                                    $('#iow_' + rowid + '_request_' + iowrowid +  '_estwbsdetails_' + requestrowid).hide();
//                                    $('#iow_' + rowid + '_request_' + iowrowid + '_estwbsarrow_' + requestrowid).hide();
                                    $('#iow_' + rowid + '_request_'+ iowrowid + '_estwbsqty_' + requestrowid).text(n.EstimateQty);
                                    $('#iow_' + rowid + '_request_'+ iowrowid + '_avawbsqty_' + requestrowid).text(n.AvailableQty);
                                    $('#iow_' + rowid + '_request_' + iowrowid + '_excesswbsqty_' + requestrowid).text(n.ExcessQty);
                                    $('#iow_' + rowid + '_request_' + iowrowid + '_balpowbsqty_' + requestrowid).text(n.BalPOQty);
                                    $('#iow_' + rowid + '_request_' + iowrowid + '_totpurchasewbsqty_' + requestrowid).text(n.TotPurchase);
                                    $('#iow_' + rowid + '_request_' + iowrowid + '_isprojwbsqty_' + requestrowid).text(n.IsProj);
                                }
                            });
                        }
                        else
                        {
//                            $('#iow_' + rowid + '_request_' + iowrowid +  '_estwbsdetails_' + requestrowid).hide();
//                            $('#iow_' + rowid + '_request_' + iowrowid + '_estwbsarrow_' + requestrowid).hide();
                        }
                        //
                    });
                }
                else
                {
                    $('#iow_'+ rowid +'_request_'+ iowrowid +'_decWbs').hide();
                    $('#iow_'+ rowid +'_request_'+ iowrowid +'_reqno').hide();
                    $('#iow_'+ rowid +'_expandSubTr_'+iowrowid).hide();
                }
            }
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }
    });
}

function addNewTermsRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $trowid = $('#trowid'),
        trowid = parseInt($trowid.val()),
        $tbody = $('#termsTable').find('> tbody.main');

    $('#deleteTr_' + trowid).show();
    var count = trowid + 1,
        template = $('#terms-template').html();

    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);

    $trowid.val(count);
    var tCount =  $('#termsTable tbody tr').length;
    if(tCount > 1){
        $('#valuefrom').attr("disabled", true);
    }
    else {
        $('#valuefrom').attr("disabled", false);
    }
    bindTermsAutocomplete();
}

function deleteRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    $tr.next('.subTr').remove();
    $tr.remove();
    var rId = $('#rowid').val();
    rId--;
    if(rId == 1){
        document.getElementById("vendor").disabled = false;
    }
    $('#rowid').val(rId);
    calcTotal();
    bindTermsAutocomplete();
    TermsAutoRefresh();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        thisVal._getNavBar($('#workorderTable').find('> tbody.seq-class >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
    return false;
}

function deleteMainRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    var rowid = $(x)[0].id.split('_')[1];
    var dcQty = $('#dcqty_' + rowid).val();
    if(dcQty > 0) {
        alert('Already Used. Do Not Delete');
        return false;
    }
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    $tr.next('.subTr').remove();
    $tr.remove();
    var rId = $('#rowid').val();
    rId--;
    if(rId == 1){
        document.getElementById("vendor").disabled = false;
    }
    $('#rowid').val(rId);
    calcTotal();
    bindTermsAutocomplete();
    TermsAutoRefresh();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        thisVal._getNavBar($('#workorderTable').find('> tbody.seq-class >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }
    return false;
}

function checkTermsUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var termkeyid = $('input[id*=termsid_]');
    tmp_arr_terms = arr_terms;
    tmp_arr_terms = $.grep(arr_terms, function (element, index) {
        var is_selected = true;
        $.each(termkeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindTermsAutocomplete();
}
function nextAccordian(id,s) {
    if(id==2 && s==1){
        $(".collapseTwo").attr('id','collapseTwo');
    } else if(id==3 && s==2){
        $(".collapseThree").attr('id','collapseThree');
    }
    $('#panelheading-' + id).trigger('click');
}
function calcQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var name=ids[0];
    if(name == 'iow') {
        var totalQty = 0;
        var decqty = 0;
        var balqty = 0;
        var decqty = parseFloatVal($('input[id^=iow_'+ rowid +'_qty_'+ iowrowid).val());
        var balqty = parseFloatVal($('input[id^=iow_'+ rowid +'_balqty_'+ iowrowid).val());
        var hidQty = parseFloatVal($('input[id^=iow_'+ rowid +'_hiddenqty_'+ iowrowid).val());
      

        if(balqty < (decqty-hidQty)){
            alert('PO Qty should not exceed balance quantity');
            $('input[id^=iow_'+ rowid +'_qty_'+ iowrowid).val(0000);
            $('input[id^=qty_' + rowid).val(0000);
        }
        else{
            // calc total qty
            $.each($('input[id^=iow_' + rowid + '_qty_'), function (i, o) {
                var qty = parseFloatVal($(this).val());
                if (isNaN(qty))
                    qty = 0;

                totalQty += qty;
            });

            totalQty = sanitizeNumber(totalQty,3,true);
            $('#qty_' + rowid).val(parseFloatVal(totalQty, 0));


            //dcqty validation
            var dcqty = parseFloatVal($('#dcqty_' + rowid).val(),0);
            if(dcqty > 0) {
                if(totalQty < dcqty) {
                    alert('Current Quantity Cannot be Less than MIN/Bill Quantity - MIN/Bill Qty: ' + sanitizeNumber(dcqty,3,true));
                    $('#qty_'+rowid).val(hidQty);
                    return false;
                }
            }
            //

            // calc total amount
            var rate = parseFloatVal($('#rate_' + rowid).val());
            var qrate = parseFloatVal($('#qrate_' + rowid).val());

            $('#amount_' + rowid).val(sanitizeNumber(totalQty * qrate,2,true));
            $('#baseamount_' + rowid).val(sanitizeNumber(totalQty * rate,2,true));
            calcTotal();
            var vname = '#qualifierTable_' + rowid;
            CalculateRate(vname);
            TermsAutoRefresh();
        }
    }
}
function calcResQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name = ids[0];
    if (name == 'qty') {
        // calc total qty
        var totalQty = 0;
        var hiddenqty=0;
        var rfrom = $('#rfrom_'+rowid).val();

        totalQty = parseFloatVal($('#qty_' + rowid).val(),0);
        hiddenqty = parseFloatVal($('#hiddenqty_' + rowid).val(),0);
        dcqty = parseFloatVal($('#dcqty_' + rowid).val(),0);

        if(dcqty > 0) {
            if(totalQty < dcqty) {
                alert('Current Quantity Cannot be Less than MIN/Bill Quantity - MIN/Bill Qty: ' + sanitizeNumber(dcqty,3,true));
                $('#qty_'+rowid).val(0);
                return false;
            }
        }
        //EstimateQty Validation
        var eststr = $('#estqty_' + rowid).text();
        var eststr = $('#estqty_' + rowid).text().split(':');
        var estqty = eststr[1];
        if(estqty == 'undefined' || estqty == null) { estqty=0; }
        var bpoqty = $('#balpoqty_' + rowid).text();
        var totpurchase= $('#totpurchase_' + rowid).text();
        var totqty = parseFloat(bpoqty) + parseFloat(totpurchase);
        if(isNaN(totqty)){totqty=0;}
        if(totqty+parseFloat(totalQty-hiddenqty)>estqty && rfrom == 'Project') {

            alert('Purchase quantity is greater than estimate qty');
            $('#qty_'+rowid).val(0);
            return false;
        }
        //
        // calc total amount
        var rate = parseFloatVal($('#rate_' + rowid).val());
        var qrate = parseFloatVal($('#qrate_' + rowid).val());
        console.log(rate,qrate);

        $('#amount_' + rowid).val(sanitizeNumber(totalQty * qrate,2,true));
        $('#baseamount_' + rowid).val(sanitizeNumber(totalQty * rate,2,true));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
        TermsAutoRefresh();
    }
}
function isqtyDecimal(evt, x) {

    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (evt.key =="%") charCode=0;
    if (evt.key =="#") charCode=0;
    if (
        (charCode != 46 || $(element).val().indexOf('.') != -1) &&      // �.� CHECK DOT, AND ONLY ONE.
        (charCode < 48 || charCode > 57) && charCode!=39 && charCode!=37 && charCode!=8 && charCode!=35 && charCode!=9)
        return false;

    var rowid = $(x)[0].id.split('_')[1];

    var iowrowid=0;
    var dWbs = parseInt($('#wbs_' + rowid + '_rowid').val());
    var reqDec = parseInt($('#iow_'+ rowid +'_rowid').val());

    if(dWbs > 0 || reqDec > 0){
        $('#qty_' + rowid).attr('readonly',true);
    } else {
        $('#qty_' + rowid).attr('readonly',false);
    }
    return true;
}
function estwbsclick(x)
{
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];
    //tooltip show
   var estqty = $('#iow_' + rowid + '_request_' + iowrowid + '_estwbsqty_' + requestrowid).text();
   var avaqty = $('#iow_' + rowid + '_request_' + iowrowid + '_avawbsqty_' + requestrowid).text();
   var excessqty = $('#iow_' + rowid + '_request_' + iowrowid + '_excesswbsqty_' + requestrowid).text();
    console.log(estqty,avaqty,excessqty);
    //"1st line text" +"\n" + "2nd line text";
    $(x).attr('data-original-title',"Estimate Qty : " + estqty + "</br>" + "Available Qty : " + avaqty + "</br> " + "Excess Qty : " + excessqty  );
    $(x).data('html',true);
    $(x).tooltip('show');
    //

}

function calcRequestQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];
    var rfrom = $('#rfrom_'+rowid).val();

    var balqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val());
    var curqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val());
    var hiddenqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_hiddenqty_' + requestrowid).val());

    if((curqty-hiddenqty)>balqty)
    {
        alert('PO Qty should not exceed balance quantity');
        $('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val(0);
    }

    // calc total qty
    var totalQty=0;
    $.each($('input[id^=iow_'+rowid+'_request_'+iowrowid+'_qty_'), function (i,o) {
        var qty = parseFloatVal($(this).val());
        if(isNaN(qty))
            qty = 0;

        totalQty += qty;
    });
    totalQty = sanitizeNumber(totalQty,3,true);
    if(totalQty > $('#iow_'+rowid+'_request_'+iowrowid+'_estimateqty').val() && rfrom == 'Project') {
        showError($x, 'Purchase order quantity is greater than estimate quantity!');
        return;
    } else {
        removeError($x);
    }
//        $('#iow_'+rowid+'_request_'+iowrowid+'_totbilledqty').val(sanitizeNumber(totalQty,0));
    $('#iow_'+rowid+'_qty_'+iowrowid).val(sanitizeNumber(parseFloatVal(totalQty,0),3,true)).trigger('change');
}
function estwbsclick1(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name=ids[0];
    var iowrowid=ids[3];
    //tooltip show
    var estqty = "";
    var avaqty = "";
    var excessqty = "";

    estqty = $('#wbs_' +rowid+ '_estwbsqty_' + iowrowid).text();
    avaqty = $('#wbs_' +rowid+ '_avawbsqty_' + iowrowid).text();
    excessqty =$('#wbs_' +rowid+ '_excesswbsqty_' + iowrowid).text();
    //"1st line text" +"\n" + "2nd line text";
    $(x).attr('data-original-title',"Estimate Qty : " + sanitizeNumber(estqty,3,true) + "<br />" + "Available Qty : " + sanitizeNumber(avaqty,3,true) + "<br /> " + "Excess Qty : " + sanitizeNumber(excessqty,3,true) );
    $(x).tooltip('show');
    //

}
function calcWbsQuantity(x) {

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name=ids[0];
    var iowrowid=ids[3];

    if(name == 'wbs') {
        //Estimate Qty Validation
        var totalQty = 0;
        var hiddenqty=0;
        var rfrom = $('#rfrom_'+rowid).val();

        totalQty = parseFloatVal($('#wbs_'+rowid+'_qty_' + iowrowid).val(),0);

        hiddenqty = parseFloatVal($('#wbs_' + rowid+'_hiddenqty_' + iowrowid).val(),0);
        //EstimateQty Validation
        var estqty = $('#wbs_' +rowid+ '_estwbsqty_' + iowrowid).text();
        if(estqty == 'undefined' || estqty == null) { estqty=0; }
        var bpoqty = $('#wbs_' + rowid + '_balpowbsqty_' + iowrowid).text();
        var totpurchase= $('#wbs_' + rowid + '_totpurchasewbsqty_' + iowrowid).text();
        var totqty = parseFloat(bpoqty) + parseFloat(totpurchase);
        if(isNaN(totqty)){totqty=0;}

        if(totqty+parseFloat(totalQty-hiddenqty)>estqty && rfrom == 'Project')
        {
            alert('Purchase quantity is greater than estimate qty');
            $('#wbs_' + rowid + '_qty_'+iowrowid).val(0);
            return false;
        }

        //
        // calc total qty
        var totalQty = 0;
        $.each($('input[id^=wbs_' + rowid + '_qty_'), function (i, o) {
            var qty = parseFloatVal($(this).val());
            if (isNaN(qty))
                qty = 0;

            totalQty += qty;
        });
        totalQty = sanitizeNumber(totalQty,3,true);
        $('#qty_' + rowid).val(parseFloatVal(totalQty, 0));

        // calc total amount
        var rate = parseFloatVal($('#rate_' + rowid).val());
        var qrate = parseFloatVal($('#qrate_' + rowid).val());


        $('#amount_' + rowid).val(sanitizeNumber(totalQty * qrate,2,true));
        $('#baseamount_' + rowid).val(sanitizeNumber(totalQty * rate,2,true));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
        TermsAutoRefresh();
    }
}

function calcTotal() {
    var total = 0;
    var btotal = 0;

    $.each($('input[id^=amount_]'), function (i,o) {
        total += parseFloatVal($(this).val());
    });

    $.each($('input[id^=baseamount_]'), function (i,o) {
        btotal += parseFloatVal($(this).val());
    });

    //Terms Calctotal
    var iKey = 0;
    var dCurVal = 0.0;
    var dFAmt=0.0;
    var sInclGross=0;
    $.each($('input[id^=includegross_]'), function (i,o) {
        iKey = iKey + 1;
        sInclGross = $(this).val();
        if(sInclGross == 1)
        {
            dCurVal = parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            dFAmt += (parseFloat(isNullCheck(dCurVal,'number')));
        }
    });
    var gtype = $('#gridtype').val();

    $('#total').val(sanitizeNumber(total,2,true));
    $('#basetotal').val(sanitizeNumber(btotal,2,true));
    $('#nettotal').val(sanitizeNumber(total+dFAmt,2,true));

    //Base Currency Net Amount
    var fCShort = $("#currency option:selected").text();
    var fCName = fCShort.match(/\(([^()]+)\)/g);
    fCName = ("" + fCName).replace(/[{()}]/g, '');
    var dCurrName = $("#dCurrName").val();
    dCurrName = ("" + dCurrName).replace(/[{()}]/g, '');
    if(dCurrName != fCName) {
        var nTot = 0;
        nTot = parseFloatVal($('#nettotal').val());
        var eAmount = sanitizeNumber(nTot*parseFloatVal($("#exchangeRate").val()),3,true);

        $("#bCurrencyNet").val(eAmount);
    }
    else {
        $("#bCurrencyNet").val(0);
    }
    //
    var tCount =  $('#termsTable tbody tr').length;

    if(tCount > 1){
        $('#valuefrom').attr("disabled", true);
    }
    else
    {
        $('#valuefrom').attr("disabled", false);
    }

}

function addNewTermRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#termrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteTermTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#otherterms-template').html();

    template = template.replace(/__/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);


}

function deleteTerm(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    $tr.remove();
    return false;
}

function bindResourceAutocomplete() {

    // bind resource autocomplete
    $('#workorderTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_resources,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {

            if (suggestion) {
                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                var reskeyid = $('input[id*=resourceid_] ') ;
                var bRet=false;
                $.each(reskeyid, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != rowid) {
                        if ($this.val() == suggestion.data && $('#itemid_' + key1).val() == suggestion.ItemId) {
                            bRet = true;
                        }
                    }
                });
                if(bRet == false) {
                    $this.prop('readonly', true).addClass('border-none');
                    $('#desc_' + rowid).val(suggestion.value).addClass('border-none').prop('disabled', true);
                    $('#resourceid_' + rowid).val(suggestion.data);
                    $('#itemid_' + rowid).val(suggestion.ItemId);
                    $('#unitname_' + rowid).val(suggestion.UnitName);
                    $('#unitid_' + rowid).val(suggestion.UnitId);
                    $('#rate_' + rowid).val(suggestion.Rate);
                    $('#qrate_' + rowid).val(suggestion.Rate);
                    $('#rfrom_' + rowid).val(suggestion.RFrom);
                    $('#expandTr_' + rowid).show();
                    $('#deleteTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#expandRt_' + rowid).show();

                    bindResourceDecisionTrans($this);
                    //bindResourceDecisionAnalTrans($this);
                    addNewResourceRow($this,suggestion.data);
                } else {
                    alert('Already added in list');
                    $('#desc_' + rowid).val('');
                    return;
                }

            }
        }, onSearchStart: function (suggestion) {
            var rowid = $(this)[0].id.split('_')[1];
            $('#unitname_' + rowid).val('');
            $('#rate_' + rowid).val('');
        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                var rowid = $(this)[0].id.split('_')[1];
                $('#unitname_' + rowid).val('');
                $('#rate_' + rowid).val('');
            }
        }
    });
}
function addNewResourceRow(x,v) {

    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val()),
        $tbody = $('#workorderTable').find('> tbody.seq-class');

    $('#deleteTr_' + rowid).show();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        $('#subMaintd_' + rowid).hide();
    }
    var count = rowid + 1,
        template = $('#resource-template').html();
    var resspectemplate=$('#resspec-template').html();
    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        $('#subMaintd_' + count).hide();
    }
    document.getElementById("vendor").disabled = true;
    var ccid=<?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>;

    $.ajax({
        type: "POST",
        url: getBaseURL()+'mms/purchase/order-entry',
        data: "ccid="+ccid+"&resid="+v+"&Type=getresestdetails",
        dataType: "json",
        success: function(data){
            if(Object.keys(data).length > 0) {
                if(data["EstimateQty"] > 0 || data["EstimateQty"] < 0) {
                    $('#estqty_' + rowid).text('Estimate Qty: ' + sanitizeNumber(data["EstimateQty"],3,true));
                }
                else
                {
                    $('#estqty_' + rowid).text('Estimate Qty: 0');
                }
                if(data["EstimateRate"] > 0 || data["EstimateRate"] < 0) {
                    $('#estrate_' + rowid).text('Estimate Rate: ' + sanitizeNumber(data["EstimateRate"],3,true));
                }
                else
                {
                    $('#estrate_' + rowid).text('Estimate Rate: 0');
                }
                if(data["AvailableQty"] > 0 || data["AvailableQty"] < 0) {
                    $('#avaqty_' + rowid).text('Available Qty: ' + sanitizeNumber(data["AvailableQty"],3,true));
                }
                else
                {
                    $('#avaqty_' + rowid).text('Available Qty: 0');
                }
                if(data["BalPOQty"] > 0 || data["BalPOQty"] < 0) {
                    $('#balpoqty_' + rowid).text(data["BalPOQty"]);
                }
                else
                {
                    $('#balpoqty_' + rowid).text(0);
                }
                if(data["TotPurchase"] > 0 || data["TotPurchase"] < 0) {
                    $('#totpurchase_' + rowid).text(data["TotPurchase"]);
                }
                else
                {
                    $('#totpurchase_' + rowid).text(0);
                }
            }
            else
            {
                $('#estqty_' + rowid).text('Estimate Qty: ');
                $('#estrate_' + rowid).text('Estimate Rate: ');
                $('#avaqty_' + rowid).text('Available Qty: ');
                $('#balpoqty_' + rowid).text(0);
                $('#totpurchase_' + rowid).text(0);
            }
        }

    });

//       $.each(arr_estdetails,function(s,k){
//            if(v == k.ResourceId)
//            {
//                $('#estqty_' + rowid).val('Estimate Qty: '+ k.EstimateQty);
//                $('#estrate_' + rowid).val('Estimate Rate: '+ k.EstimateRate);
//                $('#avaqty_' + rowid).val('Available Qty: '+ k.AvailableQty);
//            }
//        } );
    $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
    $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
    $rowid.val(count);
    bindResourceAutocomplete();
    if('<?php echo (isset($gridtype)) ? $gridtype : '';?>' == 0) {
        var f = parseInt($(".paging-nav").find('.selected-page').html()) - 1;
        thisVal._getNavBar($('#workorderTable').find('> tbody.seq-class >tr'));
        setTimeout(function () {
            $('.paging-nav').children('a[data-page=' + f + ']').trigger('click');
        }, 100);
    }

}
function checkResourceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=resourceid_] ') ;
    var itemkeyid=$('input[id*=itemid_]');

    tmp_arr_resources = arr_resources;
    tmp_arr_resources = $.grep(arr_resources, function (element, index) {

        var is_selected = true;
        $.each(reskeyid, function (i, obj) {

            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];

            if (key1 != id) {
                if (element.data == $this.val() && itemkeyid[0].value == element.ItemId) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindResourceAutocomplete();
}
function checkAlreadyUsedItem(x) {
    var id = $(x)[0].id.split('_')[1];
    var resid = $('#resourceid_' + id).val();
    var itemid=$('#itemid_' + id).val();
    var reskeyid = $('input[id*=resourceid_] ') ;

    var bRet=false;
    $.each(reskeyid, function (i, obj) {

        var $this = $(this),
            name = $this[0].id;
        var arrname = name.split('_');
        var key1 = arrname[1];

        if (key1 != id ) {
            if ($this.val() == resid && $('#itemid_' + key1).val() == itemid) {
                bRet = true;
                return;
            }
        }
    });
    return bRet;
}

function selAccount(){
    var ptypeId = $('#purchase_type').val();
    if(ptypeId == ''){
        return false;
    } else {
        $("#account_type").html('');
        $("#account_type").append("<option value=''>Select Account Type</option>");
        $.ajax({
            type: "POST",
            url: getBaseURL()+'mms/purchase/order-entry',
            data: "ptypeId="+ptypeId+"&Type=selectAccount",
            dataType: "json",
            success: function(data){
                $.each(data['resultAcc'], function(i,v){
                    $("#account_type").append("<option value='"+v.data+"' selected>"+v.value+"</option>");
                });
                $("#account_type").trigger("change");
                //  $("#account_type").select2('refresh');
            }

        });
    }
}

$('#currency').change(function() {
    var fCShort = $("#currency option:selected").text();
    var fCName = fCShort.match(/\(([^()]+)\)/g);
    fCName = ("" + fCName).replace(/[{()}]/g, '');
    var dCurrName = $("#dCurrName").val();
    dCurrName = ("" + dCurrName).replace(/[{()}]/g, '');
    if(dCurrName === fCName) {
        $("#fCurrName").val('');
        $('#exchangeRate').val(0);
        $("#dNetLbl").hide();
        $("#bCurrencyNet").hide();
        $("#eRatelbl").hide();
        $("#exchangeRate").hide();
        $("#ex").hide();
    }
    else {
        $("#dNetLbl").show();
        $("#bCurrencyNet").show();
        $("#eRatelbl").show();
        $("#ex").show();
        $("#exchangeRate").show();
        $("#fCurrName").val(fCName);
        var vamt = <?php
                        echo calculateCurrency('USD','INR',1);
                  ?>;
        $('#exchangeRate').val(vamt);
        alert(vamt);
    }
    calcTotal();
});
//$('#purchase_type').change(function() {
//    $("#account_type").select2('val', '');
//    var ptypeId = $(this).val();
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/purchase/order-entry',
//        data: "ptypeId="+ptypeId+"&Type=selectAccount",
//        dataType: "json",
//        success: function(data){
//            $("#account_type").html('');
//            $("#account_type").append("<option value='0'>Select Account Type</option>");
//            $.each(data['resultAcc'], function(i,v){
//                $("#account_type").append("<option value='"+v.data+"'>"+v.value+"</option>");
//            });
//            $("#account_type").select2('refresh');
//        }
//
//    });
//});
$( document ).ready(function() {
    var pId=<?php echo (isset($poRegId)) ? $poRegId:0; ?>;
    if(pId == 0) {
        selAccount();
    }
});
$('#branchname').change(function() {
    var branchid = $(this).val();
console.log(branchid);
    $.ajax({
        type: "POST",
        url: getBaseURL()+'mms/purchase/order-entry',
        data: "branchid="+branchid+"&Type=selectBranchContact",
        dataType: "json",
        success: function(data,textStatus,jqXHR){
            if(jqXHR.status == 200) {
                console.log(data);
                $('#branchcontactno').val(data['ContactNo']);
            }
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('#branchcontactno').val('');
        }
    });

    $.ajax({
        type: "POST",
        url: getBaseURL()+'mms/purchase/order-entry',
        data: "branchid="+branchid+"&Type=selectBranchCPerson",
        dataType: "json",
        success: function(data,textStatus,jqXHR){
            if(jqXHR.status == 200) {
                $("#cperson").html('');
                $("#cperson").append("<option value='0'>None</option>");
                $.each(data, function(i,v){
                    $("#cperson").append("<option value='"+v.data+"'>"+v.value+"</option>");
                });
                $("#cperson").selectpicker('refresh');
                $("#cperson").trigger('change');
            }
        }, error: function (jqXHR, textStatus, errorThrown) {

        }
    });
    if(branchid == 0) {
        $('#branchcontactno').val('');
        $('#cperson').val('');
        $('#cpersonno').val('');
        $('#cperson').trigger('change');

    }

});
$('#cperson').change(function() {
    var branchtransid=$(this).val();
    console.log(branchtransid);

    if(branchtransid == 0) {
        $('#cpersonno').val('');
    }
    $.ajax({
        type: "POST",
        url: getBaseURL()+'mms/purchase/order-entry',
        data: "branchtransid="+branchtransid+"&Type=selectCPersonno",
        dataType: "json",
        success: function(data,textStatus,jqXHR){
            if(jqXHR.status == 200) {
                $('#cpersonno').val(data['cpersonno']);
            }
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('#cpersonno').val('');
        }
    });
});
$('#warehouse').change(function() {
    var whtransid=$(this).val();
    if(whtransid == 0)
    {
        $('#whaddress').val('');
    }
    $.ajax({
        type: "POST",
        url: getBaseURL()+'mms/purchase/order-entry',
        data: "whtransid="+whtransid+"&Type=selectWHAddress",
        dataType: "json",
        success: function(data,textStatus,jqXHR){
            if(jqXHR.status == 200) {
                $('#whaddress').val(data['whaddress']);
            }
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('#whaddress').val('');
        }
    });
});
function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];
    if (type=="decision") {
        $('#decisionTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();

    } else if (type=="qualifier") {
        $('#qualifierTable_'+rowid).show();
        $('#decisionTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();
    }
    else if (type=="wbs") {
        $('#wbsTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#decisionTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
    }
    else
    {
        $('#reqspeTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#decisionTable_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();
    }
    return false;
}

function showotherstabs(type) {
    if (type=="narration") {
        $('#narration').show();
        $('#branchdetails').hide();
        $('#deliverydetails').hide();
        $('#vendorcontact').hide();
        $('#cccontact').hide();
        $('#ccontact').hide();
		$('#distributor').hide();
    }
    else if(type == "branch"){
        $('#branchdetails').show();
        $('#narration').hide();
        $('#deliverydetails').hide();
        $('#vendorcontact').hide();
        $('#cccontact').hide();
        $('#ccontact').hide();
		$('#distributor').hide();
    }
    else if(type == "delivery")
    {
        $('#deliverydetails').show();
        $('#branchdetails').hide();
        $('#narration').hide();
        $('#vendorcontact').hide();
        $('#cccontact').hide();
        $('#ccontact').hide();
		$('#distributor').hide();
    }
    else if(type == "vcontact")
    {
        $('#vendorcontact').show();
        $('#deliverydetails').hide();
        $('#branchdetails').hide();
        $('#narration').hide();
        $('#cccontact').hide();
        $('#ccontact').hide();
		$('#distributor').hide();
    }
    else if(type == "cccontact")
    {
        $('#cccontact').show();
        $('#vendorcontact').hide();
        $('#deliverydetails').hide();
        $('#branchdetails').hide();
        $('#narration').hide();
        $('#ccontact').hide();
		$('#distributor').hide();
    }
    else if(type == "ccontact")
    {
        $('#ccontact').show();
        $('#vendorcontact').hide();
        $('#deliverydetails').hide();
        $('#branchdetails').hide();
        $('#narration').hide();
        $('#cccontact').hide();
		$('#distributor').hide();
    }
	else if(type == "distributor")
    {
        $('#distributor').show();
        $('#ccontact').hide();
        $('#vendorcontact').hide();
        $('#deliverydetails').hide();
        $('#branchdetails').hide();
        $('#narration').hide();
        $('#cccontact').hide();
    }

}

function rateChange(x)
{
    var iFocusRowId= x.split("_")[1];
    var bRate=parseFloatVal($('#rate_' + iFocusRowId).val());
    var bQty=parseFloatVal($('#qty_' + iFocusRowId).val());
    $('#qrate_' + iFocusRowId).val(parseFloatVal($('#rate_' + iFocusRowId).val()));
    $('#baseamount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    var vname = '#qualifierTable_' + iFocusRowId;
    CalculateRate(vname);
    TermsAutoRefresh();
}

function CalculateRate(x) {

    var iFocusRowId=x.split("_")[1],
        name = '#desc_' + iFocusRowId,
        iRows = $('#rowid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sQualName = "Qual";
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');


    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }


//    var dTAmt = 0;
//    var dTWasteAmt =0;
//    for (i = 1; i <= iRows; i++) {
//        if ($(name + '_inc_' + i).is(':checked') == true) {
//            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
//                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
//            dTAmt = dTAmt + val;
//            dTWasteAmt = dTWasteAmt + wasteval;
//        }
//    }

//    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
//    dTAmt =  dTAmt + dTWasteAmt;
//    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));
    var qty=$('#qty_'+iFocusRowId).val();
    var dbaseAmt=$('#baseamount_'+iFocusRowId).val();

    var dQAmt =  CalculateQualifier(dbaseAmt,iFocusRowId,sQualName);

    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt),2,true));
    $('#qrate_' + iFocusRowId).val(sanitizeNumber((parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt))/parseFloatVal(qty)),2,true);
    calcTotal();
    TermsAutoRefresh();

}

function CalculateQualifier(baseValue, key1,sQualName) {
    var sQName = sQualName + '_';
    var rows = $('#' + sQualName +  'RowId_' + key1).val();
    var sformula="";
    var dbaseAmt=parseFloatVal(isNullCheck(baseValue,'number'));
    var dTotalQualAmt=0;

    for (i = 1; i <= rows; i++) {
        var sRef = $('#' + sQName + key1 + '_Ref_' + i).val().trim();
        var sFormula = isNullCheck($('#' + sQName + key1 + '_Exp_'+ i).val(),'string');
        var dPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_ExpPer_'+ i).val(),'number'));
        var sbaseRef = 'R0';
        if (parseFloatVal(dPer) ==0) dPer=100;
        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
        for (j = 1; j <= rows; j++) {
            var sFRef = $('#' + sQName + key1 + '_Ref_' + j).val().trim();
            var dFamt = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_Amount_'+ j).val(),'number'));
            sFormula = sFormula.replace(new RegExp(sFRef, 'g'), dFamt);
        }
        var fvaule = computeEval(sFormula);
        $('#' + sQName + key1 + '_ExpValue_' + i).val(numberFormat(fvaule,'C'));

        var iQualTypeid = $('#' + sQName + key1 + '_TypeId_' + i).val();

        if (iQualTypeid==1 || iQualTypeid==2) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(),'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(),'number'));
            var dCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_CessPer_' + i).val(),'number'));
            var dEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_EduCessPer_' + i).val(),'number'));
            var dHEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_HEduCessPer_' + i).val(),'number'));
            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(numberFormat(dNetPer,'C'));
            $('#' + sQName + key1 + '_ExpPer_'+ i).val(numberFormat(dNetPer,'C'));

            var dTaxableAmt =  fvaule* (dTaxablePer/100);
            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
            var dCessAmt =  dTaxAmt* (dCess/100);
            var dEDAmt =  dTaxAmt* (dEDCess/100);
            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;

            $('#' + sQName + key1 + '_TaxableAmt_'+ i).val(numberFormat(dTaxableAmt,'C'));
            $('#' + sQName + key1 + '_TaxPerAmt_'+ i).val(numberFormat(dTaxAmt,'C'));
            $('#' + sQName + key1 + '_CessAmt_'+ i).val(numberFormat(dCessAmt,'C'));
            $('#' + sQName + key1 + '_EduCessAmt_'+ i).val(numberFormat(dEDAmt,'C'));
            $('#' + sQName + key1 + '_HEduCessAmt_'+ i).val(numberFormat(dHEDAmt,'C'));
            $('#' + sQName + key1 + '_NetAmt_'+ i).val(numberFormat(dNetAmt,'C'));

            dAmt = dNetAmt;
        } else {

            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
        }

        $('#' + sQName + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
        if ($('#' + sQName + key1 + '_YesNo_' + i).is(':checked') == true) {
            var sSign = isNullCheck($('#' + sQName + key1 + '_Sign_' + i).val(),'string');
            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
        }
    }

    $('#'+ sQualName + 'TotalAmt_' + key1).val(numberFormat(dTotalQualAmt,'C'));
    return dTotalQualAmt;
    //qualTotal();
}

function bindTaxCalculation() {
    var $mainTr = $(".qualChange");
    $mainTr.change(function (e) {
        CalculateTax($(this)[0].id);
    });
}

function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateQualifier($this[0].id);
}




function CalculateTax(id) {
    //if (bReady==false) return;
    var sname= id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#rateanal_' + key1;
    if (sname == "QualR")  name = '#rateanalR_' + key1;

    CalculateRate(name);

    //var sname = $('#QualRowRef_' + key1).val();
    ///var dbaseAmt= parseFloat($('#' + sname).val());

//    CalculateQualifier(dbaseAmt,key1);
//
//    var dTaxAmt = parseFloat(isNullCheck($('#QualTotalAmt_' + key1).val(),'number'));
//
//    var k1 = sname.split('_')[1],
//        k2 = sname.split('_')[3];
//
//    $('#BillAbs_' + k1 + '_TaxAmt_' + k2).val(dTaxAmt);
//    $('#BillAbs_' + k1 + '_NetAmt_' + k2).val(dTaxAmt+dbaseAmt);
//
//    calcTotal();
}

//function CalculateQualifier(baseValue,key1,sQualName) {
//    var sQName = sQualName + '_';
//    var rows = $('#' + sQualName + 'RowId_' + key1).val();
//    var sformula = "";
//    var dbase
//    var iFocusRowId=x.split("_")[1],
//        name = '#qualifierTable_' + iFocusRowId,
//        sQualName = "Qual";
//    var dbaseAmt=$('#baseamount_'+iFocusRowId).val();
//    var rows=$('#QualRowId_'+iFocusRowId).val();
//    var key1=iFocusRowId;
//    var dTotalQualAmt=0;
//    var sname = $('#QualRowRef_' + iFocusRowId).val();
//
//    for (i = 1; i <= rows; i++) {
//        var sRef = $('#Qual_' + key1 + '_Ref_' + i).val().trim();
//        var sFormula = $('#Qual_' + key1 + '_Exp_'+ i).val();
//
//        var dPer = isNullCheck($('#Qual_' + key1 + '_ExpPer_'+ i).val(),'number');
//        var sbaseRef = 'R0';
//        if (parseFloatVal(dPer) ==0) dPer=100;
//        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
//
//        var fvaule = computeEval(sFormula);
//        $('#Qual_' + key1 + '_ExpValue_' + i).val(numberFormat(fvaule,'C'));
//
//        var iQualTypeid = $('#Qual_' + key1 + '_TypeId_' + i).val();
//        if (iQualTypeid==1 || iQualTypeid==2) {
//            var dTaxablePer = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_TaxablePer_' + i).val(),'number'));
//            var dTaxPer = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_TaxPer_' + i).val(),'number'));
//            var dCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_CessPer_' + i).val(),'number'));
//            var dEDCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_EduCessPer_' + i).val(),'number'));
//            var dHEDCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_HEduCessPer_' + i).val(),'number'));
//            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
//            $('#Qual_' + key1 + '_NetPer_' + i).val(dNetPer);
//
//            $('#Qual_' + key1 + '_NetPer_' + i).val(numberFormat(dNetPer,'C'));
//            $('#Qual_' + key1 + '_ExpPer_'+ i).val(numberFormat(dNetPer,'C'));
//
//            var dTaxableAmt =  fvaule* (dTaxablePer/100);
//            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
//            var dCessAmt =  dTaxAmt* (dCess/100);
//            var dEDAmt =  dTaxAmt* (dEDCess/100);
//            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
//            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;
//
//            $('#Qual_' + key1 + '_TaxableAmt_'+ i).val(numberFormat(dTaxableAmt,'C'));
//            $('#Qual_' + key1 + '_TaxPerAmt_'+ i).val(numberFormat(dTaxAmt,'C'));
//            $('#Qual_' + key1 + '_CessAmt_'+ i).val(numberFormat(dCessAmt,'C'));
//            $('#Qual_' + key1 + '_EduCessAmt_'+ i).val(numberFormat(dEDAmt,'C'));
//            $('#Qual_' + key1 + '_HEduCessAmt_'+ i).val(numberFormat(dHEDAmt,'C'));
//            $('#Qual_' + key1 + '_NetAmt_'+ i).val(numberFormat(dNetAmt,'C'));
//
//            dAmt = dNetAmt;
//        } else {
//            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
//        }
////        $('#Qual_' + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
////        if ($('#Qual_' + key1 + '_YesNo_' + i).is(':checked') == true) dTotalQualAmt = dTotalQualAmt+ parseFloatVal(dAmt);
////        for (j = i; j <= rows; j++) {
////            var sFormula = $('#Qual_' + key1 + '_Exp_'+ i).val();
////            sFormula = sFormula.replace(new RegExp(sRef, 'g'), dAmt);
////        }
//        $('#Qual_' + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
//        if ($('#Qual_' + key1 + '_YesNo_' + i).is(':checked') == true) {
//            var sSign = isNullCheck( $('#Qual_' + key1 + '_Sign_' + i).val(),'string');
//            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
//            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
//        }
//    }
//    $('#QualTotalAmt_' + key1).val(numberFormat(dTotalQualAmt,'C')).trigger('change');
//    bindQualTot_onChange();
//
////    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');
////
////    if (sname.substr(sname.length-1) ==  "R") {
////        name = '#rateanalR_' + iFocusRowId;
////        iRows = $('#rowinfoidR_' + iFocusRowId).val();
////        sQualName = "QualR";
////    }
////
////    var dTAmt = 0;
////    var dTWasteAmt =0;
////    for (i = 1; i <= iRows; i++) {
////
////        if ($(name + '_inc_' + i).is(':checked') == true) {
////            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
////                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
////            dTAmt = dTAmt + val;
////            dTWasteAmt = dTWasteAmt + wasteval;
////        }
////    }
////
////    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
////    dTAmt =  dTAmt + dTWasteAmt;
////    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));
////
////    var dQAmt =  CalculateQualifier(dTAmt,iFocusRowId,sQualName);
////    $(name + '_totqualrate').val(sanitizeNumber(dQAmt,2,true));
////
////    var dQualAmt =  parseFloatVal(isNullCheck($(name + '_totqualrate').val(),'number'));
////    var dTotRate = dTAmt+ dQualAmt;
////    $(name + '_totrate').val(sanitizeNumber(dTotRate,2,true));
////
////    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
////    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
////    var dNetRate = dTotRate/dAnalQty;
////
////    $(name + '_totnetrate').val(sanitizeNumber(dNetRate,2,true));
////
////    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
////    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);
////
////    var dFRate=0;
////    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
////    else {
////        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
////        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_totnetrate').val(),'number'));
////        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
////    }
////    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
//}

function bindQualTot_onChange() {
    $paymentScheduleWrapper.on('change', '[id^="QualTotalAmt_"]', function() {
        var $tarReceiptTr = $(this).closest('.qualmainTr').prev('tr');

        $tarReceiptTr.find('.sch-tax').val($(this).val());

        calcReceiptTotal($tarReceiptTr.closest('tbody'));
    });
}
function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateTax($this[0].id);
}
function computeEval(formula) {
    with (document.forms){
        with (Math) {
            A = eval((formula));
        }
    } return A;
}
function CalculateTax(id) {
    var sname= id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#qualifierTable_' + key1;
    if (sname == "QualR")  name = '#qualifierTable_' + key1;
    CalculateRate(name);
}

function TermsAutoRefresh() {
    var valueFrom=$('#valuefrom').val();
    var ggtype =$('#gridtype').val();
    var netAmt=0.0;
    if(valueFrom == 'BaseAmount'){

            netAmt = parseFloat(isNullCheck($('#basetotal').val(),'number'));

    } else if(valueFrom == 'NetAmount'){

            netAmt=parseFloat(isNullCheck($('#total').val(),'number'));

    } else {

            netAmt=parseFloat(isNullCheck($('#basetotal').val(),'number'));

    }
    var iKey=0;
    var dFAmt=0.0;
    var sTerms='';

    $.each($('input[id^=terms_]'), function (i,o) {
        var kVal = o.id;
        var kVal1= kVal.split('_');
        iKey = kVal1[1];

        sTerms = $(this).val();

        if((sTerms == 'Advance' || sTerms == 'Against Delivery' || sTerms == "Against Work" || sTerms == "Against Bill" || sTerms == "Against Certification") && iKey>0)
        {
            dCurPer = parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));

            if(parseFloat(isNullCheck(netAmt,'number'))>0 && parseFloat(isNullCheck(dCurPer,'number')) > 0)
            {
                dFAmt = (parseFloat(isNullCheck(dCurPer,'number')) / 100) * parseFloat(isNullCheck(netAmt,'number'));
            }
            $('#value_'+iKey).val(sanitizeNumber(dFAmt,3,true));
        }

    });


    var tCount =  $('#termsTable tbody tr').length;

    if(tCount > 1){
        $('#valuefrom').attr("disabled", true);
    }
    else
    {
        $('#valuefrom').attr("disabled", false);
    }
    calcTotal();
}

function TermsCalculation(x) {
    var valueFrom=$('#valuefrom').val();
    var g2type =$('#gridtype').val();
    var sname= x.split('_')[0],
        key= x.split('_')[1];
    var netAmt=0.0;
    if(valueFrom == 'BaseAmount'){
            netAmt = parseFloat(isNullCheck($('#basetotal').val(),'number'));
    } else if(valueFrom == 'NetAmount'){

            netAmt=parseFloat(isNullCheck($('#total').val(),'number'));

    } else {

            netAmt=parseFloat(isNullCheck($('#basetotal').val(),'number'));

    }

    var sTerms=$('#terms_'+key).val();

    var eTerms="";
    var dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer=0.0;
    var dAdvVal,dADelVal,dAWorkVal,dABillVal,dACerVal=0.0;
    var iKey=0;
    $.each($('input[id^=terms_]'), function (i,o) {
        $this=$(this);
        //iKey = iKey + 1;
        iKey = $this[0].id.split('_')[1];
        eTerms = $(this).val();

        //iKey = $this[0].id.split('_')[1];
        if(eTerms == 'Advance'){
            dAdvPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
            dAdvVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
        }
        if(eTerms == 'Against Delivery'){
            dADelPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
            dADelVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
        }
        if(eTerms == 'Against Work'){
            dAWorkPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
            dAWorkVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
        }
        if(eTerms == 'Against Bill'){
            dABillPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
            dABillVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
        }
        if(eTerms == 'Against Certification'){
            dACerPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
            dACerVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
        }
    });
    if(sTerms == 'Advance' && sname == 'per' || sTerms == 'Against Delivery' && sname == 'per' || sTerms == "Against Work" && sname == 'per' || sTerms == "Against Bill" && sname == 'per' || sTerms == "Against Certification" && sname == 'per')
    {
        if(sTerms == 'Advance' && sname == 'per')
        {
            dCurPer = dAdvPer;
        }
        else if(sTerms == 'Against Delivery' && sname == 'per')
        {
            dCurPer = dADelPer;
        }
        else if(sTerms == 'Against Work' && sname == 'per')
        {
            dCurPer = dAWorkPer;
        }
        else if(sTerms == 'Against Bill' && sname == 'per')
        {
            dCurPer = dABillPer;
        }
        else if(sTerms == 'Against Certification' && sname == 'per')
        {
            dCurPer = dACerPer;
        }

        if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == false)
        {
            PerCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key)
        }
        else
        {
            alert("Enter Valid Amount!");
            $('#per_'+key).val(0);
            $('#value_'+key).val(0);
            return;
        }
    }
    else if(sTerms == 'Advance' && sname == 'value' || sTerms == 'Against Delivery' && sname == 'value' || sTerms == "Against Work" && sname == 'value' || sTerms == "Against Bill" && sname == 'value' || sTerms == "Against Certification" && sname == 'value')
    {
        if(sTerms == 'Advance' && sname == 'value')
        {
            dCurPer = dAdvVal;
        }
        else if(sTerms == 'Against Delivery' && sname == 'value')
        {
            dCurPer = dADelVal;
        }
        else if(sTerms == 'Against Work' && sname == 'value')
        {
            dCurPer = dADelval;
        }
        else if(sTerms == 'Against Bill' && sname == 'value')
        {
            dCurPer = dABillVal;
        }
        else if(sTerms == 'Against Certification' && sname == 'value')
        {
            dCurPer = dACerVal;
        }
        AmtCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key);
        dCurPer = parseFloat(isNullCheck($('#per_'+key).val(),'number'));

        $.each($('input[id^=terms_]'), function (i,o) {
            eTerms = $(this).val();
            if(eTerms == 'Advance'){
                dAdvPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                dAdvVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
            }
            if(eTerms == 'Against Delivery'){
                dADelPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                dADelVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
            }
            if(eTerms = 'Against Work'){
                dAWorkPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                dAWorkVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
            }
            if(eTerms == 'Against Bill'){
                dABillPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                dABillVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
            }
            if(eTerms == 'Against Certification'){
                dACerPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                dACerVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
            }
        });

        if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == true)
        {
            alert("Enter Valid Amount!");
            $('#per_'+key).val(0);
            $('#value_'+key).val(0);
        }
    }
    //alert(dAdvPer);
    calcTotal();
}

function TotAmtValidation(argAdv,argADel,argAWork,argABill,argACer)
{
    var bRet=false;
    var dTot=parseFloat(isNullCheck(argAdv,'number')) + parseFloat(isNullCheck(argADel,'number')) + parseFloat(isNullCheck(argABill,'number')) + parseFloat(isNullCheck(argACer,'number')) + parseFloat(isNullCheck(argAWork,'number'));
    if(dTot > 100)
    {
        bRet = true;
    }
    return bRet;
}
function AmtCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
{
    var Val,TotPer = 0.0;
    TotPer = parseFloat(isNullCheck(argAgaDel,'number')) + parseFloat(isNullCheck(argAgaBill,'number')) + parseFloat(isNullCheck(argAgaCer,'number')) + parseFloat(isNullCheck(argAgaWork,'number'));
    Val = AmountToPer(parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(TotPer,'number')));
    $('#per_'+key).val(sanitizeNumber(Val,3,true));
}
function PerCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
{
    var Val,TotPer=0.0;
    TotPer = parseFloat(isNullCheck(argAgaDel,'number'))+parseFloat(isNullCheck(argAgaBill,'number'))+parseFloat(isNullCheck(argAgaCer,'number'))+parseFloat(isNullCheck(argAgaWork,'number'));
    Val = PerToAmount(parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(TotPer,'number')));
    $('#value_'+key).val(sanitizeNumber(Val,2,true));
}
function PerToAmount(argPer,argAmt,argTotPer)
{
    if(parseFloat(isNullCheck(argAmt,'number'))>0 && parseFloat(isNullCheck(argPer,'number')) > 0)
    {
        argPer = (parseFloat(isNullCheck(argPer,'number')) / 100) * parseFloat(isNullCheck(argAmt,'number'));
    }
    return argPer;
}
function AmountToPer(argAmt,argPer,argTotPer)
{
    if(parseFloat(isNullCheck(argAmt,'number')) > 0 && parseFloat(isNullCheck(argPer,'number')) >0)
    {
        argAmt = ((parseFloat(isNullCheck(argPer,'number')) / parseFloat(isNullCheck(argAmt,'number'))) * 100)
    }
    return argAmt;
}
function stockPODetails(x){

    var rowid = $(x)[0].id.split('_')[1];
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var  mode="getstockdetails";

    $.ajax({
        url: getBaseURL() + 'mms/purchase/orderentry',
        type: "post",
        data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockPOModal").show();
                $("#estimateQty").val(sanitizeNumber(sdata['EstimateQty'],3,true));
                $("#estimateRate").val(sanitizeNumber(sdata['EstimateRate'],2,true));
                $("#availableQty").val(sanitizeNumber(sdata['AvailableQty'],3,true));
                $("#excessQty").val(sanitizeNumber(sdata['ExcessQty'],3,true));
                $("#balancePO").val(sanitizeNumber(sdata['BalPOQty'],3,true));
                $("#transferQty").val(sanitizeNumber(sdata['TransferQty'],3,true));
                $("#requestQty").val(sanitizeNumber(sdata['ReqQty'],3,true));
                $("#poQty").val(sanitizeNumber(sdata['POQty'],3,true));
                $("#minQty").val(sanitizeNumber(sdata['MinQty'],3,true));
                $("#billQty").val(sanitizeNumber(sdata['BillQty'],3,true));
                $("#billreturnQty").val(sanitizeNumber(sdata['ReturnQty'],3,true));
                $("#issueQty").val(sanitizeNumber(sdata['IssueQty'],3,true));
                $("#balrequestQty").val(sanitizeNumber(sdata['BalReqQty'],3,true));
            }
        }

    });
}

function stockWBSDetails(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var WBSId = $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val();

    var  mode="getwbsstockdetails";

    $.ajax({
        url: getBaseURL() + 'mms/purchase/orderentry',
        type: "post",
        data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockWBSModal").show();
                $("#estimateWbsQty").val(sanitizeNumber(sdata['EstimateQty'],3,true));
                $("#estimateWbsRate").val(sanitizeNumber(sdata['EstimateRate'],2,true));
                $("#availableWbsQty").val(sanitizeNumber(sdata['AvailableQty'],3,true));
                $("#excessWbsQty").val(sanitizeNumber(sdata['ExcessQty'],3,true));
                $("#balanceWbsPO").val(sanitizeNumber(sdata['BalPOQty'],3,true));
                $("#totalWbsPurchase").val(sanitizeNumber(sdata['TotPurchase'],3,true));
                $("#poWbsQty").val(sanitizeNumber(sdata['POQty'],3,true));
                $("#minWbsQty").val(sanitizeNumber(sdata['MinQty'],3,true));
                $("#billWbsQty").val(sanitizeNumber(sdata['BillQty'],3,true));
                $("#billreturnWbsQty").val(sanitizeNumber(sdata['TotRetQty'],3,true));
                $("#balrequestWbsQty").val(sanitizeNumber(sdata['BalReqQty'],3,true));
                $("#requestWbsQty").val(sanitizeNumber(sdata['ReqQty'],3,true));
            }
        }
    });
}

function stockOWBSDetails(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#CostCenterId').val();
    var WBSId =  $('#wbs_' + rowid + '_wbsid_' + iowrowid).val();
    var  mode="getwbsstockdetails";

    $.ajax({
        url: getBaseURL() + 'mms/purchase/orderentry',
        type: "post",
        data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockWBSModal").show();
                $("#estimateWbsQty").val(sanitizeNumber(sdata['EstimateQty'],3,true));
                $("#estimateWbsRate").val(sanitizeNumber(sdata['EstimateRate'],2,true));
                $("#availableWbsQty").val(sanitizeNumber(sdata['AvailableQty'],3,true));
                $("#excessWbsQty").val(sanitizeNumber(sdata['ExcessQty'],3,true));
                $("#balanceWbsPO").val(sanitizeNumber(sdata['BalPOQty'],3,true));
                $("#totalWbsPurchase").val(sanitizeNumber(sdata['TotPurchase'],3,true));
                $("#poWbsQty").val(sanitizeNumber(sdata['POQty'],3,true));
                $("#minWbsQty").val(sanitizeNumber(sdata['MinQty'],3,true));
                $("#billWbsQty").val(sanitizeNumber(sdata['BillQty'],3,true));
                $("#billreturnWbsQty").val(sanitizeNumber(sdata['TotRetQty'],3,true));
                $("#balrequestWbsQty").val(sanitizeNumber(sdata['BalReqQty'],3,true));
                $("#requestWbsQty").val(sanitizeNumber(sdata['ReqQty'],3,true));
            }
        }

    });
}

function prerateDetails(x){
    var rowid = $(x)[0].id.split('_')[1];
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = <?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>;
    var  mode="getpreORate";
    var venid='<?php echo (isset($vendor)) ? $vendor['VendorId'] : '0' ?>';
    if(venid == 0){
        venid = $('#vendor').val();
    }
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/purchase/orderentry',
        type: "post",
        data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&ResourceId=" + resourceid + "&ItemId=" + itemid + "&VendorId=" + venid,
        datatype: "json",
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {

                data = JSON.parse(data);
                //Over All
                var source =
                {
                    dataFields: [
                        { name: 'Date', type: 'string' },
                        { name: 'PONo', type: 'string' },
                        { name: 'CostCentre', type: 'string' },
                        { name: 'Vendor', type: 'string' },
                        { name: 'Company', type: 'string' },
                        { name: 'Rate', type: 'number' }

                    ],
                    localdata:data.orate,
                    id: 'Id',
                    datatype: "json",
                    async: false

                };

                var orate = new $.jqx.dataAdapter(source);

                // creage jqxgrid
                $("#orateGrid").jqxGrid({
                    width: '100%',
                    autoheight:true,
                    source: orate,
                    sortable: true,
                    filterable: true,
                    pageable: true,
                    autorowheight: true,
                    ready: function () {
                        //$("#subGrid").jqxGrid('showrowdetails', 1);
                    },
                    columns: [

                        { text: 'Date', dataField: 'Date',width: '12%'},
                        { text: 'PONo', dataField: 'PONo',width: '15%' },
                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
                        { text: 'Company', dataField: 'Company',width: '20%' },
                        { text: 'Rate', dataField: 'Rate',width: '15%' }
                    ]
                });

                //
                //Company
                var source1 =
                {
                    dataFields: [
                        { name: 'Date', type: 'string' },
                        { name: 'PONo', type: 'string' },
                        { name: 'CostCentre', type: 'string' },
                        { name: 'Vendor', type: 'string' },
                        { name: 'Company', type: 'string' },
                        { name: 'Rate', type: 'number' }

                    ],
                    localdata:data.comprate,
                    id: 'Id',
                    datatype: "json",
                    async: false

                };

                var comprate = new $.jqx.dataAdapter(source1);

                // creage jqxgrid
                $("#comprateGrid").jqxGrid({
                    width: '100%',
                    autoheight:true,
                    source: comprate,
                    sortable: true,
                    filterable: true,
                    pageable: true,
                    autorowheight: true,
                    ready: function () {
                    },
                    columns: [

                        { text: 'Date', dataField: 'Date',width: '12%'},
                        { text: 'PONo', dataField: 'PONo',width: '15%' },
                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
                        { text: 'Company', dataField: 'Company',width: '20%' },
                        { text: 'Rate', dataField: 'Rate',width: '15%' }
                    ]
                });
                //
                //CostCentre
                var source2 =
                {
                    dataFields: [
                        { name: 'Date', type: 'string' },
                        { name: 'PONo', type: 'string' },
                        { name: 'CostCentre', type: 'string' },
                        { name: 'Vendor', type: 'string' },
                        { name: 'Company', type: 'string' },
                        { name: 'Rate', type: 'number' }

                    ],
                    localdata:data.ccrate,
                    id: 'Id',
                    datatype: "json",
                    async: false

                };

                var ccrate = new $.jqx.dataAdapter(source2);

                // creage jqxgrid
                $("#ccrateGrid").jqxGrid({
                    width: '100%',
                    autoheight:true,
                    source: ccrate,
                    sortable: true,
                    filterable: true,
                    pageable: true,
                    autorowheight: true,
                    ready: function () {
                    },
                    columns: [

                        { text: 'Date', dataField: 'Date',width: '12%'},
                        { text: 'PONo', dataField: 'PONo',width: '15%' },
                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
                        { text: 'Company', dataField: 'Company',width: '20%' },
                        { text: 'Rate', dataField: 'Rate',width: '15%' }
                    ]
                });

            }
            $('.loading_area').hide();
        }

    });
}

function checkEstWbs(x)
{
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowid = ids[3];
    var reqid = ids[5];

    //iow_1_request_1_wbsname_1
    //iow_1_request_1_wbsname_1  iow_1_request_1_rowid
    var trowid = $('#iow_'+rowid+'_request_'+iowid+'_rowid').val();

    for(var i=0; i<=trowid; i++) {
        if(i != reqid)
        {
            $('#iow_' + rowid + '_request_'+ iowid +'_estwbsarrow_' + i).hide();
            $('#iow_' + rowid + '_request_'+ iowid +'_estwbsdetails_' + i).hide();
        }
    }
    $('#iow_' + rowid + '_request_'+ iowid +'_estwbsarrow_' + reqid).show();
    $('#iow_' + rowid + '_request_'+ iowid +'_estwbsdetails_' + reqid).show();

}

function checkEstWbs1(x)
{

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid= ids[1];
    var iowid = ids[3];

    var trowid = $('#wbs_'+rowid+'_rowid').val();
    for(var i=0; i<=trowid; i++)
    {
        if(i != iowid)
        {
            $('#wbs_' + rowid + '_estwbsarrow_'+ i).hide();
            $('#wbs_' + rowid + '_estwbsdetails_'+ i).hide();
        }
    }

    $('#wbs_' + rowid + '_estwbsarrow_'+ iowid).show();
    $('#wbs_' + rowid + '_estwbsdetails_'+ iowid).show();

}
function deliveryDateValidate(x) {

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var cDate = $('#PODate').val();
    var dDate = $('#deldate_'+rowid).val();
    if(dDate < cDate) {
        alert("Delivery date should not be less than Order date");
        $('#deldate_'+rowid).val($('#PODate').val());
        return false;
    }

}

$(".special").keydown(function (e) {
    var key = e.which || e.keyCode;
    if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
            // numbers
        key >= 48 && key <= 57 ||
            // Numeric keypad
        key == 46 || key == 45){
        return false;
    }
    else{
        return true;
    }

});

errorflag1 = 0;

$("#PODate").change(function(){
    var podate = $("#PODate").val();
    var refdate = $("#RefDate").val();
    if(podate < refdate ) {
        alert("Please Enter PO Date Greater than Required Date");
        errorflag1 = 1;
        return false;
    }
    else{
        errorflag1 = 0;
        return true;
    }
});

errorflag2 = 0;
$("#RefDate").change(function(){
    var podate = $("#PODate").val();
    var refdate = $("#RefDate").val();
    if(refdate > podate ){
        alert("Please Enter Required Date Less than PO Date");
        errorflag2 = 1;
        return false;
    }
    else{
        errorflag2 = 0;
        return true;
    }
});
$('textarea').focus(function(){
    $(this).removeAttr('placeholder');
});

//$('#vendor').on('change', function () {
//    if(!confirm('Do you want to Change the Vendor?')){
//        return false;
//    } else {
//        console.log(123);
//
//        //$('#workorderTable').html('');
//        location.replace("<?php //echo $this->basePath(); ?>///mms/purchase/order-entry");
//        $('#vendor').val($(this));
//    }
//
//});
//

errorFlag3 = 0;
function mailCheck(x){
    var id = $(x).val();
    var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!regex.test(id)){
        showError($('#ccemail'), "Please Enter Valid EmailAddress  ");
        errorFlag3 = 1;
        return false;
    }
    else{
        removeError($('#ccemail'));
        errorFlag3 = 0;
        return true;
    }
}

errorFlag4 = 0;
function mailCheck1(x){
    var id = $(x).val();
    var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!regex.test(id)){
        showError($('#cemail'), "Please Enter Valid EmailAddress  ");
        errorFlag4 = 1;
        return false;
    }
    else{
        removeError($('#cemail'));
        errorFlag4 = 0;
        return true;
    }
}
$('.datepickerinput').datepicker({
    format: "dd/mm/yyyy",
    startDate: new Date(),
    todayBtn: true,
    orientation: "top auto",
    autoclose: true
}).on("changeDate", function(e){
    $("#dateSpan").text($(this).val());
});

function getCurValue(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name = ids[0];
    if (name == 'desc') {
        var resname = $('#desc_' + rowid).val();
        $('#desc_' + rowid).attr('title', resname);
    }
}


</script>
<script>
	var menuButton = document.querySelector('.mobile-menu-btn');

	var toggleMobile = function() {
	  menuButton.classList.toggle('open');
	  menu.classList.toggle('visible');
	};

	menuButton.addEventListener('click', toggleMobile);
</script>
