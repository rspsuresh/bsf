<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css'; ?>" />
	
<style type="text/css">
	.mar_20{margin-top:20px!important;}
	.jqx-widget-content {z-index:999 !important;}
	.sub_tbl1 {color:#424141;font-weight: 600; background: #70d3dd !important;border-bottom: 2px solid #9c793b !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl2{color: #424141;font-weight: 600; background: #add160 !important;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .sub_tbl3{color: #424141;font-weight: 600; background: #b8fdd6 !important;border-bottom: 2px solid #18abc4 !important;border-top: 1px solid #ddd !important;white-space: nowrap;}
    .table-responsive table.table tr td { padding: 10px !important;}
	.blubg{background : #B0C3EB !important;}
	.grybg{background : #e7e7e7    !important;}
	.sub_tab {background-color: #e7e9ec;border: 1px solid #ddd;float: left;margin-top: 2px;padding:8px;width:100%;}
	.card{margin-top:0% !important; margin-bottom:0px !important;}
	.top-30 { padding-top:10px!important;}
	.btnPrev:disabled {background-color:#ffffff;}
</style>

<div class="container-fluid">
	<div class="row">
		<input type="hidden" id="gridtype" name="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : 0;?>">
		<div class="col-lg-12 mar_20">
			<h1>Purchase Bill Detail</h1> 
		</div>
		<div class="col-lg-12 top_ct">
			<div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear">
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CostCentreName" >
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status3">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-bandcamp fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CostCentreName; ?></div>
									<div class="cbhuge comnelips">Project Name</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="SupplierName">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-certificate fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $SupplierName; ?></div>
									<div class="cbhuge comnelips">Vendor Name</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="PurchaseTypeName" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $PurchaseTypeName; ?></div>
									<div class="cbhuge comnelips">Purchase Type</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="PurchaseAccount" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $PurchaseAccount; ?></div>
									<div class="cbhuge comnelips">Account Type</div>
								</div>
							</div>
						</div>
					</div>
				</div>


				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="PVDate" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status1">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-retweet fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $PVDate; ?></div>
									<div class="cbhuge comnelips">PV Date</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="BillNo" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status2">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-calendar fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $BillNo; ?></div>
									<div class="cbhuge comnelips">Bill No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres " id="BillDate" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status5">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-registered fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $BillDate; ?></div>
									<div class="cbhuge comnelips">Bill Date</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CurrencyName" >
					<div class="cbpln cbpln-default  bx-wte cbpln-status cbpln-status6">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-money fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CurrencyName; ?></div>
									<div class="cbhuge comnelips">Currency</div>
								</div>
							</div>
						</div>
					</div>
				</div>


				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="PVNo" >
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status7">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-cube fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $PVNo; ?></div>
									<div class="cbhuge comnelips">PV No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CCPVNo">
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status8">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-2">
									<i class="fa fa-share fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-10 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CCPVNo; ?></div>
									<div class="cbhuge comnelips">CCPV No</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="CPVNo" >
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status3">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-2">
									<i class="fa fa-star-half-o fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-10 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $CPVNo; ?></div>
									<div class="cbhuge comnelips">CPV No </div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-3 col-md-6 col-sm-6 col-xs-6 mnimumwidthres" id="Approve" >
					<div class="cbpln cbpln-default bx-wte cbpln-status cbpln-status4">
						<div class="padding-none">
							<div class="row">
								<div class="col-xs-2">
									<i class="fa fa-ticket fa-5x cbpln-status-icon"></i>
								</div>
								<div class="col-xs-10 text-right">
									<div class="cbhuge comnelips fntwt600"><?php echo $Approve; ?></div>
									<div class="cbhuge comnelips">Approve</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="accordion" class="panel-group">
		<!-------------------------------Bill of Quantities------------------------------->
		<div class="panel panel-info">
			<div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
				<h4 class="panel-title accordion-toggle defa_panels">Purchase Quantity</h4>
			</div>
			<div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
				<div class="panel-body bgcolr">
					<div class="col-lg-12">
						<div class="table-responsive top-30">
							<table class="table table-bordered " style=" margin-bottom:10px !important;" id="workorderTable">
								<thead>
								<tr>
									<th class="blubg">Resource</th>
									<th class="blubg">Unit</th>
									<th class="blubg" style="text-align:center">Qty</th>
									<th class="blubg" style="text-align:center">Rate</th>
									<th class="blubg" style="text-align:center">QRate</th>
									<th class="blubg" style="text-align:center">BaseAmount</th>
									<th class="blubg" style="text-align:center">Amount</th>
									<th class="blubg">&nbsp; </th>
								</tr>
								</thead>
								<tbody class="main seqview"></tbody>
							</table>
							<input type="hidden" name="rowid" id="rowid" value="0"/>
						</div>
						
						<!----- sequantial view total --------->
						<div class="col-lg-12 padlr0">
							<table class="table grybg" style=" margin-bottom:10px;" id="seqTotal">
								<tbody class="total">
								<tr>
									<td align="right" class="rate_pri">Base Amount</td>
									<td width="18%">
										<input class="parent_text border-none" style="text-align:right;" type="text" name="basetotal1" id="basetotal1" value="<?php echo (isset($Amount)) ? $Amount : 0; ?> " disabled />
									</td>
									<td align="right" class="rate_pri">Qual Amount</td>
									<td width="18%">
										<input class="parent_text border-none" style="text-align:right;" type="text" name="total1" id="total1" value="<?php echo (isset($BillAmount)) ? $BillAmount : 0; ?> " disabled />
									</td>
									<td align="right" class="rate_pri">Net Amount</td>
									<td width="18%">
										<input class="parent_text border-none" style="text-align:right;" type="text" name="nettotal1" id="nettotal1" value="<?php echo (isset($BillAmount)) ? $BillAmount : 0; ?> " disabled />
									</td>
								</tr>
								</tbody>
							</table>
						</div>
						<!--------- end --------------->
					</div>
				</div>
			</div>
		</div>
		<!-------------------------------Bill of Quantities end------------------------------->
		<!-------------------------------Advance Adjustment Tab ------------------------------->
		<div class="panel panel-info uniAdv">
			<div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
				<h4 class="panel-title accordion-toggle defa_panels">Advance Adjustment</h4>
			</div>
			<div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
				<div class="panel-body bgcolr">
					<div class="col-lg-12">
						<div class="table-responsive top-30">
							<table class="table table-hover table-bordered clear" id="AdvanceTable">
								<thead>
								<tr>
									<th>PONO</th>
									<th>PODate</th>
									<th>Title</th>
									<th>Amount</th>
									<th>Paid Amount</th>
									<th>Balance</th>
									<th>DeductionBalance</th>
									<th>Current Amount</th>
								</tr>
								</thead>
								<tbody class="main"></tbody>
								<tbody class="total">
								<tr>
									<td colspan="5"></td>
									<td class="rate_pri">Total Amount</td>
									<td width="25%" ><input class="parent_text border-none" type="text" name="advtotal" id="advtotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" readonly/></td>

								</tr>
								</tbody>
							</table>
							<input type="hidden" name="Arowid" id="Arowid" value="0"/>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-------------------------------End of Advance --------------------------------------->
		<!-------------------------------QualifierTab----------------------------------------->
		<div class="panel panel-info uniQual">
			<div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
				<h4 class="panel-title accordion-toggle defa_panels">Qualifier Details</h4>
			</div>
			<div class="panel-collapse collapse" id="collapseThree" style="height: 0px;">
				<div class="panel-body bgcolr">
					<div class="col-lg-12">
						<div class="table-responsive top-30">
							<table class="table table-bordered table-hover" >
								<thead>
								<tr>
									<th>Qualifier Name</th>
									<th>Account Name</th>
									<th>Sign</th>
									<th>%</th>
									<th>Amount</th>
								</tr>
								</thead>
								<tbody class="main" id="QualifierAccTable"></tbody>
								<tbody class="total">
								<tr>
									<td colspan="3"></td>
									<td class="rate_pri">Total Amount</td>
									<td width="30%" ><input class="parent_text border-none " type="text" name="qutotal" id="qutotal" style="text-align:right;" onkeypress="return isNumberKey(event,this);" disabled /></td>
								</tr>
								</tbody>
							</table>
							<input type="hidden" name="Qrowid" id="Qrowid" value="0"/>

						</div>					
					</div>
				</div>
			</div>
		</div>
		<!-------------------------------end of qualifierTab---------------------------------->
		<!-------------------------------Terms and Condition------------------------------->
		<div class="panel panel-info uniTrms">
			<div data-target="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-4">
				<h4 class="panel-title accordion-toggle defa_panels">Terms And Conditions</h4>
			</div>
			<div class="panel-collapse collapse" id="collapseFour" style="height: 0px;">
				<div class="panel-body bgcolr">
					<div class="col-lg-12">
						<div class="table-responsive top-30">
							<table class="table" style=" margin-bottom:0px;" id="termsTable">
								<thead>
								<tr>
									<th>Terms</th>
									<th>Value</th>
									<th>Account</th>
									<th>&nbsp;</th>
								</tr>
								</thead>
								<tbody class="main"></tbody>
							</table>
							<input type="hidden" name="trowid" id="trowid" value="0"/>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!------------------------------- END OF Terms and Condition------------------------------->
		<!-------------------------------Others Details------------------------------->
		<div class="panel panel-info uniOts">
			<div data-target="#collapseFive" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-5">
				<h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
			</div>
			<div class="panel-collapse collapse" id="collapseFive" style="height: 0px;">
				<div class="panel-body bgcolr">
					<div class="clearfix"></div>
					<div class="col-lg-12">
						<div class="card">
							<ul class="nav nav-tabs">
								<li class="active"><a href="#nar" id="narrationTabLink" onclick="showotherstabs('narration')" aria-controls="naration" role="tab" data-toggle="tab">Narration</a></li>
								<li class=""><a href="#branchdetails" id="branchTabLink" onclick="showotherstabs('branch')" aria-controls="branchdetails" role="tab" data-toggle="tab">Branch Details</a></li>
							</ul>
							<div class="tab-content" id="narration">
								<div class="tab-pane active" id="nar">
									<p>
									<div class="col-lg-12 sub_tab">
										<?php
										if(isset($Narration)){
											?>
											<textarea class="exp-tex btnPrev" name="Narration" id="Narration" disabled ><?php echo (isset($Narration)) ? $Narration : '';?></textarea>
										<?php }else{ ?>
											<textarea class="exp-tex" name="Narration" id="Narration" placeholder="Enter your Notes..."></textarea>
										<?php } ?>
									</div>
									</p>
								</div>
							</div>
							<div class="tab-pane" id="branchdetails"  style="display: none;">
								<div class="col-lg-12 top-30">
									<div class="col-lg-3">
										<select name="branchname" id="branchname"  class="form-control single_dropdown lbl_move" label="Select Branch"  style="width:100%;" disabled >
											<option value="" >Select Branch</option>
											<?php foreach($branch as $bran):?>
												<option value="<?php echo $bran['BranchId']; ?>" <?php echo ( (isset($BranchId) && $bran['BranchId']== $BranchId) ) ? 'selected' : ''; ?>><?php echo (isset($bran['BranchId'])) ? $bran['BranchName'] : '';?> </option>
											<?php endforeach; ?>
										</select>
									</div>
									<div class="col-lg-3">
										<div class="polymer-form">
											<input type="text" name="branchcontactno" id="branchcontactno" class="form-control lbl_move" label="Branch Contact No"  value="<?php echo (isset($Phone)) ? $Phone : '';?> " disabled />
										</div>
									</div>
									<div class="col-lg-3 ">
										<select name="contactperson" id="contactperson" class="form-control single_dropdown lbl_move" label="Contact Person" value="<?php echo (isset($ContactPerson)) ? $ContactPerson : '';?>" style="width:100%;" disabled >
											<option value=""></option>
										</select>
									</div>
									<div class="col-lg-3">
										<div class="polymer-form">
											<input type="text" name="contactpersonno" id="contactpersonno" class="form-control lbl_move" label="Contact No" value="<?php echo (isset($ContactNo)) ? $ContactNo : '';?>" disabled />
										</div>
									</div>
									<input type="hidden" name="" id="" value="0"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r">
            <a href="<?php echo $this->basePath("/mms/purchasebill/purchasebill-register");?>" class="ripple">Close</a>
        </li>
    </ul>
</div>
<script id="Qual-template"  type="text/template" class="hide">
    <tr>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="qualifiername__7" id="qualifiername__8" disabled/>
            <input type="hidden" name="QualifierExist___qu__0_per__9" id="QualifierExist___qu__0_per__9" value=""/>
            <input type="hidden" name="QualifierId__7" id="QualifierId__8" value=""/>
        </td>
        <td width="30%"><select data-placeholder="" disabled class="form-control single_dropdown lbl_move sortoption qchk " tabindex="7"  name="accountname__7" id="accountname__8">
            </select></td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="sign__7" id="sign__8" disabled /></td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput qualpop" type="text" name="percentage__7" id="percentage__8" disabled /></td>
        <td width="30%"><input class="parent_text red-non qualmainTrInput qualpop qualamount" type="text" name="qualamount__7" id="qualamount__8" disabled /></td>
    </tr>
</script>
<script id="Advance-template"  type="text/template" class="hide">
    <tr>
        <td width="5%"><input class="parent_text red-non qualmainTrInput" type="text" name="pono__" id="pono__" readonly /></td>
        <td width="20%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input" type="text" name="podate__" id="podate__" readonly/>
                <span class="date_icon"></span>
            </div>
        </td>
        <td width="15%"><input class="parent_text red-non qualmainTrInput" type="text" name="title__" id="title__" readonly /></td>
        <td width="10%"><input class="parent_text red-non qualmainTrInput" type="text"  name="aamount__" id="aamount__" readonly /></td>
        <td width="10%"><input class="parent_text red-non qualmainTrInput" type="text"  name="paidamount__" id="paidamount__" readonly /></td>
        <td width="10%"><input class="parent_text red-non qualmainTrInput" type="text"  name="balance__" id="balance__" readonly /></td>
        <td width="10%"><input class="parent_text red-non qualmainTrInput" type="text"  style="text-align:right;" name="deductbal__" id="deductbal__" readonly /></td>
        <td width="10%"><input class="parent_text red-non qualmainTrInput" type="text" style="text-align:right;" name="currentamount__" id="currentamount__" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2, true)"  onchange="advamount(this);"/>
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="poregisterid__" id="poregisterid__" />
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="advtermsid__" id="advtermsid__" />
            <input class="parent_text red-non qualmainTrInput" type="hidden" name="hiddenamt__" id="hiddenamt__" />
        </td>
    </tr>
</script>
<!------/advance adjustment-pop up--------->
<script id="resource-template"  type="text/template" class="hide">
 
    <tr id="click__" onclick="clickTr(this);" class="count-tr">
        <td width="25%" class="border-none" name="desc__" id="desc__">
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td width="10%" class="border-none" name="unitname__" id="unitname__">
            <input type="hidden" name="unitid__" id="unitid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>
        <td width="10%" class="border-none <?php echo $displaymaintr; ?>" type="text" name="qty__" id="qty__" style="text-align:right">
            <input type="hidden" name="hiddenqty__" id="hiddenqty__" >
            <input type="hidden" name="rfrom__" id="rfrom__" >
        </td>
        <td width="15%" class="border-none" name="rate__" id="rate__" style="text-align:right"></td>
        <td width="10%" class="border-none" name="qrate__" id="qrate__" style="text-align:right"></td>
        <td width="12%" class="border-none" name="baseamount__" id="baseamount__" style="text-align:right"></td>
        <td width="20%" class="border-none" name="amount__" id="amount__" style="text-align:right"></td>
        <td width="10%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr count-tr" id="wbsPotemplate__">
    </tr>
</script>

<script id="po-template" type="text/template" class="hide">
    <?php
    $displayscreen="display:show";
    $displaymaintr="";
    if($gridtype==1)
    {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }  ?>
    <td colspan="9" style="padding:0px !important; <?php echo $displayscreen; ?>;" class="subTr">
        <div class="" style="<?php echo $displayscreen; ?>;">
            <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                <div class="card">
                    <ul class="nav nav-tabs">
                        <li class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="showtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> PO <span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                        <li class=""><a class="ripple has-ripple qu" id="qualifierTabLink__" onclick="showtabs('qualifier',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;display:none;"> Qualifier<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        <li class=""><a class="ripple has-ripple rs" id="reqspeTabLink__" onclick="showtabs('reqspe',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;display: none;"> Resource Specification<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                        <li class=""><a class="ripple has-ripple wh" id="whTableLink__" onclick="showtabs('wh',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;display:none;"> Warehouse<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="tab-content">
                    <div class="table-responsive topsp sub_tab">
                        <table class="table" style="margin-bottom:0px;" id="decisionTable__">
                            <thead>
                            <tr>
                                <th class="worktype-activity sub_tbl1">PONo</th>
                                <th class="worktype-activity sub_tbl1">PODate</th>
                                <th class="sub_tbl1">POQty</th>
                                <th class="sub_tbl1">BalQty</th>
                                <th class="sub_tbl1">Qty</th>
                                <th class="sub_tbl1 iow___requestfields" style="display: none;">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                            <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                        </table>
                        <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable__" onchange="CalculateRate(this.id)">
                        </table>
                        <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                        </table>
                        <table class="table" style="margin-bottom:0px; display:none;" id="whTable__">
                            <thead>
                            <tr>
                                <th class="worktype-activity">Warehouse Name </th>
                                <th class="worktype-activity">Description </th>
                                <th class="worktype-activity">Qty </th>
                                <th class="" style="display: none;">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                            <input type="hidden" name="wh___rowid" id="wh___rowid" value="0"/>
                        </table>
                    </div>
                </div>

            </div>
            <div class="col-lg-12 col-md-12 col-xs-12 mar_10">
                <span class="est1 mr_lt" id="estqty__" ></span>
                <span class="est2 mr_lt" id="estrate__" ></span>
                <span class="est3 mr_lt" id="avaqty__" ></span>
                <span class="" id="balpoqty__" hidden="true" ></span>
                <span class="" id="totdc__" hidden="true" ></span>
                <span class="" id="totbill__" hidden="true" ></span>
            </div>
        </div>

    </td>

</script>
<script id="iow-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="20%">
            <input  type="text" name="wh___warehousename_0" id="wh___warehousename_0" />
            <input type="hidden" name="wh___warehouseid_0" id="wh___warehouseid_0"/>
            <input  type="hidden" name="wh___costcentreid_0" id="wh___costcentreid_0" />
        </td>
        <td width="20%">
            <input  type="text" name="wh___desc_0" id="wh___desc_0"/>
        </td>
        <td width="20%">
            <input class="parent_text chqty mainTr" type="text" name="wh___qty_0" id="wh___qty_0" style="text-align:right;"  onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 3, true)"  onchange="checkWHQuantity(this);" />
            <input type="hidden" name="iow__hiddenqty_0" id="iow__hiddenqty_0" value="0"/>
        </td>
    </tr>
</script>

<script id="wbs-iowtemplate" type="text/template" class="hide">
    <?php
    $displayscreen="display:show";
    $displaymaintr="";
    if($gridtype==1)
    {
        $displayscreen="display:none";
        $displaymaintr="mainTr";
    }  ?>
    <td colspan="9" style="padding:0px !important; <?php echo $displayscreen; ?>;" class="subTr">
        <div class="subDiv" style="<?php echo $displayscreen; ?>;">
            <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                <div class="card">
                    <ul class="nav nav-tabs">
                        <li class="active"><a class="ripple has-ripple" id="decisionTabLink1__" onclick="showtabss('wbs',this.id,event)" style="cursor:pointer;"> WBS <span class="ripple-wrapper animated"></span></a></li>
                        <li class=""><a class="ripple has-ripple" id="qualifierTabLink1__" onclick="showtabss('qualifier',this.id,event)" style="cursor:pointer;display:none;"> Qualifier<span class="ripple-wrapper animated"></span></a></li>
                        <li class=""><a class="ripple has-ripple" id="reqspeTabLink1__" onclick="showtabss('reqspe',this.id,event)" style="cursor:pointer;display:none;"> Resource Specification<span class="ripple-wrapper animated"></span></a></li>
                        <li class=""><a class="ripple has-ripple" id="whTableLink1__" onclick="showtabss('wh1',this.id,event)" style="cursor:pointer;display:none;"> Warehouse<span class="ripple-wrapper animated"></span></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="tab-content">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="wbsTable__">
                            <thead>
                            <tr>
                                <th class="worktype-activity sub_tbl3">WBS Name</th>
                                <th class="worktype-activity sub_tbl3">Qty</th>
                                <th class="iow___requestfields" style="display: none;">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main" id="wbstbody__"></tbody>
                            <tbody class="total" >
                            </tbody>
                            <input type="hidden" name="wbs___rowids" id="wbs___rowids" value="0" />
                        </table>
                        <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable1__" >
                        </table>
                        <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable1__">
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                        </table>
                        <table class="table" style="margin-bottom:0px; display:none;" id="whTable__">
                            <thead>
                            <tr>
                                <th class="worktype-activity">Warehouse Name </th>
                                <th class="worktype-activity">Description </th>
                                <th class="worktype-activity">Qty </th>
                                <th class="" style="display: none;">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                            <input type="hidden" name="wh___rowid" id="wh___rowid" value="0"/>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-content">
                <div class="table-responsive topsp">
                    <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">
                        <tbody class="main"></tbody>
                        <tbody class="total">
                        </tbody>

                    </table>
                </div>
            </div>
            <div class="col-lg-12 col-md-12 col-xs-12 mar_10">
                <span class="est1 mr_lt" id="estqty__"></span>
                <span class="est2 mr_lt" id="estrate__"></span>
                <span class="est3 mr_lt" id="avaqty__"></span>
                <span class="" id="balpoqty__" hidden="true"></span>
                <span class="" id="totdc__" hidden="true"></span>
                <span class="" id="totbill__" hidden="true"></span>
            </div>
        </div>
    </td>
</script>

<!--IF WBS-->
<script id="wbs-template" type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="50%">
            <input type="hidden"  name="wbs___wbsid_0" id="wbs___wbsid_0" readonly/>
            <input class="parent_text border-none" type="text" name="wbs___wbsname_0" id="wbs___wbsname_0" disabled />
        </td>
        <td width="50%">
            <input class="parent_text" type="text" name="wbs___qty_0" id="wbs___qty_0" style="text-align:right;"  maxlength="50" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' onkeyup="calcQuant(this);" disabled />

            <input type="hidden" name="wbs___hiddenqty_0" id="wbs___hiddenqty_0"/>
            <div class="spee-bubble arow-top animated fadeInUp"  id="wbs___estwbsarrow_0">
                <div class="arow-top-small-container">
                    <div class="arow"></div>
                </div>
                <span class="nos" id="wbs___estwbsqty_0" hidden="true"></span>
                <span class="nos" id="wbs___avawbsqty_0" hidden="true" ></span>
                <span class="nos" id="wbs___excesswbsqty_0" hidden="true"></span>
                <span class="nos" id="wbs___balreqwbsqty_0" hidden="true"></span>
                <span class="nos" id="wbs___balpowbsqty_0" hidden="true"></span>
                <span class="nos" id="wbs___totpurchasewbsqty_0" hidden="true"></span>
                <span class="nos" id="wbs___minqty_0" hidden="true"></span>
                <span class="nos" id="wbs___billqty_0" hidden="true"></span>

            </div>
        </td>
    </tr>
</script>

<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="15%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___PONo_0" id="iow___PONo_0" disabled />
            <input type="hidden" name="iow___PORegisterId_0" id="iow___PORegisterId_0"/>
            <input type="hidden" name="iow___POTransId_0" id="iow___POTransId_0"/>
            <input type="hidden" name="iow___POProjTransId_0" id="iow___POProjTransId_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
        </td>
        <td width="15%">
            <div class="col-lg-12 padlr0">
                <input class="tbl_input" type="text" name="iow___PODate_0" id="iow___PODate_0" disabled />
                <span class="date_icon"></span>
            </div>
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="iow___POQty_0" id="iow___POQty_0" style="text-align:right;" disabled /></td>
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___balqty_0" id="iow___balqty_0" style="text-align:right;" disabled /></td>
        <td width="20%">
            <input class="parent_text <?php echo $displaymaintr; ?>" type="text" name="iow___qty_0" id="iow___qty_0" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3, true)"  maxlength="50"
                   style="text-align:right;" data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' onchange="calcQuantity(this);" disabled />
            <input type="hidden" name="iow___hiddenqty_0" id="iow___hiddenqty_0" value="0"/>

        </td>
        <td width="10%" align="center" class="action_btns_td iow___requestfields" style="display: none;">
            <ul class="action_btns">
                <li><a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>;" class="subTr dont-hide">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv hel" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp">
                        <table class="table" style="margin-bottom:0px;" id="iow___request_0_reqno">
                            <thead>
                            <tr>
                                <th class="sub_tbl3">WBSName</th>
                                <th class="sub_tbl3">POQty</th>
                                <th class="sub_tbl3">BalQty</th>
                                <th class="sub_tbl3">Qty</th>
                                <th class="sub_tbl3">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                            <tbody class="total">
                            </tbody>
                            <input type="hidden" name="iow___request_0_rowid" id="iow___request_0_rowid" value="0"/>
                        </table>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="request-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%">
            <input class="parent_text border-none" type="text" name="iow___PO_0_wbsname__9" id="iow___PO_0_wbsname__9" disabled />
            <input type="hidden" name="iow___PO_0_wbsid__9" id="iow___PO_0_wbsid__9"/>
            <input type="hidden" name="iow___PO_0_PORegisterId_9" id="iow___PO_0_PORegisterId_9"
            <input type="hidden" name="iow___PO_0_POTransId_9" id="iow___PO_0_POTransId_9"/>
            <input type="hidden" name="iow___PO_0_POProjTransId_9" id="iow___PO_0_POProjTransId__9"/>
            <input type="hidden" name="iow___PO_0_POAnalTransId__9" id="iow___PO_0_POAnalTransId__9"/>
            <input type="hidden" name="iow___PO_0_resourceid__9" id="iow___PO_0_resourceid__9"/>
            <input type="hidden" name="iow___PO_0_itemid__9" id="iow___PO_0_itemid__9"/>
        </td>
        <td width="20%"><input class="parent_text border-none" type="text" name="iow___PO_0_POQty__9" id="iow___PO_0_POQty__9" style="text-align:right;" disabled /></td>
        <td width="25%"><input class="parent_text border-none" type="text" name="iow___PO_0_balqty__9" id="iow___PO_0_balqty__9" style="text-align:right;" disabled /></td>
        <td width="25%">
            <input class="parent_text" type="text" name="iow___PO_0_qty__9" id="iow___PO_0_qty__9" style="text-align:right;" onblur="return FormatNum(this, 3, true)"  onkeypress="return isDecimal(event,this)"
                   onchange="calcRequestQuantity(this);" data-html="true" data-placement="top" data-toggle="tooltip" data-original-title='' onmouseover="checkEstPOWbs(this);" maxlength="50" readonly/>
            <input type="hidden" name="iow___PO_0_hiddenqty__9" id="iow___PO_0_hiddenqty__9" value="0"/>
            <span class="nos" id="iow___PO_0_estwbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___PO_0_avawbsqty__9" hidden="true" ></span>
            <span class="nos" id="iow___PO_0_excesswbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___PO_0_balreqwbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___PO_0_balpowbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___PO_0_totpurchasewbsqty__9" hidden="true"></span>
            <span class="nos" id="iow___isprojwbsqty_0" hidden="true"></span>
        </td>
    </tr>
</script>
<!----! end if wbs only came ----->
<script id="resspec-template" type="text/template">
    <tr>
        <td width="100%">
            <textarea class="exp-tex"  name="resspec__" id="resspec__"  disabled ></textarea>
        </td>
    </tr>
</script>

<script id="terms-template"  type="text/template" class="hide">
    <tr>
        <td width="33%">
            <input class="parent_text resourceSuggest" type="text" name="terms__" id="terms__" onfocus="checkTermsUsed(this);" disabled />
            <input type="hidden" name="termsid__" id="termsid__"  value=""/>
            <input type="hidden"  name="isvalue__" id="isvalue__"/>
            <input type="hidden"  name="isaccount__" id="isaccount__"/>
        </td>
        <td width="33%">
            <input class="parent_text border-none" type="text" name="value__" id="value__" value="" style="text-align:right;" onkeypress="return isNumberKey(event,this)" onchange="valueTotal();" disabled /></td>
        <td width="33%">
			<select data-placeholder="" class="form-control single_dropdown lbl_box sortoption tbl_input changeVal" name="account__" id="account__" disabled ></select>
		</td>
    </tr>
</script>
<script type="text/javascript">
// resource for po
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var tmp_arr_resources = arr_resources;
var arr_wbs = <?php echo (isset($arr_res_wbs)) ? json_encode($arr_res_wbs) : '[]';?>;
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;
var arr_warehouseQty = <?php echo (isset($arr_warehouseQty)) ? json_encode($arr_warehouseQty) : '[]';?>;
var arr_sel_warehouse = <?php echo (isset($arr_sel_warehouse)) ? json_encode($arr_sel_warehouse) : '[]';?>;

var Account = <?php echo (isset($Account)) ? json_encode($Account) : '[]';?>;
var qual_Acc = <?php echo (isset($Qual_Acc)) ? json_encode($Qual_Acc) : '[]';?>;
var qualList = <?php echo (isset($qualList)) ? json_encode($qualList) : '[]';?>;

var arr_advance = <?php echo (isset($arr_advance)) ? json_encode($arr_advance) : '[]';?>;

var terms_ent = <?php echo (isset($terms_ent)) ? json_encode($terms_ent) : '[]';?>;
var branch = <?php echo (isset($branch)) ? json_encode($branch) : '[]';?>;

var arr_resource_wbs = <?php echo (isset($arr_resource_wbs)) ? json_encode($arr_resource_wbs) : '[]';?>;
var arr_wb = <?php echo (isset($arr_wb)) ? json_encode($arr_wb) : '[]';?>;
var arrRes = <?php echo (isset($arrRes)) ? json_encode($arrRes) : '[]';?>;

var arr_terms=<?php echo (isset($arr_terms)) ? json_encode($arr_terms) : '[]';?>;
var arr_edit_terms=<?php echo (isset($arr_edit_terms)) ? json_encode($arr_edit_terms) : '[]';?>;
var arr_qual_list=<?php echo (isset($arr_qual_list)) ? json_encode($arr_qual_list) : '[]';?>;
var arr_estdetails = <?php echo (isset($arr_estimate)) ? json_encode($arr_estimate) : '[]';?>;//arr_estimate
var arr_wbsestimate = <?php echo (isset($arr_wbsestimate)) ? json_encode($arr_wbsestimate) : '[]';?>;// arr_wbsestimate

var qualAccList = <?php echo (isset($qualAccList)) ? json_encode($qualAccList) : '[]';?>;
var sampleQual = [];

$.each(qualAccList, function (k, j) {
    var sign = 0;
    if(j.Sign == '+'){
        sign = 1;
    } else{
        sign = 2;
    }
    var aId = j.AccountId;
    var qId = j.QualifierId;
    var arrKey = qId +'AA'+ sign ;
    sampleQual[arrKey] = aId;
});


var WorkType = $('#WorkType').val();
var OrderType = $('#OrderType').val();

$('#adajModal').modal('hide');
$('#QualaccModal').modal('hide');

var qualiferHTML = '<?php echo (isset($qualHtml)) ? preg_replace('~>\s+<~', '><',$qualHtml) : '';?>';
$(function () {

    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var requesttemplate = $('#request-template').html();
    var wbstemplate = $('#wbs-template').html();
    var wbsiowtemplate = $('#wbs-iowtemplate').html();
    var potemplate = $('#po-template').html();
    var resspectemplate=$('#resspec-template').html();
    var waretemplate = $('#iow-warehouse').html();
    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.seqview');

    if(arr_requestResources.length != 0) {
        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
           // console.log(rowid);
            $tbody.append(template.replace(/__/g, '_' + rowid));

            $('#desc_' + rowid).html(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).html(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#qty_' + rowid).html(sanitizeNumber(o.Qty,3,true));
            $('#rate_' + rowid).html(sanitizeNumber(o.Rate,2,true));
            $('#qrate_' + rowid).html(sanitizeNumber(o.Rate,2,true));
            $('#baseamount_' + rowid).html(sanitizeNumber(o.BaseAmount,2,true));
            $('#amount_' + rowid).html(sanitizeNumber(o.Amount,2,true));
            $('#hiddenqty_' + rowid).val(sanitizeNumber(o.Qty,3,true));
            $('#rfrom_' + rowid).html(o.RFrom);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            $('#expandSt_' + rowid).show();
            $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
            $('#estqty_' + rowid).show();
            $('#avaqty_' + rowid).show();
            $('#excessqty_' + rowid).show();

            iowrowid = 0;
            requestrowid =0;
            var findRes = arr_resource_iows.filter(function(obj) {
                return (obj.ResourceId === o.ResourceId) && (obj.ItemId === o.ItemId && (obj.BalQty > 0 || obj.Qty > 0));
            });
            if(findRes.length > 0) {
                $('#wbsPotemplate_'+rowid).append(potemplate.replace(/__/g, '_' + rowid));
                $.each(arr_resource_iows, function (j, l) {
                    if ((l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                        return;
                    }
                    if (<?php echo (isset($PVRegisterId)) ? $PVRegisterId : 0;?> > 0 ) {
                        var RId = o.ResourceId;
                        var ItId = o.ItemId;
                        var poId =<?php echo (isset($PVRegisterId)) ? $PVRegisterId : 0;?>;
                        $.ajax({
                            url: getBaseURL() + 'mms/purchasebill/displaypurchasebill',
                            type: "post",
                            data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&poId=" + poId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    if(data != ''){
                                        $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                        if($('input[type="checkbox"]')){
                                            $('.qualChange').attr('disabled',true);
                                        } else {
                                            $('.qualChange').attr('readonly',true);
                                        }
                                        var ch1 = $('#QualRowId_' + rowid).val();
                                        if(ch1 == 0){
                                            $('#qualifierTabLink_' + rowid).hide();
                                        } else {
                                            $('#qualifierTabLink_' + rowid).show();
                                        }
                                       // onclick="showtabss('qualifier',this.id,event)"
                                    }
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });
                    }
                    iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    $('#iow_' + rowid + '_PORegisterId_' + iowrowid).val(l.PORegisterId);
                    $('#iow_' + rowid + '_POTransId_' + iowrowid).val(l.POTransId);
                    $('#iow_' + rowid + '_POProjTransId_' + iowrowid).val(l.POProjTransId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_PONo_' + iowrowid).val(l.PONo);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(sanitizeNumber(l.BalQty,3,true));
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(sanitizeNumber(l.Qty,3,true));
                    $('#iow_' + rowid + '_POQty_' + iowrowid).val(sanitizeNumber(l.POQty,3,true));
                    $('#iow_' + rowid + '_PODate_' + iowrowid).val(l.PODate);

                    requestrowid =0;
                    var poWbsRequest = arr_resource_iow_requests.filter(function(obj) {
                        return (obj.ResourceId === l.ResourceId)  && (obj.ItemId === l.ItemId) && (obj.POProjTransId === l.POProjTransId) && (obj.BalQty > 0 || obj.Qty > 0);
                    });
                    if(poWbsRequest.length > 0) {
                        $.each(arr_resource_iow_requests, function (k, r) {
                            if (l.ResourceId != r.ResourceId || l.ItemId != r.ItemId || l.POProjTransId != r.POProjTransId) {
                                return;
                            }
                            $('#iow_' + rowid + '_qty_' + iowrowid).addClass('border-none').prop('readonly', true);
                            $('.iow_' + rowid + '_requestfields').show();
                            requestrowid = parseInt($('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val()) + 1;
                            $('#iow_' + rowid + '_request_' + iowrowid + '_reqno').find('> tbody.main').append(requesttemplate
                                .replace(/__9/g, '_' + requestrowid)
                                .replace(/_0/g, '_' + iowrowid)
                                .replace(/__/g, '_' + rowid));
                            $('#iow_' + rowid + '_request_' + iowrowid + '_rowid').val(requestrowid);

                            $('#iow_' + rowid + '_PO_' + iowrowid + '_wbsname_' + requestrowid).val(r.WBSName);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_wbsid_' + requestrowid).val(r.WBSId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_PORegisterId_' + requestrowid).val(r.PORegisterId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_POTransId_' + requestrowid).val(r.POTransId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_POProjTransId_' + requestrowid).val(r.POProjTransId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_POAnalTransId_' + requestrowid).val(r.POAnalTransId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_resourceid_' + requestrowid).val(r.ResourceId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_itemid_' + requestrowid).val(r.ItemId);
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_balqty_' + requestrowid).val(sanitizeNumber(r.BalQty,3,true));
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_qty_' + requestrowid).val(sanitizeNumber(r.Qty,3,true));
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_hiddenqty_' + requestrowid).val(sanitizeNumber(r.Qty,3,true));
                            $('#iow_' + rowid + '_PO_' + iowrowid + '_POQty_' + requestrowid).val(sanitizeNumber(r.POQty,3,true));
                        });
                       // CalculateRate('#qualifierTable_' + rowid);
                    }else{
						$('#iow_'+ rowid +'_request_'+ iowrowid +'_decWbs').hide();
                        $('#iow_'+ rowid +'_request_'+ iowrowid +'_reqno').hide();
                        $('.poWBS').hide();
                        $('.hel').hide();
                    }
                });
            } else{
                $('#wbsPotemplate_' + rowid).append(wbsiowtemplate.replace(/__/g, '_' + rowid));
                var ResId = o.ResourceId;
                var IteId = o.ItemId;
                var PVRegId = <?php echo (isset($PVRegisterId)) ? $PVRegisterId : 0;?>;
                var CcId = <?php echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>;
                $.ajax({
                    url: getBaseURL() + 'mms/purchasebill/displaypurchasebill',
                    type: "post",
                    data: "ResourceId=" + ResId + "&Type=wbsEdit&ItemId=" + IteId + "&PVRegId=" + PVRegId + "&CCId=" + CcId + "",
                    async: false,
                    success: function (data, textStatus, jqXHR) {
                        if (jqXHR.status == 200) {
                            data = JSON.parse(data);
                            if(Object.keys(data).length >= 1) {
                                $.each(data.wbs, function (i, l) {
                                    var findRes = arr_wbs.filter(function (obj) {
                                        return (obj.ResourceId === ResId && obj.WBSId === l.WbsId);
                                    });
                                    if (findRes.length > 0) {

                                        var wbsrowid = parseInt($('#wbs_' + rowid + '_rowids').val()) + 1;
                                        $('#wbsTable_' + rowid).find('> tbody.main').append(wbstemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + wbsrowid));
                                        $('#wbsTable_' + rowid).show();
                                        // $('#wbstbody_' + rowid).append(wbstemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + wbsrowid));
                                        $('#wbs_' + rowid + '_rowids').val(wbsrowid);
                                        $('#wbs_' + rowid + '_wbsname_' + wbsrowid).val(l.WbsName);

                                        $('#wbs_' + rowid + '_wbsid_' + wbsrowid).val(l.WbsId);
                                        $('#wbs_' + rowid + '_qty_' + wbsrowid).val(sanitizeNumber(l.Qty,3,true));
                                        $('#wbs_' + rowid + '_hiddenqty_' + wbsrowid).val(sanitizeNumber(l.Qty,3,true));
                                        // estimate- only wbs
                                        var find_estwbs = data.estwbs.filter(function (obj) {
                                            return (obj.ResourceId === o.ResourceId && obj.WbsId === l.WbsId);
                                        });
                                        if (find_estwbs.length > 0) {
                                            $.each(data.estwbs, function (s, p) {
                                                if (p.ResourceId == o.ResourceId && l.WbsId == p.WbsId) {

                                                    $('#wbs_' + rowid + '_estwbsdetails_' + wbsrowid).hide();
                                                    $('#wbs_' + rowid + '_estwbsarrow_' + wbsrowid).hide();
                                                    $('#wbs_' + rowid + '_estwbsqty_' + wbsrowid).text(p.EstimateQty);
                                                    $('#wbs_' + rowid + '_avawbsqty_' + wbsrowid).text(p.AvailableQty);
                                                    $('#wbs_' + rowid + '_excesswbsqty_' + wbsrowid).text(p.ExcessQty);
                                                    $('#wbs_' + rowid + '_balreqwbsqty_' + wbsrowid).text(p.BalReqQty);
                                                    $('#wbs_' + rowid + '_balpowbsqty_' + wbsrowid).text(p.BalPOQty);
                                                    $('#wbs_' + rowid + '_totpurchasewbsqty_' + wbsrowid).text(p.TotPurchase);
                                                    $('#wbs_' + rowid + '_minqty_' + wbsrowid).text(p.MinQty);
                                                    $('#wbs_' + rowid + '_billqty_' + wbsrowid).text(p.BillQty);
                                                }
                                            });
                                        }
                                        else {
                                            $('#wbs_' + rowid + '_estwbsdetails_' + wbsrowid).hide();
                                            $('#wbs_' + rowid + '_estwbsarrow_' + wbsrowid).hide();
                                        }
                                        $('#wbs_' + rowid + '_expandWbs_' + wbsrowid).show();
                                    }
                                });
                            }
                            else
                            {
//                                $('#wbsTable_' + rowid).hide();
//                                $('#decisionTable_' + rowid).hide();
//                                $('#decisionTabLink_' + rowid).hide();
//                                $('#wbsTabLink_' + rowid).hide();
//                                $('#qualifierTable_' + rowid).show();
                            }
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('.loading_area').hide();
                    }

                });
                if (<?php echo (isset($PVRegisterId)) ? $PVRegisterId : 0;?> >0) {
                        var RId = o.ResourceId;
                        var ItId = o.ItemId;
                        var poId =<?php echo (isset($PVRegisterId)) ? $PVRegisterId : 0;?>;
                        $.ajax({
                            url: getBaseURL() + 'mms/purchasebill/displaypurchasebill',
                            type: "post",
                            data: "ResourceId=" + RId + "&Type=getqualdetails&ItemId=" + ItId + "&poId=" + poId + "",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable1_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                    $('.qualChange').attr('readonly',true);
                                    $('.qCheck').attr('disabled',true);
                                    var chk1 = $('#QualRowId_' + rowid).val();
                                    if(chk1 == 0){
                                        $('#qualifierTabLink1_' + rowid).hide();
                                    } else {
                                        $('#qualifierTabLink1_' + rowid).show();
                                    }
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });
                    }

            } // end of else

            //warehouse
            if(o.ResSpec != ''){
                $('#reqspeTable_' + rowid).append(resspectemplate.replace(/__/g, '_' + rowid));
                $('#reqspeTabLink_' + rowid).show();
                $('#reqspeTabLink1_' + rowid).show();
                $('#resspec_' + rowid).val(o.ResSpec);
            } else {
                $('#reqspeTabLink_' + rowid).hide();
                $('#reqspeTabLink1_' + rowid).hide();
            }


            if(arr_sel_warehouse.length != 0) {
                $.each(arr_sel_warehouse, function (m, n) {
                    var whrowid = parseInt($('#wh_' + rowid + '_rowid').val()) + 1;
                    $('#whTableLink_' + rowid).show();
                    $('#whTableLink1_' + rowid).show();
                    $('#whTable_' + rowid).find('> tbody.main').append(waretemplate
                        .replace(/__/g, '_' + rowid)
                        .replace(/_0/g, '_' + whrowid));

                    $('#wh_' + rowid + '_rowid').val(whrowid);
                    $('#wh_' + rowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                    $('#wh_' + rowid + '_warehousename_' + whrowid).val(n.WareHouseName);
                    $('#wh_' + rowid + '_costcentreid_' + whrowid).val(n.CostCentreId);
                    $('#wh_' + rowid + '_desc_' + whrowid).val(n.Description);
                    $('#wh_' + rowid + '_qty_' + whrowid).val(sanitizeNumber(n.Qty,3,true));
                    $.each(arr_warehouseQty, function (s,t) {
                        if (n.WareHouseId == t.WareHouseId && o.ResourceId == t.ResourceId && o.ItemId == t.ItemId && t.Qty>0) {
                            $('#wh_' + rowid + '_qty_' + whrowid).val(t.Qty);
                        }
                    });
                });
            } // end of warehouse if condition
            if(iowrowid <= 0 && requestrowid <= 0 ){
                $('#qty_' + rowid).attr('onchange','calcQty(this)');
                $('#qty_' + rowid).prop("readonly", false);
            }
        });// first each function
    }
	rowid += 1;
    $rowid.val(rowid);

//    var chPo = $('#rowid').val();
//
//    if(arr_requestResources.length == 0 && ){
//
//    }
 

    //terms &condition
    var $trowid = $('#trowid');
    var template = $('#terms-template').html();
    var trowid = 0;
    var $tbody = $('#termsTable').find('> tbody');

    if(terms_ent.length > 0){
        $.each(terms_ent, function (j, p) {
            trowid += 1;
            $tbody.append(template.replace(/__/g, '_' + trowid));
            var opt = '<option></option>';
            if (Account.length > 0) {
                $.each(Account, function (m, n) {
                    opt += '<option value="' + n.AccountId + '">' + n.AccountName + '</option>';
                });
            }
            $('#account_' + trowid).html(opt);
            $('#terms_' + trowid).val(p.Terms);
            $('#value_' + trowid).val(p.Value);
            $('#termsid_' + trowid).val(p.TermsId);
            $trowid.val(terms_ent.length);
            $('#account_' + trowid).val(p.AccountId);
        });
    } else {
        $('.uniTrms').hide();
    }

    //advance amount
    var $arowid = $('#Arowid');
    var atemplate = $('#Advance-template').html();
    var arowid = 0;
    var $tbody = $('#AdvanceTable').find('> tbody.main');
    var advtot=0;

    if(arr_advance.length > 0){
        $.each(arr_advance, function (j, p) {
            arowid += 1;
            $tbody.append(atemplate.replace(/__/g, '_' + arowid));
            $('#pono_' + arowid).val(p.PONo);
            $('#poregisterid_' + arowid).val(p.PORegisterId);
            $('#advtermsid_' + arowid).val(p.TermsId);
            $('#podate_' + arowid).val(p.PODate);
            $('#title_' + arowid).val(p.Title);
            $('#aamount_' + arowid).val(sanitizeNumber(p.Amount,2,true));
            $('#paidamount_' + arowid).val(sanitizeNumber(p.PaidAmount,2,true));
            $('#currentamount_' + arowid).val(sanitizeNumber(p.CurrentAmount,2,true));
            $('#balance_' + arowid).val(sanitizeNumber(p.Balance,2,true));
            $('#deductbal_' + arowid).val(sanitizeNumber(p.DeductionBalance,2,true));
            $('#hiddenamt_' + arowid).val(p.HiddenAmount);
            $arowid.val(arr_advance.length);
            advtot=parseFloatVal(advtot)+parseFloatVal($('#currentamount_' + arowid).val());
        });
        $('#advtotal').val(advtot);
    } else {
        $('.uniAdv').hide();
    }

	
	
	//Qualifier
   if(qualAccList.length != '') {
       var qual1 = 0;
       $('#qualClick').attr("disabled", false);
       $('#QualifierAccTable').html('');
       var totalQualRows = $('#rowid').val();
       var Qtemplate = $('#Qual-template').html();
       var qualCheck = 0;
       for (var i = 1; i < totalQualRows; i++) {
           $.each(qualList, function (m, o) {
               var qualRowCount = m + 1;
               if ($('#Qual_' + i + '_YesNo_' + qualRowCount).is(':checked') == true) {
                   var vatAmt = $('#Qual_' + i + '_Amount_' + qualRowCount).val();
                   var QualName = $('#Qual_' + i + '_Desc_' + qualRowCount).val();
                   var percent = $('#Qual_' + i + '_ExpPer_' + qualRowCount).val();
                   var qId = $('#Qual_' + i + '_Id_' + qualRowCount).val();
                   var dot = sanitizeNumber(percent, 2, true).replace('.', '_');
                   var sSign = isNullCheck($('#Qual_' + i + '_Sign_' + qualRowCount).val(), 'string');
                   if (sSign == '+') {
                       aSign = 1;
                   } else {
                       aSign = 2;
                   }
                   var qId = $('#Qual_' + i + '_Id_' + qualRowCount).val();
                   var commonVar = 'QualifierExist_' + qId + '_qu_' + aSign + '_per_' + dot;
                   abc = $('#QualifierExist_' + qId + '_qu_' + aSign + '_per_' + dot);
                   if (abc.length) {
                       var prevAmt = $('#qualamount_' + commonVar).val();
                       var newAmt = parseFloat(prevAmt) + parseFloat(vatAmt);
                       $('#qualamount_' + commonVar).val(sanitizeNumber(newAmt, 3, true));
                   }
                   else {
                       $('#QualifierAccTable').append(Qtemplate
                               .replace(/__8/g, '_' + commonVar)
                               .replace(/__7/g, '_' + qualCheck)
                               .replace(/__9/g, '_' + dot)
                               .replace(/__0/g, '_' + aSign)
                               .replace(/__/g, '_' + qId)
                       );
                       $(".single_dropdown1").select2({});
                       abc.val('QualifierExist_' + qId + '_qu_' + aSign);
                       $('#qualifiername_' + commonVar).val(QualName);
                       $('#QualifierId_' + commonVar).val(qId);
                       $('#percentage_' + commonVar).val(sanitizeNumber(percent, 2, true));
                       $('#sign_' + commonVar).val(sSign);
                       $('#qualamount_' + commonVar).val(sanitizeNumber(vatAmt, 2, true));
                       var arrkey = qId + 'AA' + aSign;
                       var opt = '<option value=""></option>';
                       if (qual_Acc.length > 0) {
                           $.each(qual_Acc, function (j, p) {
                               if (sampleQual[arrkey] == p.AccountId) {
                                   opt += '<option selected value="' + p.AccountId + '">' + p.AccountName + '</option>';
                               } else {
                                   opt += '<option value="' + p.AccountId + '">' + p.AccountName + '</option>';
                               }
                           });
                       }
                       $('#accountname_' + commonVar).html(opt).trigger('change');
                       qualCheck++;
                       $('#Qrowid').val(qualCheck);
                   }
               }
           });
       }
       $('.qualamount').each(function (i, o) {
           var curId = $(this).attr('id');
           var signId = curId.replace('qualamount', 'sign');
           var aSignVal = $('#' + signId).val();
           if (aSignVal == '-') {
               qual1 -= parseFloat($(this).val());
           } else {
               qual1 += parseFloat($(this).val());
           }
       });
       $('#qutotal').val(sanitizeNumber(qual1, 2));
   } else  {
       $('.uniQual').hide();
   }

    var checkNar = "<?php echo (isset($Narration)) ? $Narration : '';?>";
    var checkBr = <?php echo (isset($bcount)) ? $bcount : '[]';?>;

    if(checkNar == '' && checkBr == 0 ){
        $('.uniOts').hide();
    } else if(checkNar == ''){
        $('#narrationTabLink').hide();
        showotherstabs('branch');
    } else if(checkBr == 0 || checkBr == ''){
        $('#branchTabLink').hide();
        showotherstabs('narration');
    }

	$(document).ready(function(){
        $(".flip0").click(function(){
            $(".pane0").slideToggle("slow");
        });
    });
    function myFunction(x) {
        x.classList.toggle("change");
    }

    $('.container-fluid').on('click','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });
    nextAccordian(1);
});

function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];
    if (type=="decision") {
        $('#decisionTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
        $('#whTable_'+rowid).hide();
    } else if(type=="qualifier") {
        $('#qualifierTable_'+rowid).show();
        $('#reqspeTable_'+rowid).hide();
        $('#whTable_'+rowid).hide();
        $('#decisionTable_'+rowid).hide();
    }
    else if(type=="reqspe"){
        $('#reqspeTable_'+rowid).show();
        $('#whTable_'+rowid).hide();
        $('#qualifierTable_'+rowid).hide();
        $('#decisionTable_'+rowid).hide();
    }
    else{
        $('#whTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#decisionTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
    }
    return false;
}

function showtabss(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];

    if (type=="wbs") {
        if(parseInt($('#wbs_'+ rowid + '_rowids').val()) <= 0){
            alert("no data available");
            $('#wbsTable_' + rowid).hide();
        }
        else{
            $('#wbsTable_'+rowid).show();
            $('#qualifierTable1_'+rowid).hide();
            $('#reqspeTable_'+rowid).hide();
            $('#whTable_'+rowid).hide();
        }

    } else if(type=="qualifier") {
        $('#qualifierTable1_'+rowid).show();
        $('#reqspeTable_'+rowid).hide();
        $('#whTable_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();
    }
    else if(type=="reqspe"){
        $('#reqspeTable_'+rowid).show();
        $('#whTable_'+rowid).hide();
        $('#qualifierTable1_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();
    }
    else{
        $('#whTable_'+rowid).show();
        $('#qualifierTable1_'+rowid).hide();
        $('#wbsTable_'+rowid).hide();
        $('#reqspeTable_'+rowid).hide();
    }
    return false;
}
function showotherstabs(type) {
    if (type=="narration") {
        $('#narration').show();
        $('#branchdetails').hide();
    } else {
        $('#branchdetails').show();
        $('#narration').hide();
    }
}
function nextAccordian(id,s) {
    if(id==2 && s==1){
        $(".collapseTwo").attr('id','collapseTwo');
    } else if(id==3 && s==2){
        $(".collapseThree").attr('id','collapseThree');
    }
    $('#panelheading-' + id).trigger('click');
}
function checkAdvance(){
    nextAccordian(2,1);
}
function calQualList(){
    nextAccordian(3,2);
}
</script>