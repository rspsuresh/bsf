<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/mms.css';?>"/>
<!--STYLE-->
<style type="text/css">
    .pan_box ul li label {width: 50%!important;}
	.bar1, .bar2, .bar3 {width: 18px;height: 3px;background-color: #009688;margin: 3px 0;transition: 0.4s;}
    .change .bar1 {-webkit-transform: rotate(-45deg) translate(-6px, 5px);transform: rotate(-45deg) translate(-6px,5px);}
    .change .bar2 {opacity: 0;}
    .change .bar3 {-webkit-transform: rotate(45deg) translate(-3px, -3px);transform: rotate(45deg) translate(-3px, -3px);}
    .flip0{float:right;margin-top:5px;cursor:pointer;}
	.flip0{float:right;margin-top:5px;cursor:pointer;}
	.lbl_ptb {padding-top: 3px!important;padding-bottom:3px !important;}
	.selected-xs{width:50%!important;border:0px solid #babdb8!important;}
    .selected-xs select{height:20px;color: #266aa8; padding-left:0px !important; font-size:13px !important;cursor:pointer;}
    .select-style {float: left;width: 100%;padding: 0;margin: 0;border: 1px solid #c2c2c2;overflow: hidden;background-color: #fff;border-radius: 0px;}
	.margn_8{margin-bottom:8px;}
	.pan_box{height:135px !important;}
	.lbl_mtb {margin-top: 3px!important;margin-bottom:3px !important;}

</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form method="post" id="formWrapper" action="<?php echo $this->basePath(); ?>/mms/transfer/tvsave">
<input type="hidden" id="FCompanyId" name="FCompanyId" value="<?php echo (isset($fcompany)) ? $fcompany['CompanyId'] : '';?>">
<input type="hidden" id="TCompanyId" name="TCompanyId" value="<?php echo (isset($tcompany)) ? $tcompany['CompanyId'] : '';?>">
<input type="hidden" id="FCostCenterId" name="FCostCenterId" value="<?php echo (isset($fcostcentre)) ? $fcostcentre['CostCentreId'] : '';?>">
<input type="hidden" id="TCostCenterId" name="TCostCenterId" value="<?php echo (isset($tcostcentre)) ? $tcostcentre['CostCentreId'] : '';?>">
<input type="hidden" id="tranRegId" name="tranRegId" value="<?php echo (isset($tranRegId)) ? $tranRegId : 0;?>">
<input type="hidden" id="gridtype" name="gridtype" value="<?php echo (isset($gridtype)) ? $gridtype : 0;?>">

<div class="col-lg-12">
    <h1 class="col-lg-3">Transfer - <span><?php echo (isset($vNo)) ? $vNo : ''; ?></span>
		<div class="flip0">
			<div class="click" onclick="myFunction(this)">
				<div class="bar1"></div>
				<div class="bar2"></div>
				<div class="bar3"></div>
			</div>
		</div>
	</h1>
</div>
<div class="col-lg-12">
	<div class="pane0">
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>From Company</label>
						<span class="mgic"><?php echo (isset($fcompany)) ? $fcompany['CompanyName'] : '';?></span>
					</li>
					<li class="lbl_ptb">
						<label>From Project</label>
						<span class="mgic"><?php echo (isset($fcostcentre)) ? $fcostcentre['CostCentreName'] : '';?></span>
					</li>
					<li class="lbl_ptb">
						<label>To Company</label>
						<span class="mgic"><?php echo (isset($tcompany)) ? $tcompany['CompanyName'] : '';?></span>
					</li>
					<li class="lbl_ptb">
						<label>To Project</label>
						<span class="mgic"><?php echo (isset($tcostcentre)) ? $tcostcentre['CostCentreName'] : '';?></span>
					</li>
					<li class="lbl_ptb">
						<label>Purchase Type</label>
						<span>
							<div class="select-style selected-xs margn_8">
								<select name="purchase_type" id="purchase_type" onchange="selAccount();" class="" data-placeholder="Select Purchase Type" style="width:100%;">
									<option value="" >Select Purchase Type</option>
									<?php foreach($purchaseType as $Purtype):
                                        if($Purtype['Default'] != 1){?>
                                        <option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ( (isset($purchasetype) && $Purtype['PurchaseTypeId'] == $purchasetype ) ) ? 'selected' : ""; ?>   ><?php echo $Purtype['PurchaseTypeName']; ?></option>
                                        <?php  } else { ?>
                                            <option value="<?php echo $Purtype['PurchaseTypeId']; ?>" <?php echo ($Purtype['Default'] == 1 ) ? 'selected' : ""; ?>><?php echo $Purtype['PurchaseTypeName']; ?></option>
                                        <?php  } ?><?php echo $Purtype['PurchaseTypeName']; ?></option>
									<?php endforeach; ?>
								</select>
							</div>
							<script>
								$(document).ready(function() {
									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});
								});

							</script>
						</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>Date</label>
						<span><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="TVDate" name="TVDate" style="cursor:pointer;" value="<?php echo (isset($TVDate)) ? $TVDate : date('d-m-Y');?>" readonly onchange="validateDate(this)"/></span>
					</li>
					<li class="lbl_ptb">
						<label>GP No</label>
						<span class="mgic"><input type="text" placeholder="xxxxx" id="GPNo" name="GPNo" value="<?php echo (isset($GPNo)) ? $GPNo : '';?>"/></span>
					</li>
					<li class="lbl_ptb">
						<label>GP Date</label>
						<span><input type="text" placeholder="DD-MM-YYYY" class="date_picker" id="GPDate" name="GPDate" style="cursor:pointer;" value="<?php echo (isset($gpdate)) ? $gpdate : date('d-m-Y');?>" onchange="validateDate(this)" readonly/></span>
					</li>
					<li class="lbl_ptb">
						<label>CCTransfer No</label>
						<?php if((((isset($tranRegId)) ? $tranRegId : 0) >0  || $CCTransfer['genType']==0)){?>
							<span><input type="text" placeholder="xxxxx" id="CCTVNo" name="CCTVNo" value="<?php echo (isset($CCTVNo)) ? $CCTVNo : '';?>"/></span>
						<?php }else{ ?>
							<span><input type="text" placeholder="xxxxx" id="CCTVNo" name="CCTVNo" value="<?php echo (isset($CCTVNo)) ? $CCTVNo : '';?>" readonly /></span>
						<?php } ?>
					</li>
					<li class="lbl_ptb">
						<label>Account Type</label>
						<span>
							<div class="select-style selected-xs margn_8">
								<select name="account_type" id="account_type" class="" data-placeholder="" style="width:100%;">
									<option value="" >Select Account Type</option>
									<?php if(isset($accType)) :?>
										<?php foreach($accType as $aType):?>

											<option value="<?php echo $aType['data']; ?>" <?php echo ( (isset($accounttype) && $aType['data'] == $accounttype) ) ? 'selected' : ''; ?>><?php echo $aType['value']; ?></option>

										<?php endforeach; ?>
									<?php endif; ?>

								</select>
							</div>
							<script>
								$(document).ready(function() {
									$(".single_dropdownpt").select2({
										placeholder: "",
										allowClear: true
									});
								});
							</script>
						</span>
					</li>

				</ul>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="pan_box zoomIn animated">
				<ul>
					<li class="lbl_ptb">
						<label>Transfer No</label>
						<span><input type="text" placeholder="xxxxx" id="TVNo" name="TVNo" value="<?php echo (isset($vNo)) ? $vNo : ''; ?> "readonly /></span>
					</li>
					<li class="lbl_ptb">
						<label>CTransfer No</label>
						<?php if((((isset($tranRegId)) ? $tranRegId : 0) >0  || $CTransfer['genType']==0)){?>
							<span><input type="text" placeholder="xxxxx" id="CTVNo" name="CTVNo" value="<?php echo (isset($CTVNo)) ? $CTVNo : '';?>"/></span>
						<?php }else{ ?>
							<span><input type="text" placeholder="xxxxx" id="CTVNo" name="CTVNo" value="<?php echo (isset($CTVNo)) ? $CTVNo : ''; ?>  "readonly /></span>
						<?php } ?>
					</li>
					<li class="">
						<label>Indirect</label>
						<label class="checkbox-styled lbl_mtb">
							<input type="checkbox"class="chkbx" checked="checked" id="chkIndirect"  name="chkIndirect" value="<?php echo (isset($indirect)) ? $indirect : ''; ?>" onchange="QualifierClear();" >
							<span></span>
						</label>
					</li>
					<li class="">
						<label>Adjustment</label>
						<label class="checkbox-styled lbl_mtb">
							<input type="checkbox" class="chkbx" name="chkAdjustment" id="chkAdjustment" value="<?php echo (isset($adjustment)) ? $adjustment : ''; ?>">
							<span></span>
						</label>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="clearfix"></div>
<div class="col-lg-12 clear top-20">
<div id="accordion" class="panel-group">
    <!-------------------------------Bill of Quantities------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
            <h4 class="panel-title accordion-toggle defa_panels">Transfer Quantity</h4>
        </div>
        <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="col-lg-12">
                    <div class="table-responsive top-30">
                        <table class="table" style=" margin-bottom:0px;" id="workorderTable">
                            <thead>
                            <tr>
                                <th>Description</th>
                                <th>Unit</th>
                                <th>Qty</th>
                                <th>Rate</th>
                                <th>QRate</th>
                                <th>BaseAmount</th>
                                <th>Amount</th>
                                <th>&nbsp;</th>
                                <th>&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody class="main"></tbody>
                        </table>
                        <input type="hidden" name="rowid" id="rowid" value="0"/>
                    </div>
                    <!----- sequantial view total --------->
                    <div class="col-lg-12 padlr0">
                        <table class="table" style=" margin-bottom:0px;display:none;" id="seqTotal">
                            <tbody class="total" id="listTotal">
                            <tr>
                                <td colspan="5">&nbsp;</td>
                                <td align="right" class="rate_pri">Total Amount</td>
                                <td width="10%" >
                                    <input class="parent_text border-none" type="text" name="total" id="total" readonly/>
                                    <input type="hidden" name="basetotal" id="basetotal"/>
                                </td>
                                <td>&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--------- end --------------->

                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:nextAccordian(3)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-------------------------------Bill of Quantities end------------------------------->
    <!-------------------------------Others Details------------------------------->
    <div class="panel panel-info">
        <div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
            <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
        </div>
        <div class="panel-collapse collapse" id="collapseThree" style="height: 0px;">
            <div class="panel-body bgcolr">
                <div class="clearfix"></div>
                <div class="col-lg-12">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#nar" id="narrationTabLink" onclick="showotherstabs('narration')" aria-controls="naration" role="tab" data-toggle="tab">Narration</a></li>
                        </ul>
                        <div class="tab-content" id="narration">
                            <div class="tab-pane active" id="nar">
                                <p>
                                <div class="col-lg-12">
                                    <?php
                                        if(isset($narration)){
                                    ?>
                                           <textarea class="exp-tex" name="Narration" id="Narration"> <?php echo (isset($narration)) ? $narration : 'Enter your Notes...';?> </textarea>
                                    <?php }else{ ?>
                                            <textarea class="exp-tex" name="Narration" id="Narration" placeholder="Enter your Notes..."></textarea>
                                        <?php } ?>
                                </div>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-------------------------------Others Details------------------------------->

</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r"><a onclick="submitForm()" data-toggle="tooltip" id="sub1" class="ripple" title="Submit">Submit</a>
        <li class="cancel_btn float_r">
			<?php if(isset($Approve) && $Approve=="N"): ?>
				<a href="<?php echo $this->basePath();?>/mms/transfer/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Close</a>
			<?php elseif (isset($Approve) && $Approve=='P'): ?>
				<a href="<?php echo $this->basePath();?>/mms/transfer/display-register" data-toggle="tooltip" class="ripple" title="Go to Register!">Back</a>
			<?php else: ?>
				<a href="<?php echo $this->basePath();?>/mms/transfer/tvwizard" data-toggle="tooltip" class="ripple" title="Close!">Close</a>
			<?php endif; ?>
		</li>
    </ul>
</div>
<!-- stock details for desc -->
<div class="modal fade" id="stockPOModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable"">
                        <thead>
                        </thead>
                        <tbody>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Estimate Qty</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="estimateQty" style="text-align:right;" class="parent_txts newRow"  value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Estimate Rate</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="estimateRate" style="text-align:right;" class="parent_txts newRow" value=""  readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Available Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="availableQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Excess Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="excessQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Requested Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="requestQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Bal Requested Qty</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="balrequestQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">PO Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="poQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Bal PO Qty</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="balancePO" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>

                        <tr>
                            <td width="50%">
                                <label class="pop_label">Min Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="minQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Bill Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="billQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Issue Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="issueQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Transfer Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="transferQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Bill Return Qty</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="billreturnQty" style="text-align:right;" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>
<!-------------------------------------------------------------------------------------->
<div class="modal fade" id="stockWBSModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" aria-hidden="true" class="close"><i class="fa fa-times"></i></button>
                <h4 class="modal-title" style="color:#18439d;">Stock Details</h4>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 commargin_top_20">
                    <div class="table-responsive clear">
                        <table class="table table-hover clear" id="contactTable"">
                        <tbody>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Estimate Qty</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="estimateWbsQty" class="parent_txts newRow"  value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Estimate Rate</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="estimateWbsRate" class="parent_txts newRow" value=""  readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Available Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="availableWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Excess Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="excessWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>

                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Balance PO</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="balanceWbsPO" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Total Purchase</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="totalWbsPurchase" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Request Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="requestWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">PO Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="poWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Min Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="minWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <label class="pop_label">Bill Quantity</label>
                            </td>
                            <td width="50%">
                                <input type="text" id="billWbsQty" class="parent_txts newRow" value="" readonly />
                            </td>
                        </tr>
                        </tbody>
                        </table>
                        <input type="hidden" class="parent_txts" name="" id="" value="" />
                    </div>
                </div>
            </div>
            <div class= "modal-footer clear">
                <div class="col-lg-12 savebtn_area no_border">
                    <ul>
                        <li class="cancel_btn float_r"><a href="javascript:void(0);" data-dismiss="modal" class="ripple">Close</a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>

<script id="resource-template"  type="text/template" class="hide">
    <?php
        $displayscreen="display:none";
        $displaymaintr="parent_text mainTr";
        if($gridtype == 1) {
            $displayscreen="display:none";
            $displaymaintr="parent_text mainTr";
        }
    ?>
    <tr id="click__" onclick="clickTr(this);" class="count-tr">
        <td width="25%">
            <input class="parent_text resourceSuggest" type="text" name="desc__" id="desc__" onfocus="checkResourceUsed(this);" />
            <input type="hidden" name="resourceid__" id="resourceid__"/>
        </td>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="unitname__"  style="text-align:center;" id="unitname__" readonly/>
            <input type="hidden" name="unitid__" id="unitid__"/>
            <input type="hidden" name="itemid__" id="itemid__"/>
        </td>

        <td width="12%" style="margin-bottom:5px;">
            <textarea class="expnd_box <?php echo $displaymaintr; ?>"  name="qty__" style="text-align:right;" id="qty__" onKeyPress="return isDecimal(event,this);" readonly></textarea>
            <span id="stock__" data-stock="" class="qty"></span>
        </td>

        <td width="15%"><input class="parent_text border-none" type="text" name="rate__" id="rate__" style="text-align:right;" onkeypress="return isDecimal(event,this)"  onchange="rateChange(this.id)"/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="qrate__" id="qrate__" style="text-align:right;" onkeypress="return isDecimal(event,this)" readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="baseamount__" style="text-align:right;" id="baseamount__" readonly/></td>
        <td width="15%"><input class="parent_text border-none" type="text" name="amount__" style="text-align:right;" id="amount__" readonly/></td>
        <td width="10%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="deleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a href="#" class="mainTr" id="expandTr__" style="display:none;"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
        <td width="2%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li><a onclick="return stockPODetails(this);"  id="expandSt__" style="display:none !important;" ><i class="fa fa-suitcase" data-toggle="modal" data-original-title="Stock Details" data-target="#stockPOModal" data-placement="left"></i></a></li>
            </ul>
        </td>
    </tr>

    <tr style="<?php echo $displayscreen; ?>;" class="subTr count-tr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="<?php echo $displayscreen; ?>;">
                <div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
                    <div class="card">
                        <ul class="nav nav-tabs">
                            <li class="active"><a class="ripple has-ripple" id="decisionTabLink__" onclick="showtabs('decision',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Decision<span class="ripple-wrapper animated" style="width: 89px; height: 89px; top: -41.5px; left: 22.9531px;"></span></a></li>
                            <li class=""><a class="ripple has-ripple" id="qualifierTabLink__" onclick="showtabs('qualifier',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Qualifier<span class="ripple-wrapper animated" style="width: 105px; height: 105px; top: -29.5px; left: 16.9531px;"></span></a></li>
                            <li class=""><a class="ripple has-ripple" id="whTableLink__" onclick="showtabs('wh',this.id,event)" style="position: relative; overflow: hidden;cursor:pointer;"> Warehouse<span class="ripple-wrapper animated"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="tab-content">
                        <div class="table-responsive topsp">
                            <table class="table" style="margin-bottom:0px;" id="decisionTable__">
                                <thead>
                                <tr>
                                    <th class="worktype-activity">Decision No</th>
                                    <th class="worktype-activity">BalQty</th>
                                    <th>Qty</th>
                                    <th class="iow___requestfields" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="iow___rowid" id="iow___rowid" value="0"/>
                            </table>
                            <table class="table" style="margin-bottom:0px;display: none;" id="wbsTable__">
                                <thead>
                                <tr>
                                    <th class="worktype-activity">WBS Name</th>
                                    <th>Qty</th>
                                    <th class="wbs___requestfields" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="wbs___rowid" id="wbs___rowid" value="0"/>
                            </table>
                            <table class="table" style="margin-bottom:0px; display: none;" id="qualifierTable__" onchange="CalculateRate(this.id)">

                            </table>
                            <table class="table" style="margin-bottom:0px; display:none;" id="whTable__">
                                <thead>
                                <tr>
                                    <th class="worktype-activity">Warehouse Name </th>
                                    <th class="worktype-activity">Description </th>
                                    <th class="worktype-activity">ClosingStock </th>
                                    <th class="worktype-activity">Qty </th>
                                    <th class="" style="display: none;">&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody class="main"></tbody>
                                <tbody class="total">
                                </tbody>
                                <input type="hidden" name="wh___rowid" id="wh___rowid" value="0"/>
                            </table>
                            <div class="tab-content">
                                <div class="table-responsive topsp">
                                    <table class="table" style="margin-bottom:0px; display: none;" id="reqspeTable__">
                                        <!--										<thead>-->
                                        <!--											<tr>-->
                                        <!--												<th class="worktype-activity">Resource Specification</th>-->
                                        <!--											</tr>-->
                                        <!--										</thead>-->
                                        <tbody class="main"></tbody>
                                        <tbody class="total">
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </td>
    </tr>
</script>
<!--<script id="iow-warehouse"  type="text/template" class="hide">-->
<!--    <tr class="subTr dont-hide">-->
<!--        <td width="20%">-->
<!--            <input  type="text" name="wh___warehousename_0" id="wh___warehousename_0" />-->
<!--            <input type="hidden" name="wh___warehouseid_0" id="wh___warehouseid_0"/>-->
<!--            <input  type="hidden" name="wh___stockid_0" id="wh___stockid_0" />-->
<!--        </td>-->
<!--        <td width="20%">-->
<!--            <input  type="text" name="wh___desc_0" id="wh___desc_0" readonly/>-->
<!--        </td>-->
<!--        <td width="20%">-->
<!--            <input  type="text" name="wh___closingstock_0" id="wh___closingstock_0" readonly/>-->
<!--        </td>-->
<!--        <td width="20%">-->
<!--            <input class="parent_text chqty" type="text" name="wh___qty_0" id="wh___qty_0" onkeypress="return isNumberKey(event,this);" onchange="checkWHQuantity(this);" />-->
<!--            <input type="hidden" name="iow__hiddenqty_0" id="iow__hiddenqty_0" value="0"/>-->
<!--        </td>-->
<!--    </tr>-->
<!--</script>-->

<script id="iow-template"  type="text/template" class="hide">
    <tr class="dont-hide">
        <td width="20%" class="worktype-activity">
            <input class="parent_text border-none" type="text" name="iow___decisionno_0" id="iow___decisionno_0" readonly/>
            <input type="hidden" name="iow___decisionid_0" id="iow___decisionid_0"/>
            <input type="hidden" name="iow___dectransid_0" id="iow___dectransid_0"/>
            <input type="hidden" name="iow___reqtransid_0" id="iow___reqtransid_0"/>
            <input type="hidden" name="iow___resourceid_0" id="iow___resourceid_0"/>
            <input type="hidden" name="iow___itemid_0" id="iow___itemid_0"/>
        </td>
        <td width="30%"><input class="parent_text border-none" type="text" name="iow___balqty_0" id="iow___balqty_0" style="text-align:right;" readonly/></td>
        <td width="30%">
            <input class="parent_text <?php echo $displaymaintr; ?>" type="text" name="iow___qty_0" id="iow___qty_0" style="text-align:right;" onkeypress="return isDecimal(event,this)" onfocus="checkWarehouse(this);" readonly/>
            <input type="hidden" name="iow__hiddenqty_0" id="iow__hiddenqty_0"/>
        </td>
        <td width="10%" align="center" class="action_btns_td iow___requestfields" style="display: none;">
            <ul class="action_btns">
                <li><a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a> </li>
            </ul>
        </td>
    </tr>
    <tr style="<?php echo $displayscreen; ?>" class="subTr dont-hide">
        <td colspan="9" style="padding:0px !important;">
            <div class="subDiv" style="<?php echo $displayscreen; ?>">
                <div class="table-responsive topsp">
                    <table class="table" style="margin-bottom:0px;" id="whTable___wbs_0_whreqno">
                        <thead>
                        <tr>
                            <th class="worktype-activity">Warehouse Name </th>
                            <th class="worktype-activity">Description </th>
                            <th class="worktype-activity">ClosingStock </th>
                            <th class="worktype-activity">Qty </th>
                            <th class="" style="display: none;">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="ware"></tbody>
                        <tbody class="total">
                        </tbody>

                    </table>
                    <input type="hidden" name="wh___wbs_0_wrowid" id="wh___wbs_0_wrowid" value="0"/>
                </div>
            </div>
        </td>
    </tr>
</script>
<script id="issue-warehouse"  type="text/template" class="hide">
    <tr class="subTr dont-hide er">
        <td width="20%">
            <input  type="text" name="wh___wbs_0_warehousename__7" id="wh___wbs_0_warehousename__7" />
            <input type="hidden" name="wh___wbs_0_warehouseid__7" id="wh___wbs_0_warehouseid__7"/>
            <input  type="hidden" name="wh___wbs_0_stockid__7" id="wh___wbs_0_stockid__7" />
        </td>
        <td width="20%">
            <input  type="text" name="wh___wbs_0_desc__7" id="wh___wbs_0_desc__7" readonly/>
        </td>
        <td width="20%">
            <input  type="text" name="wh___wbs_0_closingstock__7"  style="text-align:right;" id="wh___wbs_0_closingstock__7" readonly/>
        </td>
        <td width="20%">
            <input class="parent_text chqty" type="text" name="wh___wbs_0_qty__7" style="text-align:right;" id="wh___wbs_0_qty__7" style="text-align:right;" onkeypress="return isDecimal(event,this);" onchange="checkWWHQty(this);" />
            <input type="hidden" name="wh___wbs_0_hiddenqty__7" id="wh___wbs_0_hiddenqty__7" value="0"/>
        </td>
    </tr>
</script>


<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/paging.css';?>"/>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/paging.js"></script>
<script type="text/javascript">
var arr_resources = <?php echo (isset($arr_resources)) ? json_encode($arr_resources) : '[]';?>;
var tmp_arr_resources = arr_resources;
var arr_requestResources = <?php echo (isset($arr_requestResources)) ? json_encode($arr_requestResources) : '[]';?>;
var arr_resource_iows = <?php echo (isset($arr_resource_iows)) ? json_encode($arr_resource_iows) : '[]';?>;
var arr_resource_iow_requests = <?php echo (isset($arr_resource_iow_requests)) ? json_encode($arr_resource_iow_requests) : '[]';?>;
var arr_sel_warehouse = <?php echo (isset($arr_sel_warehouse)) ? json_encode($arr_sel_warehouse) : '[]';?>;
var arr_sel_tvwarehouse = <?php echo (isset($arr_sel_tvwarehouse)) ? json_encode($arr_sel_tvwarehouse) : '[]';?>;
var mode = <?php echo $tranRegId; ?>;
var qualiferHTML = '<?php echo (isset($qualHtml)) ? preg_replace('~>\s+<~', '><',$qualHtml) : '';?>';
$(function () {
    var $rowid = $('#rowid');
    var template = $('#resource-template').html();
    var iowtemplate = $('#iow-template').html();
    var waretemplate = $('#iow-warehouse').html();
    var requesttemplate = $('#issue-warehouse').html();

    var rowid = 0;
    var $tbody = $('#workorderTable').find('> tbody.main');
    if(arr_requestResources.length != 0) {

        $.each(arr_requestResources, function(i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));
            $('#desc_' + rowid).val(o.Desc).addClass('border-none').prop('disabled', true);
            $('#resourceid_' + rowid).val(o.ResourceId);
            $('#itemid_' + rowid).val(o.ItemId);
            $('#unitname_' + rowid).val(o.UnitName);
            $('#unitid_' + rowid).val(o.UnitId);
            $('#qty_' + rowid).val(o.Qty);
            $('#rate_' + rowid).val(o.Rate);
            $('#qrate_' + rowid).val(o.QRate);
            $('#baseamount_' + rowid).val(o.BaseAmount);
            $('#amount_' + rowid).val(o.Amount);
            $('#hiddenqty_' + rowid).val(o.HiddenQty);
            $('#expandTr_' + rowid).show();
            $('#deleteTr_' + rowid).show();
            $('#expandSt_' + rowid).show();
            $('#expandRt_' + rowid).show();

            var whsCount = 0;
            var wbsCount = 0;

            $.each(arr_resource_iows, function (j, l) {
                if ((l.ResourceId != o.ResourceId || l.ItemId != o.ItemId)) {
                    return;
                }
                if(mode != 0) {
                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    wbsCount = wbsCount + 1;

                    /////////////////////////////////////
                    if (<?php echo (isset($tranRegId)) ? $tranRegId : 0;?> > 0 ) {
                        var RId = o.ResourceId;
                        var ItId = o.ItemId;
                        var tRegId = <?php echo (isset($tranRegId)) ? $tranRegId : 0;?>;
                        $.ajax({
                            url: getBaseURL() + 'mms/transfer/tventry',
                            type: "post",
                            data: "ResourceId=" + RId + "&tRId=" + tRegId + "&ItemId=" + ItId + "&Type=getqualdetails",
                            async: false,
                            success: function (data, textStatus, jqXHR) {
                                if (jqXHR.status == 200) {
                                    data = JSON.parse(data);
                                    $('#qualifierTable_' + rowid).html(data.replace(/__1/g, '_' + rowid));
                                }
                                $('.loading_area').hide();
                            }, error: function (jqXHR, textStatus, errorThrown) {
                                $('.loading_area').hide();
                            }
                        });
                    }
                    $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
                    $('#iow_' + rowid + '_dectransid_' + iowrowid).val(l.DecTransId);
                    $('#iow_' + rowid + '_reqtransid_' + iowrowid).val(l.ReqTransId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                    //start warehouse
                    if (arr_sel_warehouse.length != 0) {
                        var findReturnWH = arr_sel_warehouse.filter(function (obj) {
                            return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                        });
                        if (findReturnWH.length > 0) {
                            $.each(arr_sel_warehouse, function (m, n) {
                                if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId) {
                                    return;
                                }
                                whsCount = whsCount + 1;
                                var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requesttemplate
                                    .replace(/__7/g, '_' + whrowid)
                                    .replace(/_0/g, '_' + iowrowid)
                                    .replace(/__/g, '_' + rowid));

                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).val(n.WareHouseName);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).val(n.Description);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(n.Qty);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).val(n.ClosingStock);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(n.Qty);
                                $.each(arr_sel_tvwarehouse, function (s, t) {
                                    if (l.DecTransId == t.DecTransId && n.WareHouseId == t.WareHouseId && o.ResourceId == t.ResourceId && o.ItemId == t.ItemId && t.Qty > 0) {
                                        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(t.Qty);
                                    }
                                });
                            });
                        } else {
                            $('.er').hide();
                        }
                    }
                    if (whsCount == 0) {
                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                        $('#iow_' + rowid + '_qty_' + iowrowid).removeClass('mainTr');
                        $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcDecQuantity(this)');
                        $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                    }
                    //end of warehouse
                } else{

                    var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    $('#iow_' + rowid + '_rowid').val(iowrowid);
                    wbsCount = wbsCount + 1;
                    $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
                    $('#iow_' + rowid + '_dectransid_' + iowrowid).val(l.DecTransId);
                    $('#iow_' + rowid + '_reqtransid_' + iowrowid).val(l.ReqTransId);
                    $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
                    $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
                    $('#iow_' + rowid + '_hiddenqty_' + iowrowid).val(l.HiddenQty);
                    $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
                    //start warehouse
                    if (arr_sel_warehouse.length != 0) {
                        var findReturnWH = arr_sel_warehouse.filter(function (obj) {
                            return (obj.ResourceId === o.ResourceId && obj.ItemId === o.ItemId);
                        });
                        if (findReturnWH.length > 0) {
                            $.each(arr_sel_warehouse, function (m, n) {
                                if (o.ResourceId != n.ResourceId || o.ItemId != n.ItemId) {
                                    return;
                                }
                                whsCount = whsCount+1;
                                var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requesttemplate
                                    .replace(/__7/g, '_' + whrowid)
                                    .replace(/_0/g, '_' + iowrowid)
                                    .replace(/__/g, '_' + rowid));

                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).val(n.WareHouseName);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).val(n.Description);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(n.Qty);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).val(n.ClosingStock);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(n.Qty);
                            });
                        } else {
                            $('.er').hide();
                        }
                    }
                    if(whsCount == 0){
                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                        $('#iow_' + rowid + '_qty_' + iowrowid).removeClass('mainTr');
                        $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcDecQuantity(this)');
                        $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                    }
                    //end of warehouse
                }
                CalculateRate('#qualifierTable_' + rowid);
                $('#whTableLink_' + rowid).hide();
            });
            if(wbsCount == 0){
                $('#qty_' + rowid).attr('onfocus', 'calcQty(this)');
                $('#qty_' + rowid).prop("readonly", false);
            }
            calcTotal();
            rateChange('#rate_' + rowid);
        });
    }
    rowid += 1;
    $tbody.append(template.replace(/__/g, '_' + rowid));
    $rowid.val(rowid);
    $('#seqTotal').show();
    bindResourceAutocomplete();

    $('.content_wrapper').on('click','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });

    $('.content_wrapper').on('keyup','.mainTr',function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });
    nextAccordian(1);

    if('<?php echo (isset($gridtype)) ? $gridtype : 0;?>' == 0) {
        //paging
        $('#workorderTable').paging({limit: 2});
        $('.paging-nav').children('a[data-page=0]').trigger('click');
    }
});

$('#jqxbutton').click(function () {
    $("#treeGrid").jqxTreeGrid('expandAll');
    $('#jqxbutton').hide();
    $('#jqxbuttorenn').show();
});

$('#jqxbuttorenn').click(function () {
    $("#treeGrid").jqxTreeGrid('render');
    $('#jqxbutton').show();
    $('#jqxbuttorenn').hide();
});

function submitForm() {
    if($('#purchase_type').val() == '') {
        alert('Please select Purchase Type');
        return false;
    }
    if($('#account_type').val() == '') {
        alert('Please select Account Type');
        return false;
    }
    var tCount =  $('#workorderTable tbody tr').length;
    if(tCount == 1){
        alert('No Resource');
        return false;
    }
    var rowCountqty= parseInt($('#rowid').val()-1);
    for(var i=1;i<=rowCountqty;i++) {
        if ($('#qty_' + i).val() == "" || $('#qty_' + i).val() == 0) {
            alert('Zero Quantity Exists!');
            return false;
        }
    }

    for(var i=1;i<=rowCountqty;i++) {
        if ($('#rate_' + i).val() == "" || $('#rate_' + i).val() == 0) {
            alert('Zero Rate Exists!');
            return false;
        }
    }

    var elem = document.getElementById("chkAdjustment");
    if (elem.checked == false){
        elem.checked = true;
        elem.value = "off"
    }

//    var is_warehouse = <?php //echo (isset($isWh)) ? json_encode($isWh) : '[]';?>//;
//    var rowCountqty= parseInt($('#rowid').val()-1);
//    if(is_warehouse.length > 0)
//    {
//        for (i = 1; i <= rowCountqty; i++) {
//            var whrow = $('#wh_' + i + '_rowid').val();
//            var rqty = parseFloatVal($('#qty_' + i).val());
//            var add = 0.0;
//            for (j = 1; j <= whrow; j++) {
//                add += parseFloatVal($('#wh_' + i + '_qty_' + j).val());
//            }
//
//            if (parseFloatVal(rqty) != parseFloatVal(add)) {
//                alert('Kindly adjust the WareHouse Qty');
//                return false;
//            }
//        }
//    }
    $('#formWrapper').submit();
}

function checkWWHQty(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var whrowid = ids[5];
    var totalQty=0;
    var add=0;

    var closingstock=parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).val());
    var assoc = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val());

    if (!isNaN(assoc) && !isNaN(closingstock) && assoc > closingstock) {
        alert('WareHouse Qty is exceed from closingstock');
        $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(000).trigger('change');
    } else {
        $.each($('input[id*=wh_' + rowid + '_wbs_' + iowrowid + '_qty_'), function (i, o) {
            add += parseFloatVal($(this).val()) || 0;
        });
        $('#iow_' + rowid + '_qty_' + iowrowid).val(add,00);
        $('#qty_' + rowid).val(add,00);

        $.each($('input[id^=iow_'+rowid+'_qty_'), function (i,o) {
            var qty = parseFloatVal($(this).val());
            if(isNaN(qty))
                qty = 0;
            totalQty += qty;
        });
        var sVal = parseInt($('#stock_' + rowid).attr('data-stock'));
        if (totalQty > sVal) {
            showError($('#qty_' + rowid), "Greater than Closing Stock");
            errorFlag = 1;
        } else {
            removeError($('#qty_' + rowid));
            errorFlag = 0;
        }
        $('#qty_'+rowid).val(parseFloatVal(totalQty,0));
        // calc total amount
        var rate = parseInt($('#rate_' + rowid).val());
        var qrate = parseInt($('#rate_' + rowid).val());

        $('#amount_' + rowid).val(parseInt(totalQty * qrate));
        $('#qrate_' + rowid).val(parseFloatVal(qrate));
        $('#baseamount_' + rowid).val(parseInt(totalQty * rate));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
    }
}
function bindResourceDecisionTrans(x) {
    var rowid = $(x)[0].id.split('_')[1];
    var resid=$('#resourceid_'+rowid).val();
    var itemid=$('#itemid_'+rowid).val();
    var ccid = $('#TCostCenterId').val();
    var data = {};

    data.Type='autoDec';
    data.ResourceId=resid;
    data.ItemId=itemid;
    data.CostCentreId=ccid;
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'mms/transfer/tventry',
        type: "post",
        data: data,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                data = JSON.parse(data);

                var whsCount = 0;
                var wbsCount = 0;
                var iowtemplate = $('#iow-template').html();
                var requesttemplate = $('#issue-warehouse').html();
                $.each(data['decision'], function (i,l) {
                    if ((l.ResourceId != resid || l.ItemId != itemid)) {
                        return;
                    }
                    var iowrowid = parseInt($('#iow_'+rowid+'_rowid').val()) + 1;
                    $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
                    wbsCount = wbsCount + 1;
                    $('#iow_'+rowid+'_rowid').val(iowrowid);
                    $('#iow_'+ rowid +'_decisionid_'+ iowrowid).val(l.DecisionId);
                    $('#iow_'+ rowid +'_dectransid_'+ iowrowid).val(l.DecTransId);
                    $('#iow_'+ rowid +'_reqtransid_'+ iowrowid).val(l.ReqTransId);
                    $('#iow_'+ rowid +'_resourceid_'+ iowrowid).val(l.ResourceId);
                    $('#iow_'+ rowid +'_itemid_'+ iowrowid).val(l.ItemId);
                    $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
                    $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
                    $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
                    //start warehouse
                    if (data['warehouse'].length != 0) {
                        var findReturnWH = data['warehouse'].filter(function (obj) {
                            return (obj.ResourceId === l.ResourceId && obj.ItemId === l.ItemId);
                        });
                        if (findReturnWH.length > 0) {
                            $.each(data['warehouse'], function (m, n) {
                                if (l.ResourceId != n.ResourceId || l.ItemId != n.ItemId) {
                                    return;
                                }
                                whsCount = whsCount+1;
                                var whrowid = parseInt($('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val()) + 1;
                                $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').find('> tbody.ware').append(requesttemplate
                                    .replace(/__7/g, '_' + whrowid)
                                    .replace(/_0/g, '_' + iowrowid)
                                    .replace(/__/g, '_' + rowid));

                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_wrowid').val(whrowid);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehouseid_' + whrowid).val(n.WareHouseId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_warehousename_' + whrowid).val(n.WareHouseName);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_stockid_' + whrowid).val(n.StockId);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_desc_' + whrowid).val(n.Description);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_qty_' + whrowid).val(n.Qty);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_closingstock_' + whrowid).val(n.ClosingStock);
                                $('#wh_' + rowid + '_wbs_' + iowrowid + '_hiddenqty_' + whrowid).val(n.Qty);
                            });
                        }
                    }
                    if(whsCount == 0){
                        $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').hide();
                        $('#iow_' + rowid + '_qty_' + iowrowid).removeClass('mainTr');
                        $('#iow_' + rowid + '_qty_' + iowrowid).attr('onchange', 'calcDecQuantity(this)');
                        $('#iow_' + rowid + '_qty_' + iowrowid).prop("readonly", false);
                    }
                    //end of warehouse
                    CalculateRate('#qualifierTable_' + rowid);
                    $('#whTableLink_' + rowid).hide();
                });
                if(wbsCount == 0){
                    $('#qty_' + rowid).attr('onfocus', 'calcQty(this)');
                    $('#qty_' + rowid).prop("readonly", false);
                }
            }
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }
    });
}

//function bindResourceDecisionTrans(x) {
//    var rowid = $(x)[0].id.split('_')[1];
//    var resid=$('#resourceid_'+rowid).val();
//    var itemid=$('#itemid_'+rowid).val();
//    var ccid = $('#TCostCenterId').val();
//
//
//    $('.loading_area').show();
//    $.ajax({
//        url: getBaseURL() + 'mms/purchase/order-entry',
//        type: "post",
//        data: "CostCentreId=" + ccid +"&Type=wbs&ResourceId=" + resid +"&ItemId=" + itemid ,
//        async: false,
//        success: function (data, textStatus, jqXHR) {
//            if(jqXHR.status == 200) {
//                data = JSON.parse(data);
//                console.log(data);
//                if((data.dec).length != 0) {
//                    var iowtemplate = $('#iow-template').html();
//                    $.each(data.dec, function (i, l) {
//                        var iowrowid = parseInt($('#iow_' + rowid + '_rowid').val()) + 1;
//                        $('#decisionTable_' + rowid).find('> tbody.main').append(iowtemplate.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + iowrowid));
//                        $('#wbsTable_'+rowid).hide();
//                        $('#decisionTable_'+rowid).show();
//                        $('#decisionTabLink_'+rowid).show();
//                        $('#wbsTabLink_'+rowid).hide();
//                        $('#iow_' + rowid + '_rowid').val(iowrowid);
//                        $('#iow_' + rowid + '_decisionid_' + iowrowid).val(l.DecisionId);
//                        $('#iow_' + rowid + '_dectransid_' + iowrowid).val(l.DecTransId);
//                        $('#iow_' + rowid + '_reqtransid_' + iowrowid).val(l.ReqTransId);
//                        $('#iow_' + rowid + '_resourceid_' + iowrowid).val(l.ResourceId);
//                        $('#iow_' + rowid + '_itemid_' + iowrowid).val(l.ItemId);
//                        $('#iow_' + rowid + '_decisionno_' + iowrowid).val(l.DecisionNo);
//                        $('#iow_' + rowid + '_balqty_' + iowrowid).val(l.BalQty);
//                        $('#iow_' + rowid + '_qty_' + iowrowid).val(l.Qty);
//
//                    });
//                }
//            }
//            $('.loading_area').hide();
//        }, error: function (jqXHR, textStatus, errorThrown) {
//            $('.loading_area').hide();
//        }
//    });
//
//}

function deleteRow(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('.subTr').remove();
    //$tr.next('.subTr').remove();
    $tr.remove();
    calcTotal();
    //paging
    var f = parseInt($(".paging-nav").find('.selected-page').html())-1;
    $('.paging-nav').remove();
    thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
    setTimeout(function() {
        $('.paging-nav').children('a[data-page='+f+']').trigger('click');
    },100);
    return false;
}

function nextAccordian(id) {
    $('#panelheading-' + id).trigger('click');
}

function calcQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name=ids[0];
    if(name == 'iow') {

        // calc total qty
        var totalQty = 0;
        $.each($('input[id^=iow_' + rowid + '_qty_'), function (i, o) {
            var qty = parseFloatVal($(this).val());
            if (isNaN(qty))
                qty = 0;

            totalQty += qty;
        });
        var sVal = parseInt($('#stock_' + rowid).attr('data-stock'));
        if (totalQty > sVal) {
            showError($('#qty_' + rowid), "Greater than Closing Stock");
            errorFlag = 1;
        } else {
            removeError($('#qty_' + rowid));
            errorFlag = 0;
        }

        $('#qty_' + rowid).val(parseFloatVal(totalQty, 0));

        // calc total amount
        var rate = parseInt($('#rate_' + rowid).val());
        var qrate = parseInt($('#qrate_' + rowid).val());

        $('#amount_' + rowid).val(parseInt(totalQty * qrate));
        $('#baseamount_' + rowid).val(parseInt(totalQty * rate));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
        //TermsAutoRefresh();
    }
}
function calcDecQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];


    var balqty=parseFloatVal($('#iow_' + rowid + '_balqty_' + iowrowid ).val());
    var curqty=parseFloatVal($('#iow_' + rowid + '_qty_' + iowrowid).val());
    var hiddenqty=parseFloatVal($('#iow_' + rowid + '_hiddenqty_' + iowrowid).val());

    if((curqty-hiddenqty)>balqty)
    {
        alert('Qty should not exceed balance quantity');
        $('#iow_' + rowid + '_qty_' + iowrowid).val(0);
    }

    calcQuantity(x);
}

function calcRequestQuantity(x) {
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var balqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_balqty_' + requestrowid).val());
    var curqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val());
    var hiddenqty=parseFloatVal($('#iow_' + rowid + '_request_' + iowrowid + '_hiddenqty_' + requestrowid).val());

    if((curqty-hiddenqty)>balqty)
    {
        alert('Qty should not exceed balance quantity');
        $('#iow_' + rowid + '_request_' + iowrowid + '_qty_' + requestrowid).val(0);
    }

    // calc total qty
    var totalQty=0;
    $.each($('input[id^=iow_'+rowid+'_request_'+iowrowid+'_qty_'), function (i,o) {
        var qty = parseFloatVal($(this).val());
        if(isNaN(qty))
            qty = 0;

        totalQty += qty;
    });

    if(totalQty > $('#iow_'+rowid+'_request_'+iowrowid+'_estimateqty').val()) {
        showError($x, 'Qty should not exceed estimate qty!');
        return;
    } else {
        removeError($x);
    }

//        $('#iow_'+rowid+'_request_'+iowrowid+'_totbilledqty').val(sanitizeNumber(totalQty,0));
    $('#iow_'+rowid+'_qty_'+iowrowid).val(parseFloatVal(totalQty,0)).trigger('change');
}

function calcWbsQuantity(x) {

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var name=ids[0];
    if(name == 'wbs') {
        // calc total qty
        var totalQty = 0;
        $.each($('input[id^=wbs_' + rowid + '_qty_'), function (i, o) {
            var qty = parseFloatVal($(this).val());
            if (isNaN(qty))
                qty = 0;

            totalQty += qty;
        });

        $('#qty_' + rowid).val(parseFloatVal(totalQty, 0));

        // calc total amount
        var rate = parseInt($('#rate_' + rowid).val());
        var qrate = parseInt($('#qrate_' + rowid).val());

        $('#amount_' + rowid).val(parseInt(totalQty * qrate));
        $('#baseamount_' + rowid).val(parseInt(totalQty * rate));
        calcTotal();
        var vname = '#qualifierTable_' + rowid;
        CalculateRate(vname);
        //TermsAutoRefresh();
    }
}

function calcTotal() {
    var total = 0;
    var btotal = 0;

    $.each($('input[id^=amount_]'), function (i,o) {
        total += parseFloatVal($(this).val());
    });

    $.each($('input[id^=baseamount_]'), function (i,o) {
        btotal += parseFloatVal($(this).val());
    });

    $('#total').val(sanitizeNumber(total));
    $('#basetotal').val(sanitizeNumber(btotal));
}

function bindResourceAutocomplete() {

    // bind resource autocomplete
    $('#workorderTable .resourceSuggest').autocomplete({
        lookup: tmp_arr_resources,
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {

            if (suggestion) {
                var $this = $(this);
                var rowid = $this[0].id.split('_')[1];
                var reskeyid = $('input[id*=resourceid_] ') ;
                var bRet=false;
                $.each(reskeyid, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    var arrname = name.split('_');
                    var key1 = arrname[1];

                    if (key1 != rowid) {
                        if ($this.val() == suggestion.data && $('#itemid_' + key1).val() == suggestion.ItemId) {
                            bRet = true;
                        }
                    }
                });
                if(bRet == false) {
                    $this.prop('readonly', true).addClass('border-none');
                    $('#desc_' + rowid).val(suggestion.value).addClass('border-none').prop('disabled', true);
                    $('#resourceid_' + rowid).val(suggestion.data);
                    $('#itemid_' + rowid).val(suggestion.ItemId);
                    $('#unitname_' + rowid).val(suggestion.UnitName);
                    $('#unitid_' + rowid).val(suggestion.UnitId);
                    $('#rate_' + rowid).val(suggestion.Rate);
                    $('#qrate_' + rowid).val(suggestion.Rate);
                    $('#expandTr_' + rowid).show();
                    $('#deleteTr_' + rowid).show();
                    $('#expandSt_' + rowid).show();
                    $('#expandRt_' + rowid).show();
                    addNewResourceRow($this);
                    bindResourceDecisionTrans($this);
                    //bindResourceDecisionAnalTrans($this);

                }
                else
                {
                    alert('Already added in list');
                    $('#desc_' + rowid).val('');
                    return;
                }

            }
        }, onSearchStart: function (suggestion) {
            var rowid = $(this)[0].id.split('_')[1];
            $('#unitname_' + rowid).val('');
            $('#rate_' + rowid).val('');
        }, onSearchComplete: function (query, suggestions) {
            if(!suggestions.length) {
                var rowid = $(this)[0].id.split('_')[1];
                $('#unitname_' + rowid).val('');
                $('#rate_' + rowid).val('');
            }
        }
    });
}
function addNewResourceRow(x) {

    var $tr = $(x).closest('tr');
    if ($tr.next('tr:not(.subTr)').length != 0)
        return;

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val()),
        $tbody = $('#workorderTable').find('> tbody.main');

    $('#deleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#resource-template').html();

    template = template.replace(/__/g, '_' + count);
    $tbody.append(template);
    $('#qualifierTable_' + rowid).html(qualiferHTML.replace(/__1/g, '_' + rowid));
    $rowid.val(count);
    bindResourceAutocomplete();
    //paging
    var f = parseInt($(".paging-nav").find('.selected-page').html())-1;
    $('.paging-nav').remove();
    thisVal._getNavBar($('#workorderTable').find('> tbody.main >tr'));
    setTimeout(function() {
        $('.paging-nav').children('a[data-page='+f+']').trigger('click');
    },100);
}
function checkResourceUsed(x) {
    var id = $(x)[0].id.split('_')[1];
    var reskeyid = $('input[id*=resourceid_] ') ;
    var itemkeyid=$('input[id*=itemid_]');

    tmp_arr_resources = arr_resources;
    tmp_arr_resources = $.grep(arr_resources, function (element, index) {

        var is_selected = true;
        $.each(reskeyid, function (i, obj) {

            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];

            if (key1 != id) {
                if (element.data == $this.val() && itemkeyid[0].value == element.ItemId) {
                    is_selected = false;
                    return false;
                }
            }
        });

        return is_selected;
    });
    bindResourceAutocomplete();
}
//function checkAlreadyUsedItem(x) {
//    var id = $(x)[0].id.split('_')[1];
//    var resid = $('#resourceid_' + id).val();
//    var itemid=$('#itemid_' + id).val();
//    var reskeyid = $('input[id*=resourceid_] ') ;
//
//    var bRet=false;
//    $.each(reskeyid, function (i, obj) {
//
//        var $this = $(this),
//            name = $this[0].id;
//        var arrname = name.split('_');
//        var key1 = arrname[1];
//
//        if (key1 != id ) {
//            if ($this.val() == resid && $('#itemid_' + key1).val() == itemid) {
//
//                bRet = true;
//                return;
//            }
//        }
//    });
//    return bRet;
//}
//$('#purchase_type').change(function() {
//    var ptypeId = $(this).val();
//    alert(ptypeId);
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/purchase/order-entry',
//        data: "ptypeId="+ptypeId+"&Type=selectAccount",
//        dataType: "json",
//        success: function(data){
//            $("#account_type").html('');
//            $("#account_type").append("<option value='0'>Select Account Type</option>");
//            $.each(data['resultAcc'], function(i,v){
//                $("#account_type").append("<option value='"+v.data+"'>"+v.value+"</option>");
//            });
//            $("#account_type").selectpicker('refresh');
//        }
//
//    });
//});
//
//
//
//
//$('#warehouse').change(function() {
//    var whtransid=$(this).val();
//    if(whtransid == 0)
//    {
//        $('#whaddress').val('');
//    }
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/purchase/order-entry',
//        data: "whtransid="+whtransid+"&Type=selectWHAddress",
//        dataType: "json",
//        success: function(data,textStatus,jqXHR){
//            if(jqXHR.status == 200) {
//                $('#whaddress').val(data['whaddress']);
//            }
//        }, error: function (jqXHR, textStatus, errorThrown) {
//            $('#whaddress').val('');
//        }
//    });
//});
function showtabs(type,id,event) {
    event.preventDefault();
    $('#' + id).parent('li').addClass('active').siblings('li').removeClass('active');
    var rowid = id.split('_')[1];
    if (type=="decision") {
        $('#decisionTable_'+rowid).show();
        $('#qualifierTable_'+rowid).hide();
        $('#whTable_'+rowid).hide();

    } else if (type=="qualifier") {
        $('#qualifierTable_'+rowid).show();
        $('#decisionTable_'+rowid).hide();
        $('#whTable_'+rowid).hide();
    }
    else
    {
        $('#whTable_'+rowid).show();
        $('#decisionTable_'+rowid).hide();
        $('#qualifierTable_'+rowid).hide();

    }
    return false;
}

//function showotherstabs(type) {
//    if (type=="narration") {
//        $('#narration').show();
//        $('#branchdetails').hide();
//        $('#deliverydetails').hide();
//        $('#vendorcontact').hide();
//        $('#cccontact').hide();
//        $('#ccontact').hide();
//    }
//    else if(type == "branch"){
//        $('#branchdetails').show();
//        $('#narration').hide();
//        $('#deliverydetails').hide();
//        $('#vendorcontact').hide();
//        $('#cccontact').hide();
//        $('#ccontact').hide();
//    }
//    else if(type == "delivery")
//    {
//        $('#deliverydetails').show();
//        $('#branchdetails').hide();
//        $('#narration').hide();
//        $('#vendorcontact').hide();
//        $('#cccontact').hide();
//        $('#ccontact').hide();
//    }
//    else if(type == "vcontact")
//    {
//        $('#vendorcontact').show();
//        $('#deliverydetails').hide();
//        $('#branchdetails').hide();
//        $('#narration').hide();
//        $('#cccontact').hide();
//        $('#ccontact').hide();
//    }
//    else if(type == "cccontact")
//    {
//        $('#cccontact').show();
//        $('#vendorcontact').hide();
//        $('#deliverydetails').hide();
//        $('#branchdetails').hide();
//        $('#narration').hide();
//        $('#ccontact').hide();
//    }
//    else if(type == "ccontact")
//    {
//        $('#ccontact').show();
//        $('#vendorcontact').hide();
//        $('#deliverydetails').hide();
//        $('#branchdetails').hide();
//        $('#narration').hide();
//        $('#cccontact').hide();
//    }
//
//}
//
function rateChange(x)
{
    var iFocusRowId= x.split("_")[1];
    var bRate=parseFloatVal($('#rate_' + iFocusRowId).val());
    var bQty=parseFloatVal($('#qty_' + iFocusRowId).val());
    $('#qrate_' + iFocusRowId).val(parseFloatVal($('#rate_' + iFocusRowId).val()));
    $('#baseamount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(bQty)*parseFloatVal(bRate),2,true));
    var vname = '#qualifierTable_' + iFocusRowId;
    CalculateRate(vname);
}

function CalculateRate(x) {

    var iFocusRowId=x.split("_")[1],
        name = '#desc_' + iFocusRowId,
        iRows = $('#rowid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sQualName = "Qual";
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');


    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }


//    var dTAmt = 0;
//    var dTWasteAmt =0;
//    for (i = 1; i <= iRows; i++) {
//        if ($(name + '_inc_' + i).is(':checked') == true) {
//            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
//                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
//            dTAmt = dTAmt + val;
//            dTWasteAmt = dTWasteAmt + wasteval;
//        }
//    }

//    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
//    dTAmt =  dTAmt + dTWasteAmt;
//    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));
    var qty=$('#qty_'+iFocusRowId).val();
    var dbaseAmt=$('#baseamount_'+iFocusRowId).val();

    var dQAmt =  CalculateQualifier(dbaseAmt,iFocusRowId,sQualName);

    $('#amount_' + iFocusRowId).val(sanitizeNumber(parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt),2,true));
    $('#qrate_' + iFocusRowId).val(sanitizeNumber((parseFloatVal(dbaseAmt)+parseFloatVal(dQAmt))/parseFloatVal(qty)),2,true);
    calcTotal();
//    $(name + '_totqualrate').val(sanitizeNumber(dQAmt,2,true));
//
//    var dQualAmt =  parseFloatVal(isNullCheck($(name + '_totqualrate').val(),'number'));
//    var dTotRate = dTAmt+ dQualAmt;
//    $(name + '_totrate').val(sanitizeNumber(dTotRate,2,true));
//
//    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
//    var dNetRate = dTotRate/dAnalQty;
//
//    $(name + '_totnetrate').val(sanitizeNumber(dNetRate,2,true));
//
//    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
//    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);
//
//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//    else {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_totnetrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//    }
//    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
    //TermsAutoRefresh();
}

function CalculateQualifier(baseValue, key1,sQualName) {
    var sQName = sQualName + '_';
    var rows = $('#' + sQualName +  'RowId_' + key1).val();
    var sformula="";
    var dbaseAmt=parseFloatVal(isNullCheck(baseValue,'number'));
    var dTotalQualAmt=0;

    for (i = 1; i <= rows; i++) {
        var sRef = $('#' + sQName + key1 + '_Ref_' + i).val().trim();
        var sFormula = isNullCheck($('#' + sQName + key1 + '_Exp_'+ i).val(),'string');
        var dPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_ExpPer_'+ i).val(),'number'));
        var sbaseRef = 'R0';
        if (parseFloatVal(dPer) ==0) dPer=100;
        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
        for (j = 1; j <= rows; j++) {
            var sFRef = $('#' + sQName + key1 + '_Ref_' + j).val().trim();
            var dFamt = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_Amount_'+ j).val(),'number'));
            sFormula = sFormula.replace(new RegExp(sFRef, 'g'), dFamt);
        }
        var fvaule = computeEval(sFormula);
        $('#' + sQName + key1 + '_ExpValue_' + i).val(numberFormat(fvaule,'C'));

        var iQualTypeid = $('#' + sQName + key1 + '_TypeId_' + i).val();

        if (iQualTypeid==1 || iQualTypeid==2) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(),'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(),'number'));
            var dCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_CessPer_' + i).val(),'number'));
            var dEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_EduCessPer_' + i).val(),'number'));
            var dHEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_HEduCessPer_' + i).val(),'number'));
            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(numberFormat(dNetPer,'C'));
            $('#' + sQName + key1 + '_ExpPer_'+ i).val(numberFormat(dNetPer,'C'));

            var dTaxableAmt =  fvaule* (dTaxablePer/100);
            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
            var dCessAmt =  dTaxAmt* (dCess/100);
            var dEDAmt =  dTaxAmt* (dEDCess/100);
            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;

            $('#' + sQName + key1 + '_TaxableAmt_'+ i).val(numberFormat(dTaxableAmt,'C'));
            $('#' + sQName + key1 + '_TaxPerAmt_'+ i).val(numberFormat(dTaxAmt,'C'));
            $('#' + sQName + key1 + '_CessAmt_'+ i).val(numberFormat(dCessAmt,'C'));
            $('#' + sQName + key1 + '_EduCessAmt_'+ i).val(numberFormat(dEDAmt,'C'));
            $('#' + sQName + key1 + '_HEduCessAmt_'+ i).val(numberFormat(dHEDAmt,'C'));
            $('#' + sQName + key1 + '_NetAmt_'+ i).val(numberFormat(dNetAmt,'C'));

            dAmt = dNetAmt;
        } else {

            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
        }

        $('#' + sQName + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
        if ($('#' + sQName + key1 + '_YesNo_' + i).is(':checked') == true) {
            var sSign = isNullCheck($('#' + sQName + key1 + '_Sign_' + i).val(),'string');
            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
        }
    }

    $('#'+ sQualName + 'TotalAmt_' + key1).val(numberFormat(dTotalQualAmt,'C'));

    return dTotalQualAmt;
    //qualTotal();
}
//
//function bindTaxCalculation() {
//    var $mainTr = $(".qualChange");
//    $mainTr.change(function (e) {
//        CalculateTax($(this)[0].id);
//    });
//}
//
//function signChange(x) {
//    var $this = $(x);
//    if ($this.hasClass( "fa-plus" )) {
//        $this.removeClass('fa-plus clr-gre');
//        $this.addClass('fa-minus clr-red');
//        var sname= $this[0].id.split('_')[0],
//            key1 = $this[0].id.split('_')[1],
//            key2 = $this[0].id.split('_')[3];
//        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
//    } else {
//        $this.removeClass('fa-minus clr-red');
//        $this.addClass('fa-plus clr-gre');
//        var sname= $this[0].id.split('_')[0],
//            key1 = $this[0].id.split('_')[1],
//            key2 = $this[0].id.split('_')[3];
//        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
//    }
//    CalculateQualifier($this[0].id);
//}
//
//function CalculateTax(id) {
//    //if (bReady==false) return;
//    var sname= id.split('_')[0],
//        key1 = id.split('_')[1],
//        key2 = id.split('_')[3];
//
//    var name = '#rateanal_' + key1;
//    if (sname == "QualR")  name = '#rateanalR_' + key1;
//
//    CalculateRate(name);
//
//    //var sname = $('#QualRowRef_' + key1).val();
//    ///var dbaseAmt= parseFloat($('#' + sname).val());
//
////    CalculateQualifier(dbaseAmt,key1);
////
////    var dTaxAmt = parseFloat(isNullCheck($('#QualTotalAmt_' + key1).val(),'number'));
////
////    var k1 = sname.split('_')[1],
////        k2 = sname.split('_')[3];
////
////    $('#BillAbs_' + k1 + '_TaxAmt_' + k2).val(dTaxAmt);
////    $('#BillAbs_' + k1 + '_NetAmt_' + k2).val(dTaxAmt+dbaseAmt);
////
////    calcTotal();
//}
//
////function CalculateQualifier(baseValue,key1,sQualName) {
////    var sQName = sQualName + '_';
////    var rows = $('#' + sQualName + 'RowId_' + key1).val();
////    var sformula = "";
////    var dbase
////    var iFocusRowId=x.split("_")[1],
////        name = '#qualifierTable_' + iFocusRowId,
////        sQualName = "Qual";
////    var dbaseAmt=$('#baseamount_'+iFocusRowId).val();
////    var rows=$('#QualRowId_'+iFocusRowId).val();
////    var key1=iFocusRowId;
////    var dTotalQualAmt=0;
////    var sname = $('#QualRowRef_' + iFocusRowId).val();
////
////    for (i = 1; i <= rows; i++) {
////        var sRef = $('#Qual_' + key1 + '_Ref_' + i).val().trim();
////        var sFormula = $('#Qual_' + key1 + '_Exp_'+ i).val();
////
////        var dPer = isNullCheck($('#Qual_' + key1 + '_ExpPer_'+ i).val(),'number');
////        var sbaseRef = 'R0';
////        if (parseFloatVal(dPer) ==0) dPer=100;
////        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
////
////        var fvaule = computeEval(sFormula);
////        $('#Qual_' + key1 + '_ExpValue_' + i).val(numberFormat(fvaule,'C'));
////
////        var iQualTypeid = $('#Qual_' + key1 + '_TypeId_' + i).val();
////        if (iQualTypeid==1 || iQualTypeid==2) {
////            var dTaxablePer = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_TaxablePer_' + i).val(),'number'));
////            var dTaxPer = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_TaxPer_' + i).val(),'number'));
////            var dCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_CessPer_' + i).val(),'number'));
////            var dEDCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_EduCessPer_' + i).val(),'number'));
////            var dHEDCess = parseFloatVal(isNullCheck($('#Qual_' + key1 + '_HEduCessPer_' + i).val(),'number'));
////            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
////            $('#Qual_' + key1 + '_NetPer_' + i).val(dNetPer);
////
////            $('#Qual_' + key1 + '_NetPer_' + i).val(numberFormat(dNetPer,'C'));
////            $('#Qual_' + key1 + '_ExpPer_'+ i).val(numberFormat(dNetPer,'C'));
////
////            var dTaxableAmt =  fvaule* (dTaxablePer/100);
////            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
////            var dCessAmt =  dTaxAmt* (dCess/100);
////            var dEDAmt =  dTaxAmt* (dEDCess/100);
////            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
////            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;
////
////            $('#Qual_' + key1 + '_TaxableAmt_'+ i).val(numberFormat(dTaxableAmt,'C'));
////            $('#Qual_' + key1 + '_TaxPerAmt_'+ i).val(numberFormat(dTaxAmt,'C'));
////            $('#Qual_' + key1 + '_CessAmt_'+ i).val(numberFormat(dCessAmt,'C'));
////            $('#Qual_' + key1 + '_EduCessAmt_'+ i).val(numberFormat(dEDAmt,'C'));
////            $('#Qual_' + key1 + '_HEduCessAmt_'+ i).val(numberFormat(dHEDAmt,'C'));
////            $('#Qual_' + key1 + '_NetAmt_'+ i).val(numberFormat(dNetAmt,'C'));
////
////            dAmt = dNetAmt;
////        } else {
////            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
////        }
//////        $('#Qual_' + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
//////        if ($('#Qual_' + key1 + '_YesNo_' + i).is(':checked') == true) dTotalQualAmt = dTotalQualAmt+ parseFloatVal(dAmt);
//////        for (j = i; j <= rows; j++) {
//////            var sFormula = $('#Qual_' + key1 + '_Exp_'+ i).val();
//////            sFormula = sFormula.replace(new RegExp(sRef, 'g'), dAmt);
//////        }
////        $('#Qual_' + key1 + '_Amount_' + i).val(numberFormat(dAmt,'C'));
////        if ($('#Qual_' + key1 + '_YesNo_' + i).is(':checked') == true) {
////            var sSign = isNullCheck( $('#Qual_' + key1 + '_Sign_' + i).val(),'string');
////            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
////            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
////        }
////    }
////    $('#QualTotalAmt_' + key1).val(numberFormat(dTotalQualAmt,'C')).trigger('change');
////    bindQualTot_onChange();
////
//////    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');
//////
//////    if (sname.substr(sname.length-1) ==  "R") {
//////        name = '#rateanalR_' + iFocusRowId;
//////        iRows = $('#rowinfoidR_' + iFocusRowId).val();
//////        sQualName = "QualR";
//////    }
//////
//////    var dTAmt = 0;
//////    var dTWasteAmt =0;
//////    for (i = 1; i <= iRows; i++) {
//////
//////        if ($(name + '_inc_' + i).is(':checked') == true) {
//////            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
//////                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
//////            dTAmt = dTAmt + val;
//////            dTWasteAmt = dTWasteAmt + wasteval;
//////        }
//////    }
//////
//////    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
//////    dTAmt =  dTAmt + dTWasteAmt;
//////    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));
//////
//////    var dQAmt =  CalculateQualifier(dTAmt,iFocusRowId,sQualName);
//////    $(name + '_totqualrate').val(sanitizeNumber(dQAmt,2,true));
//////
//////    var dQualAmt =  parseFloatVal(isNullCheck($(name + '_totqualrate').val(),'number'));
//////    var dTotRate = dTAmt+ dQualAmt;
//////    $(name + '_totrate').val(sanitizeNumber(dTotRate,2,true));
//////
//////    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
//////    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
//////    var dNetRate = dTotRate/dAnalQty;
//////
//////    $(name + '_totnetrate').val(sanitizeNumber(dNetRate,2,true));
//////
//////    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
//////    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);
//////
//////    var dFRate=0;
//////    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//////    else {
//////        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//////        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_totnetrate').val(),'number'));
//////        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//////    }
//////    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
////}
//
//function bindQualTot_onChange() {
//    $paymentScheduleWrapper.on('change', '[id^="QualTotalAmt_"]', function() {
//        var $tarReceiptTr = $(this).closest('.qualmainTr').prev('tr');
//
//        $tarReceiptTr.find('.sch-tax').val($(this).val());
//
//        calcReceiptTotal($tarReceiptTr.closest('tbody'));
//    });
//}
//function signChange(x) {
//    var $this = $(x);
//    if ($this.hasClass( "fa-plus" )) {
//        $this.removeClass('fa-plus clr-gre');
//        $this.addClass('fa-minus clr-red');
//        var key1 = $this[0].id.split('_')[1],
//            key2 = $this[0].id.split('_')[3];
//        $('#Qual_' + key1 + '_Sign_' + key2).val('-');
//    } else {
//        $this.removeClass('fa-minus clr-red');
//        $this.addClass('fa-plus clr-gre');
//        var key1 = $this[0].id.split('_')[1],
//            key2 = $this[0].id.split('_')[3];
//        $('#Qual_' + key1 + '_Sign_' + key2).val('+');
//    }
//    CalculateTax($this[0].id);
//}
//function computeEval(formula) {
//    with (document.forms){
//        with (Math) {
//            A = eval((formula));
//        }
//    } return A;
//}
//function CalculateTax(id) {
//    var sname= id.split('_')[0],
//        key1 = id.split('_')[1],
//        key2 = id.split('_')[3];
//
//    var name = '#qualifierTable_' + key1;
//    if (sname == "QualR")  name = '#qualifierTable_' + key1;
//    CalculateRate(name);
//}
//
//
//function TermsAutoRefresh() {
//
//    var netAmt=parseFloat(isNullCheck($('#total').val(),'number'));
//    var iKey=0;
//    var dFAmt=0.0;
//    var sTerms='';
//    $.each($('input[id^=terms_]'), function (i,o) {
//        iKey = iKey + 1;
//        sTerms = $(this).val();
//
//        if(sTerms == 'Advance' || sTerms == 'Against Delivery' || sTerms == "Against Work" || sTerms == "Against Bill" || sTerms == "Against Certification")
//        {
//            dCurPer = parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));;
//            if(parseFloat(isNullCheck(netAmt,'number'))>0 && parseFloat(isNullCheck(dCurPer,'number')) > 0)
//            {
//                dFAmt = (parseFloat(isNullCheck(dCurPer,'number')) / 100) * parseFloat(isNullCheck(netAmt,'number'));
//            }
//            $('#value_'+iKey).val(dFAmt);
//        }
//    });
//
//
//    var tCount =  $('#termsTable tbody tr').length;
//
//    if(tCount > 1){
//        $('#valuefrom').attr("disabled", true);
//    }
//    else
//    {
//        $('#valuefrom').attr("disabled", false);
//    }
//
//}
//
//function TermsCalculation(x)
//{
//    var valueFrom=$('#valuefrom').val();
//    var sname= x.split('_')[0],
//        key= x.split('_')[1];
//    var netAmt=0.0;
//    if(valueFrom == 'BaseAmount'){
//        netAmt = parseFloat(isNullCheck($('#basetotal').val(),'number'));
//    }
//    else if(valueFrom == 'NetAmount'){
//        netAmt=parseFloat(isNullCheck($('#total').val(),'number'));
//    }
//    else
//    {
//        netAmt=parseFloat(isNullCheck($('#basetotal').val(),'number'));
//    }
//
//    var sTerms=$('#terms_'+key).val();
//
//    var eTerms="";
//    var dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer=0.0;
//    var dAdvVal,dADelVal,dAWorkVal,dABillVal,dACerVal=0.0;
//    var iKey=0;
//    $.each($('input[id^=terms_]'), function (i,o) {
//        $this=$(this);
//        //iKey = iKey + 1;
//        iKey = $this[0].id.split('_')[1];
//        eTerms = $(this).val();
//
//        //iKey = $this[0].id.split('_')[1];
//        if(eTerms == 'Advance'){
//            dAdvPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
//            dAdvVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
//        }
//        if(eTerms == 'Against Delivery'){
//            dADelPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
//            dADelVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
//        }
//        if(eTerms == 'Against Work'){
//            dAWorkPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
//            dAWorkVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
//        }
//        if(eTerms == 'Against Bill'){
//            dABillPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
//            dABillVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
//        }
//        if(eTerms == 'Against Certification'){
//            dACerPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
//            dACerVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
//        }
//    });
//    if(sTerms == 'Advance' && sname == 'per' || sTerms == 'Against Delivery' && sname == 'per' || sTerms == "Against Work" && sname == 'per' || sTerms == "Against Bill" && sname == 'per' || sTerms == "Against Certification" && sname == 'per')
//    {
//        if(sTerms == 'Advance' && sname == 'per')
//        {
//            dCurPer = dAdvPer;
//        }
//        else if(sTerms == 'Against Delivery' && sname == 'per')
//        {
//            dCurPer = dADelPer;
//        }
//        else if(sTerms == 'Against Work' && sname == 'per')
//        {
//            dCurPer = dAWorkPer;
//        }
//        else if(sTerms == 'Against Bill' && sname == 'per')
//        {
//            dCurPer = dABillPer;
//        }
//        else if(sTerms == 'Against Certification' && sname == 'per')
//        {
//            dCurPer = dACerPer;
//        }
//
//        if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == false)
//        {
//            PerCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key)
//        }
//        else
//        {
//            alert("Enter Valid Amount!");
//            $('#per_'+key).val(0);
//            $('#value_'+key).val(0);
//            return;
//        }
//    }
//    else if(sTerms == 'Advance' && sname == 'value' || sTerms == 'Against Delivery' && sname == 'value' || sTerms == "Against Work" && sname == 'value' || sTerms == "Against Bill" && sname == 'value' || sTerms == "Against Certification" && sname == 'value')
//    {
//        if(sTerms == 'Advance' && sname == 'value')
//        {
//            dCurPer = dAdvVal;
//        }
//        else if(sTerms == 'Against Delivery' && sname == 'value')
//        {
//            dCurPer = dADelVal;
//        }
//        else if(sTerms == 'Against Work' && sname == 'value')
//        {
//            dCurPer = dADelval;
//        }
//        else if(sTerms == 'Against Bill' && sname == 'value')
//        {
//            dCurPer = dABillVal;
//        }
//        else if(sTerms == 'Against Certification' && sname == 'value')
//        {
//            dCurPer = dACerVal;
//        }
//        AmtCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key);
//        dCurPer = parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//
//        $.each($('input[id^=terms_]'), function (i,o) {
//            eTerms = $(this).val();
//            if(eTerms == 'Advance'){
//                dAdvPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//                dAdvVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
//            }
//            if(eTerms == 'Against Delivery'){
//                dADelPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//                dADelVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
//            }
//            if(eTerms = 'Against Work'){
//                dAWorkPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//                dAWorkVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
//            }
//            if(eTerms == 'Against Bill'){
//                dABillPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//                dABillVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
//            }
//            if(eTerms == 'Against Certification'){
//                dACerPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
//                dACerVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
//            }
//        });
//
//        if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == true)
//        {
//            alert("Enter Valid Amount!");
//            $('#per_'+key).val(0);
//            $('#value_'+key).val(0);
//        }
//    }
//    //alert(dAdvPer);
//}
//
//function TotAmtValidation(argAdv,argADel,argAWork,argABill,argACer)
//{
//    var bRet=false;
//    var dTot=parseFloat(isNullCheck(argAdv,'number')) + parseFloat(isNullCheck(argADel,'number')) + parseFloat(isNullCheck(argABill,'number')) + parseFloat(isNullCheck(argACer,'number')) + parseFloat(isNullCheck(argAWork,'number'));
//    if(dTot > 100)
//    {
//        bRet = true;
//    }
//    return bRet;
//}
//function AmtCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
//{
//    var Val,TotPer = 0.0;
//    TotPer = parseFloat(isNullCheck(argAgaDel,'number')) + parseFloat(isNullCheck(argAgaBill,'number')) + parseFloat(isNullCheck(argAgaCer,'number')) + parseFloat(isNullCheck(argAgaWork,'number'));
//    Val = AmountToPer(parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(TotPer,'number')));
//    $('#per_'+key).val(Val);
//}
//function PerCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
//{
//    var Val,TotPer=0.0;
//    TotPer = parseFloat(isNullCheck(argAgaDel,'number'))+parseFloat(isNullCheck(argAgaBill,'number'))+parseFloat(isNullCheck(argAgaCer,'number'))+parseFloat(isNullCheck(argAgaWork,'number'));
//    Val = PerToAmount(parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(TotPer,'number')));
//    $('#value_'+key).val(Val);
//}
//function PerToAmount(argPer,argAmt,argTotPer)
//{
//    if(parseFloat(isNullCheck(argAmt,'number'))>0 && parseFloat(isNullCheck(argPer,'number')) > 0)
//    {
//        argPer = (parseFloat(isNullCheck(argPer,'number')) / 100) * parseFloat(isNullCheck(argAmt,'number'));
//    }
//    return argPer;
//}
//function AmountToPer(argAmt,argPer,argTotPer)
//{
//    if(parseFloat(isNullCheck(argAmt,'number')) > 0 && parseFloat(isNullCheck(argPer,'number')) >0)
//    {
//        argAmt = ((parseFloat(isNullCheck(argPer,'number')) / parseFloat(isNullCheck(argAmt,'number'))) * 100)
//    }
//    return argAmt;
//}
function stockPODetails(x){

    var rowid = $(x)[0].id.split('_')[1];
    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#FCostCenterId').val();
    var  mode="getstockdetails";
    $.ajax({
        url: getBaseURL() + 'mms/transfer/tventry',
        type: "post",
        data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockPOModal").show();
                $("#estimateQty").val(sdata['EstimateQty']);
                $("#estimateRate").val(sdata['EstimateRate']);
                $("#availableQty").val(sdata['AvailableQty']);
                $("#excessQty").val(sdata['ExcessQty']);
                $("#balancePO").val(sdata['BalPOQty']);
                $("#totPurchase").val(sdata['TotPurchase']);
                $("#reqQty").val(sdata['ReqQty']);
                $("#poQty").val(sdata['POQty']);
                $("#minQty").val(sdata['MinQty']);
                $("#billQty").val(sdata['BillQty']);
                $("#requestQty").val(sdata['ReqQty']);
                $("#balrequestQty").val(sdata['BalReqQty']);
                $("#issueQty").val(sdata['IssueQty']);
                $("#transferQty").val(sdata['TransferQty']);
                $("#billreturnQty").val(sdata['ReturnQty']);
            }
        }

    });
}

function stockWBSDetails(x){

    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];
    var requestrowid = ids[5];

    var resourceid = $('#resourceid_' + rowid).val();
    var itemid = $('#itemid_' + rowid).val();
    var CostCenterId = $('#FCostCenterId').val();
    var WBSId = $('#iow_' + rowid + '_request_' + iowrowid + '_wbsid_' + requestrowid).val();
    var  mode="getwbsstockdetails";

    $.ajax({
        url: getBaseURL() + 'mms/transfer/tventry',
        type: "post",
        data: "Type="+ mode + "&WBSId="+ WBSId + "&CostCenterId=" + CostCenterId +"&resourceid=" + resourceid ,
        success: function (data, textStatus, jqXHR) {
            if(jqXHR.status == 200) {
                var sdata = JSON.parse(data);
                $("#stockWBSModal").show();
                $("#estimateWbsQty").val(sdata['EstimateQty']);
                $("#estimateWbsRate").val(sdata['EstimateRate']);
                $("#availableWbsQty").val(sdata['AvailableQty']);
                $("#excessWbsQty").val(sdata['ExcessQty']);
                $("#balanceWbsPO").val(sdata['BalPOQty']);
                $("#totWbsPurchase").val(sdata['TotPurchase']);
                $("#reqWbsQty").val(sdata['ReqQty']);
                $("#poWbsQty").val(sdata['POQty']);
                $("#minWbsQty").val(sdata['MinQty']);
                $("#billWbsQty").val(sdata['BillQty']);
            }
        }

    });
}
//
//function prerateDetails(x){
//
//    var rowid = $(x)[0].id.split('_')[1];
//    var resourceid = $('#resourceid_' + rowid).val();
//    var itemid = $('#itemid_' + rowid).val();
//    var CostCenterId = <?php //echo (isset($costcenter)) ? $costcenter['CostCentreId'] : '';?>//;
//    var  mode="getpreORate";
//    var venid = <?php //echo (isset($vendor)) ? $vendor['VendorId'] : '';?>//;
//
//    $.ajax({
//        url: getBaseURL() + 'mms/purchase/orderentry',
//        type: "post",
//        data: "Type="+ mode + "&CostCenterId=" + CostCenterId +"&ResourceId=" + resourceid + "&ItemId=" + itemid + "&VendorId=" + venid,
//        datatype: "json",
//        success: function (data, textStatus, jqXHR) {
//            if(jqXHR.status == 200) {
//                data = JSON.parse(data);
//                //Over All
//                var source =
//                {
//                    dataFields: [
//                        { name: 'Date', type: 'string' },
//                        { name: 'PONo', type: 'string' },
//                        { name: 'CostCentre', type: 'string' },
//                        { name: 'Vendor', type: 'string' },
//                        { name: 'Company', type: 'string' },
//                        { name: 'Rate', type: 'number' }
//
//                    ],
//                    localdata:data.orate,
//                    id: 'Id',
//                    datatype: "json",
//                    async: false
//
//                };
//
//                var orate = new $.jqx.dataAdapter(source);
//
//                // creage jqxgrid
//                $("#orateGrid").jqxGrid({
//                    width: '100%',
//                    autoheight:true,
//                    source: orate,
//                    sortable: true,
//                    filterable: true,
//                    pageable: true,
//                    autorowheight: true,
//                    ready: function () {
//                        //$("#subGrid").jqxGrid('showrowdetails', 1);
//                    },
//                    columns: [
//
//                        { text: 'Date', dataField: 'Date',width: '12%'},
//                        { text: 'PONo', dataField: 'PONo',width: '15%' },
//                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
//                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
//                        { text: 'Company', dataField: 'Company',width: '20%' },
//                        { text: 'Rate', dataField: 'Rate',width: '15%' }
//                    ]
//                });
//
//                //
//                //Company
//                var source1 =
//                {
//                    dataFields: [
//                        { name: 'Date', type: 'string' },
//                        { name: 'PONo', type: 'string' },
//                        { name: 'CostCentre', type: 'string' },
//                        { name: 'Vendor', type: 'string' },
//                        { name: 'Company', type: 'string' },
//                        { name: 'Rate', type: 'number' }
//
//                    ],
//                    localdata:data.comprate,
//                    id: 'Id',
//                    datatype: "json",
//                    async: false
//
//                };
//
//                var comprate = new $.jqx.dataAdapter(source1);
//
//                // creage jqxgrid
//                $("#comprateGrid").jqxGrid({
//                    width: '100%',
//                    autoheight:true,
//                    source: comprate,
//                    sortable: true,
//                    filterable: true,
//                    pageable: true,
//                    autorowheight: true,
//                    ready: function () {
//                    },
//                    columns: [
//
//                        { text: 'Date', dataField: 'Date',width: '12%'},
//                        { text: 'PONo', dataField: 'PONo',width: '15%' },
//                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
//                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
//                        { text: 'Company', dataField: 'Company',width: '20%' },
//                        { text: 'Rate', dataField: 'Rate',width: '15%' }
//                    ]
//                });
//                //
//                //CostCentre
//                var source2 =
//                {
//                    dataFields: [
//                        { name: 'Date', type: 'string' },
//                        { name: 'PONo', type: 'string' },
//                        { name: 'CostCentre', type: 'string' },
//                        { name: 'Vendor', type: 'string' },
//                        { name: 'Company', type: 'string' },
//                        { name: 'Rate', type: 'number' }
//
//                    ],
//                    localdata:data.ccrate,
//                    id: 'Id',
//                    datatype: "json",
//                    async: false
//
//                };
//
//                var ccrate = new $.jqx.dataAdapter(source2);
//
//                // creage jqxgrid
//                $("#ccrateGrid").jqxGrid({
//                    width: '100%',
//                    autoheight:true,
//                    source: ccrate,
//                    sortable: true,
//                    filterable: true,
//                    pageable: true,
//                    autorowheight: true,
//                    ready: function () {
//                    },
//                    columns: [
//
//                        { text: 'Date', dataField: 'Date',width: '12%'},
//                        { text: 'PONo', dataField: 'PONo',width: '15%' },
//                        { text: 'CostCentre', dataField: 'CostCentre',width: '20%'},
//                        { text: 'Vendor', dataField: 'Vendor',width: '18%' },
//                        { text: 'Company', dataField: 'Company',width: '20%' },
//                        { text: 'Rate', dataField: 'Rate',width: '15%' }
//                    ]
//                });
//                //
//            }
//        }
//
//    });
//}

//$('#purchase_type').change(function() {
//    var ptypeId = $(this).val();
//    $.ajax({
//        type: "POST",
//        url: getBaseURL()+'mms/transfer/tventry',
//        data: "ptypeId="+ptypeId+"&Type=selectAccount",
//        dataType: "json",
//        success: function(data){
//            $("#account_type").html('');
//            $("#account_type").append("<option value='0'>Select Account Type</option>");
//            $.each(data['resultAcc'], function(i,v){
//                $("#account_type").append("<option value='"+v.data+"'>"+v.value+"</option>");
//            });
//            $("#account_type").trigger('change');
//            $("#account_type").selectpicker('refresh');
//        }
//
//    });
//});

function selAccount(){
    var ptypeId = $('#purchase_type').val();
    if(ptypeId == ''){
        return false;
    } else {
        $("#account_type").html('');
        $("#account_type").append("<option value=''>Select Account Type</option>");
        $.ajax({
            type: "POST",
            url: getBaseURL()+'mms/transfer/tventry',
            data: "ptypeId="+ptypeId+"&Type=selectAccount",
            dataType: "json",
            success: function(data){
                $.each(data['resultAcc'], function(i,v){
                    $("#account_type").append("<option value='"+v.data+"' selected>"+v.value+"</option>");
                });
                $("#account_type").trigger("change");
                //  $("#account_type").select2('refresh');
            }

        });
    }
}
$( document ).ready(function() {
    var pId=<?php echo (isset($tranRegId)) ? $tranRegId:0; ?>;
    if(pId==0) {
        selAccount();
    }
});
function clickTr(val) {
    var id = ($(val).attr('id')).split('_');
    var resourceId = $('#resourceid_' + id[1]).val();
    var itemId = $('#itemid_' + id[1]).val();
    var CostCentre = $('#FCostCenterId').val();
    $.ajax({
        url: getBaseURL() + "mms/transfer/tventry",
        type: "post",
        data: "resourceid=" + resourceId + "&itemid=" + itemId + "&costcentreid=" + CostCentre + "&Type=getClosingStock",
        success: function (data, textStatus, jqXHR) {
            if (data != 'false') {
                var valu = JSON.parse(data);
//                    $('#qty_' + id[1]).closest('td').append('closing Stock: '+valu['ClosingStock']);
                $('#qty_' + id[1]).next('span').html('closing Stock: ' + valu['ClosingStock']);
                $('#qty_' + id[1]).next('span').attr('data-stock', valu['ClosingStock']);
            } else {
//                    $('#qty_' + id[1]).closest('td').append('closing Stock: 0');
                $('#qty_' + id[1]).next('span').html('closing Stock: 0');
                $('#qty_' + id[1]).next('span').attr('data-stock', 0);
            }

        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert(textStatus + "-----" + errorThrown);
        }
    });

}
$('textarea').focus(function(){
    $(this).removeAttr('placeholder');
});
function checkWarehouse(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    var iowrowid = ids[3];

    $('#whTable_' + rowid + '_wbs_' + iowrowid + '_whreqno').show();
}
function calcQty(x){
    var $x = $(x);
    var ids = $x[0].id.split('_');
    var rowid = ids[1];
    showError($('#qty_' + rowid), "No BalQty Available Here");
    $('#qty_' + rowid).val('');
    errorFlag = 1;
}
function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateQualifier($this[0].id);
}
function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#Qual_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateTax($this[0].id);
}
function CalculateTax(id) {
    var sname= id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#qualifierTable_' + key1;
    if (sname == "QualR")  name = '#qualifierTable_' + key1;
    CalculateRate(name);
}
$( document ).ready(function() {
    if('<?php echo (isset($Approve)) ? $Approve : '';?>' == 'Y')
    {
        $('#sub1').hide();
    }
    else if('<?php echo (isset($Approve)) ? $Approve : '';?>' == 'P')
    {
        $('#sub1').hide();
    }
    else{
        $('#sub1').show();
    }

});
$(document).ready(function(){
        $(".flip0").click(function(){
            $(".pane0").slideToggle("slow");
        });
    });
    function myFunction(x) {
        x.classList.toggle("change");
    }
</script>
