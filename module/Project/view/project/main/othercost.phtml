<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<style>
.tableFloatingHeaderOriginal {
	left:0
}
.savebtn_area {
	display: none;
}
.top-next {
	padding-top: calc(40% - 145px);
}
.prt-next {
	min-height:355px
}
.edit_del {
    margin-top:0px;
}
.frmwrk_div{margin-top:40px;}
.readonlynone{ border:none !important; padding:0px !important;}
</style>
<!--content-->
<div class="content_wrapper padlr0">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12" id="MainWrapper">
        <h1  class="text-center">Other Cost Register</h1>

          <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 prt-next top-lic zoomIn animated">
            <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2">
              <form class="form-horizontal" method="post" id="frm-project-select">
                <div class="col-lg-12 col-sm-12 frmwrk_div" id="projects_list">
                  <select name="project_id" id="sel_project_name" class="form-control multiple_dropdown lbl_move" data-size="6" label="Select Project"  style="width:100%;">
                                      <?php if(isset($projectlists)):
                                    foreach ( $projectlists as $project ):?>
                    <option value="<?php echo $project[ 'ProjectId' ]; ?>"><?php echo $project[ 'ProjectName' ]; ?></option>
                    <?php endforeach;
                                endif;?>
                  </select>
                </div>
          
                <div class="col-lg-12 col-sm-12  frmwrk_div" id="types_list">
                  <select name="type_name" id="sel_type_name"class="form-control multiple_dropdown lbl_move" data-size="6" label="Select Type..." style="width:100%;">
                   <option value="B">Budget</option>
                    <option value="P">Plan</option>
                  </select>
                </div>
                <div class="savebtn_areas savebtn_areas col-lg-7 col-lg-offset-4 col-md-7 col-md-offset-4 col-sm-7 col-sm-offset-4 col-xs-7 col-xs-offset-4">
                  <ul>
                    <li class="next-bt"><a onclick="submitForm();">Submit</a></li>
                  </ul>
                </div>
              </form>
            </div>
          </div>
      </div>
      <div id="DetailsWrapper" style="display: none;">
        <div class="col-lg-12">
          <h1 class="col-lg-6" style="padding-bottom:0">Other Cost Register</h1>
          <div class="col-lg-6 edit_del" data-visibility="hide">
            <ul>
              <li>
                <button type="button" class="edit-btn edit_al" id="print-btn"><i class="fa fa-print"></i> Print</button>
              </li>
              <li>
                <button type="button" class="edit-btn edit_al" id="expand-all-trs"><i class="fa fa-expand"></i> Expand All</button>
              </li>
              <li>
                <button type="button" class="edit-btn edit_al" id="collapse-all-trs"><i class="fa fa-compress"></i> Collapse All</button>
              </li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12 top_ct" >
            <div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-3 col-sm-offset-0">
              <div class="col-lg-12">
                  <select id="newsel_project_name" class="form-control multiple_dropdown lbl_move" data-size="6" label="Project"  onchange="changeProject()" style="width:100%;">
                      <?php if(isset($projectlists)):
                          foreach ( $projectlists as $project ):?>
                              <option value="<?php echo $project[ 'ProjectId' ]; ?>"><?php echo $project[ 'ProjectName' ]; ?></option>
                          <?php endforeach;
                      endif;?>
                  </select>
<!--                <input type="text" name="project_name" id="project_name" class="form-control lbl_move" label="Project Name" value=" " readonly/>-->
              </div>
            </div>
            <div class="col-lg-2 col-lg-offset-0 col-md-2 col-md-offset-0 col-sm-3 col-sm-offset-0">
              <div class="col-lg-12">
                  <select id="newsel_type_name"class="form-control multiple_dropdown lbl_move" data-size="6" label="Type" onchange="changeProject()" style="width:100%;">
                      <option value="B">Budget</option>
                      <option value="P">Plan</option>
                  </select>
<!--                <input type="text" name="project_typename" id="project_typename" class="form-control lbl_move" label="Type" value=" " readonly/>-->
              </div>
            </div>
			 <div class="col-lg-6 col-sm-6">
                 <form class="form-horizontal" action="<?php echo $this->basePath() . '/project/rfc/rfcothercost'; ?>" method="post" id="frm-project">
                     <a  href="javascript:submitOtherCost();" class="fancy-button"><i class="fa fa-plus" style="margin-right:5px"></i>Add New Other Cost</a>
                     <input type="hidden" name="project_id" id="ocproject_id" value="">
                     <input type="hidden" name="type_name" id="octype_name" value="">
                     <input type="hidden" name="revrequired" id="ocrevrequired" value="Y">
                     <input type="hidden" name="frm_what" value="true"/>
                 </form>
			</div>
          </div>
        </div>
        <div class="col-lg-12 col-lg-offset-0">
          <div class="table-responsive topsp animated fadeInUp">
            <table class="table" style=" margin-top:10px;" id="OtherCostTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th class="text-right">Amount</th>
                  <th data-visibility="hide">&nbsp;</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
            <input type="hidden" name="rowid" id="rowid" value="0"/>
            <input type="hidden" name="rowdeleteids" id="rowdeleteids" value="0"/>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="col-lg-12 savebtn_area">
  <ul>
    <li class="can_btn float_l lft-btn"><a href="<?php echo $this->basePath(); ?>/project/main/othercost">Cancel</a></li>
  </ul>
</div>
<script id="dummy-othercost" type="text/template" class="hide">
    <tr id="mainTr__">
        <td width="13%">
            <input class="parent_text OtherCostNameInputs readonlynone" type="text" name="ohname__" id="ohname__" readonly/>
            <input type="hidden" class="OtherCostIdInputs" name="ohid__" id="ohid__"/>
        </td>
        <td width="12%">
            <input class="parent_text readonlynone" type="text" name="ohtypename__" id="ohtypename__" readonly/>
            <input type="hidden" name="ohtypeid__" id="ohtypeid__"/>
        </td>
        <td width="10%"><input class="parent_text text-right readonlynone" type="text" name="amount__" id="amount__" readonly/></td>
        <td width="3%" align="center" data-visibility="hide">
            <ul class="action_btns">
                <li>
                    <a id="expandTr__" href="#" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
                </li>
                <li>
                    <a href="<?php echo $this->basePath(); ?>/project/rfc/rfcothercost/0/{{transId}}/{{projectId}}/{{projectType}}" class="pull-left"><i class="fa fa-pencil-square-o reg-icon"></i></a>
                </li>
            </ul>
        </td>
    </tr>
    <!--expand table-->
    <tr style="display:none;" class="subTr"></tr>
    <!--expand end-->
</script> 
<!--service,labour,item,material type table--> 
<script id="dummy-type-1"  type="text/template" class="hide">
    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Desc.</th>
                            <th>Unit</th>
                            <th class="text-right">Qty</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" readonly/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text readonlynone" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___qty_1" id="type___qty_1" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___rate_1" id="type___rate_1" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script> 
<!--general & advertisement type table--> 
<script id="dummy-type-2"  type="text/template" class="hide">
    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Expense</th>
                            <th>Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" readonly/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___amount_1" id="type___amount_1" onchange="calcExpenseAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script> 
<!--salary type table--> 
<script id="dummy-type-3"  type="text/template" class="hide">
    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Position</th>
                            <th>Nos.</th>
                            <th>Salary Per Month</th>
                            <th>Working Months</th>
                            <th>Amount</th>
                            <th data-visibility="hide">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" readonly/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___nos_1" id="type___nos_1"   onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___salpermonth_1" id="type___salpermonth_1"  onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___workingmonths_1" id="type___workingmonths_1"   onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___amount_1" id="type___amount_1" onchange="addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="5%" align="center" data-visibility="hide">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script> 
<!--fuel type table--> 
<script id="dummy-type-4"  type="text/template" class="hide">
    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Material</th>
                            <th>Fuel</th>
                            <th>Unit</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Qty</th>
                            <th class="text-right">Amount</th>
                            <th data-visibility="hide">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" readonly/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___fuel_1" id="type___fuel_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')" readonly/>
                                <input type="hidden" name="type___fuelid_1" id="type___fuelid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text readonlynone" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___rate_1" id="type___rate_1" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___qty_1" id="type___qty_1" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                            <td width="5%" align="center" data-visibility="hide">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script> 
<!--machinery type table--> 
<script id="dummy-type-5"  type="text/template" class="hide">
    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Material</th>
                            <th>Working Unit</th>
                            <th>Nos.</th>
                            <th class="text-right">Working Qty</th>
                            <th class="text-right">Total Qty</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Amount</th>
                            <th data-visibility="hide">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text readonlynone" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" readonly/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text readonlynone" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text readonlynone" type="text" name="type___nos_1" id="type___nos_1"   onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___wqty_1" id="type___wqty_1" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___tqty_1" id="type___tqty_1" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___rate_1" id="type___rate_1" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right readonlynone" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                            <td width="5%" align="center" data-visibility="hide">
                                <ul class="action_btns">
                                    <li> <a id="type___expandTr_1" href="#" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li>
                                </ul>
                            </td>
                        </tr>
                        <tr style="display:none;" class="subTr">
                            <td colspan="9" style="padding:0px !important; ">
                                <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp animated fadeInUp">
                                            <table class="table" style="margin-bottom:0px;" id="type___machinerySubTable_1">
                                                <thead>
                                                <tr>
                                                    <th>Desc</th>
                                                    <th>Percentage</th>
                                                    <th>Amount</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <input type="hidden" name="type___m_1_TransId_1" id="type___m_1_TransId_1"/>
                                                    <input type="hidden" name="type___m_1_UpdateRow_1" id="type___m_1_UpdateRow_1"/>
                                                    <td width="13%">
                                                        <input class="parent_text readonlynone" type="text" name="type___m_1_desc_1" id="type___m_1_desc_1" data-type="machineryiow" readonly/>
                                                        <input type="hidden" name="type___m_1_desctypeid_1" id="type___m_1_desctypeid_1"/>
                                                    </td>
                                                    <td width="10%" >
                                                        <input class="parent_text text-right readonlynone" type="text" name="type___m_1_per_1" id="type___m_1_per_1" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);" readonly/>
                                                    </td>
                                                    <td width="10%" >
                                                        <input class="parent_text text-right readonlynone" type="text" name="type___m_1_amount_1" id="type___m_1_amount_1" readonly/>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            <input type="hidden" name="type___m_1_rowid" id="type___m_1_rowid" value="1"/>
                                            <input type="hidden" name="type___m_1_rowdeleteids" id="type___m_1_rowdeleteids" value="0"/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script> 
<!--service,labour,item,material type tr--> 
<script id="dummy-type-tr-1"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text readonlynone" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___qty_0" id="type___qty_0" maxlength="12"readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___rate_0" id="type___rate_0" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
    </tr>
</script> 
<!--general & advertisement type tr--> 
<script id="dummy-type-tr-2"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___amount_0" id="type___amount_0" onchange="calcExpenseAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
    </tr>
</script> 
<!--salary type tr--> 
<script id="dummy-type-tr-3"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___nos_0" id="type___nos_0"   onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___salpermonth_0" id="type___salpermonth_0" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___workingmonths_0" id="type___workingmonths_0" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___amount_0" id="type___amount_0" onchange="addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="5%" align="center" data-visibility="hide"></td>
    </tr>
</script> 
<!--fuel type tr--> 
<script id="dummy-type-tr-4"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___fuel_0" id="type___fuel_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___fuelid_0" id="type___fuelid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text readonlynone" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___rate_0" id="type___rate_0" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___qty_0" id="type___qty_0" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
        <td width="5%" align="center" data-visibility="hide">
        </td>
    </tr>
</script> 
<!--machinery type tr--> 
<script id="dummy-type-tr-5"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" readonly/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text readonlynone" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___nos_0" id="type___nos_0"   onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___wqty_0" id="type___wqty_0" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___tqty_0" id="type___tqty_0" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___rate_0" id="type___rate_0" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
        <td width="5%" align="center" data-visibility="hide">
            <ul class="action_btns">
                <li> <a id="type___expandTr_0" href="#" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr">
        <td colspan="9" style="padding:0px !important; ">
            <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div class="col-lg-12">
                    <div class="table-responsive topsp animated fadeInUp">
                        <table class="table" style="margin-bottom:0px;" id="type___machinerySubTable_0">
                            <thead>
                            <tr>
                                <th>Desc</th>
                                <th>Percentage</th>
                                <th>Amount</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <input type="hidden" name="type___m_0_TransId_1" id="type___m_0_TransId_1"/>
                                <input type="hidden" name="type___m_0_UpdateRow_1" id="type___m_0_UpdateRow_1"/>
                                <td width="13%">
                                    <input class="parent_text readonlynone" type="text" name="type___m_0_desc_1" id="type___m_0_desc_1" data-type="machineryiow" readonly/>
                                    <input type="hidden" name="type___m_0_desctypeid_1" id="type___m_0_desctypeid_1"/>
                                </td>
                                <td width="10%" >
                                    <input class="parent_text text-right readonlynone" type="text" name="type___m_0_per_1" id="type___m_0_per_1" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);" readonly/>
                                </td>
                                <td width="10%" >
                                    <input class="parent_text text-right readonlynone" type="text" name="type___m_0_amount_1" id="type___m_0_amount_1" readonly/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="type___m_0_rowid" id="type___m_0_rowid" value="1"/>
                        <input type="hidden" name="type___m_0_rowdeleteids" id="type___m_0_rowdeleteids" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script> 
<!--machinery tr--> 
<script  id="dummy-machinery-tr"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___m__9_TransId_0" id="type___m__9_TransId_0"/>
        <input type="hidden" name="type___m__9_UpdateRow_0" id="type___m__9_UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text readonlynone" type="text" name="type___m__9_desc_0" id="type___m__9_desc_0" data-type="machineryiow" readonly/>
            <input type="hidden" name="type___m__9_desctypeid_0" id="type___m__9_desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___m__9_per_0" id="type___m__9_per_0" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right readonlynone" type="text" name="type___m__9_amount_0" id="type___m__9_amount_0" readonly/>
        </td>
    </tr>
</script> 
<script>
var arr_rfcohtrans = <?php echo (isset($arr_rfcohtrans)) ? json_encode($arr_rfcohtrans) : '[]';?>;
function submitForm() {
//    if ($('#sel_project_name').val() == "") {
//        alert('Select a Project');
//        return false;
//    }
//
//    if ($('#sel_type_name').val() == "") {
//        alert('Select a Type');
//        return false;
//    }
//    $('#project_name').val($('#sel_project_name').find('option:selected').html());
//    $('#project_typename').val($('#sel_type_name').find('option:selected').html());

//    var iProjectId = $('#newsel_project_name').val(),
//        sType = $('#newsel_type_name').val();

//    $('#sel_project_name').val(iProjectId).prop('selected', true).trigger('change');
//    $('#sel_type_name').val(sType).prop('selected', true).trigger('change');

    $.ajax({
        url: getBaseURL() + "project/main/othercost",
        async: false,
        type: 'post',
        data: $('#frm-project-select').serialize(),
        success: function(data,status, xhr) {
            if(xhr.status == 200) {
                renderrows(JSON.parse(data));
                $('#MainWrapper').hide();
                $('#DetailsWrapper').fadeIn();
                $('.savebtn_area').show();
            }
        },
        error: function(xhr, status, errorThrown) {

        }
    });
}

function renderrows(arr_rfcohtrans) {
    // render rows on edit
    var $rowid = $('#rowid');
    var template = $('#dummy-othercost').html();
    var $tbody = $('#OtherCostTable').find('tbody');
    $tbody.html('');
    var rowid = parseInt($rowid.val());

    if(typeof arr_rfcohtrans != 'undefined' && arr_rfcohtrans.length !== 0) {
        $.each(arr_rfcohtrans, function (i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid)
                .replace(/\{\{transId\}\}/g, o.OHAbsId)
                .replace(/\{\{projectId\}\}/g, $('#sel_project_name').val())
                .replace(/\{\{projectType\}\}/g, $('#sel_type_name').val())
            );

            // set values
            $('#TransId_' + rowid).val(o.RFCTransId);
            $('#ohname_' + rowid).val(o.OHName);
            $('#ohid_' + rowid).val(o.OHId);
            $('#ohtypename_' + rowid).val(o.OHTypeName);
            $('#ohtypeid_' + rowid).val(o.OHTypeId);
            $('#amount_' + rowid).val(sanitizeNumber(o.Amount));
            $('#expandTr_' + rowid).show();

            if(o.OHTypeId == 9 || o.OHTypeId == 10) {
                $('#expandTr_' + rowid).hide();
            }

            // add type row priorly
            var arr_type_1 = ['1','2','3', '4'];
            var arr_type_names = {'1': 'item', '2': 'material', '3': 'labour', '4': 'service', '5': 'machinery', '6': 'adminexpense', '7': 'salary', '8': 'fuel'};
            var typeTemplate = '';

            if($.inArray(o.OHTypeId, arr_type_1) != -1) {
                typeTemplate = $('#dummy-type-1').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        addNewTypeRow($('#type_' + rowid + '_desc_' + count),arr_type_names[o.OHTypeId]);
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_qty_' + count).val(t.Qty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate));
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        count++;
                    });
                }
                $('#type_' + rowid + '_desc_' + count).closest('tr').remove();
            } else if(o.OHTypeId == 6) {
                typeTemplate = $('#dummy-type-2').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount)).trigger('change');
                        $('#type_' + rowid + '_amount_' + count).attr('onchange', 'calcExpenseAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        count++;
                    });
                }
                $('#type_' + rowid + '_desc_' + count).closest('tr').remove();
            } else if(o.OHTypeId == 7) {
                typeTemplate = $('#dummy-type-3').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_nos_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Nos);
                        $('#type_' + rowid + '_salpermonth_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(sanitizeNumber(t.Salary));
                        $('#type_' + rowid + '_workingmonths_' + count).val(t.cMonths).trigger('change');
                        $('#type_' + rowid + '_workingmonths_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        count++;
                    });
                }
                $('#type_' + rowid + '_desc_' + count).closest('tr').remove();
            } else if(o.OHTypeId == 8) {
                typeTemplate = $('#dummy-type-4').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_fuel_' + count).val(t.Fuel);
                        $('#type_' + rowid + '_fuelid_' + count).val(t.FuelId);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_qty_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Qty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate)).trigger('change');
                        $('#type_' + rowid + '_rate_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        count++;
                    });
                }
                $('#type_' + rowid + '_desc_' + count).closest('tr').remove();
            } else if(o.OHTypeId == 5) {
                typeTemplate = $('#dummy-type-5').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.ResourceName);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.MResourceId);
                        $('#type_' + rowid + '_nos_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Nos);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_wqty_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.WorkingQty);
                        $('#type_' + rowid + '_tqty_' + count).val(t.TotalQty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate)).trigger('change');
                        $('#type_' + rowid + '_rate_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        $('#type_' + rowid + '_expandTr_' + count).show();
                        var mcount = 1;

                        if(typeof t.details != 'undefined' && t.details.length != 0) {
                            $.each(t.details, function (i, d) {
                                $('#type_' + rowid + '_m_' + count + '_TransId_' + mcount).val(d.RFCMachineryDetailId);
                                $('#type_' + rowid + '_m_' + count + '_desc_' + mcount).val(d.Name);
                                $('#type_' + rowid + '_m_' + count + '_desctypeid_' + mcount).val(d.ProjectIOWId);
                                $('#type_' + rowid + '_m_' + count + '_per_' + mcount).val(d.Percentage).trigger('change');
                                $('#type_' + rowid + '_m_' + count + '_per_' + mcount).attr('onchange', 'calcMachineryPerAmount(this);addNewMachineryRow(this,true);');
                                $('#type_' + rowid + '_m_' + count + '_amount_' + mcount).val(sanitizeNumber(d.Amount));

                                mcount++;
                            });
                        }
                        $('#type_' + rowid + '_m_' + count + '_desc_' + mcount).closest('tr').remove();
                        count++;
                    });
                }
                $('#type_' + rowid + '_desc_' + count).closest('tr').remove();
            }
        });
    }
}
function calcAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var qty = parseFloatVal($('#type_'+rowid+'_qty_' + key).val()),
            rate = parseFloatVal($('#type_'+rowid+'_rate_' + key).val());

        total += qty * rate;
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(qty * rate));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
}

function calcSalAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var nos = parseFloatVal($('#type_'+rowid+'_nos_' + key).val()),
            permonth = parseFloatVal($('#type_'+rowid+'_salpermonth_' + key).val()),
            wmonths = parseFloatVal($('#type_'+rowid+'_workingmonths_' + key).val());

        var subtotal = nos * (permonth * wmonths);
        total += subtotal;
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(subtotal));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
}

function calcMachineryAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var nos = parseFloatVal($('#type_'+rowid+'_nos_' + key).val()),
            wqty = parseFloatVal($('#type_'+rowid+'_wqty_' + key).val()),
            rate= parseFloatVal($('#type_'+rowid+'_rate_' + key).val());

        var subtotal = rate * (nos * wqty);
        total += subtotal;
        $('#type_'+rowid+'_tqty_' + key).val(nos * wqty);
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(subtotal));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
}

function calcExpenseAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var amt = parseFloatVal($('#type_'+rowid+'_amount_' + key).val());

        total += amt;
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
}

function addNewTypeRow(x,type) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        key = keys[3];

    var $typerowid = $('#type_'+rowid+'_rowid'),
        typerowid = parseInt($typerowid.val());
    var count = typerowid + 1,
        template = '',
        type = $('#type_'+rowid+'_desc_' + key).attr('data-type');

    // add type row priorly
    var arr_type_names = {'1': 'item', '2': 'material', '3': 'labour', '4': 'service', '6': 'adminexpense', '7': 'salary'};
    if(type == 'adminexpense')
        template = $('#dummy-type-tr-2').html();
    else if(type == 'salary')
        template = $('#dummy-type-tr-3').html();
    else if(type == 'fuel')
        template = $('#dummy-type-tr-4').html();
    else if(type == 'machinery') {
        template = $('#dummy-type-tr-5').html();
        $('#type_'+rowid+'_expandTr_' + key).show();
    } else
        template = $('#dummy-type-tr-1').html();

    $tr.parent('tbody').append(template.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + count).replace(/INPUTDATATYPE/g, type));
    $typerowid.val(count);
}

function addNewRow(x) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if ($tr.nextAll('tr:not(.subTr)').length != 0)
        return;


    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val());
    var count = rowid + 1,
        template = $('#dummy-othercost').html();

    $tr.parent('tbody').append(template.replace(/__/g, '_' + count));
    $rowid.val(count);
}

function addNewMachineryRow(x,updateFlag) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        mrowid = keys[3],
        key = keys[5];

    if(typeof updateFlag != 'undefined' && updateFlag) {
        $('#type_'+rowid+'_m_'+mrowid+'_UpdateRow_' + key).val(1);
    }

    if ($tr.nextAll('tr:not(.subTr)').length != 0)
        return;

    if ($('#type_'+rowid+'_m_'+mrowid+'_desctypeid_' + key).val().length == 0 || $('#type_'+rowid+'_m_'+mrowid+'_desctypeid_' + key).val() == 0 || $('#type_'+rowid+'_m_'+mrowid+'_desc_' + key).val().length == 0
        || $('#type_'+rowid+'_m_'+mrowid+'_amount_' + key).val().length == 0)
        return;

    $('#type_'+rowid+'_m_'+mrowid+'_deleteTr_' + key).show();

    var $typerowid = $('#type_'+rowid+'_m_'+mrowid+'_rowid'),
        typerowid = parseInt($typerowid.val());
    var count = typerowid + 1,
        template = '';
    template = $('#dummy-machinery-tr').html();

    $tr.parent('tbody').append(template.replace(/__9/g, '_' + mrowid).replace(/_0/g, '_' + count).replace(/___/g, '_' + rowid + '_'));
    $typerowid.val(count);
}

function calcMachineryPerAmount(x) {
    var keys =  $(x)[0].id.split('_'),
        rowId =  keys[1],
        mrowId =  keys[3];
    var total = 0,
        totalpercentage = 0;

    $.each($('input[id^=type_'+rowId+'_m_'+mrowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            mrowId = keys[3],
            key = keys[5];
        var totalAmt = parseFloatVal($('#type_'+rowId+'_amount_' + mrowId).val()),
            per = parseFloatVal($('#type_'+rowId+'_m_'+mrowId+'_per_' + key).val());

        var subtotal = totalAmt * (per / 100);
        total += subtotal;
        totalpercentage += per;
        $('#type_'+rowId+'_m_'+mrowId+'_amount_' + key).val(sanitizeNumber(subtotal));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));

    if(totalpercentage > 100) {
        alert('Total percentage for ' + $('type_'+rowId+'_desc_'+mrowId).val() + ' should not exceed 100%');
    }
}
function changeProject() {
    var iProjectId = $('#newsel_project_name').val(),
        sType = $('#newsel_type_name').val();

    $('#sel_project_name').val(iProjectId).prop('selected', true).trigger('change');
    $('#sel_type_name').val(sType).prop('selected', true).trigger('change');

    submitForm();
}
function submitOtherCost() {
    var iProjectId = $('#newsel_project_name').val(),
        sType = $('#newsel_type_name').val();
    $('#ocproject_id').val(iProjectId);
    $('#octype_name').val(sType);
    $('#frm-project').submit();
}

$(function () {
    $('#expand-all-trs').on('click', function () {
        var $mainTr = $('.mainTr .fa-chevron-circle-down');
        $mainTr.addClass('tform');
        $mainTr.closest("tr").next(".subTr").show();
        $mainTr.closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
    });

    $('#collapse-all-trs').on('click', function () {
        var $mainTr = $('.mainTr .fa-chevron-circle-down');
        $mainTr.closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
        $mainTr.closest("tr").next(".subTr").slideUp("slow");
        $mainTr.removeClass('tform');
    });

    $(".content_wrapper").on('click','.mainTr', function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });

    $("#print-btn").click(function () {
        var newWindow = window.open('', '', 'width=800, height=500'),
            document = newWindow.document.open(),
            pageContent =
                '<!DOCTYPE html>\n' +
                '<html>\n' +
                '<head>\n' +
                '<meta charset="utf-8" />\n' +
                '<title>Other Cost</title>\n' +
                '<h1>Other Cost</h1>\n' +
                '</head>\n' +
                '<body>\n' + $('#DetailsWrapper')[0].outerHTML.replace(/data-visibility="hide"/g, 'style="display:none;"') + '\n</body>\n</html>';
        document.write(pageContent);
        document.close();
        newWindow.print();
    });
});
</script>