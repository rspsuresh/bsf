<!--Handson Table plugin-->
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/library/handsontable/css/handsontable.full.min.css">
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/handsontable.full.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/RuleJS/lodash.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/RuleJS/underscore.string.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/RuleJS/numeral.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/RuleJS/numeric.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/formula.js"></script>
<script type="text/javascript"src="<?php echo $this->basePath(); ?>/library/handsontable/js/parser.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/ruleJS.all.full.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/handsontable/js/handsontable.formula.js"></script>
<!--Handson Table Plugin-->
<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css'; ?>" />
<style>
    .chevron {
        margin-top:10px;
        float:left;
        transition: all 0.2s linear 0s;
        color: #6897c0;
        font-size: 19px;
        line-height: 0 !important;
        cursor:pointer;
    }
    .chevron:hover {
        transition: 0.9s;
        transform: rotate(180deg) !important;
    }
    .subDiv::before {
        right:33%
    }
</style>
<div class="content_wrapper padlr0">
    <div class="container-fluid padlr0">
        <div class="col-lg-12 clear">
            <h1>Register - Project Work Breakdown Structure</h1>
            <div class="col-lg-12 coll-top">
                <div class="col-lg-4 col-sm-4 form-group">
                    <select  name="projectid" id="projectid" class="form-control single_dropdown lbl_move" label="Project" style="width:100%;">
                        <option value="0">Select Project</option>
                        <?php foreach($projectlists as $project) { ?>
                            <option value="<?php echo $project['ProjectId']; ?>" <?php if($project['ProjectId']==$projectId) { ?>selected<?php } ?>><?php echo $project[ 'ProjectName' ]; ?></option>
                        <?php } ?>
                    </select>
                </div>
                <div class="col-lg-4 col-sm-4 form-group">
                    <select name="typename" id="typename" class="form-control single_dropdown lbl_move" label="Type" style="width:100%;">
                        <option value="0">None</option>
                        <option value="B" <?php if($type == "B") { ?>selected<?php } ?>>Budget</option>
                        <option value="P" <?php if($type == "P") { ?>selected<?php } ?>>Plan</option>
                    </select>
                </div>
                <div class="col-lg-2 col-lg-offset-0 form-group col-md-2 col-md-offset-0 col-sm-2 col-sm-offset-0 col-xs-12 col-xs-offset-0"><a href="#" class="show_hide5"><i class="fa fa-filter" aria-hidden="true"></i> Show Filter</a> </div>
            </div>

            <div class="bgs show-hi animated fadeInUp">
                <form id="formWrapper" method="post" action="<?php echo $this->basePath(); ?>/project/rfc/projwbs/<?php echo $projectId; ?>/<?php echo $type; ?>">
                    <div class="col-md-3 col-sm-3 col-xs-12 form-group">
                        <label class="text-lab">Serial No</label>
                        <input type="text" id="serialNo" name="serialNo" class="form-control lbl_move" value="<?php if(count($search) > 0) { echo $search['serialNo']; } ?>" />
                        <input type="hidden" id="projectId" name="projectId" value="<?php echo $projectId; ?>" />
                        <input type="hidden" id="typeName" name="typeName" value="<?php echo $type; ?>" />
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-12 form-group">
                        <label class="text-lab">Description</label>
                        <input type="text" id="specification" name="specification" class="form-control lbl_move" value="<?php if(count($search) > 0) { echo $search['specification']; } ?>" />
                    </div>
                    <div class="col-md-3 col-sm-3 col-xs-12 form-group">
                        <label class="text-lab">Amount</label>
                        <input type="text" id="amount" name="amount" class="form-control lbl_move text-right"onkeypress="return isDecimal(event,this)" value="<?php if(count($search) > 0) { echo $search['amount']; } ?>" />
                    </div>
                    <div class="col-md-3 col-sm-2 col-xs-6 form-group">
                        <label class="text-lab">&nbsp;</label>
                        <button type="button" class="ripple has-ripple appfilter" onclick="return submitForm()" style="position: relative; overflow: hidden;"><i class="fa fa-filter"></i> Filter</button>
                    </div>

                    <!-- <ul class="filter-op">
							<li>
								<label>Serial No</label>
								<input type="text" id="serialNo" name="serialNo" value="<?php if(count($search) > 0) { echo $search['serialNo']; } ?>" />
								<input type="hidden" id="projectId" name="projectId" value="<?php echo $projectId; ?>" />
								<input type="hidden" id="typeName" name="typeName" value="<?php echo $type; ?>" />
							</li>
							<li>
								<label>Description</label>
								<input type="text" id="specification" name="specification" value="<?php if(count($search) > 0) { echo $search['specification']; } ?>" />
							</li>
							<li>
								<label>Amount</label>
								<input type="text" id="amount" name="amount" class="text-center" onkeypress="return isDecimal(event,this)" value="<?php if(count($search) > 0) { echo $search['amount']; } ?>" />
							</li>
							<li>
								<label>&nbsp;</label>
								<button type="button" class="ripple has-ripple" onclick="return submitForm()" style="position: relative; overflow: hidden;">Filter<span class="ripple-wrapper"></span></button>
							</li>
						</ul>-->
                </form>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="col-lg-12 col-md-12 clear">
            <div class="table-responsive animated fadeInUp">
                <table border="1" class="table-transform table table-striped table-bordered table-hover" width="100%" data-toolbar="#transform-buttons">
                    <thead>
                    <tr>
                        <th width="10%" data-field="serialno">Serial No</th>
                        <th width="42%" data-field="name">Description</th>
                        <th width="10%" data-field="unit">Unit</th>
                        <th width="10%" data-field="qty">Quantity</th>
                        <th width="10%" data-field="rate">Rate</th>
                        <th width="10%" data-field="amount">Amount</th>
                        <th width="8%">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php
                    if(!empty($projwbs)) {
                        $rows = count($projwbs['Type']);
                        $perPage = 10;
                        $pages = ceil( $rows / $perPage );

                        $page = isset( $gpage ) ? $gpage : 0;
                        $page == 0 ? $start = 0 : $start = ( $page - 1 ) * $perPage;
                        $curpag = ( $start == 0 ) ? 1 : ( $start / $perPage ) + 1 ;

                        $stopVal = $start + $perPage;
                        for($i=$start;$i<$rows;$i++) {
                            $class = '';
                            if($i == $stopVal) {
                                break;
                            }
                            if($projwbs['Type'][$i] == 3) {
                                $class = 'float:left; text-align:left; font-size:14px; color:#000; font-weight:bold';
                            } else if($projwbs['Type'][$i] == 4) {
                                $class = 'float:left; text-align:left; font-size:13px; color:#000;';
                            }
                            ?>
                            <tr>
                                <?php if($projwbs['Type'][$i] == 1) { ?>
                                    <td><?php echo $projwbs['SerialNo'][$i]; ?></td>
                                    <td colspan="6"><span style="text-decoration:underline; float:left; text-align:left; font-size:16px; color:#000; font-weight:bold"><?php echo $projwbs['Name'][$i]; ?></span></td>
                                <?php } else if($projwbs['Type'][$i] == 2) { ?>
                                    <td><?php echo $projwbs['SerialNo'][$i]; ?></td>
                                    <td colspan="6"><span style="text-decoration:underline; float:left; text-align:left; font-size:16px; color:#000; font-weight:bold"><?php echo $projwbs['Name'][$i]; ?></span></td>
                                <?php } else { ?>
                                    <?php if($projwbs['Unit'][$i] != '') { ?>
                                        <td><?php echo $projwbs['SerialNo'][$i]; ?></td>
                                        <td><span style="<?php echo $class; ?>"><?php echo $projwbs['Name'][$i]; ?></span></td>
                                        <td><?php echo $projwbs['Unit'][$i]; ?></td>
                                        <td><?php echo $projwbs['Quanity'][$i]; ?></td>
                                        <td><i id="<?php echo $projwbs['IOWTransId'][$i]; ?>" class="fa fa-chevron-circle-down show_hide chevron" data-original-title="Expand" data-toggle="tooltip"></i>&nbsp;&nbsp;<?php echo $projwbs['Rate'][$i]; ?></td>
                                        <td><?php echo $projwbs['Amount'][$i]; ?></td>
                                        <td>
                                            <div class="ed-dl">
                                                <a href="<?php echo $this->basePath(); ?>/project/rfc/rfcwbsedit/<?php echo $projwbs['WBSId'][$i];?>/<?php echo $projectId; ?>/<?php echo $type; ?>" class="pull-left"><i class="fa fa-pencil-square-o reg-icon"></i></a>
                                                <a href="<?php echo $this->basePath(); ?>/project/rfc/rfcwbsdelete/0/<?php echo $projwbs['TransId'][$i];?>" class="pull-left"><i class="fa fa-trash-o reg-icon"></i></a>
                                                <div class="clearfix"></div>
                                            </div>
                                        </td>
                                    <?php } else { ?>
                                        <td><?php echo $projwbs['SerialNo'][$i]; ?></td>
                                        <td colspan="7"><span style="<?php echo $class; ?>"><?php echo $projwbs['Name'][$i]; ?></span></td>
                                    <?php } ?>
                                <?php } ?>
                            </tr>
                            <?php if($projwbs['IOWTransId'][$i] != '') { ?>
                                <tr>
                                    <td colspan="7"><div id="iowId_<?php echo $projwbs['IOWTransId'][$i]; ?>" class="subDiv slidingDiv animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <div class="col-lg-12 clear" id="iowCon_<?php echo $projwbs['IOWTransId'][$i]; ?>"></div>
                                        </div></td>
                                </tr>
                            <?php } ?>
                        <?php } ?>
                    <?php } else { ?>
                        <tr>
                            <td colspan="7" style="text-align:center;">No data to display!</td>
                        </tr>
                    <?php } ?>
                    </tbody>
                </table>
            </div>
            <div class="col-md-6"></div>
            <div class="col-offset-md-6">
                <ul id="pagination-demo" class="pagination-sm">
                </ul>
            </div>
            <!--table border="1" class="table-transform" width="100%" data-toolbar="#transform-buttons">
                      <tr>
                          <th width="73%"align="right" bordercolor="none" id="total" colspan="5"><span style=" float:right">Total :&nbsp;&nbsp;&nbsp;</span></th>
                          <td width="9%"></td>
                          <th width="9%" align="right" bordercolor="none" id="total"><span style=" float:right">Total :&nbsp;&nbsp;&nbsp;</span></th>
                          <td width="9%"></td>
                      </tr>
                  </table-->
        </div>
    </div>
</div>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/jquery.twbsPagination.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/jquery.twbsPagination.min.js"></script>
<script type="text/javascript">
    var $serialSearch = $('#serialNo'),
        $specSearch = $('#specification'),
        $amount = $('#amount');

    $(document).ready(function(){
        $(".slidingDiv").hide();
        $('.show_hide').click(function(){
            //$(".slidingDiv").hide();
            var iowId = $(this).attr("id");
            $("#iowId_"+iowId).slideToggle();
            $.ajax({
                url: getBaseURL() + 'project/rfc/getprojectwbsdetails',
                type: 'POST',
                data: {TransId: iowId},
                async: false,
                success: function(data,status, xhr) {
                    if(xhr.status == 200) {
                        $("#iowId_"+iowId).html(data);
                    }
                }, error: function(xhr, status, errorThrown) {
                }
            });
        });
    });

    var pages = '<?php echo $pages; ?>';
    var projectId = $('#projectId').val();
    var typeName = $('#typeName').val();
    $('#pagination-demo').twbsPagination({
        totalPages: pages,
        visiblePages: 3,
        href: getBaseURL() + 'project/rfc/projwbs/'+projectId+'/'+typeName+'/{{number}}'
        /*onPageClick: function (event, page) {
         $('#page-content').text('Page ' + page);
         }*/
    });

    var arr_specifications = <?php echo json_encode($specifications); ?>;
    var $specification = $('#specification');

    $(function () {
        // bind property name autocomplete
        $specification.autocomplete({
            lookup: arr_specifications,
            showNoSuggestionNotice: false,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function (suggestion) {
                if (suggestion) {
                    //$enquiryId.val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function (suggestion) {
                //$enquiryId.val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                    //$enquiryId.val(0);
                } else {
                    $(this).removeClass('error');
                }
            }
        });
    });

    var arr_serialnos = <?php echo json_encode($serialNos); ?>;
    var $serialNo = $('#serialNo');

    $(function () {
        // bind property name autocomplete
        $serialNo.autocomplete({
            lookup: arr_serialnos,
            showNoSuggestionNotice: false,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function (suggestion) {
                if (suggestion) {
                    //$enquiryId.val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function (suggestion) {
                //$enquiryId.val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                    //$enquiryId.val(0);
                } else {
                    $(this).removeClass('error');
                }
            }
        });
    });

    function submitForm()
    {
        var formFlag = 0;
        if($serialSearch.val() != '') {
            formFlag = 1;
        } else if($specSearch.val() != '') {
            formFlag = 1;
        } else if($amount.val() != '') {
            formFlag = 1;
        }

        if(formFlag == 1) {
            $('#formWrapper').submit();
        }
    }

</script>
<script type="text/javascript">

    $(document).ready(function(){

        $(".show-hi").hide();
        $(".show_hide5").show();

        $('.show_hide5').click(function(){
            $(".show-hi").slideToggle();

        });
    });

</script>