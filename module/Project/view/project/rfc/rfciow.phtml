<!--STYLE-->
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<!--<link rel="stylesheet" href="-->
<!--"/>-->
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/tableHeadFixer.js"></script>
<!--STYLE-->
<style>
    .jqx-item {line-height: 37px;padding-left: 5px;}
    .popuptable table tr th{background:#E2EBEF!important;padding:5px;border-right:2px solid #5D9BB6;}
    .popuptable table tr th input[type=text]{ font-size:14px; font-weight:600; color:#333}
    .popuptable table tr tr{border-bottom:1px solid #dcdbdb; width:100%;}
    .popuptable table{border:1px solid #c2c2c2;}
    .row_header input[type=text] {font-weight:600 !important; font-size:15px !important; border:none !important; color: #015de6;}
    .row_specheader input[type=text],.row_specheader textarea {font-weight:600 !important; font-size:15px !important; color: #015de6;}
    .expandDiv{overflow:visible !important;}
    .expandDiv > .docu-spc {height: auto !important;}
    .expandDivn > .docu-spcn {height: auto !important;}
    .red-thss tr th {background:#b3d4ef!important; margin-top:10px !important;}
    .top-css{ margin-top:10px;}
    .sam-up i{ font-size:15px; color:#fff; font-weight:600; line-height:37px !important; padding-left:4px;}
    .social_profiles{ display:none;}
    .table-responsive table.table tr td {padding:10px;vertical-align: top !important;}
    .from_work_btn		{padding:6px 15px; margin-top:2px;background-color:#333399; color:#fff;display:block;}
    .table-responsive table.table tr td input.srl_no {font-size:10px !important; padding: 10px 4px;}
    .lstatea ul li label{display:block}
    .lstatea ul li input[type="text"]{width:130px;margin-right: 10px;}

    .step_by_liner{height:7px; background-image: -webkit-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -moz-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -ms-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -o-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);top:39px}
    .step_by li .step_by_sep p {margin:-4px 5px 0 0;line-height: 14px;transform: rotate(-45deg) !important;}
    .step_by li .step_by_sep{border-radius: 100px 100px 0px 100px; -webkit-transform: rotate(45deg); -moz-transform: rotate(45deg);transform: rotate(45deg) !important;margin-top:10px;width:25px;height:25px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);}
    .model-middle{padding:0}
    .cnt_slider{padding-top:0 !important}
    .step_by{margin:0 auto}
    .cnt_slider .carousel-inner,.cnt_slider{margin:0; padding:0;min-height:auto}
    .cnt_slider .carousel-inner .item{min-height:auto; width:100%;float:left;padding-top:0}
    .cnt_slider{border:none !important;padding:0 20px 20px 20px}
    .carousel-control{ position: inherit;}
    .stepby_mb23{left:15%}
    .step_by li {width:14.28%}
    .h1-head{text-align:center; font-size:22px; margin:15px 0;line-height:35px;}
    .excel1 td input{ font-size: 14px !important;font-weight: 700 !important; }
    .excel2 td input{ font-size: 13px !important;font-weight: 700 !important; }
    .excel3 td input{ font-size: 12px !important;font-weight: 700 !important; }
    .excel4 td input{ font:Italic normal 12px/15px "roboto"; font-size: 12px !important;}
    .excelvalid { background:#D8F0C2; border: 1px solid #d9d782;}
    .add-relative{position:relative}
    .ad-btn{background:#3399ff; text-shadow: 0 0 1px #546082;right:4px;text-align: center;padding-top: 2px; box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff; width:25px; height:25px; border-radius:50%; color:#fff; position:absolute}

    #iowpickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #iowpickgrid .jqx-checkbox {border:1px solid;}
    #respickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #respickgrid .jqx-checkbox {border:1px solid;}
</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form action="" onsubmit="return entryValidate()"  method="post" />

<input type="hidden" name="rfcUId" id="rfcUId" value="<?php echo $rfcid;?>" />
<input type="hidden" name="rfcmode" id="rfcmode" value="<?php echo $mode;?>" />
<input type="hidden" name="editid" id="editid" value="<?php echo $editid;?>"/>
<input type="hidden" name="codegenType" id="codegenType" value="<?php echo $codegenType;?>" />
<input type="hidden" name="wgcodegenType" id="wgcodegenType" value="<?php echo $wgcodegenType;?>">
<div class="col-lg-12 page_tittle">
    <h1>Request for Creation - IOW <?php echo ($mode != 'edit') ?  'Add' : 'Edit';?></h1>
</div>
<!--content-->
<!--Excel-->
<?php if ($mode != 'edit'):?>
    <div class="fixed-action-btn active" data-toggle="tooltip" data-placement="left" id="divExcelImport" title="Import From Excel">
        <div class="col-lg-12"> <span class="butclr-ns btn-file">
          <p class="sam-up"><i class="fa fa-folder-open sap"></i></p>
          <a href="javascript:void(0);"><input type="file" name="myfile" id="myfile" class="input-large filestyle"  accept=".xls, .xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" onchange="getexcelfield(this)"></a>
          </span> </div>
    </div>
<?php endif; ?>
<!--Excel end-->
<!--form start-->
<div class="col-lg-12 clear padlr0">
    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-6">
        <div class="col-lg-offset-1">
            <label for="refno" class="bk_lbl bk_lbl_inpt splcharc">Reference No <span class="colon_r">:</span></label>
            <input type="text" class="bk_lbl_inpt inputbg_ef bk_inpt1 splcharc" name="refno" data-bsfshare="refno" id="refno" onchange="" value="<?php  if ($rfcid!=0) { echo $rfcregister['RefNo'];}  else { echo $svNo; } ?>" <?php if ($genType==true) { ?> readonly <?php } ?> />
        </div>
    </div>
    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6 ">
        <div class="col-lg-offset-6">
            <div class="col-lg-12">
                <label for="refdate" class="bk_lbl bk_lbl_inpt"><span class="bkspan_calendar"><i class="fa fa-calendar-o"></i></span> Reference Date <span class="colon_r">:</span></label>
                <input type="text" class="date_picker bk_lbl_inpt no_bg bk_inpt inputbg_ef" name="refdate" data-bsfshare="refdate" readonly id="refdate" onchange="validateDate(this);" value="<?php if ($rfcid!=0)  { echo date("d-m-Y", strtotime($rfcregister['RefDate']));} else { echo date('d-m-Y');}?>" />
            </div>
        </div>
    </div>
</div>
<!--<div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0 top-css">-->
<!--    <div class="form-group"> <span class="date_icon"><i class="fa fa-calendar"></i></span>-->
<!--        <input type="text" name="refdate" id="refdate" class="form-control date_picker lbl_move" readonly label="Reference Date"  value="-->
<?php // if ($rfcid !=0) { echo date("d-m-Y", strtotime($rfcregister['RefDate'])) ;} else { echo date("d-m-Y");  }?>
<!--"/>-->
<!--    </div>-->
<!--</div>-->
<!--<div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0 top-css">-->
<!--    <div class="form-group">-->
<!--        <input type="text" name="refno" id="refno" class="form-control lbl_move" label="Reference No" value="-->
<?php //echo ($rfcid !=0 ) ? $rfcregister['RefNo'] : $svNo; ?>
<!--" -->
<?php //echo ($genType==true) ? 'readonly' : ''; ?>
<!--/>-->
<!--    </div>-->
<!--</div>-->

<!--table Jq Gride start-->
<!--<div class="col-lg-12 col-lg-offset-0 padtop20" style="--><?php //echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? 'display: none': '';?><!--" id="edit-list">-->
<!--    <div class="col-lg-12 clear">-->
<!--        <div class="table-responsive clear">-->
<!--            <div id='jqxWidget'>-->
<!--                <div id="grid"></div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<!--table Jq Gride start-->
<div class="col-lg-12 col-lg-offset-0 padtop20" style="<?php echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? '': 'display: none';?>" id="edit-content">
<div class="table-responsive topsp  animated-panel zoomIn" style="animation-delay: 0.2s;">
<table class="table" style=" margin-bottom:0px; <?php ($mode =='edit' || $editid ==0 || $rfcid ==0) ? 'display: none;' : '' ?>" id="sample12">
<thead>
<tr>
    <th>WorkGroup/ IOW Header</th>
    <th>SerialNo</th>
    <th>RefNo</th>
    <th>Specification</th>
    <th>Unit</th>
    <th class="text-right">Rate</th>
    <th>&nbsp;</th>
</tr>
</thead>
<tbody>
<?php $i=0;
if (isset($rfctrans)):
    foreach($rfctrans as $trans):
        $i=$i+1;
        if ($rfcid !=0) $rfctransid = $trans['RFCTransId'];
        else $rfctransid = $trans['IOWId'];
        ?>
        <tr id="IOWiRowId_<?php echo $i; ?>">
            <td width="10%"><input type="text" class="parent_text" name="parentid_<?php echo $i; ?>" id="parentid_<?php echo $i; ?>" value="<?php echo $trans['ParentText'];?>" readonly></td>
            <td width="3%"><input class="parent_text srl_no" type="text" name="serialno_<?php echo $i; ?>" value="<?php echo $trans['SerialNo'];?>" id="serialno_<?php echo $i; ?>" readonly/></td>
            <td width="3%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spcn">
                        <input class="parent_text" type="text" maxlength="50" name="refserialno_<?php echo $i; ?>" id="refserialno_<?php echo $i; ?>"  onblur="CheckRefNo(this.id)" value="<?php echo $trans['RefSerialNo'];?>"/>
                        <div class="radio_check">
                            <p>
                                <input type="checkbox" name="" value ="" id="raheader_<?php echo $i; ?>" class="ripple" onchange="checkHeader(this.id)" <?php echo ($trans['Header'] == '1') ? 'checked' : '';?> disabled />
                                <label for="raheader_<?php echo $i; ?>" class="ripple">Header</label>
                                <input type="hidden" name="raheaderval_<?php echo $i; ?>" id="raheaderval_<?php echo $i; ?>" value = "<?php echo $trans['Header']; ?>">
                            </p>
                        </div>
                    </div>
                </div></td>
            <td width="15%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spc">
                        <textarea class="parent_texts" name="spec_<?php echo $i; ?>" id="spec_<?php echo $i; ?>" onchange = "return SpecChange(this.id)"><?php echo $trans['Specification'];?></textarea>
                        <label>Short Spec</label>
                        <textarea class="parent_texts" maxlength="255" name="shortspec_<?php echo $i; ?>" id="shortspec_<?php echo $i; ?>"><?php echo $trans['ShortSpec'];?></textarea>
                    </div>
                </div></td>
            <td width="5%"><input type="text" class="parent_text" name="unitid_<?php echo $i; ?>" id="unitid_<?php echo $i; ?>" value="<?php echo $trans['UnitName'];?>" onblur="return CheckUnitValid(this.id)"></td>
            <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['Rate'],2,true);?>" id="rate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)"  onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly /></td>
            <input type="hidden" name="iowid_<?php echo $i; ?>" id="iowid_<?php echo $i; ?>" value = "<?php echo $trans['IOWId'];?>">
            <input type="hidden" name="rfctransid_<?php echo $i; ?>" id="rfctransid_<?php echo $i; ?>" value = "<?php echo $rfctransid;?>">
            <input type="hidden" name="unitkeyid_<?php echo $i; ?>" id="unitkeyid_<?php echo $i; ?>" value = "<?php echo $trans['UnitId'];?>">
            <input type="hidden" name="parentkeyid_<?php echo $i; ?>" id="parentkeyid_<?php echo $i; ?>" value = "<?php echo $trans['WorkGroupId'];?>">
            <input type="hidden" name="rowrefid_<?php echo $i; ?>" id="rowrefid_<?php echo $i; ?>" value = "<?php echo $i;?>">
            <input type="hidden" name="headerrow_<?php echo $i; ?>" id="headerrow_<?php echo $i; ?>" value = "0">
            <input type="hidden" name="sortid_<?php echo $i; ?>" id="sortid_<?php echo $i; ?>" value = "<?php echo $i; ?>">
            <input type="hidden" name="newworkgroupname_<?php echo $i; ?>" id="newworkgroupname_<?php echo $i; ?>" value = "<?php echo $trans['WorkGroupName']; ?>">
            <input type="hidden" name="worktypeid_<?php echo $i; ?>" id="worktypeid_<?php echo $i; ?>" value = "<?php echo $trans['WorkTypeId'];?>">
            <input type="hidden" name="workgroupid_<?php echo $i; ?>" id="workgroupid_<?php echo $i; ?>" value = "<?php echo $trans['WorkGroupId'];?>">
            <input type="hidden" name="piowid_<?php echo $i; ?>" id="piowid_<?php echo $i; ?>" value = "<?php echo $trans['ParentId'];?>">
            <input type="hidden" name="newparentname_<?php echo $i; ?>" id="newparentname_<?php echo $i; ?>" value = "<?php echo $trans['ParentName']; ?>">

            <!--<td width="3%"><a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="margin-right: 10px;"><i class="fa fa-trash ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a> <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down ctls" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></td>-->
            <td width="4%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                    <li> <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                </ul></td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr_<?php echo $i; ?> paintTr">
        <td colspan="9"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
        <div class="col-lg-12">
            <!-- Nav tabs -->
            <div  <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?>  class="darkmenu" id="mixtab_<?php echo $i; ?>">
                <ul>
                    <li class="active"><a href="javascript:void(0);" name="analtype_<?php echo $i; ?>" class="ripple" id="analtype_<?php echo $i; ?>" onclick="showmix('sitemix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Sitemix</a></li>
                    <li><a href="javascript:void(0);" name="analtypeR_<?php echo $i; ?>" class="ripple" id="analtypeR_<?php echo $i; ?>" onclick="showmix('readymix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
                </ul>
                <div class="manual_seletc">
                    <label>Rate Type</label>
                    <div class="select-style select-inline">
                        <select name="ratetype_<?php echo $i; ?>" id ="ratetype_<?php echo $i; ?>" onchange="return IOWRateUpdate(this.id)">
                            <option value="">Default Rate Type</option>
                            <option value="S" <?php echo ($trans['MixType'] == 'S') ? 'selected' : '';?>>SiteMix</option>
                            <option value="R" <?php echo ($trans['MixType'] == 'R') ? 'selected' : '';?>>ReadyMix</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Tab panes
            <div class="col-lg-12">
                <span class="butclr btn-file" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)" style="margin: 10px 0 0 0;> <i class="fa fa-folder-open sap"></i>
                <p class="sam-up" >From WorkGroup</p>
                </span>
            </div> -->
            <div class="lstate" style="margin-bottom:0">
                <ul  id="raworktable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['WorkingQty'])) echo $this->commonHelper()->sanitizeNumber($trans['WorkingQty'],3); else echo 1; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
                    </li>
                    <li <?php echo $trans['Cement']==0 ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>AQty_li">
                        <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="<?php if (isset($trans['CementRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['CementRatio'],3); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
                    </li>
                    <li <?php echo $trans['Sand']==0 ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>BQty_li">
                        <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" value="<?php if (isset($trans['SandRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['SandRatio'],3); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="changeRatio(this.id,'S')"/>
                    </li>
                    <li <?php echo $trans['Metal']==0 ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>CQty_li">
                        <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="<?php if (isset($trans['MetalRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['MetalRatio'],3); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
                    </li>
                    <li <?php echo $trans['Thickness']==0 ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>thick_li">
                        <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="<?php if (isset($trans['ThickQty'])) echo $this->commonHelper()->sanitizeNumber($trans['ThickQty'],3); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
                    </li>
                    <li> <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)" ><i class="fa fa-window-restore" aria-hidden="true"></i></a> </li>
                    <li><a  id="rateanal_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                </ul>
                <ul  style="display: none;" id="raworkRtable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanalR_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['RWorkingQty'])) echo $this->commonHelper()->sanitizeNumber($trans['RWorkingQty'],3); else echo 1; ?>" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
                    </li>
                    <li><a id="rateanalR_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12">
        <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
        <!-- Sitemix tabs -->
        <table class="table" style="margin-bottom:0px;" id="rateanal_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc/Exc</th>
                <th class="bg_clo">RefNo</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo text-right">Rate</th>
                <th class="bg_clo text-right">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0; $wastetotal=0;$iRefId=1;$weightagetotal=0;
            foreach($rfcrateanal as $ratrans):
                if ($rfcid !=0) {
                    if($ratrans['MixType'] != 'S' || $ratrans['RFCTransId'] != $trans['RFCTransId'])
                        continue; } else {
                    if($ratrans['MixType'] != 'S')
                        continue;
                } ?>
                <tr onfocus="showrow(this.id)" id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>" <?php if($ratrans['TransType'] == 'H') { echo 'class="row_header"'; } ?>>
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="7"><input type="text" class="parent_text"  style="font-weight:bold" name="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>"></td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $j;?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <!--                        <input type="hidden" name="rateanal_-->
                        <?php //echo $i; ?>
                        <!--_refid_-->
                        <?php //echo $j; ?>
                        <!--" value = "-->
                        <?php //echo $ratrans['ReferenceId']; ?>
                        <!--" id="rateanal_-->
                        <?php //echo $i; ?>
                        <!--_refid_-->
                        <?php //echo $j; ?>
                        <!--">-->
                        <td width="4%" class="action_btns_td"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                            </ul></td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo ($ratrans['IncludeFlag']==1) ? true : false; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" > R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php if($ratrans['SubIOWId']!=0) {echo $ratrans['SerialNo'] . ' ' .$ratrans['Specification'];}else {echo $ratrans['Code'] . ' ' .$ratrans['ResourceName'];}?>" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>">Wastage %</label>
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>">Weightage %</label>
                            </div></td>
                        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3,true,true);?>" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" maxlength="15" class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],2)?>" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" maxlength="15" class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],2)?>" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                            </div></td>
                        <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>" >
                                <?php if($ratrans['SubIOWId']!=0) { echo $ratrans['IOWUnitName'];} else { echo $ratrans['UnitName'];}?>
                            </label></td>
                        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                        <td width="10%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <!--                                    <td width="4%"><a href="javascript:void(0);" name="rateanal_-->
                        <?php //echo $i;?>
                        <!--_resdel_-->
                        <?php //echo $j;?>
                        <!--" id="rateanal_-->
                        <?php //echo $i;?>
                        <!--_resdel_-->
                        <?php //echo $j;?>
                        <!--" onclick="javascript:DeleteResource(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                        <td width="4%" class="action_btns_td"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                            </ul></td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount']; $wastetotal +=  $ratrans['WastageAmount']; $weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1; }
            endforeach;?>
            <tr onfocus="showrow(this.id)" id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo true; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" checked/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $iRefId; ?></label></td>
                <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)"/>
                    <div class="divwastage" style="display: none">
                        <label class="lab-Wastage" style="display: none" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                        <label class="lab-Wastage" style="display: none" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
                    </div></td>
                <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
                    <div class="short-spic divwastage" style="display: none">
                        <input style="display: none" class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                        <input style="display: none" class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                    </div></td>
                <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ></label></td>
                <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                <td width="10%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                <!--<td width="3%"><a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                <td width="4%" class="action_btns_td"><ul class="action_btns">
                        <li> <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                    </ul></td>
                <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>"">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>"">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" >
                <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value="<?php echo $iRefId; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right" id="rateanal_<?php echo $i; ?>_totweightage" value="<?php echo $this->commonHelper()->sanitizeNumber($weightagetotal,2,true); ?>" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['WastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['WastageAmt'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;"><ul class="action_btns">
                        <li> <a href="javascript:void(0);" class="wasteTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                    </ul></td>
            </tr>
            <tr style="display:none;" class="wastemainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwaste_<?php echo $i; ?>"></div>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['BaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['BaseRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totbaserate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['QualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['QualifierValue'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totqualrate" readonly/></td>
                            <td style="border-right:none;border-top:none;"><ul class="action_btns">
                                    <li> <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                                </ul></td>
                        </tr>
                    </div></td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrqual)) { $textHtml =  $arrqual[$rfctransid] ; $textHtml = str_replace('__1','_'.$i,$textHtml); } else { $textHtml=''; }  echo $textHtml;?>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['TotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['TotalRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totrate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['NetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['NetRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totnetrate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>
                    </div></td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoid_<?php echo $i; ?>" id="rowinfoid_<?php echo $i; ?>" value="<?php echo $j; ?>">
        <!-- Readymix tabs -->
        <table class="table" style="display: none;margin-bottom:0px;" id="rateanalR_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc/Exc</th>
                <th class="bg_clo">RefNo</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo text-right">Rate</th>
                <th class="bg_clo text-right">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0; $wastetotal=0;$iRefId=1; $weightagetotal=0;
            foreach($rfcrateanal as $ratrans):
                if ($rfcid !=0) {
                    if($ratrans['MixType'] != 'R' || $ratrans['RFCTransId'] != $trans['RFCTransId'])
                        continue; } else {
                    if($ratrans['MixType'] != 'R')
                        continue;
                } ?>
                <tr onfocus="showrow(this.id)" id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>" <?php if($ratrans['TransType'] == 'H') { echo 'class="row_header"'; } ?>>
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="7"><input type="text" class="parent_text"  style="font-weight:bold" name="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>"></td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $j;?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <!--                        <input type="hidden" name="rateanalR_-->
                        <?php //echo $i; ?>
                        <!--_refid_-->
                        <?php //echo $j; ?>
                        <!--" value = "-->
                        <?php //echo $ratrans['ReferenceId']; ?>
                        <!--" id="rateanalR_-->
                        <?php //echo $i; ?>
                        <!--_refid_-->
                        <?php //echo $j; ?>
                        <!--">-->
                        <td width="4%" class="action_btns_td"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                            </ul></td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php if ($ratrans['IncludeFlag']==1) true; else false; ?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php if($ratrans['SubIOWId']!=0) {echo $ratrans['SerialNo'] . ' ' .$ratrans['Specification'];}else {echo $ratrans['Code'] . ' ' .$ratrans['ResourceName'];}?>" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                                <label class="lab-Wastage" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
                            </div></td>
                        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3)?>" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],3)?>" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],3)?>" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                            </div></td>
                        <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>" >
                                <?php if($ratrans['SubIOWId']!=0) { echo $ratrans['IOWUnitName'];} else { echo $ratrans['UnitName'];}?>
                            </label></td>
                        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                        <td width="10%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                        <td width="4%" class="action_btns_td"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                            </ul></td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "<?php echo $ratrans['TransType']; ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount'];$wastetotal +=  $ratrans['WastageAmount'];$weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1;}
            endforeach;?>
            <tr onfocus="showrow(this.id)" id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php echo true;?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" checked/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $iRefId; ?></label></td>
                <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
                    <div class="divwastage" style="display: none">
                        <label class="lab-Wastage" style="display: none" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                        <label class="lab-Wastage" style="display: none" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
                    </div></td>
                <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
                    <div class="short-spic divwastage" style="display: none">
                        <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                        <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                    </div></td>
                <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ></label></td>
                <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                <td width="10%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                <td width="3%" class="action_btns_td"><ul class="action_btns">
                        <li> <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                    </ul></td>
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $iRefId; ?>" value="<?php echo $i; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value="L" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right" id="rateanalR_<?php echo $i; ?>_totweightage" value="<?php echo $this->commonHelper()->sanitizeNumber($weightagetotal,2,true); ?>" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['RWastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['RWastageAmt'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;"><ul class="action_btns">
                        <li> <a href="javascript:void(0);" class="wasteRTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                    </ul></td>
            </tr>
            <tr style="display:none;" class="wastemainRTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwasteR_<?php echo $i; ?>"></div>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['RBaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RBaseRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totbaserate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['RQualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['RQualifierValue'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totqualrate" readonly/></td>
                            <td style="border-right:none;border-top:none;"><ul class="action_btns">
                                    <li> <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                                </ul></td>
                        </tr>
                    </div></td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrRqual)) { $textHtml =  $arrRqual[$rfctransid] ; $textHtml = str_replace('__1','_'.$i,$textHtml);} else { $textHtml=''; }  echo $textHtml;?>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanalR_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['RTotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RTotalRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totrate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>

                        <tr style="border-bottom:none;">
                            <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanalR_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['RNetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RNetRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totnetrate" readonly/></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>
                    </div></td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoidR_<?php echo $i; ?>" id="rowinfoidR_<?php echo $i; ?>" value="<?php echo $j; ?>">
        </div>
        </div>
        </div></td>
        </tr>
        <!--expand end-->
    <?php endforeach; endif;?>
<?php $i=$i+1; ?>
<?php if ($editid==0) { ?>
    <tr id="IOWiRowId_<?php echo $i; ?>">
        <td width="11%"><input type="text" class="parent_text" name="parentid_<?php echo $i; ?>" id="parentid_<?php echo $i; ?>"></td>
        <td width="3%"><input class="parent_text srl_no" type="text" name="serialno_<?php echo $i; ?>" id="serialno_<?php echo $i; ?>" readonly/></td>
        <td width="3%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                <div class="docu-spcn">
                    <input class="parent_text" type="text" maxlength="50" name="refserialno_<?php echo $i; ?>" onblur="CheckRefNo(this.id)" id="refserialno_<?php echo $i; ?>" />
                    <div class="radio_check">
                        <p>
                            <input type="checkbox" name="" value ="" id="raheader_<?php echo $i; ?>" class="ripple"  onchange="checkHeader(this.id)"/>
                            <label for="raheader_<?php echo $i; ?>" class="ripple">Header</label>
                            <input type="hidden" name="raheaderval_<?php echo $i; ?>" id="raheaderval_<?php echo $i; ?>" value = "0">
                        </p>
                    </div>
                </div>
            </div></td>
        <td width="11%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                <div class="docu-spc">
                    <textarea class="parent_texts" name="spec_<?php echo $i; ?>" id="spec_<?php echo $i; ?>" onchange = "return SpecChange(this.id)"></textarea>
                    <label>Short Spec</label>
                    <textarea class="parent_texts" maxlength="255" name="shortspec_<?php echo $i; ?>" id="shortspec_<?php echo $i; ?>"></textarea>
                </div>
            </div></td>
        <td width="5%"><input type="text" class="parent_text" name="unitid_<?php echo $i; ?>" id="unitid_<?php echo $i; ?>" onblur="return CheckUnitValid(this.id)" ></td>
        <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber(0,2,true); ?>" id="rate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly/></td>
        <input type="hidden" name="iowid_<?php echo $i; ?>" value = "0" id="iowid_<?php echo $i; ?>">
        <input type="hidden" name="rfctransid_<?php echo $i; ?>" id="rfctransid_<?php echo $i; ?>" value = "">
        <input type="hidden" name="unitkeyid_<?php echo $i; ?>" value = "" id="unitkeyid_<?php echo $i; ?>">
        <input type="hidden" name="parentkeyid_<?php echo $i; ?>" value = "" id="parentkeyid_<?php echo $i; ?>">
        <input type="hidden" name="rowrefid_<?php echo $i; ?>" value = "<?php echo $i; ?>" id="rowrefid_<?php echo $i; ?>">
        <input type="hidden" name="headerrow_<?php echo $i; ?>" id="headerrow_<?php echo $i; ?>" value = "0">
        <input type="hidden" name="sortid_<?php echo $i; ?>" id="sortid_<?php echo $i; ?>" value = "<?php echo $i; ?>">
        <input type="hidden" name="newworkgroupname_<?php echo $i; ?>" id="newworkgroupname_<?php echo $i; ?>" value = "">
        <input type="hidden" name="worktypeid_<?php echo $i; ?>" id="worktypeid_<?php echo $i; ?>" value = "">
        <input type="hidden" name="workgroupid_<?php echo $i; ?>" id="workgroupid_<?php echo $i; ?>" value = "">
        <input type="hidden" name="piowid_<?php echo $i; ?>" id="piowid_<?php echo $i; ?>" value = "">
        <input type="hidden" name="newparentname_<?php echo $i; ?>" id="newparentname_<?php echo $i; ?>" value = "">

        <!--<td width="3%"><a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="margin-right: 10px;"><i class="fa fa-trash ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a> <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down ctls" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></td>-->
        <td width="4%" class="action_btns_td"><ul class="action_btns">
                <li> <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                <li> <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
            </ul></td>
    </tr>
    <!--expand table-->
    <tr style="display:none;" class="subTr_<?php echo $i; ?> paintTr">
    <td colspan="9"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
    <div class="col-lg-12 add-relative">
        <!-- Nav tabs -->
        <div class="darkmenu" id="mixtab_<?php echo $i; ?>">
            <ul>
                <li class="active"><a href="javascript:void(0);" name="analtype_<?php echo $i; ?>" class="ripple" id="analtype_<?php echo $i; ?>" onclick="showmix('sitemix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Sitemix</a></li>
                <li><a href="javascript:void(0);" name="analtypeR_<?php echo $i; ?>" class="ripple" id="analtypeR_<?php echo $i; ?>" onclick="showmix('readymix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
            </ul>
            <div class="manual_seletc">
                <label>Rate Type</label>
                <div class="select-style select-inline">
                    <select name="ratetype_<?php echo $i; ?>" id ="ratetype_<?php echo $i; ?>" onchange="return IOWRateUpdate(this.id)">
                        <option value="">Default Rate Type</option>
                        <option value="S" selected>SiteMix</option>
                        <option value="R">ReadyMix</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Tab panes
        <div class="col-lg-12">
            <span class="butclr btn-file" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)" style="margin: 10px 0 0 0;> <i class="fa fa-folder-open sap"></i>
            <p class="sam-up" >From WorkGroup</p>
            </span>
        </div> -->
        <div class="lstate">
            <ul  id="raworktable_<?php echo $i;?>">
                <li>
                    <label class="lbl_style">Working Qty</label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php echo $this->commonHelper()->sanitizeNumber(1,3); ?>" onkeypress="return isDecimal(event,this)"  onchange="return CalculateRate(this.id)"/>
                </li>
                <li id="rateanal_<?php echo $i; ?>AQty_li">
                    <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
                </li>
                <li id="rateanal_<?php echo $i; ?>BQty_li">
                    <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" onblur="return FormatNum(this, 3)" value="" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'S')"/>
                </li>
                <li id="rateanal_<?php echo $i; ?>CQty_li">
                    <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
                </li>
                <li id="rateanal_<?php echo $i; ?>thick_li">
                    <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
                </li>
                <li> <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)"><i class="fa fa-window-restore" aria-hidden="true"></i></a> </li>
                <li><a id="rateanal_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
            </ul>
            <ul  style="display: none;" id="raworkRtable_<?php echo $i;?>">
                <li>
                    <label class="lbl_style">Working Qty</label>
                    <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanalR_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php echo $this->commonHelper()->sanitizeNumber(1,3); ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
                </li>
                <li><a id="rateanalR_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
            </ul>
        </div>
    </div>
    <div class="col-lg-12">
    <div class="table-responsive topsp animated-panel zoomIn"  style="overflow: visible;animation-delay: 0.2s;">
    <!-- Sitemix tabs -->
    <table class="table" style="margin-bottom:0px;" id="rateanal_<?php echo $i; ?>_restable">
        <thead>
        <tr>
            <th class="bg_clo">Inc/Exc</th>
            <th class="bg_clo">RefNo</th>
            <th class="bg_clo">Resource</th>
            <th class="bg_clo">Coefficient</th>
            <th class="bg_clo">Unit</th>
            <th class="bg_clo text-right">Rate</th>
            <th class="bg_clo text-right">Amount</th>
            <th class="bg_clo text-center">&nbsp;</th>
        </tr>
        </thead>
        <tbody class="sorting">
        <?php $j=1; ?>
        <tr onfocus="showrow(this.id)" id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
            <td width="1%"><label>
                    <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo true; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)"/>
                    <div class="ios_switch"><span></span></div>
                </label></td>
            <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R1</label></td>
            <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>"  onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)" />
                <div class="divwastage" style="display: none">
                    <label class="lab-Wastage" style="display: none" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                    <label class="lab-Wastage" style="display: none" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
                </div></td>
            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
                <div class="short-spic divwastage" style="display: none">
                    <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                    <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                </div></td>
            <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>"></label></td>
            <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
            <td width="10%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>"  onkeypress="return isDecimal(event,this)" readonly/></td>
            <!--<td width="3%"><a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
            <td width="4%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                </ul></td>
            <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "1" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
            <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
        </tr>
        </tbody>
        <tbody class="total" style="border: none;">
        <tr style="border-bottom:none;">
            <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
            <td><input type="text" class="parent_text total-clr text-right" id="rateanal_<?php echo $i; ?>_totweightage" readonly/></td>
            <td>&nbsp;</td>
            <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
            <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totwastage" value = "" id="rateanal_<?php echo $i; ?>_totwastage" readonly/></td>
            <td style="border-right:none;"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" class="wasteTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                </ul></td>
        </tr>
        <tr style="display:none;" class="wastemainTr_<?php echo $i; ?>">
            <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                    <div id="divwaste_<?php echo $i; ?>"></div>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totbaserate" value = "" id="rateanal_<?php echo $i; ?>_totbaserate" readonly/></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totqualrate" value = "" id="rateanal_<?php echo $i; ?>_totqualrate" readonly/></td>
                        <td style="border-right:none;border-top:none;"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                            </ul></td>
                    </tr>
                </div></td>
        </tr>
        <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
            <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                    <?php $textHtml = str_replace('__1','_'.$i,$qualHtml);  echo $textHtml;?>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totrate" value = "" id="rateanal_<?php echo $i; ?>_totrate" readonly/></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totnetrate" value = "" id="rateanal_<?php echo $i; ?>_totnetrate" readonly/></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>
                </div></td>
        </tr>
        </tbody>
    </table>
    <input type="hidden" name="rowinfoid_<?php echo $i; ?>" id="rowinfoid_<?php echo $i; ?>" value="<?php echo $j; ?>">
    <!--  Readymix tabs-->
    <table class="table" style="display: none;margin-bottom:0px;" id="rateanalR_<?php echo $i; ?>_restable">
        <thead>
        <tr>
            <th class="bg_clo">Inc/Exc</th>
            <th class="bg_clo">RefNo</th>
            <th class="bg_clo">Resource</th>
            <th class="bg_clo">Coefficient</th>
            <th class="bg_clo">Unit</th>
            <th class="bg_clo text-right">Rate</th>
            <th class="bg_clo text-right">Amount</th>
            <th class="bg_clo text-center">&nbsp;</th>
        </tr>
        </thead>
        <tbody class="sorting">
        <?php $j=1; ?>
        <tr onfocus="showrow(this.id)" id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
            <td width="1%"><label>
                    <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php echo true; ?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                    <div class="ios_switch"><span></span></div>
                </label></td>
            <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>">R1</label></td>
            <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
                <div class="divwastage" style="display: none">
                    <label class="lab-Wastage" style="display: none" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                    <label class="lab-Wastage" style="display: none" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
                </div></td>
            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus ="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
                <div class="short-spic divwastage" style="display: none">
                    <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                    <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                </div></td>
            <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>"></label></td>
            <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
            <td width="10%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" onkeypress="return isDecimal(event,this)" readonly/></td>
            <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
            <td width="4%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id, event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                </ul></td>
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "1" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
            <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
        </tr>
        </tbody>
        <tbody class="total" style="border: none;">
        <tr style="border-bottom:none;">
            <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
            <td><input type="text" class="parent_text total-clr text-right" id="rateanalR_<?php echo $i; ?>_totweightage" readonly/></td>
            <td>&nbsp;</td>
            <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
            <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totwastage" value = "" id="rateanalR_<?php echo $i; ?>_totwastage" readonly/></td>
            <td style="border-right:none;"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" class="wasteRTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                </ul></td>
        </tr>
        <tr style="display:none;" class="wastemainRTr_<?php echo $i; ?>">
            <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                    <div id="divwasteR_<?php echo $i; ?>"></div>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totbaserate" value = "" id="rateanalR_<?php echo $i; ?>_totbaserate" readonly /></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totqualrate" value = "" id="rateanalR_<?php echo $i; ?>_totqualrate" readonly /></td>
                        <td style="border-right:none;border-top:none;"><ul class="action_btns">
                                <li> <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                            </ul></td>
                    </tr>
                </div></td>
        </tr>
        <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
            <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                    <?php $textHtml = str_replace('__1','_'.$i,$qualRHtml);  echo $textHtml;?>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanalR_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totrate" value = "" id="rateanalR_<?php echo $i; ?>_totrate" readonly /></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>

                    <tr style="border-bottom:none;">
                        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanalR_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totnetrate" value = "" id="rateanalR_<?php echo $i; ?>_totnetrate" readonly /></td>
                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                    </tr>
                </div></td>
        </tr>
        </tbody>
    </table>
    <input type="hidden" name="rowinfoidR_<?php echo $i; ?>" id="rowinfoidR_<?php echo $i; ?>" value="<?php echo $j; ?>">
    </div>
    </div>
    </div></td>
    </tr>
<?php } ?>


<tr class="remarks">
    <td colspan="7"><textarea placeholder="Enter Remarks" class="remrk element" maxlength="255" name="narration" id="narration" title="Remarks" onfocus="inputFocus(this)" onblur="inputBlur(this)"><?php if(isset($rfcregister['Narration'])) echo $rfcregister['Narration'];?>
        </textarea></td>
</tr>
</tbody>
</table>
<input type="hidden" name="rowid" id="rowid" value="<?php echo $i; ?>">
<table  id="newrateresource" style="display: none;">
    <tr>
        <td ><a href="javascript:void(0);" id ="butnewrateresource" class="btn btn-link" onclick="return ShowRateResource(event)" >Resource Invloved</a></td>
    </tr>
</table>
</div>
<!--table end-->
<table  id="newitems" style="display: none;">
    <tr>
        <td ><a href="javascript:void(0);" id ="butnewitems" class="btn btn-link" onclick="return ShowNewWorkGroup(event)" >New Work Group Created</a></td>
    </tr>
    <tr>
        <table class="table" id ="newwg" style="display: none; width:50%; border:1px solid #ccc;">
            <thead>
            <tr>
                <th style="border-right:1px solid #ccc;">SerialNo</th>
                <th style="border-right:1px solid #ccc;">Work Group Name</th>
                <th class="text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td width="10%" style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newwgnameslno_1" value = "" id="newwgnameslno_1" readonly></td>
                <td width="30%" style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newwgname_1" value = "" id="newwgname_1" readonly></td>
                <td width="3%"><button type="button" name="newwgdetails_1" value = "Show Details" id="newwgdetails_1" onclick="return ShowWorkGroup(this.id)" style="margin:0;" ><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                <input type="hidden" name="newwgid_1" value = "" id="newwgid_1" >
                <input type="hidden" name="newwgtypename_1" value = "" id="newwgtypename_1" >
                <input type="hidden" name="newwgrateanal_1" value = "" id="newwgrateanal_1" >
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="newwgowid" id="newwgowid" >
    </tr>
</table>
<table  id="newresitems" style="display: none;">
    <tr>
        <!-- <td > <button type="button" id ="butnewresitems" class="btn btn-info btn-xs" > Resource </button> </td> -->
        <td ><a href="javascript:void(0);" id ="butnewresitems" class="btn btn-link" onclick="return ShowNewResource(event)" >New Resource Created</a></td>
    </tr>
    <tr >
        <table class="table" id="newres" style="display: none; width:50%;border:1px solid #ccc;">
            <thead>
            <tr>
                <th style="border-right:1px solid #ccc;">Resource Name</th>
                <th style="border-right:1px solid #ccc;">Type</th>
                <th class="text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresname_1" value = "" id="newresname_1" readonly></td>
                <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newrestype_1" value = "" id="newrestype_1" readonly></td>
                <td width="3%"><button type="button" name="newresdetails_1" value = "Show Details" id="newresdetails_1" onclick="return ShowResource(this.id)" style="background-color: #fff;margin:0;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                <input type="hidden"  name="newresgroup_1" value = "" id="newresgroup_1">
                <input type="hidden"  name="newresgroupid_1" value = "" id="newresgroupid_1">
                <input type="hidden"  name="newrestypeid_1" value = "" id="newrestypeid_1">
                <input type="hidden"  name="newresunit_1" value = "" id="newresunit_1">
                <input type="hidden"  name="newresunitid_1" value = "" id="newresunitid_1">
                <input type="hidden"  name="newresrate_1" value = "" id="newresrate_1">
                <input type="hidden"  name="newwresunit_1" value = "" id="newwresunit_1">
                <input type="hidden"  name="newwresunitid_1" value = "" id="newwresunitid_1">
                <input type="hidden"  name="newwresrate_1" value = "" id="newwresrate_1">
                <input type="hidden"  name="newresmattype_1" value = "" id="newresmattype_1">
                <input type="hidden"  name="newreslead_1" value = "" id="newreslead_1">
                <input type="hidden"  name="newrescode_1" value = "" id="newrescode_1">
                <input type="hidden"  name="newrowrefid_1" value = "" id="newrowrefid_1">
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="newresrowid" id="newresrowid" >
    </tr>
</table>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r" id="submit-btn" style="<?php if ($rfcid !=0) { if ($rfcregister['Approve']=='Y') { echo 'display: none;'; } else { echo '';} }?>"><a href="javascript:submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
        <li class="dropdown save_btn float_r" id="next-btn" style="<?php echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? 'display: none;' : '';?>"><a href="javascript:nextiow();" data-toggle="tooltip" class="ripple" title="Go to next">Next</a></li>
        <li class="can_btn float_l" style="padding-bottom:10px;"><a href="<?php if ($rfcid !=0) { echo $this->basePath().'/project/rfc/rfcregister'; } else if ($editid !=0) {echo $this->basePath().'/project/main/iowmasterview';}  else { echo $this->basePath().'/project/rfc/rfc-what';}?>">Cancel</a></li>
    </ul>
</div>
</div>
</form>
</div>
</div>
</div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Resource/IOW Picklist</h1>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs nav-controls" role="tablist">
                    <li role="presentation" class="active"><a href="#res-view" aria-controls="task-view" role="tab" data-toggle="tab">Resource</a></li>
                    <li role="presentation"><a href="#iow-view" aria-controls="iow-view" role="tab" data-toggle="tab">Item of Work</a></li>
                </ul>
                <div class="tab-content goal-bg col-md-12" style="background:#fff; padding:0 !important">
                    <div class="col-md-12 tab-pane active" style="padding:0 !important" role="tabpanel" id="res-view">
                        <div class="table-responsive clear">
                            <div id="respickgrid"> </div>
                        </div>
                    </div>
                    <div class="col-md-12 tab-pane" style="padding:0 !important" role="tabpanel" id="iow-view">
                        <div class="table-responsive clear">
                            <div id="iowpickgrid"> </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="picklistrestype" value="">
                <input type="hidden" id="picklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="rateResource" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource Rate</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                    <table class="table" id="resourcerate" style="margin-bottom: 0">
                        <thead>
                        <tr>
                            <th class="th-modal">ResourceName</th>
                            <th class="th-modal">Unit</th>
                            <th class="th-modal text-right">Rate</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td width="15%"><input class="parent_text" data-toggle="popover" type="text" name="rateresname_1" id="rateresname_1" readonly ></td>
                            <td width="3%"><input class="parent_text" type="text" name="rateresunit_1" id="rateresunit_1" readonly ></td>
                            <td width="5%"><input  class="parent_text text-right" type="text" maxlength="15" name="rateresrate_1" id="rateresrate_1" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)"></td>
                            <input type="hidden" name="rateresoldrate_1" id="rateresoldrate_1" >
                            <input type="hidden" name="rateresid_1" id="rateresid_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return ResourceRateUpdate()" data-dismiss="modal">Apply</button>
            </div>
        </div>
    </div>
</div>
<div id="formula" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Formula</h1>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formula Expression</label>
                    <input type="text" class="parent_text" name="formulaexp"  maxlength="20" value = "" id="formulaexp" onchange="return formulacalculation()" onkeypress="return isFormula(event);" >
                </div>
                <div class="form-group">
                    <input type="text" class="parent_text text-right" name="formulavalue" value = "" id="formulavalue" readonly >
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="md_ok" onclick="return formulaok()" data-dismiss="modal" data-toggle="tooltip" data-original-title="OK">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="workgroupmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>WorkGroup</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="wgrowid" id="wgrowid">
                <input type="hidden" id="refNewWGRowName" />
                <div class="form-group" <?php echo ($wgcodegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <label style="margin-bottom: 10px;">SerialNo</label>
                    <input type="text" class="parent_text"  maxlength="50" name="workgroupslno" id="workgroupslno" onblur="checkwgslno()" >
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">WorkGroup Name</label>
                    <input type="text" class="parent_text"  maxlength="255" name="workgroup" id="workgroup" onblur="checkWorkGroupName()" >
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">WorkType</label>
                    <input type="text" class="parent_text" name="worktype" id ="worktype" >
                    <input type="hidden" name="worktype_id" id ="worktype_id" >
                    <div class="clearfix"></div>
                </div>
                <div class="radio_check">
                    <p>
                        <input type="checkbox" value="" id="auto-generate-rate" name="rateanal">
                        <label for="auto-generate-rate" class="ripple has-ripple" style="position: relative; overflow: hidden;">Automatically Generate Rate Analysis for Item of Work based on Work Group Analysis<span class="ripple-wrapper"></span></label>
                    </p>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return workgroupClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="workgroupok" class="md_ok" onclick="return WorkGroupUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="dummyheader" style="display: none">
    <table id="dummyanalhead">
        <tbody>
        <tr id="rateanal__1_header__9">
            <td colspan="7"><input type="text" class="parent_text"  style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanal__1_rowrefid__9" value = "" id="rateanal__1_rowrefid__9">
            <input type="hidden" name="rateanal__1_type__9" value = "H" id="rateanal__1_type__9">
            <input type="hidden" name="rateanal__1_refid__9" value = "" id="rateanal__1_refid__9">
            <td width="4%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id, event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                </ul></td>
        </tr>
        <tr id="rateanalR__1_header__9">
            <td colspan="7"><input type="text" class="parent_text" style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanalR__1_rowrefid__9" value = "" id="rateanalR__1_rowrefid__9">
            <input type="hidden" name="rateanalR__1_type__9" value = "H" id="rateanalR__1_type__9">
            <input type="hidden" name="rateanalR__1_refid__9" value = "" id="rateanalR__1_refid__9">
            <td width="4%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                </ul></td>
        </tr>
        </tbody>
    </table>
</div>
<div id="dummynewheader" style="display: none">
    <table id="dummynewhead">
        <tbody>
        <tr id="IOWiRowId__1" class="row_specheader">
            <td width="11%"><input type="text" class="parent_text" name="parentid__1" id="parentid__1"></td>
            <td width="3%"><input class="parent_text srl_no" type="text" name="serialno__1" value = "" id="serialno__1" readonly></td>
            <td width="3%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spcn">
                        <input class="parent_text" type="text" maxlength="50" name="refserialno__1" onblur="CheckRefNo(this.id)" id="refserialno__1" >
                        <div class="radio_check">
                            <p>
                                <input type="checkbox" name="" value ="" id="raheader__1" class="ripple"  onchange="checkHeader(this.id)"/>
                                <label for="raheader__1" class="ripple">Header</label>
                                <input type="hidden" name="raheaderval__1" id="raheaderval__1" value = "0">
                            </p>
                        </div>
                    </div>
                </div></td>
            <td width="11%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spc">
                        <textarea class="parent_texts" name="spec__1" value = "" id="spec__1" onchange = "return SpecChange(this.id)"></textarea>
                        <label>Short Spec</label>
                        <textarea class="parent_texts" maxlength="255" name="shortspec__1" value = "" id="shortspec__1"></textarea>
                    </div>
                </div></td>
            <td width="5%">&nbsp;</td>
            <td width="5%">&nbsp;</td>
            <input type="hidden" name="iowid__1" value = "0" id="iowid__1">
            <input type="hidden" name="rfctransid__1" id="rfctransid__1" value = "">
            <input type="hidden" name="unitkeyid__1" value = "" id="unitkeyid__1">
            <input type="hidden" name="parentkeyid__1" value = "" id="parentkeyid__1">
            <input type="hidden" name="rowrefid__1" value = "1" id="rowrefid__1">
            <input type="hidden" name="headerrow__1" id="headerrow__1" value = "1">
            <input type="hidden" name="sortid__1" id="sortid__1" value = "0">
            <input type="hidden" name="newworkgroupname__1" id="newworkgroupname__1" value = "">
            <input type="hidden" name="worktypeid__1" id="worktypeid__1" value = "">
            <input type="hidden" name="workgroupid__1" id="workgroupid__1" value = "">
            <input type="hidden" name="piowid__1" id="piowid__1" value = "">
            <input type="hidden" name="newparentname__1" id="newparentname__1" value = "">
            <td width="3%" class="action_btns_td"><ul class="action_btns">
                    <li> <a href="javascript:void(0);" class="mainTrDelete__1" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
                </ul></td>
        </tr>
        </tbody>
    </table>
</div>
<div id="dummy" style="display: none">
<table id="dummytable">
<tbody>
<tr id="IOWiRowId__1">
    <td width="11%"><input type="text" class="parent_text" name="parentid__1" id="parentid__1"></td>
    <td width="3%"><input class="parent_text srl_no" type="text" name="serialno__1" value = "" id="serialno__1" readonly></td>
    <td width="3%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spcn">
                <input class="parent_text" type="text" maxlength="50" name="refserialno__1" onblur="CheckRefNo(this.id)" id="refserialno__1">
                <div class="radio_check">
                    <p>
                        <input type="checkbox" name="" value ="" id="raheader__1" class="ripple"  onchange="checkHeader(this.id)"/>
                        <label for="raheader__1" class="ripple">Header</label>
                        <input type="hidden" name="raheaderval__1" id="raheaderval__1" value = "0">
                    </p>
                </div>
            </div>
        </div></td>
    <td width="11%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spc">
                <textarea class="parent_texts" name="spec__1" value = "" id="spec__1" onchange = "return SpecChange(this.id)"></textarea>
                <label>Short Spec</label>
                <textarea class="parent_texts" maxlength="255" name="shortspec__1" value = "" id="shortspec__1"></textarea>
            </div>
        </div></td>
    <td width="5%"><input type="text" class="parent_text" name="unitid__1" id="unitid__1" onblur="return CheckUnitValid(this.id)" ></td>
    <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rate__1" id="rate__1" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly></td>
    <input type="hidden" name="iowid__1" value = "0" id="iowid__1">
    <input type="hidden" name="rfctransid__1" id="rfctransid__1" value = "">
    <input type="hidden" name="unitkeyid__1" value = "" id="unitkeyid__1">
    <input type="hidden" name="parentkeyid__1" value = "" id="parentkeyid__1">
    <input type="hidden" name="rowrefid__1" value = "1" id="rowrefid__1">
    <input type="hidden" name="headerrow__1" id="headerrow__1" value = "0">
    <input type="hidden" name="sortid__1" id="sortid__1" value = "0">
    <input type="hidden" name="newworkgroupname__1" id="newworkgroupname__1" value = "">
    <input type="hidden" name="worktypeid__1" id="worktypeid__1" value = "">
    <input type="hidden" name="workgroupid__1" id="workgroupid__1" value = "">
    <input type="hidden" name="piowid__1" id="piowid__1" value = "">
    <input type="hidden" name="newparentname__1" id="newparentname__1" value = "">

    <!--<td width="3%"><a href="javascript:void(0);" class="mainTrDelete__1" style="margin-right: 10px;"><i class="fa fa-trash ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a> <a href="javascript:void(0);" class="mainTr__1"><i class="fa fa-chevron-circle-down ctls" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></td>-->
    <td width="3%" class="action_btns_td"><ul class="action_btns">
            <li> <a href="javascript:void(0);" class="mainTrDelete__1" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
            <li> <a href="javascript:void(0);" class="mainTr__1"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
        </ul></td>
</tr>
<!--expand table-->
<tr style="display:none;" class="subTr__1 paintTr">
<td colspan="9"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
<div class="col-lg-12">
    <!-- Nav tabs -->
    <div class="darkmenu" id="mixtab__1">
        <ul>
            <li class="active"><a href="javascript:void(0);" name="analtype__1" id="analtype__1" class="ripple" onclick="showmix('sitemix',this.id,event)"><span><i class="fa fa-caret-right "></i></span> Sitemix</a></li>
            <li><a href="javascript:void(0);" name="analtypeR__1" id="analtypeR__1" class="ripple" onclick="showmix('readymix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
        </ul>
        <div class="manual_seletc">
            <label>Rate Type</label>
            <div class="select-style select-inline">
                <select  name="ratetype__1" id ="ratetype__1" onchange="return IOWRateUpdate(this.id)">
                    <option value="">Default Rate Type</option>
                    <option value="S" selected>SiteMix</option>
                    <option value="R">ReadyMix</option>
                </select>
            </div>
        </div>
    </div>
    <!-- Tab panes
<div class="col-lg-12">
<span class="butclr btn-file" id="copyformat__1" onclick="refreshFromWorkGroup(this.id)" style="margin: 10px 0 0 0;> <i class="fa fa-folder-open sap"></i>
<p class="sam-up" >From WorkGroup</p>
</span>
</div>-->
    <div class="lstate">
        <ul  id="raworktable__<?php echo $i;?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AnalQty" id="rateanal__1_AnalQty" value="<?php echo $this->commonHelper()->sanitizeNumber(1,3); ?>" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li id="rateanal__1AQty_li">
                <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AQty" id="rateanal__1_AQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
            </li>
            <li id="rateanal__1BQty_li">
                <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_BQty" id="rateanal__1_BQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'S')"/>
            </li>
            <li id="rateanal__1CQty_li">
                <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_CQty" id="rateanal__1_CQty" title="Aggregate (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
            </li>
            <li id="rateanal__1thick_li">
                <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_thick" id="rateanal__1_thick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
            </li>
            <li> <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn"  id="copyformat__1" onclick="refreshFromWorkGroup(this.id)"><i class="fa fa-window-restore" aria-hidden="true"></i></a> </li>
            <li><a id="rateanal__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
        <ul  style="display: none;" id="raworkRtable__1">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR__1_AnalQty" id="rateanalR__1_AnalQty" value="1" title="Working Qty" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li><a id="rateanalR__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
    </div>
</div>
<div class="col-lg-12">
<div class="table-responsive topsp animated-panel zoomIn"  style="overflow: visible;animation-delay: 0.2s;">
<!-- Sitemix tabs -->
<table class="table" style="margin-bottom:0px;" id="rateanal__1_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc/Exc</th>
        <th class="bg_clo">RefNo</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo text-right">Rate</th>
        <th class="bg_clo text-right">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <tr onfocus="showrow(this.id)" id="rateanal__1_RowId__9">
        <td width="1%"><label>
                <input type="checkbox" name="rateanal__1_inc__9" value ="<?php echo true; ?>" id="rateanal__1_inc__9" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanal__1_ref__9" > R1 </label></td>
        <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanal__1_resid__9"  id="rateanal__1_resid__9" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)"/>
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id="rateanal__1_lblWastage__9">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanal__1_lblWeightage__9">Weightage %</label>
            </div></td>
        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal__1_resqty__9" id="rateanal__1_resqty__9" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_Wastage__9" id="rateanal__1_Wastage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_Weightage__9" id="rateanal__1_Weightage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div></td>
        <td width="5%"><label for ="rateanal__1_resunit__9" ></label></td>
        <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_resrate__9"  id="rateanal__1_resrate__9" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)"  readonly/></td>
        <td width="10%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_resamt__9"  id="rateanal__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
        <!--<td width="3%"><a href="javascript:void(0);"  name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Add new"></i></a></td>-->
        <td width="3%" class="action_btns_td"><ul class="action_btns">
                <li> <a href="javascript:void(0);" name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id,event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
        <input type="hidden" name="rateanal__1_WastageQty__9" id="rateanal__1_WastageQty__9">
        <input type="hidden" name="rateanal__1_WastageAmount__9" id="rateanal__1_WastageAmount__9">
        <input type="hidden" name="rateanal__1_reskeyid__9" id="rateanal__1_reskeyid__9">
        <input type="hidden" name="rateanal__1_iowkeyid__9" id="rateanal__1_iowkeyid__9">
        <input type="hidden" name="rateanal__1_formula__9" value = "" id="rateanal__1_formula__9">
        <input type="hidden" name="rateanal__1_rowrefid__9" value = "1" id="rateanal__1_rowrefid__9">
        <input type="hidden" name="rateanal__1_type__9" value = "R" id="rateanal__1_type__9">
        <input type="hidden" name="rateanal__1_refid__9" value = "1" id="rateanal__1_refid__9">
        <input type="hidden" name="rateanal__1_restypeid__9"  id="rateanal__1_restypeid__9">
        <input type="hidden" name="rateanal__1_ratetype__9"  value="L" id="rateanal__1_ratetype__9">
        <input type="hidden" name="rateanal__1_newresname__9" value = "" id="rateanal__1_newresname__9">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right" ><label>Total Weightage %</label></td>
        <td><input type="text" class="parent_text total-clr text-right" id="rateanal__1_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totwastage" value = "" id="rateanal__1_totwastage" readonly/></td>
        <td style="border-right:none;"><ul class="action_btns">
                <li> <a href="javascript:void(0);" class="wasteTr__1"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
            </ul></td>
    </tr>
    <tr style="display:none;" class="wastemainTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div id="divwaste__1"></div>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totbaserate" id="rateanal__1_totbaserate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totqualrate" id="rateanal__1_totqualrate" readonly/></td>
                    <td style="border-right:none;border-top:none;"><ul class="action_btns">
                            <li> <a href="javascript:void(0);" class="qualTr__1"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                        </ul></td>
                </tr>
            </div></td>
    </tr>
    <tr style="display:none;" class="qualmainTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;"> <?php echo $qualHtml;?>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal__1_lbltotrate">Rate for</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanal__1_totrate" id="rateanal__1_totrate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal__1_lbltotnetrate">Net Rate per</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanal__1_totnetrate" id="rateanal__1_totnetrate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>
            </div></td>
    </tr>
    </tbody>
</table>
<input type="hidden" name="rowinfoid__1" id="rowinfoid__1" value="1">
<!-- Readymix tabs -->
<table class="table" style="display: none;margin-bottom:0px;" id="rateanalR__1_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc/Exc</th>
        <th class="bg_clo">RefNo</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo text-right">Rate</th>
        <th class="bg_clo text-right">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <tr onfocus="showrow(this.id)" id="rateanalR__1_RowId__9">
        <td width="1%"><label>
                <input type="checkbox" name="rateanalR__1_inc__9" value = "<?php echo true; ?>" id="rateanalR__1_inc__9" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanalR__1_ref__9" > R1 </label></td>
        <td width="15%"><input class="parent_text" data-toggle="popover" name="rateanalR__1_resid__9" id="rateanalR__1_resid__9" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id="rateanalR__1_lblWastage__9">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanalR__1_lblWeightage__9">Weightage %</label>
            </div></td>
        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resqty__9" id="rateanalR__1_resqty__9" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_Wastage__9" id="rateanalR__1_Wastage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_Weightage__9" id="rateanalR__1_Weightage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div></td>
        <td width="5%"><label for ="rateanalR__1_resunit__9"></label></td>
        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resrate__9"  id="rateanalR__1_resrate__9" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
        <td width="10%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resamt__9" id="rateanalR__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
        <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
        <td width="3%" class="action_btns_td"><ul class="action_btns">
                <li> <a href="javascript:void(0);" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)" style="display: none;"> <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
        <input type="hidden" name="rateanalR__1_WastageQty__9" id="rateanalR__1_WastageQty__9">
        <input type="hidden" name="rateanalR__1_WastageAmount__9" id="rateanalR__1_WastageAmount__9">
        <input type="hidden" name="rateanalR__1_reskeyid__9" id="rateanalR__1_reskeyid__9">
        <input type="hidden" name="rateanalR__1_iowkeyid__9" id="rateanalR__1_iowkeyid__9">
        <input type="hidden" name="rateanalR__1_formula__9" value = "" id="rateanalR__1_formula__9">
        <input type="hidden" name="rateanalR__1_rowrefid__9" value = "1" id="rateanalR__1_rowrefid__9">
        <input type="hidden" name="rateanalR__1_type__9" value = "R" id="rateanalR__1_type__9">
        <input type="hidden" name="rateanalR__1_refid__9" value = "1" id="rateanalR__1_refid__9">
        <input type="hidden" name="rateanalR__1_restypeid__9" value = "" id="rateanalR__1_restypeid__9">
        <input type="hidden" name="rateanalR__1_ratetype__9" value = "L" id="rateanalR__1_ratetype__9">
        <input type="hidden" name="rateanalR__1_newresname__9" value = "" id="rateanalR__1_newresname__9">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
        <td><input type="text" class="parent_text total-clr text-right" id="rateanalR__1_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totwastage" value = "" id="rateanalR__1_totwastage" readonly/></td>
        <td style="border-right:none;"><ul class="action_btns">
                <li> <a href="javascript:void(0);" class="wasteRTr__1"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
            </ul></td>
    </tr>
    <tr style="display:none;" class="wastemainRTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div id="divwasteR__1"></div>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totbaserate" id="rateanalR__1_totbaserate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totqualrate" id="rateanalR__1_totqualrate" readonly/></td>
                    <td style="border-right:none;border-top:none;"><ul class="action_btns">
                            <li> <a href="javascript:void(0);" class="qualTr__1"> <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span> </a> </li>
                        </ul></td>
                </tr>

                <tr style="display:none;" class="qualmainTr__1">
                    <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;"></div>
                        <?php echo $qualRHtml;?></td>
                </tr>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label id="rateanalR__1_lbltotrate">Rate for</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totrate" id="rateanalR__1_totrate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>

                <tr style="border-bottom:none;">
                    <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanalR__1_lbltotnetrate">Net Rate per</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totnetrate" id="rateanalR__1_totnetrate" readonly/></td>
                    <td style="border-right:none;border-top:none;">&nbsp;</td>
                </tr>
            </div></td>
    </tr>
    </tbody>
</table>
<input type="hidden" name="rowinfoidR__1" id="rowinfoidR__1" value="1">
</div>
</div>
</div></td>
</tr>
</tbody>
</table>
</div>
<div id="dummyactivity" style="display: none">
    <div class="darkmenu col-lg-12">
        <div class="col-lg-4">
            <ul>
                <li class="active"><a href="javascript:void(0);" name="analtypeM" id="analtype" class="ripple" onclick="showAnalmix('manual',this.id, event)"><span><i class="fa fa-magic"></i></span> Manual</a></li>
                <li><a href="javascript:void(0);"name="analtype" id="analtypeA" class="ripple" onclick="showAnalmix('machinery',this.id, event)"><span><i class="fa fa-cogs"></i></span> Machinery</a></li>
            </ul>
        </div>
        <div class="col-lg-8 lstatea manual_mac">
            <ul>
                <li>
                    <label>LS Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateL" id="analrateL" title="LS Rate" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Manual Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateM" id="analrateM" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Machinery Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateA" id="analrateA" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Rate Type</label>
                    <div class="select-style select-inline">
                        <select name="analrate" id ="analrate"  onchange="return MainRateUpdate(this)">
                            <option value="L" >LS </option>
                            <option value="M" >Manual </option>
                            <option value="A" >Machinery </option>
                        </select>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-lg-12 clear" id="activitymanual" style="margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right" maxlength="15" name="activityAnalQty" id="activityAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12" id="activitymachinery" style="display: none; margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right"  maxlength="15" name="activityRAnalQty" id="activityRAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12">
        <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
            <!-- Manual tabs -->
            <table class="table" style="margin-bottom:0px;" id="activityrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr text-right">Rate</th>
                    <th class="bg_clo_subTr text-right">Amount</th>
                </tr>
                </thead>
                <tbody>
                <tr id="activityRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityresid_1" id ="activityresid_1" readonly ></td>
                    <!--<td width="5%"><input type="text" class="parent_text" name="activityresunit_1" id="activityresunit_1" readonly></td>-->
                    <td width="5%"><label for ="activityresunit_1" ></label></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresqty_1" id="activityresqty_1" readonly ></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresrate_1" id="activityresrate_1" readonly></td>
                    <td width="8%"><input type="text" class="parent_text text-right" name="activityresamt_1" id="activityresamt_1" readonly ></td>
                    <input type="hidden" name="activityformula_1" value = "" id="activityformula_1">
                </tr>
                </tbody>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none; font-weight:600;" align="right" class="rate_pri">Total</td>
                    <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activitytotrate" id="activitytotrate" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate Per Unit</td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityperrate" id="activityperrate" readonly/></td>
                </tr>
            </table>
            <input type="hidden" name="arowinfoid" id="arowinfoid" value="1">
            <!-- Machinery tabs -->
            <table class="table" style="display: none;margin-bottom:0px;" id="activityRrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr text-right">Rate</th>
                    <th class="bg_clo_subTr text-right">Amount</th>
                </tr>
                </thead>
                <tbody >
                <tr id="activityRRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityRresid_1" id ="activityRresid_1" readonly ></td>
                    <td width="5%"><label for ="activityRresunit_1" ></label></td>
                    <!--<td width="8%"><input type="text" class="parent_text" name="activityRresunit_1" id="activityRresunit_1" readonly></td> -->
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresqty_1" id="activityRresqty_1"  readonly></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresrate_1" id="activityRresrate_1" readonly></td>
                    <td width="12%"><input type="text" class="parent_text text-right" name="activityRresamt_1" id="activityRresamt_1" readonly></td>
                    <input type="hidden" name="activityRformula_1" value = "" id="activityRformula_1">
                </tr>
                </tbody>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;font-weight:600; vertical-align: middle; " align="right" class="rate_pri">Total</td>
                    <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityRtotrate" id="activityRtotrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate Per Unit</td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityRperrate" id="activityRperrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
            </table>
            <input type="hidden" name="arowinfoidR" id="arowinfoidR" value="1">
        </div>
    </div>
</div>
<div id="dummysubiow" style="display: none">
    <tr class="subiow_1">
        <td width="100%"><div class="col-lg-12">
                <!-- Nav tabs -->
                <div class="darkmenu" id="subiowmixtype">
                    <ul>
                        <li class="active"><a href="javascript:void(0);" name="sanaltypeS" class="ripple" id="sanaltype" onclick="showSubIOWMix('sitemix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Sitemix</a></li>
                        <li><a href="javascript:void(0);" name="sanaltype" id="sanaltypeR" class="ripple" onclick="showSubIOWMix('readymix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
                    </ul>
                    <div class="manual_seletc">
                        <label>Rate Type</label>
                        <div class="select-style select-inline">
                            <select name="analrate" id ="analrate" onchange="return MainRateUpdateIOW(this)">
                                <option value="">Default Rate Type</option>
                                <option value="S" >SiteMix </option>
                                <option value="R" >ReadyMix </option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Tab panes -->
                <div class="lstate">
                    <ul  id="sraworktable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalAnalQty" id="srateanalAnalQty" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly />
                        </li>
                        <li id="subiowcement">
                            <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalAQty" id="srateanalAQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li id="subiowsand">
                            <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalBQty" id="srateanalBQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li id="subiowmetal">
                            <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalCQty" id="srateanalCQty" title="Aggregate (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li id="subiowthick">
                            <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalthick" id="srateanalthick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                    <ul  style="display: none;" id="sraworkRtable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="srateanalRAnalQty" id="srateanalRAnalQty" title="Working Qty" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;">
                    <!-- Sitemix tabs -->
                    <table class="table" style="margin-bottom:0px;" id="srateanalrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc/Exc</th>
                            <th class="bg_clo_subTr">RefNo</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo">Wastage%</th>
                            <th class="bg_clo">Weightage%</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr text-right">Rate</th>
                            <th class="bg_clo_subTr text-right">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalinc_1" value ="<?php echo true; ?>" id="srateanalinc_1" checked class="ios_checkbox inc_exc" readonly />
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="srateanalref_1">R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalresid_1" id ="srateanalresid_1" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalresqty_1" value = "" id="srateanalresqty_1" onfocus="return showformula(this.id)"  onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalWastage_1" value = "" id="srateanalWastage_1"  onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalWeightage_1" value = "" id="srateanalWeightage_1"  onkeypress="return isDecimal(event,this)" readonly/></td>
                            <td width="5%"><label for ="srateanalresunit_1" ></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalresrate_1" id="srateanalresrate_1" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalresamt_1" id="srateanalresamt_1" readonly onkeypress="return isDecimal(event,this)"/></td>
                            <input type="hidden" name="srateanalWastageQty_1" value = "" id="srateanalWastageQty_1">
                            <input type="hidden" name="srateanalWastageAmount_1" value = "" id="srateanalWastageAmount_1">
                            <input type="hidden" name="srateanalformula_1" value = "" id="srateanalformula_1">
                            <input type="hidden" name="srateanalrowrefid_1" value = "" id="srateanalrowrefid_1">
                            <input type="hidden" name="srateanaltype_1" value = "R" id="srateanaltype_1">
                            <input type="hidden" name="srateanalrefid_1" value = "1" id="srateanalrefid_1">
                            <input type="hidden" name="srateanalrestypeid_1" value = "" id="srateanalrestypeid_1">
                        </tr>
                        </tbody>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;" align="right" class="rate_pri"><label>Rate for</label></td>
                            <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanaltotrate" id="srateanaltotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalperrate" id="srateanalperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Net rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalnetrate" id="srateanalnetrate" readonly/></td>
                        </tr>
                    </table>
                    <input type="hidden" name="srowinfoid" id="srowinfoid" value="1">
                    <!-- Readymix tabs -->
                    <table class="table" style="display: none;margin-bottom:0px;"  id="srateanalRrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc/Exc</th>
                            <th class="bg_clo_subTr">RefNo</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo">Wastage%</th>
                            <th class="bg_clo">Weightage%</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr text-right">Rate</th>
                            <th class="bg_clo_subTr text-right">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalRinc_1" value = "<?php echo true; ?>" id="srateanalRinc_1" checked class="ios_checkbox inc_exc" readonly/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="" >R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalRresid_1" id ="srateanalRresid_1" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalRresqty_1" id="srateanalRresqty_1" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalRWastage_1" id="srateanalRWastage_1"  onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalRWeightage_1" id="srateanalRWeightage_1"  onkeypress="return isDecimal(event,this)" readonly/></td>
                            <td width="5%"><label for ="srateanalRresunit_1"></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalRresrate_1" id="srateanalRresrate_1"  onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="srateanalRresamt_1" id="srateanalRresamt_1" readonly onkeypress="return isDecimal(event,this)" readonly/></td>
                            <input type="hidden" name="srateanalRWastageQty_1" value = "" id="srateanalRWastageQty_1" />
                            <input type="hidden" name="srateanalRWastageAmount_1" value = "" id="srateanalRWastageAmount_1" />
                            <input type="hidden" name="srateanalRformula_1" value = "" id="srateanalRformula_1" />
                            <input type="hidden" name="srateanalRrowrefid_1" value = "" id="srateanalRrowrefid_1" />
                            <input type="hidden" name="srateanalRtype_1" value = "R" id="srateanalRtype_1" />
                            <input type="hidden" name="srateanalRrefid_1" value = "1" id="srateanalRrefid_1" />
                            <input type="hidden" name="srateanalRrestypeid_1" value = "" id="srateanalRrestypeid_1" />
                        </tr>
                        </tbody>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;" align="right" class="rate_pri"><label>Rate for</label></td>
                            <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRtotrate" id="srateanalRtotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRperrate"id="srateanalRperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td colspan="8" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Net rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRnetrate" id="srateanalRnetrate" readonly/></td>
                        </tr>
                    </table>
                    <input type="hidden" name="srowinfoidR" id="srowinfoidR" value="1">
                </div>
            </div></td>
    </tr>
</div>
<div id="resourcemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="resrowid" id="resrowid" >
                <input type="hidden" id="refNewResRowName" />
                <div class="col-lg-12" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Code</label>
                        <input type="text" class="parent_text"  maxlength="100" name="rescode" id="rescode" onblur="CheckResCode()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-12">
                        <label style="margin-bottom: 10px;">Resource Name</label>
                        <input type="text" class="parent_text"  maxlength="255" name="resname" id="resname" onblur="CheckResName()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Group</label>
                        <input type="text" class="parent_text" name="resgroup" id="resgroup" autocomplete="off">
                        <input type="hidden" name="resgroupid" id="resgroupid">
                    </div>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Type</label>
                        <input type="text" class="parent_text"  name="restype" id="restype" readonly>
                        <input type="hidden" name="restypeid" id="restypeid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Unit</label>
                        <input type="text" class="parent_text" name="resunit" id="resunit" autocomplete="off">
                        <input type="hidden" name="resunitid" id="resunitid">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkunit">
                        <label style="margin-bottom: 10px;">Working Unit</label>
                        <input type="text" class="parent_text" name="wresunit" id="wresunit" autocomplete="off">
                        <input type="hidden" name="wresunitid" id="wresunitid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="resrate" id="resrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkrate">
                        <label style="margin-bottom: 10px;">Working Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="wresrate" id="wresrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                </div>
                <div class="col-lg-12" id ="divmattype">
                    <div class="form-group col-lg-6">
                        <label>Material Type</label>
                        <div class="select-style rfc_meoption">
                            <select name="resmattype" id ="resmattype">
                                <option value="G">General</option>
                                <option value="F">Fuel</option>
                                <option value="S">Steel</option>
                                <option value="P">Production</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Lead Time (in Days)</label>
                        <input type="text" class="parent_text text-right"  name="restlead" maxlength="3" id="reslead" onkeypress="return isDecimal(event,this)">
                    </div>
                </div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return ResourceClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="newresok" class="md_ok" onclick="return ResourceUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="excelmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-lg" style="width: 90%">
<div class="modal-content">
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
    <h1>Item of Work Import Sheet - Validation Steps</h1>
</div>
<div class="modal-body model-middle">
    <div class="col-lg-12">
        <div class="row">
            <div class="step_by_liner animated slideInDown"></div>
            <ul class="step_by stepby_mb23">
                <li class="opacity_08">
                    <div id="divstep1" class="step_by_sep animated slideInRight">
                        <p>1</p>
                    </div>
                    <p id="p_1" class="stepli_p2">Fields</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep2" class="step_by_sep animated slideInRight">
                        <p>2</p>
                    </div>
                    <p id="p_2">RowType</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep3" class="step_by_sep animated slideInRight">
                        <p>3</p>
                    </div>
                    <p id="p_3">Workgroup</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep4" class="step_by_sep animated slideInRight">
                        <p>4</p>
                    </div>
                    <p id="p_4">Specification</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep5" class="step_by_sep animated slideInRight" >
                        <p>5</p>
                    </div>
                    <p id="p_5">Resource</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep6" class="step_by_sep animated slideInRight">
                        <p>6</p>
                    </div>
                    <p id="p_6">Units</p>
                </li>
                <li class="opacity_08">
                    <div id="divstep7" class="step_by_sep animated slideInRight">
                        <p>7</p>
                    </div>
                    <p id="p_7">Finalise</p>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-lg-12  col-md-12 col-sm-12 cnt_slider">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner" role="listbox">
                <div class="item active" id="divitem1">
                    <div class="col-md-7 col-md-offset-3">
                        <h1 class="h1-head">Assign Fields</h1>
                        <div class="table-responsive popuptable animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                            <table class="table" width="100%" style=" margin-bottom:0px;">
                                <tbody>
                                <tr id="excelfieldTable"></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="item" id="divitem2">
                    <h1 class="h1-head">Bill of Quantities</h1>
                    <div class="table-responsive parent-scroll" id="diviowtable" style="display: block">
                        <table class="fixTable table" style="margin-bottom:0px;" id="excelTable">
                            <thead>
                            <tr>
                                <th class="th-modal">Parent</th>
                                <th class="th-modal">RefNo</th>
                                <th class="th-modal">Specification</th>
                                <th class="th-modal">Unit</th>
                                <th class="th-modal">Qty</th>
                                <th class="th-modal text-right">Rate</th>
                                <th class="th-modal text-right">Amount</th>
                                <th class="th-modal">RowType</th>
                                <th class="th-modal">&nbsp; </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr id="excelrowid_1">
                                <td style="width:20%"><input type="text" class="parent_text"  id="excelparent_1" ></td>
                                <td style="width:10%"><input type="text" class="parent_text"  id="excelserialno_1" ></td>
                                <!--                                            <td style="width:10%"><input type="text" class="parent_text"  id="excelcode_1" ></td>-->
                                <td style="width:25%"><input type="text" class="parent_text"  id="excelspec_1" ></td>
                                <td style="width:10%"><input type="text" class="parent_text"  id="excelunit_1" onfocus="excelUnitFocus(this.id)" onchange="excelUnitvalid(this.id)"></td>
                                <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelqty_1" onkeypress="return isDecimal(event,this)"></td>
                                <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelrate_1" onkeypress="return isDecimal(event,this)"></td>
                                <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelamount_1" onkeypress="return isDecimal(event,this)"></td>
                                <td style="width:5%"><input type="text" class="parent_text"  id="excelrowtype_1" onchange="validRowType(this.id)"></td>
                                <td width="3%" align="center"><a href="javascript:void(0);" class="excelTrDelete_1" style="margin-right: 10px;display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></td>
                                <input type="hidden" id="exceliowid_1" >
                                <input type="hidden" id="excelparentid_1">
                                <input type="hidden" id="excelwgid_1" >
                                <input type="hidden" id="excelwgtypeid_1" >
                                <input type="hidden" id="excelunitid_1" >
                                <input type="hidden" id="excelresid_1" >
                                <input type="hidden" id="excelrestypeid_1" >
                                <input type="hidden" id="excelnewresspec_1" >
                                <input type="hidden" id="excelnewworkgroupname_1" >
                                <input type="hidden" id="excelparentspec_1" >
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="item" id="divitem3">
                    <h1 class="h1-head">Undefined WorkGroup</h1>
                    <div class="table-responsive parent-scroll" id="divwgtable" style="display: block">
                        <table class="fixTable table" style="margin-bottom:0px;" id="excelwgTable">
                            <thead>
                            <tr>
                                <th>Undefined WorkGroup</th>
                                <th>Library WorkGroup</th>
                                <th>WorkType</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td style="width:35%"><input type="text" class="parent_text"  id="excelunworkgroup_1" readonly></td>
                                <td style="width:30%"><input type="text" class="parent_text"  id="excelrefworkgroup_1"></td>
                                <td style="width:30%"><input type="text" class="parent_text"  id="excelrefworktype_1"></td>
                                <input type="hidden" id="excelrefworkgroupid_1" >
                                <input type="hidden" id="excelrefworktypeid_1" >
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="item" id="divitem4">
                    <h1 class="h1-head">Undefined Resource</h1>
                    <div class="table-responsive parent-scroll form-group" id="divrestable" style="display: block">
                        <table class="fixTable table" style=" box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);border:1px solid #ddd" id="excelresTable">
                            <thead>
                            <tr>
                                <th style="width:20%" class="th-modal">Undefined Resource</th>
                                <th style="width:20%" class="th-modal">Resource</th>
                                <th style="width:20%" class="th-modal">Resource Group</th>
                                <th style="width:10%" class="th-modal">Unit</th>
                                <th style="width:10%" class="th-modal">Type</th>
                                <th style="width:10%" class="th-modal">MaterialType</th>
                                <th style="width:10%" class="th-modal text-right">WorkingUnit</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td style="width:20%"><input type="text" class="parent_text"  id="excelresresource_1" readonly></td>
                                <td style="width:20%"><input type="text" class="parent_text"  id="excelresoldresource_1" onfocus="return checkExcelResourceFocus(this.id)"></td>
                                <td style="width:20%"><input type="text" class="parent_text"  id="excelresresgroup_1"></td>
                                <td style="width:10%"><input style="display: none;" type="text" class="parent_text"  id="excelresunit_1"></td>
                                <td style="width:10%"><input style="display: none;" type="text" class="parent_text"  id="excelrestype_1" readonly></td>
                                <td style="width:10%">
                                    <select style="display: none;" id ="excelresmaterialtype_1">
                                        <option value="G">General</option>
                                        <option value="F">Fuel</option>
                                        <option value="S">Steel</option>
                                        <option value="P">Production</option>
                                    </select>
                                </td>
                                <td style="width:10%"><input style="display: none;" type="text" class="parent_text"  id="excelreswunit_1"></td>
                                <input type="hidden" id="excelresold_1" >
                                <input type="hidden" id="excelresunitid_1" >
                                <input type="hidden" id="excelresresgroupid_1" >
                                <input type="hidden" id="excelresrestypeid_1" >
                                <input type="hidden" id="excelreswunitid_1" >
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="item" id="divitem5">
                    <h1 class="h1-head">Undefined Units</h1>
                    <div class="table-responsive parent-scroll" id="divunittable" style="display: block">
                        <table class="fixTable table" style="margin-bottom:0px;" id="excelunitTable">
                            <thead>
                            <tr>
                                <th>Undefined Unit</th>
                                <th>Unit</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td style="width:50%"><input type="text" class="parent_text"  id="excelununit_1" readonly></td>
                                <td style="width:50%"><input type="text" class="parent_text"  id="excelrefunit_1"></td>
                                <input type="hidden" id="excelrefunitid_1" >
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div class="modal-footer">
    <div align="carousel">
        <a class="carousel-control md_ok" id="carouselNext" href="javascript:void(0);" data-slide="next">Next</a></div>
    <a style="display: none" class="carousel-control md_ok" id="carouselApply" href="javascript:IOWUpdate();">Apply</a></div>
</div>
</div>
</div>
<!--div id="excelmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="width: 90%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Item of Work Import Sheet</h1>
            </div>

            <div id="divexcelapply" style="display: none"class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return IOWUpdate()" >Apply</button>
            </div>
        </div>
    </div>
</div-->
<script type="text/javascript">
$(function () {
    $('body').tooltip({
        selector: '.error'
    });

    $('body').on('focus', 'textarea[id^=spec_],textarea[id^=shortspec_]', function () {
        $(this).parents('.on-focus').addClass('expandDiv');
    });

    $('body').on('blur', 'textarea[id^=spec_],textarea[id^=shortspec_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDiv');
    });


    $('body').on('focus', 'input[id^=refserialno_]', function () {
        $(this).parents('.on-focus').addClass('expandDivn');
    });

    $('body').on('blur', 'input[id^=refserialno_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDivn');
    });


    $(document).on('click', function() {
        toogleTooltip();
        toogleTooltipn();
    });
    $(document).on('keydown',function() {
        toogleTooltip();
        toogleTooltipn();
    });

});
var iFocusRowId=1;
var iTransRowId=0;
var bSiteMix=true;
var sWGUpdateMode='Add';
var sResUpdateMode='Add'
var arrres = <?php echo json_encode($reslist); ?>;
var arrrespicklist = <?php echo json_encode($respicklist); ?>;
var arrrespicklistR = [];
var arriowpicklist = <?php echo json_encode($iowpicklist); ?>;
var arriowpicklistR = [];
var arriowres = <?php echo json_encode($resiowlist); ?>;
var arrayreslist1 = $.map(arrres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'Resource' }}; });
var arrayreslist2 = $.map(arriowres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'IOW' }}; });
var arrayreslist = arrayreslist1.concat(arrayreslist2);
var arrayres = arrayreslist;
var arrayresR = arrayreslist;
var arrayunitlist = <?php echo json_encode($unit); ?>;
var arraywunitlist = <?php echo json_encode($wunit); ?>;
var arryparentList = <?php echo json_encode($parentiow); ?>;
var arrayworktype = <?php echo json_encode($worktype); ?>;
var arrayresgroup = <?php echo json_encode($resgroup); ?>;
var arrexcelresgroup = <?php echo json_encode($excelresgroup); ?>;
var arrexcelresource = <?php echo json_encode($excelresource); ?>;
var arrexcelresourceR = arrexcelresource;
var arrayworkgroup = <?php echo json_encode($workgroup); ?>;
var arrActivityAnal= [];
var arrActivityRes= [];
var arrSubIOW= [];
var arrSubIOWAnal= [];
var arrSlNo=[];
var arrnewSlNo=[];
var bLoad=false;
var bShowAnalysis=false;

var bexcelRowTypeFound =false;
var bexcelUnitFound =false;
var bexcelResFound =false;
var bexcelWGFound =false;
var bexcelSheetValid =false;
var iExcelStep=0;

var bExcelSNo = false,
    bExcelRowType = false,
    bExcelSpec = false,
    bExcelUnit = false,
    bExcelQty = false,
    bExcelRate = false,
    bExcelAmount = false;

var formData = new FormData();
var arrayField =[];
arrayField = [{ data :1, value: 'SerialNo' },
    { data :2, value: 'Specification' },
    { data :3, value: 'Unit' },
    { data :4, value: 'Qty' },
    { data :5, value: 'Rate' },
    { data :6, value: 'Amount' },
    { data :7, value: 'RowType' },
];

var arrayFieldR = arrayField;

var arrayRowType =[];
arrayRowType = [{ data :1, value: 'I' },
    { data :2, value: 'R' },
    { data :3, value: 'H' },
    { data :4, value: 'WG' }
];


$(document).ready(function() {
    $(".fixTable").tableHeadFixer();
});

function inputFocus(i){
    if(i.value==i.defaultValue) i.value=""; i.style.color="#000";
}
function inputBlur(i){
    if(i.value=="") i.value=i.defaultValue; i.style.color="#888";
}
function AddNewHeader(x) {
    var key = x.id.split("_")[1],
        $spec = $('#spec_' + key ),
        $agtno = $('#agtno_' + key ),
        $tr = $spec.closest('tr');

    var $rowid = $('#rowid'),
        rowid = parseInt($rowid.val());
    var count = rowid + 1,
        template = $('#dummynewhead tbody').html();
    template = template.replace(/__1/g, '_' + count);
    $tr.before(template);

    // set header value
    if(!$('.' +
        '' + key).is(':visible')) {
        $('#spec_' + count).val($spec.val());
        $('#agtno_' + count).val($agtno.val());

        $spec.val('');
        $agtno.val('');
    }


    $('#rowrefid_' + count).val(count);
    $('#rowid').val(count);

    $('.autocomplete-suggestions').hide();

    bindAutoComplete();
    bindTRDeleteFn(true);
    bindMixSortablefn(true);
    $('.mainTrDelete_' + count).show();
    SortOrderBOQ();
    bindResourceChange();
    bindPopOver();
    checkRAUsed();

}
function bindPopOver() {
    var $inputs =  $('input[data-toggle="popover"]');
    $inputs.unbind('popover');
    $inputs.popover({
        placement : 'auto left',
        trigger : 'hover'
    });
}
function bindResourceChange() {
    var $resnames = $('input[id*=_resid_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $('#'+ name).attr('data-content', $('#'+ name).val());
        $this.blur(function () {
            if (isNullCheck($('#'+ name).val(),'string') =="") $this.removeClass('error')
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
        $this.change(function () {
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
    });
}
function toogleTooltipn() {

    var $expandDivs = $('.expandDivn');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('input').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDivn').find('input').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDivn');
        $expandDivs.not($parent_focus).find('input').trigger('blur');
        return;
    }
}
function toogleTooltip() {
    var $expandDivs = $('.expandDiv');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('textarea').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDiv').find('textarea').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDiv');
        $expandDivs.not($parent_focus).find('textarea').trigger('blur');
        return;
    }
}
// Expand Script
function expandTrFn(reset) {
    var $mainTRs = $("a[class*=mainTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            $('rateanal_'+ key +'_restable').show();
            iFocusRowId = key;
            closedetails(name);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}
function expandResSubTr(tr, id) {
    var $subTr = $('#' + tr),
        $i = $('#' + id).find("i"),
        type = id.split('_')[0],
        rateanal = '#rateanal_';
    if (type.substr(type.length - 1) == 'R') rateanal = '#rateanalR_';
    if($subTr.length ==0) {
        var sStr = id.split('_');
        $(rateanal+ sStr[1] +'_resrate_' + sStr[3]).triggerHandler('focus');
        return;
    }
    if(!$subTr.is(":visible")){
        $subTr.show();
        $subTr.find(".subDiv").slideDown("slow");
        $i.addClass("tform");
    } else{
        $subTr.find(".subDiv").slideUp("slow");
        $subTr.slideUp("slow");
        $i.removeClass("tform");
    }
}

function expandQualTrFn(reset) {
    var $mainTRs = $("a[class*=qualTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".qualmainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closeQualdetails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closeQualdetails(key) {
    var $mainTRs = $("a[class*=qualTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}


function expandwasteTrFn(reset) {
    var $mainTRs = $("a[class*=wasteTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewastedtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewastedtails(key) {
    var $mainTRs = $("a[class*=wasteTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}


function expandwasteRTrFn(reset) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainRTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewasteRdtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewasteRdtails(key) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}

function normalizeValue(q) {
    q = q.replace(/[éèêë]/gi, 'e');
    q = q.replace(/[áàâäåæ]/gi, 'a');
    q = q.replace(/[ç]/gi, 'c');
    q = q.replace(/[ïîíì]/gi, 'i');
    q = q.replace(/[ôöœø]/gi, 'o');
    q = q.replace(/[üûúù]/gi, 'u');
    // ...
    return q;
};

function bindAutoComplete() {
    var $parent_ids = $('input[id*=parentid_]'),
        $unitids = $('input[id*=unitid_]');
    // unbind previous autocomplete functionality
    $parent_ids.unbind('autocomplete');
    $unitids.unbind('autocomplete');
    $.each($parent_ids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 =  name.split('_')[1];
        $this.autocomplete({
            lookup: arryparentList,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newworkgroup_'+ key1  +'" class="btn btn-link" id="newworkgroup_'+ key1 +'" value="Work Group" onclick="return AddNewWorkGroup('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#parentkeyid_"+ key1).val(suggestion.data);
                    $("#worktypeid_"+ key1).val(suggestion.worktypeid);
                    $("#workgroupid_"+ key1).val(suggestion.workgroupid);
                    $("#piowid_"+ key1).val(suggestion.iowid);
                    $("#newworkgroupname_"+ key1).val(suggestion.workgroupname);
                    $("#newparentname_"+ key1).val(suggestion.parentname);

                    CheckParentValid('parentid_'+key1);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#parentkeyid_"+ key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#parentkeyid_"+ key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newunit_'+ key1  +'" class="btn btn-link" id="newunit_'+ key1 +'" value="Unit" onclick="return AddNewUnit('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#unitkeyid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                    AddNewRowA(name);
                }
            },
            onSearchStart: function(suggestion) {
                $("#unitkeyid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#unitkeyid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
}
//function bindResourceChange() {
//    var $resnames = $('input[id*=resid_]');
//    $.each($resnames, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        if (name.indexOf('__') != -1) return;
//        $this.blur(function () {
//            $this.removeClass('error')
//        });
//    });
//}
function bindResourceAutoComplete() {
    var $resids = $('input[id*=resid_]');
    // unbind previous autocomplete functionality
    $resids.unbind('autocomplete');
    $.each($resids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_'),
            key1 = arrname[1],
            key2 = arrname[3],
            sname = arrname[0];
        if (sname.substr(sname.length-1) === 'R') {
            var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayresR,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id, key1, key2, "R");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id, key1, key2, "R");
                        }

                        var iRowid = parseInt(isNullCheck($('#rowinfoidR_' + key1).val(),'number'));
                        iRowid = +iRowid+1;
                        var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + iRowid);
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowResR(key1,key2);
                            $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        } else {
            var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanal_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayres,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanal_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id,key1, key2,"");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanal_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id,key1, key2,"");
                        }
                        var iRowid = parseInt(isNullCheck($('#rowinfoid_' + key1).val(),'number'));
                        iRowid = +iRowid+1;
                        var $rateanal =  $('#rateanal_'+key1+'_RowId_' + iRowid);
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowRes(key1,key2);
                            $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        }
    });
}
function bindResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    var sName = arr_names[0];
    if (sName.substr(sName.length-1) == 'R') {
        checkResource(key1,"R");
        var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayresR,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id, key1, key2, "R");
                    }
                    else if (suggestion.data.category == "IOW") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id, key1, key2, "R");
                    }
                    var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowResR(key1,key2);
                        $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    } else {
        checkResource(key1,"");
        var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanal_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayres,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanal_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id,key1, key2,"");
                    } else if (suggestion.data.category == "IOW") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanal_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id,key1, key2,"");
                    }
                    var $rateanal =  $('#rateanal_'+key1+'_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowRes(key1,key2);
                        $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    }
}
function bindTRDeleteFn(reset) {
    var $trDelete = $('a[class*=mainTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className,
            key =  name.split('_')[1];
        if (name.indexOf('__') != -1) return;
        if ($('#spec_' + key).val().length ==0) return;
        if ($('#serialno_' + key).val().length ==0) return;
        var header = parseInt(isNullCheck($('#headerrow_' + key).val(),'number'));
        $this.on('click', function(e) {
            e.preventDefault();
            if (confirm('Do you want to Delete')) {
//                var tr_length = $('#sample12 > tbody tr[id*=IOWiRowId_]').length;
//                //alert(tr_length);
//                if(tr_length == 1) {
//                    $('#rowid').val(0);
//                    AddNewRowA(name);
//                }
                if (header==0) $this.closest('tr').nextAll('.subTr_' + key)[0].remove();
                $this.closest('tr').remove();
            }
            return false;
        });
    });
}
function bindMixSortablefn(reset) {
    // ReadyMix sortable function
    var $rBody = $('table[id*=rateanalR_] tbody.sorting'),
        $sBody = $('table[id*=rateanal_] tbody.sorting');
    $.each($rBody, function(i, obj){
        if ($(this).parent('table')[0].id.indexOf('__') != -1) {
            $rBody.splice(i, 1);
            $sBody.splice(i, 1);
        }
    });
    var $sRTable = $rBody.find('tr'),
        $sTable = $sBody.find('tr');
    if (typeof reset !== 'undefined' && reset === true) {
        $sRTable.unbind('click', 'dblclick', 'select', 'sortable');
        $sTable.unbind('click', 'dblclick', 'select', 'sortable');
        $rBody.unbind('sortable');
        $sBody.unbind('sortable');
    }
    $sRTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sRTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();

    });
    $sRTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $rBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrderR(ifrow);
        }
    });
    // SiteMix sortable function
    $sTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrder(ifrow);
        }
    });
}
$(function () {

//    if ($('#rfcmode').val().trim() == "edit") {
//        var url1 = getBaseURL() + "project/rfc/getrfciowpicklist";
//        var rfcsource =
//        {
//            async: false,
//            dataType: "json",
//            dataFields: [
//                {name: 'IOWId', type: 'number'},
//                {name: 'SerialNo', type: 'string'},
//                {name: 'WorkGroupName', type: 'date'},
//                {name: 'Specification', type: 'string'},
//                {name: 'available', type: 'boolean'}
//            ],
//            id: 'ResourceId',
//            url: url1
//        };
//        var rfcdata = new $.jqx.dataAdapter(rfcsource);
//        $("#grid").jqxGrid({
//            width: "100%",
//            height: 436,
//            rowsheight: 35,
//            pagerButtonsCount: 6,
//            pagesize: 10,
//            source: rfcdata,
//            pageable: true,
//            sortable: true,
//            altrows: true,
//            enabletooltips: true,
//            editable: true,
//            selectionmode: 'singlerow',
//            columns: [
//                {text: 'IOWId', datafield: 'IOWId', hidden: true},
//                {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '10%'},
//                {text: 'WorkGroupName', datafield: 'WorkGroupName', 'editable': false, width: '20%'},
//                {text: 'Specification', datafield: 'Specification', 'editable': false, width: '60%'},
//                {text: '&nbsp;', align:'center', datafield: 'available', columntype: 'checkbox', width: '10%'},
//            ]
//        });
//        $("#grid").bind('cellendedit', function (event) {
//            if (event.args.value) $("#grid").jqxGrid('selectrow', event.args.rowindex);
//            else $("#grid").jqxGrid('unselectrow', event.args.rowindex);
//        });
//    }

    var $formulaExp = $("#formulaexp");
    $('#formula').on('shown.bs.modal', function () {
        $formulaExp.focus();
        $formulaExp.select();
    });
    $('#worktype').autocomplete({
        lookup: arrayworktype,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#worktype_id").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#worktype_id").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#worktype_id").val(0);
            } else $(this).removeClass('error');
        }
    });
    $('#resgroup').autocomplete({
        lookup: arrayresgroup,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resgroupid").val(suggestion.data);
                $('#restype').val(suggestion.TypeName);
                $('#restypeid').val(suggestion.TypeId);
                $('#divworkunit').hide();
                $('#divworkrate').hide();
                $('#divmattype').hide();
                if (suggestion.TypeId== 2) $('#divmattype').show();
                if (suggestion.TypeId== 3) { $('#divworkunit').show();$('#divworkrate').show();}
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resgroupid").val(0);
            $('#divworkunit').hide();
            $('#divworkrate').hide();
            $('#divmattype').hide();

        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#resgroupid").val(0);
            } else $(this).removeClass('error');
        }
    });
    $('#resunit').autocomplete({
        lookup: arrayunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#resunitid").val(0);
            } else $(this).removeClass('error');
        }
    });
    $('#wresunit').autocomplete({
        lookup: arraywunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#wresunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#wresunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#wresunitid").val(0);
            } else $(this).removeClass('error');
        }
    });
    // modal forms on close
    $('#resourcemodal').on('hidden.bs.modal', function () {
        $(this).find('input').val('');
    });
    $('#workgroupmodal').on('hidden.bs.modal', function () {
        $(this).find('input[type=text]').val('');
        $(this).find('input[type=checkbox]').removeAttr('checked');
        $(this).find('input[type=radio]').removeAttr('checked');
    });
    bindMixSortablefn();
    expandTrFn();
    expandQualTrFn();
    expandwasteTrFn();
    expandwasteRTrFn();
    bindTRDeleteFn();
    bindQualExpandTr();
    bindAutoComplete();
    bindTaxCalculation();
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    CheckHeaderRows();

    // on edit from rfc bind subrow rateanalysis
    if($('#rfcUId').val() != 0 || $('#editid').val() != 0 ) {

//        var rowId = $('#rowid').val();
//        for(var i=1; i <= rowId; i++) {
        var $resrate = $('input[id*=_resrate_]');
//            var $resids = $('input[id*=resid_]');
        $.each($resrate, function() {
            var x = $(this)[0].id,
                arrname = x.split('_');
            if (x.indexOf('__') != -1) return;
            var key1 = arrname[1],
                key2 = arrname[3],
                name = arrname[0] + '_' + key1,
                id = 0;
            if($("#" + name + "_type_" + key2).val() != 'I') {
                if (parseInt(isNullCheck($("#" + name + "_restypeid_" + key2).val(),'number')) ==4) {
                    id = $('#' + name + '_reskeyid_' + key2).val();
                    bLoad = true;
                    if (arrname[0].charAt(arrname[0].length - 1) == 'R') cboResChanged(id, key1, key2, "R");
                    else cboResChanged(id, key1, key2, "");
                    bLoad = false;
                } else {
                    if (isNullCheck($("#" + name + "_resid_" + key2).val(),'string') != "") {
                        var ssname = name + '_resunit_' + key2;
                        RateResourceUpdate($("#" + name + "_resid_" + key2).val(), $("label[for=" + ssname + "]").html().trim(), $("#" + name + "_resrate_" + key2).val(), $("#" + name + "_reskeyid_" + key2).val());
                    }
                }
            }
            else {
                id = $('#'  + name + '_iowkeyid_' + key2).val();
                if (arrname[0].charAt(arrname[0].length - 1) == 'R') cboIOWChanged(id, key1, key2, "R");
                else cboIOWChanged(id, key1, key2, "");
            }
        });
//            $resrate.triggerHandler( "focus" );
//        }
    }
});
function submitForm() {
    $('form').submit();
}

function DeleteResource(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId = sStr[1];
    var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanal_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoid_' + iFocusRowId).val(),
            $resname =  $('#rateanal_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrder(iFocusRowId);
        checkRAUsed();
//        var $row = $('#rateanal_' + iFocusRowId + '_RowId_' + iARowid),
//            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid),
//            tr_length = $('tr[id*=rateanal_' + iFocusRowId + '_RowId_]').length,
//            irid =   $('#rowinfoid_' + iFocusRowId).val(),
//            $lrow = $('#rateanal_' + iFocusRowId + '_RowId_' + irid),
//            $tr_resqty = $('input[id*=rateanal_' + iFocusRowId + '_resqty_]');
//        if (tr_length > 2) {
//            $lrow.remove();
//            $row.remove();
//            $tr_resactivity.remove();
//            $('#rowinfoid_' + iFocusRowId).val(irid-1);
//            AddNewRowRes(iFocusRowId);
//            $tr_resqty.trigger('change');
//        } else {
//            $('#rowinfoid_' + iFocusRowId).val(0);
//            if (tr_length != 2) { AddNewRowRes(iFocusRowId);}
//            $row.remove();
//            $tr_resactivity.remove();
//            $tr_resqty.trigger('change');
//        }
//        SortOrder(iFocusRowId);
    }
    return false;
}
function SortOrder(iRowid) {
    var rows = $('tr[id*=rateanal_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanal_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function SortOrderR(iRowid) {
    var rows = $('tr[id*=rateanalR_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanalR_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function IOWRateUpdate(x) {
    var sStr = x.split("_");
    var iARowid = sStr[1];
    var sVal = $('#ratetype_' + iARowid).val();
    var dRate=0;
    if (sVal=='R') dRate = parseFloat(isNullCheck($('#rateanalR_' + iARowid + '_totnetrate').val(),'number'));
    else dRate = parseFloat(isNullCheck($('#rateanal_' + iARowid + '_totnetrate').val(),'number'));
    $('#rate_' + iARowid).val(sanitizeNumber(dRate,2,true));
}
function CheckParentValid(x) {
    var sStr = x.split("_");
    var iARowid = sStr[1];
    if ($('#parentkeyid_' + iARowid).val() == '0' || $('#parentkeyid_' + iARowid).val().length==0) {
        if ($('#parentid_' + iARowid).val().length >0){$('#parentid_' + iARowid).addClass('error');}
        else {$('#unitid_' + iARowid).removeClass('error');}
    } else {
        var sId = $('#parentkeyid_' + iARowid).val();

        var sVal = sId.split('.');
        var iWGId= 0,iIOWId=0;
        if (sVal.length >0)  iWGId = sVal[0];
        if (sVal.length >1)  iIOWId = sVal[1];
        if (iWGId ==0) {
            var sSlNo = sId.substring(2,sId.length);
            setNewSerialNo(sSlNo,iARowid);
        }  else {
            setSerialNo(iWGId,iIOWId,iARowid);
        }
        $('#parentid_' + iARowid).removeClass('error');
    }
}
function setNewSerialNo(newSlNo,key) {
    var bFound=false;
    for(var i=0;i<arrnewSlNo.length;i++){
        if (arrnewSlNo[i]['slNo'] == newSlNo) {

            var sslno = arrnewSlNo[i]['slNo'];
            var islno = parseInt(isNullCheck(arrnewSlNo[i]['pSlNo'],'number'));
            islno = +islno+1;
            var iWidth=5;
            var iLen = iWidth - islno.toString().length;
            var sPre = "";
            for (var k = 1; k < iLen; k++) {
                sPre = sPre + "0";
            }
            var sSerialNo = sslno +'.'+sPre+islno;
            $('#serialno_' + key).val(sSerialNo);
            arrnewSlNo[i]['pSlNo'] = islno;
            bFound=true;
            return;
        }
    }
    if (bFound==false) {

        islno = 1;
        var iWidth=5;
        var iLen = iWidth - islno.toString().length;
        var sPre = "";
        for (var k = 1; k < iLen; k++) {
            sPre = sPre + "0";
        }
        var sSerialNo = newSlNo +'.'+sPre+islno;
        $('#serialno_' + key).val(sSerialNo);

        arrnewSlNo.push({
            pSlNo: 1,
            slNo: newSlNo
        });
    }

    var $codes = $('textarea[id^=spec_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var ikey = name.split('_')[1];
        var ssSlNo = $('#serialno_'+ ikey).val();
        if (ssSlNo == newSlNo) {
            $('#raheader_' + ikey).prop('disabled', true);
            $('#refserialno_' + ikey).prop('readonly', true);
            $('#parentid_' + ikey).prop('readonly', true);
            $('#spec_' + ikey).prop('readonly', true);
            $('.mainTrDelete_' + ikey).hide();
            return;
        }
    });
}

function setSerialNo(wgId,iowId,key) {
    var bFound=false;
    if (isNullCheck($('#serialno_' + key).val(),'string') !="")return;
    for(var i=0;i<arrSlNo.length;i++){
        if (arrSlNo[i]['parentId'] == iowId && arrSlNo[i]['WorkGroupId'] == wgId) {
            var islno = arrSlNo[i]['pSlNo'];
            var sslno = arrSlNo[i]['slNo'];
            islno = +islno+1;
            var iWidth=5;
            var iLen = iWidth - islno.toString().length;
            var sPre = "";
            for (var k = 1; k < iLen; k++) {
                sPre = sPre + "0";
            }
            var sSerialNo = sslno +'.'+sPre+islno;
            $('#serialno_' + key).val(sSerialNo);
            arrSlNo[i]['pSlNo'] = islno;
            bFound=true;
            return;
        }
    }

    if (bFound==false) {
        $.ajax({
            url: getBaseURL() + "project/rfc/getiowslno",
            async: false,
            type: 'post',
            data: {'wgId': wgId, 'iowId': iowId},
            success: function (data, status) {
                data = JSON.parse(data);
                $('#serialno_' + key).val(data[0]);
                arrSlNo.push({
                    parentId: iowId,
                    WorkGroupId: wgId,
                    pSlNo: data[1],
                    slNo: data[2]
                });

            }
        });
    }
}

function weigtageCheck(x) {
    var ikey1 = x.split("_")[1],
        ikey2 = x.split("_")[2],
        name = '#rateanal_' + ikey1,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }

    var dweightage=0;
    for (var i = 1; i <= iRows; i++) {
        var dWQty = parseFloat(isNullCheck($(name + "_Weightage_" + i).val(),'number'))
        dweightage = dweightage + dWQty;
    }
    if (dweightage >100) {
        alert("Total Weightage% should not greater than 100%");
        var dWeight = dweightage - 100;
        var dval =  parseFloatVal(isNullCheck($('#'+x).val(),'number'));
        var dvalF = dval -dWeight;
        if (dvalF<0) dvalF=0;
        $('#'+x).val(sanitizeNumber(dvalF,2));
        dweightage=100;
    }
    $(name + "_totweightage").val(sanitizeNumber(dweightage,2));
}

function CheckUnitValid(x) {
    unitChange(x);
    var sStr = x.split("_");
    var iARowid = sStr[1];
    if (parseFloatVal(isNullCheck($('#unitkeyid_' + iARowid).val(),'number')) == 0 || $('#unitkeyid_' + iARowid).val().length==0) {
        if ($('#unitid_' + iARowid).val().length >0){$('#unitid_' + iARowid).addClass('error');}
        else {$('#unitid_' + iARowid).removeClass('error');}
        if (parseFloatVal(isNullCheck($('#rate_' + iARowid).val(),'number')) !=0) {$('#unitid_' + iARowid).addClass('error');}
    } else {
        $('#unitid_' + iARowid).removeClass('error');
//        $('#rate_' + iARowid).val(sanitizeNumber(0,2,true));
        $('#raheader_' + iARowid).prop('disabled', true);
        AddNewRowA(x);
    }
}
function CheckResValid(x) {
    var iARowid = x.split("_")[3],
        name = '';
    iFocusRowId = x.split("_")[1];
    var sname = x.split('_')[0];
    if (sname.substr(sname.length-1) == "R") name = '#rateanalR_' + iFocusRowId;
    else name = '#rateanal_' + iFocusRowId;
    var sType = $(name + '_type_' + iARowid).val();
    if (sType == "I" || sType=="R") {
        if (sType == "I") {
            if ($(name + '_iowkeyid_' + iARowid).val() == '0' || $(name + '_iowkeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resqty_' + iARowid).prop('readonly', true);
                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
                $(name + '_resqty_' + iARowid).prop('readonly', false);
                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        } else {
            if ($(name + '_reskeyid_' + iARowid).val() == '0' || $(name + '_reskeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resqty_' + iARowid).prop('readonly', true);
                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
                $(name + '_resqty_' + iARowid).prop('readonly', false);
                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        }
    }
}
function ShowNewWorkGroup(e) {
    e.preventDefault();
    var $newwg = $('#newwg');
    if ($newwg.is(":hidden")) $newwg.show();
    else $newwg.hide();
    return false;
}
function ShowRateResource(e) {
    e.preventDefault();
    $("#rateResource").modal('show');
    return false;
}
//ResourceRateUpdate
function ResourceRateUpdate() {
    closedetails('');
    var irows = $('#resourcerate tbody tr').length;
    var bFound=false;
    var dRate=0;
    var dOldRate=0;
    var iResid = 0;
    for (var i = 1; i <= irows; i++) {
        iResid= $('#rateresid_' + i).val();
        dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
        dOldRate = parseFloat(isNullCheck($('#rateresoldrate_' + i).val(),'number'));
        if (dRate != dOldRate) {
            UpdateResourceRate(iResid,dRate);
            $('#rateresoldrate_' + i).val(dRate);
            UpdateActivityResourceRate(iResid,dRate);
            UpdateSubIOWResourceRate(iResid,dRate);
        }
    }
    closeAllActivity();
}
function UpdateActivityResourceRate(resid,rate) {
    for(var i=0;i<arrActivityAnal.length;i++) {
        if (arrActivityAnal[i].resourceid == resid) {
            arrActivityAnal[i].rate = rate;
            arrActivityAnal[i].amount = parseFloat(arrActivityAnal[i].qty) * rate;
            UpdateActivityRate(arrActivityAnal[i].activityid);
        }
    }
}
function UpdateActivityRate(iAResid) {
    var dmAmt = 0, daAmt = 0,dmQty= 0, daQty= 0;
    var objR = $.grep(arrActivityAnal, function (element, index) {
        return element.activityid == iAResid;});
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].activitytype =="A") daAmt = daAmt + parseFloat(objR[i].amount);
        else dmAmt = dmAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrActivityRes.length;i++) {
        if (arrActivityRes[i].activityid == iAResid) {
            dmQty = parseFloat(arrActivityRes[i].analysisMQty);
            daQty = parseFloat(arrActivityRes[i].analysisAQty);
            if (dmQty==0) { dmQty=1; arrActivityRes[i].AnalysisMQty = dmQty; }
            if (daQty==0) { daQty=1; arrActivityRes[i].AnalysisAQty = dmQty; }
            arrActivityRes[i].mRate = dmAmt/dmQty;
            arrActivityRes[i].aRate = daAmt/daQty;
            UpdateActivityMainRate(iAResid,arrActivityRes[i].lRate,arrActivityRes[i].mRate,arrActivityRes[i].aRate)
            break;
        }
    }
}
function UpdateResourceRate(iResid,dRate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateActivityMainRate(iResid,dLRate,dMRate,dARate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "M") { dRate =  dMRate; }
        else if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "A") { dRate =  dARate; }
        else { dRate =  dLRate; }
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateSubIOWResourceRate(resid,rate) {
    for(var i=0;i<arrSubIOWAnal.length;i++) {
        if (arrSubIOWAnal[i].resourceid == resid) {
            arrSubIOWAnal[i].rate = rate;
            arrSubIOWAnal[i].amount = parseFloat(arrSubIOWAnal[i].qty) * rate;
            UpdateSubIOWRate(arrSubIOWAnal[i].subiowid);
        }
    }
}
function UpdateSubIOWRate(isubiowid) {
    var dsAmt = 0, drAmt = 0,dsQty= 0, drQty= 0;
    var objR = $.grep(arrSubIOWAnal, function (element, index) {
        return element.subiowid == isubiowid;
    });
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].mixtype =="R") drAmt = drAmt + parseFloat(objR[i].amount);
        else dsAmt = dsAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrSubIOW.length;i++) {
        if (arrSubIOW[i].subiowid == isubiowid) {
            dsQty = parseFloat(arrSubIOW[i].workingqty);
            drQty = parseFloat(arrSubIOW[i].rworkingQty);
            if (dsQty==0) { dsQty=1; arrSubIOW[i].workingqty = dsQty; }
            if (drQty==0) { drQty=1; arrSubIOW[i].rworkingQty = drQty; }
            arrSubIOW[i].srate = dsAmt/dsQty;
            arrSubIOW[i].rrate = drAmt/drQty;
            UpdateSubIOWMainRate(isubiowid,arrSubIOW[i].srate,arrSubIOW[i].rrate)
            break;
        }
    }
}
function UpdateSubIOWMainRate(isubiowid,dSRate,dRRate) {
    var $reskeyids = $('input[id*=_iowkeyid_][value="'+isubiowid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "R") dRate =  dRRate;
        else dRate =  dSRate;
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function ShowNewResource(e) {
    e.preventDefault();
    var $newr = $('#newres');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function DeleteResourceR(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanalR_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
            $resname =  $('#rateanalR_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvityR_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrderR(iFocusRowId);
        checkRAUsed();
//        var $row = $('#rateanalR_' + iFocusRowId + '_RowId_' + iARowid),
//            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid),
//            tr_length = $('tr[id*=rateanalR_' + iFocusRowId + '_RowId_]').length,
//            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
//            $lrow = $('#rateanalR_' + iFocusRowId + '_RowId_' + irid),
//            $tr_resqty = $('input[id*=rateanalR_' + iFocusRowId + '_resqty_]');
//        if (tr_length > 2) {
//            $lrow.remove();
//            $row.remove();
//            $tr_resactivity.remove();
//            $('#rowinfoidR_' + iFocusRowId).val(irid-1);
//            AddNewRowResR(iFocusRowId);
//            $tr_resqty.trigger('change');
//        } else {
//            $('#rowinfoidR_' + iFocusRowId).val(0);
//            if (tr_length != 2) { AddNewRowResR(iFocusRowId);}
//            $row.remove();
//            $tr_resactivity.remove();
//            $tr_resqty.trigger('change');
//        }
//        SortOrderR(iFocusRowId);
    }
    return false;
}
function closeIOWAnalysis(x) {
    var sStr = x.split("_"),
        key1 = sStr[1],
        activityName = 'resactvity_';
    if(sStr[0].substr(sStr[0].length - 1) == 'R') activityName = 'resactvityR_';
    $('tr[id*=resactvity_' + key1 +'_RowId_]').remove();
    $('tr[id*=resactvityR_' + key1 +'_RowId_]').remove();
    $('a[id*=resactvity_' + key1 +'_resTr_] i').removeClass('tform');
    $('a[id*=resactvityR_' + key1 +'_resTr_] i').removeClass('tform');
}
function showAnalysis(x,mtype) {

    if (bShowAnalysis== true) return;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    bShowAnalysis=true;
    var sName = "rateanal_",
        activityName = 'resactvity_';
    if (mtype != 'undefined' && mtype =="R")  { sName = "rateanalR_"; activityName = 'resactvityR_'; }
    var iARowid = sStr[3],
        sRateType = $('#' + sName + iFocusRowId + '_ratetype_' + iARowid).val(),
        trName = activityName + iFocusRowId + '_RowId_' + iARowid,
        aLink = activityName + iFocusRowId + '_resTr_' + iARowid,
        iResId= 0,
        expandLink = '<li><a id="'+aLink+'" href="javascript: expandResSubTr(\''+trName+'\', \''+aLink+'\')"><span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-up"></i></span></a></li>';
    if($('#' + trName).length != 0) { bShowAnalysis=false; return; }
//    closeIOWAnalysis(x);
    closeAllActivity();


    if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "R") {
        iResId = parseInt(isNullCheck($('#' + sName + iFocusRowId + '_reskeyid_' + iARowid).val(),'number'));
        if (iResId == 0 || parseInt(isNullCheck($('#' + sName + iFocusRowId + '_restypeid_' + iARowid).val(),'number')) != 4) { bShowAnalysis=false; return; }
        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv bs_bord" style="display: none;">').children().html($('#dummyactivity').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
        var objR = $.grep(arrActivityRes, function (element, index) {
            return element.activityid == iResId;
        });
        if (objR.length >0) {
            var dmQty = parseFloat(objR[0].analysisMQty),
                daQty = parseFloat(objR[0].analysisMQty);
            if (dmQty == 0) dmQty = 1;
            if (daQty == 0) daQty = 1;
            if (sRateType != "") {
                $('#analrate').val(sRateType);
            }
            else {
                $('#analrate').val(objR[0].ratetype);
            }
            $('#analrateL').val(objR[0].lRate);
            $('#analrateM').val(objR[0].mRate);
            $('#analrateA').val(objR[0].aRate);
        }
        $('#analrate').trigger('change');
        $('#activityAnalQty').val(dmQty);
        $('#activityRAnalQty').val(daQty);
        var objAS = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'M';
        });

        var k = 0;
        var sOldid = "_1";
        var dmAmt=0;
        for (var j = 0; j < objAS.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="activityRowId_1">' + $('#activityrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#activityRowId' + sOldid).after(sStr);


//                $('#activityrestable tbody tr:last').after(sStr);

//                $("#activityrestable tbody.sorting tr:last").after("<tr>" + $("#activityrestable tbody tr:first").html() + "</tr>");
//                $("#activityrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }
            $('#activityresid_' + k).val(objAS[j]['resourcename']);
            //$('#activityresunit_' + k).val(objAS[j]['unitname']);
            $("label[for='activityresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#activityresqty_' + k).val(sanitizeNumber(objAS[j]['qty'],3));
            $('#activityresrate_' + k).val(sanitizeNumber(objAS[j]['rate'],2,true));
            $('#activityresamt_' + k).val(sanitizeNumber(objAS[j]['amount'],2,true));
            dmAmt = dmAmt + parseFloat(objAS[j]['amount']);
            sOldid = '_' + k;
            $('#arowinfoid').val(k);

        }

        $('#activitytotrate').val(sanitizeNumber(dmAmt,2,true));
        var dmRate = dmAmt/dmQty;
        $('#activityperrate').val(sanitizeNumber(dmRate,2,true));
        $('#analrateM').val(sanitizeNumber(dmRate,2,true));
        var objAR = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'A';
        });
        var k = 0;
        var daAmt=0;
        sOldid = "_1";
        for (var j = 0; j < objAR.length; j++) {
            k = k + 1;
            if (k != 1) {
                var sStr = '<tr id="activityRRowId_1">' + $('#activityRrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#activityRRowId' + sOldid).after(sStr);

//                $("#activityRrestable tbody.sorting tr:last").after("<tr>" + $("#activityRrestable tbody tr:first").html() + "</tr>");
//                $("#activityRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityRrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }
            $('#activityRresid_' + k).val(objAR[j]['resourcename']);
            //$('#activityRresunit_' + k).val(objAR[j]['unitname']);
            $("label[for='activityRresunit_" + k + "']").html(objAR[j]['unitname']);
            $('#activityRresqty_' + k).val(sanitizeNumber(objAR[j]['qty'],3));
            $('#activityRresrate_' + k).val(sanitizeNumber(objAR[j]['rate'],2,true));
            $('#activityRresamt_' + k).val(sanitizeNumber(objAR[j]['amount'],2,true));
            daAmt = daAmt + parseFloat(objAR[j]['amount']);
            sOldid = '_' + k;
            $('#arowinfoidR').val(k);
        }
        $('#activityRtotrate').val(sanitizeNumber(daAmt,2,true));
        var daRate = daAmt/daQty;
        $('#activityRperrate').val(sanitizeNumber(daRate,2,true));
        $('#analrateA').val(sanitizeNumber(daRate,2,true));
        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();
    } else if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "I") {
        iResId = isNullCheck($('#' + sName + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number');
        if (iResId == 0 ) { bShowAnalysis=false; return; }
        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv" style="display: none;">').children().html($('#dummysubiow').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
        var objR = $.grep(arrSubIOW, function (element, index) {
            return element.subiowid == iResId;
        });
        if (objR.length >0) {
            var dsQty = parseFloat(isNullCheck(objR[0].workingqty, 'number'));
            var drQty = parseFloat(isNullCheck(objR[0].rworkingqty, 'number'));
            if (dsQty == 0) dsQty = 1;
            if (drQty == 0) drQty = 1;
            if (sRateType != "") {
                $('#analrate').val(sRateType);
            }
            else {
                $('#analrate').val(objR[0].mixtype);
            }
            $('#srateanalAQty').val(objR[0].cementratio);
            $('#srateanalBQty').val(objR[0].sandratio);
            $('#srateanalCQty').val(objR[0].metalratio);
            $('#srateanalthick').val(objR[0].thickqty);

            $('#subiowmixtype').show();
            $('#subiowcement').show();
            $('#subiowsand').show();
            $('#subiowmetal').show();
            $('#subiowthick').show();

            if (objR[0].ConcreteMix ==0) $('#subiowmixtype').hide();
            if (objR[0].Cement ==0) $('#subiowcement').hide();
            if (objR[0].Sand==0) $('#subiowsand').hide();
            if (objR[0].Metal==0) $('#subiowmetal').hide();
            if (objR[0].Thickness==0) $('#subiowthick').hide();
        }
        $('#srateanalAnalQty').val(dsQty);
        $('#srateanalRAnalQty').val(drQty);
        var objAS = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype != 'R';
        });
        var dsAmt=0;
        var k = 0;
        var sOldid = "_1";
        for (var j = 0; j < objAS.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {

                var sStr = '<tr id="srateanalRowId_1">' + $('#srateanalrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#srateanalRowId' + sOldid).after(sStr);

//                $("#srateanalrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalrestable tbody tr:first").html() + "</tr>");
//                $("#srateanalrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }
            $('#srateanalinc_' + k).val(objAS[j]['includeflag']);
//            $('#srateanalref_' + k).val(objAS[j]['referenceid']);
            $("label[for='srateanalref_" + k + "']").html('R'+objAS[j]['referenceid']);
            $('#srateanalresid_' + k).val(objAS[j]['resourcename']);
            $("label[for='srateanalresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#srateanalresqty_' + k).val(sanitizeNumber(objAS[j]['qty'],3));
            $('#srateanalresrate_' + k).val(sanitizeNumber(objAS[j]['rate'],2,true));
            $('#srateanalresamt_' + k).val(sanitizeNumber(objAS[j]['amount'],2,true));
            $('#srateanalformula_' + k).val(objAS[j]['formula']);
            dsAmt = dsAmt + parseFloat(objAS[j]['amount']);
            sOldid = '_' + k;
            $('#srowinfoid').val(k);
        }
        $('#srateanaltotrate').val(sanitizeNumber(dsAmt,2,true));
        var dsRate = dsAmt/dsQty;
        $('#srateanalperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalnetrate').val(sanitizeNumber(dsRate,2,true));
        var objAR = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype == 'R';
        });
        var drAmt =0;
        var k = 0;
        sOldid = "_1";
        for (var j = 0; j < objAR.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="srateanalRRowId_1">' + $('#srateanalRrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#srateanalRRowId' + sOldid).after(sStr);

//                $("#srateanalRrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalRrestable tbody tr:first").html() + "</tr>");
//                $("#srateanalRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalRrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }
            $('#srateanalRinc_' + k).val(objAR[j]['includeflag']);
            $('#srateanalRref_' + k).val(objAR[j]['referenceid']);
            $('#srateanalRresid_' + k).val(objAR[j]['resourcename']);
            $("label[for='srateanalRunit_" + k + "']").html(objAR[j]['unitname']);
            $('#srateanalRresqty_' + k).val(sanitizeNumber(objAR[j]['qty'],3));
            $('#srateanalRresrate_' + k).val(sanitizeNumber(objAR[j]['rate'],2,true));
            $('#srateanalRresamt_' + k).val(sanitizeNumber(objAR[j]['amount'],2,true));
            $('#srateanalRformula_' + k).val(objAR[j]['formula']);
            drAmt = drAmt + parseFloat(objAR[j]['amount']);
            sOldid = '_' + k;
            $('#srowinfoidR').val(k);
        }
        $('#srateanalRtotrate').val(sanitizeNumber(drAmt,2,true));
        var drRate = drAmt/drQty;
        $('#srateanalRperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalRnetrate').val(sanitizeNumber(dsRate,2,true));
        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();
        $('#sraworktable').show();
        $('#srateanalrestable').show();
    }
    expandResSubTr(trName, aLink);
    bShowAnalysis=false;
}
function printtable() {
    var pageTitle = 'Page Title',
        stylesheet = '//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css',
        win = window.open('', 'Print', 'width=500,height=300');
    win.document.write('<html><head><title>' + pageTitle + '</title>' +
    '<link rel="stylesheet" href="' + stylesheet + '">' +
    '</head><body>' + $('#sample12')[0].innerHTML + '</body></html>');
    win.document.close();
    win.print();
    win.close();
}
function nextiow() {
    var rows = $("#grid").jqxGrid('getrows');
    var id = "";
    for (var m = 0; m < rows.length; m++) {
        var row = $("#grid").jqxGrid('getrowdata', m);
        if (row.available==true) {
            id=id + row.IOWId + ',';
        }
    }
    if (id.length ==0)
        return;

    id = id.slice(0,-1);
    $.post(getBaseURL() + 'project/rfc/getiowedit', {ids: id}, function (data) {
        var obj = jQuery.parseJSON(data);
        var objT =obj['trans'];
        var sOldid = "_1";
        var iRowId=0;
        for (var i = 0; i < objT.length; i++) {
            var ioRowId =  iRowId;
            iRowId = +iRowId + 1;
            if (iRowId !=1) {
                var snid = 'IOWiRowId_' + iRowId;
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId != 1) {
                    ioRowId = (ioRowId * 2) - 1;
                }
                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
            }

            $('#rowid').val(iRowId);
            $('#groupid_'+iRowId).val(objT[i].WorkGroupId);
            $('#parentid_'+iRowId).val(objT[i].ParentId);
            $('#refserialno_'+iRowId).val(objT[i].RefSerialNo);
            $('#serialno_'+iRowId).val(objT[i].SerialNo);
            $('#spec_'+iRowId).val(objT[i].Specification);
            $('#unitid_'+iRowId).val(objT[i].UnitId);
        }
    });

    $('#next-btn').hide();
    $('#submit-btn').show();
    $('#back-btn').show();

//    $('#edit-list').hide();
    $('#edit-content').show();
}
function AddNewRowA(id) {

    var iEditId = parseInt(isNullCheck($('#editid').val(),'number'));
    if (iEditId ==0) {
        var iRowId = $('#rowid').val(),
            key = id.split('_')[1];

        if ($('#parentid_' + key).length != 0) {
            if ($('#parentid_' + key).val().length == 0) return;
            if ($('#serialno_' + key).val().length == 0) return;
            if ($('#spec_' + key).val().length == 0) return;
            if ($('#spec_' + key).hasClass('error')) return;

            // if ($('#unitkeyid_' + iRowId).val().length == 0 || $('#unitkeyid_' + iRowId).val() == 0) return;
        }
        if (parseFloatVal(isNullCheck($('#unitkeyid_' + key).val(),'number')) !=0) $('#raheader_' + key).prop('disabled', true);
        getAnalysisDetails(key);

        if ($('#parentid_' + iRowId).length != 0) {
            if ($('#parentid_' + iRowId).val().length == 0) return;
            if ($('#serialno_' + iRowId).val().length == 0) return;
            if ($('#spec_' + iRowId).val().length == 0) return;
            if ($('#spec_' + iRowId).hasClass('error')) return;

            // if ($('#unitkeyid_' + iRowId).val().length == 0 || $('#unitkeyid_' + iRowId).val() == 0) return;
        }

        if ($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;

        var ioRowId = iRowId;
        iRowId = +iRowId + 1;
        var snid = 'IOWiRowId_' + iRowId,
            sStr = $('#dummytable tbody').html();
        sStr = sStr.replace(/__1/g, '_' + iRowId);
        sStr = sStr.replace(/__9/g, '_1');
        //if (ioRowId != 1) {ioRowId = (ioRowId*2)-1 ;}
        $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
        $('#rowrefid_' + iRowId).val(iRowId);
        $('#rowid').val(iRowId);
        checkResource(iRowId, "");
        checkResource(iRowId, "R");
        closedetails('');
        bindAutoComplete();
        bindResourceAutoComplete();
        bindResourceChange();
        bindPopOver();
        expandTrFn(true);
        expandQualTrFn(true);
        expandwasteTrFn(true);
        expandwasteRTrFn(true);
        bindTRDeleteFn(true);
        bindQualExpandTr();
        bindTaxCalculation();
        bindMixSortablefn(true);
        $('.mainTrDelete_' + key).show(); // show delete icon
        var aSNo = $('#parentkeyid_' + key).val().split('.');
//        if (parseInt(isNullCheck($('#unitkeyid_' + key).val(),'number')) !=0) {
//            if (aSNo.length > 0) GetWorkGroupDetails(isNullCheck(aSNo[0], 'number'), id, false);
//        }
        SortOrderBOQ();
        checkRAUsed();
    }
}
function getAnalysisDetails(key) {
    var iRow = parseInt(isNullCheck($('#rowinfoid_'+ key).val(),'number'));
    if (iRow > 1) return;
    if (parseInt(isNullCheck($('#unitkeyid_' + key).val(),'number')) ==0) return;
    if ($('#parentid_' + key).val().length == 0) return;
    if ($('#serialno_' + key).val().length == 0) return;
    if ($('#spec_' + key).val().length == 0) return;
    GetWorkGroupDetails(key,false);
}


var fixHelperModified = function(e, tr) {
        var $originals = tr.children();
        var $helper = tr.clone();
        $helper.children().each(function(index) {
            $(this).width($originals.eq(index).width())
        });
        return $helper;
    },
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };

function refreshFromWorkGroup(id) {
    var key = id.split('_')[1];
    var aSNo = $('#parentkeyid_' + key).val().split('.');
    if (aSNo.length > 0) GetWorkGroupDetails(key,true);
    SortOrderBOQ();
    checkRAUsed();
}
function getRefNo(key,type) {
    if (type=="R") {
        $reskeyid = $('input[id*=rateanalR_' + key + '_refid_]');
    } else {
        $reskeyid = $('input[id*=rateanal_' + key + '_refid_]');
    }
    var iRefId=1;
    $.each($reskeyid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var sRefId = isNullCheck($('#'+name).val(),'string')
        var ioRefId = sRefId.replace(/[^0-9]/g, '');
        if (parseInt(ioRefId) >= iRefId) iRefId = +ioRefId+1;
    });
    return iRefId;
}

function checkRAUsed() {
    var $reskeyid = $('input[id*=rowinfoid_]');
    $.each($reskeyid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var iRow = parseInt(isNullCheck($('#'+name).val(),'number'));
        var key = name.split('_')[1];
        $('#copyformat_' + key).show();
        if (iRow > 1) {
            $('#copyformat_' + key).hide();
        } else {
            var sType = isNullCheck($('#rateanal_' + key + '_type_1').val(),'string');
            if (sType =='H') $('#copyformat_' + key).hide();
            else {
                var sResName = isNullCheck($('#rateanal_' + key + '__resid__1').val(),'string');
                if (sResName.length > 0) $('#copyformat_' + key).hide();
            }
        }
    });
}

function AddNewRowRes(key1,key2) {
    var sRow = '#rowinfoid_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanal_'+key1+'_resdel_' + key2).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var iRefId = getRefNo(key1,"");
    var stabelrow = '#rateanal_'+key1 + '_restable';
    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
    $('#rateanal_' + key1 + '_refid_' + irowinfoId).val(iRefId);
    checkResource(key1,"S");
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrder(key1);
    checkRAUsed();
    return true;
}


function AddNewRowIOW() {
    var sRow = '#rowinfoid_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrder(iFocusRowId);
    checkRAUsed();
    $(sRow).val(irowinfoId);
}
function AddNewRowIOWR() {
    var sRow = '#rowinfoidR_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanalR_'+iFocusRowId + 'restable';
    var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrderR(iFocusRowId);
    checkRAUsed();
    $(sRow).val(irowinfoId);
}
function AddNewRowResHeader(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId = parseInt(isNullCheck($('#rowinfoid_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];
    var sValue = $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanal_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    //$(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
//    $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
    $('.autocomplete-suggestions').hide();
    $('#rateanal_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanal_' + iFocusRowId + '_type_' + irowinfoId).val("H");
    $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val("");
    $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).removeClass('error');
    var sRow = '#rowinfoid_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
    checkRAUsed();
}
function AddNewRowResHeaderR(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId =  parseInt(isNullCheck($('#rowinfoidR_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];
    var sValue = $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanalR_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
//    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#rateanalR_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanalR_' + iFocusRowId + '_type_' + irowinfoId).val("H");
    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val("");
    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).removeClass('error');
    var sRow = '#rowinfoidR_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
    checkRAUsed();
}
function closeactivity() {
    $('#resactvity').remove();
}
function AddNewRowResR(key1,key2) {
    var sRow = '#rowinfoidR_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanalR_'+key1+'_resdel_' + key2).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var iRefId = getRefNo(iFocusRowId,"R");
    var stabelrow = '#rateanalR_'+key1 + '_restable';
    var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
    $('#rateanalR_' + key1 + '_refid_' + irowinfoId).val(iRefId);
    checkResource(key1,"R");
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrder(key1);
    checkRAUsed();
    return true;
}
function wastageCheck(name,iARowid) {
    var dWastePer  =  parseFloat(isNullCheck($(name + "_Wastage_" + iARowid).val(),'number'));
    if (dWastePer >100) {
        alert("Wastage% should not greater than 100%");
        $(name + "_Wastage_" + iARowid).val(sanitizeNumber(100,2));
    }
}
function ValueChange(x) {
    var iARowid = x.split("_")[3],
        iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }
    wastageCheck(name,iARowid);

    var dQty =  parseFloat(isNullCheck($(name + "_resqty_" + iARowid).val(),'number')),
        dRate = parseFloat(isNullCheck($(name + "_resrate_" + iARowid).val(),'number')),
        dAmt = dQty*dRate;

    var dWastePer  =  parseFloat(isNullCheck($(name + "_Wastage_" + iARowid).val(),'number')),
        dWasteQty  =  dQty*(dWastePer/100),
        dWasteAmt  = dWasteQty*dRate;

    $(name + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
    $(name + "_WastageQty_" + iARowid).val(sanitizeNumber(dWasteQty,2,true));
    $(name + "_WastageAmount_" + iARowid).val(sanitizeNumber(dWasteAmt,2,true));

    showWastage(name);
    CalculateRate(name);
}

function unitChange(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');
    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }
    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));

    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);
}

function CalculateRate(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sQualName = "Qual";
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }

    var dTAmt = 0;
    var dTWasteAmt =0;
    for (var i = 1; i <= iRows; i++) {
        if ($(name + '_inc_' + i).is(':checked') == true) {
            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
            dTAmt = dTAmt + val;
            dTWasteAmt = dTWasteAmt + wasteval;
        }
    }

    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
    dTAmt =  dTAmt + dTWasteAmt;
    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));

    var dQAmt =  CalculateQualifier(dTAmt,iFocusRowId,sQualName);
    $(name + '_totqualrate').val(sanitizeNumber(dQAmt,2,true));


    var dQualAmt =  parseFloatVal(isNullCheck($(name + '_totqualrate').val(),'number'));
    var dTotRate = dTAmt+ dQualAmt;
    $(name + '_totrate').val(sanitizeNumber(dTotRate,2,true));

    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
    var dNetRate = dTotRate/dAnalQty;

    $(name + '_totnetrate').val(sanitizeNumber(dNetRate,2,true));

    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);

    var dFRate=0;
    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
    else {
        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_totnetrate').val(),'number'));
        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
    }
    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
}


//function CalculateFull() {
//    //SiteMix
//    var iRows = $('#rowinfoid_' + iFocusRowId).val();
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        var dAmt = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat( isNullCheck( $("#rateanal_" + iFocusRowId + "_resrate_" + i).val(),'number'));
//        $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
//        if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//    }
//    $('#rateanal_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0)  { dAnalQty = 1; $('#rateanal_' + iFocusRowId + '_AnalQty').val(dAnalQty); }
//
//    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//    $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
//    $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//    var dNetRate = dTAmt/dAnalQty;
//    $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    //Readymix
//    var iRows = $('#rowinfoidR_' + iFocusRowId).val();
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        var dAmt = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resrate_" + i).val(),'number'));
//        $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
//        if ($('#rateanalR_' + iFocusRowId + 'inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat( isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//    }
//    $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0) { dAnalQty = 1; $('#rateanalR_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
//    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//    $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
//    $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//    var dNetRate = dTAmt/dAnalQty;
//    $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val()));
//    else  {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_netrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    }
//    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
//}



function ChangeIOWs(x) {
    closedetails('');
    var iARowid = x.split("_")[1];
    if ($('#unitid_'+iARowid).val().length >0) {
        $('#but_'+iARowid).prop('disabled', false);
        $('#rate_'+iARowid).prop('readonly', false);
    } else {
        $('#unitid_'+iARowid).val(0);
        $('#but_'+iARowid).prop('disabled', true);
        $('#rate_'+iARowid).prop('readonly', true);
    }
}

function CheckSerialNo(x) {
    var iARowid = x.split("_")[1],
        iParentkeyId = $('#parentkeyid_' + iARowid).val(),
        sRefSlNo =  $('#refserialno_' + iARowid).val().trim(),
        sSlNo =  $('#serialno_' + iARowid).val().trim(),
        iproject_id = 0,
        iiowid= parseInt(isNullCheck($('#iowid_' + iARowid).val(), 'number'));

    $.post( getBaseURL() + 'project/rfc/checkserialfound', {serialno:sSlNo,projectid:iproject_id,iowid:iiowid}, function( data ) {
        if (data == "Y") {
            var $refserialno = $('#refserialno_' + iARowid);
            $refserialno.addClass('error').attr('data-original-title', 'Serial no. Already Available').attr('data-toggle', 'tooltip');
            $refserialno.tooltip();
            $('#serialno_' + iARowid).val("");
            return;
        }
    });
    var irows = $('#sample12 tr').length-1;
    for (var i = 1; i <= irows; i++) {
        $('#refserialno_' + iARowid).removeClass('error');
        if (i != iARowid) {
            if (iParentkeyId ==  $('#parentkeyid_' + i).val()) {
                if (sRefSlNo == $('#refserialno_' + i).val().trim()) {
                    var $refserialno = $('#refserialno_' + iARowid);
                    $refserialno.addClass('error').attr('data-original-title', 'Serial no. Already Available').attr('data-toggle', 'tooltip');
                    $refserialno.tooltip();
                    $('#serialno_' + iARowid).val("");
                    break;
                }
            }
        }
    }
}

function CheckSpecification(x) {
    var iARowid = x.split("_")[1],
        $spec =$('#spec_' + iARowid),
        sspec =  $('#spec_' + iARowid).val().trim(),
        iiowid= parseInt(isNullCheck($('#iowid_' + iARowid).val(), 'number')),
        rfcId = isNullCheck($('#rfcUId').val(), 'number');
    removeError($spec);
    $.ajax({
        url: getBaseURL() + "project/rfc/checkiowspecfound",
        async: false,
        type: 'post',
        data: {'iowid': iiowid, 'spec':sspec,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($spec, 'Already Available');
                return;
            }
        }
    });

    if ($spec.hasClass('error')) return;
    removeError($spec);
    var $codes = $('textarea[id^=spec_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (sspec.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($spec, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckRefNo(x) {
    var iARowid = x.split("_")[1],
        $refserialno =$('#refserialno_' + iARowid),
        sRefSlNo =  isNullCheck($('#refserialno_' + iARowid).val(),'string').trim(),
        iiowid= parseInt(isNullCheck($('#iowid_' + iARowid).val(), 'number')),
        rfcId = isNullCheck($('#rfcUId').val(), 'number');

    removeError($refserialno);
    if (sRefSlNo =="") return;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkiowrefnofound",
        async: false,
        type: 'post',
        data: {'iowid': iiowid, 'refno':sRefSlNo,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($refserialno, 'Already Available');
                return;
            }
        }
    });

    if ($refserialno.hasClass('error')) return;
    removeError($refserialno);
    var $codes = $('input[id^=refserialno_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (sRefSlNo.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($refserialno, 'Already Available');
                    return;
                }
            }
        }
    });
}


//function SerialUpdate(x) {
//    var sStr = x.split("_"),
//        iARowid = sStr[1],
//        sParent = 'parentid_'+iARowid,
//        sParentText =  $('#' + sParent).val(),
//        aSerialNo = sParentText.split(" "),
//        sSerialNo = aSerialNo[0],
//        aSNo = sSerialNo.split('.');
//    if (aSNo[1] == "0") sSerialNo = aSNo[0];
//    if ($('#refserialno_' + iARowid).val() != ""  && $('#parentid_'+ iARowid).val().length>0) {
//        var sSerialNo = sSerialNo + '.' + $('#refserialno_' + iARowid).val();
//        $('#serialno_' + iARowid).val(sSerialNo);
//    } else $('#serialno_' + iARowid).val("");
//    var sField = sStr[0];
//
//    if (sField == "parentid") {
//        if (aSNo[0] != 'Add') {GetWorkGroupDetails(iWGId,x)}
//    }
//    CheckSerialNo(x);
//}
function cboIOWChanged(ival,ifRowid, iARowid,itype) {
    iFocusRowId = ifRowid;
    var name = "rateanal_";
    if (itype == "R") name = "rateanalR_";
    $.ajax({
        url: getBaseURL() + "project/rfc/getiowunit/"+ival,
        async: false,
        type: 'post',
        success: function(data,status) {
            var obj = jQuery.parseJSON(data);
            var objD = obj['details'];
            var objT = obj['trans'];
            var objA = obj['activity'];
            $("label[for='" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
            var dIRate=0;
            if (objT['MixType'] == "R")  dIRate= parseFloat(objT['RRate']);
            else dIRate= parseFloat(objT['SRate']);
            $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dIRate,2,true));
            var objF = $.grep(arrSubIOW, function (element, index) {
                return element.subiowid == ival;
            });
            if  (objF.length ==0) {
                arrSubIOW.push({
                    subiowid: ival,
                    mixtype: objT['MixType'],
                    srate: objT['SRate'],
                    rrate: objT['RRate'],
                    workingqty: objT['WorkingQty'],
                    cementratio: objT['CementRatio'],
                    metailratio: objT['MetalRatio'],
                    sandratio: objT['SandRatio'],
                    thickqty: objT['ThickQty'],
                    rworkingQty: objT['RWorkingQty'],
                    ConcreteMix:objT['ConcreteMix'],
                    Cement:objT['Cement'],
                    Sand:objT['Sand'],
                    Metal:objT['Metal'],
                    Thickness:objT['Thickness']
                });
                for (var j = 0; j < objA.length; j++) {
                    var irows = $('#resourcerate tr').length;
                    var bFound=false;
                    var iResid = objA[j]['ResourceId'];
                    var dRate=parseFloat(objA[j]['Rate']);
                    for (var i = 1; i <= irows; i++) {
                        if ($('#rateresid_' + i).val == iResid) {
                            bFound = true;
                            dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
                            break;
                        }
                    }
                    if (bFound==false) { RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid); }
                    arrSubIOWAnal.push({
                        subiowid: ival,
                        mixtype: objA[j]['MixType'],
                        includeflag: objA[j]['IncludeFlag'],
                        referenceid: objA[j]['ReferenceId'],
                        code: objA[j]['Code'],
                        resourcename: objA[j]['ResourceName'],
                        unitname: objA[j]['UnitName'],
                        resourceid: objA[j]['ResourceId'],
                        qty: objA[j]['Qty'],
                        rate: objA[j]['Rate'],
                        amount: parseFloat(objA[j]['Qty'])*dRate,
                        formula: objA[j]['Formula']
                    });
                }
            }
        }
    });
}

function newResourceDetailsUpdate(id,key1,key2,rtype) {
    var iresrow = isNullCheck(id.split('.')[1],'number');
    var $sresid = $('input[id^=newrowrefid_]');
    var name = "rateanal_";
    if (rtype == "R") name = "rateanalR_";

    $.each($sresid, function (i, obj) {
        var $this = $(this);
        var ikey = isNullCheck($this[0].id.split('_')[1],'number');
        var irow = isNullCheck($('#newrowrefid_' + ikey).val(),'number');
        if (irow == iresrow) {
            $("label[for= '" + name + key1 + "_resunit_" + key2 + "']").html($('#newresunit_'+ irow).val());
            var iTypeId = parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number')),
                dRate= parseFloat(isNullCheck($('#newresrate_'+ irow).val(),'number'));

            $("#" + name + key1 + "_restypeid_" + key2).val(iTypeId);
            $("#" + name + key1 + "_resrate_" + key2).val(sanitizeNumber(dRate,2,true));
            $("#" + name + key1 + '_newresname_' + key2).val($('#newresname_'+ irow).val());
            if (iTypeId !=2) {
                $("#" + name + key1 + "_Wastage_" + key2).prop('readonly', true);
                $("#" + name + key1 + "_Wastage_" + key2).hide();
                $("#" + name + key1 + "_lblWastage_" + key2).hide();
            } else {
                $("#" + name + key1 + "_Wastage_" + key2).prop('readonly', false);
                $("#" + name + key1 + "_Wastage_" + key2).show();
                $("#" + name + key1 + "_lblWastage_" + key2).show();
            }
            if (iTypeId !=4) {
                $("#" + name + key1 + "_Weightage_" + key2).prop('readonly', true);
                $("#" + name + key1 + "_Weightage_" + key2).hide();
                $("#" + name + key1 + "_lblWeightage_" + key2).hide();
            } else {
                $("#" + name + key1 + "_Weightage_" + key2).prop('readonly', false);
                $("#" + name + key1 + "_Weightage_" + key2).show();
                $("#" + name + key1 + "_lblWeightage_" + key2).show();
            }
            return;
        }
    });
}

function cboResChanged(ival,ifRowid, iARowid,rtype) {
    if (ival.length >2) {
        if (ival.substring(0, 2) == "0.") {
            newResourceDetailsUpdate(ival,ifRowid, iARowid);
            return;
        }
    }

    iFocusRowId=ifRowid;
    var dRate=0;
    if (ival.trim() !='') {
//        var irows = $('#resourcerate tr').length;
        var bFound=false;
        var $resid = $('input[id^=rateresid_]');
        var key=0;
        $.each($resid, function (i, obj) {
            key = +i+1;
            var $this = $(this),
                name = $this[0].id;
            var ickey = isNullCheck(name.split('_')[1],'number');
            if (ickey !=0) {
                if ($('#rateresid_' + key).val() == ival) {
                    bFound = true;
                    dRate = parseFloat(isNullCheck($('#rateresrate_' + key).val(), 'number'));
                    return;
                }
            }
        });
        var name = "rateanal_";
        if (rtype == "R") name = "rateanalR_";
        $.ajax({
            url: getBaseURL() + "project/rfc/getresourceunit/"+ival,
            async: false,
            type: 'post',
            success: function(data,status) {
                var obj = jQuery.parseJSON(data);
                var objD = obj['details'];
                var objT = obj['trans'];
                var objA = obj['activity'];
                $("label[for= '" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
                $("#" + name + iFocusRowId + "_restypeid_" + iARowid).val(objD[0].TypeId);
//                $("#" + name + iFocusRowId + "_ratetype_" + iARowid).val(objT['RateType']);

                if (objD[0].TypeId !=2) {
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).prop('readonly', true);
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).hide();
                    $("#" + name + iFocusRowId + "_lblWastage_" + iARowid).hide();
                } else {
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).prop('readonly', false);
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).show();
                    $("#" + name + iFocusRowId + "_lblWastage_" + iARowid).show();
                }

                if (objD[0].TypeId !=4) {
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).prop('readonly', true);
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).hide();
                    $("#" + name + iFocusRowId + "_lblWeightage_" + iARowid).hide();
                } else {
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).prop('readonly', false);
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).show();
                    $("#" + name + iFocusRowId + "_lblWeightage_" + iARowid).show();
                }

                if (bFound == true) $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dRate,2,true));
                else {
                    if (bLoad == false) $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(objD[0].Rate,2,true));
                    var resName = $("#" + name + iFocusRowId + "_resid_" + iARowid).val();
                    RateResourceUpdate(resName, objD[0].UnitName, parseFloat(objD[0].Rate), ival)
                }
                var objF = $.grep(arrActivityRes, function (element, index) {
                    return element.activityid == ival;
                });
                if  (objF.length ==0 && objD[0].TypeId==4) {
                    arrActivityRes.push({
                        activityid: ival,
                        ratetype: objT['RateType'],
                        lRate: objT['LRate'],
                        mRate: objT['MRate'],
                        aRate: objT['ARate'],
                        analysisMQty: objT['AnalysisMQty'],
                        analysisAQty: objT['AnalysisAQty']
                    });
                    for (var j = 0; j < objA.length; j++) {
                        var iResid = objA[j]['ResourceId'];
                        bFound=false;
                        dRate=objA[j]['Rate'];
                        $.each($resid, function (i, obj) {
                            var $this = $(this),
                                name = $this[0].id;
                            var ickey = isNullCheck(name.split('_')[1],'number');
                            if (ickey !=0) {
                                if ($('#rateresid_' + i).val() == iResid) {
                                    bFound = true;
                                    dRate = isNullCheck($('#rateresrate_' + i).val(), 'number');
                                    return;
                                }
                            }
                        });
                        if (bFound==false)  RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid);
                        arrActivityAnal.push({
                            activityid: ival,
                            activitytype: objA[j]['ActivityType'],
                            resourceid: objA[j]['ResourceId'],
                            resourcename: objA[j]['ResourceName'],
                            unitname: objA[j]['UnitName'],
                            qty: objA[j]['Qty'],
                            rate: dRate,
                            amount: parseFloat(objA[j]['Qty'])*dRate
                        });
                    }
                }
            }
        });
    }
}
function clickbut(x) {
    iARowId = x.split("_")[1];
    if ($('.subTr_' + iARowId).is(':visible')) return;
    $('.mainTr_' + iARowId).trigger('click');
}
function validateRow(x) {
    iARowId = x.split("_")[1];
    var scurId = "_" + iARowId,
        sparentId = $('#parentkeyid' + scurId).val(),
        $sparentId = $('#parentid' + scurId),
        $sserialno = $('#serialno' + scurId),
        $srefserialno = $('#refserialno' + scurId),
        $sspec = $('#spec' + scurId),
        sUnit = $('#unitkeyid' + scurId).val(),
        iHeader = $('#headerrow' + scurId).val();
    if (sparentId.length==0) {
        //alert("Parent Not Selected");
        $sparentId.focus();
        return false;
    } else if($sserialno.val().length==0) {
        alert("Serial No is Empty");
        $sserialno.focus();
        return false;
    } else if($srefserialno.val().length==0) {
        alert("Ref Serial No is Empty");
        $srefserialno.focus();
        return false;
    } else if($sspec.val().length==0) {
        alert("Specification is Empty");
        $sspec.focus();
        return false;
    } else if (sUnit.length==0 || sUnit==0) {
        alert("Unit Not Selected");
        $('#unitid' + scurId).focus();
        return false;
    } else if ($sspec.hasClass('error')) {return false;}
    $sparentId.prop('readonly', true);
    bSiteMix = true;
    CheckShowDetails();
    //CalculateFull();
    return true;
}
function CheckShowDetails() {
    if ($('#concrete_' + iFocusRowId).is(':checked') == false) $('#ramixtable'+'_'+iFocusRowId).hide();
    else $('#ramixtable_'+'_'+iFocusRowId).show();
}
function closedetails(name) {
    var $mainTRs = $("a[class*=mainTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this);
        if (name != $this[0].className) {
            key = $this[0].className.split('_')[1];
            var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
                $i = $(this).find("i");
            if ($subTr.is(":visible")) {
                $subTr.find(".subDiv").slideUp("slow");
                $subTr.slideUp("slow");
                $i.removeClass("fa-chevron-circle-up");
                $i.addClass("fa-chevron-circle-down");
            }
        }
    });
}
function GetWorkTypeDetails(ival,x) {
    $.ajax({
        url: getBaseURL() + "project/rfc/getworktypedetails",
        async: false,
        type: 'post',
        data:{resId:ival},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];
            var objA = obj['anal'];
            var sStr = x.split("_");
            var iARowid = sStr[1];
            if (objT['ConcreteMix'] == 1) {
                $('#mixtab_' + iARowid).show();
                $('#lisitemix_' + iARowid).show();
                $('#lireadymix_' + iARowid).show();
            }
            else {
                $('#mixtab_' + iARowid).hide();
                $('#rateanalR_' + iARowid + '_AnalQty').hide();
                $('#lisitemix_' + iARowid).hide();
                $('#lireadymix_' + iARowid).hide();
            }

            if (objT['Cement'] == 1) {
                $('#rateanal_' + iARowid + 'AQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'AQty_li').hide();
            }

            if (objT['Sand'] == 1) {
                $('#rateanal_' + iARowid + 'BQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'BQty_li').hide();
            }

            if (objT['Metal'] == 1) {
                $('#rateanal_' + iARowid + 'CQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'CQty_li').hide();
            }

            if (objT['Thickness'] == 1) {
                $('#rateanal_' + iARowid + 'thick_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'thick_li').hide();
            }
        }
    });
//    }
}
function IOWUpdate() {
    $('.loading_area').show();
//    if (excelSheetValid()==false) {
//        $('.loading_area').hide();
//        alert("Invalid Sheet");
//        return;
//    }
    var iMRowId = $('#rowid').val();
    var ioRowId = iMRowId;
    var iRowTransId=1;
    //var irows = $('#excelTable tr').length-1;
    var $excelpids = $('input[id^=excelparentid_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        //for (i = 1; i <= irows; i++) {
        var sRowType = isNullCheck($('#excelrowtype_'+key1).val(),'string');
        if (sRowType == "I" || sRowType == "H") {
            if (iRowTransId >1) AddNewRowRes(iMRowId,iRowTransId);
            ioRowId = iMRowId;
            if ($('#spec_' + iMRowId).val() != "")  iMRowId = + iMRowId+1;
            if (iMRowId !=1) {
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId !=1) {ioRowId = (ioRowId*2)-1 ;}
                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
            }
            var pId =$("#excelwgid_"+key1).val();
            if ($("#excelparentid_"+key1).val() !=0) pId = pId + "." + $("#excelparentid_"+key1).val();
            $('#parentkeyid_' + iMRowId).val(pId);
            $('#refserialno_' + iMRowId).val($('#excelserialno_'+key1).val());
//            $('#serialno_' + iMRowId).val($('#excelserialno_'+ key1).val());
            $('#spec_' + iMRowId).val($('#excelspec_'+ key1).val());

            $('#newworkgroupname_' + iMRowId).val($('#excelnewworkgroupname_'+ key1).val());
            $('#worktypeid_' + iMRowId).val($('#excelwgtypeid_'+ key1).val());
            $('#workgroupid_' + iMRowId).val($('#excelwgid_'+ key1).val());
            $('#newparentname_' + iMRowId).val($('#excelparentspec_'+ key1).val());

            if ($('#excelrowtype_'+key1).val() == "I") {
                $('#unitid_' + iMRowId).val($('#excelunit_' + key1).val());
                $('#unitkeyid_' + iMRowId).val($('#excelunitid_' + key1).val());
                $('#headerrow_' + iMRowId).val(0);
                $('.mainTrDelete_'+iMRowId).show();
            } else {
                $('#raheader_'+iMRowId).prop("checked", true);
                checkHeader('raheader_' + iMRowId);
                $('#headerrow_' + iMRowId).val(1);
            }
            $('#parentid_' + iMRowId).val($('#excelparent_'+ key1).val());
            CheckParentValid('parentid_' +iMRowId);
            GetWorkTypeDetails($('#excelwgtypeid_'+ key1).val(),"parentid_"+ iMRowId);

            $('#rowid').val(iMRowId);
            iRowTransId=1;
        } else if (sRowType=="R") {
            if (iRowTransId!=1) {
                var stabelrow = '#rateanal_' + iMRowId + '_restable';
                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_' + iRowTransId);
                sStr = sStr.replace(/R1/g, 'R' + iRowTransId);
                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                //$(stabelrow+" tbody tr:nth-child(" + (iRowTransId - 1) + ")").after(sStr);
                $('#rateanal_' + iMRowId + '_refid_' + iRowTransId).val(iRowTransId);
            }
            $('#rateanal_' + iMRowId + '_code_' + iRowTransId).val($('#excelserialno_' + key1).val());
            $('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId).val($('#excelresid_' + key1).val());
            $('#rateanal_' + iMRowId + '_newresname_' + iRowTransId).val($('#excelnewresspec_' + key1).val());

            var dQty = parseFloatVal(isNullCheck($('#excelqty_' + key1).val(),'number')),
                dRate= parseFloatVal(isNullCheck($('#excelrate_' + key1).val(),'number')),
                iTypeid = $('#excelrestypeid_' + key1).val();


            dRate = getExcelResourceRate($('#excelnewresspec_'+ key1).val(),$('#excelunit_' + key1).val(),dRate,$('#excelresid_' + key1).val());
            var dAmt = dQty*dRate;

            $('#rateanal_' + iMRowId + '_resqty_' + iRowTransId).val(sanitizeNumber(dQty,3));
            $('#rateanal_' + iMRowId + '_resunit_' + iRowTransId).val($('#excelunit_' + key1).val());

            $('#rateanal_' + iMRowId + '_resrate_' + iRowTransId).val(sanitizeNumber(dRate,2,true));
            $('#rateanal_' + iMRowId + '_resamt_' + iRowTransId).val(sanitizeNumber(dAmt,2,true));
            $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).val($('#excelnewresspec_'+ key1).val());
            if (isNullCheck($('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId),'number') !=0) $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).prop('readonly', true);

            $("label[for= '" + name + iMRowId + "_resunit_" + iRowTransId + "']").html($('#excelunit_' + key1).val());
            $("#" + name + iMRowId + "_restypeid_" + iRowTransId).val(iTypeid);

            if (iTypeid !=2) {
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).prop('readonly', true);
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).hide();
                $("#" + name + iMRowId + "_lblWastage_" + iRowTransId).hide();
            } else {
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).prop('readonly', false);
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).show();
                $("#" + name + iMRowId + "_lblWastage_" + iRowTransId).show();
            }

            if (iTypeid !=4) {
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).prop('readonly', true);
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).hide();
                $("#" + name + iMRowId + "_lblWeightage_" + iRowTransId).hide();
            } else {
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).prop('readonly', false);
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).show();
                $("#" + name + iMRowId + "_lblWeightage_" + iRowTransId).show();
            }
            $('#rowinfoid_' + iMRowId).val(iRowTransId);
            ValueChange('rateanal_' + iMRowId + '_resqty_' + iRowTransId);
            $('#rateanal_'+iMRowId+'_resdel_' + iRowTransId).show();
            SortOrder(iMRowId);
            iRowTransId = +iRowTransId+1;
        }
    });
    if (iMRowId >1) { $('#divExcelImport').hide(); AddNewRowA('spec_' +iMRowId); }
    if (iRowTransId >1 && iMRowId >1) AddNewRowRes(iMRowId,iRowTransId);
    bindAutoComplete();
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    expandTrFn(true);
    expandQualTrFn(true);
    expandwasteTrFn(true);
    expandwasteRTrFn(true);
    bindTRDeleteFn(true);
    bindQualExpandTr();
    bindTaxCalculation();
    bindMixSortablefn(true);
    checkRAUsed();
    $('#excelmodal').modal('toggle');
    $('.loading_area').hide();
}
function getExcelResourceRate(resName,unit,rate,resId) {
    var bFound=false;
    var $resid = $('input[id^=rateresid_]');
    var key=0;
    var dRate =rate;
    $.each($resid, function (i, obj) {
        key = +i+1;
        var $this = $(this),
            name = $this[0].id;
        var ickey = isNullCheck(name.split('_')[1],'number');
        if (ickey !=0) {
            if ($('#rateresid_' + key).val() == resId) {
                bFound = true;
                dRate = parseFloat(isNullCheck($('#rateresrate_' + key).val(), 'number'));
                return;
            }
        }
    });
    if (bFound==false) RateResourceUpdate(resName,unit,rate,resId);
    return dRate;
}


function fileupload(x) {
    var isValid=true;
    var $excelpids = $('input[id^=field_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#field_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    if (isValid==false) {alert ("Please Assign Fields Correctly"); return isValid;}

//    $("#excelmodal").modal('hide');
    var bValid=true;
    var arrHeader =[];
    for (var i = 0; i < $("#excelfieldTable").find("th").length; i++) {
        arrHeader.push({efield: $('#efield_'+i).val(), field: $('#field_'+i).val()});
    }
    arrHeader =  JSON.stringify(arrHeader);
    formData.append('arrHeader', arrHeader);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() + "project/rfc/uploadLiow",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);
            var key1=1;
            if (obj[0].Valid==true) {
                $('#excelTable tr:gt(1)').remove();
                var $excelpids = $('input[id^=excelserialno_]');
                $.each($excelpids, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    key1 = name.split('_')[1];
                });
                var irow = key1;

                $("#excelserialno_" + irow).val('');
//                $("#excelcode_" + irow).val('');
                $("#excelspec_" + irow).val('');
                $("#excelunit_" + irow).val('');
                $("#excelqty_" + irow).val('');
                $("#excelrate_" + irow).val('');
                $("#excelamount_" + irow).val('');
//                $("#excelrefslno_" + irow).val('');
                $("#excelrowtype_" + irow).val('');
                $("#exceliowid_" + irow).val('');
                $("#excelparentid_" + irow).val('');
                $("#excelwgid_" + irow).val('');
                $("#excelwgtypeid_" + irow).val('');
                $("#excelresid_" + irow).val('');
                $("#excelrestypeid_" + irow).val('');
                $("#excelunitid_" + irow).val('');
                $("#excelparentspec_" + irow).val('');
                var sOldid = "_" + key1;
                for (var i = 0; i < obj.length; i++) {
                    if (irow != key1)  {
                        $("#excelTable tbody tr:last").after('<tr id ="excelrowid_' + irow +'">' + $("#excelTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("textarea").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                    }
                    bindExcelDeleteFn(true);
                    $("#excelserialno_" + irow).val(obj[i].SerialNo);
//                    $("#excelcode_" + irow).val(obj[i].Code);
                    $("#excelspec_" + irow).val(obj[i].Specification);
                    $("#excelunit_" + irow).val(obj[i].UnitName);
                    $("#excelqty_" + irow).val(obj[i].Qty);
                    $("#excelrate_" + irow).val(obj[i].Rate);
                    $("#excelamount_" + irow).val(obj[i].Qty * obj[i].Rate);
                    $("#excelrowtype_" + irow).val(obj[i].RowType);
                    $("#exceliowid_" + irow).val(obj[i].IOWId);
                    $("#excelparentid_" + irow).val(obj[i].ParentId);
                    $("#excelwgid_" + irow).val(obj[i].WGId);
                    $("#excelwgtypeid_" + irow).val(obj[i].WorkTypeId);
                    $("#excelresid_" + irow).val(obj[i].ResourceId);
                    $("#excelunitid_" + irow).val(obj[i].UnitId);
                    $("#excelparent_" + irow).val(obj[i].ParentSpec);
                    $("#excelparentspec_" + irow).val(obj[i].ParentSpec);
                    $("#excelnewresspec_" + irow).val(obj[i].Specification);
                    $("#excelrestypeid_" + irow).val(obj[i].ResTypeId);
                    validRowType("excelrowtype_" + irow);
                    if ($("#excelrowtype_" + irow).hasClass('error')) bexcelRowTypeFound=true;

                    if (obj[i].RowType == "WG") {
                        $('#excelrowid_' + irow).addClass('excel1');
                    } else if (obj[i].RowType == "H") {
                        $('#excelrowid_' + irow).addClass('excel2');
                    } else if (obj[i].RowType == "I") {
                        $('#excelrowid_' + irow).addClass('excel3');
                    }  else if (obj[i].RowType == "R") {
                        $('#excelrowid_' + irow).addClass('excel4');
                    }

                    irow = +irow + 1;
                }
            } else bValid=false;

            isValid =bValid;

            if (bValid==false) alert("Invalid File Format");
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400) alert(xhr.responseText);
            else alert(errorThrown);
        }
    });

    clearInputFile($('#myfile'));
//    excelvalid();
    return isValid;
}

//function fileupload(x) {
//    var bValid=true;
//    var formData = new FormData();
//    formData.append('file', $('#myfile').prop("files")[0]);
//    $.ajax({
//        url: getBaseURL() + "project/rfc/UploadIOWData",
//        async: false,
//        dataType: 'script',
//        cache: false,
//        contentType: false,
//        processData: false,
//        data: formData,
//        type: 'post',
//        success: function(data,status, xhr) {
//            var obj = jQuery.parseJSON(data);
//            var key1=1;
//            if (obj[0].Valid==true) {
//                $('#excelTable tr:gt(1)').remove();
//                var $excelpids = $('input[id^=excelserialno_]');
//                $.each($excelpids, function (i, obj) {
//                    var $this = $(this),
//                        name = $this[0].id;
//                    key1 = name.split('_')[1];
//                });
//                var irow = key1;
//
//                $("#excelserialno_" + irow).val('');
//                $("#excelcode_" + irow).val('');
//                $("#excelspec_" + irow).val('');
//                $("#excelunit_" + irow).val('');
//                $("#excelqty_" + irow).val('');
//                $("#excelrate_" + irow).val('');
//                $("#excelamount_" + irow).val('');
//                $("#excelrefslno_" + irow).val('');
//                $("#excelrowtype_" + irow).val('');
//                $("#exceliowid_" + irow).val('');
//                $("#excelparentid_" + irow).val('');
//                $("#excelwgid_" + irow).val('');
//                $("#excelresid_" + irow).val('');
//                $("#excelunitid_" + irow).val('');
//                $("#excelparentspec_" + irow).val('');
//                var sOldid = "_" + key1;
//                for (i = 0; i < obj.length; i++) {
//                    if (irow != key1)  {
//                        var sNewid = "_" + irow;
//                        $("#excelTable tbody tr:last").after("<tr>" + $("#excelTable tbody tr:first").html() + "</tr>");
//                        $("#excelTable tbody tr:last").find("input:text").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                        $("#excelTable tbody tr:last").find("input:hidden").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                        $("#excelTable tbody tr:last").find("a[class*=excelTrDelete_]").each(function () {
//                            $(this).attr("class", $(this).attr("class").replace("__1", sNewid));
//                        });
//                    }
//                    bindExcelDeleteFn(true);
//                    $("#excelserialno_" + irow).val(obj[i].SerialNo);
//                    $("#excelcode_" + irow).val(obj[i].Code);
//                    $("#excelspec_" + irow).val(obj[i].Specification);
//                    $("#excelunit_" + irow).val(obj[i].UnitName);
//                    $("#excelqty_" + irow).val(obj[i].Qty);
//                    $("#excelrate_" + irow).val(obj[i].Rate);
//                    $("#excelamount_" + irow).val(obj[i].Qty * obj[i].Rate);
//                    $("#excelrefslno_" + irow).val(obj[i].RefSerialNo);
//                    $("#excelrowtype_" + irow).val(obj[i].RowType);
//                    $("#exceliowid_" + irow).val(obj[i].IOWId);
//                    $("#excelparentid_" + irow).val(obj[i].ParentId);
//                    $("#excelwgid_" + irow).val(obj[i].WGId);
//                    $("#excelresid_" + irow).val(obj[i].ResourceId);
//                    $("#excelunitid_" + irow).val(obj[i].UnitId);
//                    $("#excelparentspec_" + irow).val(obj[i].ParentSpec);
//
//                    irow = +irow + 1;
//                }
//            } else bValid=false;
//            if (bValid==true) $("#excelmodal").modal('show');
//            else  alert("Invalid File Format");
//        },
//        error: function(xhr, status, errorThrown) {
//            if (xhr.status == 400) alert(xhr.responseText);
//            else alert(errorThrown);
//        }
//    });
//    clearInputFile($('#myfile'));
//    excelvalid();
//}


function bindExcelDeleteFn(reset) {
    var $trDelete = $('a[class*=excelTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className;
        $this.on('click', function(e) {
            e.preventDefault();
            var ikey1=0;
            if (name.indexOf('__')  != -1) ikey1=1;
            else ikey1 = name.split('_')[1];
            if (isNullCheck($("#excelserialno_" + ikey1).val(),'string') != "") {
                var ikey2 = + ikey1+1;
//                if ($("#excelcode_" + ikey2).length !=0) {
//                    if (isNullCheck($("#excelcode_" + ikey2).val(),'string') != "") return;
//                }
            }
            if (confirm('Do you want to Delete')) {
                var tr_length = $('#excelTable tr').length;
                if (tr_length ==2) {
                    var $excelpids = $('input[id*=excelserialno_]');
                    $.each($excelpids, function (i, obj) {
                        var $this = $(this),
                            name = $this[0].id;
                        var key1 = name.split('_')[1];
                        $("#excelserialno_" + key1).val('');
//                        $("#excelcode_" + key1).val('');
                        $("#excelspec_" + key1).val('');
                        $("#excelunit_" + key1).val('');
                        $("#excelqty_" + key1).val('');
                        $("#excelrate_" + key1).val('');
                        $("#excelamount_" + key1).val('');
//                        $("#excelrefslno_" + key1).val('');
                        $("#excelrowtype_" + key1).val('');
                        $("#exceliowid_" + key1).val('');
                        $("#excelparentid_" + key1).val('');
                        $("#excelwgid_" + key1).val('');
                        $("#excelresid_" + key1).val('');
                        $("#excelunitid_" + key1).val('');
                        $("#excelparentspec_" + key1).val('');
                    });
                } else {
                    $this.closest('tr').remove();
                }
            }
            return false;
        });
    });
}


function changeRatio(x,type) {
    var sStr = x.split("_"),
        key1 = sStr[1];
    var $formula = $('input[id*=_' + key1 + '_formula]');
    $.each($formula, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            arr_names = name.split('_');
        if (name.indexOf('__') != -1) return;
        if ($('#' + name).val().indexOf(type) >= 0) {
            var sitemix = true,
                key2 = arr_names[3];
            if (name.indexOf('rateanalR') >= 0) sitemix=false;
            formularecalculation($('#' + name).val(),key1,key2,sitemix);
        }
    });
}

function formularecalculation(sformula,key1,key2,sitemix) {
    var fvaule=0;

    if (sformula.length >0) {
        try {
            if  (sitemix==true) {
                var sCement = '#rateanal_' + key1 + '_AQty';
                var sSand = '#rateanal_' + key1 + '_BQty';
                var sMetal = '#rateanal_' + key1 + '_CQty';
                var sThick = '#rateanal_' + key1 + '_thick';
            } else {
                var sCement = '#rateanalR_' + key1 + '_AQty';
                var sSand = '#rateanalR_' + key1 + '_BQty';
                var sMetal = '#rateanalR_' + key1 + '_CQty';
                var sThick = '#rateanalR_' + key1 + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());

            if  (sitemix==true) {
                var rows = $('#rowinfoid_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != key2) {
                        var sRef = $('label[for=rateanal_' + key1 + '_ref_' + key2+ ']').html().trim();
                        var dAmt= $('#rateanal_' + key1 + '_resamt_' + key2).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            } else {
                var rows = $('#rowinfoidR_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != key2) {
                        var sRef = $('label[for=rateanalR_' + key1 + '_ref_' + key2+ ']').html().trim();
                        var dAmt= $('#rateanalR_' + key1 + '_resamt_' + key2).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            }
            fvaule = computeEval(sformula);
        } catch (e) {
            res = 'Expression in invalid.';
            alert(res);
        }
    }
    if  (sitemix==true) {
        $("#rateanal_" + key1 + "_resqty_" + key2).val(sanitizeNumber(fvaule,3));
    } else {
        $("#rateanalR_" + key1 + "_resqty_" + key2).val(sanitizeNumber(fvaule,3));
    }
}

function formulacalculation() {
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            if  (bSiteMix==true) {
                var sCement = '#rateanal_' + iFocusRowId + '_AQty';
                var sSand = '#rateanal_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
                var sThick = '#rateanal_' + iFocusRowId + '_thick';
            } else {
                var sCement = '#rateanalR_' + iFocusRowId + '_AQty';
                var sSand = '#rateanalR_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanalR_' + iFocusRowId + '_CQty';
                var sThick = '#rateanalR_' + iFocusRowId + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());
            if  (bSiteMix==true) {
                var rows = $('#rowinfoid_' + iFocusRowId).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            } else {
                var rows = $('#rowinfoidR_' + iFocusRowId).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            //alert('Expression Invalid.');
        }
    }
    $("#formulavalue").val(sanitizeNumber(fvaule,3));
}
function showformulaR(x,bshow) {
    bSiteMix=false;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = isNullCheck($(sExp).val(),'string');
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }

    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var rows = $('#rowinfoidR_' + iFocusRowId).val();
            for (var i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            alert('Expression in invalid.');
        }
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else {
        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
        else if (stype=="I") {
            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
    }
}
function showF(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }  else if (stype=="I"){
            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }
        event.preventDefault();
    }
}
function showFR(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        } else if (stype=="I"){
            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        }
        event.preventDefault();
    }
}
function showformula(x,bshow) {
    bSiteMix=true;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = isNullCheck($(sExp).val(),'string');
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }
    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var sCement = '#rateanal_' + iFocusRowId + '_AQty';
            var sSand = '#rateanal_' + iFocusRowId + '_BQty';
            var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
            var sThick = '#rateanal_' + iFocusRowId + '_thick';
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());
            alert(sformula);
            var rows = $('#rowinfoid_' + iFocusRowId).val();
            for (var i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            //fvaule = eval(sformula);
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            res = 'Expression Invalid.';
            $('#btnformula').prop('disabled', true);
//            alert(res);
        }
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else {
        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
        else if (stype=="I") {
            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
    }
}
function formulaok() {
    if (bSiteMix == true) {
        var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanal_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanal_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));

        var name = '#rateanal_' + iFocusRowId;
        CalculateRate(name);


//        var iRows = $('#rowinfoid_' + iFocusRowId).val();
//        var dTAmt = 0;
//        for (i = 1; i <= iRows; i++) {
//            if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//        }
//        $('#rateanal_' + iFocusRowId + 'totrate').val(sanitizeNumber(dTAmt,2,true));
//        var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
//        if (dAnalQty.length == 0 || dAnalQty == 0 || dAnalQty == "Working Qty") {
//            dAnalQty = 1;
//            $('#rateanal_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
//        }
//        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//        $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
//        $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//        var dNetRate = dTAmt / dAnalQty;
//        $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//        $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));


    } else {
        var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanalR_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanalR_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));

        var name = '#rateanalR_' + iFocusRowId;
        CalculateRate(name);

//        var iRows = parseInt(isNullCheck($('#rowinfoidR_' + iFocusRowId).val(),'number'));
//        var dTAmt = 0;
//        for (i = 1; i <= iRows; i++) {
//            if ($('#rateanalR_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//        }
//        $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//        var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
//        if (dAnalQty.length == 0 || dAnalQty == 0) {
//            dAnalQty = 1;
//            $('#rateanalR_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
//        }
//        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//        $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + sanitizeNumber(dAnalQty,3) + ' ' + sUnit);
//        $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//        var dNetRate = dTAmt / dAnalQty;
//        $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//        $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    }
    $('#formula').hide();
}
function showAnalmix(sVal,y,e) {
    e.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="manual") {
        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();
    } else {
        $('#activitymanual').hide()
        $('#activityrestable').hide();
        $('#activitymachinery').show();
        $('#activityRrestable').show();
    }
    return false;
}
function showSubIOWMix(sVal,y,event) {
    event.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="sitemix") {
        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();
        $('#sraworktable').show();
        $('#srateanalrestable').show();
    } else {
        $('#sraworktable').hide();
        $('#srateanalrestable').hide();
        $('#sraworkRtable').show();
        $('#srateanalRrestable').show();
    }
    return false;
}
function showmix(x,y,event) {
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    iFocusRowId = y.split('_')[1];
    event.preventDefault();
    if (x=="readymix") {
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).hide();
        $('#rabuttable_'+iFocusRowId).hide();
        $('#rateanal_'+ iFocusRowId + '_restable').hide();
        $('#raworkRtable_'+iFocusRowId).show();
        $('#rabutRtable_'+iFocusRowId).show();
        $('#rateanalR_'+ iFocusRowId + '_restable').show();
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRR_'+iFocusRowId).prop("checked", true);
        bSiteMix=false;
    } else {
        $('#raworkRtable_'+iFocusRowId).hide();
        $('#rabutRtable_'+iFocusRowId).hide();
        $('#rateanalR_'+ iFocusRowId + '_restable').hide();
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).show();
        $('#rabuttable_'+iFocusRowId).show();
        $('#rateanal_'+ iFocusRowId + '_restable').show();
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSS_'+iFocusRowId).prop("checked", true);
        bSiteMix=true;
    }
}
function AddNewWorkGroup(x) {
    sWGUpdateMode='Add';
    $('#wgrowid').val(0);
    $("#workgroupok").html('Create');
    $("#workgroupmodal").modal('show');
    $('#refNewWGRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#workgroup').val($(x).val());
}
function ShowWorkGroup(id) {
    var irow = id.split('_')[1];
    $("#workgroupok").html('Save');
    sWGUpdateMode='Edit';
    $('#wgrowid').val(irow);
    $('#workgroupslno').val($('#newwgnameslno_'+ irow).val());
    $('#workgroup').val($('#newwgname_'+ irow).val());
    $('#worktype').val($('#newwgtypename_'+ irow).val());
    $('#worktype_id').val($('#newwgid_'+ irow).val());
    $('#auto-generate-rate').prop('checked', ($('#newwgrateanal_'+ irow).val() == 1) ? true : false);
    $("#workgroupmodal").modal('show');
}
function ShowResource(id) {
    var irow = id.split('_')[1];
    $("#newresok").html('Save');
    sResUpdateMode='Edit';
    $('#resrowid').val(irow);
    $('#resname').val($('#newresname_'+ irow).val());
    $('#rescode').val($('#newrescode_'+ irow).val());
    $('#resgroup').val($('#newresgroup_'+ irow).val());
    $('#resgroupid').val($('#newresgroupid_'+ irow).val());
    $('#restype').val($('#newrestype_'+ irow).val());
    $('#restypeid').val($('#newrestypeid_'+ irow).val());
    $('#resunit').val($('#newresunit_'+ irow).val());
    $('#resunitid').val($('#newresunitid_'+ irow).val());
    $('#wresunit').val($('#newwresunit_'+ irow).val());
    $('#wresunitid').val($('#newwresunitid_'+ irow).val());
    $('#resrate').val($('#newresrate_'+ irow).val());
    $('#wresrate').val($('#newwresrate_'+ irow).val());
    $('#resmattype').val($('#newresmattype_'+ irow).val());
    $('#reslead').val($('#newreslead_'+ irow).val());

    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 2) $('#divmattype').show();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 3) { $('#divworkunit').show();$('divworkrate').show();}
    $("#resourcemodal").modal('show');
}
function AddNewResource(x) {
    sResUpdateMode='Add';
    $("#newresok").html('Create');

    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    $('#resrowid').val(0);
    $("#resourcemodal").modal('show');
    $('#resrowid').val(0);
    $('#refNewResRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#resname').val($(x).val());
    $('#' + x.id).prop('readonly', false);
}
function WorkGroupUpdate() {
    var isValid =true;

    var icodegenType = parseInt(isNullCheck($('#wgcodegenType').val(),'number'));
    if (icodegenType==0) {
        checkwgslno();
        if ($('#workgroupslno').hasClass('error')) isValid = false;
        if ($('#workgroupslno').val().length==0) {
            showError($('#workgroupslno'), 'Required');
            isValid = false;
        }
    }
    checkWorkGroupName();
    if ($('#workgroup').hasClass('error')) isValid=false;
    if ($('#workgroup').val().length==0) isValid = false;
    else if ($('#worktype').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#worktype_id').val(),'number') ==0) isValid=false;

    if (isValid==false) return;
    var irow = 0;
    if (sWGUpdateMode=='Add') {
//        var irows = $('#newwg tr').length;
        var irows =  parseInt(isNullCheck($('#newwgowid').val(),'number'));
        irow = +irows+1;
        if ($('#newwgname_'+irow).val() !="") {
            var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newwgowid').val(irow);
    } else irow = $('#wgrowid').val();

    $('#newwgnameslno_'+ irow).val($('#workgroupslno').val());
    $('#newwgname_'+ irow).val($('#workgroup').val());
    $('#newwgtypename_'+ irow).val($('#worktype').val());
    $('#newwgid_'+ irow).val($('#worktype_id').val());
    $('#newwgrateanal_'+ irow).val(($('#auto-generate-rate').is(':checked')) ? 1 : 0);
    $('#newitems').show();
    $('#butnewitems').html("New Work Group Created" + "<span class='badge'> " + irow + "</span>").show();

    if (sWGUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWGName = isNullCheck($('#workgroup').val(),'string');
        var iworktypeid = $('#worktype_id').val();
        var sWSpec = 'New.' + irow + '   ' + sWGName;
        arryparentList.push({
            data: sWid,
            value: sWSpec,
            worktypeid: iworktypeid,
            workgroupid: 0,
            workgroupname: sWGName,
            iowid: 0,
            parentname: ''
        });

        var $newResRow = $('#' + $('#refNewWGRowName').val()),
            key = $newResRow[0].id.split('_');
        $('#parentkeyid_'+ key[1]).val(sWid);
        $('#newworkgroupname_'+ key[1]).val(sWGName);
        $('#worktypeid_'+ key[1]).val(iworktypeid);

        $("#workgroupid_"+ key[1]).val(0);
        $("#piowid_"+ key[1]).val(0);
        $("#newparentname_"+ key[1]).val('');

        $newResRow.val('');
        $newResRow.removeClass('error');
        $newResRow.val(sWSpec);
//        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
    }
    $('#workgroupmodal').modal('toggle');
}

function SpecChange(id) {
    $('#'+id).removeClass('error');
    CheckSpecification(id);
    if ($('#'+id).hasClass('error')) return;


    var iRowId = $('#rowid').val(),
        key =   id.split('_')[1];

    if ($('#parentid_' + key).val().length == 0) return;
    if ($('#serialno_' + key).val().length == 0) return;
    if ($('#spec_' + key).val().length == 0) return;

    if (parseInt(isNullCheck($('#unitkeyid_' + key).val(),'number')) == 0) {
        if ($('#raheader_'+ key).is(':checked')) {
            var sSlNo = isNullCheck($('#serialno_' + key).val(), 'string');
            var sSpec = isNullCheck($('#spec_' + key).val(), 'string');

            var sWid = "0." + sSlNo;
            var sWSpec = 'New.' + sSlNo + '   ' + sSpec;
            var iworktypeid = isNullCheck($('#worktypeid_' + key).val(), 'number');
            var iworkgroupid = isNullCheck($('#workgroupid_' + key).val(), 'number');
            var sworkgroupname = isNullCheck($('#newworkgroupname_' + key).val(), 'string');
            var ipiowid = isNullCheck($('#piowid_' + key).val(), 'number');
            var sparentname = sSpec;

            var bFound=false;
            for(var i=0;i<arryparentList.length;i++){
                if (arryparentList[i]['data'] == sWid) {
                    arryparentList[i]['value'] = sWSpec;
                    arryparentList[i]['worktypeid'] = iworktypeid;
                    arryparentList[i]['workgroupid'] = iworkgroupid;
                    arryparentList[i]['iowid'] = ipiowid;
                    arryparentList[i]['workgroupname'] = sworkgroupname;
                    arryparentList[i]['parentname'] = sparentname;
                    bFound=true;
                    return;
                }
            }

            if (bFound==false) {
                arryparentList.push({
                    data: sWid,
                    value: sWSpec,
                    worktypeid: iworktypeid,
                    workgroupid: iworkgroupid,
                    iowid: ipiowid,
                    workgroupname: sworkgroupname,
                    parentname: sparentname
                });
            }
        }
    }
    if($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;
    AddNewRowA(id);
}

function RateResourceUpdate(resName,unit,rate,resId) {
    var irow = 0;
    var irows = $('#resourcerate tr').length;

    var bFound=false;
    var $resid = $('input[id^=rateresid_]');
    $.each($resid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if ($('#'+name).val() == resId) {
            bFound =true;
            return;
        }
    });
    if (bFound ==false) {
        irow = irows - 1;
        if ((irow != 1) || ( irow == 1 && $('#rateresname_1').val() != "")) {
            irow = +irow + 1;
            var html = $("#resourcerate tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#resourcerate tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#rateresname_' + irow).val(resName);
        $('#rateresname_' + irow).attr('data-content', resName);
        $('#rateresunit_' + irow).val(unit);
        $('#rateresrate_' + irow).val(sanitizeNumber(rate,2,true));
        $('#rateresoldrate_' + irow).val(rate);
        $('#rateresid_' + irow).val(resId);
        $('#newrateresource').show();
        $('#butnewrateresource').html("Resource Involved" + "<span class='badge'> " + irow + "</span>").show();
    }
}

function resourceValidation() {
    var isValid=true;

    if (isNullCheck($('#resname').val(),'string') =="") {
        showError($('#resname'), 'Enter Resource Name');
        isValid=false;
    } else {
        removeError($('#resname'));
    }
    if (parseInt(isNullCheck($('#resgroupid').val(),'number')) ==0) {
        showError($('#resgroupid'), 'Select Resource Group');
        isValid=false;
    } else {
        removeError($('#resgroupid'));
    }
    if (parseInt(isNullCheck($('#resunitid').val(),'number')) ==0) {
        showError($('#resunitid'), 'Select Unit');
        isValid=false;
    } else {
        removeError($('#resunitid'));
    }
    return isValid;
}
function ResourceClose() {
    if (sResUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewResRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#resourcemodal').modal('toggle');
}

function workgroupClose() {
    if (sWGUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewWGRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#workgroupmodal').modal('toggle');
}


function ResourceUpdate() {
    var isValid =true;

    var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
    if (icodegenType==0) {
        CheckResCode();
        if ($('#rescode').val().length == 0){
            showError($('#rescode'), 'Required');
            isValid = false;
        }
        if ($('#rescode').hasClass('error')) isValid = false;
    }
    CheckResName();
    if ($('#resname').hasClass('error')) isValid=false;
    if ($('#resgroup').hasClass('error')) isValid=false;
    else if ($('#resunit').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#resgroupid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#restypeid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#resunitid').val(),'number') ==0) isValid=false;
    if (isValid==false) return;
    var restypeid= parseInt(isNullCheck($('#restypeid').val(),'number'));
    if (restypeid==3) {
        if (isNullCheck( $('#wresunitid').val(),'number') ==0) isValid=false;
    }
    var resname = $('#resname').val(),
        resgroupid = isNullCheck($('#resgroupid').val(),'number'),
        resgroup = isNullCheck($('#resgroup').val(),'string'),
        resunit = isNullCheck($('#resunit').val(),'string'),
        resunitid = isNullCheck($('#resunitid').val(),'number'),
        wresunit = isNullCheck($('#wresunit').val(),'string'),
        wresunitid = isNullCheck($('#wresunitid').val(),'number'),
        restype = isNullCheck($('#restype').val(),'string'),
        resrate = isNullCheck($('#resrate').val(),'number'),
        wresrate = isNullCheck($('#wresrate').val(),'number'),
        reslead = isNullCheck($('#reslead').val(),'number'),
        resmattype = isNullCheck($('#resmattype').val(),'string'),
        rescode = isNullCheck($('#rescode').val(),'string');
    var irow = 0;
    if (sResUpdateMode=='Add') {
        var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
        irow = +irows+1;
        if ($('#newresname_'+irow).val() !="") {
            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newresrowid').val(irow);
    } else irow = $('#resrowid').val();
    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();

    if (sResUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;

        var sUnit =resunit,iUnitId=resunitid;
        if (restypeid==3) {
            sUnit =wresunit;
            iUnitId=wresunitid;
            resrate=wresrate;
        }

        arrayreslist.push({
            id: sWid,
            value: sWSpec,
            UnitName: sUnit,
            UnitId: iUnitId,
            Rate: resrate,
            data: {category:'Resource'}
        });

        arrrespicklist.push({
            ResourceId: sWid,
            TypeId: restypeid,
            UnitId: iUnitId,
            Code: 'R ' + 'New.' + irow,
            ResourceName: resname,
            UnitName: sUnit,
            TypeName: restype,
            ResourceGroup: resgroup,
            Select:false
        });

        var $newResRow = $('#' + $('#refNewResRowName').val()),
            key = $newResRow[0].id.split('_');
        if (bSiteMix==false) {
            var ssname = 'rateanalR_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#rateanalR_' + key[1] + '_reskeyid_' + key[3]).val(sWid);
            $("#rateanalR_" + key[1] + "_type_" + key[3]).val('R');
            $("#rateanalR_" + key[1] + "_resrate_" + key[3]).val(sanitizeNumber(resrate,2,true));
            $('#rateanalR_' + key[1] + '_newresname_' + key[3]).val(resname);
            $('#rateanalR_' + key[1] + '_restypeid_' + key[3]).val(restypeid);
            if (restypeid !=2) {
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).prop('readonly', true);
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).hide();
                $('#rateanalR_' + key[1] + '_lblWastage_' + key[3]).hide();
            } else {
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).prop('readonly', false);
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).show();
                $('#rateanalR_' + key[1] + '_lblWastage_' + key[3]).show();
            }

            if (restypeid !=4) {
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).prop('readonly', true);
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).hide();
                $('#rateanalR_' + key[1] + '_lblWeightage_' + key[3]).hide();
            } else {
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).prop('readonly', false);
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).show();
                $('#rateanalR_' + key[1] + '_lblWeightage_' + key[3]).show();
            }

//            cboResChanged(suggestion.id, key1, key2, "R");
        } else {
            var ssname = 'rateanal_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#rateanal_' + key[1] + '_reskeyid_' + key[3]).val(sWid);
            $("#rateanal_" + key[1] + "_type_" + key[3]).val('R');
            $("#rateanal_" + key[1] + "_resrate_" + key[3]).val(sanitizeNumber(resrate,2,true));
            $('#rateanal_' + key[1] + '_newresname_' + key[3]).val(resname);
            $('#rateanal_' + key[1] + '_restypeid_' + key[3]).val(restypeid);

            if (restypeid !=2) {
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).prop('readonly', true);
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).hide();
                $('#rateanal_' + key[1] + '_lblWastage_' + key[3]).hide();
            } else {
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).prop('readonly', false);
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).show();
                $('#rateanal_' + key[1] + '_lblWastage_' + key[3]).show();
            }

            if (restypeid !=4) {
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).prop('readonly', true);
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).hide();
                $('#rateanal_' + key[1] + '_lblWeightage_' + key[3]).hide();
            } else {
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).prop('readonly', false);
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).show();
                $('#rateanal_' + key[1] + '_lblWeightage_' + key[3]).show();
            }
//            cboResChanged(suggestion.id, key1, key2);
        }
        $newResRow.removeClass('error');
        bindResRowAutoComplete($newResRow);
        bindResourceChange();
        bindPopOver();
        $newResRow.val(sWSpec);
        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
        if (bSiteMix==false) AddNewRowResR(key[1],key[3]);
        else AddNewRowRes(key[1],key[3]);
    } else {
        var sresId =   "0." + irow;
        UpdateResourceRate(sresId,resrate);
    }
    $('#resourcemodal').modal('toggle');
}

function CheckResCode() {

    var iARowid  = $('#resrowid').val(),
        $resCode = $('#rescode'),
        resCode =  $resCode.val().trim();

    removeError($resCode);
    if (resCode.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkrescodefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'rescode':resCode,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resCode, 'Already Available');
                return;
            }
        }
    });

    if ($resCode.hasClass('error')) return;
    removeError($resCode);
    var $codes = $('input[id^=newrescode_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resCode.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resCode, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckResName() {
    var iARowid  = $('#resrowid').val(),
        $resName = $('#resname'),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkresnamefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'resname':resName,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resName, 'Already Available');
                return;
            }
        }
    });

    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('input[id^=newresname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckResourceFocus(x,restype) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkResource(key1,restype);
    var $resname = $('#' + x);
    bindResRowAutoComplete($resname);
}

function checkResource(key1,restype) {
    iFocusRowId = key1;
    var $reskeyid ="";
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanalR_' + iFocusRowId + '_iowkeyid_]');
        arrayresR = arrayreslist;
        arrayresR = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(iowkeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanal_' + iFocusRowId + '_iowkeyid_]');
        arrayres = arrayreslist;
        arrayres = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(iowkeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    }
}
function checkIOWUsed(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoid_'+ iFocusRowId).val();
    for (var i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanal_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanal_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanal_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
function checkIOWUsedR(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoidR_'+ iFocusRowId).val();
    for (var i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanalR_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanalR_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanalR_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
function entryValidate() {
    var isValid = true,validRows = 0,
        $trIOW = $('tr[id*=IOWiRowId_]');

    $.each($trIOW, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            key = name.split('_')[1];
        if (name.indexOf('__') != -1) return;
//        var iHeader = $('#headerrow_' + key).val();
        if ($('#parentid_' + key).val().length==0 && $('#serialno_' + key).val().length==0 && $('#spec_' + key).val().length==0 && $('#unitid_' + key).val().length==0) return;

        if ($('#parentid_' + key).hasClass('error')) isValid = false;
        if ($('#serialno_' + key).hasClass('error')) isValid = false;
        if ($('#spec_' + key).hasClass('error')) isValid = false;
        if ($('#unitid_' + key).hasClass('error')) isValid = false;
        if ($('#refserialno_' + key).hasClass('error')) isValid = false;

        if ($('#parentid_' + key).val().length==0) {
            isValid=false;
            showError($('#parentid_' + key), 'Required');
            $('#parentid_' + key).focus();
            return;
        } else if ($('#serialno_' + key).val().length==0) {
            isValid = false;
            showError($('#refserialno_' + key), 'Required');
            $('#refserialno_' + key).focus();
            return;
        } else if ($('#spec_' + key).val().length==0) {
            isValid = false;
            showError($('#spec_' + key), 'Required');
            $('#spec_' + key).focus();
            return;
        } else if ($('#raheader_'+ key).is(':checked')==false) {
            if ($('#unitkeyid_' + key).val().length==0) {
                isValid = false;
                showError($('#unitkeyid_' + key), 'Required');
                $('#unitid_' + key).focus();
                return;
            }
        }
        validRows++;
    });

    if (parseInt(isNullCheck($('#editid').val(),'number')) !=0) {
        var $narration = $('#narration');
        if ($narration.val().length == 0 || $narration.val().trim() == "Remarks") {
            isValid = false;
            showError($narration, 'Required');
            $narration.focus();
        }
    }
    if (validRows == 0) {
        alert('No Item of Work found!');
        return false;
    }
    return isValid;
}
function MainRateUpdate(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iResId = $('#' + name + iFRowId + '_reskeyid_' + iTRowId).val();
    var rateInputs = $(x).parents('li').siblings('li').find('input[type=text]');
    var dRate = 0;
    if($('#' + x.id).val() == "M") { dRate = parseFloat(isNullCheck($(rateInputs[1]).val(),'number')); }
    else if($('#' + x.id).val() == "A") { dRate = parseFloat(isNullCheck($(rateInputs[2]).val(),'number')); }
    else { dRate = parseFloat(isNullCheck($(rateInputs[0]).val(),'number')); }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function MainRateUpdateIOW(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iiowId = $('#' + name + iFRowId + '_iowkeyid_' + iTRowId).val();
    var objAS = $.grep(arrSubIOW, function (element, index) {
        return element.subiowid == iiowId;
    });
    var dRate = 0;
    if (objAS.length >0) {
        if ($('#' + x.id).val() == "R") dRate = parseFloat(isNullCheck(objAS[0]["rrate"],'number'));
        else dRate = parseFloat(isNullCheck(objAS[0]["srate"],'number'));
    }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function isFormula(evt){
    //var charCode = (evt.which) ? evt.which : evt.keyCode
    //alert(charCode);
    //if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=43 && charCode!=45 && charCode!=47 && charCode!=42 && charCode!=46 && charCode!=65 && charCode!=66 && charCode!=67 && charCode!=40 && charCode!=41 && charCode!=82) return false;
    return true;
}


function GetWorkGroupDetails(key,refresh) {

    var iARowid = key,
        iWorkgroupid = parseInt(isNullCheck($('#workgroupid_' + key).val(),'number')),
        iWorktypeid = parseInt(isNullCheck($('#worktypeid_' + key).val(),'number'));

    var sUrl="",iresid=0;
    if (iWorkgroupid !=0) {
        iresId =iWorkgroupid;
        sUrl=getBaseURL() + "project/rfc/getworkgroupdetails";
    } else {
        iresId =iWorktypeid;
        sUrl=getBaseURL() + "project/rfc/getworktypenewdetails";
        refresh=true;
    }

    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0) {
        $.ajax({
            url: sUrl,
            async: false,
            type: 'post',
            data:{resId:iresId},
            success: function (data, status) {
                var obj = jQuery.parseJSON(data);
                var objT =obj['trans'];
                var objA=obj['anal'];

                if (objT['ConcreteMix'] == 1) {
                    $('#concrete_' + iARowid).prop("checked", true);
                    $('#mixtab_' + iARowid).show();
                } else {
                    $('#concrete_' + iARowid).hide();
                    $('#mixtab_' + iARowid).hide();
                }

                $('#rateanalR_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['RWorkingQty'],3));
                $('#rateanal_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['WorkingQty'],3));
                $('#rateanal_' + iARowid + '_AQty').val(sanitizeNumber(objT['CementRatio'],3));
                $('#rateanal_' + iARowid + '_BQty').val(sanitizeNumber(objT['SandRatio'],3));
                $('#rateanal_' + iARowid + '_CQty').val(sanitizeNumber(objT['MetalRatio'],3));
                $('#rateanal_' + iARowid + '_thick').val(sanitizeNumber(objT['ThickQty'],3));
                $('#worktypeid_' +iARowid).val(objT['WorkTypeId'])

                if (objT['Cement'] == 1) { $('#rateanal_' + iARowid + 'AQty_li').show(); }
                else {$('#rateanal_' + iARowid + 'AQty_li').hide();}
                if (objT['Sand'] == 1) $('#rateanal_' + iARowid + 'BQty_li').show();
                else $('#rateanal_' + iARowid + 'BQty_li').hide();
                if (objT['Metal'] == 1)  $('#rateanal_' + iARowid + 'CQty_li').show();
                else  $('#rateanal_' + iARowid + 'CQty_li').hide();
                if (objT['Thickness'] == 1)  $('#rateanal_' + iARowid + 'thick_li').show();
                else $('#rateanal_' + iARowid + 'thick_li').hide();

//            } else {
//                $('#concrete_' + iARowid).hide();
//                $('#mixtab_' + iARowid).hide();
//                $('#rateanalR_' + iARowid + '_AnalQty').hide();
//                $('#rateanal_' + iARowid + 'AQty_li').hide();
//                $('#rateanal_' + iARowid + 'BQty_li').hide();
//                $('#rateanal_' + iARowid + 'CQty_li').hide();
//                $('#rateanal_' + iARowid + 'thick_li').hide();
//            }

                if (objT['AutoRateAnalysis'] == 1 || refresh==true) {

                    var objAS = $.grep(objA, function (element, index) {
                        return element.Type != 'R';
                    });
                    var k = 0;
                    for (var j = 0; j < objAS.length; j++) {
                        k = k + 1;
                        var sRow = '#rowinfoid_' + iARowid;
                        sTransType = isNullCheck(objAS[j]['TransType'], 'string');
                        if (sTransType == "H") {
                            var sValue = isNullCheck(objAS[j]['Description'], 'string');


                            var stabelrow = '#rateanal_' + iARowid+ '_restable',
                                sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';

                            sStr = sStr.replace(/__1/g, '_' + iARowid);
                            sStr = sStr.replace(/__9/g, '_' + k);

//                        $(stabelrow + " tbody tr:last").after(sStr);
                            $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);

                            $('#rateanal_' + iARowid + '_resdes_' + k).val(sValue);
                            $('#rateanal_' + iARowid + '_type_' + k).val("H");

                            if (k == 1) {
                                var $row = $('#rateanal_' + iARowid + '_RowId_1');
                                $row.remove();
                            }

                        } else {
                            if (k != 1) {
                                var stabelrow = '#rateanal_' + iARowid + '_restable';
                                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                                sStr = sStr.replace(/__1/g, '_' + iARowid);
                                sStr = sStr.replace(/__9/g, '_' + k);
                                sStr = sStr.replace(/R1/g, 'R' + k);
//                            $(stabelrow + " tbody.sorting tr:last").after(sStr);
                                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                                $('#rateanal_' + iARowid + '_refid_' + k).val(k);
                                SortOrder(iARowid);
                            }

                            if (objAS[j]['IncludeFlag'] == 1) $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
                            else $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
                            $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
                            $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
                            $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceName']);
                            $('#rateanal_' + iARowid + '_resid_' + k).prop('disabled', true);
                            $('#rateanal_' + iARowid + '_reskeyid_' + k).val(objAS[j]['ResourceId']);
//                    $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
                            $("label[for='" + "rateanal_" + iARowid + "_resunit_" + k + "']").html(objAS[j]['UnitName']);

                            $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAS[j]['Qty'], 3));
                            $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'], 2, true));
                            $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['CFormula']);
                            $('#rateanal_' + iARowid + '_type_' + k).val("R");


                            $('#rateanal_' + iARowid + '_Wastage_' + k).val(objAS[j]['Wastage']);
                            $('#rateanal_' + iARowid + '_Weightage_' + k).val(objAS[j]['Weightage']);
                            $('#rateanal_' + iARowid + '_WastageQty_' + k).val(objAS[j]['WastageQty']);
                            $('#rateanal_' + iARowid + '_WastageAmount_' + k).val(objAS[j]['WastageAmount']);
                            $('#rateanal_' + iARowid + '_restypeid_' + k).val(objAS[j]['TypeId']);

                            if (objAS[j]['TypeId'] != 2) {
                                $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                                $('#rateanal_' + iARowid + '_Wastage_' + k).hide();
                                $('#rateanal_' + iARowid + '_lblWastage_' + k).hide();
                            } else {
                                $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                                $('#rateanal_' + iARowid + '_Wastage_' + k).show();
                                $('#rateanal_' + iARowid + '_lblWastage_' + k).show();
                            }

                            if (objAS[j]['TypeId'] != 4) {
                                $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                                $('#rateanal_' + iARowid + '_Weightage_' + k).hide();
                                $('#rateanal_' + iARowid + '_lblWeightage_' + k).hide();
                            } else {
                                $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                                $('#rateanal_' + iARowid + '_Weightage_' + k).show();
                                $('#rateanal_' + iARowid + '_lblWeightage_' + k).show();
                            }
                            $('#rateanal_' + iARowid + '_resdel_' + k).show();

                            $(sRow).val(k);
                            cboResChanged(objAS[j]['ResourceId'], iARowid, k, "");
                            showAnalysis('rateanal_' + iARowid + '_resrate_' + k, "");
                            $('#rateanal_' + iARowid + '_resqty_' + k).trigger('change');
                        }
                    }
                    if (k!=0)  AddNewRowRes(iARowid,k);
                    if (objT['ConcreteMix'] == 1) {
                        var objAR = $.grep(objA, function (element, index) {
                            return element.Type == 'R';
                        });
                        var k = 0;
                        for (var j = 0; j < objAR.length; j++) {
                            k = k + 1;
                            var sRow = '#rowinfoidR_' + iARowid;
                            sTransType = isNullCheck(objAR[j]['TransType'], 'string');
                            if (sTransType == "H") {
                                var sValue = isNullCheck(objAR[j]['Description'], 'string');
                                var stabelrow = '#rateanalR_' + iARowid+ '_restable',
                                    sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';

                                sStr = sStr.replace(/__1/g, '_' + iARowid);
                                sStr = sStr.replace(/__9/g, '_' + k);

//                            $(stabelrow + " tbody tr:last").after(sStr);
                                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);

                                $('#rateanalR_' + iARowid + '_resdes_' + k).val(sValue);
                                $('#rateanalR_' + iARowid + '_type_' + k).val("H");

                                if (k == 1) {
                                    var $row = $('#rateanalR_' + iARowid + '_RowId_1');
                                    $row.remove();
                                }
                            } else {
                                if (k != 1) {
                                    var stabelrow = '#rateanalR_' + iARowid + '_restable';
                                    var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                                    sStr = sStr.replace(/__1/g, '_' + iARowid);
                                    sStr = sStr.replace(/__9/g, '_' + k);
                                    sStr = sStr.replace(/R1/g, 'R' + k);
//                                $(stabelrow + " tbody.sorting tr:last").after(sStr);
                                    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                                    $('#rateanalR_' + iARowid + '_refid_' + k).val(k);
                                    SortOrderR(iARowid);
                                }
                                if (objAR[j]['IncludeFlag'] == 1) $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
                                else $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
                                $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                                $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
                                $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceName']);
                                $('#rateanalR_' + iARowid + '_resid_' + k).prop('disabled', true);
                                $('#rateanalR_' + iARowid + '_reskeyid_' + k).val(objAR[j]['ResourceId']);
//                        $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);
                                $("label[for='" + "rateanalR_" + iARowid + "_resunit_" + k + "']").html(objAR[j]['UnitName']);
                                $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAR[j]['Qty'], 3));
                                $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'], 2, true));
                                $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['CFormula']);
                                $('#rateanalR_' + iARowid + '_type_' + k).val("R");
                                $('#rateanalR_' + iARowid + '_Wastage_' + k).val(objAR[j]['Wastage']);
                                $('#rateanalR_' + iARowid + '_Weightage_' + k).val(objAR[j]['Weightage']);
                                $('#rateanalR_' + iARowid + '_WastageQty_' + k).val(objAR[j]['WastageQty']);
                                $('#rateanalR_' + iARowid + '_WastageAmount_' + k).val(objAR[j]['WastageAmount']);
                                $('#rateanalR_' + iARowid + '_restypeid_' + k).val(objAR[j]['TypeId']);

                                if (objAR[j]['TypeId'] != 2) {
                                    $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                                    $('#rateanalR_' + iARowid + '_Wastage_' + k).hide();
                                    $('#rateanalR_' + iARowid + '_lblWastage_' + k).hide();
                                } else {
                                    $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                                    $('#rateanalR_' + iARowid + '_Wastage_' + k).show();
                                    $('#rateanalR_' + iARowid + '_lblWastage_' + k).show();
                                }

                                if (objAR[j]['TypeId'] != 4) {
                                    $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                                    $('#rateanalR_' + iARowid + '_Weightage_' + k).hide();
                                    $('#rateanalR_' + iARowid + '_lblWeightage_' + k).hide();
                                } else {
                                    $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                                    $('#rateanalR_' + iARowid + '_Weightage_' + k).show();
                                    $('#rateanalR_' + iARowid + '_lblWeightage_' + k).show();
                                }

                                $('#rateanalR_' + iARowid + '_resdel_' + k).show();
                                $(sRow).val(k);
                                cboResChanged(objAR[j]['ResourceId'], iARowid, k, "R");
                                showAnalysis('rateanalR_' + iARowid + '_resrate_' + k, "R");
                                $('#rateanalR_' + iARowid + '_resqty_' + k).trigger('change');
                            }
                        }
                        if (k!=0)  AddNewRowResR(iARowid,k);
                    }
                }

            }
        });
    }
}
$(function() {
    $(document).keydown(function(event) {
        if(event.keyCode == 13) event.preventDefault();
        else if(event.ctrlKey && event.keyCode == 78) {
            $("#addbut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 83) {
            $("#donebut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 82) {
            if (bSiteMix == true){$("#butresadd").trigger("click");}
            else{$("#butresRadd").trigger("click");}
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 67) {
            if (bSiteMix==true){var iRows = $('#rowinfoid_' + iFocusRowId).val();}
            else {var iRows = $('#rowinfoidR_' + iFocusRowId).val();}
            var arr= [];
            var k=0;
            for (var i = 1; i <= iRows; i++) {
                if (bSiteMix ==true) var sTable = '#rateanal_' + iFocusRowId + '_RowId_' + i;
                else var sTable = '#rateanalR_' + iFocusRowId + '_RowId_' + i;
                if ($(sTable).hasClass('selected') == true) {
                    if (bSiteMix ==true) {
                        arr.push({
                            inc: $('#rateanal_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanal_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanal_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanal_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanal_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanal_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanal_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanal_' + iFocusRowId + '_formula_' + i).val()
                        });
                    } else {
                        arr.push({
                            inc: $('#rateanalR_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanalR_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanalR_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanalR_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanalR_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanalR_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanalR_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanalR_' + iFocusRowId + '_formula_' + i).val()
                        });
                    }
                }
            }
            if (arr.length >0) {
                $.post(getBaseURL() + 'project/rfc/UpdateCopyAnalysis', {ids: arr}, function (data) {
                    //alert (data);
                });
            }
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 86) {
            $.post(getBaseURL() + 'project/rfc/GetCopyAnalysis', {ids: arr}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (bSiteMix==true) {
                    var irowinfoId = $('#rowinfoid_' + iFocusRowId).val();
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#rateanal_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoid_' + iFocusRowId).val(irowinfoId);
                            SortOrder(iFocusRowId);
                        }
                        $('#rateanal_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanal_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanal_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanal_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanal_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanal_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanal_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanal_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanal_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                } else {
                    var irowinfoId = $('#rowinfoidR_' + iFocusRowId).val();
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#rateanalR_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanalR_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoidR_' + iFocusRowId).val(irowinfoId);
                            SortOrderR(iFocusRowId);
                        }
                        $('#rateanalR_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanalR_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanalR_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanalR_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanalR_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanalR_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanalR_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanalR_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanalR_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                }
            });
        }
    });
    bindExcelDeleteFn();
    checkRAUsed();
});

//function excelvalid() {
//    var $excelslnos = $('input[id^=excelserialno_]');
//    $.each($excelslnos, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        var ikey = name.split('_')[1];
//        if (isNullCheck($("#excelserialno_" + ikey).val(), 'string') != "") {
//            if (isNullCheck($("#excelwgid_" + ikey).val(), 'number') == 0)  $('#excelserialno_' + ikey).addClass('error');
//            else $('#excelserialno_' + ikey).prop('readonly',true);
//            if (isNullCheck($("#excelunitid_" + ikey).val(), 'number') == 0)  $('#excelunit_' + ikey).addClass('error');
//            else $('#excelunit_' + ikey).prop('readonly',true);
////            $('#excelcode_' + ikey).prop('readonly',true);
//        }
//        if (isNullCheck($("#excelcode_" + ikey).val(), 'string') != "") {
//            if (isNullCheck($("#excelresid_" + ikey).val(), 'number') == 0)  $('#excelcode_' + ikey).addClass('error');
//            else $('#excelcode_' + ikey).prop('readonly',true);
//            $('#excelunit_' + ikey).prop('readonly',true);
//            $('#excelserialno_' + ikey).prop('readonly',true);
//        }
//    });
//}
//function excelSheetValid() {
//    var isValid=true;
//    var $excelpids = $('input[id^=excelserialno_]');
//    $.each($excelpids, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        var key1 = name.split('_')[1];
//        if ($('#excelserialno_' + key1).hasClass('error')) {
//            isValid=false;
//            return;
//        } else if ($('#excelcode_' + key1).hasClass('error')) {
//            isValid=false;
//            return;
//        } else if ($('#excelunit_' + key1).hasClass('error')) {
//            isValid=false;
//            return;
//        }
//    });
//    return isValid;
//}
//function excelRowvalid(irowId) {
//    var ikey = irowId;
//    if ($('#excelserialno_' + ikey).hasClass('error')) $("#excelserialno_" + ikey).prop('readonly', false);
//    else $("#excelserialno_" + ikey).prop('readonly', true);
//    if ($('#excelcode_' + ikey).hasClass('error')) $("#excelcode_" + ikey).prop('readonly', false);
//    else $("#excelcode_" + ikey).prop('readonly', true);
//    if ($('#excelunit_' + ikey).hasClass('error')) $("#excelunit_" + ikey).prop('readonly', false);
//    else $("#excelunit_" + ikey).prop('readonly', true);
//}
function excelUnitFocus(x) {
    var key = x.split('_')[1];
//    excelRowvalid(key);
    if ($('#excelunit_' + key).hasClass('error')) $('#excelunit_' + key).addClass('error').attr('data-original-title', 'Invalid unit').attr('data-toggle', 'tooltip');
}
function excelUnitvalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelunit_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkunitfound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelunit_' + key).addClass('error');
        else {
            $('#excelunitid_' + key).val(iPId);
            $('#excelunit_' + key).removeClass('error');
        }
    }
}
function getexcelfield(x) {
    var bValid=true;

    bExcelParent = false;
    bExcelType = false;
    bExcelRowType = false;
    bExcelResGroup = false;

    formData = new FormData();
    formData.append('file', $('#myfile').prop("files")[0]);
    $.ajax({
        url: getBaseURL() +"project/rfc/getrgfielddata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);

            $("#excelfieldTable").find("th").remove();
            $("#excelfieldTable").find("td").remove();
            //$("#excelfield").find("td").remove();

            var sStr="Select Field";
            for (var i = 0; i < obj.length; i++) {
                $("#excelfieldTable").append('<tr><th width="20%"><input id="efield_'+i+'" class="text-reon text-right" type="text" value="'+obj[i]['Field']+'" style="background: transparent;"/></th><td width="70%"><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td></tr>');
//                $("#excelfield").append('<td><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td>');
                $('#efield_'+i).prop('readonly', true);

                if (obj[i]['Field'].trim().toUpperCase() == 'SERIALNO') { $('#field_'+i).val('SerialNo'); bExcelSNo=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'SPECIFICATION') { $('#field_'+i).val('Specification'); bExcelSpec=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'UNIT') { $('#field_'+i).val('Unit'); bExcelUnit=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'QTY') { $('#field_'+i).val('Qty'); bExcelQty=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE') { $('#field_'+i).val('Rate'); bExcelRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'AMOUNT') { $('#field_'+i).val('Amount'); bExcelAmount=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'ROWTYPE') { $('#field_'+i).val('RowType'); bExcelRowType=true;}
            }

            bindexcelFieldComplete();
            $('#divitem1').addClass('active');
            iExcelStep=1;
            $('#divstep1').removeClass('stepsep_active');
            $('#divstep2').removeClass('stepsep_active');
            $('#divstep3').removeClass('stepsep_active');
            $('#divstep4').removeClass('stepsep_active');
            $('#divstep5').removeClass('stepsep_active');
            $('#divstep6').removeClass('stepsep_active');
            $('#divstep7').removeClass('stepsep_active');

            $('#p_1').removeClass("stepli_p2");
            $('#p_2').removeClass("stepli_p2");
            $('#p_3').removeClass("stepli_p2");
            $('#p_4').removeClass("stepli_p2");
            $('#p_5').removeClass("stepli_p2");
            $('#p_6').removeClass("stepli_p2");
            $('#p_7').removeClass("stepli_p2");

            $('#divitem2').removeClass('active');
            $('#divitem3').removeClass('active');
            $('#divitem4').removeClass('active');
            $('#divitem5').removeClass('active');
            $('#carouselNext').show();
            $('#carouselApply').hide();
            $("#excelmodal").modal('show');
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));

}

function bindexcelFieldComplete() {
    var $excelfield = $('input[id^=field_]');
    $excelfield.unbind('autocomplete');
    $.each($excelfield, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkexcelFieldUsed(key1);
        $this.autocomplete({
            lookup: arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) removeError($(this));
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) showError($(this), 'Invalid');
                else removeError($(this));
            }
        });
    });
}

function clearInputFile(file){
    var f = file[0];
    if(f.value){
        try{
            f.value = '';
        }catch(err){ }
        if(f.value){
            var form = document.createElement('form'),
                parentNode = f.parentNode, ref = f.nextSibling;
            form.appendChild(f);
            form.reset();
            parentNode.insertBefore(f,ref);
        }
    }
}

function SortOrderBOQ() {
    var rows = $('tr[id*=IOWiRowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        if (id.indexOf('__') != -1 || id.indexOf('excel') != -1) return;
        var irow = id.split("_")[1];
        $('#sortid_'+ irow).val(irefid);
        irefid = + irefid+1;
    });
}

function checkexcelFieldFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkexcelFieldUsed(key1);
}
function checkexcelFieldUsed(id) {
    var reskeyid = $('input[id*=field_]');
    arrayFieldR = arrayField;
    arrayFieldR= $.grep(arrayField, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.value == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}
//Wastage
function showWastage(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        ssname= 'rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        ssname= 'rateanalR_' + iFocusRowId,
            iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }
    var sHtml = '<table class="table red-thss" style=" margin-bottom:0px;"> \
                 <thead> \
                      <tr> \
                       <th>&nbsp;</th> \
                       <th>Ref</th> \
                       <th>Description</th> \
                       <th class="text-right">Qty</th> \
                       <th class="text-right">Wastage%</th> \
                       <th class="text-right">Wastage Qty</th> \
                       <th class="text-right">Rate</th> \
                       <th class="text-right">Amount</th> \
                       <th>&nbsp;</th> \
                      </tr> \
                 </thead> \
                 <tbody>';

    var bWasteFound=false;
    for (var i = 1; i <= iRows; i++) {
        if ($(name + '_inc_' + i).is(':checked') == true) {
            var dwasteper = parseFloat(isNullCheck($(name + "_Wastage_" + i).val(),'number'));
            if (dwasteper !=0) {
                bWasteFound = true;

                var sRef = $('label[for=' + ssname + '_ref_' + i + ']').html().trim(),
                    sDesc = isNullCheck($(name + "_resid_" + i).val(),'string'),
                    dQty = parseFloat(isNullCheck($(name + "_resqty_" + i).val(),'number')),
                    dRate = parseFloat(isNullCheck($(name + "_resrate_" + i).val(),'number')),
                    dwasteQty = parseFloat(isNullCheck($(name + "_WastageQty_" + i).val(),'number')),
                    dwasteAmt = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));

                sHtml = sHtml + '<tr> \
                        <td width="1%">&nbsp;</td> \
                        <td width="3%"><label>' + sRef + '</label></td> \
                        <td width="15%"><input class="parent_text red-non" readonly value="' + sDesc + '"></td> \
                        <td width="5%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dQty,3) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteper,2) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteQty,3) + '"></td> \
                        <td width="8%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dRate,2,true) + '"></td> \
                        <td width="10%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteAmt,2,true) + '"></td> \
                        <td width="4%">&nbsp;</td> \
                        </tr>'
            }
        }
    }
    sHtml = sHtml + '</tbody> </table>';

    if (bWasteFound == false) sHtml="";

    if (sname.substr(sname.length-1) ==  "R") {
        $('#divwasteR_' + iFocusRowId).empty();
        $('#divwasteR_' + iFocusRowId).html(sHtml);
        $('#divwasteR_' + iFocusRowId).fadeIn("slow");
    } else {
        $('#divwaste_' + iFocusRowId).empty();
        $('#divwaste_' + iFocusRowId).html(sHtml);
        $('#divwaste_' + iFocusRowId).fadeIn("slow");
    }
}

//Qualifier
function bindQualExpandTr() {
    var $mainTr = $(".qualmainExp");
    $mainTr.unbind('click');
    $mainTr.click(function (e) {
        e.preventDefault();
        if (!$(this).closest("tr").next(".qualsubTr").is(":visible")) {
            closeQualTr();
            $(this).closest("tr").next(".qualsubTr").show();
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideDown("slow");
        }
        else {
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".qualsubTr").slideUp("slow");
        }
    });
}
function closeQualTr() {
    var $mainTr = $(".qualmainExp");
    $.each($mainTr, function () {
        $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
        $(this).closest("tr").next(".qualsubTr").slideUp("slow");
    });
}

function CalculateQualifier(baseValue, key1,sQualName) {
    var sQName = sQualName + '_';
    var rows = $('#' + sQualName +  'RowId_' + key1).val();
    var sformula="";
    var dbaseAmt=baseValue;
    var dTotalQualAmt=0;
    for (var i = 1; i <= rows; i++) {
        var sRef = $('#' + sQName + key1 + '_Ref_' + i).val().trim();
        var sFormula = isNullCheck($('#' + sQName + key1 + '_Exp_'+ i).val(),'string');
        var dPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_ExpPer_'+ i).val(),'number'));
        var sbaseRef = 'R0';
        if (parseFloatVal(dPer) ==0) dPer=100;
        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);

        for (var j = 1; j <= rows; j++) {
            var sFRef = $('#' + sQName + key1 + '_Ref_' + j).val().trim();
            var dFamt = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_Amount_'+ j).val(),'number'));
            sFormula = sFormula.replace(new RegExp(sFRef, 'g'), dFamt);
        }
        var fvaule = computeEval(sFormula);
        $('#' + sQName + key1 + '_ExpValue_' + i).val(sanitizeNumber(fvaule,2,true));
        var iQualTypeid = $('#' + sQName + key1 + '_TypeId_' + i).val();
        if (iQualTypeid==1) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(), 'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(), 'number'));
            var dCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_CessPer_' + i).val(), 'number'));
            var dEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_EduCessPer_' + i).val(), 'number'));
            var dHEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_HEduCessPer_' + i).val(), 'number'));
            var dNetPer = dTaxPer + (dTaxPer * (dCess + dEDCess + dHEDCess)) / 100;
            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(sanitizeNumber(dNetPer, 2));
            $('#' + sQName + key1 + '_ExpPer_' + i).val(sanitizeNumber(dNetPer, 2));

            var dTaxableAmt = fvaule * (dTaxablePer / 100);
            var dTaxAmt = dTaxableAmt * (dTaxPer / 100);
            var dCessAmt = dTaxAmt * (dCess / 100);
            var dEDAmt = dTaxAmt * (dEDCess / 100);
            var dHEDAmt = dTaxAmt * (dHEDCess / 100);
            var dNetAmt = dTaxAmt + dCessAmt + dEDAmt + dHEDAmt;

            $('#' + sQName + key1 + '_TaxableAmt_' + i).val(sanitizeNumber(dTaxableAmt, 2,true));
            $('#' + sQName + key1 + '_TaxPerAmt_' + i).val(sanitizeNumber(dTaxAmt, 2,true));
            $('#' + sQName + key1 + '_CessAmt_' + i).val(sanitizeNumber(dCessAmt, 2,true));
            $('#' + sQName + key1 + '_EduCessAmt_' + i).val(sanitizeNumber(dEDAmt, 2,true));
            $('#' + sQName + key1 + '_HEduCessAmt_' + i).val(sanitizeNumber(dHEDAmt, 2,true));
            $('#' + sQName + key1 + '_NetAmt_' + i).val(sanitizeNumber(dNetAmt, 2,true));

            dAmt = dNetAmt;
        } else if (iQualTypeid==2) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(), 'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(), 'number'));
            var dKKCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_KKCess_' + i).val(), 'number'));
            var dSBCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_SBCess_' + i).val(), 'number'));
            var dNetPer = dTaxPer + dKKCess + dSBCess;

            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(sanitizeNumber(dNetPer, 2));
            $('#' + sQName + key1 + '_ExpPer_' + i).val(sanitizeNumber(dNetPer, 2));

            var dTaxableAmt = fvaule * (dTaxablePer / 100);
            var dTaxAmt = dTaxableAmt * (dTaxPer / 100);
            var dKKCessAmt = dTaxableAmt * (dKKCess / 100);
            var dSBCessAmt = dTaxableAmt * (dSBCess / 100);

            var dNetAmt = dTaxAmt + dKKCessAmt + dSBCessAmt;

            $('#' + sQName + key1 + '_TaxableAmt_' + i).val(sanitizeNumber(dTaxableAmt, 2,true));
            $('#' + sQName + key1 + '_TaxPerAmt_' + i).val(sanitizeNumber(dTaxAmt, 2,true));
            $('#' + sQName + key1 + '_KKCessAmt_' + i).val(sanitizeNumber(dKKCessAmt, 2,true));
            $('#' + sQName + key1 + '_SBCessAmt_' + i).val(sanitizeNumber(dSBCessAmt, 2,true));
            $('#' + sQName + key1 + '_NetAmt_' + i).val(sanitizeNumber(dNetAmt, 2,true));

            dAmt = dNetAmt;
        } else {
            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
        }

        $('#' + sQName + key1 + '_Amount_' + i).val(sanitizeNumber(dAmt,2,true));
        if ($('#' + sQName + key1 + '_YesNo_' + i).is(':checked') == true) {
            var sSign = isNullCheck($('#' + sQName + key1 + '_Sign_' + i).val(),'string');
            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
        }
    }
    $('#'+ sQualName + 'TotalAmt_' + key1).val(sanitizeNumber(dTotalQualAmt,2,true));

    return dTotalQualAmt;
    //qualTotal();
}

function bindTaxCalculation() {
    var $mainTr = $(".qualChange");
    $mainTr.change(function (e) {
        CalculateTax($(this)[0].id);
    });
}

function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateTax($this[0].id);
}

function closeAllActivity() {
    var $resrate = $('input[id*=_resrate_]');
    $.each($resrate, function() {
        var x = $(this)[0].id;
        if (x.indexOf('__') != -1) return;
        closeIOWAnalysis(x);
    });
}
function CalculateTax(id) {
    //if (bReady==false) return;
    var sname= id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#rateanal_' + key1;
    if (sname == "QualR")  name = '#rateanalR_' + key1;

    CalculateRate(name);

    //var sname = $('#QualRowRef_' + key1).val();
    ///var dbaseAmt= parseFloat($('#' + sname).val());

//    CalculateQualifier(dbaseAmt,key1);
//
//    var dTaxAmt = parseFloat(isNullCheck($('#QualTotalAmt_' + key1).val(),'number'));
//
//    var k1 = sname.split('_')[1],
//        k2 = sname.split('_')[3];
//
//    $('#BillAbs_' + k1 + '_TaxAmt_' + k2).val(dTaxAmt);
//    $('#BillAbs_' + k1 + '_NetAmt_' + k2).val(dTaxAmt+dbaseAmt);
//
//    calcTotal();
}

function checkwgslno() {
    var icodegenType = parseInt(isNullCheck($('#wgcodegenType').val(),'number'));
    if (icodegenType==1) return;

    var iARowid  = $('#wgrowid').val(),
        $wgslno = $('#workgroupslno'),
        wgslno =  $wgslno.val().trim();

    removeError($wgslno);
    if (wgslno.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkworkgroupslnofound",
        async: false,
        type: 'post',
        data: {'groupid': editid, 'slno':wgslno,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($wgslno, 'Already Available');
                return;
            }
        }
    });
    if ($wgslno.hasClass('error')) return;
    removeError($wgslno);

    var $codes = $('input[id^=newwgnameslno_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (wgslno == $('#'+name).val().trim()) {
                    showError($wgslno, 'Already Available');
                    return;
                }
            }
        }
    });
}
function checkWorkGroupName() {
    var iARowid  = $('#wgrowid').val(),
        $workgroupname = $('#workgroup'),
        sGroupName =  $workgroupname.val().trim();

    removeError($workgroupname);
    if (sGroupName.length ==0)
        return;

    var irfcid = isNullCheck($('#rfcUId').val(), 'number'),
        iWorkGroupId = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkworkgroupnamefound",
        async: false,
        type: 'post',
        data: {'groupid': iWorkGroupId, 'groupname':sGroupName,'rfcid':irfcid},
        success: function(data,status) {
            if (data == "Y") {
                showError($workgroupname, 'Already Available');
                return;
            }
        }
    });
    if ($workgroupname.hasClass('error')) return;
    removeError($workgroupname);

    var $codes = $('input[id^=newwgname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (sGroupName == $('#'+name).val().trim()) {
                    showError($workgroupname, 'Already Available');
                    return;
                }
            }
        }
    });
}
function CheckHeaderRows() {
    var rows = $('tr[id*=IOWiRowId_]');
    $.each(rows, function() {
        var id = $(this)[0].id;
        if (id.indexOf('__') != -1 || id.indexOf('excel') != -1) return;
        var irow = id.split("_")[1];
        checkHeader('raheader_'+irow);
    });
}
function checkHeader(x) {
    var key = x.split('_')[1];
    if ($('#'+ x).is(':checked')) {
        $('#raheaderval_'+ key).val(1);
        $('#unitid_' + key).closest('td').hide();
        $('#qty_' + key).closest('td').hide();
        $('.wbsTr_' + key).closest('td').hide();
        $('#rate_' + key).closest('td').hide();
        $('#amt_' + key).closest('td').hide();
        $('.mainTr_' + key).hide();
        $('#spec_'+ key).closest('td').attr('colspan','3');
        $('#spec_'+ key).closest('tr').addClass('row_specheader');
        $("label[for='lblfromiow_" + key + "']").html("");
        SpecChange('spec_' + key);
    } else {
        $('#raheaderval_'+ key).val(0);
        $('#unitid_' + key).closest('td').show();
        $('#qty_' + key).closest('td').show();
        $('.wbsTr_' + key).closest('td').show();
        $('#rate_' + key).closest('td').show();
        $('#amt_' + key).closest('td').show();
        $('.mainTr_' + key).show();
        $('#spec_'+ key).closest('td').removeAttr('colspan');
        $('#spec_'+ key).closest('tr').removeClass('row_specheader');
        $('#lblfromiow_'+key).show();
        $("label[for='lblfromiow_" + key + "']").html("From Library IOW");
    }
}
function showrow(id) {
    alert(id);
}
//Excel Import

function checkExcelResource() {
    var excelRes=[];
    var excelUnit=[];
    var excelWG=[];

    //Resource
    $('#excelresTable tr:gt(1)').remove();
    $("#excelresresource_1").val('');
    $("#excelresoldresource_1").val('');
    $("#excelresresgroup_1").val('');
    $("#excelresunit_1").val('');
    $("#excelrestype_1").val('');
    $("#excelresmaterialtype_1").val('G');

    $("#excelreswunit_1").val('');
    $("#excelresold_1").val(0);
    $("#excelresunitid_1").val(0);
    $("#excelresresgroupid_1").val(0);
    $("#excelresrestypeid_1").val(0);
    $("#excelreswunitid_1").val(0);

    //Unit
    $('#excelunitTable tr:gt(1)').remove();
    $("#excelununit_1").val('');
    $("#excelrefunit_1").val('');
    $("#excelrefunitid_1").val(0);

    //Workgroup
    $('#excelwgTable tr:gt(1)').remove();
    $("#excelunworkgroup_1").val('');
    $("#excelrefworkgroup_1").val('');
    $("#excelrefworktype_1").val('');
    $("#excelrefworkgroupid_1").val(0);
    $("#excelrefworktypeid_1").val(0);


    var irow=1;
    var iUrow=1;
    var iWGrow=1;
    var $resnames = $('input[id*=excelspec_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];
        var sRowType = isNullCheck($('#excelrowtype_'+ key).val(),'string');

        if (sRowType =="R") {
            var iResId = parseInt(isNullCheck($('#excelresid_'+key).val(),'number'));
            if (iResId ==0) {
                var sResName = isNullCheck($('#excelspec_'+key).val(),'string');
                if($.inArray(sResName, excelRes) == -1) {
                    excelRes.push(sResName);
                    if (irow !=1) {
                        $("#excelresTable tbody tr:last").after('<tr>' + $("#excelresTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelresTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace("_1", "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace("_1", "_" + irow));
                        });
                    }
                    $("#excelresresource_" + irow).val(sResName);
                    irow = +irow + 1;
                }
            } else  {
//                $(this).closest('tr').css('color','#228B22');
                $(this).closest('tr').addClass('excelvalid');
                $(this).closest('tr').find("input").attr("readonly", "readonly");
            }
            $('#excelrowid_' + key).addClass('excel4');
            $('#excelparent_'+key).hide();
        } else if (sRowType =="I") {
            var sUnit = isNullCheck($('#excelunit_' + key).val(), 'string');
            if (sUnit != "") {
                var iUnitId = parseInt(isNullCheck($('#excelunitid_' + key).val(), 'number'));
                if (iUnitId == 0) {
                    if ($.inArray(sUnit, excelUnit) == -1) {
                        excelUnit.push(sUnit);
                        if (iUrow != 1) {
                            $("#excelunitTable tbody tr:last").after('<tr>' + $("#excelunitTable tbody tr:first").html() + "</tr>");
                            var $tr = $("#excelunitTable tbody tr:last");
                            $tr.find("input").each(function () {
                                $(this).attr("id", $(this).attr("id").replace("_1", "_" + iUrow));
                            });
                        }
                        $("#excelununit_" + iUrow).val(sUnit);
                        iUrow = +iUrow + 1;
                    }
                }
            }
            $('#excelrowid_' + key).addClass('excel3');
        } else if (sRowType =="H") {
            var iWGId = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));
            if (iWGId !=0) {
                var iWGTypeId =parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                var sSlNo = isNullCheck($('#excelserialno_' + key).val(), 'string');
                var sSpec = isNullCheck($('#excelspec_' + key).val(), 'string');
                var iworktypeid = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));;
                var iworkgroupid = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                var sworkgroupname = isNullCheck($('#excelnewworkgroupname_' + key).val(), 'string');
                var ipiowid = parseInt(isNullCheck($('#excelparentid_' + key).val(), 'number'));;
                var arryHeader =[];
                arryHeader.push({
                    SlNo: sSlNo,
                    Spec: sSpec,
                    WorkTypeId: iworktypeid,
                    WorkGroupId: iworkgroupid,
                    WorkGroupName: sworkgroupname,
                    PIOWId: ipiowid
                });
                excelHeaderUpdatetoMain(arryHeader);
            }
            $('#excelrowid_' + key).addClass('excel2');
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
        } else if (sRowType =="WG") {
            var sWGName =isNullCheck($('#excelspec_' + key).val(),'string');
            if (sWGName !="") {
                var iWGId = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));
                if (iWGId == 0) {
                    if ($.inArray(sWGName, excelWG) == -1) {
                        excelWG.push(sWGName);
                        if (iWGrow != 1) {
                            $("#excelwgTable tbody tr:last").after('<tr>' + $("#excelwgTable tbody tr:first").html() + "</tr>");
                            var $tr = $("#excelwgTable tbody tr:last");
                            $tr.find("input").each(function () {
                                $(this).attr("id", $(this).attr("id").replace("_1", "_" + iWGrow));
                            });
                        }
                        $("#excelunworkgroup_" + iWGrow).val(sWGName);
                        iWGrow = +iWGrow + 1;
                    }

                }
            }
            $('#excelrowid_' + key).addClass('excel1');
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
        }
    });
    bexcelUnitFound =false;
    bexcelResFound =false;
    bexcelWGFound=false;
    if (excelRes.length >0) { bexcelResFound =true; bindExcelResAutoComplete(); }
    if (excelUnit.length >0) { bexcelUnitFound=true; bindExcelUnitAutoComplete(); }
    if (excelWG.length >0) { bexcelWGFound=true; bindExcelWGAutoComplete(); }

//    if (bexcelResFound ==true) { $('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divunittable').hide(); $('#divrestable').show(); }
//    else if (bexcelUnitFound==true) {$('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divrestable').hide(); $('#divunittable').show();  }
//    else { $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();}
}


function bindExcelUnitAutoComplete() {
    $unitids = $('input[id*=excelrefunit_]');
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
}
function bindExcelWGAutoComplete() {
    $workgroupids = $('input[id*=excelrefworkgroup_]');
    $.each($workgroupids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayworkgroup,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefworkgroupid_" + key1).val(suggestion.data);
                    $("#excelrefworktype_" + key1).val(suggestion.WorkType);
                    $("#excelrefworktypeid_" + key1).val(suggestion.WorkTypeId);
                    $("#excelrefworktype_" + key1).prop('readonly',true);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefworkgroupid_" + key1).val(0);
                $("#excelrefworktypeid_" + key1).val(0);
                $("#excelrefworktype_" + key1).val('');
                $("#excelrefworktype_" + key1).prop('readonly',false);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefworkgroupid_" + key1).val(0);
                    $("#excelrefworktypeid_" + key1).val(0);
                    $("#excelrefworktype_" + key1).val('');
                    $("#excelrefworktype_" + key1).prop('readonly',false);
                } else $(this).removeClass('error');
            }
        });
    });

    $workgrouptypeids = $('input[id*=excelrefworktype_]');
    $.each($workgrouptypeids , function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayworktype,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefworktypeid_" + key1).val(suggestion.data);
                    $("#excelrefworkgroup_" + key1).prop('readonly',true);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefworktypeid_" + key1).val(0);
                $("#excelrefworkgroup_" + key1).prop('readonly',false);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefworktypeid_" + key1).val(0);
                    $("#excelrefworkgroup_" + key1).prop('readonly',false);
                } else $(this).removeClass('error');
            }
        });
    });
}
function checkExcelResourceFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkExcelResourceUsed();
    var $resname = $('#' + x);

    bindExcelResRowAutoComplete($resname);
}

function checkExcelResourceUsed() {
    var excelresids = $('input[id*=excelresold_]');
    arrexcelresourceR = arrexcelresource;
    arrexcelresourceR = $.grep(arrexcelresource, function (element, index) {
        var is_selected = true;
        $.each(excelresids, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (element.data == $this.val()) is_selected = false;
        });
        return is_selected;
    });
}

function bindExcelResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1];
    $this.unbind('autocomplete');
    $this.autocomplete({
        lookup: arrexcelresourceR,
        showNoSuggestionNotice:false,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#excelresold_' + key1).val(suggestion.data);
                $('#excelresresgroup_'+ key1).val(suggestion.ResourceGroupName);
                $('#excelresresgroupid_'+ key1).val(suggestion.ResourceGroupId);
                $('#excelrestype_'+ key1).val(suggestion.TypeName);
                $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);
                $('#excelresunit_'+ key1).val(suggestion.UnitName);
                $('#excelwresunit_'+ key1).val(suggestion.WorkUnit);
                $('#excelresunitid_'+ key1).val(suggestion.UnitId);
                $('#excelwresunitid_'+ key1).val(suggestion.WorkUnitId);
                var sMatType = $.trim(isNullCheck(suggestion.MaterialType,'string'));
                if (sMatType =="") sMatType ="G";
                $('#excelresmaterialtype_' + key1).val(sMatType).prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).show();
                $('#excelrestype_' + key1).show();

                if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                else $('#excelresmaterialtype_' + key1).hide();

                if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                else $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',true);
                $('#excelresunit_'+ key1).prop('readonly',true);
                $('#excelresmaterialtype_'+ key1).prop('readonly',true);
                $('#excelreswunit_'+ key1).prop('readonly',true);
                $('#excelresmaterialtype_'+ key1).prop('disabled',true);

                if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');

                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $('#excelresold_' + key1).val(0);
            $('#excelresresgroup_'+ key1).val('');
            $('#excelresresgroupid_'+ key1).val(0);
            $('#excelrestype_'+ key1).val('');
            $('#excelresrestypeid_'+ key1).val(0);
            $('#excelresunit_'+ key1).val('');
            $('#excelwresunit_'+ key1).val('');
            $('#excelresunitid_'+ key1).val(0);
            $('#excelwresunitid_'+ key1).val(0);
            $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

            $('#excelresunit_' + key1).hide();
            $('#excelrestype_' + key1).hide();
            $('#excelresmaterialtype_' + key1).hide();
            $('#excelreswunit_' + key1).hide();

            $('#excelresresgroup_'+ key1).prop('readonly',false);
            $('#excelresunit_'+ key1).prop('readonly',false);
            $('#excelresmaterialtype_'+ key1).prop('readonly',false);
            $('#excelreswunit_'+ key1).prop('readonly',false);
            $('#excelresmaterialtype_'+ key1).prop('disabled',false);

        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $('#excelresold_' + key1).val(0);
                $('#excelresresgroup_'+ key1).val('');
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresunit_'+ key1).val('');
                $('#excelwresunit_'+ key1).val('');
                $('#excelresunitid_'+ key1).val(0);
                $('#excelwresunitid_'+ key1).val(0);
                $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',false);
                $('#excelresunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                $('#excelreswunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('disabled',false);
            } else $(this).removeClass('error');
        }
    });
}

function bindExcelResAutoComplete() {
    $unitids = $('input[id*=excelresunit_]');
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelresunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelresunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelresunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
    $wunitids = $('input[id*=excelreswunit_]');
    $.each($wunitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arraywunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelreswunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelreswunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#execelreswunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
    $excelresgroupids = $('input[id*=excelresresgroup_]');
    $.each($excelresgroupids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrexcelresgroup,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#excelresresgroupid_'+ key1).val(suggestion.data);
                    $('#excelrestype_'+ key1).val(suggestion.TypeName);
                    $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);

                    $('#excelresunit_' + key1).show();
                    $('#excelrestype_' + key1).show();

                    if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                    else $('#excelresmaterialtype_' + key1).hide();

                    if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                    else $('#excelreswunit_' + key1).hide();

                    if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $('#excelresrestypeid_'+ key1).val(0);
                    $('#excelresresgroupid_'+ key1).val(0);
                    $('#excelrestype_'+ key1).val('');
                    $('#excelresunit_' + key1).hide();
                    $('#excelrestype_' + key1).hide();
                    $('#excelresmaterialtype_' + key1).hide();
                    $('#excelreswunit_' + key1).hide();
                } else $(this).removeClass('error');
            }
        });
    });

    $excelresids = $('input[id*=excelresoldresource_]');
    $.each($excelresids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrexcelresourceR,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#excelresold_' + key1).val(suggestion.data);
                    $('#excelresresgroup_'+ key1).val(suggestion.ResourceGroupName);
                    $('#excelresresgroupid_'+ key1).val(suggestion.ResourceGroupId);
                    $('#excelrestype_'+ key1).val(suggestion.TypeName);
                    $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);
                    $('#excelresunit_'+ key1).val(suggestion.UnitName);
                    $('#excelwresunit_'+ key1).val(suggestion.WorkUnit);
                    $('#excelresunitid_'+ key1).val(suggestion.UnitId);
                    $('#excelwresunitid_'+ key1).val(suggestion.WorkUnitId);
                    var sMatType = $.trim(isNullCheck(suggestion.MaterialType,'string'));
                    if (sMatType =="") sMatType ="G";
                    $('#excelresmaterialtype_' + key1).val(sMatType).prop('selected', true).trigger('change');

                    $('#excelresunit_' + key1).show();
                    $('#excelrestype_' + key1).show();

                    if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                    else $('#excelresmaterialtype_' + key1).hide();

                    if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                    else $('#excelreswunit_' + key1).hide();

                    $('#excelresresgroup_'+ key1).prop('readonly',true);
                    $('#excelresunit_'+ key1).prop('readonly',true);
                    $('#excelresmaterialtype_'+ key1).prop('readonly',true);
                    $('#excelreswunit_'+ key1).prop('readonly',true);
                    $('#excelresmaterialtype_'+ key1).prop('disabled',true);

                    if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');

                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $('#excelresold_' + key1).val(0);
                $('#excelresresgroup_'+ key1).val('');
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresunit_'+ key1).val('');
                $('#excelwresunit_'+ key1).val('');
                $('#excelresunitid_'+ key1).val(0);
                $('#excelwresunitid_'+ key1).val(0);
                $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',false);
                $('#excelresunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                $('#excelreswunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('disabled',false);

            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $('#excelresold_' + key1).val(0);
                    $('#excelresresgroup_'+ key1).val('');
                    $('#excelresresgroupid_'+ key1).val(0);
                    $('#excelrestype_'+ key1).val('');
                    $('#excelresrestypeid_'+ key1).val(0);
                    $('#excelresunit_'+ key1).val('');
                    $('#excelwresunit_'+ key1).val('');
                    $('#excelresunitid_'+ key1).val(0);
                    $('#excelwresunitid_'+ key1).val(0);
                    $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                    $('#excelresunit_' + key1).hide();
                    $('#excelrestype_' + key1).hide();
                    $('#excelresmaterialtype_' + key1).hide();
                    $('#excelreswunit_' + key1).hide();

                    $('#excelresresgroup_'+ key1).prop('readonly',false);
                    $('#excelresunit_'+ key1).prop('readonly',false);
                    $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                    $('#excelreswunit_'+ key1).prop('readonly',false);
                    $('#excelresmaterialtype_'+ key1).prop('disabled',false);
                } else $(this).removeClass('error');
            }
        });
    });
}
function validateexcelUnWG() {
    var bValid = true;
    var $resnames = $('input[id*=excelunworkgroup_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1],
            iWGId =  parseInt(isNullCheck($('#excelrefunitid_' + key).val(),'number')),
            iWGTypeId =  parseInt(isNullCheck($('#excelrefworktypeid_' + key).val(),'number'));

        if (iWGTypeId==0) {
            bValid = false;
            showError($('#excelrefworktype_' + key), 'Required');
        }
    });
    if (bValid ==false) return bValid;
    applyWGtoIOW();
    return bValid;

//    $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();
}
function bindexcelParentAutoComplete() {
    var $parent_ids = $('input[id*=excelparent_]');
    $parent_ids.unbind('autocomplete');
    $.each($parent_ids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key1 =  name.split('_')[1];
        $this.autocomplete({
            lookup: arryparentList,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelparentid_"+ key1).val(suggestion.data);
                    $("#excelwgtypeid_"+ key1).val(suggestion.worktypeid);
                    $("#excelwgid_"+ key1).val(suggestion.workgroupid);
//                    $("#piowid_"+ key1).val(suggestion.iowid);
                    $("#excelparentspec_"+ key1).val(suggestion.parentname);
//                    CheckParentValid('parentid_'+key1);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelparentid_"+ key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#parentkeyid_"+ key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
}
function nextexcelunit() {
    var bValid = true;
    var $resnames = $('input[id*=excelununit_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1],
            iUnitId =  parseInt(isNullCheck($('#excelrefunitid_' + key).val(),'number'));
        if (iUnitId ==0) {
            bValid = false;
            showError($('#excelrefunit_' + key), 'Required');
        }
    });
    if (bValid ==false) return bValid;
    applyunittoIOW();
    return bValid;

//    $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();
}
function nextexcelresource() {
    var bValid = true;
    var $resnames = $('input[id*=excelresresource_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var ioldResId = parseInt(isNullCheck($('#excelresold_' + key).val(),'number')),
            iUnitId = parseInt(isNullCheck($('#excelresunitid_' + key).val(),'number')),
            iWUnitId = parseInt(isNullCheck($('#excelreswunitid_' + key).val(),'number')),
            iresgroupId = parseInt(isNullCheck($('#excelresresgroupid_' + key).val(),'number')),
            smattype = isNullCheck($('#excelresmaterialtype_' + key).val(),'string'),
            irestypeid = parseInt(isNullCheck($('#excelresrestypeid_' + key).val(),'number'));

        if (ioldResId ==0) {
            if (iresgroupId ==0) {
                bValid = false;
                showError($('#excelresresgroup_' + key), 'Required');
            }
            if (irestypeid ==0) {
                bValid = false;
                showError($('#excelrestype_' + key), 'Required');
            }
            if (iUnitId ==0) {
                bValid = false;
                showError($('#excelresunit_' + key), 'Required');
            }
            if (irestypeid ==2) {
                if (smattype =="") {
                    bValid = false;
                    showError($('#excelresmaterialtype_' + key), 'Required');
                }
            }
            if (irestypeid ==3) {
                if (iWUnitId ==0) {
                    bValid = false;
                    showError($('#excelreswunit_' + key), 'Required');
                }
            }
        }
    });
    if (bValid ==false) return bValid;
    applyresourcetoIOW();
    return bValid;

//    if (bexcelUnitFound==true) {$('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divrestable').hide(); $('#divunittable').show();  }
//    else { $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();}
}
function applyWGtoIOW() {
    var $resnames = $('input[id*=excelunworkgroup_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sWGName =isNullCheck($('#excelunworkgroup_' + key).val(), 'string'),
            sNewWGName =isNullCheck($('#excelrefworkgroup_' + key).val(), 'string'),
            iWGId = parseInt(isNullCheck($('#excelrefworkgroupid_' + key).val(), 'number')),
            sWGType = parseInt(isNullCheck($('#excelrefworktype_' + key).val(), 'string')),
            iWGTypeId = parseInt(isNullCheck($('#excelrefworktypeid_' + key).val(), 'number'));

        var arrWG=[];
        if (iWGId ==0) {
            arrWG.push({
                SlNo: '',
                WGName: sWGName,
                WGType: sWGType,
                iWGTypeId: iWGTypeId
            });

            var arrResNew =[];
            arrResNew = excelWGUpdateToMain(arrWG);

            iWGId =  arrResNew[0]['data'];
            sNewWGName =  arrResNew[0]['value'];
        }

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            var sRowType = isNullCheck($('#excelrowtype_' + irow).val(), 'string');
            if (sRowType == "WG") {
                var sIOWWG = isNullCheck($('#excelspec_' + irow).val(), 'string'),
                    iIOWWGId = parseInt(isNullCheck($('#excelwgid_'+irow).val(),'number'));
                if (iIOWWGId == 0) {
                    if (sIOWWG == sWGName) {
                        $("#excelspec_" + irow).val(sNewWGName);
                        $('#excelwgid_' + irow).val(iWGId);
                        $('#excelwgtypeid_' + irow).val(iWGTypeId);
                        $('#excelnewworkgroupname_' + irow).val(sWGName);
                        $("#excelspec_" + irow).removeClass('error');
                    }
                }
            } else if (sRowType == "I" || sRowType=='H') {
                var sIOWParent = isNullCheck($('#excelparent_' + irow).val(), 'string'),
                    iIOWWGId = parseInt(isNullCheck($('#excelwgid_'+irow).val(),'number'));
                if (iIOWWGId == 0) {
                    if (sIOWParent == sWGName) {
                        $("#excelparent_" + irow).val(sNewWGName);
                        $('#excelwgid_' + irow).val(iWGId);
                        $('#excelwgtypeid_' + irow).val(iWGTypeId);
                        $('#excelnewworkgroupname_' + irow).val(sWGName);
                        $("#excelparent_" + irow).removeClass('error');
                    }
                    if (sRowType =='H') {
                        var sSlNo = isNullCheck($('#excelserialno_' + key).val(), 'string');
                        var sSpec = isNullCheck($('#excelspec_' + key).val(), 'string');
                        var iworktypeid = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));;
                        var iworkgroupid = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                        var sworkgroupname = isNullCheck($('#excelnewworkgroupname_' + key).val(), 'string');
                        var ipiowid = parseInt(isNullCheck($('#excelparentid_' + key).val(), 'number'));;
                        var arryHeader =[];
                        arryHeader.push({
                            SlNo: sSlNo,
                            Spec: sSpec,
                            WorkTypeId: iworktypeid,
                            WorkGroupId: iworkgroupid,
                            WorkGroupName: sworkgroupname,
                            PIOWId: ipiowid
                        });
                        excelHeaderUpdatetoMain(arryHeader);
                    }
                }
            }

        });
    });
}
function applyunittoIOW() {
    var $resnames = $('input[id*=excelununit_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sUnit =isNullCheck($('#excelununit_' + key).val(), 'string'),
            sNewUnit =isNullCheck($('#excelrefunit_' + key).val(), 'string'),
            iUnitId = parseInt(isNullCheck($('#excelrefunitid_' + key).val(), 'number'));

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            if (isNullCheck($('#excelrowtype_' + irow).val(), 'string') == "I") {
                var sIOWUnit = isNullCheck($('#excelunit_' + irow).val(), 'string'),
                    iIOWUnitId = parseInt(isNullCheck($('#excelunitid_'+irow).val(),'number'));
                if (iIOWUnitId == 0) {
                    if (sIOWUnit == sUnit) {
                        $("#excelunit_" + irow).val(sNewUnit);
                        $('#excelunitid_' + irow).val(iUnitId);
                        $("#excelunit_" + irow).removeClass('error');
//                        $(this).closest('tr').css('color','#228B22');
//                        $(this).closest('tr').find("input").attr("readonly", "readonly");
                    }
                }
            }
        });
    });
}
function applyresourcetoIOW() {
    var $resnames = $('input[id*=excelresresource_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var snewResName ='',
            sresName = isNullCheck($('#excelresresource_' + key).val(), 'string'),
            ioldResId = parseInt(isNullCheck($('#excelresold_' + key).val(), 'number')),
            soldResName =  isNullCheck($('#excelresoldresource_' + key).val(),'string'),
            iUnitId = parseInt(isNullCheck($('#excelresunitid_' + key).val(), 'number')),
            iWUnitId = parseInt(isNullCheck($('#excelreswunitid_' + key).val(), 'number')),
            sUnit = isNullCheck($('#excelresunit_' + key).val(), 'string'),
            sWUnit = isNullCheck($('#excelreswunit_' + key).val(), 'string'),
            iresgroupId = parseInt(isNullCheck($('#excelresresgroupid_' + key).val(), 'number')),
            sresgroup= isNullCheck($('#excelresresgroup_' + key).val(), 'string'),
            smattype = isNullCheck($('#excelresmaterialtype_' + key).val(), 'string'),
            srestype = isNullCheck($('#excelrestype_' + key).val(), 'string'),
            irestypeid = parseInt(isNullCheck($('#excelresrestypeid_' + key).val(), 'number'));

        var arrRes=[];
        if (ioldResId ==0) {
            arrRes.push({
                resname: sresName,
                resgroupid: iresgroupId,
                resgroup: sresgroup,
                resunit: sUnit,
                resunitid: iUnitId ,
                wresunit: sWUnit,
                wresunitid: iWUnitId,
                restypeid: irestypeid,
                restype: srestype,
                resrate: 0,
                wresrate: 0,
                reslead: 0,
                resmattype: smattype,
                rescode: ''
            });

            var arrResNew =[];
            arrResNew = excelResourceUpdateToMain(arrRes);

            ioldResId =  arrResNew[0]['data'];
            snewResName =  arrResNew[0]['value'];
        } else {
            snewResName =soldResName;
        }

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            if (isNullCheck($('#excelrowtype_' + irow).val(), 'string') == "R") {
                var sIOWResName = isNullCheck($('#excelspec_' + irow).val(), 'string'),
                    iResId = parseInt(isNullCheck($('#excelresid_'+irow).val(),'number'));
                if (iResId == 0) {
                    if (sIOWResName == sresName) {
                        $("#excelresid_" + irow).val(ioldResId);
                        $('#excelnewresspec_' + irow).val(snewResName);
//                        $('#excelcode_' + irow).val('');
//                        $('#excelcode_' + irow).removeClass('error');
                        $("#excelrestypeid_" + irow).val(irestypeid);
                        if (irestypeid ==3) { $('#excelunit_' + irow).val(sWUnit) ; $("#excelunitid_" + irow).val(iWUnitId); }
                        else { $('#excelunit_' + irow).val(sUnit); $("#excelunitid_" + irow).val(iUnitId); }
//                        $(this).closest('tr').css('color','#228B22');
                        $(this).closest('tr').addClass('excelvalid');
                        $(this).closest('tr').find("input").attr("readonly", "readonly");
                    }
                }
            }
        });
    });
}
function excelHeaderUpdatetoMain(argHeader) {

    var sSlNo = argHeader['SlNo'];
    var sSpec = argHeader['Spec'];
    var iworktypeid = argHeader['WorkTypeId'];
    var iworkgroupid = argHeader['WorkGroupId'];
    var sworkgroupname = argHeader['WorkGroupName'];
    var ipiowid = argHeader['PIOWId'];

    var sWid = "0." + sSlNo;
    var sWSpec = 'New.' + sSlNo + '   ' + sSpec;
    var sparentname = sSpec;

    arryparentList.push({
        data: sWid,
        value: sWSpec,
        worktypeid: iworktypeid,
        workgroupid: iworkgroupid,
        iowid: ipiowid,
        workgroupname: sworkgroupname,
        parentname: sparentname
    });

    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function excelWGUpdateToMain(arrWG) {

    var sWGSlNo = arrWG[0]['SlNo'],
        sWGName= arrWG[0]['WGName'],
        sWGType= arrWG[0]['WGType'],
        iWGTypeId= arrWG[0]['WGTypeId'];

    var irow = 0;
    var irows =  parseInt(isNullCheck($('#newwgowid').val(),'number'));
    irow = +irows+1;
    if ($('#newwgname_'+irow).val() !="") {
        var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
        $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
    }
    $('#newwgowid').val(irow);

    $('#newwgnameslno_'+ irow).val(sWGSlNo);
    $('#newwgname_'+ irow).val(sWGName);
    $('#newwgtypename_'+ irow).val(sWGType);
    $('#newwgid_'+ irow).val(iWGTypeId);
    $('#newwgrateanal_'+ irow).val(0);
    $('#newitems').show();
    $('#butnewitems').html("New Work Group Created" + "<span class='badge'> " + irow + "</span>").show();
    var sWid = "0." + irow;
    var iworktypeid = $('#worktype_id').val();
    var sWSpec = 'New.' + irow + '   ' + sWGName;
    arryparentList.push({
        data: sWid,
        value: sWSpec,
        worktypeid: iWGTypeId,
        workgroupid: 0,
        workgroupname: sWGName,
        iowid: 0,
        parentname: ''
    });

    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function excelResourceUpdateToMain(arrRes) {

    var resname = arrRes[0]['resname'],
        resgroupid = arrRes[0]['resgroupid'],
        resgroup = arrRes[0]['resgroup'],
        resunit = arrRes[0]['resunit'],
        resunitid = arrRes[0]['resunitid'],
        wresunit = arrRes[0]['wresunit'],
        wresunitid = arrRes[0]['wresunitid'],
        restype = arrRes[0]['restype'],
        restypeid= arrRes[0]['restypeid'],
        resrate = arrRes[0]['resrate'],
        wresrate = arrRes[0]['wresrate'],
        reslead = arrRes[0]['reslead'],
        resmattype = arrRes[0]['resmattype'],
        rescode = arrRes[0]['rescode'];
    var irow = 0;
    var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
    irow = +irows+1;
    if ($('#newresname_'+irow).val() !="") {
        var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
        $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
    }
    $('#newresrowid').val(irow);

    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();

    var sWid = "0." + irow;
    var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;

    var sUnit =resunit,iUnitId=resunitid;
    if (restypeid==3) {
        sUnit =wresunit;
        iUnitId=wresunitid;
        resrate=wresrate;
    }

    arrayreslist.push({
        id: sWid,
        value: sWSpec,
        UnitName: sUnit,
        UnitId: iUnitId,
        Rate: resrate,
        data: {category:'Resource'}
    });

    arrrespicklist.push({
        ResourceId: sWid,
        TypeId: restypeid,
        UnitId: iUnitId,
        Code: 'R ' + 'New.' + irow,
        ResourceName: resname,
        UnitName: sUnit,
        TypeName: restype,
        ResourceGroup: resgroup,
        Select:0
    });


    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function rowTypeValidation() {
    var bValid=true;
    var $resnames = $('input[id*=excelrowtype_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];
        validRowType(name);
        if ($('#' + name).hasClass('error')) {
            bValid = false;
            return;
        }
        var sRowType = $.trim(isNullCheck($('#'+name).val(),'string'));
        if (sRowType == "R") {
            var iResId = parseInt(isNullCheck($('#excelresid_'+key).val(),'number'));
            if (iResId == 0) {
                var sResName = isNullCheck($('#excelspec_'+key).val(),'string');
                var arrResNew =[];
                arrResNew = getResourceDetails(sResName);
                if (arrResNew.length >0) {
                    $('#excelunit_' + key).val(arrResNew[0]['Unit']);
                    $('#excelunitid_' + key).val(arrResNew[0]['UnitId']);
                    $('#excelresid_' + key).val(arrResNew[0]['ResourceId']);
                    $('#excelrestypeid_' + key).val(arrResNew[0]['TypeId'])
                }
            }
            $('#excelrowid_' + key).addClass('excel4');
            $('#excelparent_'+key).hide();
        } else if (sRowType =="I") {
            $('#excelrowid_' + key).addClass('excel3');
        } else if (sRowType =="WG") {
            $('#excelrowid_' + key).addClass('excel1');
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
        } else if (sRowType =="H") {
            $('#excelrowid_' + key).addClass('excel2');
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
        }
    });
    return bValid;
}
function getResourceDetails(sResName) {
    var arrResNew =[];
    var objR = $.grep(arrexcelresource, function (element, index) {
        return element.value == sResName;});
    if (objR.length >0) {
        var iTypeId =objR[0]['TypeId'],
            iUnitId = 0, sUnit ='',iResId =objR[0]['data'];
        if (iTypeId ==3) {
            sUnit = objR[0]['WorkUnitName'];
            iUnitId = objR[0]['WorkUnitId'];
        } else {
            sUnit = objR[0]['UnitName'];
            iUnitId = objR[0]['UnitId'];
        }
        arrResNew.push({
            ResourceId: iResId ,
            TypeId: iTypeId,
            Unit: sUnit,
            UnitId: iUnitId
        });
    }
    return arrResNew;
}
function validRowType(id) {
    var sRowType = $.trim(isNullCheck($('#'+id).val(),'string'));
    if (sRowType =="R" || sRowType =="I" || sRowType =="H" || sRowType =="WG" ) removeError($('#' + id));
    else showError($('#' + id), 'Enter RowType');
}
$('.cnt_slider .carousel').carousel({
    interval: false
});

function findNextStep() {
    var bValid = true;
    if (iExcelStep==1) {
        bValid = fileupload();
        if (bValid == true) {
            iExcelStep = +iExcelStep+1;
            if (bexcelRowTypeFound==true) {
                bindAutoCompleteRowType();
            } else {
                iExcelStep = +iExcelStep+1;
                checkExcelResource();
                if (bexcelWGFound == true) {
                    bindexcelParentAutoComplete();
                } else {
                    iExcelStep = +iExcelStep+1;
                }
            }
        }
    } else if (iExcelStep==2) {
        bValid = rowTypeValidation();
        if (bValid == true) {
            iExcelStep = +iExcelStep+1;
            checkExcelResource();
            if (bexcelWGFound == true) {
                bindexcelParentAutoComplete();
            } else {
                iExcelStep = +iExcelStep+1;
            }
        }
    } else if (iExcelStep==3) {
        bValid  = validateexcelUnWG();
        if (bValid ==true) {
            iExcelStep = +iExcelStep + 1;
        }
    }  else if (iExcelStep==4) {
        iExcelStep = +iExcelStep + 1;
        if (bexcelResFound==false) iExcelStep = +iExcelStep + 1;
        if (bexcelUnitFound==false) iExcelStep = +iExcelStep + 1;

    } else if (iExcelStep==5) {
        bValid = nextexcelresource();
        if (bValid  == true) {
            iExcelStep = +iExcelStep + 1;
            if (bexcelUnitFound==false) iExcelStep = +iExcelStep + 1;
        }
    } else if (iExcelStep==6) {
        bValid = nextexcelunit();
        if (bValid ==true) {
            iExcelStep = +iExcelStep + 1;
        }
    }
    return bValid;
}

$('#carouselNext').click(function() {
    var bValid = true;
    var vSteps = 0;
    bValid = findNextStep();
    if (iExcelStep==2) {
        $('#divstep1').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').addClass("stepli_p2");
        vSteps = 1;
    } else if (iExcelStep==3) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').addClass("stepli_p2");
        vSteps = 2;
    } else if (iExcelStep==4) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').addClass("stepli_p2");
        $('.excel4').hide();
        vSteps = 1;
    } else if (iExcelStep==5) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').addClass("stepli_p2");
        vSteps = 3;
    }  else if (iExcelStep==6) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').addClass("stepli_p2");
        vSteps = 4;
    } else if (iExcelStep==7) {
        checkExcelSheetValid();
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#divstep6').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').removeClass("stepli_p2");
        $('#p_7').addClass("stepli_p2");
        $('#carouselNext').hide();
        $('.excel4').show();
        if (bexcelSheetValid == true) {
            $('#carouselApply').show();
            $('#divstep7').addClass('stepsep_active');
        } else {
            $('#carouselApply').hide();
        }
        vSteps = 1;
    }
    if (bValid == true) $('.cnt_slider .carousel').carousel(parseInt(vSteps));
});
function bindAutoCompleteRowType() {
    var $parent_ids = $('input[id*=excelrowtype_]');
    $parent_ids.unbind('autocomplete');
    $.each($parent_ids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $this.autocomplete({
            lookup: arrayRowType,
            showNoSuggestionNotice: false,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function (suggestion) {
                if (suggestion) {
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) $(this).addClass('error');
                else $(this).removeClass('error');
            }
        });
    });
}
function checkExcelSheetValid() {
    bexcelSheetValid=true;
    var $resspecnames = $('input[id*=excelspec_]');
    $.each($resspecnames, function (i, obj) {
        var name = $(this)[0].id;
        if (name.indexOf('__') != -1) return;
        var irow = name.split('_')[1];
        var sRowType = isNullCheck($('#excelrowtype_' + irow).val(), 'string');
        if (sRowType == "WG") {
            var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iWGTypeId == 0) { bexcelSheetValid=false; $(this).closest('tr').removeClass('excelvalid'); }
            else $(this).closest('tr').addClass('excelvalid');
        } else if (sRowType == "I") {
            var iUnitId = parseInt(isNullCheck($('#excelunitid_'+irow).val(),'number')),
                iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iUnitId ==0) {
                bexcelSheetValid=false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelunit_' + irow), 'Required');
            } else removeError($('#excelunit_' + irow));
            if (iWGTypeId == 0) {
                bexcelSheetValid = false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelparent_' + irow), 'Required');
            } else removeError($('#excelparent_' + irow));
            if (iUnitId !=0 && iWGTypeId !=0) $(this).closest('tr').addClass('excelvalid');
        } else if (sRowType == "H") {
            var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iWGTypeId == 0) {
                bexcelSheetValid = false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelparent_' + irow), 'Required');
            } else removeError($('#excelparent_' + irow));
        }
    });
}
function showPickList(id) {
    var sname = id.split('_')[0],
        key= id.split('_')[1],
        restype = "S";
    if (sname.substr(sname.length-1) == "R") restype = "R";
    $('#picklistrestype').val(restype);
    $('#picklistrow').val(key);

    checkResourcePickList(key,restype);
    bindResourcePickListGrid();
    checkIOWPickList(key,restype);
    bindIOWPickListGrid();
    $("#picklistmodal").modal('show');
}
function checkResourcePickList(key,restype) {
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + key + '_reskeyid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + key + '_reskeyid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;

            });
            return is_selected;
        });
    }
}
function checkIOWPickList(key,restype) {
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + key + '_iowkeyid_]]');
        arriowpicklistR = [];
        arriowpicklistR = $.grep(arriowpicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.IOWId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + key + '_iowkeyid_]');
        arriowpicklistR = [];
        arriowpicklistR = $.grep(arriowpicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.IOWId == $this.val()) is_selected = false;

            });
            return is_selected;
        });
    }
}

function bindResourcePickListGrid() {
    var parent = $("#respickgrid").parent();
    $("#respickgrid").remove();
    $("<div id='respickgrid'></div>").appendTo(parent);
    var source = {
        localdata:arrrespicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'ResourceId', type: 'string'},
            { name: 'TypeId', type: 'number'},
            { name: 'UnitId', type: 'number'},
            { name: 'Code', type: 'string'},
            { name: 'ResourceName', type: 'string'},
            { name: 'UnitName', type: 'string'},
            { name: 'TypeName', type: 'string'},
            { name: 'ResourceGroup', type: 'string'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'ResourceId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);

//    var dataAdapter = new $.jqx.dataAdapter(source, {
//        downloadComplete: function (data, status, xhr) { },
//        loadComplete: function (data) { },
//        loadError: function (xhr, status, error) { }
//    });


    $("#respickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'ResourceId', datafield: 'ResourceId', hidden: true},
            {text: 'TypeId', datafield: 'TypeId', hidden: true},
            {text: 'UnitId', datafield: 'UnitId', hidden: true},
            {text: 'Code', datafield: 'Code', 'editable': false, width: '15%'},
            {text: 'ResourceName', datafield: 'ResourceName', 'editable': false, width: '30%'},
            {text: 'Unit', datafield: 'UnitName', 'editable': false, width: '10%'},
            {text: 'Type', datafield: 'TypeName', 'editable': false, width: '15%'},
            {text: 'ResourceGroup', datafield: 'ResourceGroup', 'editable': false, width: '20%'},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%'}
        ]
    });
}

function bindIOWPickListGrid() {
    var parent = $("#iowpickgrid").parent();
    $("#iowpickgrid").remove();
    $("<div id='iowpickgrid'></div>").appendTo(parent);

    var source = {
        localdata:arriowpicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'IOWId', type: 'number'},
            { name: 'WorkGroupId', type: 'number'},
            { name: 'WorkTypeId', type: 'number'},
            { name: 'SerialNo', type: 'string'},
            { name: 'WorkGroupName', type: 'string'},
            { name: 'WorkTypeName', type: 'string'},
            { name: 'Specification', type: 'string'},
            { name: 'Header', type: 'number'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'IOWId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);
//    var columnsrenderer = function (value) {
//        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
//    }

    $("#iowpickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'IOWId', datafield: 'IOWId', hidden: true},
            {text: 'WorkGroupId', datafield: 'WorkGroupId', hidden: true},
            {text: 'WorkTypeId', datafield: 'WorkTypeId', hidden: true},
            {text: 'WorkTypeName', datafield: 'WorkTypeName', hidden: true},
            {text: 'Header', datafield: 'Header', hidden: true},
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '15%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    return slNo;
                }},
            {text: 'WorkGroup', datafield: 'WorkGroupName', 'editable': false, width: '20%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    return slNo;
                }},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '55%',cellsrenderer: function (row) {
                var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),spec="";
                if (iHeader ==1)  spec = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                else spec ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                return spec;
            }},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%',
                cellbeginedit: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader==1) return false;
                    else return true;
                }
            }
        ]
    });
}
function updatefromPickList() {
    $('.loading_area').show();
    var resType = $('#picklistrestype').val(),
        key1 = isNullCheck($('#picklistrow').val(),'number'),
        sName = "#rateanal_" + key1;
    if (resType =="R") sName = "#rateanalR_" + key1;
    var rows = $('#respickgrid').jqxGrid('getrows'),iResourceId= 0,sCode="",sResName="",sSpec="";
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#rowinfoid_' + key1).val();
            if (resType =="R") key2 = $('#rowinfoidR_' + key1).val();

            iResourceId = rows[i]['ResourceId'];
            sCode = rows[i]['Code'];
            sResName = rows[i]['ResourceName'];
            sSpec = sCode + '   ' + sResName;

            $(sName + '_resid_' + key2).val(sSpec);
            $(sName + '_reskeyid_' + key2).val(iResourceId);
            $(sName + '_iowkeyid_' + key2).val(0);
            $(sName + "_type_" + key2).val('R');
            cboResChanged(iResourceId, key1, key2, resType);
            if (resType =="R") AddNewRowResR(key1,key2);
            else AddNewRowRes(key1,key2);
        }
    }
    var rows = $('#iowpickgrid').jqxGrid('getrows'),iiowid= 0,sCode="",sSpecName="",sSpec="";
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#rowinfoid_' + key1).val();
            if (resType =="R") key2 = $('#rowinfoidR_' + key1).val();

            iiowid = rows[i]['IOWId'];
            sCode = rows[i]['SerialNo'];
            sSpecName = rows[i]['Specification'];
            sSpec = sCode + '   ' + sSpecName;

            $(sName + '_resid_' + key2).val(sSpec);
            $(sName + '_reskeyid_' + key2).val(0);
            $(sName + '_iowkeyid_' + key2).val(iiowid);
            $(sName + "_type_" + key2).val('I');
            $(sName + '_resid_' + key2).prop('disabled', true);
            cboIOWChanged(iiowid, key1, key2, resType);

            cboResChanged(iResourceId, key1, key2, resType);
            if (resType =="R") AddNewRowResR(key1,key2);
            else AddNewRowRes(key1,key2);
        }
    }
    $('#picklistmodal').modal('toggle');
    $('.loading_area').hide();
}
</script>