<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<style>
    .popuptable table tr th{background:#E2EBEF!important;padding:5px;border-right:2px solid #5D9BB6;}
    .popuptable table tr th input[type=text]{ font-size:14px; font-weight:600; color:#333}
    .popuptable table tr tr{border-bottom:1px solid #dcdbdb; width:100%;}
    .popuptable table{border:1px solid #c2c2c2;}
    .fix-tabletops{/* float:left;*/ width:140%; min-height:200px; max-height:500px; overflow:auto;}
    .fixTable thead tr th{ z-index:999!important; border-bottom:2px solid #4977AA;}
    .popuptable-topfix{ width:100%; }
    @media only screen and (max-width:1024px) {
        .popuptable-topfixs {
            width: 132% !important;
        }
    }
    .ad-btn{background:#3399ff; text-shadow: 0 0 1px #546082;right:25px;text-align: center;padding-top: 2px; box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff; width:25px; height:25px; border-radius:50%; color:#fff; position:absolute}
    #respickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #respickgrid .jqx-checkbox {border:1px solid;}
</style>
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form action="" onsubmit="return entryValidate()"  method="post">
<input type="hidden" name="rfcUId" id="rfcUId" value="<?php echo $rfcid;?>">
<input type="hidden" name="rfcmode" id="rfcmode" value="<?php echo $mode;?>">
<input type="hidden" name="editid" id="editid" value="<?php echo $editid;?>">
<input type="hidden" name="codegenType" id="codegenType" value="<?php echo $codegenType;?>">
<input type="hidden" name="groupcodegenType" id="groupcodegenType" value="<?php echo $groupcodegenType;?>">
<?php if (isset($rfctrans) && $editid != 0):?>
    <input type="hidden" name="rfcregisterid" id="rfcregisterid" value="<?php echo $rfctrans[0]['RFCRegisterId'];?>">
<?php endif; ?>
<div class="col-lg-12 page_tittle">
    <h1>Request for creation - Resource <?php echo ($mode != 'edit') ?  'Add' : 'Edit';?></h1>
</div>
<div class="col-lg-12 clear padlr0">
    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-6">
        <div class="col-lg-offset-1">
            <label for="refno" class="bk_lbl bk_lbl_inpt splcharc">Reference No <span class="colon_r">:</span></label>
            <input type="text" class="bk_lbl_inpt inputbg_ef bk_inpt1 splcharc" name="refno" data-bsfshare="refno" id="refno" onchange="" value="<?php  if ($rfcid!=0) { echo $rfcregister['RefNo'];}  else { echo $svNo; } ?>" <?php if ($genType==true) { ?> readonly <?php } ?> />
        </div>
    </div>
    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6 ">
        <div class="col-lg-offset-6">
            <div class="col-lg-12">
                <label for="refdate" class="bk_lbl bk_lbl_inpt"><span class="bkspan_calendar"><i class="fa fa-calendar-o"></i></span> Reference Date <span class="colon_r">:</span></label>
                <input type="text" class="date_picker bk_lbl_inpt no_bg bk_inpt inputbg_ef" name="refdate" data-bsfshare="refdate" readonly id="refdate" onchange="validateDate(this);" value="<?php if ($rfcid!=0)  { echo date("d-m-Y", strtotime($rfcregister['RefDate']));} else { echo date('d-m-Y');}?>" />
            </div>
        </div>
    </div>
</div>

<!--table Jq Gride start-->
<div class="col-lg-12 col-lg-offset-0 padtop20" <?php echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? 'style="display: none"': '';?> id="edit-list">
    <div class="col-lg-12 clear">
        <div class="table-responsive clear">
            <div id='jqxWidget'>
                <div id="grid"></div>
            </div>
        </div>
    </div>
</div>
<div class="col-lg-12 col-lg-offset-0 padtop20" <?php echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? '': 'style="display: none"';?> id="edit-content">
<div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
<table class="table" style=" margin-bottom:0px; <?php ($mode =='edit' || $editid ==0 || $rfcid ==0) ? 'display: none;' : '' ?>" id="sample12">
<thead>
<tr class="popuptable-topfix">
    <th <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?> width="3%">Code</th>
    <th width="11%">Resource Name</th>
    <th width="11%">Resource Group</th>
    <th width="5%">Type Name</th>
    <th width="5%">Unit</th>
    <th width="5%">Rate</th>
    <th width="4%">&nbsp;</th>
</tr>
</thead>
<tbody class="demo" style="overflow-y:scroll; min-height:100%; max-height:350px;">
<?php $i=0;
if (isset($rfctrans)):
    foreach($rfctrans as $trans):
        if ($rfcid !=0) $rfctransid = $trans['RFCTransId'];
        else $rfctransid = $trans['ResourceId'];
        $i=$i+1; ?>
        <tr id="ResourceiRowId_<?php echo $i; ?>">
            <td width="3%" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>><input class="parent_text" name="code_<?php echo $i ?>" value = "<?php echo $trans['Code'];?>" onblur="return CheckResCode(this.id)" id="code_<?php echo $i ?>"/></td>
            <td width="11%" align="center"><textarea class="parent_texts" name="resname_<?php echo $i ?>" id="resname_<?php echo $i ?>" autocomplete="off" onblur="return CheckResName(this.id)"><?php echo $trans['ResourceName'];?></textarea></td>
            <td width="11%"><input type="text" class="parent_text" name="resgroupname_<?php echo $i ?>" id ="resgroupname_<?php echo $i ?>" value = "<?php echo $trans['ResourceGroupName'];?>" onblur="return CheckSuggestionId(this, 'resgroupid')" readonly></td>
            <td width="5%"><input class="parent_text" type="text" name="typename_<?php echo $i ?>" value = "<?php echo $trans['TypeName'];?>" id="typename_<?php echo $i ?>" readonly/></td>
            <td width="5%"><input type="text" class="parent_text" name="unitname_<?php echo $i; ?>" id="unitname_<?php echo $i; ?>" value = "<?php echo $trans['UnitName'];?>" onblur="return CheckUnitValid(this.id)"></td>
            <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rate_<?php echo $i ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['Rate'],2,true);?>" id="rate_<?php echo $i ?>" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onfocus="return clickExpandTr(this.id)" <?php  echo $trans['TypeId'] ==4 ?  'readonly' : ''; ?>/></td>
            <input type="hidden" name="typeid_<?php echo $i ?>" value = "<?php echo $trans['TypeId'];?>" id="typeid_<?php echo $i ?>">
            <input type="hidden" name="unitid_<?php echo $i ?>" id ="unitid_<?php echo $i ?>" value="<?php echo $trans['UnitId'];?>">
            <input type="hidden" name="resgroupid_<?php echo $i ?>" id ="resgroupid_<?php echo $i ?>" value="<?php echo $trans['ResourceGroupId'];?>">
            <input type="hidden" name="resourceid_<?php echo $i ?>" id ="resourceid_<?php echo $i ?>" value="<?php echo $trans['ResourceId'];?>">
            <td width="4%">
                <ul class="action_btns">
                    <li>
                        <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a>
                    </li>
                    <?php if($trans['TypeId'] != '1'): ?>
                        <li>
                            <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
                        </li>
                    <?php endif; ?>
                </ul>
            </td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr_<?php echo $i ?> paintTr">
        <td colspan="12"><div class="subDiv" style="display:none;" >
        <?php if($trans['TypeId'] == '4'): ?>
            <!-- Activity SubDiv -->
            <div class="darkmenu">
                <ul>
                    <li class="active" id="manual_tab_<?php echo $i ?>"><a href="javascript:showmix('manual', '#manual_tab_<?php echo $i ?>')"><i class="fa fa-magic"></i> Manual</a></li>
                    <li id="machinery_tab_<?php echo $i ?>"><a href="javascript:showmix('machinery', '#machinery_tab_<?php echo $i ?>')"><i class="fa fa-cogs"></i> Machinery</a></li>
                </ul>
                <div class="lstate manual_mac">
                    <ul>
                        <li>
                            <label>LS Rate</label>
                            <input type="text" class="text-right" maxlength="15" name="analrateLS_<?php echo $i ?>" id="analrateLS_<?php echo $i ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['LRate'],2,true);?>" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onkeyup="bindRate('analrateLS_<?php echo $i ?>')"/>
                        </li>
                        <li>
                            <label>Manual Rate</label>
                            <input type="text" class="text-right" maxlength="15" name="analrateM_<?php echo $i ?>" id="analrateM_<?php echo $i ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['MRate'],2,true);?>" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li>
                            <label>Machinery Rate</label>
                            <input type="text" class="text-right" maxlength="15" name="analrateA_<?php echo $i ?>" id="analrateA_<?php echo $i ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['ARate'],2,true);?>" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li>
                            <label>Rate Type</label>
                            <div class="select-style select-inline">
                                <select name="analrate_<?php echo $i ?>" id ="analrate_<?php echo $i ?>" onchange="return MainRateUpdate()">
                                    <option value="L" <?php echo ($trans['RateType'] == 'L') ? 'selected' : '';?>>LS </option>
                                    <option value="M" <?php echo ($trans['RateType'] == 'M') ? 'selected' : '';?>>Manual </option>
                                    <option value="A" <?php echo ($trans['RateType'] == 'A') ? 'selected' : '';?>>Machinery </option>
                                </select>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12 clear">
                <div id="activityWQty_<?php echo $i ?>">
                    <label class="lbl_style">Working Qty</label>
                    <input type="text" class="parent_texters work_qt text-right" maxlength="15" name="activity_<?php echo $i ?>_AnalQty" id="activity_<?php echo $i ?>_AnalQty" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['AnalysisMQty'],3);?>" onkeypress="return isDecimal(event,this)" onchange="ChangeWorkQty(this.id)">
                    <a class="ad-btn" href="javascript:void(0);" id="activity_<?php echo $i; ?>_PickList" onclick="showPickList(this.id)" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a>
                </div>
                <div id="activityWQtyR_<?php echo $i ?>" style="display: none;">
                    <label class="lbl_style">Working Qty</label>
                    <input type="text" class="parent_texters work_qt text-right" maxlength="15" name="activityR_<?php echo $i ?>_AnalQty" id="activityR_<?php echo $i ?>_AnalQty" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['AnalysisAQty'],3);?>" onkeypress="return isDecimal(event,this)" onchange="ChangeWorkQty(this.id)">
                    <a class="ad-btn" href="javascript:void(0);" id="activityR_<?php echo $i; ?>_PickList" onclick="showPickList(this.id)" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                </div>
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
                    <!-- Manual tabs -->
                    <table class="table" style="margin-bottom:0px; margin-top:8px;" id="activity_<?php echo $i ?>_restable">
                        <thead>
                        <tr class="popuptable-topfixs">
                            <th class="bg_clo_subTr" width="21%">Resource name</th>
                            <th class="bg_clo_subTr" width="5%">Unit</th>
                            <th class="bg_clo_subTr" width="5%">Qty</th>
                            <th class="bg_clo_subTr" width="5%">Rate</th>
                            <th class="bg_clo_subTr" width="8%">Amount</th>
                            <th class="bg_clo_subTr text-center" width="4%">&nbsp;</th>
                        </tr>
                        </thead>

                        <tbody class="sorting fix-tabletops">
                        <?php $j=0; $total=0;
                        if(isset($rfcactivity)):
                            foreach($rfcactivity as $curanal):
                                if ($rfcid !=0) $rfcrestransid = $curanal['RFCTransId'];
                                else $rfcrestransid = $curanal['MResourceId'];
                                if($curanal['ActivityType'] != 'M' || $rfctransid != $rfcrestransid)
                                    continue;
                                $j = $j+1; ?>
                                <tr id="activity_<?php echo $i ?>_RowId_<?php echo $j ?>" >
                                    <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activity_<?php echo $i ?>_resname_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resname_<?php echo $j ?>" value="<?php echo $curanal['Code'].' '.$curanal['ResourceName'];?>" onfocus="return CheckResourceFocus(this.id,'')" readonly autocomplete="off"></td>
                                    <td width="5%"><label for="activity_<?php echo $i ?>_resunit_<?php echo $j ?>"><?php echo $curanal['UnitName'];?></label></td>
                                    <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resqty_<?php echo $j ?>" id="activity_<?php echo $i ?>_resqty_<?php echo $j ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($curanal['Qty'],3);?>" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"></td>
                                    <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resrate_<?php echo $j ?>" id="activity_<?php echo $i ?>_resrate_<?php echo $j ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($curanal['Rate'],2,true);?>" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly></td>
                                    <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resamt_<?php echo $j ?>" id="activity_<?php echo $i ?>_resamt_<?php echo $j ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($curanal['Amount'],2,true);?>" readonly="" onkeypress="return isDecimal(event,this)"></td>
                                    <td width="4%">
                                        <ul class="action_btns">
                                            <li>
                                                <a id="activity_<?php echo $i ?>_resdel_<?php echo $j ?>" href="javascript:DeleteResource('activity_<?php echo $i ?>_RowId_<?php echo $j ?>')"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="left" data-original-title="Delete"></i></a>
                                            </li>
                                        </ul>
                                    </td>
                                    <input type="hidden" name="activity_<?php echo $i ?>_newresname_<?php echo $j ?>" id ="activity_<?php echo $i ?>_newresname_<?php echo $j ?>" value="<?php echo $curanal['ResourceName'];?>">
                                    <input type="hidden" name="activity_<?php echo $i ?>_formula_<?php echo $j ?>" id="activity_<?php echo $i ?>_formula_<?php echo $j ?>">
                                    <input type="hidden" name="activity_<?php echo $i ?>_resid_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resid_<?php echo $j ?>" value="<?php echo $curanal['ResourceId'];?>">
                                    <input type="hidden" name="activity_<?php echo $i ?>_resunitid_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resunitid_<?php echo $j ?>" value="<?php echo $curanal['UnitId'];?>">
                                    <input type="hidden" name="activity_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="activity_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                                </tr>
                                <?php $total += $curanal['Amount'];
                            endforeach; endif;  $j = $j+1; ?>
                        <tr id="activity_<?php echo $i ?>_RowId_<?php echo $j ?>">
                            <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activity_<?php echo $i ?>_resname_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resname_<?php echo $j ?>" value="" onfocus="return CheckResourceFocus(this.id,'')" autocomplete="off"></td>
                            <td width="5%"><label for="activity_<?php echo $i ?>_resunit_<?php echo $j ?>"></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resqty_<?php echo $j ?>" id="activity_<?php echo $i ?>_resqty_<?php echo $j ?>" value="" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resrate_<?php echo $j ?>" id="activity_<?php echo $i ?>_resrate_<?php echo $j ?>" value="" align="right" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly></td>
                            <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activity_<?php echo $i ?>_resamt_<?php echo $j ?>" id="activity_<?php echo $i ?>_resamt_<?php echo $j ?>" value="" align="right" readonly="" onkeypress="return isDecimal(event,this)"></td>
                            <td width="4%">
                                <ul class="action_btns">
                                    <li>
                                        <a id="activity_<?php echo $i ?>_resdel_<?php echo $j ?>" href="javascript:DeleteResource('activity_<?php echo $i ?>_RowId_<?php echo $j ?>')" style="display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                            <input type="hidden" name="activity_<?php echo $i ?>_newresname_<?php echo $j ?>" id ="activity_<?php echo $i ?>_newresname_<?php echo $j ?>" value="">
                            <input type="hidden" name="activity_<?php echo $i ?>_formula_<?php echo $j ?>" id="activity_<?php echo $i ?>_formula_<?php echo $j ?>">
                            <input type="hidden" name="activity_<?php echo $i ?>_resid_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resid_<?php echo $j ?>" value="">
                            <input type="hidden" name="activity_<?php echo $i ?>_resunitid_<?php echo $j ?>" id ="activity_<?php echo $i ?>_resunitid_<?php echo $j ?>" value="">
                            <input type="hidden" name="activity_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="activity_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        </tr>
                        </tbody>
                        <tbody class="total">
                        <tr style="border-bottom:none;">
                            <td colspan="3" style="border-right:none;border-top:none;">&nbsp;</td>
                            <td style="border-right:none;vertical-align: middle;" class="rate_pri" align="right"><label id="activity_<?php echo $i ?>_ltotrate">Total</label></td>
                            <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activity_<?php echo $i ?>_totrate" id="activity_<?php echo $i ?>_totrate" value="<?php echo $this->commonHelper()->sanitizeNumber($total,2,true);?>"  readonly></td>
                            <td style="border-right:none;">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">

                            <td colspan="3" style="border-right:none;border-top:none;">&nbsp;</td>
                            <td style="border-right:none;border-top:none; vertical-align: middle;" class="rate_pri" align="right"><label id="activity_<?php echo $i ?>_lperrate">Rate Per Unit</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activity_<?php echo $i ?>_perrate" id="activity_<?php echo $i ?>_perrate" value="<?php echo $this->commonHelper()->sanitizeNumber($total,2,true);?>"  readonly></td>
                            <td style="border-right:none;border-top:none;">&nbsp;</td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="rowinfoid_<?php echo $i ?>" id="rowinfoid_<?php echo $i ?>" value="<?php echo $j; ?>">
                    <!-- Machinery tabs -->
                    <table class="table" style="display: none;margin-bottom:0px; margin-top:8px;" id="activityR_<?php echo $i ?>_restable">
                        <thead>
                        <tr class="popuptable-topfixs">
                            <th class="bg_clo_subTr" width="21%">Resource name</th>
                            <th class="bg_clo_subTr" width="5%">Unit</th>
                            <th class="bg_clo_subTr" width="5%">Qty</th>
                            <th class="bg_clo_subTr" width="5%">Rate</th>
                            <th class="bg_clo_subTr" width="8%">Amount</th>
                            <th class="bg_clo_subTr text-center" width="4%">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody class="sorting fix-tabletops">
                        <?php $j=0; $total=0;
                        if(isset($rfcactivity)):
                            foreach($rfcactivity as $curanal):
                                if ($rfcid !=0) $rfcrestransid = $curanal['RFCTransId'];
                                else $rfcrestransid = $curanal['MResourceId'];
                                if($curanal['ActivityType'] != 'A' || $rfctransid != $rfcrestransid)
                                    continue;
                                $j = $j+1; ?>
                                <tr id="activityR_<?php echo $i ?>_RowId_<?php echo $j ?>">
                                    <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activityR_<?php echo $i ?>_resname_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resname_<?php echo $j ?>" value="<?php echo $curanal['Code'].' '.$curanal['ResourceName'];?>" onfocus="return CheckResourceFocus(this.id,'R')" readonly autocomplete="off"></td>
                                    <td width="5%"><label for="activityR_<?php echo $i ?>_resunit_<?php echo $j ?>"><?php echo $curanal['UnitName'];?></label></td>
                                    <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resqty_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resqty_<?php echo $j ?>" value="<?php echo $curanal['Qty'];?>" align="right" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onfocus="return showformulaR(this.id)" onkeydown="return showF(this.id,event)" onchange="return ValueChangeR(this.id)"></td>
                                    <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resrate_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resrate_<?php echo $j ?>" value="<?php echo $curanal['Rate'];?>" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChangeR(this.id)" readonly></td>
                                    <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resamt_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resamt_<?php echo $j ?>" value="<?php echo $curanal['Amount'];?>" align="right" onkeypress="return isDecimal(event,this)" readonly=""></td>
                                    <td width="4%">
                                        <ul class="action_btns">
                                            <li>
                                                <a id="activityR_<?php echo $i ?>_resdel_<?php echo $j ?>" href="javascript:DeleteResourceR('activityR_<?php echo $i ?>_RowId_<?php echo $j ?>')"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                            </li>
                                        </ul>
                                    </td>
                                    <input type="hidden" name="activityR_<?php echo $i ?>_newresname_<?php echo $j ?>" id ="activityR_<?php echo $i ?>_newresname_<?php echo $j ?>" value="<?php echo $curanal['ResourceName'];?>">
                                    <input type="hidden" name="activityR_<?php echo $i ?>_formula_<?php echo $j ?>" id="activityR_<?php echo $i ?>_formula_<?php echo $j ?>">
                                    <input type="hidden" name="activityR_<?php echo $i ?>_resid_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resid_<?php echo $j ?>" value="<?php echo $curanal['ResourceId'];?>">
                                    <input type="hidden" name="activityR_<?php echo $i ?>_resunitid_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resunitid_<?php echo $j ?>" value="<?php echo $curanal['UnitId'];?>">
                                    <input type="hidden" name="activityR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="activityR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                                </tr>
                                <?php $total += $curanal['Amount'];
                            endforeach; endif; $j = $j+1;?>
                        <tr id="activityR_<?php echo $i ?>_RowId_<?php echo $j ?>">
                            <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activityR_<?php echo $i ?>_resname_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resname_<?php echo $j ?>" value="" onfocus="return CheckResourceFocus(this.id,'R')" autocomplete="off"></td>
                            <td width="5%"><label for="activityR_<?php echo $i ?>_resunit_<?php echo $j ?>"></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resqty_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resqty_<?php echo $j ?>" value="" align="right" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onfocus="return showformulaR(this.id)" onkeydown="return showF(this.id,event)" onchange="return ValueChangeR(this.id)"></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resrate_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resrate_<?php echo $j ?>" value="" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChangeR(this.id)" readonly></td>
                            <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR_<?php echo $i ?>_resamt_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resamt_<?php echo $j ?>" value="" align="right" onkeypress="return isDecimal(event,this)" readonly=""></td>
                            <td width="4%">
                                <ul class="action_btns">
                                    <li>
                                        <a id="activityR_<?php echo $i ?>_resdel_<?php echo $j ?>" href="javascript:DeleteResourceR('activityR_<?php echo $i ?>_RowId_<?php echo $j ?>')" style="display: none;"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                            <input type="hidden" name="activityR_<?php echo $i ?>_newresname_<?php echo $j ?>" id ="activityR_<?php echo $i ?>_newresname_<?php echo $j ?>" value="">
                            <input type="hidden" name="activityR_<?php echo $i ?>_formula_<?php echo $j ?>" id="activityR_<?php echo $i ?>_formula_<?php echo $j ?>">
                            <input type="hidden" name="activityR_<?php echo $i ?>_resid_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resid_<?php echo $j ?>" value="">
                            <input type="hidden" name="activityR_<?php echo $i ?>_resunitid_<?php echo $j ?>" id="activityR_<?php echo $i ?>_resunitid_<?php echo $j ?>" value="">
                            <input type="hidden" name="activityR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="activityR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        </tr>
                        </tbody>
                        <tbody class="total fix-tabletops">
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;" width="21%"></td>
                            <td style="border-right:none;" width="5%"></td>
                            <td style="border-right:none;" width="5%"></td>
                            <td style="border-right:none;  color:#1d99d4; vertical-align: middle; " align="right" width="5%"><label id="activityR_<?php echo $i ?>_ltotrate">Total</label></td>
                            <td style="border-right:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityR_<?php echo $i ?>_totrate" id="activityR_<?php echo $i ?>_totrate"  value="<?php echo $total;?>" onkeypress="return isDecimal(event,this)" readonly=""></td>
                            <td style="border-right:none;" width="4%">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;border-top:none;" width="21%"></td>
                            <td style="border-right:none;border-top:none;" width="5%"></td>
                            <td style="border-right:none;border-top:none;" width="5%"></td>
                            <td style="border-right:none;border-top:none; color:#1d99d4; vertical-align: middle; " align="right" width="5%"><label id="activityR_<?php echo $i ?>_lperrate">Rate Per Unit</label></td>
                            <td style="border-right:none;border-top:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityR_<?php echo $i ?>_perrate" id="activityR_<?php echo $i ?>_perrate" value="<?php echo $total;?>" onkeypress="return isDecimal(event,this)" readonly=""></td>
                            <td style="border-right:none;border-top:none;" width="4%">&nbsp;</td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="rowinfoidR_<?php echo $i ?>" id="rowinfoidR_<?php echo $i ?>" value="<?php echo $j; ?>">
                </div>
            </div>
        <?php elseif($trans['TypeId'] == '3'): ?>
            <!-- Asset SubDiv -->
            <div id="generalinfo_<?php echo $i ?>">
                <div class="rfc_met">
                    <ul>
                        <li>
                            <label>Working Unit</label>
                            <input type="text" id="generalinfo_<?php echo $i ?>_wunitname" value="<?php echo $trans['WorkUnitName'];?>">
                            <input type="hidden" name="generalinfo_<?php echo $i ?>_wunit" id="generalinfo_<?php echo $i ?>_wunit" value="<?php echo $trans['WorkUnitId'];?>"/>
                        </li>

                        <li>
                            <label>Working Rate</label>
                            <input type="text" class="text-right" maxlength="15" name="generalinfo_<?php echo $i ?>_wrate" id="generalinfo_<?php echo $i ?>_wrate" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" value="<?php echo $trans['WorkRate'];?>">
                        </li>
                        <li>
                            <label>Lead Time (in Days)</label>
                            <input type="text" name="generalinfo_<?php echo $i ?>_lead" maxlength="3" id="generalinfo_<?php echo $i ?>_lead" onkeypress="return isDecimal(event,this)" value="<?php echo $trans['LeadDays'];?>">
                        </li>
                    </ul>
                </div>
            </div>
        <?php elseif($trans['TypeId'] == '2'): ?>
            <!-- Material SubDiv -->
            <div id="general_<?php echo $i ?>">
                <div class="rfc_met">
                    <ul>
                        <li>
                            <label>Material Type</label>
                            <div class="select-style rfc_meoption">
                                <select name="generalinfo_<?php echo $i ?>_mtype" id ="generalinfo_<?php echo $i ?>_mtype" <?php if (!empty($rfcsteel)) { echo 'disabled'; } ?>  onchange="return MaterialTypeChange(this.value, 'steel_<?php echo $i ?>')">
                                    <option value="G" <?php echo ($trans['MaterialType'] == "G" || $trans['MaterialType'] == "") ? 'selected' : '';?>>General</option>
                                    <option value="F" <?php echo ($trans['MaterialType'] == "F") ? 'selected' : '';?>>Fuel</option>
                                    <option value="S" <?php echo ($trans['MaterialType'] == "S") ? 'selected' : '';?>>Steel</option>
                                    <option value="P" <?php echo ($trans['MaterialType'] == "P") ? 'selected' : '';?>>Production</option>
                                </select>
                                <input type="hidden" name="mtype_<?php echo $i ?>" id="mtype_<?php echo $i ?>" value="<?php echo $trans['MaterialType']; ?>">
                            </div>
                        </li>
                        <li>
                            <label>Lead Time (in Days)</label>
                            <input type="text" maxlength="3" name="generalinfo_<?php echo $i ?>_lead" id="generalinfo<?php echo $i ?>_lead" onkeypress="return isDecimal(event,this)" value="<?php echo $trans['LeadDays'];?>">
                        </li>
                    </ul>
                </div>
                <div class="col-lg-12" id="steel_<?php echo $i ?>" style="<?php if ($trans['MaterialType'] != "S") { echo 'display: none'; } else { echo ''; } ?>">
                    <h2>Steel Directory</h2>
                    <table class="table">
                        <thead>
                        <tr>
                            <th class="bg_clo">Steel Description</th>
                            <th class="bg_clo">Diameter</th>
                            <th class="bg_clo">Factor/Unit</th>
                            <th class="bg_clo">Wastage %</th>
                            <th class="bg_clo text-center">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php $j=0;
                        foreach($rfcsteel as $steel):
                            if($rfctransid != $steel['RFCTransId'])
                                continue;
                            $j = $j+1;?>
                            <tr id="steel_<?php echo $i ?>_RowId_<?php echo $j ?>">
                                <td width="11%"><input type="text" maxlength="100" class="parent_text" name="steel_<?php echo $i ?>_des_<?php echo $j ?>" id="steel_<?php echo $i ?>_steeldes_<?php echo $j ?>" value="<?php echo $steel['SteelDescription'];?>" onblur="checkSteelDescription(this.id)" onkeyup="AddNewsteelRow('steel_<?php echo $i ?>_RowId_<?php echo $j ?>')"></td>
                                <td width="5%"><input type="text" maxlength="10" class="parent_text text-right" name="steel_<?php echo $i ?>_dia_<?php echo $j ?>" id="steel_<?php echo $i ?>_dia_<?php echo $j ?>" value="<?php echo $steel['SteelDia'];?>" onkeypress="return isDecimal(event, this)" onblur="checkSteeldia(this.id)" onkeyup="AddNewsteelRow('steel_<?php echo $i ?>_RowId_<?php echo $j ?>')"></td>
                                <td width="5%"><input type="text" maxlength="10" class="parent_text text-right" name="steel_<?php echo $i ?>_factor_<?php echo $j ?>" id="steel_<?php echo $i ?>_factor_<?php echo $j ?>" value="<?php echo $steel['Factor'];?>" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel_<?php echo $i ?>_RowId_<?php echo $j ?>')"></td>
                                <td width="5%"><input type="text" maxlength="6" class="parent_text text-right" name="steel_<?php echo $i ?>_waste_<?php echo $j ?>" id="steel_<?php echo $i ?>_waste_<?php echo $j ?>" value="<?php echo $steel['Wastage'];?>" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel_<?php echo $i ?>_RowId_<?php echo $j ?>')"></td>
                                <td width="2%">
                                    <ul class="action_btns">
                                        <li>
                                            <a id="steel_<?php echo $i ?>_delrow_<?php echo $j ?>" href="javascript:void(0);"  onclick = "DeleteSteelRow(this.id)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                    <input type="hidden" name="rowinfoidS_<?php echo $i ?>" id="rowinfoidS_<?php echo $i ?>" value="1">
                </div>
            </div>
        <?php endif; ?>
        </div></td>
        </tr>
    <?php endforeach; $i=$i+1;
endif; ?>
<?php if ($i==0) $i=$i+1;?>
<?php if ($editid==0) { ?>
    <tr id="ResourceiRowId_<?php echo $i; ?>">
        <td width="3%" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>><input class="parent_text" name="code_<?php echo $i ?>" onblur="return CheckResCode(this.id)" id="code_<?php echo $i ?>" /></td>
        <td width="11%" align="center"><textarea class="parent_texts" name="resname_<?php echo $i ?>" id="resname_<?php echo $i ?>" autocomplete="off" onblur="return CheckResName(this.id)"></textarea></td>
        <td width="11%"><input type="text" class="parent_text" name="resgroupname_<?php echo $i ?>" id ="resgroupname_<?php echo $i ?>" onblur="return CheckSuggestionId(this, 'resgroupid')"></td>
        <td width="5%"><input class="parent_text" type="text" name="typename_<?php echo $i ?>" id="typename_<?php echo $i ?>" readonly/></td>
        <td width="5%"><input type="text" class="parent_text" name="unitname_<?php echo $i; ?>" id="unitname_<?php echo $i; ?>" onblur="return CheckUnitValid(this.id)"></td>
        <td width="5%"><input class="parent_text text-right" maxlength="15"  type="text" name="rate_<?php echo $i ?>" id="rate_<?php echo $i ?>" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onfocus="return clickExpandTr(this.id)" readonly/></td>
        <input type="hidden" name="typeid_<?php echo $i ?>" id="typeid_<?php echo $i ?>">
        <input type="hidden" name="unitid_<?php echo $i ?>" id ="unitid_<?php echo $i ?>">
        <input type="hidden" name="resgroupid_<?php echo $i ?>" id ="resgroupid_<?php echo $i ?>">
        <input type="hidden" name="ressourceid_<?php echo $i ?>" id ="ressourceid_<?php echo $i ?>">
        <td width="4%">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a>
                </li>
                <li>
                    <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
                </li>
            </ul>
        </td>
    </tr>
    <!--expand table-->
    <tr style="display:none;" class="subTr_<?php echo $i ?> paintTr"></tr>
<?php } ?>
<tr class="remarks">
    <td colspan="7"><textarea placeholder="Enter Remarks" class="remrk element" maxlength="255" name="narration" id="narration" title="Remarks" onfocus="inputFocus(this)" onblur="inputBlur(this)"><?php if(isset($rfcregister['Narration'])) echo $rfcregister['Narration'];?></textarea></td>
</tr>

</tbody>
</table>
<input type="hidden" name="rowid" id="rowid" value="<?php echo $i; ?>">
</div>
<div class="clearfix"></div>
<div id="divununit" style="display: none">
    <a href="javascript:void(0);" id ="butnewunit" class="btn btn-link" onclick="return unitShow(event)" >Undefined Units</a>
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r" id="submit-btn" style="<?php if ($rfcid !=0) { if ($rfcregister['Approve']=='Y') { echo 'display: none;'; } else { echo '';} }?>"><a href="javascript:submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
        <li class="dropdown save_btn float_r" id="next-btn" style="<?php echo ($mode!='edit' || $editid !=0 || $rfcid !=0) ? 'display: none;' : '';?>"><a href="javascript:nextresource();" data-toggle="tooltip" class="ripple" title="Go to next!">Next</a></li>
        <li class="can_btn float_l" style="padding-bottom:10px;"><a href="<?php if ($rfcid !=0) { echo $this->basePath().'/project/rfc/rfcregister'; } else if ($editid !=0) {echo $this->basePath().'/project/main/resourcemaster';}  else { echo $this->basePath().'/project/rfc/rfc-what';}?>">Cancel</a></li>
        <!--                <li class="cancel_btn float_r" id="back-btn" style="--><?php //echo ($mode=='edit' && ( $editid !=0 || $rfcid !=0)) ? '' : 'display: none;';?><!--"><a href="javascript:backButton();" data-toggle="tooltip" class="ripple" title="Cancel">Back</a></li>-->
    </ul>
    <table  id="newresitems" style="display: none;">
        <tr>
            <!-- <td > <button type="button" id ="butnewresitems" class="btn btn-info btn-xs" > Resource </button> </td> -->
            <td ><a href="javascript:void(0);" id ="butnewresitems" class="btn btn-link" onclick="return ShowNewResource(event)" >New Resource Created</a></td>
        </tr>
        <tr >
            <table class="table" id="newres" style="display: none; width:50%;border:1px solid #ccc;">
                <thead>
                <tr>
                    <th style="border-right:1px solid #ccc;">Resource Name</th>
                    <th style="border-right:1px solid #ccc;">Type</th>
                    <th class="text-center">&nbsp;</th>
                </tr>
                </thead>
                <tbody class="sorting">
                <tr>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresname_1" value = "" id="newresname_1" align="right" readonly></td>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newrestype_1" value = "" id="newrestype_1" align="right" readonly></td>
                    <td width="3%"><button type="button" name="newresdetails_1" value = "Show Details" id="newresdetails_1" onclick="return ShowResource(this.id)" style="margin:0;background-color: transparent;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                    <input type="hidden"  name="newresgroup_1" value = "" id="newresgroup_1">
                    <input type="hidden"  name="newresgroupid_1" value = "" id="newresgroupid_1">
                    <input type="hidden"  name="newrestypeid_1" value = "" id="newrestypeid_1">
                    <input type="hidden"  name="newresunit_1" value = "" id="newresunit_1">
                    <input type="hidden"  name="newresunitid_1" value = "" id="newresunitid_1">
                    <input type="hidden"  name="newresrate_1" value = "" id="newresrate_1">
                    <input type="hidden"  name="newwresunit_1" value = "" id="newwresunit_1">
                    <input type="hidden"  name="newwresunitid_1" value = "" id="newwresunitid_1">
                    <input type="hidden"  name="newwresrate_1" value = "" id="newwresrate_1">
                    <input type="hidden"  name="newresmattype_1" value = "" id="newresmattype_1">
                    <input type="hidden"  name="newreslead_1" value = "" id="newreslead_1">
                    <input type="hidden"  name="newrescode_1" value = "" id="newrescode_1">
                    <input type="hidden"  name="newrowrefid_1" value = "" id="newrowrefid_1">
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="newresrowid" id="newresrowid" >
        </tr>
    </table>
    <table  id="newresgroupitems" style="display: none;">
        <tr>
            <td ><a href="javascript:void(0);" id ="butnewresgroupitems" class="btn btn-link" onclick="return ShowNewResourceGroup(event)" >New Resource Group Created</a></td>
        </tr>
        <tr >
            <table class="table" id="newresgroup" style="display: none; width:50%;border:1px solid #ccc;">
                <thead>
                <tr>
                    <th style="border-right:1px solid #ccc;">Resource Group Name</th>
                    <th style="border-right:1px solid #ccc;">Type</th>
                    <th class="text-center">&nbsp;</th>
                </tr>
                </thead>
                <tbody class="sorting">
                <tr>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresgroupname_1" value = "" id="newresgroupname_1" readonly></td>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresgrouptype_1" value = "" id="newresgrouptype_1" align="right" readonly></td>
                    <td width="3%"><button type="button" name="newresgroupdetails_1" value = "Show Details" id="newresgroupdetails_1" onclick="return ShowResourceGroup(this.id)" style="margin:0;background-color: transparent;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                    <input type="hidden"  name="newresgroupparent_1" value = "" id="newresgroupparent_1">
                    <input type="hidden"  name="newresgroupparentid_1" value = "" id="newresgroupparentid_1">
                    <input type="hidden"  name="newresgrouptypeid_1" value = "" id="newresgrouptypeid_1">
                    <input type="hidden"  name="newresgroupcode_1" value = "" id="newresgroupcode_1">
                    <input type="hidden"  name="newresgrouprowrefid_1" value = "" id="newresgrouprowrefid_1">
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="resgrouprowid" id="resgrouprowid" >
        </tr>
    </table>
</div>
</form>
</div>
</div>
</div>
<!--excel-->
<?php if ($mode != 'edit'):?>
    <div class="fixed-action-btn active" data-toggle="tooltip" data-placement="left" id="divExcelImport" title="Import From Excel">
     <span class="butclr-ns btn-file">
              <p class="sam-up"><i class="fa fa-folder-open sap"></i></p>
              <input type="file" name="myfile" id="myfile" class="input-large filestyle" accept=".xls, .xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" onchange="getexcelfield(this)">
              </span>

    </div>
<?php endif; ?>
<!--excel end-->
<div id="dummy" style="display: none">
    <table id="dummytable">
        <tbody class="fix-tabletops">
        <tr id="ResourceiRowId__1">
            <td width="3%" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>><input class="parent_text" name="code__1" onblur="return CheckResCode(this.id)" id="code__1" /></td>
            <td width="11%" align="center"><textarea class="parent_texts" name="resname__1" id="resname__1" autocomplete="off" onblur="return CheckResName(this.id)"></textarea></td>
            <td width="11%"><input type="text" class="parent_text" name="resgroupname__1" id ="resgroupname__1" onblur="return CheckSuggestionId(this, 'resgroupid')"></td>
            <td width="5%"><input class="parent_text" type="text" name="typename__1" id="typename__1" readonly/></td>
            <td width="5%"><input type="text" class="parent_text" name="unitname__1" id="unitname__1" onblur="return CheckUnitValid(this.id)"></td>
            <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rate__1" id="rate__1" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onfocus="return clickExpandTr(this.id)" readonly/></td>
            <input type="hidden" name="typeid__1" id="typeid__1">
            <input type="hidden" name="unitid__1" id ="unitid__1">
            <input type="hidden" name="resgroupid__1" id ="resgroupid__1">
            <input type="hidden" name="ressourceid__1" id ="ressourceid__1">
            <td width="4%">
                <ul class="action_btns">
                    <li>
                        <a href="javascript:void(0);" class="mainTrDelete__1" style="display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="mainTr__1" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
                    </li>

                </ul>
            </td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr__1 paintTr"></tr>
        </tbody>
    </table>
</div>
<div id="dummyunit" style="display: none">
    <table id="dummyunittable">
        <tbody>
        <tr>
            <td width="10%"><input type="text" class="parent_text" id="undunit__1" readonly></td>
            <td width="10%"><input type="text" class="parent_text" id="newundunit__1"></td>
            <input type="hidden" id ="newundunitid__1">
        </tr>
        </tbody>
    </table>
</div>

<script id="dummy-general-tab"  type="text/template" class="hide">
    <div class="subDiv" style="display:none;">
        <div id="generalinfo__1">
            <div class="rfc_met">
                <ul>
                    <li>
                        <label>Working Unit</label>
                        <input type="text" id="generalinfo__1_wunitname">
                        <input type="hidden" name="generalinfo__1_wunit" id="generalinfo__1_wunit" />
                    </li>

                    <li>
                        <label>Working Rate</label>
                        <input type="text" maxlength="15" class="text-right" name="generalinfo__1_wrate" id="generalinfo__1_wrate" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)">
                    </li>

                    <li>
                        <label>Lead Time (in Days)</label>
                        <input type="text" maxlength="3" name="generalinfo__1_lead" id="generalinfo__1_lead" onkeypress="return isDecimal(event,this)">
                    </li>
                </ul>
            </div>
        </div>
    </div>
</script>
<script id="dummy-activity-row" type="text/template" class="hide">
    <tr id="activity__1_RowId__9">
        <td width="25%"><input class="parent_text" type="text" data-toggle="popover" name="activity__1_resname__9" id ="activity__1_resname__9" onfocus="return CheckResourceFocus(this.id,'')" autocomplete="off"></td>
        <td width="5%"><label for="activity__1_resunit__9"></label></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resqty__9" id="activity__1_resqty__9" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resrate__9" id="activity__1_resrate__9" align="right" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly></td>
        <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resamt__9" id="activity__1_resamt__9" align="right" readonly="" onkeypress="return isDecimal(event,this)"></td>
        <td width="4%">
            <ul class="action_btns">
                <li>
                    <a id="activity__1_resdel__9" href="javascript:DeleteResource('activity__1_RowId__9')" style="display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="activity__1_newresname__9" id ="activity__1_newresname__9" value="">
        <input type="hidden" name="activity__1_formula__9" id="activity__1_formula__9">
        <input type="hidden" name="activity__1_resid__9" id ="activity__1_resid__9">
        <input type="hidden" name="activity__1_resunitid__9" id ="activity__1_resunitid__9">
        <input type="hidden" name="activity__1_rowrefid__9" id ="activity__1_rowrefid__9">
    </tr>
</script>
<script id="dummy-activityR-row" type="text/template" class="hide">
    <tr id="activityR__1_RowId__9">
        <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activityR__1_resname__9" id="activityR__1_resname__9" onfocus="return CheckResourceFocus(this.id,'R')" autocomplete="off"></td>
        <td width="5%"><label for="activityR__1_resunit__9"></label></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resqty__9" id="activityR__1_resqty__9" align="right" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onfocus="return showformulaR(this.id)" onkeydown="return showF(this.id,event)" onchange="return ValueChangeR(this.id)"></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resrate__9" id="activityR__1_resrate__9" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChangeR(this.id)" readonly></td>
        <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resamt__9" id="activityR__1_resamt__9" align="right" onkeypress="return isDecimal(event,this)" readonly=""></td>
        <td width="4%">
            <ul class="action_btns">
                <li>
                    <a id="activityR__1_resdel__9" href="javascript:DeleteResourceR('activityR__1_RowId__9')" style="display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="activityR__1_newresname__9" id ="activityR__1_newresname__9" value="">
        <input type="hidden" name="activityR__1_formula__9" id="activityR__1_formula__9">
        <input type="hidden" name="activityR__1_resid__9" id="activityR__1_resid__9">
        <input type="hidden" name="activityR__1_resunitid__9" id="activityR__1_resunitid__9">
        <input type="hidden" name="activityR__1_rowrefid__9" id="activityR__1_rowrefid__9">
    </tr>
</script>
<script id="dummy-activity-tab" type="text/template" class="hide">
    <div class="subDiv" style="display:none;">
        <div class="darkmenu" style="margin-left:5px;">
            <ul>
                <li class="active" id="manual_tab__1"><a href="javascript:showmix('manual', '#manual_tab__1')"><i class="fa fa-magic"></i> Manual</a></li>
                <li id="machinery_tab__1"><a href="javascript:showmix('machinery', '#machinery_tab__1')"><i class="fa fa-cogs"></i> Machinery</a></li>
            </ul>
            <div class="lstate manual_mac">
                <ul>
                    <li>
                        <label >LS Rate</label>
                        <input type="text" maxlength="15" class="text-right" name="analrateLS__1" id="analrateLS__1" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onkeyup="bindRate('analrateLS__1')"/>
                    </li>
                    <li>
                        <label>Manual Rate</label>
                        <input type="text" class="text-right" maxlength="15" name="analrateM__1" id="analrateM__1" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li>
                        <label>Machinery Rate</label>
                        <input type="text" class="text-right" maxlength="15" name="analrateA__1" id="analrateA__1" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li>
                        <label>Rate Type</label>
                        <div class="select-style select-inline">
                            <select name="analrate__1" id ="analrate__1" onchange="return MainRateUpdate()">
                                <option value="L" >LS </option>
                                <option value="M" >Manual </option>
                                <option value="A" >Machinery </option>
                            </select>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12 clear">
            <div id="activityWQty__1">
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="parent_texters work_qt text-right" maxlength="15" name="activity__1_AnalQty" id="activity__1_AnalQty" value="1" onkeypress="return isDecimal(event,this)"  onchange="ChangeWorkQty(this.id)">
                <a class="ad-btn" href="javascript:void(0);" id="activity__1_PickList" onclick="showPickList(this.id)" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a>
            </div>
            <div id="activityWQtyR__1" style="display: none;">
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="parent_texters work_qt text-right" maxlength="15" name="activityR__1_AnalQty" id="activityR__1_AnalQty" value="1" onkeypress="return isDecimal(event,this)"  onchange="ChangeWorkQty(this.id)">
                <a class="ad-btn" href="javascript:void(0);" id="activityR__1_PickList" onclick="showPickList(this.id)" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a>
            </div>
            <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
                <!-- Manual tabs -->
                <table class="table" style="margin-bottom:0px; margin-top:8px;" id="activity__1_restable">
                    <thead>
                    <tr class="popuptable-topfixs">
                        <th class="bg_clo_subTr" width="21%">Resource name</th>
                        <th class="bg_clo_subTr" width="5%">Unit</th>
                        <th class="bg_clo_subTr" width="5%">Qty</th>
                        <th class="bg_clo_subTr" width="5%">Rate</th>
                        <th class="bg_clo_subTr" width="8%">Amount</th>
                        <th class="bg_clo_subTr text-center" width="4%">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody class="sorting fix-tabletops">
                    <tr id="activity__1_RowId__9">
                        <td width="25%"><input class="parent_text" type="text" data-toggle="popover" name="activity__1_resname__9" id ="activity__1_resname__9" onfocus="return CheckResourceFocus(this.id,'')" autocomplete="off"></td>
                        <td width="5%"><label for="activity__1_resunit__9"></label></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resqty__9" id="activity__1_resqty__9" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resrate__9" id="activity__1_resrate__9" align="right" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly></td>
                        <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activity__1_resamt__9" id="activity__1_resamt__9" align="right" readonly="" onkeypress="return isDecimal(event,this)"></td>
                        <td width="4%">
                            <ul class="action_btns">
                                <li>
                                    <a id="activity__1_resdel__9" href="javascript:DeleteResource('activity__1_RowId__9')" style="display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                </li>
                            </ul>
                        </td>
                        <input type="hidden" name="activity__1_newresname__9" id ="activity__1_newresname__9" value="">
                        <input type="hidden" name="activity__1_formula__9" id="activity__1_formula__9">
                        <input type="hidden" name="activity__1_resid__9" id ="activity__1_resid__9">
                        <input type="hidden" name="activity__1_resunitid__9" id ="activity__1_resunitid__9">
                        <input type="hidden" name="activity__1_rowrefid__9" id ="activity__1_rowrefid__9">
                    </tr>
                    </tbody>
                    <tbody class="total fix-tabletops">
                    <tr style="border-bottom:none;">
                        <td style="border-right:none;" width="21%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td class="rate_pri" align="right" width="5%"><label id="activity__1_ltotrate">Total</label></td>
                        <td style="border-right:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activity__1_totrate" id="activity__1_totrate"  readonly></td>
                        <td style="border-right:none;" width="4%">&nbsp;</td>
                    </tr>
                    <tr style="border-bottom:none;">
                        <td style="border-right:none;border-top:none;" width="21%"></td>
                        <td style="border-right:none;border-top:none;" width="5%"></td>
                        <td style="border-right:none;border-top:none;" width="5%"></td>
                        <td style="border-right:none;border-top:none;vertical-align: middle;" class="rate_pri" align="right" width="2%"><label id="activity__1_lperrate">Rate Per Unit</label></td>
                        <td style="border-right:none;border-top:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activity__1_perrate" id="activity__1_perrate"  readonly></td>
                        <td style="border-right:none;border-top:none;" width="4%">&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
                <input type="hidden" name="rowinfoid__1" id="rowinfoid__1" value="1">
                <!-- Machinery tabs -->
                <table class="table" style="display: none;margin-bottom:0px; margin-top:8px;" id="activityR__1_restable">
                    <thead>
                    <tr class="popuptable-topfixs">
                        <th class="bg_clo_subTr"  width="21%">Resource name</th>
                        <th class="bg_clo_subTr"  width="5%">Unit</th>
                        <th class="bg_clo_subTr"  width="5%">Qty</th>
                        <th class="bg_clo_subTr"  width="5%">Rate</th>
                        <th class="bg_clo_subTr"  width="8%">Amount</th>
                        <th class="bg_clo_subTr text-center"  width="8%">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody class="sorting fix-tabletops">
                    <tr id="activityR__1_RowId__9">
                        <td width="21%"><input class="parent_text" type="text" data-toggle="popover" name="activityR__1_resname__9" id="activityR__1_resname__9" onfocus="return CheckResourceFocus(this.id,'R')" autocomplete="off"></td>
                        <td width="5%"><label for="activityR__1_resunit__9"></label></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resqty__9" id="activityR__1_resqty__9" align="right" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onfocus="return showformulaR(this.id)" onkeydown="return showF(this.id,event)" onchange="return ValueChangeR(this.id)"></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resrate__9" id="activityR__1_resrate__9" align="right" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChangeR(this.id)" readonly></td>
                        <td width="8%"><input type="text" class="parent_text text-right" maxlength="15" name="activityR__1_resamt__9" id="activityR__1_resamt__9" align="right" onkeypress="return isDecimal(event,this)" readonly=""></td>
                        <td width="4%">
                            <ul class="action_btns">
                                <li>
                                    <a id="activityR__1_resdel__9" href="javascript:DeleteResourceR('activityR__1_RowId__9')" style="display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                </li>
                            </ul>
                        </td>
                        <input type="hidden" name="activityR__1_newresname__9" id ="activityR__1_newresname__9" value="">
                        <input type="hidden" name="activityR__1_formula__9" id="activityR__1_formula__9">
                        <input type="hidden" name="activityR__1_resid__9" id="activityR__1_resid__9">
                        <input type="hidden" name="activityR__1_resunitid__9" id="activityR__1_resunitid__9">
                        <input type="hidden" name="activityR__1_rowrefid__9" id="activityR__1_rowrefid__9">
                    </tr>
                    </tbody>
                    <tbody class="total fix-tabletops">
                    <tr style="border-bottom:none;">
                        <td style="border-right:none;" width="21%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td style="border-right:none;vertical-align: middle; " class="rate_pri" align="right" width="5%"><label id="activityR__1_ltotrate">Total</label></td>
                        <td style="border-right:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityR__1_totrate" id="activityR__1_totrate"  onkeypress="return isDecimal(event,this)" readonly=""></td>
                        <td style="border-right:none;" width="4%">&nbsp;</td>
                    </tr>
                    <tr style="border-bottom:none;">
                        <td style="border-right:none;" width="21%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td style="border-right:none;" width="5%"></td>
                        <td style="border-right:none;border-top:none; vertical-align: middle;" class="rate_pri" align="right" width="5%"><label id="activityR__1_lperrate">Rate Per Unit</label></td>
                        <td style="border-right:none;border-top:none;" width="8%"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityR__1_perrate" id="activityR__1_perrate" onkeypress="return isDecimal(event,this)" readonly=""></td>
                        <td style="border-right:none;border-top:none;" width="4%">&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
                <input type="hidden" name="rowinfoidR__1" id="rowinfoidR__1" value="1">
            </div>
        </div>
    </div>
</script>
<script id="dummy-steel-row" type="text/template" class="hide">
    <tr id="steel__1_RowId__9">
        <td width="11%"><input type="text" class="parent_text" maxlength="100" name="steel__1_des__9" id="steel__1_steeldes__9" onblur="checkSteelDescription(this.id)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="10" name="steel__1_dia__9" id="steel__1_dia__9" onkeypress="return isDecimal(event, this)" onblur="checkSteeldia(this.id)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="10" name="steel__1_factor__9" id="steel__1_factor__9" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
        <td width="5%"><input type="text" class="parent_text text-right" maxlength="6" name="steel__1_waste__9" id="steel__1_waste__9" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
        <td width="2%">
            <ul class="action_btns">
                <li>
                    <a id="steel__1_delrow__9" href="javascript:void(0);"  onclick = "DeleteSteelRow(this.id)" style="display: none;"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
    </tr>
</script>
<script id="dummy-steel-tab" type="text/template" class="hide">
    <div class="subDiv" style="display:none;">
        <div id="general__1">
            <div class="rfc_met">
                <ul>
                    <li>
                        <label>Material Type</label>
                        <div class="select-style rfc_meoption">
                            <select name="generalinfo__1_mtype" id ="generalinfo__1_mtype" onchange="return MaterialTypeChange(this.value, 'steel__1')">
                                <option value="G">General</option>
                                <option value="F">Fuel</option>
                                <option value="S">Steel</option>
                                <option value="P">Production</option>
                            </select>
                            <input type="hidden" name="mtype_<?php echo $i ?>" id="mtype_<?php echo $i ?>" value="">
                        </div>
                    </li>
                    <li>
                        <label>Lead Time (in Days)</label>
                        <input type="text" name="generalinfo__1_lead" maxlength="3" id="generalinfo__1_lead" onkeypress="return isDecimal(event,this)">
                    </li>
                </ul>
            </div>
            <div class="col-lg-12" id="steel__1" style="display: none">
                <h2>Steel Directory</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th class="bg_clo">Steel Description</th>
                        <th class="bg_clo">Diameter</th>
                        <th class="bg_clo">Factor/Unit</th>
                        <th class="bg_clo">Wastage %</th>
                        <th class="bg_clo text-center">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody >
                    <tr id="steel__1_RowId__9">
                        <td width="11%"><input type="text" class="parent_text"  maxlength="100" name="steel__1_des__9" id="steel__1_steeldes__9" onblur="checkSteelDescription(this.id)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="10" name="steel__1_dia__9" id="steel__1_dia__9" onkeypress="return isDecimal(event, this)" onblur="checkSteeldia(this.id)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="10" name="steel__1_factor__9" id="steel__1_factor__9" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
                        <td width="5%"><input type="text" class="parent_text text-right" maxlength="6" name="steel__1_waste__9" id="steel__1_waste__9" onkeypress="return isDecimal(event, this)" onkeyup="AddNewsteelRow('steel__1_RowId__9')"></td>
                        <td width="2%">
                            <ul class="action_btns">
                                <li>
                                    <a id="steel__1_delrow__9" href="javascript:void(0);"  onclick = "DeleteSteelRow(this.id)" style="display: none;"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <input type="hidden" name="rowinfoidS__1" id="rowinfoidS__1" value="1">
            </div>
        </div>
    </div>
</script>
<div id="formula" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Formula</h1>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formula Expression</label>
                    <input type="text" class="parent_text" name="formulaexp" value = "" id="formulaexp" onchange="return formulacalculation()" onkeypress="return isFormula(event);" >
                </div>
                <div class="form-group">
                    <input type="text" class="parent_text text-right" name="formulavalue" value = "" id="formulavalue"  onfocus="return formulafocus()" readonly >
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return formulaok()" data-toggle="tooltip" class="ripple has-ripple" data-original-title="Apply">Apply</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Resource Picklist</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive clear">
                    <div id="respickgrid"> </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="picklistrestype" value="">
                <input type="hidden" id="picklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="unitmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Undefined Units</h1>
            </div>
            <div class="modal-body">
                <table class="table" style="margin-bottom:0px; margin-top:8px;" id="unittable">
                    <thead>
                    <tr class="popuptable-topfixs">
                        <th>Undefined Unit</th>
                        <th>Unit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr></tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return unitClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return unitUpdate()" data-dismiss="modal">Apply</button>
            </div>
        </div>
    </div>
</div>
<div id="resgroupmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource Group</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="resgrouprowid" id="resgrouprowid" >
                <input type="hidden" id="refNewResgroupRowName" />
                <div class="form-group" <?php echo ($groupcodegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <label style="margin-bottom: 10px;">Resource Code</label>
                    <input type="text" class="parent_text" name="resgroupcode" id="resgroupcode" onblur="CheckResgroupCode()">
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Resource Group</label>
                    <input type="text" class="parent_text" name="resgroupname" id="resgroupname" onblur="CheckResGroupName();" >
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Parent Group</label>
                    <input type="text" class="parent_text" name="resgroupparent" id="resgroupparent" autocomplete="off" onblur="resgroupparentcheck(this.id)">
                    <input type="hidden" name="resgroupparentid" id="resgroupparentid">
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Resource Type</label>
                    <input type="text" class="parent_text"  name="resgrouptype" id="resgrouptype" autocomplete="off">
                    <input type="hidden" name="resgrouptypeid" id="resgrouptypeid">
                </div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return ResourceGroupClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="newresgroupok" class="md_ok" onclick="return ResourcegroupUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="resourcemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="resrowid" id="resrowid" >
                <input type="hidden" id="refNewResRowName" />
                <div class="col-lg-12" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Code</label>
                        <input type="text" class="parent_text" name="rescode" id="rescode" onblur="CheckResCode()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-12">
                        <label style="margin-bottom: 10px;">Resource Name</label>
                        <input type="text" class="parent_text" name="resname" id="resname" onblur="CheckResName()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Group</label>
                        <input type="text" class="parent_text" name="resgroup" id="resgroup" autocomplete="off">
                        <input type="hidden" name="resgroupid" id="resgroupid">
                    </div>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Type</label>
                        <input type="text" class="parent_text"  name="restype" id="restype" readonly>
                        <input type="hidden" name="restypeid" id="restypeid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Unit</label>
                        <input type="text" class="parent_text" name="resunit" id="resunit" autocomplete="off">
                        <input type="hidden" name="resunitid" id="resunitid">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkunit">
                        <label style="margin-bottom: 10px;">Working Unit</label>
                        <input type="text" class="parent_text" name="wresunit" id="wresunit" autocomplete="off">
                        <input type="hidden" name="wresunitid" id="wresunitid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="resrate" id="resrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkrate">
                        <label style="margin-bottom: 10px;">Working Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="wresrate" id="wresrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                </div>
                <div class="col-lg-12" id ="divmattype">
                    <div class="form-group col-lg-6">
                        <label>Material Type</label>
                        <div class="select-style rfc_meoption">
                            <select name="resmattype" id ="resmattype">
                                <option value="G">General</option>
                                <option value="F">Fuel</option>
                                <option value="S">Steel</option>
                                <option value="P">Production</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Lead Time (in Days)</label>
                        <input type="text" class="parent_text text-right"  name="restlead" maxlength="3" id="reslead" onkeypress="return isDecimal(event,this)">
                    </div>
                </div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return ResourceClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="newresok" class="md_ok" onclick="return ResourceUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="excelfieldmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource Import Sheet - Assign Fields</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive popuptable animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                    <table class="table" width="100%" style=" margin-bottom:0px;">
                        <tbody>
                        <tr id="excelfieldTable">
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return fileupload()" >Next</button>
            </div>
        </div>
    </div>
</div>
<div id="excelmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="width: 75%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource Import Sheet</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive parent-scroll">
                    <table class="fixTable table" style="margin-bottom:0px; margin-top:8px;" id="excelTable">
                        <thead>
                        <tr>
                            <th class="th-modal">Resource Group</th>
                            <th class="th-modal">TypeName</th>
                            <th class="th-modal">Resource Name</th>
                            <th class="th-modal">Unit</th>
                            <th class="th-modal">Rate</th>
                            <th class="th-modal">Working Unit</th>
                            <th class="th-modal">Working Rate</th>
                            <th class="th-modal">Material Type</th>
                            <th class="th-modal">Lead Time</th>
                            <th class="th-modal">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody >
                        <tr>
                            <td style="width:20%"><input type="text" class="parent_text"  name="excelresgroupname_1" id="excelresgroupname_1" onfocus="excelResGroupFocus(this.id)" onchange="excelResGroupValid(this.id)" ></td>
                            <td style="width:8%"><input type="text" class="parent_text"  name="exceltype_1" id="exceltype_1" onfocus="excelResTypeFocus(this.id)"  onchange="excelResTypevalid(this.id)" ></td>
                            <td style="width:40%"><input type="text" class="parent_text"  name="excelresname_1" id="excelresname_1" onfocus="excelResourceFocus(this.id)" autocomplete="off"></td>
                            <td style="width:8%"><input type="text" class="parent_text"  name="excelunit_1" id="excelunit_1" onfocus="excelUnitFocus(this.id)" onchange="excelUnitvalid(this.id)" ></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelrate_1" id="excelrate_1"  onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:8%"><input type="text" class="parent_text"  name="excelwunit_1" id="excelwunit_1" onfocus="excelWUnitFocus(this.id)" ></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelwrate_1" id="excelwrate_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:8%"><input type="text" class="parent_text"  name="excelmtype_1" id="excelmtype_1"></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelleadtime_1" id="excelleadtime_1" onkeypress="return isDecimal(event,this)"></td>
                            <td width="2%" align="center">
                                <ul class="action_btns">
                                    <li>
                                        <a href="javascript:void(0);" class="excelTrDelete"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a>
                                    </li>
                                </ul>
                                <input type="hidden" name="excelresgroupid_1" id="excelresgroupid_1" >
                                <input type="hidden" name="exceltypeid_1" id="exceltypeid_1" >
                                <input type="hidden" name="excelunitid_1" id="excelunitid_1" >
                                <input type="hidden" name="excelwunitid_1" id="excelwunitid_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!--                <div class="bar_container">-->
                <!--                    <div id="main_container">-->
                <!--                        <div id="pbar" class="progress-pie-chart" data-percent="0">-->
                <!--                            <div class="ppc-progress">-->
                <!--                                <div class="ppc-progress-fill"></div>-->
                <!--                            </div>-->
                <!--                            <div class="ppc-percents">-->
                <!--                                <div class="pcc-percents-wrapper">-->
                <!--                                    <span>%</span>-->
                <!--                                </div>-->
                <!--                            </div>-->
                <!--                        </div>-->
                <!--                        <progress style="display: none" id="progress_bar" value="0" max="100"></progress>-->
                <!--                    </div>-->
                <!--                </div>-->


            </div>

            <div class="clearfix"></div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return ExcelResourceUpdate()" >Apply</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

var bExcelRegGroup = false,
    bExcelRes = false,
    bExcelUnit = false,
    bExcelRate = false,
    bExcelWUnit = false,
    bExcelWRate = false,
    bExcelMaterialType = false,
    bExcelLeadTime = false,
    bExcelUpdate =false,
    arrResMaster;


var formData = new FormData();
var arrayField =[];
arrayField = [{ data :1, value: 'ResourceGroup' },
    { data :2, value: 'ResourceName' },
    { data :3, value: 'Unit' },
    { data :4, value: 'Rate' },
    { data :5, value: 'WorkingUnit' },
    { data :6, value: 'WorkingRate' },
    { data :7, value: 'MaterialType' },
    { data :8, value: 'LeadTime' }
];

var arrayFieldR = arrayField;


//$(document).ready(function() {
//$(".fixTable").tableHeadFixer();
//$()
//});

$(function () {
    $('body').tooltip({
        selector: '.error'
    });
});
function submitForm() {
    $('form').submit();
}
$(function(){
    if (isNullCheck($('#editid').val(),'number') !=0)   $('.mainTrDelete_1').hide();
    $('#resgroup').autocomplete({
        lookup: arrayresgroupa,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resgroupid").val(suggestion.data);
                $('#restype').val(suggestion.TypeName);
                $('#restypeid').val(suggestion.TypeId);
                $('#divworkunit').hide();
                $('#divworkrate').hide();
                $('#divmattype').hide();
                if (suggestion.TypeId== 2) $('#divmattype').show();
                if (suggestion.TypeId== 3) { $('#divworkunit').show();$('#divworkrate').show();}
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $("#resgroupid").val(0);
            $('#divworkunit').hide();
            $('#divworkrate').hide();
            $('#divmattype').hide();
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $("#resgroupid").val(0);
            } else
                removeError($(this));
        }
    });

    $('#restype').autocomplete({
        lookup: arrrestype,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#restypeid').val(suggestion.data);
                $('#resgroup').prop('readonly', true);
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $('#restypeid').val(0);
            $('#resgroup').prop('readonly', false);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $('#restypeid').val(0);
                $('#resgroup').prop('readonly', false);
            } else removeError($(this));
        }
    });

    $('#resgroupparent').autocomplete({
        lookup: arrayresgroupa,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resgroupparentid").val(suggestion.data);
                $('#resgrouptype').val(suggestion.TypeName);
                $('#resgrouptypeid').val(suggestion.TypeId);
                $('#resgrouptype').prop('readonly', true);
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $("#resgroupparentid").val(0);
            $('#resgrouptype').prop('readonly', false);
            removeError($(this));
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $("#resgroupparentid").val(0);
                $('#resgrouptype').prop('readonly', false);
            } else
                removeError($(this));
        }
    });
    $('#resgrouptype').autocomplete({
        lookup: arrrestype,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#resgrouptypeid').val(suggestion.data);
                $('#resgroupparent').prop('readonly', true);
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $('#resgrouptypeid').val(0);
            $('#resgroupparent').prop('readonly', false);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $('#resgrouptypeid').val(0);
                $('#resgroupparent').prop('readonly', false);
            } else removeError($(this));
        }
    });

    $('#resunit').autocomplete({
        lookup: arrayunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resunitid").val(suggestion.data);
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $("#resunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $("#resunitid").val(0);
            } else
                removeError($(this));
        }
    });
    $('#wresunit').autocomplete({
        lookup: arrayunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#wresunitid").val(suggestion.data);
                removeError($(this));
            }
        },
        onSearchStart: function(suggestion) {
            $("#wresunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                showError($(this), 'Required');
                $("#wresunitid").val(0);
            } else
                removeError($(this));
        }
    });
    // modal forms on close
    $('#resourcemodal').on('hidden.bs.modal', function () {
        $(this).find('input').val('');
    });
});

function checkSteelDescription(x) {
    var key1 =  x.split('_')[1],
        key2 = x.split('_')[3],
        sdesc = $('#'+x).val().trim();

    removeError($('#'+x));
    if (isNullCheck($('#'+x).val(),'string') =="") return;

    var $resnames = $('input[id*='+key1+'_steeldes_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var iRowid = name.split('_')[3];
        if (iRowid != key2) {
            if (sdesc == $('#'+name).val().trim()) {
                showError($('#'+x), 'Already Available');
            }
        }
    });
}

function checkSteeldia(x) {
    var key1 =  x.split('_')[1],
        key2 = x.split('_')[3],
        dDia = parseFloatVal(isNullCheck($('#'+x).val(),'number'));

    removeError($('#'+x));
    if (isNullCheck($('#'+x).val(),'string') =="") return;

    var $resnames = $('input[id*='+key1+'_dia_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var iRowid = name.split('_')[3];
        if (iRowid != key2) {
            var dnDia =  parseFloatVal(isNullCheck($('#'+name).val(),'number'));
            if (dDia == dnDia) {
                showError($('#'+x), 'Already Available');
            }
        }
    });
}

function bindResourceChange() {
    var $resnames = $('input[id*=_resname_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $('#'+ name).attr('data-content', $('#'+ name).val());
        $this.blur(function () {
            if (isNullCheck($('#'+ name).val(),'string') =="") $this.removeClass('error')
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
        $this.change(function () {
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
    });
}

function bindPopOver() {
    var $inputs =  $('input[data-toggle="popover"]');
    $inputs.unbind('popover');
    $inputs.popover({
        placement : 'bottom',
        trigger : 'hover'
    });
}

var iRowId=1;
var iFocusRowId=1;
var iTransRowId=0;
var bSiteMix=true;
var arrayunitlist = <?php echo json_encode($unit); ?>;
var arraywunitlist = <?php echo json_encode($wunit); ?>;

var arrayresgroup = <?php echo json_encode($resgroup); ?>;
var arrayresgroupa = <?php echo json_encode($resgroupa); ?>;

var arrayreslist = <?php echo json_encode($reslist); ?>;
var arrrestype = <?php echo json_encode($restype); ?>;
var arrayres = arrayreslist;
var arrayresR = arrayreslist;
var arrrespicklist = <?php echo json_encode($respicklist); ?>;
var arrrespicklistR = [];


// Expand Script
function expandTrFn(reset) {
    var $mainTRs = $("a[class*=mainTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateAndAddTabs(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.addClass("tform");
            $('activity_'+ key +'_restable').show();
            iFocusRowId = key;
            closedetails($(this)[0].className);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("tform");
        }
        // set LS Rate if available for activity
        var $rateLS = $('#mainanalrateLS_' + key);
        if ($rateLS.length == 1) {
            $('#analrateLS_' + key).val(sanitizeNumber(isNullCheck($rateLS.val(),'number'),2,true));
            $('#analrate_' + key).find('option[value="'+ $('#mainanalrate_' + key).val() +'"]').attr('selected', 'selected');
        }
        return false;
    });
}
function bindExcelDeleteFn(reset) {
    var $trDelete = $('a[class*=excelTrDelete]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className;
        $this.on('click', function(e) {
            e.preventDefault();
            if (confirm('Do you want to Delete')) {
                var tr_length = $('#excelTable tr').length;
                if (tr_length ==2) {
                    var $excelpids = $('input[id*=excelresgroupname_]');
                    $.each($excelpids, function (i, obj) {
                        var $this = $(this),
                            name = $this[0].id;
                        var key1 = name.split('_')[1];
                        $("#excelresgroupname_"+key1).val('');
                        $("#exceltype_"+key1).val('');
                        $("#excelresname_"+key1).val('');
                        $("#excelunit_"+key1).val('');
                        $("#excelrate_"+key1).val('');
                        $("#excelresgroupid_"+key1).val('');
                        $("#exceltypeid_"+key1).val('');
                        $("#excelunitid_"+key1).val('');
                        $("#excelwunit_"+key1).val('');
                        $("#excelwrate_"+key1).val('');
                        $("#excelmtype_"+key1).val('');
                        $("#excelleadtime_"+key1).val('');
                        $("#excelwunitid_"+key1).val('');
                    });
                } else {
                    $this.closest('tr').remove();
                }
            }
            return false;
        });
    });
}
function clickExpandTr(name) {
    var rowId = name.split('_')[1];
    if ($('#typeid_'+rowId).val() == 1) {
        $('#rate_'+rowId).removeAttr('readonly');
        return;
    }
    if ($('.subTr_' + iFocusRowId).is(':visible'))
        return;

    $('a.mainTr_' + rowId).trigger('click');
}

function checkRegGroup(resgroupname,resgrouptype,resgrouptypeid,sWid) {
    var $resgroups = $('input[id*=resgroupname_]');
    $.each($resgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        if ($('#resgroupname_' + key1).val() ==  resgroupname) {
            $('#resgroupname_' + key1).val(resgroupname).trigger('focus');
            $('#resgroupid_' + key1).val(sWid);
            $('#typename_' + key1).val(resgrouptype);
            $('#typeid_' + key1).val(resgrouptypeid);
            $('#resgroupname_' + key1).prop('readonly', true);
        }
    });
}
function checkResNameFocus() {
    var $resgroups = $('textarea[id*=resname_]');
    $.each($resgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        $('#ResourceiRowId_' + key1).children('td, th').css('background-color','#B22222');
        //$('#rate_' + key1).trigger('focus');
        CheckExcelResName(name);
        $('#resname_' + key1).trigger('blur');
        $('#ResourceiRowId_' + key1).children('td, th').css('background-color','#FFF');
    });
}
function bindAutoComplete() {
    var $resgroups = $('input[id*=resgroupname_]'),
        $units = $('input[id*=unitname_]');
    // unbind previous autocomplete functionality
    $resgroups.unbind('autocomplete');
    $units.unbind('autocomplete');
    $.each($resgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        $this.autocomplete({
            lookup: arrayresgroup,
            showNoSuggestionNotice:false,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newresgroup_'+ key1  +'" class="btn btn-link" id="newresgroup_'+ key1 +'" value="Resource Group" onclick="return AddNewresGroup('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#resgroupid_"+ key1).val(suggestion.data);
                    $('#typename_' + key1).val(suggestion.TypeName);
                    $('#typeid_' + key1).val(suggestion.TypeId);
                    // set prop set for labour type(1)
                    if(suggestion.TypeId == 1) $('.mainTr_' + key1).hide();
                    else $('.mainTr_' + key1).show();
                    if(suggestion.TypeId != 4) $('#rate_' + key1).removeAttr('readonly');
                    removeError($(this));
                }
            },
            onSearchStart: function(suggestion) {
                $("#resgroupid_"+ key1).val(0);
                $('#typename_' + key1).val('');
                $('#typeid_' + key1).val(0);
                // remove prop set for labour type
                // $('.mainTr_' + key1).show();
                //$('#rate_' + key1).val(0);
                $('#rate_' + key1).prop('readonly', true);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#resgroupid_"+ key1).val(0);
                    $('#typename_' + key1).val('');
                    $('#typeid_' + key1).val(0);
                    // remove prop set for labour type
                    //  $('.mainTr_' + key1).show();
                    //  $('#rate_' + key1).val(0);
                    $('#rate_' + key1).prop('readonly', true);
                } else removeError($(this));
            }
        });
    });
    $.each($units, function (i, obj) {

        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newunit_'+ key1  +'" class="btn btn-link" id="newunit_'+ key1 +'" value="Unit" onclick="return AddNewUnit('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#unitid_" + key1).val(suggestion.data);
                    removeError($(this));
                }
                AddNewRowA($this[0].id);
                  if($('#typeid_'+key1).val() !=1)
                  {
                      $('.mainTr_'+key1).show();
                  }

//                $('.mainTrDelete_'+key1).show();
            },
            onSearchStart: function(suggestion) {
                $("#unitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#unitid_" + key1).val(0);
                } else removeError($(this));
            }
        });
    });
}
function bindResourceAutoComplete(rowId) {
    var $resids = null;
    if(typeof rowId != 'undefined') $resids = $('input[id*='+rowId+'_resname_]');
    else $resids = $('input[id*=_resname_]');
    // unbind previous autocomplete fn
    $resids.unbind('autocomplete');
    // bind autocomplete fn
    $.each($resids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            arr_names = name.split('_');
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = arr_names[1],
            key2 = arr_names[3];
        if (name.substr(name.indexOf('_') - 1, 1) === 'R') {
            var $resunit = $("label[for='activityR_" + key1 + "_resunit_"+key2+"']"),
                $resid = $('#activityR_' + key1 + '_resid_' + key2),
                $resunitid = $('#activityR_' + key1 + '_resunitid_' + key2),
                $resname = $('#activityR_' + key1 + '_resname_' + key2),
                $resrate = $('#activityR_' + key1 + '_resrate_' + key2);
            $this.autocomplete({
                lookup: arrayresR,
                multiselect:true,
                showNoSuggestionNotice:true,
                //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function(suggestion) {
                    if(suggestion) {
                        $resid.val(suggestion.data);
                        $resunit.html(suggestion.UnitName);
                        $resunitid.val(suggestion.UnitId);
                        $resname.prop('readonly', true);
                        $resrate.val(sanitizeNumber(suggestion.Rate,2,true));
                        if ($('#activityR_'+key1+'_RowId_' + (parseInt(key2) + 1)).length == 0) AddNewRowResR(key1);
                        removeError($(this));
                    }
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        showError($(this), 'Required');
                        $resunit.html('');
                        $resid.val(0);
                        $resrate.val(sanitizeNumber(0,2,true));
                        $resunitid.val(0);
                    } else removeError($(this));
                }
            });
        } else {
            var $resunit = $("label[for='activity_" + key1 + "_resunit_"+key2+"']"),
                $resid = $('#activity_' + key1 + '_resid_' + key2),
                $resunitid = $('#activity_' + key1 + '_resunitid_' + key2),
                $resname = $('#activity_' + key1 + '_resname_' + key2),
                $resrate = $('#activity_' + key1 + '_resrate_' + key2);
            $this.autocomplete({
                lookup: arrayres,
                multiselect:true,
                showNoSuggestionNotice:true,
                //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function(suggestion) {
                    if(suggestion) {
                        $resunit.html(suggestion.UnitName);
                        $resunitid.val(suggestion.UnitId);
                        $resname.prop('readonly', true);
                        $resid.val(suggestion.data);
                        $resrate.val(sanitizeNumber(suggestion.Rate,2,true));
                        if ($('#activity_'+key1+'_RowId_' + (parseInt(key2) + 1)).length == 0) AddNewRowRes(key1);
                        removeError($(this));
                    }
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        showError($(this), 'Required');
                        $resunit.html('');
                        $resid.val(0);
                        $resrate.val(sanitizeNumber(0,2,true));
                        $resunitid.val(0);
                    } else removeError($(this));
                }
            });
        }
    });
}
function bindResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    if (name.substr(name.indexOf('_') - 1, 1) === 'R') {
        checkResource(key1,"R");
        var $resunit = $("label[for='activityR_" + key1 + "_resunit_"+key2+"']"),
            $resid = $('#activityR_' + key1 + '_resid_' + key2),
            $resunitid = $('#activityR_' + key1 + '_resunitid_' + key2),
            $resname = $('#activityR_' + key1 + '_resname_' + key2),
            $resrate = $('#activityR_' + key1 + '_resrate_' + key2);
        $this.autocomplete({
            lookup: arrayresR,
            multiselect:true,
            showNoSuggestionNotice:true,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $resid.val(suggestion.data);
                    $resunit.html(suggestion.UnitName);
                    $resunitid.val(suggestion.UnitId);
                    $resname.prop('readonly', true);
                    $resrate.val(sanitizeNumber(suggestion.Rate,2,true));
                    if ($('#activityR_'+key1+'_RowId_' + (parseInt(key2) + 1)).length == 0) AddNewRowResR(key1);
                    removeError($(this));
                }
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $resunit.html('');
                    $resid.val(0);
                    $resrate.val(sanitizeNumber(0,2,true));
                    $resunitid.val(0);
                } else removeError($(this));
            }
        });
    } else {
        checkResource(key1,"");
        var $resunit = $("label[for='activity_" + key1 + "_resunit_"+key2+"']"),
            $resid = $('#activity_' + key1 + '_resid_' + key2),
            $resunitid = $('#activity_' + key1 + '_resunitid_' + key2),
            $resname = $('#activity_' + key1 + '_resname_' + key2),
            $resrate = $('#activity_' + key1 + '_resrate_' + key2);
        $this.autocomplete({
            lookup: arrayres,
            multiselect:true,
            showNoSuggestionNotice:true,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $resunit.html(suggestion.UnitName);
                    $resunitid.val(suggestion.UnitId);
                    $resname.prop('readonly', true);
                    $resid.val(suggestion.data);
                    $resrate.val(sanitizeNumber(suggestion.Rate,2,true));
                    if ($('#activity_'+key1+'_RowId_' + (parseInt(key2) + 1)).length == 0) AddNewRowRes(key1);
                    removeError($(this));
                }
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $resunit.html('');
                    $resid.val(0);
                    $resrate.val(sanitizeNumber(0,2,true));
                    $resunitid.val(0);
                } else removeError($(this));
            }
        });
    }
}
function CheckResourceFocus(x,type) {
    checkResource(x.split('_')[1],type);
    var $resname = $('#' + x);
    bindResRowAutoComplete($resname);
}
function checkResource(iFRowId,type) {
    iFocusRowId = iFRowId;
    var $reskeyid ="";
    if (type=="R") {
        arrayresR = arrayreslist;
        $reskeyid = $('input[id*=activityR_' + iFocusRowId + '_resid_]');
        arrayresR = $.grep(arrayreslist, function(element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.data == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        arrayres = arrayreslist;
        $reskeyid = $('input[id*=activity_' + iFocusRowId + '_resid_]');
        arrayres = $.grep(arrayreslist, function(element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.data == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    }
}
function DeleteResource(x) {
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    if (isNullCheck($('#activity_' + iFocusRowId + '_resid_' + iARowid).val(),'number')==0) return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#activity_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoid_' + iFocusRowId).val(),
            $resname =  $('#activity_' + iFocusRowId + '_resname_' + irid);
        $row.remove();
        bindResRowAutoComplete($resname);
        ValueChange($($resname)[0].id);
        SortOrder(iFocusRowId);
    }
    //return false;
//
//
//
//
//    var sStr = x.split("_"),
//        iFocusRowId = sStr[1],
//        iARowid = sStr[3];
//    //if (isNullCheck($('#activity_' + iFocusRowId + '_resid_' + iARowid).val(),'number')==0) return;
//    if (confirm('Do you want to Delete')) {
//        var $row = $('#activity_' + iFocusRowId + '_RowId_' + iARowid),
//            tr_length = $('tr[id*=activity_' + iFocusRowId + '_RowId_]').length,
//            irid =   $('#rowinfoid_' + iFocusRowId).val(),
//            $lrow = $('#activity_' + iFocusRowId + '_RowId_' + irid),
//            $tr_resqty = $('input[id*=activity_' + iFocusRowId + '_resqty_]');
//        if (tr_length > 2) {
//            $lrow.remove();
//            $row.remove();
//            $('#rowinfoid_' + iFocusRowId).val(irid-1);
//            AddNewRowRes(iFocusRowId);
//            $tr_resqty.trigger('change');
//        } else {
//            $('#rowinfoid_' + iFocusRowId).val(0);
//            if (tr_length != 2) { AddNewRowRes(iFocusRowId);}
//            $row.remove();
//            $tr_resqty.trigger('change');
//        }
//    }
}
function SortOrder(iRowid) {
    var rows = $('tr[id^=activity_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];

        $('#activity_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function SortOrderR(iRowid) {
    var rows = $('tr[id^=activityR_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];

        $('#activityR_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function DeleteResourceR(x) {
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    if (isNullCheck($('#activityR_' + iFocusRowId + '_resid_' + iARowid).val(),'number')==0) return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#activityR_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
            $resname =  $('#activityR_' + iFocusRowId + '_resname_' + irid);
        $row.remove();
        bindResRowAutoComplete($resname);
        ValueChangeR($($resname)[0].id);
        SortOrderR(iFocusRowId);
    }
}
function ChangeWorkQty(x) {
    var sStr = x.split("_");
    $('input[id*='+ sStr[0] +'_' + sStr[1] + '_resqty_]').trigger('change');
}
function bindTRDeleteFn(reset) {
    var $trDelete = $('a[class*=mainTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className;
        if (name.indexOf('__') != -1) return;
        $this.on('click', function(e) {
            e.preventDefault();
            if (confirm('Do you want to Delete')) {
                var key = name.split('_')[1],
                    resName = $('#resname_' + key).val();

                var tr_length = $('#sample12 > tbody tr[id*=ResourceiRowId_]').length,
                    $lrow = $('#activity_' + key + '_restable');
                if(tr_length <= 1) {
                    $('#rowid').val(0);
                    AddNewRowA(name, false);
                }
                $lrow.remove();
                $this.closest('tr').nextAll('.subTr_' + name.split('_')[1])[0].remove();
                $this.closest('tr').remove();
                deleteResNameCheck(resName);
            }
            return false;
        });
    });
}

function deleteResNameCheck(resName) {
    var $resgroups = $('textarea[id*=resname_]');
    $.each($resgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        var sResName = $('#' + name).val();
        if (sResName == resName &&  $('#' + name).hasClass('error')) {
            console.log(sResName);
            CheckResName(name);
        }
    });

}

function DeleteSteelRow(id) {
    var sStr = id.split("_"),
        key1 = sStr[1],
        key2= sStr[3];

    if (confirm('Do you want to Delete')) {
        var $tr = $('#steel_' + key1 + '_RowId_' + key2),
            tr_length = $('tr[id*=steel_' + key1 + '_RowId_]').length;
        if (tr_length != 1) {
            $tr.remove();
            $('#rowinfoidS_' + iFocusRowId).val(tr_length-1);

            if (tr_length-1 <=1) $('#generalinfo_' + iFocusRowId + '_mtype').prop('disabled', false);

        } else {
            $('#rowinfoidS_' + iFocusRowId).val(0);
            $('#generalinfo_' + iFocusRowId + '_mtype').prop('disabled', false);
            AddNewsteelRow(tr, false);
            $tr.remove();
        }
    }
}
function bindnewUnitAutoComplete(key) {
    var name = 'newundunit_'+key;
    $('#' + name).autocomplete({
        lookup: arrayunitlist,
        showNoSuggestionNotice:false,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#newundunitid_'+key).val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $('#newundunitid_'+key).val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $('#newundunitid_'+key).val(0);
                $(this).addClass('error');
            } else $(this).removeClass('error');
        }
    });
}

function bindWUnitAutoComplete(id) {
    var $key = $('#generalinfo_'+id+'_wunit'),
        name = 'generalinfo_'+id+'_wunitname';
    $('#' + name).autocomplete({
        lookup: arraywunitlist,
        showNoSuggestionNotice:false,
//        noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newworkunit_'+ id  +'" class="btn btn-link" id="newworkunit_'+ id +'" value="Work Unit" onclick="return AddNewUnit('+name+')" >',
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $key.val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $key.val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $key.val(0);
                $(this).addClass('error');
            } else $(this).removeClass('error');
        }
    });
}

function bindWorkUnitAutoComplete() {
    $units = $('input[id*=_wunitname]');
    $units.unbind('autocomplete');
    $.each($units, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        $this.autocomplete({
            lookup: arraywunitlist,
            showNoSuggestionNotice:false,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newunit_'+ key1  +'" class="btn btn-link" id="newunit_'+ key1 +'" value="Unit" onclick="return AddNewUnit('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#generalinfo_" + key1 + "_wunit").val(suggestion.data);
                    removeError($(this));
                }
                AddNewRowA($this[0].id);
//                $('.mainTrDelete_'+key1).show();
            },
            onSearchStart: function(suggestion) {
                $("#generalinfo_" + key1 + "_wunit").val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#generalinfo_" + key1 + "_wunit").val(0);
                } else removeError($(this));
            }
        });
    });
}

$(function () {
    var rfcid = $('#rfcUId').val();
    var url1 = getBaseURL() + "project/rfc/getrfcresourcepicklist/" + rfcid;
    var rfcsource =
    {
        dataType: "json",
        dataFields: [
            { name: 'ResourceId', type: 'number' },
            { name: 'ResourceName', type: 'string' },
            { name: 'TypeName', type: 'date' },
            { name: 'ResourceGroupName', type: 'string' },
            { name: 'available', type: 'boolean' }
        ],
        id: 'ResourceId',
        url: url1
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    $("#grid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            { text: 'ResourceId', datafield: 'ResourceId', hidden: true},
            { text: 'Type Name', datafield: 'TypeName', width: '20%'  },
            { text: 'Resource Group', datafield: 'ResourceGroupName', width: '30%' },
            { text: 'Resource Name', datafield: 'ResourceName', width: '30%' },
            { text: 'Action', align:'center', datafield: 'available', columntype: 'checkbox', width: '20%' }
        ]
    });
    $("#grid").bind('cellendedit', function (event) {
        if (event.args.value) {
            $("#grid").jqxGrid('selectrow', event.args.rowindex);
        } else {
            $("#grid").jqxGrid('unselectrow', event.args.rowindex);
        }
    });
    if (bSiteMix ==true){var sTable = 'activity_' + iFocusRowId + '_restable';}
    else {var sTable = 'activityR_' + iFocusRowId + '_restable';}
    $('#' + sTable + ' tbody').on( 'dblclick', 'tr', function () {
        $(this).toggleClass('selected',true);
    })
    $('#' + sTable + ' tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected',false);
    })
    var $formulaExp = $("#formulaexp");
    $('#formula').on('shown.bs.modal', function () {
        $formulaExp.focus();
        $formulaExp.select();
    });
    bindAutoComplete();
    bindWorkUnitAutoComplete();
    bindResourceAutoComplete();
    expandTrFn();
    bindTRDeleteFn();
    bindResourceChange();
    bindPopOver();
});
function nextresource() {
    var rows = $("#grid").jqxGrid('getrows');
    var id = "";
    for (var m = 0; m < rows.length; m++) {
        var row = $("#grid").jqxGrid('getrowdata', m);
        if (row.available==true) {
            id=id + row.ResourceId + ',';
        }
    }
    if (id.length !=0 ) {
        id = id.slice(0,-1);
        $.post(getBaseURL() + 'project/rfc/getresourceedit', {ids: id}, function (data) {
            var obj = jQuery.parseJSON(data);
            var objT =obj['trans'];
            var sOldid = "_1";
            // empty table before insert
            $('#sample12 > tbody > tr:not(.remarks)').remove();
            var iRowId = 0;
            for (var i = 0; i < objT.length; i++) {
                var ioRowId = iRowId;
                iRowId += 1;
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId != 1) ioRowId = (ioRowId * 2) - 1;
                $('#sample12 > tbody > tr:last').before(sStr);
                // bind row values
                $("#typeid_"+iRowId).val(objT[i].TypeId);
                $("#typename_"+iRowId).val(objT[i].TypeName);
                $("#resgroupid_"+iRowId).val(objT[i].ResourceGroupId);
                $("#resgroupname_"+iRowId).val(objT[i].ResourceGroupName);
                $("#code_"+iRowId).val(objT[i].Code);
                $("#resname_"+iRowId).val(objT[i].ResourceName);
                $("#unitid_"+iRowId).val(objT[i].UnitId);
                $("#unitname_"+iRowId).val(objT[i].UnitName);
                //$("#rate_"+iRowId).val(objT[i].Rate);
                $('#rowid').val(iRowId);
                $('.mainTrDelete_' + iRowId).hide();

                if(objT[i].TypeId == 1)
                    $('.mainTr_' + iRowId).hide();
            }
            closedetails('');
            bindAutoComplete(true);
            expandTrFn(true);
            bindResourceChange();
            bindPopOver();
            bindTRDeleteFn(true);
        });
        $('#edit-list').hide();
        $('#next-btn').hide();
        $('#edit-content').show();
        $('#submit-btn').show();
        $('#back-btn').show();
    } else alert('Select Resource(s)');
}
function backButton() {
    closedetails('');
    $('#edit-list').show();
    $('#next-btn').show();
    $('#edit-content').hide();
    $('#submit-btn').hide();
    $('#back-btn').hide();
}
//function closedetails(key) {
//    var $mainTRs = $("a[class*=mainTr_]");
//    $.each($mainTRs, function (i, obj) {
//        var $this = $(this),
//            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
//        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
//        if($mainTr.length != 0) $mainTr.trigger('click');
//    });
//}
function closedetails(name) {
    var $mainTRs = $("a[class*=mainTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this);
        if (name != $this[0].className) {
            key = $this[0].className.split('_')[1];
            var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
                $i = $(this).find("i");
            if ($subTr.is(":visible")) {
                $subTr.find(".subDiv").slideUp("slow");
                $subTr.slideUp("slow");
                $i.removeClass("fa-chevron-circle-up");
                $i.addClass("fa-chevron-circle-down");
            }
        }
    });
}

function AddNewRowA(id ,is_validate) {
    var iEditId = parseInt(isNullCheck($('#editid').val(),'number'));
    if (iEditId !=0) return;

    var iRows = parseInt($('#rowid').val()),
        key = id.split('_')[1];

    if($('#ResourceiRowId_' + key).nextAll('tr[id*=ResourceiRowId_]').length >= 1) return;
    if (typeof is_validate == 'undefined' && is_validate != false) {
        if ($('#resgroupid_' + key).val().length == 0) return;
        if ($('#resname_' + key).val().length == 0) return;
        if ($('#unitid_' + key).val().length == 0) return;
    }
    var ioRowId = iRows;
    iRows += 1;
    var sStr = $('#dummytable tbody').html();
    sStr = sStr.replace(/__1/g, '_' + iRows);
    sStr = sStr.replace(/__9/g, '_1');
    if (ioRowId != 1) ioRowId = (ioRowId * 2) - 1;
    $('#sample12 > tbody > tr.subTr_' + key).after(sStr);
    $('#rowid').val(iRows);
    $('.mainTrDelete_' + key).show(); // show delete icon

    checkResource(iRows,"");
    checkResource(iRows,"R");
    closedetails('');
    bindAutoComplete(true);
    expandTrFn(true);
    bindTRDeleteFn(true);
    bindResourceChange();
    bindPopOver();
}
function AddNewRowRes(key) {

    var sRow = '#rowinfoid_' + key,
        irowinfoId = $(sRow).val();
    $('#activity_' + key + '_resdel_' + irowinfoId).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#activity_' + key + '_restable';
//    var sStr = '<tr id="activity__1_RowId__9">' + $("#activity__1_RowId__9").html() + '</tr>';
    var sStr = $("#dummy-activity-row").html();
    sStr = sStr.replace(/__1/g, '_' + key);
    sStr = sStr.replace(/__9/g, '_' + irowinfoId);
    $(stabelrow + " tbody.sorting tr:last-child").after(sStr);

    checkResource(key, "");
    $(sRow).val(irowinfoId);
    bindResourceAutoComplete(key);
    bindResourceChange();
    bindPopOver();
}
function AddNewRowResR(key) {
    var sRow = '#rowinfoidR_' + key,
        irowinfoId  = $(sRow).val();
    $('#activityR_'+key+'_resdel_' + irowinfoId).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#activityR_' + key + '_restable';
//    var sStr = '<tr id="activityR__1_RowId__9">' + $("#activityR__1_RowId__9").html() + '</tr>';
    var sStr = $("#dummy-activityR-row").html();
    sStr = sStr.replace(/__1/g, '_' + key);
    sStr = sStr.replace(/__9/g, '_' + irowinfoId);
    $(stabelrow+" tbody.sorting tr:last-child").after(sStr);


    checkResource(key,"R");
    $(sRow).val(irowinfoId);
    bindResourceAutoComplete(key);
    bindResourceChange();
    bindPopOver();
}
function AddNewsteelRow(tr,is_validate) {
    var $tr = $('#' + tr),
        keys = tr.split('_'),
        iFocusRowId = keys[1],
        key = keys[3];
    if($tr.next('tr').length != 0) return;
    if (typeof is_validate == 'undefined' && is_validate != false) {
        if ($('#steel_' + iFocusRowId + '_steeldes_' + key).val().length == 0) return;
        if ($('#steel_' + iFocusRowId + '_dia_' + key).val().length == 0) return;
        if ($('#steel_' + iFocusRowId + '_factor_' + key).val().length == 0) return;

    }
    $('#steel_' + iFocusRowId + '_delrow_' + key).show();
    var id = $tr[0].id,
        $sRow = $('#rowinfoidS_' + iFocusRowId),
        sRow = parseInt($sRow.val()) + 1;
//        sStr= '<tr id="steel__1_RowId__9">' + $("#steel__1_RowId__9").html() + '</tr>';
    var sStr = $("#dummy-steel-row").html();
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ sRow);
    $tr.after(sStr);
    $sRow.val(sRow);
    if (sRow >1) $('#generalinfo_' + iFocusRowId + '_mtype').prop('disabled', true);
}
function ValueChange(x) {
    var sStr = x.split("_"),
        iFocusRowId = sStr[1],
        iARowid = sStr[3],
        dQty = parseFloat(isNullCheck($("#activity_" + iFocusRowId + "_resqty_" + iARowid).val(),'number')),
        dRate =  parseFloat(isNullCheck($("#activity_" + iFocusRowId + "_resrate_" + iARowid).val(),'number')),
        dAmt = dQty*dRate;
    $("#activity_" + iFocusRowId + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
    var iRows = $('#rowinfoid_' + iFocusRowId).val(),
        dTAmt = 0;
    for (var i = 1; i <= iRows; i++) {
        var amt = parseFloat(isNullCheck($("#activity_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        dTAmt += amt;
    }
    $('#activity_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
    var dAnalQty = parseFloat(isNullCheck($('#activity_' + iFocusRowId + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $('#activity_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
    var sUnit = $('#unitname_'+iFocusRowId).val();
    $('#activity_' + iFocusRowId + '_ltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $('#activity_' + iFocusRowId + '_lperrate').html('Rate per ' + sUnit);
    var dNetRate = dTAmt/dAnalQty;
    $('#analrateM_' + iFocusRowId).val(sanitizeNumber(dNetRate,2,true));
    $('#activity_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
    MainRateUpdate();
}
function MainRateUpdate() {
    var sVal = $('#analrate_' + iFocusRowId).val(),
        dRate='';
    if (sVal=='M') dRate = parseFloat(isNullCheck($('#analrateM_' + iFocusRowId).val(),'number'));
    else if (sVal=='A') dRate =  parseFloat(isNullCheck($('#analrateA_' + iFocusRowId).val(),'number'));
    else if (sVal=='L') dRate =  parseFloat(isNullCheck($('#analrateLS_' + iFocusRowId).val(),'number'));
    $('#rate_' + iFocusRowId).val(sanitizeNumber(dRate,2,true));
}
function ValueChangeR(x) {
    var sStr = x.split("_"),
        iFocusRowId = sStr[1],
        iARowid = sStr[3],
        dQty =  parseFloat(isNullCheck($("#activityR_" + iFocusRowId + "_resqty_" + iARowid).val(),'number')),
        dRate = parseFloat(isNullCheck($("#activityR_" + iFocusRowId + "_resrate_" + iARowid).val(),'number')),
        dAmt = dQty*dRate;
    $("#activityR_" + iFocusRowId + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
    var iRows = $('#rowinfoidR_' + iFocusRowId).val();
    var dTAmt = 0;
    for (var i = 1; i <= iRows; i++) {
        var amt = parseFloat(isNullCheck($("#activityR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        dTAmt += amt;
    }
    $('#activityR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
    var dAnalQty = parseFloat(isNullCheck($('#activityR_' + iFocusRowId + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $('#activityR_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
    var sUnit = $('#unitname_'+iFocusRowId).val();
    $('#activityR_' + iFocusRowId + '_ltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $('#activityR_' + iFocusRowId + '_lperrate').html('Rate per ' + sUnit);
    var dNetRate = dTAmt/dAnalQty;
    $('#analrateA_' + iFocusRowId).val(sanitizeNumber(dNetRate,2,true));
    $('#activityR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
    MainRateUpdate();
}
function validateAndAddTabs(name) {
    var id = name.split('_')[1],
        iFocusRowId =  id;
    if ($('tr.subTr_' + id).html() != "") return true;
    var $resgroupid = $('#resgroupid_'+ iFocusRowId),
        $resgroupName = $('#resgroupname_' + iFocusRowId),
        $resname = $('#resname_'+ iFocusRowId),
        $unitid = $('#unitid_'+ iFocusRowId),
        $unitName = $('#unitname_'+ iFocusRowId);
    if ($resgroupid.val().length==0) {
        showError($resgroupName, 'Required');
        return false;
    } else
        removeError($resgroupName);

    if($.trim($resname.val()).length==0)  {
        showError($resname, 'Required');
        return false;
    } else
        removeError($resname);

    if($unitid.val().length==0) {
        showError($unitName, 'Required');
        return false;
    } else
        removeError($unitName);

    $resgroupName.prop('readonly', true);
    var iTypeId = parseInt($('#typeid_'+ iFocusRowId).val());
    switch(iTypeId) {
        case 2:
            var html = $('#dummy-steel-tab').html().replace(/__1/g,'_'+ id).replace(/__9/g, '_1');
            $('tr.subTr_' + id).html('<td colspan="12">' + html + '</td>');
            break;
        case 3:
            var html = $('#dummy-general-tab').html().replace(/__1/g,'_'+ id);
            $('tr.subTr_' + id).html('<td colspan="12">' + html + '</td>');
            bindWUnitAutoComplete(iFocusRowId);
            break;
        case 4:
            var html = $('#dummy-activity-tab').html().replace(/__1/g,'_'+ id).replace(/__9/g, '_1');
            $('tr.subTr_' + id).html('<td colspan="12">' + html + '</td>');
            bindResourceAutoComplete(iFocusRowId);
            break;
    }
    return true;
}
function MaterialTypeChange(value, link) {
    var $link = $('#'+link);
    var key1 = link.split('_')[1];
    $('#mtype_'+key1).val(value);
    if(value =="S" )  $link.show();
    else $link.hide();
}

function fileupload() {
    var isValid=true;
    var $excelpids = $('input[id^=field_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#field_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    if (isValid==false) {alert ("Please Assign Fields Correctly"); return;}

    $("#excelfieldmodal").modal('hide');
    var bValid=true;
    var arrHeader =[];
    for (var i = 0; i < $("#excelfieldTable").find("th").length; i++) {
        arrHeader.push({efield: $('#efield_'+i).val(), field: $('#field_'+i).val()});
    }
    arrHeader =  JSON.stringify(arrHeader);
    formData.append('arrHeader', arrHeader);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() +"project/rfc/uploadresdata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data:  formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);
            var key1=1;
            if (obj[0].Valid==true) {
                $('#excelTable tr:gt(1)').remove();
                var $excelagtnos = $('input[id^=excelagtno_]');
                $.each($excelagtnos, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    key1 = name.split('_')[1];
                });
                var irow = key1;


                $("#excelresgroupname_"+irow).val('');
                $("#exceltype_"+irow).val('');
                $("#excelunit_"+irow).val('');
                $("#excelrate_"+irow).val(sanitizeNumber(0,2,true));
                $("#excelwunit_"+irow).val('');
                $("#excelmtype_"+irow).val('');
                $("#excelleadtime_"+irow).val('');
                $("#excelwrate_"+irow).val(sanitizeNumber(0,2,true));
                $("#excelresgroupid_"+irow).val('0');
                $("#exceltypeid_"+irow).val('0');
                $("#excelunitid_"+irow).val('0');
                $("#excelwunitid_"+irow).val('0');

                for (var i = 0; i < obj.length; i++) {
                    if (irow != key1)  {
                        $("#excelTable tbody tr:last").after('<tr>' + $("#excelTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("textarea").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                    }
                    //excelresname_
                    $("#excelresgroupname_"+irow).val(isNullCheck(obj[i].ResourceGroup,'string'));
                    $("#exceltype_"+irow).val(isNullCheck(obj[i].TypeName,'string'));
                    $("#excelunit_"+irow).val(isNullCheck(obj[i].Unit,'string'));
                    $("#excelrate_"+irow).val(sanitizeNumber(isNullCheck(obj[i].Rate,'number'),2,true));
                    $("#excelwunit_"+irow).val(isNullCheck(obj[i].WUnit,'string'));
                    $("#excelwrate_"+irow).val(sanitizeNumber(isNullCheck(obj[i].WRate,'number'),2,true));
                    $("#excelresgroupid_"+irow).val(isNullCheck(obj[i].ResourceGroupId,'string'));
                    $("#exceltypeid_"+irow).val(isNullCheck(obj[i].TypeId,'number'));
                    $("#excelunitid_"+irow).val(isNullCheck(obj[i].UnitId,'number'));
                    $("#excelwunitid_"+irow).val(isNullCheck(obj[i].WUnitId,'number'));
                    $("#excelresname_"+irow).val(isNullCheck(obj[i].ResourceName,'string'));
                    $("#excelmtype_"+irow).val(isNullCheck(obj[i].MaterialType,'string'));
                    $("#excelleadtime_"+irow).val(sanitizeNumber(isNullCheck(obj[i].LeadTime,'number'),1));

                    //$(".th:contains('None')") .remove();
                    irow = +irow + 1;
                }
            } else {
                bValid=false;
            }
            bindExcelDeleteFn();
            if (bValid==true)
                $("#excelmodal").modal('show');
            else
                alert("Invalid File Format");
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });

//    if (bExcelCode==false) $('.excel-code-txt').hide();
    clearInputFile($('#myfile'));
}


//function fileupload(x) {
//    var bValid=true;
//    var formData = new FormData();
//    formData.append('file', $('#myfile').prop("files")[0]);
//    $.ajax({
//        url: getBaseURL() + "project/rfc/uploadresourcedata",
//        dataType: 'script',
//        async: false,
//        cache: false,
//        contentType: false,
//        processData: false,
//        data: formData,
//        type: 'post',
//        success: function(data,status, xhr) {
//            var obj = jQuery.parseJSON(data);
//            var key1=1;
//            if (obj[0].Valid==true) {
//                $('#excelTable tr:gt(1)').remove();
//                var $excelpids = $('input[id^=excelparent_]');
//                $.each($excelpids, function (i, obj) {
//                    var $this = $(this),
//                        name = $this[0].id;
//                    key1 = name.split('_')[1];
//                });
//                var irow = key1;
//                $("#excelresgroupname_"+irow).val('');
//                $("#exceltype_"+irow).val('');
//                $("#excelresname_"+irow).val('');
//                $("#excelunit_"+irow).val('');
//                $("#excelrate_"+irow).val('');
//                $("#excelresgroupid_"+irow).val('');
//                $("#exceltypeid_"+irow).val('');
//                $("#excelunitid_"+irow).val('');
//                $("#excelwunit_"+irow).val('');
//                $("#excelwrate_"+irow).val('');
//                $("#excelwunitid_"+irow).val('');
//                var sOldid = "_" + key1;
//                for (i = 0; i < obj.length; i++) {
//                    if (irow != key1)  {
//                        var sNewid = "_" + irow;
//                        $("#excelTable tbody tr:last").after("<tr>" + $("#excelTable tbody tr:first").html() + "</tr>");
//                        $("#excelTable tbody tr:last").find("input:text").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                        $("#excelTable tbody tr:last").find("input:hidden").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                    }
//                    bindExcelDeleteFn(true);
//                    $("#excelresgroupname_"+irow).val(obj[i].GroupName);
//                    $("#exceltype_"+irow).val(obj[i].TypeName);
//                    $("#excelresname_"+irow).val(obj[i].ResName);
//                    $("#excelunit_"+irow).val(obj[i].UnitName);
//                    $("#excelrate_"+irow).val(isNullCheck(obj[i].Rate,'number'));
//                    $("#excelresgroupid_"+irow).val(obj[i].GroupId);
//                    $("#exceltypeid_"+irow).val(obj[i].TypeId);
//                    $("#excelunitid_"+irow).val(obj[i].UnitId);
//                    if  (obj[i].TypeId == 3) {
//                        $("#excelwunit_" + irow).val(obj[i].WUnitName);
//                        $("#excelwrate_" + irow).val(isNullCheck(obj[i].WRate, 'number'));
//                        $("#excelwunitid_" + irow).val(obj[i].WUnitId);
//                    } else {
//                        $("#excelwunit_" + irow).val('');
//                        $("#excelwrate_" + irow).val('');
//                        $("#excelwunitid_" + irow).val('');
//                        $("#excelwunit_" + irow).prop('readonly', true);
//                        $("#excelwrate_" + irow).prop('readonly', true);
//                    }
//                    irow = +irow + 1;
//                }
//            } else {
//                bValid=false;
//            }
//            if (bValid==true) {$("#excelmodal").modal('show');}
//            else { alert("Invalid File Format"); }
//        },
//        error: function(xhr, status, errorThrown) {
//            if (xhr.status == 400)
//                alert(xhr.responseText);
//            else
//                alert(errorThrown);
//        }
//    });
//    clearInputFile($('#myfile'));
//    excelvalid();
//}

function excelvalid() {
    var $excelpids = $('input[id^=excelresgroupname_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = name.split('_')[1];
        if (isNullCheck($("#excelresgroupid_" + ikey).val(), 'number') == 0)  $('#excelresgroupname_' + ikey).addClass('error');
        if (isNullCheck($("#exceltypeid_" + ikey).val(), 'number') == 0)  $('#exceltype_' + ikey).addClass('error');
        if (isNullCheck($("#excelunitid_" + ikey).val(), 'number') == 0)  $('#excelunit_' + ikey).addClass('error');
        if (isNullCheck($("#exceltypeid_" + ikey).val(), 'number') == 3) {
            if (isNullCheck($("#excelwunitid_" + ikey).val(), 'number') == 0) $('#excelwunit_' + ikey).addClass('error');
        }
    });
}
function showmix(x, tab) {
    $(tab).addClass('active').siblings('li').removeClass('active');
    if (x=="machinery") {
        $('#activity_'+iFocusRowId+'_restable').hide();
        $('#activityWQty_' + iFocusRowId).hide();
        $('#activityR_'+iFocusRowId+'_restable').show();
        $('#activityWQtyR_' + iFocusRowId).show();
        return;
    }
    $('#activity_'+iFocusRowId+'_restable').show();
    $('#activityWQty_' + iFocusRowId).show();
    $('#activityR_'+iFocusRowId+'_restable').hide();
    $('#activityWQtyR_' + iFocusRowId).hide();
}
function formulacalculation() {
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            fvaule = computeEval(sformula);
            $('#btnformula').prop('readonly', false);
        } catch (e) {
            $('#btnformula').prop('readonly', true);
            alert('Expression in invalid.');
        }
    }
    $("#formulavalue").val(parseFloat(fvaule).toFixed(3));

    if (isNullCheck(fvaule,'number') < 0) {
        $('#formulavalue').addClass('error');
        return;
    } else $('#formulavalue').removeClass('error');

}
function showformulaR(x,bshow) {
    bSiteMix=false;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#activityR_" + iFocusRowId + "formula_" + iTransRowId,
        sExpression = $(sExp).val();
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }

    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val();
    var fvaule=0;
    if (sformula.length >0) {
        try {
            fvaule = computeEval(sformula);
            $('#btnformula').prop('readonly', false);
        } catch (e) {
            $('#btnformula').prop('readonly', true);
            alert('Expression in invalid.');
        }
        $("#activitR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(parseFloat(fvaule).toFixed(3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = $("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).val();

        $("#formulaexp").val(fvaule);
        $("#formulavalue").val(parseFloat(fvaule).toFixed(3));
        $("#formula").modal('show');
    } else {
        $("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
    }
}
function showformula(x,bshow) {
    bSiteMix=true;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#activity_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = $(sExp).val();
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#activity_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#activity_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }

    $("#formulaexp").val(sExpression);
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            fvaule = computeEval(sformula);
            $('#btnformula').prop('readonly', false);
        } catch (e) {
            $('#btnformula').prop('readonly', true);
            alert('Expression in invalid.');
        }
        $("#activity_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(parseFloat(fvaule).toFixed(3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#activity_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = $("#activity_" + iFocusRowId + "_resqty_" + iTransRowId).val();

        $("#formulaexp").val(fvaule);
        $("#formulavalue").val(parseFloat(fvaule).toFixed(3));
        $("#formula").modal('show');
    } else $("#activityR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);

    if (isNullCheck(fvaule,'number') < 0) {
        $('#formulavalue').addClass('error');
        return;
    } else $('#formulavalue').removeClass('error');
}
function showF(x,event) {
    if(event.keyCode ==113) {
        showformula(x,true);
        event.preventDefault();
    }
}
function showFR(x,event) {
    if(event.keyCode ==113) {
        showformulaR(x,true);
        event.preventDefault();
    }
}
function formulaok() {
    if ($('#formulavalue').hasClass('error')) return;
    if (bSiteMix==true) {
        var sExp = "#activity_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#activity_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = $("#formulavalue").val();
        $(sExp).val(sformulaexp);
        $(sqty).val(sformulaval);
        var sQtyRow = "#activity_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#activity_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#activity_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = $(sQtyRow).val();
        var dRate = $(sRateRow).val();
        var dAmt = dQty * dRate;
        $(sAmtRow).val(parseFloat(dAmt).toFixed(2));
        var iRows = $('#rowinfoid_' + iFocusRowId).val();
        var dTAmt = 0;
        for (var i = 1; i <= iRows; i++) {
            dTAmt = dTAmt + parseFloat($("#activity_" + iFocusRowId + "_resamt_" + i).val());
        }
        $('#activity_' + iFocusRowId + '_totrate').val(parseFloat(dTAmt).toFixed(2));
        var dAnalQty = $('#activity_' + iFocusRowId + '_AnalQty').val();
        if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $('#activity_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
        var sUnit = $('#unitname_'+iFocusRowId).val();
        $('#activity_' + iFocusRowId + '_ltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
        $('#activity_' + iFocusRowId + '_lperrate').html('Rate per ' + sUnit);
        var dNetRate = dTAmt/dAnalQty;
        $('#analrateM_' + iFocusRowId).val(parseFloat(dNetRate).toFixed(2));
        $('#activity_' + iFocusRowId + '_perrate').val(parseFloat(dNetRate).toFixed(2));
        MainRateUpdate();
    } else {
        var sExp = "#activityR_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#activityR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = $("#formulavalue").val();
        $(sExp).val(sformulaexp);
        $(sqty).val(sformulaval);
        var sQtyRow = "#activityR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#activityR_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#activityR_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = $(sQtyRow).val();
        var dRate = $(sRateRow).val();
        var dAmt = dQty * dRate;
        $(sAmtRow).val(parseFloat(dAmt).toFixed(2));
        var iRows = $('#rowinfoidR_' + iFocusRowId).val();
        var dTAmt = 0;
        for (var i = 1; i <= iRows; i++) {
            dTAmt = dTAmt + parseFloat($("#activityR_" + iFocusRowId + "_resamt_" + i).val());
        }
        $('#activityR_' + iFocusRowId + '_totrate').val(parseFloat(dTAmt).toFixed(2));
        var dAnalQty = $('#activityR_' + iFocusRowId + '_AnalQty').val();
        if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $('#activityR_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
        var sUnit = $('#unitname_'+iFocusRowId).val();
        $('#activityR_' + iFocusRowId + '_ltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
        $('#activityR_' + iFocusRowId + '_lperrate').html('Rate per ' + sUnit);
        var dNetRate = dTAmt/dAnalQty;
        $('#analrateA_' + iFocusRowId).val(parseFloat(dNetRate).toFixed(2));
        $('#activityR_' + iFocusRowId + '_perrate').val(parseFloat(dNetRate).toFixed(2));
        MainRateUpdate();
    }
    $('#formula').modal('toggle');
}
function AddNewresGroup(x)
{
    var sStr = x.id.split("_");
    iFocusRowId= sStr[1];
    sResgroupUpdateMode='Add';

    $("#newresgroupok").html('Create');
    $("#resgroupmodal").attr('data-input',x.id).modal('show');
    $('#refNewResgroupRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#resgroupname').val($(x).val());
    $('#resgrouptype').val('');
    $('#resgrouptypeid').val('');
    $('#' + x.id).prop('readonly', false);
    $("#resgroupmodal").modal('show');
}
function ResourceClose() {
    if (sResUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewResRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#resourcemodal').modal('toggle');
}
function ResourceGroupClose() {
    if (sResgroupUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewResgroupRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#resgroupmodal').modal('toggle');
}
function unitClose() {
    $('#unitmodal').modal('toggle');
}
function unitShow() {
    $('#unitmodal').modal('toggle');
}
function unitUpdate() {
    var isValid= true;
    var $codes = $('[id^=undunit_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 ) return;
        var key1 = name.split('_')[1],
            sNewUnit = isNullCheck($('#newundunit_' + key1).val(), 'string'),
            iUnitId = parseInt(isNullCheck($('#newundunitid_'+key1).val(),'number'));
        if (sNewUnit !="" && iUnitId == 0) {
            isValid = false;
            return;
        }
    });

    if (isValid == true) {
        var $codes = $('[id^=undunit_]');
        $.each($codes, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            if (name.indexOf('__') != -1) return;
            var key1 = name.split('_')[1],
                sOldUnit = isNullCheck($('#undunit_' + key1).val(), 'string'),
                sNewUnit = isNullCheck($('#newundunit_' + key1).val(), 'string'),
                iUnitId = parseInt(isNullCheck($('#newundunitid_' + key1).val(), 'number'));
            checkUnitUpdate(sOldUnit, sNewUnit, iUnitId);
        });
        unitLoad();
        $('#unitmodal').modal('toggle');
    }
}
function checkUnitUpdate(oldUnit,newUnit,UnitId) {
    var $codes = $('[id^=unitid_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var key1 = name.split('_')[1];
        if ($('#unitname_' + key1).val() ==  oldUnit) {
            $('#unitname_' + key1).val(newUnit).trigger('focus');
            $('#unitid_' + key1).val(UnitId);
            $('#unitname_' + key1).prop('readonly', true);
        }
    });
}

function unitLoad() {
    var $codes = $('[id^=unitid_]');
    var iRow=0;
    $('#divununit').hide();
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            key = name.split('_')[1];
        var sUnit = isNullCheck($('#unitname_'+key).val(),'string');
        if (sUnit !="") {
            if (checkUnUnitFound(sUnit) ==false) {
                if (parseInt(isNullCheck($('#' + name).val(), 'number')) == 0) {
                    iRow = +iRow + 1;
                    var sStr = $('#dummyunittable tbody').html();
                    sStr = sStr.replace(/__1/g, '_' + iRow);
                    $("#unittable tbody tr:last").after(sStr);
                    $('#undunit_' + iRow).val(sUnit);
                    bindnewUnitAutoComplete(iRow);
                }
            }
        }
    });
    if (iRow >0) $('#divununit').show();
}

function checkUnUnitFound(sUnit) {
    var bFound=false;
    var $codes = $('[id^=undunit_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            sUnitName = isNullCheck($('#'+name).val(),'string');
        if (sUnit == sUnitName) {
            bFound=true;
            return bFound;
        }
    });
    return bFound;
}

function ResourcegroupUpdate() {
    var isValid =true;
    var icodegenType = parseInt(isNullCheck($('#groupcodegenType').val(),'number'));
    if (icodegenType==0) {
        CheckResGroupCode();
        if ($('#resgroupcode').hasClass('error')) isValid = false;
        if ($('#resgroupcode').val().length==0) {
            showError($('#resgroupcode'), 'Required');
            isValid = false;
        }
    }
    CheckResGroupName();
    if ($('#resgroupname').hasClass('error')) isValid=false;
    if ($('#resgroupparent').hasClass('error')) isValid=false;
    if ($('#resgrouptype').hasClass('error')) isValid=false;
    if (isNullCheck( $('#resgrouptypeid').val(),'number') ==0) isValid=false;
    if (isValid==false) return;

    var resgroupname = isNullCheck($('#resgroupname').val(),'string'),
        resgroupcode = isNullCheck($('#resgroupcode').val(),'string'),
        resgroupparentid = isNullCheck($('#resgroupparentid').val(),'number'),
        resgroupparent = isNullCheck($('#resgroupparent').val(),'string'),
        resgrouptype = isNullCheck($('#resgrouptype').val(),'string'),
        resgrouptypeid = isNullCheck($('#resgrouptypeid').val(),'number');

    var irow = 0;
    if (sResgroupUpdateMode=='Add') {
        var irows =  parseInt(isNullCheck($('#resgrouprowid').val(),'number'));
        irow = +irows+1;
        if ($('#newresgroupname_'+irow).val() !="") {
            var html = $("#newresgroup tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newresgroup tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#resgrouprowid').val(irow);
    } else irow = $('#resgrouprowid').val();

    $('#newresgrouprowrefid_'+irow).val(irow);
    $('#newresgroupcode_'+ irow).val(resgroupcode);
    $('#newresgroupname_'+ irow).val(resgroupname);
    $('#newresgroupparent_'+ irow).val(resgroupparent);
    $('#newresgroupparentid_'+ irow).val(resgroupparentid);
    $('#newresgrouptype_'+ irow).val(resgrouptype);
    $('#newresgrouptypeid_'+ irow).val(resgrouptypeid);
    $('#newresgroupitems').show();
    $('#butnewresgroupitems').html("New Resource Group Created " + " : <i class='fa fa-long-arrow-right'></i><span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();


    if (sResgroupUpdateMode=='Add') {
        var sWid = "0." + irow;

        arrayresgroup.push({
            data: sWid,
            value: resgroupname,
            TypeId: resgrouptypeid,
            TypeName:resgrouptype
        });

        var $newResRow = $('#' + $('#refNewResgroupRowName').val()),
            key = $newResRow[0].id.split('_');

        $('#resgroupid_' + key[1]).val(sWid);
        $('#typename_' + key[1]).val(resgrouptype);
        $('#typeid_' + key[1]).val(resgrouptypeid);

        // new added code



        if (resgrouptypeid !=4) $('#rate_' + key[1]).removeAttr('readonly');

        $newResRow.val('');
        $newResRow.removeClass('error');
        $newResRow.val(resgroupname);
        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
        checkRegGroup(resgroupname,resgrouptype,resgrouptypeid,sWid);
    }
    $('#resgroupmodal').modal('toggle');
}



function ResourceUpdate() {
    var isValid =true;
    var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
    if (icodegenType==0) {
        CheckResCodeNew();
        if ($('#rescode').hasClass('error')) isValid = false;
        if ($('#rescode').val().length == 0){
            showError($('#rescode'), 'Required');
            isValid = false;
        }
    }

    CheckResNameNew();
    if ($('#resname').hasClass('error')) isValid=false;
    if ($('#resgroup').hasClass('error')) isValid=false;
    else if ($('#resunit').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#resgroupid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#restypeid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#resunitid').val(),'number') ==0) isValid=false;
    var restypeid= parseInt(isNullCheck($('#restypeid').val(),'number'));
    if (restypeid==3) {
        if (isNullCheck( $('#wresunitid').val(),'number') ==0) isValid=false;
    }
    if (isValid==false) return;
    var resname = isNullCheck($('#resname').val(),'string'),
        resgroupid = isNullCheck($('#resgroupid').val(),'number'),
        resgroup = isNullCheck($('#resgroup').val(),'string'),
        resunit = isNullCheck($('#resunit').val(),'string'),
        resunitid = isNullCheck($('#resunitid').val(),'number'),
        wresunit = isNullCheck($('#wresunit').val(),'string'),
        wresunitid = isNullCheck($('#wresunitid').val(),'number'),
        restype = isNullCheck($('#restype').val(),'string'),
        resrate = isNullCheck($('#resrate').val(),'number'),
        wresrate = isNullCheck($('#wresrate').val(),'number'),
        reslead = isNullCheck($('#reslead').val(),'number'),
        resmattype = isNullCheck($('#resmattype').val(),'string'),
        rescode = isNullCheck($('#rescode').val(),'string');
    var irow = 0;
    if (sResUpdateMode=='Add') {
        //var irows = $('#newres tr').length;
        var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
        irow = +irows+1;
        if ($('#newresname_'+irow).val() !="") {
            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newresrowid').val(irow);
    } else irow = $('#resrowid').val();
    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created " + " : <i class='fa fa-long-arrow-right'></i><span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();

    if (sResUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWSpec = 'New.' + irow + ' ' + resname;

        var sUnit =resunit,iUnitId=resunitid;
        var dRate = resrate;
        if (restypeid==3) {
            sUnit =wresunit;
            iUnitId=wresunitid;
            dRate = wresrate;
        }


        arrayreslist.push({
            data: sWid,
            value: sWSpec,
            UnitName: sUnit,
            UnitId: iUnitId,
            ResourceName: resname,
            Rate:dRate
        });

        var $newResRow = $('#' + $('#refNewResRowName').val()),
            key = $newResRow[0].id.split('_');
        if (bSiteMix==false) {
            var ssname = 'activityR_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#activityR_' + key[1] + '_resunitid_' + key[3]).val(iUnitId);
            $('#activityR_' + key[1] + '_resid_' + key[3]).val(sWid);
            $('#activityR_' + key[1] + '_resrate_' + key[3]).val(sanitizeNumber(dRate,2,true));
            $('#activityR_' + key[1] + '_newresname_' + key[3]).val(resname);
        } else {
            var ssname = 'activity_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#activity_' + key[1] + '_resunitid_' + key[3]).val(iUnitId);
            $('#activity_' + key[1] + '_resid_' + key[3]).val(sWid);
            $('#activity_' + key[1] + '_resrate_' + key[3]).val(sanitizeNumber(dRate,2,true));
            $('#activity_' + key[1] + '_newresname_' + key[3]).val(resname);
        }

        $newResRow.val('');
        $newResRow.removeClass('error');
        bindResRowAutoComplete($newResRow);
        bindResourceChange();
        bindPopOver();
        $newResRow.val(sWSpec);
        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
        if (bSiteMix==false) AddNewRowResR(key[1]);
        else AddNewRowRes(key[1]);
    } else {


    }
    $('#resourcemodal').modal('toggle');



//    var isValid =true;
//    if ($('#resgroup').hasClass('error')) isValid=false;
//    else if ($('#resunit').hasClass('error')) isValid=false;
//    else if (isNullCheck( $('#resgroupid').val(),'number') ==0) isValid=false;
//    else if (isNullCheck( $('#restypeid').val(),'number') ==0) isValid=false;
//    else if (isNullCheck( $('#resunitid').val(),'number') ==0) isValid=false;
//    if (isValid==false) return;
//    var resname = $('#resname').val(),
//        resgroupid = $('#resgroupid').val(),
//        resgroup = $('#resgroup').val(),
//        resunit = $('#resunit').val(),
//        resunitid = $('#resunitid').val(),
//        restype = $('#restype').val(),
//        restypeid= $('#restypeid').val(),
//        resrate = $('#resrate').val();
//    var irow = 0;
//    if (sResUpdateMode=='Add') {
//        var irows = $('#newres tr').length;
//        irow = irows-1;
//        if ((irow !=1) || ( irow==1 && $('#newresname_1').val() !="")) {
//            irow = +irow+1;
//            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
//            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
//        }
//        $('#resrowid').val(irow);
//    } else irow = $('#resrowid').val();
//    $('#newresname_'+ irow).val(resname);
//    $('#newresgroup_'+ irow).val(resgroup);
//    $('#newresgroupid_'+ irow).val(resgroupid);
//    $('#newrestype_'+ irow).val(restype);
//    $('#newrestypeid_'+ irow).val(restypeid);
//    $('#newresunit_'+ irow).val(resunit);
//    $('#newresunitid_'+ irow).val(resunitid);
//    $('#newresrate_'+ irow).val(resrate);
//    $('#newresitems').show();
//    $('#butnewresitems').html("New Resource Created " + " : <i class='fa fa-long-arrow-right'></i><span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();
//    var sWid = "0." + irow;
//    var sWSpec = 'New.' + irow + ' ' + resname;
//    arrayreslist.push({
//        data: sWid,
//        value: sWSpec,
//        UnitName: resunit,
//        UnitId: resunitid,
//        ResourceName: resname
//    });
//
////    if (sResUpdateMode=='Add') {
////        var irows = $('#newres tr').length;
////        irow = irows-1;
////        if ((irow !=1) || ( irow==1 && $('#newresname_1').val() !="")) {
////            irow = +irow+1;
////            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
////            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
////        }
////        $('#resrowid').val(irow);
////        $('#newresrowid').val(irow);
////        $('#newresid_'+ irow).val("New" + irow);
////
////        arrayresgroup.push({
////            data: "New" + irow,
////            TypeName:restype,
////            TypeId:restypeid,
////            value: resname,
////            Rate: resrate
////        });
////    } else {
////        var resid = $('#resid').val(),
////            index = getJsonArrayIndex(arrayresgroup, 'data', resid);
////
////        if(index != -1) {
////            arrayresgroup[index].TypeName = restype;
////            arrayresgroup[index].TypeId = restypeid;
////            arrayresgroup[index].value = resname;
////            arrayresgroup[index].Rate = resrate;
////
////            $.each($('input[id^=resgroupid_][value='+resid+']'),function() {
////                var id = $(this)[0].id.split('_')[1];
////                $('#resgroupname_' + id).val(resname).trigger('change');
////            });
////        }
////        irow = $('#resrowid').val();
////    }
//
//    $('#newresname_'+ irow).val(resname);
//    $('#newresgroup_'+ irow).val(resgroup);
//    $('#newresgroupid_'+ irow).val(resgroupid);
//    $('#newrestype_'+ irow).val(restype);
//    $('#newrestypeid_'+ irow).val(restypeid);
//
//    $('#newresrate_'+ irow).val(resrate);
//    $('#newresitems').show();
//    $('#butnewresitems').html("New Resource Created<span class='badge' style='border-radius:none!important;'>" + irow + "</span>").show();


//    if (sResUpdateMode=='Add') {
//        var $newResRow = $('#' + $('#refNewResRowName').val()),
//            key = $newResRow[0].id.split('_');
//        if (bSiteMix==false) {
//            var ssname = 'activityR_' + key[1] + '_unitname_' + key[3];
//            $("label[for=" + ssname + "]").html(resunit);
//            $('#activityR_' + key[1] + '_unit_' + key[3]).val(resunitid);
//            $('#activityR_' + key[1] + '_resid_' + key[3]).val(sWid);
//        } else {
//            var ssname = 'activity_' + key[1] + '_unitname_' + key[3];
//            $("label[for=" + ssname + "]").html(resunit);
//            $('#activity_' + key[1] + '_unit_' + key[3]).val(resunitid);
//            $('#activity_' + key[1] + '_resid_' + key[3]).val(sWid);
//        }
//        $newResRow.val('');
//        $newResRow.removeClass('error');
//        bindResRowAutoComplete($newResRow);
//        bindResourceChange();
//        bindPopOver();
//        $newResRow.val(sWSpec);
//        $newResRow.trigger('focus');
//        if (bSiteMix==false) AddNewRowResR(key[1]);
//        else AddNewRowRes(key[1]);
//    }
//    $('#resourcemodal').modal('toggle');

//
//    if (sResUpdateMode=='Add') {
//        $resname = $('#' + $("#resourcemodal").attr('data-input'));
//        $resname.val('');
//        $resname.removeClass('error');
//        bindAutoComplete();
//    }
//    checkRegGroup(resname);
//    $('#resourcemodal').modal('toggle');
//    var $newResRow = $('#' + $('#refNewResRowName').val());
//    $newResRow.val(resname);
//    $newResRow.trigger('focus');
}
function ShowNewResource(e) {
    e.preventDefault();
    var $newr = $('#newres');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function ShowNewResourceGroup(e) {
    e.preventDefault();
    var $newr = $('#newresgroup');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function ShowResource(id) {
    var irow = id.split('_')[1];
    $("#newresok").html('Save');
    sResUpdateMode='Edit';
    $('#resrowid').val(irow);
    $('#resid').val($('#newresid_'+ irow).val());
    $('#resname').val($('#newresname_'+ irow).val());
    $('#resgroup').val($('#newresgroup_'+ irow).val());
    $('#rescode').val($('#newrescode_'+ irow).val());
    $('#resgroupid').val($('#newresgroupid_'+ irow).val());
    $('#restype').val($('#newrestype_'+ irow).val());
    $('#restypeid').val($('#newrestypeid_'+ irow).val());
    $('#resunit').val($('#newresunit_'+ irow).val());
    $('#resunitid').val($('#newresunitid_'+ irow).val());
    $('#resrate').val($('#newresrate_'+ irow).val());
    $('#wresunit').val($('#newwresunit_'+ irow).val());
    $('#wresunitid').val($('#newwresunitid_'+ irow).val());
    $('#wresrate').val($('#newwresrate_'+ irow).val());

    $("#resourcemodal").modal('show');
}
function ShowResourceGroup(id) {
    var irow = id.split('_')[1];
    $("#newresgroupok").html('Save');
    sResgroupUpdateMode='Edit';
    $('#resgrouprowid').val(irow);
    $('#resgroupname').val($('#newresgroupname_'+ irow).val());
    $('#resgrouptype').val($('#newresgrouptype_'+ irow).val());
    $('#resgroupparent').val($('#newresgroupparent_'+ irow).val());
    $('#resgroupparentid').val($('#newresgroupparentid_'+ irow).val());
    $('#resgrouptypeid').val($('#newresgrouptypeid_'+ irow).val());
    $('#resgroupcode').val($('#newresgroupcode_'+ irow).val());
    $("#resgroupmodal").modal('show');
}

function getResourceMaster() {
    $.ajax({
        url: getBaseURL() + "project/rfc/getresourcemaster",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function (data, status, xhr) {
            arrResMaster = jQuery.parseJSON(data);
        }
    });
}

function ExcelResourceUpdate() {
    getResourceMaster();

    $('.loading_area').show();
    if (excelSheetValid()==false) {
        $('.loading_area').hide();
        alert("Invalid Sheet");
        return;
    }
    bExcelUpdate =true;
    var iMRowId = $('#rowid').val();
    ioRowId = iMRowId;
    var $excelpids = $('input[id*=excelresgroupname_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            key1 = name.split('_')[1];
        ioRowId = iMRowId;
        if ($('#resname_' + iMRowId).val() != "") { iMRowId = + iMRowId+1;}
        if (iMRowId !=1) {
            var sStr = $('#dummytable tbody').html();
            sStr = sStr.replace(/__1/g, '_' + iMRowId);
            sStr = sStr.replace(/__9/g, '_1');
            if (ioRowId !=1) {ioRowId = (ioRowId*2)-1 ;}
            $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
        }
        //resgroupname_1
        $('#resgroupname_' + iMRowId).val($("#excelresgroupname_"+key1).val()).trigger('change');
        $('#resgroupid_' + iMRowId).val($("#excelresgroupid_"+key1).val());
        $('#typename_'+ iMRowId).val($("#exceltype_"+key1).val());
        $('#resname_'+ iMRowId).val($("#excelresname_"+key1).val());
        $('#unitname_'+ iMRowId).val($("#excelunit_"+key1).val());
        $('#unitid_'+ iMRowId).val($("#excelunitid_"+key1).val());
        $('.mainTr_'+ iMRowId).trigger('click');
        $('#rate_'+ iMRowId).val(sanitizeNumber(isNullCheck($("#excelrate_"+key1).val(),'number'),2,true));
        $('#analrateLS_'+ iMRowId).val(sanitizeNumber(isNullCheck($("#excelrate_"+key1).val(),'number'),2,true));
        $('#typeid_'+ iMRowId).val($("#exceltypeid_"+key1).val());
        $('#generalinfo_'+iMRowId+'_mtype option').filter(function() { return ucwords($.trim(this.text)) == ucwords($.trim($("#excelmtype_"+key1).val()));}).prop('selected', true).trigger('change');
        $('#generalinfo_'+iMRowId+'_lead').val($("#excelleadtime_"+key1).val());
        $('#generalinfo_'+iMRowId+'_wunitname').val($("#excelwunit_"+key1).val());
        $('#generalinfo_'+iMRowId+'_wrate').val(sanitizeNumber(isNullCheck($("#excelwrate_"+key1).val(),'number'),2,true));

        var iTypeId = isNullCheck($("#typeid_"+iMRowId).val(),'number');
        if (iTypeId == 4) {
            var html = '<input type="hidden" id="mainanalrate_' + iMRowId + '" value="L"><input type="hidden" id="mainanalrateLS_' + iMRowId + '" value="'+sanitizeNumber(isNullCheck($("#excelrate_"+key1).val(),'number'),2,true)+'">';
            $('#ResourceiRowId_' + iMRowId).append(html);
            $("#analrate_" + iMRowId).val('L');
            $("#analrateLS_" + iMRowId).val(sanitizeNumber(isNullCheck($("#excelrate_"+key1).val(),'number'),2,true));
        } else if (iTypeId==3) {
            bindWUnitAutoComplete(iMRowId);
            $('#generalinfo_' + iMRowId + '_wunitname').val($('#excelwunit_' + key1).val());
            $('#generalinfo_' + iMRowId + '_wunit').val($('#excelwunitid_' + key1).val());
        }

        if (iTypeId != 4) $('#rate_' + iMRowId).removeAttr('readonly');
        else $('#rate_' + key1).prop('readonly', true);

        if(iTypeId != 1) $('.mainTr_' + key1).show();
//
        $('#resgroupname_'+iMRowId).trigger('blur');
        $('#unitname_'+iMRowId).trigger('blur');
        $('.mainTrDelete_'+iMRowId).show();
    });
    $('#rowid').val(iMRowId);
    if (iMRowId >1) $('#divExcelImport').hide();
    AddNewRowA('resgroupname_'+iMRowId);
    $('#resgroupname_1').trigger('blur');
    $('#unitname_1').trigger('blur');
    bindAutoComplete(true);
    expandTrFn(true);
    bindTRDeleteFn(true);
    checkResNameFocus();
    bindResourceChange();
    bindPopOver();
    unitLoad();
    $('#excelmodal').modal('toggle');
    $('.loading_area').hide();
    bExcelUpdate =false;
//    checkResNameFocus();


//    $('input[id^=resgroupname_').trigger('blur');
//    $('input[id^=unitname_]').trigger('blur');
}
function excelSheetValid() {
    var isValid=true;
    var $excelpids = $('input[id^=excelresgroupname_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#excelresgroupname_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#exceltype_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelunit_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelresname_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelwunit_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    return isValid;
}
function CheckUnitValid(x) {
    if ($('#rfcmode').val() == 'edit')
        return;

    var sStr = x.split("_"),
        iARowid = sStr[1],
        $unitName = $('#unitname_' + iARowid),
        unitId = $('#unitid_' + iARowid).val();
    if (unitId == 0 || unitId.length == 0) {
        if ($unitName.val().length > 0)
            showError($unitName, 'Required');
        else
            removeError($unitName);
    } else {
        removeError($unitName);
    }
}
function isFormula(evt){
//    var charCode = (evt.which) ? evt.which : evt.keyCode
//    if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=43 && charCode!=45 && charCode!=47 && charCode!=42 && charCode!=46 && charCode!=65 && charCode!=66 && charCode!=67 && charCode!=40 && charCode!=41 && charCode!=82) return false;
    return true;
}
function formulafocus() {
    if ($('#formulavalue').hasClass('error')) $('#formulavalue').addClass('error').attr('data-original-title', 'Should not be less than zero').attr('data-toggle', 'tooltip');
}
function bindRate(x) {
    var i = x.split('_')[1];
    if ($('#analrate_' +i).val() == 'L')
        $('#rate_'+i).val($('#analrateLS_' + i).val());
}
function inputFocus(i){
    if(i.value==i.defaultValue){ i.value=""; i.style.color="#000"; }
}
function inputBlur(i){
    if(i.value==""){ i.value=i.defaultValue; i.style.color="#888"; }
}
var $narration = $('#narration');
function entryValidate() {
    removeError($narration);

    var isValid = true,
        validRows = 0;
    $.each($('input[id^=resgroupid_]'), function() {
        var $this = $(this),
            id = $this[0].id,
            key = id.split('_')[1];
        if (id.indexOf('__') != -1)
            return;

        var resgroupId = isNullCheck($('#resgroupid_' + key).val(),'number'),
            $unitName = $('#unitname_' + key),
            unitId = $('#unitid_' + key).val(),
            $resName = $('#resname_' +key),
            resName = $resName.val().trim(),
            typeId = $('#typeid_' + key).val(),
            $rate = $('#rate_' + key),
            rate = $rate.val();

        if ((resgroupId == 0 || resgroupId.length == 0) && (unitId == 0 || unitId.length == 0) && resName.length == 0)
            return;

        validRows++;

//        if (typeof $resName.attr('original-title') != 'undefined' && $resName.data('original-title') != 'Already Available')
//            removeError($resName);

        removeError($rate);
        if ($resName.hasClass('error')) isValid = false;
        if ($unitName.hasClass('error')) isValid = false;
        if ($('#resgroupname_' + key).hasClass('error')) isValid = false;

        var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
        if (icodegenType==0) {
            var $code =  $('#code_' +key);
            if ($code.val().length ==0) {
                showError($code, 'Code Required');
                return;
            }
        }

        if (resName.length == 0) showError($resName, 'Required');

        if (resgroupId==0) showError($('#resgroupname_' + key), 'Required');

        if  (typeId==3) {
            clickExpandTr('resgroupname_' + key);
            var iwUnitId = isNullCheck($('#generalinfo_' + key + '_wunit').val(),'number');
            if (iwUnitId ==0) showError($('#generalinfo_' + key + '_wunitname'), 'Required');
        }


//        if (typeId == 0 || typeId.length == 0) showError($('#typename_' + key), 'Required');

        if (unitId == 0 || unitId.length == 0 || $unitName.val().length == 0)
            showError($unitName, 'Required');
    });

    if (validRows == 0) {
        alert('No Resource found!');
        return false;
    }

    if(isValid && $('.error').length != 0) {
        alert('Kindly notice the error notifications!');
        return false;
    }
    if (parseInt(isNullCheck($('#editid').val(),'number')) !=0) {
        if ($narration.val().length == 0 || $('#narration').val().trim() == "Remarks") {
            isValid = false;
            showError($narration, 'Required');
            $narration.focus();
        }
    }

    return isValid;
}


function CheckResNameNew() {

    var iARowid  = $('#resrowid').val(),
        $resName = $('#resname'),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkresnamefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'resname':resName,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resName, 'Already Available');
                return;
            }
        }
    });

    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('input[id^=newresname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckResCodeNew(x) {
    var iARowid  = $('#resrowid').val(),
        $resCode = $('#rescode'),
        resCode =  $resCode.val().trim();

    removeError($resCode);
    if (resCode.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkrescodefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'rescode':resCode,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resCode, 'Already Available');
                return;
            }
        }
    });

    if ($resCode.hasClass('error')) return;
    removeError($resCode);
    var $codes = $('input[id^=newrescode_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resCode.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resCode, 'Already Available');
                    return;
                }
            }
        }
    });
}


function CheckResName(x) {
    if (bExcelUpdate== true) return;

    var iARowid = x.split("_")[1],
        $resName = $('#resname_' + iARowid),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        resid = isNullCheck($('#resourceid_' + iARowid).val(), 'number');

    $.ajax({
        url: getBaseURL() + "project/rfc/checkresnamefound",
        async: false,
        type: 'post',
        data: {'resid': resid, 'resname':resName,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resName, 'Already Available');
                return;
            }
        }
    });
    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('[id^=resname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (name.indexOf('__') != -1 || name.indexOf('_resname') != -1 || name.indexOf('excel') != -1) return;
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already Available');
                    return;
                }
            }
        }
    });
//    $('.mainTrDelete_' + iARowid).show();
//    AddNewRowRes(x);
}

function CheckResCode(x) {
    if (bExcelUpdate== true) return;

    var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
    if (icodegenType==1) return;

    var iARowid = x.split("_")[1],
        $rescode = $('#code_' + iARowid),
        rescode =  $rescode.val().trim();

    removeError($rescode);
    if (rescode.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        resid = isNullCheck($('#resourceid_' + iARowid).val(), 'number');

    $.ajax({
        url: getBaseURL() + "project/rfc/checkrescodefound",
        async: false,
        type: 'post',
        data: {'resid': resid, 'rescode':rescode,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($rescode, 'Already Available');
                return;
            }
        }
    });

    if ($rescode.hasClass('error')) return;
    removeError($rescode);
    var $codes = $('input[id^=code_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (rescode.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($rescode, 'Already Available');
                    return;
                }
            }
        }
    });
//    $('.mainTrDelete_' + iARowid).show();
//    AddNewRowRes(x);
}

function CheckExcelResName(x) {

    var iARowid = x.split("_")[1],
        $resName = $('#resname_' + iARowid),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = isNullCheck($('#editid').val(), 'number');

    var arrRes = [];
    arrRes = $.grep(arrResMaster, function (element, index) {
        return element.ResourceName.trim().replace(/[^a-z0-9]+/gi, '') == resName.trim().replace(/[^a-z0-9]+/gi, '');
    });

    if (arrRes.length >0) showError($resName, 'Already Available');

//    $.ajax({
//        url: getBaseURL() + "project/rfc/checkresnamefound/"+resName + '/' +rfcId + '/' + editid,
//        async: false,
//        type: 'post',
//        success: function(data,status) {
//            if (data == "Y") {
//                showError($resName, 'Already Available');
//                return;
//            }
//        }
//    });

    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('[id^=resname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already Available');
                    return;
                }
            }
        }
    });
//    $('.mainTrDelete_' + iARowid).show();
//    AddNewRowRes(x);
}


function CheckSuggestionId(x, inputId) {
    var $this = $(x),
        $input = $('#' + inputId + '_' + $this[0].id.split('_')[1]);

    if ($this.val().length != 0 && ($input.val().length == 0 || $input.val() == 0)) {
        showError($this, 'Required');
        $this.prop('readonly', false);
    }
    else
        removeError($this);

}
function AddNewResource(x) {
    var sStr = x.id.split("_");
    iFocusRowId= sStr[1];
    iTransRowId = sStr[3];
    bSiteMix=true;
    if (x.id.substr(x.id.indexOf('_') - 1, 1) === 'R') bSiteMix=false;
    sResUpdateMode='Add';

    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    $("#newresok").html('Create');
    $("#resourcemodal").attr('data-input',x.id).modal('show');
    $('#refNewResRowName').val(x.id);
    $('#resrowid').val(0);
    $('.autocomplete-suggestions').hide();
    $('#resname').val($(x).val());
    $('#' + x.id).prop('readonly', false);
}
$(function() {
    $(document).keydown(function(event) {
        if(event.ctrlKey && event.keyCode == 78) {
            $("#addbut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 83) {
            $("#donebut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 82) {
            if (bSiteMix == true){$("#butresadd").trigger("click");}
            else{$("#butresRadd").trigger("click");}
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 67) {
            if (bSiteMix==true){var iRows = $('#rowinfoid_' + iFocusRowId).val();}
            else {var iRows = $('#rowinfoidR_' + iFocusRowId).val();}
            var arr= [];
            var k=0;
            for (var i = 1; i <= iRows; i++) {
                if (bSiteMix == true) {
                    var sTable = '#activity_' + iFocusRowId + '_RowId_' + i;
                } else {
                    var sTable = '#activityR_' + iFocusRowId + '_RowId_' + i;
                }
                if ($(sTable).hasClass('selected') == true) {
                    if (bSiteMix == true) {
                        arr.push({
                            resid: $('#activity_' + iFocusRowId + '_resid_' + i).val(),
                            resname: $('#activity_' + iFocusRowId + '_resname_' + i).val(),
                            resunit: $('#activity_' + iFocusRowId + '_resunit_' + i).val(),
                            resunitid: $('#activity_' + iFocusRowId + '_resunitid_' + i).val(),
                            resqty: $('#activity_' + iFocusRowId + '_resqty_' + i).val(),
                            resrate: $('#activity_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#activity_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#activity_' + iFocusRowId + '_formula_' + i).val()
                        });
                    } else {
                        arr.push({
                            resid: $('#activityR_' + iFocusRowId + '_resid_' + i).val(),
                            resname: $('#activityR_' + iFocusRowId + '_resname_' + i).val(),
                            resunit: $('#activityR_' + iFocusRowId + '_resunit_' + i).val(),
                            resunitid: $('#activityR_' + iFocusRowId + '_resunitid_' + i).val(),
                            resqty: $('#activityR_' + iFocusRowId + '_resqty_' + i).val(),
                            resrate: $('#activityR_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#activityR_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#activityR_' + iFocusRowId + '_formula_' + i).val()
                        });
                    }
                }
            }
            if (arr.length >0) {
                $.post(getBaseURL() + 'project/rfc/UpdateCopyResAnalysis', {ids: arr}, function (data) {
                    //alert (data);
                });
            }
            event.preventDefault();
        }
        else if(event.ctrlKey && event.keyCode == 86) {
            $.post(getBaseURL() +  'project/rfc/GetCopyResAnalysis', {ids: arr}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (bSiteMix==true) {
                    var irowinfoId = $('#rowinfoid_' + iFocusRowId).val();;
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#activity_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#activity_' + iFocusRowId + '_restable';
                            var sStr = '<tr id="activity__1_RowId__9">' + $("#activity__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g, '_' + iFocusRowId);
                            sStr = sStr.replace(/__9/g, '_' + irowinfoId);
                            $(stabelrow + " tbody tr:last").after(sStr);
                            $('#rowinfoid_' + iFocusRowId).val(irowinfoId);
                        }
                        $('#activity_' + iFocusRowId + '_resname_' + irowinfoId).val(obj[i]['resname']);
                        $('#activity_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#activity_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#activity_' + iFocusRowId + '_resunit_' + irowinfoId).html(obj[i]['resunit']);
                        $('#activity_' + iFocusRowId + '_resunitid_' + irowinfoId).val(obj[i]['resunitid']);
                        $('#activity_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#activity_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#activity_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                } else {
                    var irowinfoId = $('#rowinfoidR_' + iFocusRowId).val();;
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#activityR_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#activityR_' + iFocusRowId + '_restable';
                            var sStr = '<tr id="activityR__1_RowId__9">' + $("#activityR__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g, '_' + iFocusRowId);
                            sStr = sStr.replace(/__9/g, '_' + irowinfoId);
                            $(stabelrow + " tbody tr:last").after(sStr);
                            $('#rowinfoidR_' + iFocusRowId).val(irowinfoId);
                        }
                        $('#activityR_' + iFocusRowId + '_resname_' + irowinfoId).val(obj[i]['resname']);
                        $('#activityR_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#activityR_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#activityR_' + iFocusRowId + '_resunit_' + irowinfoId).html(obj[i]['resunit']);
                        $('#activityR_' + iFocusRowId + '_resunitid_' + irowinfoId).val(obj[i]['resunitid']);
                        $('#activityR_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#activityR_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#activityR_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                }
            });
        }
    });
    var $resqty = $('input[name*=_resqty_]');
    $.each($resqty, function(obj,i){
        var $this = $(this);
        if($this.val() == '') return;
        var name = $this.attr('name');
        iFocusRowId = name.split('_')[2];
        $this.trigger("change");
    });
    bindExcelDeleteFn();
    bindResourceChange();
    bindPopOver();
});
function excelRowvalid(irowId) {
    var ikey = irowId;
    if ($('#excelresgroupname_' + ikey).hasClass('error')) $("#excelresgroupname_" + ikey).prop('readonly', false);
    else $("#excelresgroupname_" + ikey).prop('readonly', true);
    if ($('#exceltype_' + ikey).hasClass('error')) $("#exceltype_" + ikey).prop('readonly', false);
    else $("#exceltype_" + ikey).prop('readonly', true);
    if ($('#excelunit_' + ikey).hasClass('error')) $("#excelunit_" + ikey).prop('readonly', false);
    else $("#excelunit_" + ikey).prop('readonly', true);
    if ($('#excelresname_' + ikey).hasClass('error')) $("#excelresname_" + ikey).prop('readonly', false);
    else $("#excelresname_" + ikey).prop('readonly', true);
    if ($('#excelwunit_' + ikey).hasClass('error')) $("#excelwunit_" + ikey).prop('readonly', false);
    else $("#excelwunit_" + ikey).prop('readonly', true);
}
function excelResGroupFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelresgroupname_' + key).hasClass('error')) $('#excelresgroupname_' + key).addClass('error').attr('data-original-title', 'Invalid resource group').attr('data-toggle', 'tooltip');
}
function excelResGroupValid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelresgroupname_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkresparentnamefound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelresgroupname_' + key).addClass('error');
        else {
            $('#excelresgroupid_' + key).val(iPId);
            $('#excelresgroupname_' + key).removeClass('error');
        }
    }
}
function excelResTypeFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#exceltype_' + key).hasClass('error')) $('#exceltype_' + key).addClass('error').attr('data-original-title', 'Invalid resource type').attr('data-toggle', 'tooltip');
}
function excelResTypevalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#exceltype_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkrestypefound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#exceltype_' + key).addClass('error');
        else {
            $('#exceltypeid_' + key).val(iPId);
            $('#exceltype_' + key).removeClass('error');
        }
    }
}
function excelResourceFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelresname_' + key).hasClass('error')) $('#excelresname_' + key).addClass('error').attr('data-original-title', 'Resource Already Available').attr('data-toggle', 'tooltip');
}
function excelUnitFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelunit_' + key).hasClass('error')) $('#excelunit_' + key).addClass('error').attr('data-original-title', 'Invalid unit').attr('data-toggle', 'tooltip');
}
function excelUnitvalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelunit_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkunitfound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelunit_' + key).addClass('error');
        else {
            $('#excelunitid_' + key).val(iPId);
            $('#excelunit_' + key).removeClass('error');
        }
    }
}
function excelWUnitFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelwunit_' + key).hasClass('error')) $('#excelwunit_' + key).addClass('error').attr('data-original-title', 'Invalid unit').attr('data-toggle', 'tooltip');
}
function excelWUnitvalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelwunit_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkunitfound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelwunit_' + key).addClass('error');
        else {
            $('#excelwunitid_' + key).val(iPId);
            $('#excelwunit_' + key).removeClass('error');
        }
    }
}


function getexcelfield(x) {
    var bValid=true;

    bExcelRegGroup = false;
    bExcelRes = false;
    bExcelUnit = false;
    bExcelRate = false;
    bExcelWUnit = false;
    bExcelWRate = false;
    bExcelMaterialType = false;
    bExcelLeadTime = false;

    formData = new FormData();
    formData.append('file', $('#myfile').prop("files")[0]);
    $.ajax({
        url: getBaseURL() +"project/rfc/getrgfielddata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);

            $("#excelfieldTable").find("th").remove();
            $("#excelfieldTable").find("td").remove();
//            $("#excelfield").find("td").remove();

            var sStr="Select Field";
            for (var i = 0; i < obj.length; i++) {
                $("#excelfieldTable").append('<tr><th width="20%"><input id="efield_'+i+'" class="text-reon text-right" type="text" value="'+obj[i]['Field']+'" style="background: transparent;"/></th> <td width="70%"><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td></tr>');
//                $("#excelfield").append('<td><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td>');
                $('#efield_'+i).prop('readonly', true);

                if (obj[i]['Field'].trim().toUpperCase() == 'RESOURCEGROUP') { $('#field_'+i).val('ResourceGroup'); bExcelResGroup=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'RESOURCENAME') { $('#field_'+i).val('ResourceName'); bExcelRes=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'UNIT') { $('#field_'+i).val('Unit'); bExcelUnit=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE') { $('#field_'+i).val('Rate'); bExcelRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'WORKINGUNIT') { $('#field_'+i).val('WorkingUnit'); bExcelWUnit=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'WORKINGRATE') { $('#field_'+i).val('WorkingRate'); bExcelWRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'MATERIALTYPE') { $('#field_'+i).val('MaterialType'); bExcelMaterialType=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'LEADTIME') { $('#field_'+i).val('LeadTime'); bExcelLeadTime=true;}
            }

            bindexcelFieldComplete();
            $("#excelfieldmodal").modal('show');
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));
}

function bindexcelFieldComplete() {
    var $excelfield = $('input[id^=field_]');
    $excelfield.unbind('autocomplete');
    $.each($excelfield, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkexcelFieldUsed(key1);
        $this.autocomplete({
            lookup: arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) removeError($(this));
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) showError($(this), 'Invalid');
                else removeError($(this));
            }
        });
    });
}

function clearInputFile(file){
    var f = file[0];
    if(f.value){
        try{
            f.value = '';
        }catch(err){ }
        if(f.value){
            var form = document.createElement('form'),
                parentNode = f.parentNode, ref = f.nextSibling;
            form.appendChild(f);
            form.reset();
            parentNode.insertBefore(f,ref);
        }
    }
}

function CheckResGroupName() {
    var iARowid = $('#resgrouprowid').val(),
        $groupName = $('#resgroupname'),
        sGroupName =  $groupName.val().trim(),
        iGroupId =  0;

    removeError($groupName);
    if (sGroupName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number');
    $.ajax({
        url: getBaseURL() + "project/rfc/checkresgroupnamefound",
        async: false,
        type: 'post',
        data: {'groupname': sGroupName, 'rfcid':rfcId,'groupid':iGroupId},
        success: function(data,status) {
            if (data == "Y") {
                showError($groupName, 'Already Available');
                return;
            }

        }
    });

    if ($groupName.hasClass('error')) return;
    removeError($groupName);
    var $codes = $('input[id^=newresgroupname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (sGroupName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($groupName, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckResGroupCode() {

    var icodegenType = parseInt(isNullCheck($('#groupcodegenType').val(),'number'));
    if (icodegenType==1) return;

    var iARowid = $('#resgrouprowid').val(),
        $groupName = $('#resgroupcode'),
        sSlNo =  $groupName.val().trim(),
        iGroupId =  0;

    removeError($groupName);
    if (sSlNo.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number');
    $.ajax({
        url: getBaseURL() + "project/rfc/checkresgroupserialfound",
        async: false,
        type: 'post',
        data: {'slno': sSlNo, 'rfcid':rfcId,'groupid':iGroupId},
        success: function(data,status) {
            if (data == "Y") {
                showError($groupName, 'Already Available');
                return;
            }
        }
    });

    if ($groupName.hasClass('error')) return;
    removeError($groupName);
    var $codes = $('input[id^=newresgroupcode_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid) {
                if (sSlNo.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($groupName, 'Already Available');
                    return;
                }
            }
        }
    });
}
function resgroupparentcheck(id) {
    var sParent = isNullCheck($('#'+id).val(),'string');
    if (sParent =="") removeError($('#'+id));
}

function checkexcelFieldFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkexcelFieldUsed(key1);
}
function checkexcelFieldUsed(id) {
    var reskeyid = $('input[id*=field_]');
    arrayFieldR = arrayField;
    arrayFieldR= $.grep(arrayField, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.value == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}
function loading(value) {
    setInterval(function() {
        //alert(value);
        $('.progress-value').html(value + '%');
        var $ppc = $('.progress-pie-chart'),
            deg = 360 * value / 100;
        if (value > 50) {
            $ppc.addClass('gt-50');
        }

        $('.ppc-progress-fill').css('transform', 'rotate(' + deg + 'deg)');
        $('.ppc-percents span').html(value + '%');

        if (value >= 100) {
            //clearInterval(progress);
            // alert('done');
        }

//        $('#progress .progress-text').text(progression + '%');
//        $('#progress .progress-bar').css({'width': progression + '%'});
//        if (progression == 100) {
//            clearInterval(progress);
//            alert('done');
//        } else
//            progression += 10;

    },1000);
}

function showPickList(id) {
    var sname = id.split('_')[0],
        key= id.split('_')[1],
        restype = "S";
    if (sname.substr(sname.length-1) == "R") restype = "R";
    $('#picklistrestype').val(restype);
    $('#picklistrow').val(key);

    checkResourcePickList(key,restype);
    bindResourcePickListGrid();
    $("#picklistmodal").modal('show');
}
function checkResourcePickList(key,restype) {
    if (restype=="R") {
        $reskeyid = $('input[id*=activityR_' + key + '_resid_]');
        arrrespicklistR = [];
        arrrespicklistR= $.grep(arrrespicklist, function(element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        $reskeyid = $('input[id*=activity_' + key + '_resid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function(element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    }
}
function bindResourcePickListGrid() {
    var parent = $("#respickgrid").parent();
    $("#respickgrid").remove();
    $("<div id='respickgrid'></div>").appendTo(parent);
    var source = {
        localdata:arrrespicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'ResourceId', type: 'string'},
            { name: 'TypeId', type: 'number'},
            { name: 'UnitId', type: 'number'},
            { name: 'Code', type: 'string'},
            { name: 'ResourceName', type: 'string'},
            { name: 'UnitName', type: 'string'},
            { name: 'TypeName', type: 'string'},
            { name: 'ResourceGroup', type: 'string'},
            { name: 'Rate', type: 'number'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'ResourceId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);

    $("#respickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'ResourceId', datafield: 'ResourceId', hidden: true},
            {text: 'TypeId', datafield: 'TypeId', hidden: true},
            {text: 'UnitId', datafield: 'UnitId', hidden: true},
            {text: 'Rate', datafield: 'Rate', hidden: true},
            {text: 'Code', datafield: 'Code', 'editable': false, width: '15%'},
            {text: 'ResourceName', datafield: 'ResourceName', 'editable': false, width: '30%'},
            {text: 'Unit', datafield: 'UnitName', 'editable': false, width: '10%'},
            {text: 'Type', datafield: 'TypeName', 'editable': false, width: '15%'},
            {text: 'ResourceGroup', datafield: 'ResourceGroup', 'editable': false, width: '20%'},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%'}
        ]
    });
}

function updatefromPickList() {
    $('.loading_area').show();
    var resType = $('#picklistrestype').val(),
        key1 = isNullCheck($('#picklistrow').val(),'number'),
        sName = "#activity_" + key1;
    if (resType =="R") sName = "#activityR_" + key1;
    var rows = $('#respickgrid').jqxGrid('getrows'),iResourceId= 0,sCode="",sResName="",sSpec="",iUnitId=0,sUnit="",dRate=0;
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#rowinfoid_' + key1).val();
            if (resType =="R") key2 = $('#rowinfoidR_' + key1).val();

            iResourceId = rows[i]['ResourceId'];
            sCode = rows[i]['Code'];
            sResName = rows[i]['ResourceName'];
            sSpec = sCode + '   ' + sResName;
            iUnitId= rows[i]['UnitId'];
            sUnit =  rows[i]['UnitName'];
            dRate =  rows[i]['Rate'];

            $(sName + '_resname_' + key2).val(sSpec);
            $(sName + '_resid_' + key2).val(iResourceId);
            $(sName + '_resunitid_' + key2).val(iUnitId);
            $(sName + '_newresname_' + key2).val(sResName);
            $(sName + '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
            if (resType =="R") $("label[for='activityR_" + key1 + "_resunit_"+key2+"']").html(sUnit);
            else $("label[for='activity_" + key1 + "_resunit_"+key2+"']").html(sUnit);
            $(sName + '_resname_' + key2).prop('disabled', true);

            if (resType =="R") AddNewRowResR(key1);
            else AddNewRowRes(key1);
        }
    }
    $('#picklistmodal').modal('toggle');
    $('.loading_area').hide();
}

</script>
