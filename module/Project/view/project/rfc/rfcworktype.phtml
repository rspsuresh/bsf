<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<style type="text/css">
    .tr-header input[type=text] {font-weight:600 !important; font-size:15px !important; border:none !important; color: #015de6;}
    .btn_newlist {background: #e3edf1 none repeat scroll 0 0;
        border: 2px solid #93cee5;
        border-radius: 50%;
        color: #000;
        font-size: 11px;
        line-height: 36px;
        margin-bottom: 15px;
        padding: 0 4px;
        text-align: center;}
    .btn_newlist a i{ text-align:center; font-size:20px; color:#000; padding-left:16px; line-height:45px; transition:all 0.3s ease;}
    .btn_newlist a i:hover{-webkit-transform: scale(1.3);
        -ms-transform: scale(1.3);
        transform: scale(1.3); padding-left:14px}
    .heading_checkbox                       {line-height:40px;}
    .search-container label {
        right: 10px;
        position: absolute;
        top: 30px;
        z-index:999;
        color:#ccc;
    }
    .sr-only {
        border: 0 none;
        clip: rect(0px, 0px, 0px, 0px);
        height: 1px;
        margin: -1px;
        overflow: hidden;
        padding: 0;
        position: absolute;
        width: 1px;
    }
    .search-container {
        font-size: 18px;
        margin: -20px auto 0;
        padding-top: 20px;
        position: relative;
    }
    .card {
        margin: 15px 0;
        padding: 11px;
    }
    .card-body {
        padding: 0;
    }
    .work-frq >.critical >.checkbox label{font-size:12px}
    .work-frq .lbl_move,.work-frq .select2-container .select2-selection--single{font-size:12px !important}
	.worktype_listed{position:relative}
    .ad-btn{background:#3399ff; text-shadow: 0 0 1px #546082;right:4px;text-align: center;padding-top: 2px; box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff; width:25px; height:25px; border-radius:50%; color:#fff; position:absolute}
    #respickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #respickgrid .jqx-checkbox {border:1px solid;}
</style>
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form action="" onsubmit="return entryValidate()"  method="post">
<input type="hidden" name="rfcUId" id="rfcUId" value="<?php echo $rfcid;?>">
<input type="hidden" name="editid" id="editid" value="<?php echo $editid;?>">
<input type="hidden" name="codegenType" id="codegenType" value="<?php echo $codegenType;?>">
<div class="col-lg-12 page_tittle">
    <h1>Request for creation - Work Type Edit</h1>
</div>
<div class="col-lg-12 clear padlr0">
    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-6">
        <div class="col-lg-offset-1">
            <label for="refno" class="bk_lbl bk_lbl_inpt splcharc">Reference No <span class="colon_r">:</span></label>
            <input type="text" class="bk_lbl_inpt inputbg_ef bk_inpt1 splcharc" name="refno" data-bsfshare="refno" id="refno" onchange="" value="<?php  if ($rfcid!=0) { echo $rfcregister['RefNo'];}  else { echo $svNo; } ?>" <?php if ($genType==true) { ?> readonly <?php } ?> />
        </div>
    </div>
    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-6 ">
        <div class="col-lg-offset-6">
            <div class="col-lg-12">
                <label for="refdate" class="bk_lbl bk_lbl_inpt"><span class="bkspan_calendar"><i class="fa fa-calendar-o"></i></span> Reference Date <span class="colon_r">:</span></label>
                <input type="text" class="date_picker bk_lbl_inpt no_bg bk_inpt inputbg_ef" name="refdate" data-bsfshare="refdate" readonly id="refdate" onchange="validateDate(this);" value="<?php if ($rfcid!=0)  { echo date("d-m-Y", strtotime($rfcregister['RefDate']));} else { echo date('d-m-Y');}?>" />
            </div>
        </div>
    </div>
</div>
<!--table Jq Gride start-->
<div class="col-lg-12 col-lg-offset-0 padtop20" style="<?php echo ($editid !=0 || $rfcid !=0) ? 'display: none': '';?>" id="edit-list">
    <div class="table-responsive clear">
        <div id='jqxWidget'>
            <div id="grid"></div>
        </div>
    </div>
    <div class="clearfix"></div>
</div>
<div class="col-lg-12 col-lg-offset-0 padtop20" style="<?php echo ($editid !=0 || $rfcid !=0) ? '': 'display: none';?>" id="edit-content">
<div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
<table class="table" style=" margin-bottom:0px; <?php ($editid ==0 || $rfcid ==0) ? 'display: none;' : '' ?>" id="sample12">
<thead>
<tr>
    <th>WorkType</th>
    <th class="text-center">Action</th>
</tr>
</thead>
<tbody>
<?php $i=0;
if (isset($rfctrans)):
foreach ($rfctrans as $cur): $i = $i + 1; $iWTypeId = $cur['WorkTypeId']; ?>
<tr id="rowid_<?php echo $i; ?>">
    <input type="hidden" name="worktypeid_<?php echo $i; ?>" value="<?php echo $cur['WorkTypeId']; ?>" id="worktypeid_<?php echo $i; ?>">
    <td width="15%"><input type="text" class="parent_text"  name="typename_<?php echo $i; ?>" value="<?php echo $cur['WorkType']; ?>" id="typename_<?php echo $i; ?>" readonly></td>
    <td width="3%" align="center">
        <ul class="action_btns">
            <li>
                <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
            </li>
        </ul>
    </td>
</tr>
<tr style="display:none;" class="subTr_<?php echo $i ?> paintTr">
<td colspan="12">
<div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
<div class="panel-group" id="accordion_<?php echo $i; ?>" role="tablist" style="border:1px solid #ddd; background-color:#fff;" aria-multiselectable="true">
<div class="panel panel-default">
<div class="panel-heading accordion_head accordion_head_crnt" role="tab" id="raheading_<?php echo $i; ?>" data-toggle="collapse" data-parent="#accordion_<?php echo $i; ?>" href="#racollapse1_<?php echo $i; ?>" aria-expanded="true" aria-controls="racollapse1_<?php echo $i; ?>">
    <h4>Rate Analysis</h4>
</div>
<div id="racollapse1_<?php echo $i; ?>" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="raheading_<?php echo $i; ?>">
<div class="panel-body">
<div class="col-lg-12 col-lg-offset-0" style="margin-top:5px;">
    <div class="radio_check createds firstStep hideStep"  id ="divconcrete_<?php echo $i; ?>"  style="display: none">
        <p>
            <input type="checkbox" value="Concrete" name="concrete_<?php echo $i; ?>" id="concrete_<?php echo $i; ?>" onchange="return CheckConcreteMixUnTick()" <?php echo ($cur['ConcreteMix'] == 1) ? 'checked' : ''; ?> readonly>
            <label for="concrete_<?php echo $i; ?>">Concrete Mix </label>
        </p>
        <p>
            <input type="checkbox" value="Cement" name="cement_<?php echo $i; ?>" id="cement_<?php echo $i; ?>" onchange="return CheckCementUnTick()" <?php echo ($cur['Cement'] == 1) ? 'checked' : ''; ?>>
            <label for="cement_<?php echo $i; ?>">Cement</label>
        </p>
        <p>
            <input type="checkbox" value="Sand" name="sand_<?php echo $i; ?>" id="sand_<?php echo $i; ?>" onchange="return CheckSandUnTick()" <?php echo ($cur['Sand'] == 1) ? 'checked' : ''; ?>>
            <label for="sand_<?php echo $i; ?>">Sand</label>
        </p>
        <p>
            <input type="checkbox" value="Metal" name="metal_<?php echo $i; ?>" id="metal_<?php echo $i; ?>" onchange="return CheckMetalUnTick()" <?php echo ($cur['Metal'] == 1) ? 'checked' : ''; ?>>
            <label for="metal_<?php echo $i; ?>">Metal</label>
        </p>
        <p>
            <input type="checkbox" value="Thickness" name="thick_<?php echo $i; ?>" id="thick_<?php echo $i; ?>" onchange="return CheckThickUnTick()" <?php echo ($cur['Thickness'] == 1) ? 'checked' : ''; ?>>
            <label for="thick_<?php echo $i; ?>">Thickness</label>
        </p>
    </div>
    <!-- Nav tabs -->
    <div class="darkmenu" id="mixtype_<?php echo $i; ?>">
        <ul>
            <li class="active"><a href="javascript:void(0);" id="analtypeSS_<?php echo $i; ?>" onclick="showmix('sitemix',this.id, event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
            <li><a href="javascript:void(0);" id="analtypeSR_<?php echo $i; ?>" onclick="showmix('readymix',this.id, event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
        </ul>
    </div>
    <!-- Tab panes -->
    <div class="lstate worktype_listed">
        <ul id="raworktable_<?php echo $i; ?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['WorkingQty'],3);?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>_AQty_li">
                <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['CementRatio'],3);?>" onblur="return FormatNum(this, 3)"  onchange="changeRatio(this.id,'C')" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>_BQty_li">
                <label>Sand <span class="wrktype_label_span">(S)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['SandRatio'],3);?>" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'S')" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>_CQty_li">
                <label>Aggregate <span class="wrktype_label_span">(A)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['MetalRatio'],3);?>" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'A')" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>_thick_li">
                <label>Thickness (mm)<span class="wrktype_label_span">(T)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['ThickQty'],3);?>" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'T')" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li><a id="type_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
        <ul  style="display: none;" id="raworkRtable_<?php echo $i; ?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php echo $this->commonHelper()->sanitizeNumber($cur['RWorkingQty'],3); ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li><a id="typeR_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
    </div>
</div>
<div class="col-lg-12">
    <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
        <table class="table" style="margin-bottom:0px;" id="type_<?php echo $i ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo_subTr">Inc/Exc</th>
                <th class="bg_clo_subTr">Ref No</th>
                <th class="bg_clo_subTr">Resource</th>
                <th class="bg_clo_subTr">Unit</th>
                <th class="bg_clo_subTr">Coefficient</th>
                <th class="bg_clo_subTr">Formula</th>
                <th class="bg_clo_subTr text-center">Action</th>
            </tr>
            </thead>
            <tbody class="sorting"><?php $j=1; $iRefId=1;
            if (isset($worktypeanal)):
                $smix= 'R';
                $arranal = array_filter($worktypeanal, function($v) use($iWTypeId,$smix) { return $v['WorkTypeId'] == $iWTypeId && $v['Type'] !=$smix; });
                foreach($arranal as $curanal):
//                    if($curanal['Type'] == 'R' || $cur['WorkTypeId'] != $curanal['WorkTypeId'])
//                        continue;
                    ?>
                    <tr id="type_<?php echo $i ?>_RowId_<?php echo $j ?>"  <?php if($curanal['TransType'] == 'H') { echo 'class="tr-header"'; } ?>>
                        <?php if($curanal['TransType'] == 'H'): ?>
                            <td colspan="6"><input type="text" class="parent_text" style="font-weight:bold" name="type_<?php echo $i ?>_resdes_<?php echo $j ?>" id="type_<?php echo $i ?>_resdes_<?php echo $j ?>" value="<?php echo $curanal['Description'];?>"></td>
                            <input type="hidden" name="type_<?php echo $i ?>_rowrefid_<?php echo $j ?>" value="<?php echo $j;?>" id="type_<?php echo $i ?>_rowrefid_<?php echo $j ?>">
                            <input type="hidden" name="type_<?php echo $i ?>_rowtype_<?php echo $j ?>" value="H" id="type_<?php echo $i ?>_rowtype_<?php echo $j ?>">
                            <td width="3%" align="center"><a href="javascript:void(0);" id="type_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>
                        <?php else: ?>
                            <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                    <input type="checkbox" value = "<?php echo true; ?>" name="type_<?php echo $i ?>_inc_<?php echo $j ?>" <?php echo ($curanal['IncludeFlag'] == 1) ? 'checked' : '';?> id="type_<?php echo $i ?>_inc_<?php echo $j ?>" class="ios_checkbox inc_exc"/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for="type_<?php echo $i ?>_ref_<?php echo $j ?>">R<?php echo $curanal['ReferenceId'];?></label></td>
                            <td width="15%"><input class="parent_text" data-toggle="popover" name="type_<?php echo $i ?>_resname_<?php echo $j ?>" id ="type_<?php echo $i ?>_resname_<?php echo $j ?>" value="<?php echo $curanal['Code'] .' '.$curanal['ResourceName']; ?>"  onfocus="return CheckResourceFocus(this.id,'')" /></td>
                            <td width="5%"><label for ="type_<?php echo $i ?>_unitname_<?php echo $j ?>"><?php echo $curanal['UnitName'];?></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="type_<?php echo $i ?>_qty_<?php echo $j ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($curanal['Qty'],3);?>" id="type_<?php echo $i ?>_qty_<?php echo $j ?>" onfocus="return showformula(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)"> </td>
                            <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="type_<?php echo $i ?>_formula_<?php echo $j ?>" value = "<?php echo $curanal['CFormula'];?>" id="type_<?php echo $i ?>_formula_<?php echo $j ?>" readonly> </td>
                            <td width="3%" align="center"><a href="javascript:void(0);" id="type_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>
                            <input type="hidden" name="type_<?php echo $i ?>_ref_<?php echo $j ?>" value = "R<?php echo $curanal['ReferenceId'];?>" id="type_<?php echo $i ?>_ref_<?php echo $j ?>"  />
                            <input type="hidden" name="type_<?php echo $i ?>_resid_<?php echo $j ?>" id ="type_<?php echo $i ?>_resid_<?php echo $j ?>" value="<?php echo $curanal['ResourceId'];?>"/>
                            <input type="hidden" name="type_<?php echo $i ?>_unit_<?php echo $j ?>" value = "<?php echo $curanal['UnitId'];?>" id="type_<?php echo $i ?>_unit_<?php echo $j ?>" />
                            <input type="hidden" name="type_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="type_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                            <input type="hidden" name="type_<?php echo $i; ?>_rowtype_<?php echo $j; ?>" value = "<?php echo $curanal['TransType'];?>" id="type_<?php echo $i; ?>_rowtype_<?php echo $j; ?>">
                            <input type="hidden" name="type_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $curanal['ResourceName'];?>" id="type_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                        <?php  endif; ?>
                    </tr>
                    <?php $j=$j+1; if(intval($curanal['ReferenceId']) >= $iRefId) {$iRefId = intval($curanal['ReferenceId'])+1; }   endforeach; endif; ?>
            <tr id="type_<?php echo $i ?>_RowId_<?php echo $j ?>">
                <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                        <input type="checkbox" value = "<?php echo true; ?>" name="type_<?php echo $i ?>_inc_<?php echo $j ?>" id="type_<?php echo $i ?>_inc_<?php echo $j ?>" checked class="ios_checkbox inc_exc"/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="type_<?php echo $i ?>_ref_<?php echo $j ?>">R<?php echo $iRefId ?></label></td>
                <td width="15%"><input class="parent_text" data-toggle="popover" name="type_<?php echo $i ?>_resname_<?php echo $j ?>" id="type_<?php echo $i ?>_resname_<?php echo $j ?>" onfocus="return CheckResourceFocus(this.id,'')" /></td>
                <td width="5%"><label for ="type_<?php echo $i ?>_unitname_<?php echo $j ?>"></label></td>
                <td width="5%"><input type="text" class="parent_text text-right"  maxlength="15" name="type_<?php echo $i ?>_qty_<?php echo $j ?>" id="type_<?php echo $i ?>_qty_<?php echo $j ?>"  onfocus="return showformula(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)"> </td>
                <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="type_<?php echo $i ?>_formula_<?php echo $j ?>" id="type_<?php echo $i ?>_formula_<?php echo $j ?>" readonly> </td>
                <td width="3%" align="center">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" id="type_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="type_<?php echo $i ?>_ref_<?php echo $j ?>" value = "R<?php echo $iRefId ?>" id="type_<?php echo $i ?>_ref_<?php echo $j ?>"  />
                <input type="hidden" name="type_<?php echo $i ?>_resid_<?php echo $j ?>" id="type_<?php echo $i ?>_resid_<?php echo $j ?>" value="0"/>
                <input type="hidden" name="type_<?php echo $i ?>_unit_<?php echo $j ?>" id="type_<?php echo $i ?>_unit_<?php echo $j ?>" />
                <input type="hidden" name="type_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="type_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="type_<?php echo $i; ?>_rowtype_<?php echo $j; ?>" value = "" id="type_<?php echo $i; ?>_rowtype_<?php echo $j; ?>">
                <input type="hidden" name="type_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="type_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="wrowid_<?php echo $i; ?>" id="wrowid_<?php echo $i; ?>" value="<?php echo $j; ?>">
        <table class="table" style="margin-bottom:0px; display:none;" id="typeR_<?php echo $i ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo_subTr">Inc/Exc</th>
                <th class="bg_clo_subTr">Ref No</th>
                <th class="bg_clo_subTr">Resource</th>
                <th class="bg_clo_subTr">Unit</th>
                <th class="bg_clo_subTr">Coefficient</th>
                <th class="bg_clo_subTr">Formula</th>
                <th class="bg_clo_subTr text-center">Action</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1;$iRefId=1;
            if (isset($worktypeanal)):
                $smix= 'R';
                $arranal = array_filter($worktypeanal, function($v) use($iWTypeId,$smix) { return $v['WorkTypeId'] == $iWTypeId && $v['Type'] ==$smix; });
                foreach($arranal as $curanal):
//                    if ($cur['WorkTypeId'] != $curanal['WorkTypeId'] || $curanal['Type'] !='R')
//                    continue;
                    ?>
                    <tr id="typeR_<?php echo $i ?>_RowId_<?php echo $j ?>" <?php if($curanal['TransType'] == 'H') { echo 'class="tr-header"'; } ?>>
                        <?php if($curanal['TransType'] == 'H'): ?>
                            <td colspan="6"><input type="text" class="parent_text" style="font-weight:bold" name="typeR_<?php echo $i ?>_resdes_<?php echo $j ?>" id="typeR_<?php echo $i ?>_resdes_<?php echo $j ?>" value="<?php echo $curanal['Description'];?>"></td>
                            <input type="hidden" name="typeR_<?php echo $i ?>_rowrefid_<?php echo $j ?>" value="<?php echo $j;?>" id="typeR_<?php echo $i ?>_rowrefid_<?php echo $j ?>">
                            <input type="hidden" name="typeR_<?php echo $i ?>_rowtype_<?php echo $j ?>" value="H" id="typeR_<?php echo $i ?>_rowtype_<?php echo $j ?>">
                            <td width="3%" align="center">
                                <ul class="action_btns">
                                    <li>
                                        <a href="javascript:void(0);" id="typeR_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                        <?php else: ?>
                            <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                    <input type="checkbox" name="typeR_<?php echo $i ?>_inc_<?php echo $j ?>" value = "<?php echo true;?>" <?php echo ($curanal['IncludeFlag'] == 1) ? 'checked' : '';?> id="typeR_<?php echo $i ?>_inc_<?php echo $j ?>" class="ios_checkbox inc_exc"/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="typeR_<?php echo $i ?>_ref_<?php echo $j ?>">R<?php echo $curanal['ReferenceId'];?></label></td>
                            <td width="15%"><input class="parent_text" data-toggle="popover" name="typeR_<?php echo $i ?>_resname_<?php echo $j ?>" id="typeR_<?php echo $i ?>_resname_<?php echo $j ?>" value="<?php echo $curanal['Code'] .' '.$curanal['ResourceName']; ?>" onfocus="return CheckResourceFocus(this.id,'R')" /></td>
                            <td width="5%"><label for ="typeR_<?php echo $i ?>_unitname_<?php echo $j ?>" ><?php echo $curanal['UnitName'];?></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="typeR_<?php echo $i ?>_qty_<?php echo $j ?>" value = "<?php echo $curanal['Qty'];?>" id="typeR_<?php echo $i ?>_qty_<?php echo $j ?>" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)"> </td>
                            <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="typeR_<?php echo $i ?>_formula_<?php echo $j ?>" value = "<?php echo $curanal['CFormula'];?>" id="typeR_<?php echo $i ?>_formula_<?php echo $j ?>" readonly> </td>
                            <td width="3%" align="center">
                                <ul class="action_btns">
                                    <li>
                                        <a href="javascript:void(0);" id="typeR_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                            <input type="hidden" name="typeR_<?php echo $i ?>_ref_<?php echo $j ?>" value = "R<?php echo $curanal['ReferenceId'];?>" id="typeR_<?php echo $i ?>_ref_<?php echo $j ?>"  />
                            <input type="hidden" name="typeR_<?php echo $i ?>_resid_<?php echo $j ?>" id ="typeR_<?php echo $i ?>_resid_<?php echo $j ?>" value="<?php echo $curanal['ResourceId'];?>" />
                            <input type="hidden" name="typeR_<?php echo $i ?>_unit_<?php echo $j ?>" value = "<?php echo $curanal['UnitId'];?>" id="typeR_<?php echo $i ?>_unit_<?php echo $j ?>" />
                            <input type="hidden" name="typeR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="typeR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                            <input type="hidden" name="typeR_<?php echo $i; ?>_rowtype_<?php echo $j; ?>" value = "<?php echo $curanal['TransType'];?>" id="typeR_<?php echo $i; ?>_rowtype_<?php echo $j; ?>">
                            <input type="hidden" name="typeR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $curanal['ResourceName'];?>" id="typeR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                        <?php endif; ?>
                    </tr>
                    <?php $j=$j+1; if(intval($curanal['ReferenceId']) >= $iRefId) {$iRefId = intval($curanal['ReferenceId'])+1; } endforeach; endif; ?>
            <tr id="typeR_<?php echo $i ?>_RowId_<?php echo $j ?>">
                <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                        <input type="checkbox" name="typeR_<?php echo $i ?>_inc_<?php echo $j ?>" value = "<?php echo true;?>" id="typeR_<?php echo $i ?>_inc_<?php echo $j ?>" checked class="ios_checkbox inc_exc"/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="typeR_<?php echo $i ?>ref_<?php echo $j ?>">R<?php echo $iRefId ?></label></td>
                <td width="15%"><input class="parent_text" data-toggle="popover" name="typeR_<?php echo $i ?>_resname_<?php echo $j ?>" id ="typeR_<?php echo $i ?>_resname_<?php echo $j ?>" onfocus="return CheckResourceFocus(this.id,'R')" /></td>
                <td width="5%"><label for ="typeR_<?php echo $i ?>_unitname_<?php echo $j ?>" ></label></td>
                <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="typeR_<?php echo $i ?>_qty_<?php echo $j ?>" id="typeR_<?php echo $i ?>_qty_<?php echo $j ?>" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)"> </td>
                <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="typeR_<?php echo $i ?>_formula_<?php echo $j ?>" id="typeR_<?php echo $i ?>_formula_<?php echo $j ?>" readonly> </td>
                <td width="3%" align="center">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" id="typeR_<?php echo $i ?>_resdel_<?php echo $j ?>" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="typeR_<?php echo $i ?>_ref_<?php echo $j ?>" value = "R<?php echo $iRefId ?>" id="typeR_<?php echo $i ?>_ref_<?php echo $j ?>"  />
                <input type="hidden" name="typeR_<?php echo $i ?>_resid_<?php echo $j ?>" id ="typeR_<?php echo $i ?>_resid_<?php echo $j ?>" />
                <input type="hidden" name="typeR_<?php echo $i ?>_unit_<?php echo $j ?>" value = "" id="typeR_<?php echo $i ?>_unit_<?php echo $j ?>" />
                <input type="hidden" name="typeR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="typeR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="typeR_<?php echo $i; ?>_rowtype_<?php echo $j; ?>" value = "<?php echo $curanal['TransType'];?>" id="typeR_<?php echo $i; ?>_rowtype_<?php echo $j; ?>">
                <input type="hidden" name="typeR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="typeR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="wrowRid_<?php echo $i; ?>" id="wrowRid_<?php echo $i; ?>" value="<?php echo $j; ?>">
    </div>
</div>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading accordion_head" role="tab" id="ckheading_<?php echo $i; ?>" data-toggle="collapse" data-parent="#accordion_<?php echo $i; ?>" href="#ckcollapse_<?php echo $i; ?>" aria-expanded="false" aria-controls="ckcollapse_<?php echo $i; ?>">
    <h4>Check List</h4>
</div>
<div id="ckcollapse_<?php echo $i; ?>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ckheading_<?php echo $i; ?>">
    <div class="panel-body">
        <div class="col-lg-12 padlr0">
            <nav class="navbar inrmdltab_navbar navbar-default">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle mdlnvbr_tgl collapsed ripple" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand inrmdl_navbrand ripple" href="javascript:void(0);">Select Menus</a>
                </div>
                <div id="navbar" class="navbar-collapse padlr0 collapse">
                    <ul class="nav nav-tabs innermdl_tabs">
                        <li class="active"><a href="#worktab_<?php echo $i; ?>" data-toggle="tab" class="ripple">Works</a>
                        </li>
                        <li><a href="#safetytab_<?php echo $i; ?>" data-toggle="tab" class="ripple">Safety</a>
                        </li>
                        <li><a href="#qualitytab_<?php echo $i; ?>" data-toggle="tab" class="ripple">Quality</a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="tab-content">
                <div class="tab-pane fade in active" id="worktab_<?php echo $i; ?>">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-sm-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p style="cursor:pointer" onclick="toggleNewChkListModal('chk-work')"class="heading_checkbox">CheckList
                                                                                    <span>
                                                                                      <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                    </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list workChecklists" id="workchecklist_<?php echo $i; ?>"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="workchkselectall_<?php echo $i; ?>" onclick="selectAllChkList(this, 'chk-work');" />
                                            <label for="workchkselectall_<?php echo $i; ?>" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedWorkCheckLists"></tbody>
                                                <input type="hidden" id="wtype_<?php echo $i; ?>_workchklist" name="wtype_<?php echo $i; ?>_workchklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="safetytab_<?php echo $i; ?>">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-sm-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p  style="cursor:pointer" onclick="toggleNewChkListModal('chk-safety')" class="heading_checkbox">CheckList
                                                                                    <span>
                                                                                      <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                    </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list safetyChecklists" id="safetychecklist_<?php echo $i; ?>"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="workchkselectall_<?php echo $i; ?>" onclick="selectAllChkList(this, 'chk-work');" />
                                            <label for="workchkselectall_<?php echo $i; ?>" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedSafetyCheckLists"></tbody>
                                                <input type="hidden" id="stype_<?php echo $i; ?>_safetychklist" name="stype_<?php echo $i; ?>_safetychklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="qualitytab_<?php echo $i; ?>">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-sm-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p  style="cursor:pointer" onclick="toggleNewChkListModal('chk-quality')"class="heading_checkbox">CheckList
                                                                                    <span>
                                                                                      <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                    </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list qualityChecklists" id="qualitychecklist_<?php echo $i; ?>"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="qualitychkselectall_<?php echo $i; ?>" onclick="selectAllChkList(this, 'chk-quality');" />
                                            <label for="qualitychkselectall_<?php echo $i; ?>" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedQualityCheckLists"></tbody>
                                                <input type="hidden" id="qtype_<?php echo $i; ?>_qualitychklist" name="qtype_<?php echo $i; ?>_qualitychklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
</div>
</td>
</tr>
<?php endforeach; endif;
if ($i==0):?>
    <tr id="rowid_1">
        <input type="hidden" name="worktypeid_1" value = "" id="worktypeid_1" >
        <td width="15%"><input type="text" class="parent_text" name="typename_1" id="typename_1" readonly ></td>
        <td width="3%" align="center">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="mainTr_1"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
                </li>
            </ul>
        </td>
    </tr>
    <!--expand table-->
    <tr style="display:none;" class="subTr_1 paintTr">
    <td colspan="12">
    <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
    <div class="panel-group" id="accordion_1" role="tablist" style="border:1px solid #ddd; background-color:#fff;" aria-multiselectable="true">
    <div class="panel panel-default">
        <div class="panel-heading accordion_head accordion_head_crnt" role="tab" id="raheading_1" data-toggle="collapse" data-parent="#accordion_1" href="#racollapse1_1" aria-expanded="true" aria-controls="racollapse1_1">
            <h4>Rate Analysis</h4>
        </div>
        <div id="racollapse1_1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="raheading_1">
            <div class="panel-body">
                <div class="col-lg-12 col-lg-offset-0" style="margin-top:5px;">
                    <div class="radio_check createds firstStep hideStep" id ="divconcrete_1" style="display: none;">
                        <p>
                            <input type="checkbox" value="Concrete" name="concrete_1" id="concrete_1" onchange="return CheckConcreteMixUnTick()" readonly>
                            <label for="concrete_1">Concrete Mix </label>
                        </p>
                        <p>
                            <input type="checkbox" value="Cement" name="cement_1" id="cement_1" onchange="return CheckCementUnTick()">
                            <label for="cement_1">Cement</label>
                        </p>
                        <p>
                            <input type="checkbox" value="Sand" name="sand_1" id="sand_1" onchange="return CheckSandUnTick()">
                            <label for="sand_1">Sand</label>
                        </p>
                        <p>
                            <input type="checkbox" value="Metal" name="metal_1" id="metal_1" onchange="return CheckMetalUnTick()">
                            <label for="metal_1">Metal</label>
                        </p>
                        <p>
                            <input type="checkbox" value="Thickness" name="thick_1" id="thick_1" onchange="return CheckThickUnTick()">
                            <label for="thick_1">Thickness</label>
                        </p>
                    </div>
                    <!-- Nav tabs -->
                    <div class="darkmenu" id="mixtype_1">
                        <ul>
                            <li class="active"><a href="javascript:void(0);" id="analtypeSS_1" onclick="showmix('sitemix',this.id, event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                            <li><a href="javascript:void(0);" id="analtypeSR_1" onclick="showmix('readymix',this.id, event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
                        </ul>
                    </div>
                    <!-- Tab panes -->
                    <div class="lstate worktype_listed">
                        <ul id="raworktable_1">
                            <li>
                                <label class="lbl_style">Working Qty</label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_1_AnalQty" id="rateanal_1_AnalQty" value="<?php $this->commonHelper()->sanitizeNumber(1,3); ?>" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li id="rateanal_1_AQty_li">
                                <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_1_AQty" id="rateanal_1_AQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'C')" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li id="rateanal_1_BQty_li">
                                <label>Sand<span class="wrktype_label_span">(S)</span></label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_1_BQty" id="rateanal_1_BQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'S')" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li id="rateanal_1_CQty_li">
                                <label>Aggregate<span class="wrktype_label_span">(A)</span></label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_1_CQty" id="rateanal_1_CQty" title="Aggregate (A)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'A')" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li id="rateanal_1_thick_li">
                                <label>Thickness (mm)<span class="wrktype_label_span">(T)</span></label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_1_thick" id="rateanal_1_thick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'T')" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li><a  id="type_1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                        </ul>
                        <ul  style="display: none;" id="raworkRtable_1">
                            <li>
                                <label class="lbl_style">Working Qty</label>
                                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_1_AnalQty" id="rateanalR_1_AnalQty" value="1" title="Working Qty" onkeypress="return isDecimal(event,this)"/>
                            </li>
                            <li><a  id="typeR_1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
                        <table class="table" style="margin-bottom:0px;" id="type_1_restable">
                            <thead>
                            <tr>
                                <th class="bg_clo_subTr">Inc/Exc</th>
                                <th class="bg_clo_subTr">Ref No</th>
                                <th class="bg_clo_subTr">Resource</th>
                                <th class="bg_clo_subTr">Unit</th>
                                <th class="bg_clo_subTr">Coefficient</th>
                                <th class="bg_clo_subTr">Formula</th>
                                <th class="bg_clo_subTr text-center">Action</th>
                            </tr>
                            </thead>
                            <tbody class="sorting">
                            <tr id="type_1_RowId_1">
                                <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                        <input type="checkbox" name="type_1_inc_1" value = "<?php echo true; ?>" id="type_1_inc_1" checked class="ios_checkbox inc_exc"/>
                                        <div class="ios_switch"><span></span></div>
                                    </label></td>
                                <td width="3%"><label for ="type_1_ref_1">R1</label></td>
                                <td width="15%"><input class="parent_text" data-toggle="popover" name="type_1_resname_1" id ="type_1_resname_1" onfocus="return CheckResourceFocus(this.id,'')" /></td>
                                <td width="5%"><label for ="type_1_unitname_1" ></label></td>
                                <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="type_1_qty_1" id="type_1_qty_1" onfocus="return showformula(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)"> </td>
                                <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="type_1_formula_1" id="type_1_formula_1" readonly> </td>
                                <td width="3%" align="center">
                                    <ul class="action_btns">
                                        <li>
                                            <a href="javascript:void(0);" id="type_1_resdel_1" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                        </li>
                                    </ul>
                                </td>
                                <input type="hidden" name="type_1_ref_1" id ="type_1_ref_1" value="R1"/>
                                <input type="hidden" name="type_1_resid_1" id ="type_1_resid_1" />
                                <input type="hidden" name="type_1_unit_1" id="type_1_unit_1" />
                                <input type="hidden" name="type_1_rowrefid_1" value = "1" id="type_1_rowrefid_1">
                                <input type="hidden" name="type_1_rowtype_1" value = "" id="type_1_rowtype_1">
                                <input type="hidden" name="type_1_newresname_1" value = "" id="type_1_newresname_1">
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="wrowid_1" id="wrowid_1" value="1">
                        <table class="table" style="margin-bottom:0px; display:none;" id="typeR_1_restable">
                            <thead>
                            <tr>
                                <th class="bg_clo_subTr">Inc/Exc</th>
                                <th class="bg_clo_subTr">Ref No</th>
                                <th class="bg_clo_subTr">Resource</th>
                                <th class="bg_clo_subTr">Unit</th>
                                <th class="bg_clo_subTr">Coefficient</th>
                                <th class="bg_clo_subTr">Formula</th>
                                <th class="bg_clo_subTr text-center">Action</th>
                            </tr>
                            </thead>
                            <tbody class="sorting">
                            <tr id="typeR_1_RowId_1">
                                <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                        <input type="checkbox" name="typeR_1_inc_1" value = "<?php echo true;?>" id="typeR_1_inc_1" checked class="ios_checkbox inc_exc"/>
                                        <div class="ios_switch"><span></span></div>
                                    </label></td>
                                <td width="3%"><label for ="typeR_1_resid_1">R1</label></td>
                                <td width="15%"><input class="parent_text" data-toggle="popover" name="typeR_1_resname_1" id ="typeR_1_resname_1" onfocus="return CheckResourceFocus(this.id,'R')" /></td>
                                <td width="5%"><label for ="typeR_1_unitname_1" ></label></td>
                                <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="typeR_1_qty_1" id="typeR_1_qty_1" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)"> </td>
                                <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="typeR_1_formula_1" id="typeR_1_formula_1" readonly> </td>
                                <td width="3%" align="center">
                                    <ul class="action_btns">
                                        <a href="javascript:void(0);" id="typeR_1_resdel_1" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </ul>
                                </td>
                                <input type="hidden" name="typeR_1_ref_1" id ="typeR_1_ref_1" value="R1"/>
                                <input type="hidden" name="typeR_1_resid_1" id ="typeR_1_resid_1" />
                                <input type="hidden" name="typeR_1_unit_1" id="typeR_1_unit_1" />
                                <input type="hidden" name="typeR_1_rowrefid_1" value = "1" id="typeR_1_rowrefid_1">
                                <input type="hidden" name="typeR_1_rowtype_1" value = "" id="typeR_1_rowtype_1">
                                <input type="hidden" name="typeR_1_newresname_1" value = "" id="typeR_1_newresname_1">
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="wrowRid_1" id="wrowRid_1" value="1">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
    <div class="panel-heading accordion_head" role="tab" id="ckheading_1" data-toggle="collapse" data-parent="#accordion_1" href="#ckcollapse_1" aria-expanded="false" aria-controls="ckcollapse_1">
        <h4>Check List</h4>
    </div>
    <div id="ckcollapse_1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ckheading_1">
    <div class="panel-body">
        <div class="col-lg-12 padlr0">
            <nav class="navbar inrmdltab_navbar navbar-default">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle mdlnvbr_tgl collapsed ripple" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand inrmdl_navbrand ripple" href="javascript:void(0);">Select Menus</a>
                </div>
                <div id="navbar" class="navbar-collapse padlr0 collapse">
                    <ul class="nav nav-tabs innermdl_tabs">
                        <li class="active"><a href="#worktab_1" data-toggle="tab" class="ripple">Works</a>
                        </li>
                        <li><a href="#safetytab_1" data-toggle="tab" class="ripple">Safety</a>
                        </li>
                        <li><a href="#qualitytab_1" data-toggle="tab" class="ripple">Quality</a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="tab-content">
                <div class="tab-pane fade in active" id="worktab_1">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-lg-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p style="cursor:pointer" onclick="toggleNewChkListModal('chk-work')" class="heading_checkbox">CheckList
                                                                                <span>
                                                                                  <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list workChecklists"  id="workchecklist_1"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="workchkselectall_1" onclick="selectAllChkList(this, 'chk-work');" />
                                            <label for="workchkselectall_1" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="col-lg-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedWorkCheckLists"></tbody>
                                                <input type="hidden" id="wtype_1_workchklist" name="wtype_1_workchklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="safetytab_1">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-lg-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p style="cursor:pointer"onclick="toggleNewChkListModal('chk-safety')"class="heading_checkbox">CheckList
                                                                                <span>
                                                                                  <a  data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list safetyChecklists"  id="safetychecklist_1"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="safetychkselectall_1" onclick="selectAllChkList(this,'chk-safety');" />
                                            <label for="safetychkselectall_1" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="col-lg-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedSafetyCheckLists"></tbody>
                                                <input type="hidden" id="stype_1_safetychklist" name="stype_1_safetychklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="qualitytab_1">
                    <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                        <div class="col-lg-4 col-md-4 clear">
                            <div class="headingWrapper">
                                <p style="cursor:pointer" onclick="toggleNewChkListModal('chk-quality')" class="heading_checkbox">CheckList
                                                                                <span>
                                                                                  <a  data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                </span>
                                </p>
                                <section class="search-container">
                                    <label>
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                        <span class="sr-only">Search icons</span>
                                    </label>
                                    <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                </section>
                            </div>
                            <div class="card workChecklistWrapper">
                                <div class="card-body" style="min-height:50px; max-height:310px;">
                                    <ul class="sampleUI list qualityChecklists"  id="qualitychecklist_1"></ul>
                                </div>
                                <div class="pull-right">
                                    <div class="radio_check">
                                        <p>
                                            <input type="checkbox" value="1" id="qualitychkselectall_1" onclick="selectAllChkList(this, 'chk-quality');" />
                                            <label for="qualitychkselectall_1" class="ripple">Select All</label>
                                        </p>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="col-lg-8 col-md-8">
                            <div class="col-lg-12 col-md-12">
                                <div class="headingWrapper">
                                    <p class="heading_checkbox">Selected CheckList</p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label>
                                        <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                            <table class="table" style=" margin-bottom:0px;">
                                                <tbody class="selectedQualityCheckLists"></tbody>
                                                <input type="hidden" id="qtype_1_qualitychklist" name="qtype_1_qualitychklist"/>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    </td>
    </tr>
<?php endif; ?>
<tr class="remarks">
    <td colspan="7"><textarea placeholder="Enter Remarks" class="remrk element" maxlength="255" name="narration" id="narration" title="Remarks" onfocus="inputFocus(this)" onblur="inputBlur(this)"><?php if(isset($rfcregister['Narration'])) echo $rfcregister['Narration'];?></textarea></td>
</tr>
</tbody>
</table>
<input type="hidden" name="rowid" id="rowid" value="<?php echo isset($rfctrans) ? count($rfctrans) : $i; ?>">
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r" id="submit-btn" style="<?php if ($rfcid !=0) { if ($rfcregister['Approve']=='Y') { echo 'display: none;'; } else { echo '';}} else if ($editid ==0) { echo 'display: none;'; }?>"><a onclick="submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
        <li class="dropdown save_btn float_r" id="next-btn" style="<?php echo ($editid !=0 || $rfcid !=0) ? 'display: none;' : '';?>"><a onclick="nextresource();" data-toggle="tooltip" class="ripple" title="Go to next!">Next</a></li>
        <li class="cancel_btn float_r" id="back-btn" style="<?php echo ($editid !=0 || $rfcid !=0) ? 'display: none;' : '';?>"><a onclick="backresource();" data-toggle="tooltip" class="ripple" title="Back">Back</a></li>
        <li class="can_btn float_l" style="padding-bottom:10px;"><a href="<?php if ($rfcid !=0) { echo $this->basePath().'/project/rfc/rfcregister'; } else if ($editid !=0) {echo $this->basePath().'/project/main/worktypemaster';}  else { echo $this->basePath().'/project/rfc/rfc-what';}?>">Cancel</a></li>
    </ul>
    <table  id="newresitems" style="display: none;">
        <tr>
            <!-- <td > <button type="button" id ="butnewresitems" class="btn btn-info btn-xs" > Resource </button> </td> -->
            <td ><a href="javascript:void(0);" id ="butnewresitems" class="btn btn-link" onclick="return ShowNewResource(event)" >New Resource Created</a></td>
        </tr>
        <tr >
            <table class="table" id="newres" style="display: none; width:50%;border:1px solid #ccc;">
                <thead>
                <tr>
                    <th style="border-right:1px solid #ccc;">Resource Name</th>
                    <th style="border-right:1px solid #ccc;">Type</th>
                    <th class="text-center">&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresname_1" value = "" id="newresname_1" align="right" readonly></td>
                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newrestype_1" value = "" id="newrestype_1" align="right" readonly></td>
                    <td width="3%"><button type="button" name="newresdetails_1" value = "Show Details" id="newresdetails_1" onclick="return ShowResource(this.id)" style="margin:0;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                    <input type="hidden"  name="newresgroup_1" value = "" id="newresgroup_1">
                    <input type="hidden"  name="newresgroupid_1" value = "" id="newresgroupid_1">
                    <input type="hidden"  name="newrestypeid_1" value = "" id="newrestypeid_1">
                    <input type="hidden"  name="newresunit_1" value = "" id="newresunit_1">
                    <input type="hidden"  name="newresunitid_1" value = "" id="newresunitid_1">
                    <input type="hidden"  name="newresrate_1" value = "" id="newresrate_1">
                    <input type="hidden"  name="newwresunit_1" value = "" id="newwresunit_1">
                    <input type="hidden"  name="newwresunitid_1" value = "" id="newwresunitid_1">
                    <input type="hidden"  name="newwresrate_1" value = "" id="newwresrate_1">
                    <input type="hidden"  name="newresmattype_1" value = "" id="newresmattype_1">
                    <input type="hidden"  name="newreslead_1" value = "" id="newreslead_1">
                    <input type="hidden"  name="newrescode_1" value = "" id="newrescode_1">
                    <input type="hidden"  name="newrowrefid_1" value = "" id="newrowrefid_1">
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="newresrowid" id="newresrowid"  value="0">
        </tr>
    </table>
</div>
</form>
</div>
</div>
</div>
<table id="dummy" style="display: none">
<tbody >
<tr id="rowid__1">
    <input type="hidden" name="worktypeid__1" value = "" id="worktypeid__1" >
    <td width="15%"><input type="text" class="parent_text" name="typename__1" id="typename__1" readonly></td>
    <td width="3%" align="center">
        <ul class="action_btns">
            <li>
                <a href="javascript:void(0);" class="mainTr__1"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a>
            </li>
        </ul>
    </td>
</tr>
<tr style="display:none;" class="subTr__1 paintTr">
<td colspan="12">
<div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
<div class="panel-group" id="accordion__1" role="tablist" style="border:1px solid #ddd; background-color:#fff;" aria-multiselectable="true">
<div class="panel panel-default">
    <div class="panel-heading accordion_head accordion_head_crnt" role="tab" id="raheading__1" data-toggle="collapse" data-parent="#accordion__1" href="#racollapse1__1" aria-expanded="true" aria-controls="racollapsel__1">
        <h4>Rate Analysis</h4>
    </div>
    <div id="racollapse1__1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="raheading__1">
        <div class="panel-body">
            <div class="col-lg-12 col-lg-offset-0" style="margin-top:5px;">
                <div class="radio_check createds firstStep hideStep" id ="divconcrete__1" style="display: none;">
                    <p>
                        <input type="checkbox" value="Concrete" name="concrete__1" id="concrete__1"  onchange="return CheckConcreteMixUnTick()" readonly>
                        <label for="concrete__1">Concrete Mix </label>
                    </p>
                    <p>
                        <input type="checkbox" value="Cement" name="cement__1" id="cement__1" onchange="return CheckCementUnTick()">
                        <label for="cement__1">Cement</label>
                    </p>
                    <p>
                        <input type="checkbox" value="Sand" name="sand__1" id="sand__1" onchange="return CheckSandUnTick()">
                        <label for="sand__1">Sand</label>
                    </p>
                    <p>
                        <input type="checkbox" value="Metal" name="metal__1" id="metal__1" onchange="return CheckMetalUnTick()">
                        <label for="metal__1">Metal</label>
                    </p>
                    <p>
                        <input type="checkbox" value="Thickness" name="thick__1" id="thick__1" onchange="return CheckThickUnTick()">
                        <label for="thick__1">Thickness</label>
                    </p>
                </div>
                <!-- Nav tabs -->
                <div class="darkmenu" id="mixtype__1">
                    <ul>
                        <li class="active"><a href="javascript:void(0);" id="analtypeSS__1" onclick="showmix('sitemix',this.id, event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                        <li><a href="javascript:void(0);" id="analtypeSR__1" onclick="showmix('readymix',this.id, event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
                    </ul>
                </div>
                <!-- Tab panes -->
                <div class="lstate worktype_listed">
                    <ul id="raworktable__1">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AnalQty" id="rateanal__1_AnalQty" value="1" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="rateanal__1_AQty_li">
                            <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AQty" id="rateanal__1_AQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'C')" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="rateanal__1_BQty_li">
                            <label>Sand<span class="wrktype_label_span">(S)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_BQty" id="rateanal__1_BQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'S')" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="rateanal__1_CQty_li">
                            <label>Aggregate<span class="wrktype_label_span">(A)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_CQty" id="rateanal__1_CQty" title="Aggregate (A)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'A')" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="rateanal__1_thick_li">
                            <label>Thickness (mm)<span class="wrktype_label_span">(T)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_thick" id="rateanal__1_thick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onchange="changeRatio(this.id,'T')" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li><a  id="type__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                    </ul>
                    <ul  style="display: none;" id="raworkRtable__1">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR__1_AnalQty" id="rateanalR__1_AnalQty" value="1" title="Working Qty" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li><a  id="typeR__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
                    <table class="table" style="margin-bottom:0px;" id="type__1_restable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc/Exc</th>
                            <th class="bg_clo_subTr">Ref No</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Formula</th>
                            <th class="bg_clo_subTr text-center">Action</th>
                        </tr>
                        </thead>
                        <tbody class="sorting">
                        <tr id="type__1_RowId__9">
                            <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                    <input type="checkbox" name="type__1_inc__9" value = "<?php echo true; ?>" id="type__1_inc__9" checked class="ios_checkbox inc_exc"/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for="type__1_ref__9">R1</label></td>
                            <td width="15%"><input class="parent_text" data-toggle="popover" name="type__1_resname__9" id ="type__1_resname__9" onfocus="return CheckResourceFocus(this.id,'')" /></td>
                            <td width="5%"><label for ="type__1_unitname__9" ></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="type__1_qty__9" id="type__1_qty__9" onfocus="return showformula(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)"> </td>
                            <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="type__1_formula__9" id="type__1_formula__9" readonly> </td>
                            <td width="3%" align="center">

                                <ul class="action_btns">
                                    <li>
                                        <a href="javascript:void(0);" id="type__1_resdel__9" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                            <input type="hidden" name="type__1_ref__9" id ="type__1_ref__9" value="R1" />
                            <input type="hidden" name="type__1_resid__9" id ="type__1_resid__9" />
                            <input type="hidden" name="type__1_unit__9" id="type__1_unit__9" />
                            <input type="hidden" name="type__1_rowrefid__9" id="type__1_rowrefid__9" />
                            <input type="hidden" name="type__1_rowtype__9" id="type__1_rowtype__9" />
                            <input type="hidden" name="type__1_newresname__9" id="type__1_newresname__9" />
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="wrowid__1" id="wrowid__1" value="1">
                    <table class="table" style="margin-bottom:0px; display:none;" id="typeR__1_restable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc/Exc</th>
                            <th class="bg_clo_subTr">Ref No</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Formula</th>
                            <th class="bg_clo_subTr text-center">Action</th>
                        </tr>
                        </thead>
                        <tbody class="sorting">
                        <tr id="typeR__1_RowId__9">
                            <td width="1%" style="padding: 10px 0 10px 16px !important;"><label>
                                    <input type="checkbox" name="typeR__1_inc__9" value = "<?php echo true;?>" id="typeR__1_inc__9" checked class="ios_checkbox inc_exc"/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="typeR__1_ref__9">R1</label></td>
                            <td width="15%"><input class="parent_text" data-toggle="popover" name="typeR__1_resname__9" id ="typeR__1_resname__9" onfocus="return CheckResourceFocus(this.id,'R')"/></td>
                            <td width="5%"><label for ="typeR__1_unitname__9" ></label></td>
                            <td width="5%"><input type="text" class="parent_text text-right" maxlength="15" name="typeR__1_qty__9" id="typeR__1_qty__9" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)"> </td>
                            <td width="5%"><input type="text" class="parent_text" data-toggle="popover" name="typeR__1_formula__9" id="typeR__1_formula__9" readonly> </td>
                            <td width="3%" align="center">
                                <ul class="action_btns">
                                    <li>

                                        <a href="javascript:void(0);" id="typeR__1_resdel__9" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                    </li>
                                </ul>
                            </td>
                            <input type="hidden" name="typeR__1_ref__9" id ="typeR__1_ref__9" value="R1" />
                            <input type="hidden" name="typeR__1_resid__9" id ="typeR__1_resid__9" />
                            <input type="hidden" name="typeR__1_unit__9" id="typeR__1_unit__9" />
                            <input type="hidden" name="typeR__1_rowrefid__9" id="typeR__1_rowrefid__9" />
                            <input type="hidden" name="typeR__1_rowtype__9" id="typeR__1_rowtype__9" />
                            <input type="hidden" name="typeR__1_newresname__9" id="typeR__1_newresname__9" />
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="wrowRid__1" id="wrowRid__1" value="1">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-heading accordion_head" role="tab" id="ckheading__1" data-toggle="collapse" data-parent="#accordion__1" href="#ckcollapse__1" aria-expanded="false" aria-controls="ckcollapse__1">
        <h4>Check List</h4>
    </div>
    <div id="ckcollapse__1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ckheading__1">
        <div class="panel-body">
            <div class="col-lg-12 padlr0">
                <nav class="navbar inrmdltab_navbar navbar-default">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle mdlnvbr_tgl collapsed ripple" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand inrmdl_navbrand ripple" href="javascript:void(0);">Select Menus</a>
                    </div>
                    <div id="navbar" class="navbar-collapse padlr0 collapse">
                        <ul class="nav nav-tabs innermdl_tabs">
                            <li class="active"><a href="#worktab__1" data-toggle="tab" class="ripple">Works</a></li>
                            <li><a href="#safetytab__1" data-toggle="tab" class="ripple">Safety</a></li>
                            <li><a href="#qualitytab__1" data-toggle="tab" class="ripple">Quality</a></li>
                        </ul>
                    </div>
                </nav>
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="worktab__1">
                        <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                            <div class="col-lg-4 col-md-4 clear">
                                <div class="headingWrapper">
                                    <p  style="cursor:pointer" onclick="toggleNewChkListModal('chk-work')" class="heading_checkbox">CheckList
                                                            <span>
                                                                <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i>  </a>
                                                            </span>
                                    </p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label><input class="form-control lbl_move height25" type="text" placeholder="Search... "  onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card workChecklistWrapper">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <ul class="sampleUI list workChecklists"  id="workchecklist__1"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8 col-md-8">
                                <div class="col-lg-12 col-md-12">
                                    <div class="headingWrapper">
                                        <p class="heading_checkbox">Selected CheckList</p>
                                        <section class="search-container">
                                            <label>
                                                <i class="fa fa-search" aria-hidden="true"></i>
                                                <span class="sr-only">Search icons</span>
                                            </label>
                                            <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                        </section>
                                    </div>
                                    <div class="card">
                                        <div class="card-body" style="min-height:50px; max-height:310px;">
                                            <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                                <table class="table" style=" margin-bottom:0px;">
                                                    <tbody class="selectedWorkCheckLists"></tbody>
                                                    <input type="hidden" id="wtype__1_workchklist" name="wtype__1_workchklist"/>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="safetytab__1">
                        <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                            <div class="col-lg-4 col-md-4 clear">
                                <div class="headingWrapper">
                                    <p  style="cursor:pointer" onclick="toggleNewChkListModal('chk-safety')" class="heading_checkbox">CheckList
                                                            <span>
                                                                <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i>  </a>
                                                            </span>
                                    </p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label><input class="form-control lbl_move height25" type="text" placeholder="Search... "  onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card workChecklistWrapper">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <ul class="sampleUI list safetyChecklists"  id="safetychecklist__1"></ul>
                                    </div>
                                    <div class="pull-right">
                                        <div class="radio_check">
                                            <p>
                                                <input type="checkbox" value="1" id="safetychkselectall__1" onclick="selectAllChkList(this, 'chk-safety');" />
                                                <label for="safetychkselectall__1" class="ripple">Select All</label>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8 col-md-8">
                                <div class="col-lg-12 col-md-12">
                                    <div class="headingWrapper">
                                        <p class="heading_checkbox">Selected CheckList</p>
                                        <section class="search-container">
                                            <label>
                                                <i class="fa fa-search" aria-hidden="true"></i>
                                                <span class="sr-only">Search icons</span>
                                            </label>
                                            <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                        </section>
                                    </div>
                                    <div class="card">
                                        <div class="card-body" style="min-height:50px; max-height:310px;">
                                            <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                                <table class="table" style=" margin-bottom:0px;">
                                                    <tbody class="selectedSafetyCheckLists"></tbody>
                                                    <input type="hidden" id="stype__1_safetychklist" name="stype__1_safetychklist"/>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="qualitytab__1">
                        <div class="deft_act col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                            <div class="col-lg-4 col-md-4 clear">
                                <div class="headingWrapper">
                                    <p style="cursor:pointer" onclick="toggleNewChkListModal('chk-quality')" class="heading_checkbox">CheckList
                                                            <span>
                                                                <a data-toggle="tooltip" data-placement="right" title="Add New Checklist" class="btn_newlist"> <i class="fa fa-plus"></i>  </a>
                                                            </span>
                                    </p>
                                    <section class="search-container">
                                        <label>
                                            <i class="fa fa-search" aria-hidden="true"></i>
                                            <span class="sr-only">Search icons</span>
                                        </label><input class="form-control lbl_move height25" type="text" placeholder="Search... "  onkeyup="chkSearch(this)">
                                    </section>
                                </div>
                                <div class="card workChecklistWrapper">
                                    <div class="card-body" style="min-height:50px; max-height:310px;">
                                        <ul class="sampleUI list qualityChecklists" id="qualitychecklist__1"></ul>
                                    </div>
                                    <div class="pull-right">
                                        <div class="radio_check">
                                            <p>
                                                <input type="checkbox" value="1" id="qualitychkselectall__1" onclick="selectAllChkList(this, 'chk-quality');" />
                                                <label for="qualitychkselectall__1" class="ripple">Select All</label>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8 col-md-8">
                                <div class="col-lg-12 col-md-12">
                                    <div class="headingWrapper">
                                        <p class="heading_checkbox">Selected CheckList</p>
                                        <section class="search-container">
                                            <label>
                                                <i class="fa fa-search" aria-hidden="true"></i>
                                                <span class="sr-only">Search icons</span>
                                            </label>
                                            <input class="form-control lbl_move height25" type="text" placeholder="Search... " onkeyup="chkSearch(this)">
                                        </section>
                                    </div>
                                    <div class="card">
                                        <div class="card-body" style="min-height:50px; max-height:310px;">
                                            <div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
                                                <table class="table" style=" margin-bottom:0px;">
                                                    <tbody class="selectedQualityCheckLists"></tbody>
                                                    <input type="hidden" id="qtype__1_qualitychklist" name="qtype__1_qualitychklist"/>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div id="dummyheader" style="display: none">
    <table id="dummyanalhead">
        <tbody>
        <tr id="type__1_header__9">
            <td colspan="6"><input type="text" class="parent_text"  style="font-weight:bold" name="type__1_resdes__9" id="type__1_resdes__9"></td>
            <input type="hidden" name="type__1_rowrefid__9" value = "" id="type__1_rowrefid__9">
            <input type="hidden" name="type__1_rowtype__9" value = "H" id="type__1_rowtype__9">
            <td width="3%" align="center">
                <ul class="action_btns">
                    <li>
                        <a href="javascript:void(0);" id="type__1_resdel__9" onclick="DeleteResource(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                    </li>
                </ul>
            </td>
        </tr>
        <tr id="typeR__1_header__9">
            <td colspan="6"><input type="text" class="parent_text" style="font-weight:bold" name="typeR__1_resdes__9" id="typeR__1_resdes__9"></td>
            <input type="hidden" name="typeR__1_rowrefid__9" value = "" id="typeR__1_rowrefid__9">
            <input type="hidden" name="typeR__1_rowtype__9" value = "H" id="typeR__1_rowtype__9">
            <td width="3%" align="center">
                <ul class="action_btns">
                    <li>
                        <a href="javascript:void(0);" id="typeR__1_resdel__9" onclick="DeleteResourceR(this.id,event)"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                    </li>
                </ul>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<div id="AddCheckListModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Create New Checklist</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" id="newchktype">
                <div class="col-lg-12">
                    <div class="form-group col-lg-12">
                        <label style="margin-bottom: 10px;">Name</label>
                        <input type="text" class="parent_text" id="newchkname">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return createNewCheckList()" data-toggle="tooltip" data-original-title="Create">Create</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Resource Picklist</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive clear">
                    <div id="respickgrid"> </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="picklistrestype" value="">
                <input type="hidden" id="picklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="resourcemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="resrowid" id="resrowid" >
                <input type="hidden" id="refNewResRowName" />
                <div class="col-lg-12" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Code</label>
                        <input type="text" class="parent_text" name="rescode" id="rescode" onblur="CheckResCode()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-12">
                        <label style="margin-bottom: 10px;">Resource Name</label>
                        <input type="text" class="parent_text" name="resname" id="resname" onblur="CheckResName()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Group</label>
                        <input type="text" class="parent_text" name="resgroup" id="resgroup" autocomplete="off">
                        <input type="hidden" name="resgroupid" id="resgroupid">
                    </div>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Type</label>
                        <input type="text" class="parent_text"  name="restype" id="restype" readonly>
                        <input type="hidden" name="restypeid" id="restypeid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Unit</label>
                        <input type="text" class="parent_text" name="resunit" id="resunit" autocomplete="off">
                        <input type="hidden" name="resunitid" id="resunitid">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkunit">
                        <label style="margin-bottom: 10px;">Working Unit</label>
                        <input type="text" class="parent_text" name="wresunit" id="wresunit" autocomplete="off">
                        <input type="hidden" name="wresunitid" id="wresunitid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="resrate" id="resrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkrate">
                        <label style="margin-bottom: 10px;">Working Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="wresrate" id="wresrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                </div>
                <div class="col-lg-12" id ="divmattype">
                    <div class="form-group col-lg-6">
                        <label>Material Type</label>
                        <div class="select-style rfc_meoption">
                            <select name="resmattype" id ="resmattype">
                                <option value="G">General</option>
                                <option value="F">Fuel</option>
                                <option value="S">Steel</option>
                                <option value="P">Production</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Lead Time (in Days)</label>
                        <input type="text" class="parent_text text-right"  name="restlead" maxlength="3" id="reslead" onkeypress="return isDecimal(event,this)">
                    </div>
                </div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return ResourceClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="newresok" class="md_ok" onclick="return ResourceUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="formula" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Formula</h1>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formula Expression</label>
                    <input type="text" class="parent_text" name="formulaexp"  maxlength="20" id="formulaexp" onchange="return formulacalculation()" onkeypress="return isFormula(event);" >
                </div>
                <div class="form-group">
                    <input type="text" class="parent_text text-right"  name="formulavalue" id="formulavalue" readonly >
                </div>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return formulaok()" data-toggle="tooltip" class="ripple has-ripple" data-original-title="Apply">Apply</button>
            </div>
        </div>
    </div>
</div>
<script type="text/template" id="checklist-template">
    <li class="tile search-item">
        <div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">
            <label>
                <input type="checkbox" class="search-element" id="wtype__0_chkList__1" value="{{id}}" data-name="{{name}}" onclick='selectList(this, "{{chktype}}");' />
                <span>{{name}}</span>
            </label>
        </div>
    </li>
</script>
<script type="text/template" id="tr-checklist-template">
    <tr class="search-item">
        <td width="97%">
            <div class="show_hide11 col-md-12">
                <input type="hidden" class="search-element" name="wtype__0_{{typelabel}}chklistid__1" id="wtype__0_{{typelabel}}chklistid__1" value="{{id}}" data-name="{{name}}"/>
                <p style="margin: 0;">{{name}}</p>
                <ul class="action_btns action_btns1">
                    <li><a id="wtype__0_chkListDelete__1" onclick="return removeList(this, '{{chktype}}');"><i class="fa fa-times-circle" data-original-title="Close" data-placement="top" data-toggle="tooltip" aria-hidden="true"></i></a></li>
                </ul>
            </div>
            <!----checklist--->
            <div class="work-frq slidingDiv11 col-md-12" >
                <div class="col-md-2 critical">
                    <label class="col-md-12">Priority</label>
					<div class="col-md-12">
                        <select class="form-control single_dropdown lbl_move " name ="wtype__0_{{typelabel}}priority__1"  id = "wtype__0_{{typelabel}}priority__1" style="width:100%;" >
                            <option value="H">High</option>
                                    <option value="M">Middle</option>
                                    <option value="L">Low</option>
                        </select>
					</div>
                    <!--div class="checkbox checkbox-styled">
                        <label>
                            <input type="checkbox" name="wtype__0_{{typelabel}}critical__1" id="wtype__0_{{typelabel}}critical__1" value="1">
                            <span></span>
                        </label>
                    </div-->
                </div>
                <div class="col-md-6" style="padding-right:0 !important">
                    <div class="col-md-12 critical">
                        <label class="col-md-12">When</label>
                        <div class="col-md-5" style="padding-right:0 !important">
                            <select class="form-control single_dropdown lbl_move " style="width:100%;" name="wtype__0_{{typelabel}}whentype__1" id="wtype__0_{{typelabel}}whentype__1">
                                <option></option>
                                <option value="A">After</option>
                                <option value="B">Before</option>
                                <option value="D">During</option>
                            </select>
                        </div>
                        <div class="col-md-3" style="padding-right:0 !important">
                            <input type="text" class="form-control lbl_move" name="wtype__0_{{typelabel}}whenperiod__1" id="wtype__0_{{typelabel}}whenperiod__1" onkeypress="return isNumberKey(event,this)" maxlength="3"/>
                        </div>
                        <div class="col-md-4">
                            <select class="form-control single_dropdown lbl_move " style="width:100%;"  name="wtype__0_{{typelabel}}whenperiodtype__1" id="wtype__0_{{typelabel}}whenperiodtype__1">
                                <option></option>
                                <option value="D">Day</option>
                                <option value="H">Hours</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" style="padding-right:0 !important">
                    <div class="col-md-12 critical">
                        <label class="col-md-12">Frequency</label>
                        <div class="col-md-4" style="padding-right:0 !important">
                            <input type="text" class="form-control lbl_move" name="wtype__0_{{typelabel}}freqperiod__1" id="wtype__0_{{typelabel}}freqperiod__1" onkeypress="return isNumberKey(event,this)" maxlength="3"/>
                        </div>
                        <div class="col-md-8">
                            <select class="form-control single_dropdown lbl_move " style="width:100%;" name="wtype__0_{{typelabel}}freqperiodtype__1" id="wtype__0_{{typelabel}}freqperiodtype__1">
                                <option></option>
                                <option value="D">Day</option>
                                <option value="H">Hours</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div><!----checklist--->
        </td>
    </tr>
</script>

<script type="text/javascript">
var WorkCheckList = <?php echo (isset($WorkCheckList)) ? json_encode($WorkCheckList) : '[]';?>;
var SafetyCheckList = <?php echo (isset($SafetyCheckList)) ? json_encode($SafetyCheckList) : '[]';?>;
var QualityCheckList = <?php echo (isset($QualityCheckList)) ? json_encode($QualityCheckList) : '[]';?>;

var selectedworkchks = <?php echo (isset($selectedworkchks)) ? json_encode($selectedworkchks) : '[]';?>;
var selectedsafetychks = <?php echo (isset($selectedsafetychks)) ? json_encode($selectedsafetychks) : '[]';?>;
var selectedqualitychks = <?php echo (isset($selectedqualitychks)) ? json_encode($selectedqualitychks) : '[]';?>;
$(function () {
    $('body').tooltip({
        selector: '.error'
    });
});

var bSiteMix=true;
var iFocusRowId=1;
var iTransRowId=0;
var arrayreslist = <?php echo json_encode($reslist); ?>;
var arrayresgroup = <?php echo json_encode($resgroup); ?>;
var arrayunitlist = <?php echo json_encode($unit); ?>;
var arraywunitlist = <?php echo json_encode($wunit); ?>;
var arrayres = arrayreslist;
var arrayresR = arrayreslist;
var arrrespicklist = <?php echo json_encode($respicklist); ?>;
var arrrespicklistR = [];

function submitForm() {
    $('form').submit();
}

$(function(){
    $('#resgroup').autocomplete({
        lookup: arrayresgroup,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resgroupid").val(suggestion.data);
                $('#restype').val(suggestion.TypeName);
                $('#restypeid').val(suggestion.TypeId);
                $('#divworkunit').hide();
                $('#divworkrate').hide();
                $('#divmattype').hide();
                if (suggestion.TypeId== 2) $('#divmattype').show();
                if (suggestion.TypeId== 3) { $('#divworkunit').show();$('#divworkrate').show();}

                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resgroupid").val(0);
            $('#divworkunit').hide();
            $('#divworkrate').hide();
            $('#divmattype').hide();
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#resgroupid").val(0);
            } else
                $(this).removeClass('error');
        }
    });
    $('#resunit').autocomplete({
        lookup: arrayunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#resunitid").val(0);
            } else $(this).removeClass('error');
        }
    });
    $('#wresunit').autocomplete({
        lookup: arraywunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#wresunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#wresunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#wresunitid").val(0);
            } else $(this).removeClass('error');
        }
    });
    // modal forms on close
    $('#resourcemodal').on('hidden.bs.modal', function () {
        $(this).find('input').val('');
    });

    $('.content_wrapper').on('click', '.show_hide11',function(e){
        if(!$(e.target).is('p')) {
            e.preventDefault();
            return false;
        }

        $('.slidingDiv11:visible').slideUp();
        $(this).next(".slidingDiv11").slideToggle();
    });

    $("#sample12 .single_dropdown").select2({
        placeholder: "",
        allowClear: true
    });
});
// Expand Script
function expandTrFn(reset) {
    var $mainTRs = $("a[class*=mainTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1],
            $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")) {
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.addClass("tform");
            $('rateanal_'+ key +'restable').show();
            iFocusRowId = key;
            CheckShowDetails();
            closedetails(name);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("tform");
        }
        return false;
    });
}
function clickExpandTr(name) {
    if ($('.subTr_' + iFocusRowId).is(':visible')) return;
    var key = name.split('_')[1];
    $('a.mainTr_' + key).trigger('click');
}
function ResourceClose() {
    if (sResUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewResRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#resourcemodal').modal('toggle');
}
function bindPopOver() {
    var $inputs =  $('input[data-toggle="popover"]');
    $inputs.unbind('popover');
    $inputs.popover({
        placement : 'bottom',
        trigger : 'hover'
    });
}
function ResourceUpdate() {
    var isValid =true;
    var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
    if (icodegenType==0) {
        CheckResCode();
        if ($('#rescode').val().length == 0){
            showError($('#rescode'), 'Required');
            isValid = false;
        }
        if ($('#rescode').hasClass('error')) isValid = false;
    }

    CheckResName();
    if ($('#resname').hasClass('error')) isValid=false;
    if ($('#resgroup').hasClass('error')) isValid=false;
    else if ($('#resunit').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#resgroupid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#restypeid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#resunitid').val(),'number') ==0) isValid=false;
    var restypeid= parseInt(isNullCheck($('#restypeid').val(),'number'));
    if (restypeid==3) {
        if (isNullCheck( $('#wresunitid').val(),'number') ==0) isValid=false;
    }
    if (isValid==false) return;
    var resname = isNullCheck($('#resname').val(),'string'),
        resgroupid = isNullCheck($('#resgroupid').val(),'number'),
        resgroup = isNullCheck($('#resgroup').val(),'string'),
        resunit = isNullCheck($('#resunit').val(),'string'),
        resunitid = isNullCheck($('#resunitid').val(),'number'),
        wresunit = isNullCheck($('#wresunit').val(),'string'),
        wresunitid = isNullCheck($('#wresunitid').val(),'number'),
        restype = isNullCheck($('#restype').val(),'string'),
        resrate = isNullCheck($('#resrate').val(),'number'),
        wresrate = isNullCheck($('#wresrate').val(),'number'),
        reslead = isNullCheck($('#reslead').val(),'number'),
        resmattype = isNullCheck($('#resmattype').val(),'string'),
        rescode = isNullCheck($('#rescode').val(),'string');
    var irow = 0;
    if (sResUpdateMode=='Add') {
        //var irows = $('#newres tr').length;
        var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
        irow = +irows+1;
        if ($('#newresname_'+irow).val() !="") {
            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newresrowid').val(irow);
    } else irow = $('#resrowid').val();
    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created " + " : <i class='fa fa-long-arrow-right'></i><span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();

    if (sResUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWSpec = 'New.' + irow + ' ' + resname;

        var sUnit =resunit,iUnitId=resunitid;
        if (restypeid==3) {
            sUnit =wresunit;
            iUnitId=wresunitid;
        }

        arrayreslist.push({
            data: sWid,
            value: sWSpec,
            UnitName: sUnit,
            UnitId: iUnitId,
            ResourceName: resname
        });

        arrrespicklist.push({
            ResourceId: sWid,
            TypeId: restypeid,
            UnitId: iUnitId,
            Code: 'R ' + 'New.' + irow,
            ResourceName: resname,
            UnitName: sUnit,
            TypeName: restype,
            ResourceGroup: resgroup,
            Select:0
        });

        var $newResRow = $('#' + $('#refNewResRowName').val()),
            key = $newResRow[0].id.split('_');
        if (bSiteMix==false) {
            var ssname = 'typeR_' + key[1] + '_unitname_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#typeR_' + key[1] + '_unit_' + key[3]).val(iUnitId);
            $('#typeR_' + key[1] + '_resid_' + key[3]).val(sWid);
            $('#typeR_' + key[1] + '_newresname_' + key[3]).val(resname);
        } else {
            var ssname = 'type_' + key[1] + '_unitname_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#type_' + key[1] + '_unit_' + key[3]).val(iUnitId);
            $('#type_' + key[1] + '_resid_' + key[3]).val(sWid);
            $('#type_' + key[1] + '_newresname_' + key[3]).val(resname);
        }
        $newResRow.val('');
        $newResRow.removeClass('error');
        bindResRowAutoComplete($newResRow);
        bindResourceChange();
        bindPopOver();
        $newResRow.val(sWSpec);
        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
        if (bSiteMix==false) AddNewRowResR(key[1]);
        else AddNewRowRes(key[1]);
    } else {


    }
    $('#resourcemodal').modal('toggle');
}

function CheckResCode() {

    var iARowid  = $('#resrowid').val(),
        $resCode = $('#rescode'),
        resCode =  $resCode.val().trim();

    removeError($resCode);
    if (resCode.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkrescodefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'rescode':resCode,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resCode, 'Already used');
                return;
            }
        }
    });

    if ($resCode.hasClass('error')) return;
    removeError($resCode);
    var $codes = $('input[id^=newrescode_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resCode.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resCode, 'Already used');
                    return;
                }
            }
        }
    });
}

function CheckResName() {

    var iARowid  = $('#resrowid').val(),
        $resName = $('#resname'),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#rfcUId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkresnamefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'resname':resName,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resName, 'Already used');
                return;
            }
        }
    });

    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('input[id^=newresname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already used');
                    return;
                }
            }
        }
    });
}



function ShowNewResource(e) {
    e.preventDefault();
    var $newr = $('#newres');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function ShowResource(id) {
    var irow = id.split('_')[1];
    $("#newresok").html('Save');
    sResUpdateMode='Edit';
    $('#resrowid').val(irow);
    $('#resname').prop('readonly', true);
    $('#resname').val($('#newresname_'+ irow).val());
    $('#' + id).prop('readonly', true);
    $('#resgroup').val($('#newresgroup_'+ irow).val());
    $('#rescode').val($('#newrescode_'+ irow).val());
    $('#resgroupid').val($('#newresgroupid_'+ irow).val());
    $('#restype').val($('#newrestype_'+ irow).val());
    $('#restypeid').val($('#newrestypeid_'+ irow).val());
    $('#resunit').val($('#newresunit_'+ irow).val());
    $('#resunitid').val($('#newresunitid_'+ irow).val());
    $('#wresunit').val($('#newwresunit_'+ irow).val());
    $('#wresunitid').val($('#newwresunitid_'+ irow).val());
    $('#resrate').val($('#newresrate_'+ irow).val());
    $('#wresrate').val($('#newwresrate_'+ irow).val());
    $('#resmattype').val($('#newresmattype_'+ irow).val());
    $('#reslead').val($('#newreslead_'+ irow).val());
    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 2) $('#divmattype').show();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 3) { $('#divworkunit').show();$('divworkrate').show();}

    $("#resourcemodal").modal('show');
}
function AddNewResource(x) {
    var sStr = x.id.split("_");
    iFocusRowId= sStr[1];
    iTransRowId = sStr[3];
    bSiteMix=true;
    if (x.id.substr(x.id.indexOf('_') - 1, 1) === 'R') bSiteMix=false;
    sResUpdateMode='Add';
    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    $('#resrowid').val(0);
    $('#resname').prop('readonly', false);
    $("#newresok").html('Create');
    $("#resourcemodal").modal('show');
    $('#refNewResRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#resname').val($(x).val());
    $('#' + x.id).prop('readonly', false);
}
function bindResourceChange() {
    var $resnames = $('input[id*=_resname_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $('#'+ name).attr('data-content', $('#'+ name).val());
        $this.blur(function () {
            if (isNullCheck($('#'+ name).val(),'string') =="") $this.removeClass('error');
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
        $this.change(function () {
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
    });

    // formulas bind tooltip
    var $formulas = $('input[id*=_formula_]');
    $.each($formulas, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $('#'+ name).attr('data-content', $('#'+ name).val());
        $this.blur(function () {
            if (isNullCheck($('#'+ name).val(),'string') == "") $this.removeClass('error');
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
        $this.change(function () {
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
    });
}
function bindAutoComplete() {
    var $resnames = $('input[id*=_resname_]');
    $resnames.unbind('autocomplete');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            arr_names = name.split('_');
        if (name.indexOf('__') != -1) return;
        var key1 = arr_names[1],
            key2 = arr_names[3];
        if (name.substr(name.indexOf('_') - 1, 1) === 'R') {
            var $resunit = $("label[for='typeR_" + key1 + "_unitname_"+key2+"']"),
                $resid = $('#typeR_' + key1 + '_resid_' + key2),
                $resname = $('#typeR_' + key1 + '_resname_' + key2),
                $resunitid = $('#typeR_' + key1 + '_unit_' + key2),
                $newresname = $('#typeR_' + key1 + '_newresname_' + key2);
            $this.autocomplete({
                lookup: arrayresR,
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResourceR('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function(suggestion) {
                    if(suggestion) {
                        $resid.val(suggestion.data);
                        $resunit.html(suggestion.UnitName);
                        $resunitid.val(suggestion.UnitId);
                        $newresname.val(suggestion.ResourceName);
                        $resname.prop('disabled', true);
                        if ($('#typeR_'+key1+'_RowId_' + (parseInt(key2) + 1)).length == 0) AddNewRowResR(key1);
                        $(this).removeClass('error');
                    }
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $resunitid.val(0);
                        $resid.val(0);
                    } else
                        $(this).removeClass('error');
                }
            });
        } else {
            var $resunit = $("label[for='type_" + key1 + "_unitname_"+key2+"']"),
                $resid = $('#type_' + key1 + '_resid_' + key2),
                $resname = $('#type_' + key1 + '_resname_' + key2),
                $resunitid = $('#type_' + key1 + '_unit_' + key2),
                $newresname = $('#type_' + key1 + '_newresname_' + key2);
            $this.autocomplete({
                lookup: arrayres,
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resunit.html(suggestion.UnitName);
                        $resunitid.val(suggestion.UnitId);
                        $resid.val(suggestion.data);
                        $newresname.val(suggestion.ResourceName);
                        $resname.prop('disabled', true);
                        if ($('#type_'+key1+'_RowId_' + (parseInt(key2) + 1) + ":not(.tr-header)").length == 0) AddNewRowRes(key1);
                        $(this).removeClass('error');
                    }
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $resunitid.val(0);
                        $resid.val(0);
                    } else $(this).removeClass('error');
                }
            });
        }
    });
}
function bindResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    var sName = arr_names[0];
    if (sName.substr(sName.length-1) == 'R') {
        checkResource(key1,"R");
        var $resunit = $("label[for='typeR_" + key1 + "_unitname_"+key2+"']"),
            $resid = $('#typeR_' + key1 + '_resid_' + key2),
            $resname = $('#typeR_' + key1 + '_resname_' + key2),
            $resunitid = $('#typeR_' + key1 + '_unit_' + key2),
            $newresname = $('#typeR_' + key1 + '_newresname_' + key2);
        $this.autocomplete({
            lookup: arrayresR,
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $resid.val(suggestion.data);
                    $resunit.html(suggestion.UnitName);
                    $resunitid.val(suggestion.UnitId);
                    $newresname.val(suggestion.ResourceName);
                    $resname.prop('disabled', true);
                    if ($('#typeR_'+key1+'_RowId_' + (parseInt(key2) + 1) + ':not(.tr-header)').length == 0) AddNewRowResR(key1);
                    $(this).removeClass('error');
                }
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $resunitid.val(0);
                    $resid.val(0);
                } else
                    $(this).removeClass('error');
            }
        });
    } else {
        checkResource(key1,"");
        var $resunit = $("label[for='type_" + key1 + "_unitname_"+key2+"']"),
            $resid = $('#type_' + key1 + '_resid_' + key2),
            $resname = $('#type_' + key1 + '_resname_' + key2),
            $resunitid = $('#type_' + key1 + '_unit_' + key2),
            $newresname = $('#type_' + key1 + '_newresname_' + key2);
        $this.autocomplete({
            lookup: arrayres,
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resunit.html(suggestion.UnitName);
                    $resunitid.val(suggestion.UnitId);
                    $resid.val(suggestion.data);
                    $newresname.val(suggestion.ResourceName);
                    $resname.prop('disabled', true);
                    if ($('#type_'+key1+'_RowId_' + (parseInt(key2) + 1) + ':not(.tr-header)').length == 0) AddNewRowRes(key1);
                    $(this).removeClass('error');
                }
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $resunitid.val(0);
                    $resid.val(0);
                } else $(this).removeClass('error');
            }
        });
    }
}
function DeleteResource(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    var sRowtype = isNullCheck($('#type_'+ iFocusRowId + '_rowtype_' + iARowid).val(),'string');
    if (sRowtype =="H") {

        if (confirm('Do you want to Delete')) {
            var $row = $('#type_' + iFocusRowId + '_RowId_' + iARowid);
            $row.remove();
            SortOrder(iFocusRowId);
        }
    } else {
        if (isNullCheck($('#type_' + iFocusRowId + '_resid_' + iARowid).val(), 'number') == 0) return;
        if (confirm('Do you want to Delete')) {
            var $row = $('#type_' + iFocusRowId + '_RowId_' + iARowid),
                irid = $('#wrowid_' + iFocusRowId).val(),
                $resname = $('#type_' + iFocusRowId + '_resname_' + irid);
            $row.remove();
            bindResRowAutoComplete($resname);
            SortOrder(iFocusRowId);
        }
    }
    return false;
}
function DeleteResourceR(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId = sStr[1];
    var sRowtype = isNullCheck($('#typeR_'+ iFocusRowId + '_rowtype_' + iARowid).val(),'string');
    if (sRowtype =="H") {
        if (confirm('Do you want to Delete')) {
            var $row = $('#typeR_' + iFocusRowId + '_RowId_' + iARowid);
            $row.remove();
            SortOrderR(iFocusRowId);
        }
    } else {
        if (isNullCheck($('#typeR_' + iFocusRowId + '_resid_' + iARowid).val(), 'number') == 0) return;
        if (confirm('Do you want to Delete')) {
            var $row = $('#typeR_' + iFocusRowId + '_RowId_' + iARowid),
                irid = $('#wrowRid_' + iFocusRowId).val(),
                $resname = $('#typeR_' + iFocusRowId + '_resname_' + irid);
            $row.remove();
            bindResRowAutoComplete($resname);
            SortOrderR(iFocusRowId);
        }
    }
    return false;
}
function AddNewRowResHeader(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId = parseInt(isNullCheck($('#wrowid_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];
    var sValue = $('#type_' + iFocusRowId + '_resname_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#type_'+iFocusRowId + '_restable',
        sStr= '<tr id="type__1_RowId__9" class="tr-header">' + $("#type__1_header__9").html() + '</tr>';

    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    //$(stabelrow+" tbody.sorting  tr:nth-child(" + (iARowid) + ")").before(sStr);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#type_' + iFocusRowId + '_resdes_' + irowinfoId).val(sValue);
    $('#type_' + iFocusRowId + '_rowtype_' + irowinfoId).val("H");
    $('#type_' + iFocusRowId + '_resname_' + iARowid).val('');
    $('#type_' + iFocusRowId + '_resname_' + iARowid).removeClass('error');
    var sRow = '#wrowid_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    bindMixSortablefn(true);
    SortOrder(iFocusRowId);
}
function AddNewRowResHeaderR(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId = parseInt(isNullCheck($('#wrowRid_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];
    var sValue = $('#typeR_' + iFocusRowId + '_resname_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#typeR_'+iFocusRowId + '_restable',
        sStr= '<tr id="typeR__1_RowId__9" class="tr-header">' + $("#typeR__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
//    $(stabelrow+" tbody.sorting  tr:nth-child(" + (iARowid) + ")").before(sStr);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#typeR_' + iFocusRowId + '_resdes_' + irowinfoId).val(sValue);
    $('#typeR_' + iFocusRowId + '_rowtype_' + irowinfoId).val("H");
    $('#typeR_' + iFocusRowId + '_resname_' + iARowid).val('');
    $('#typeR_' + iFocusRowId + '_resname_' + iARowid).removeClass('error');
    var sRow = '#wrowRid_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    bindMixSortablefn(true);
    SortOrderR(iFocusRowId);
}
$(function () {
    // disable on enter form submit
    $(window).keydown(function(event){
        if(event.keyCode == 13) {
            event.preventDefault();
            return false;
        }
    });
    var irfcid = $('#rfcUId').val(),
        editid = $('#editid').val();
    var url1 = getBaseURL() + "project/rfc/getrfcworktypepicklist/"+irfcid+"/"+editid;
    var rfcsource =
    {
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'WorkTypeId', type: 'number' },
            { name: 'WorkType', type: 'string' },
            { name: 'available', type: 'boolean' }
        ],
        id: 'WorkTypeId',
        url: url1
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    $("#grid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'none',
        columns: [
            { text: 'WorkTypeId', datafield: 'WorkTypeId', hidden: true },
            { text: 'WorkType', datafield: 'WorkType', editable:false, width: '80%' },
            { text: 'Action', align:'center', datafield: 'available', columntype: 'checkbox', width: '20%' }
        ]
    });
    $("#grid").bind('cellendedit', function (event) {
        if (event.args.value) {
            $("#grid").jqxGrid('selectrow', event.args.rowindex);
        } else {
            $("#grid").jqxGrid('unselectrow', event.args.rowindex);
        }
    });
    if ($("#grid").jqxGrid('getrows').length === 0) $('#nextbut').hide();
    else $('#nextbut').show();
    if (bSiteMix ==true){var sTable = 'type_' + iFocusRowId + '_restable';}
    else {var sTable = 'typeR_' + iFocusRowId + '_restable';}
    $('#' + sTable + ' tbody').on( 'dblclick', 'tr', function () {
        $(this).toggleClass('selected',true);
    });
    $('#' + sTable + ' tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected',false);
    });
    expandTrFn();
    //bindAutoComplete();
    bindResourceChange();
    bindMixSortablefn();
    bindPopOver();

    if(editid != 0 || irfcid != 0) {
        bindCheckLists();
    }
});
function bindMixSortablefn(reset) {
    // ReadyMix sortable function
    var $rBody = $('table[id*=typeR_] tbody.sorting'),
        $sBody = $('table[id*=type_] tbody.sorting');

    $.each($rBody, function(i, obj){
        if ($(this).parent('table')[0].id.indexOf('__') != -1) {
            $rBody.splice(i, 1);
            $sBody.splice(i, 1);
        }
    });
    var $sRTable = $rBody.find('tr'),
        $sTable = $sBody.find('tr');
    if (typeof reset !== 'undefined' && reset === true) {
        $sRTable.unbind('click', 'dblclick', 'select', 'sortable');
        $sTable.unbind('click', 'dblclick', 'select', 'sortable');
        $rBody.unbind('sortable');
        $sBody.unbind('sortable');
    }
    $sRTable.on( 'dblclick', function () {
        var $this = $(this);

        if ($this.hasClass('selected') == true) {
            $this.toggleClass('selected', false);
        } else
            $this.toggleClass('selected', true);
    });

    $sRTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
    });

    $sRTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
    });

    $rBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrderR(ifrow);
        }
    });

    // SiteMix sortable function
    $sTable.on( 'dblclick', function () {
        var $this = $(this);

        if ($this.hasClass('selected') == true)
            $this.toggleClass('selected', false);
        else
            $this.toggleClass('selected', true);
    });

    $sTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
    });

    $sTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
    });

    $sBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrder(ifrow);
        }
    });
}
var fixHelperModified = function(e, tr) {
        var $originals = tr.children();
        var $helper = tr.clone();
        $helper.children().each(function(index) {
            $(this).width($originals.eq(index).width())
        });
        return $helper;
    },
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };
function SortOrder(iRowid) {
    var rows = $('tr[id^=type_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];

        $('#type_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}

function SortOrderR(iRowid) {
    var rows = $('tr[id^=typeR_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#typeR_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}

function backresource() {
    closedetails('');
    $('#edit-list').show();
    $('#next-btn').show();
    $('#edit-content').hide();
    $('#submit-btn').hide();
    $('#back-btn').hide();
}
function CheckIdFound(ids,id) {
    var bfound=false,
        idList = ids.split(",");
    for (var x=0;x< idList.length;x++) {
        if (idList[x]==id) {
            bfound=true;
            break;
        }
    }
    return bfound;
}
function CheckWorkTypeIdFound(rows,id) {
    var bfound=false;
    for (var x=1;x<= rows;x++) {
        if ($('#worktypeid_'+x).val() == id) {
            bfound=true;
            break;
        }
    }
    return bfound;
}
function nextresource() {
    var rows = $("#grid").jqxGrid('getrows');
    var id = "";
    for (var m = 0; m < rows.length; m++) {
        var row = $("#grid").jqxGrid('getrowdata', m);
        if (row.available==true) {
            id=id + row.WorkTypeId + ',';
        }
    }
    if (id.length !=0) {
        id = id.slice(0,-1);
        $.ajax({
            url: getBaseURL() + "project/rfc/getworktypelist/"+id,
            async: false,
            type: 'post',
            success: function(data,status) {
                var obj = jQuery.parseJSON(data);
                var objT = obj['trans'];
                var objA = obj['anal'];
                var iRowId = $('#rowid').val();
                var stabelrow = '#sample12';
                var iTRows = iRowId;
                for (var i = 1; i <= iRowId; i++) {
                    var iWorkTypeId = $('#worktypeid_' + i).val();
                    if (i != 1) {
                        if (CheckIdFound(id, iWorkTypeId) == false) {
                            $('#rowid_' + i).remove();
                            $('#rowinfo_' + i).remove();
                            for (var k = i + 1; k <= iTRows; k++) {
                                var y = k - 1;
                                var sOldid = '_' + k;
                                var sNewid = '_' + y;
                                var sStr = $("#sample12 tbody").html();
                                sStr = sStr.replace(new RegExp(sOldid, 'g'), sNewid);
                                $("#sample12 tbody").html(sStr);
                            }
                            iTRows = iTRows - 1;
                        }
                        if (i.iTRows) break;
                    }
                }
                iRowId = iTRows;
                var iTypeId = 0;
                $('#rowid').val(iTRows);
                if (iRowId == 1)  iRowId = 0;
                for (var i = 0; i < objT.length; i++) {
                    iTypeId = objT[i]['WorkTypeId'];
                    if (CheckWorkTypeIdFound(iTRows, iTypeId) == false) {
                        ioRowId = iRowId;
                        iRowId = +iRowId + 1
                        if (iRowId != 1) {
                            var sStr = $("#dummy tbody").html();
                            sStr = sStr.replace(/__1/g, '_' + iRowId);
                            sStr = sStr.replace(/__9/g, '_1');
                            if (ioRowId != 1) ioRowId = (ioRowId * 2) - 1;
                            $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
                        }
                        $('#worktypeid_' + iRowId).val(objT[i]['WorkTypeId']);
                        //  $('#worktypeid_' + iRowId).attr("value", objT[i]['WorkTypeId']);
                        $('#typename_' + iRowId).val(objT[i]['WorkType']);
                        $('#typename_' + iRowId).attr("value", objT[i]['WorkType']);
                        $('#concrete_' + iRowId).prop("readonly",true);
//                        if (objT[i]['ConcreteMix'] == 1) {

                        if (objT[i]['ConcreteMix'] == 1) {
                            $('#concrete_' + iRowId).prop("checked", true);
                            $('#mixtype_' + iRowId).show();
                        }
                        else {
                            $('#concrete_' + iRowId).prop("checked", false);
                            $('#mixtype_' + iRowId).hide();
                        }


                        if (objT[i]['Cement'] == 1) $('#cement_' + iRowId).prop("checked", true);
                        else $('#cement_' + iRowId).prop("checked", false);
                        if (objT[i]['Sand'] == 1) $('#sand_' + iRowId).prop("checked", true);
                        else $('#sand_' + iRowId).prop("checked", false);
                        if (objT[i]['Metal'] == 1) $('#metal_' + iRowId).prop("checked", true);
                        else $('#metal_' + iRowId).prop("checked", false);
                        if (objT[i]['Thickness'] == 1) $('#thick_' + iRowId).prop("checked", true);
                        else $('#thick_' + iRowId).prop("checked", false);
                        $('#rateanal_' + iRowId + '_AnalQty').val(objT[i]['WorkingQty']);
                        $('#rateanalR_' + iRowId + '_AnalQty').val(objT[i]['RWorkingQty']);
                        $('#rateanal_' + iRowId + '_AQty').val(objT[i]['CementRatio']);
                        $('#rateanal_' + iRowId + '_BQty').val(objT[i]['SandRatio']);
                        $('#rateanal_' + iRowId + '_CQty').val(objT[i]['MetalRatio']);
                        $('#rateanal_' + iRowId + '_thick').val(objT[i]['ThickQty']);


//                        } else {
//                            $('#concrete_' + iRowId).prop("checked", false);
//                            $('#cement_' + iRowId).prop("checked", false);
//                            $('#sand_' + iRowId).prop("checked", false);
//                            $('#metal_' + iRowId).prop("checked", false);
//                            $('#thick_' + iRowId).prop("checked", false);
//
//                            $('#divconcrete_'+ iRowId).hide();
//                            $('#mixtype_' + iRowId).hide();
//
//
////                            $('#concrete_' + iRowId).hide();
////                            $('#cement_' + iRowId).hide();
////                            $('#sand_' + iRowId).hide();
////                            $('#metal_' + iRowId).hide();
////                            $('#thick_' + iRowId).hide();
//                        }

                        var objAT = $.grep(objA, function (element, index) {
                            return element.WorkTypeId == iTypeId;
                        });
                        var objAS = $.grep(objAT, function (element, index) {
                            return element.Type != 'R';
                        });
                        var k = 0;
                        var sTransType = "";
                        for (var j = 0; j < objAS.length; j++) {
                            k = k + 1;
                            var sRow = '#wrowid_' + iRowId;
                            sTransType = isNullCheck(objAS[j]['TransType'], 'string');
                            if (sTransType == "H") {
                                var sValue = isNullCheck(objAS[j]['Description'], 'string');
                                var stabelrow = '#type_' + iRowId + '_restable',
                                    sStr= '<tr id="type__1_RowId__9" class="tr-header">' + $("#type__1_header__9").html() + '</tr>';

                                sStr = sStr.replace(/__1/g, '_' + iRowId);
                                sStr = sStr.replace(/__9/g, '_' + k);

//                                $(stabelrow + " tbody.sorting  tr:nth-child(" + (iheaderid - 1) + ")").before(sStr);
//                                $('.autocomplete-suggestions').hide();

                                $(stabelrow + " tbody tr:last").after(sStr);

                                $('#type_' + iRowId + '_resdes_' + k).val(sValue);
                                $('#type_' + iRowId + '_rowtype_' + k).val("H");

                                if (k == 1) {
                                    var $row = $('#type_' + iRowId + '_RowId_1');
                                    $row.remove();
                                }

                            } else {
                                if (k != 1) {
                                    var stabelrow = '#type_' + iRowId + '_restable';
                                    var sStr = '<tr id="type__1_RowId__9">' + $("#type__1_RowId__9").html() + '</tr>';
                                    sStr = sStr.replace(/__1/g, '_' + iRowId);
                                    sStr = sStr.replace(/__9/g, '_' + k);
                                    sStr = sStr.replace(/R1/g, 'R' + k);
                                    $(stabelrow + " tbody tr:last").after(sStr);
                                }
                                if (objAS[j]['IncludeFlag'] == 1) $('#type_' + iRowId + '_inc_' + k).prop("checked", true);
                                else $('#type_' + iRowId + '_inc_' + k).prop("checked", false);
                                $('label[for="type_' + iRowId + '_ref_' + k + '"]').html('R' + objAS[j]['ReferenceId']);
                                $('#type_' + iRowId + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
                                $('#type_' + iRowId + '_resname_' + k).val(objAS[j]['Code'] + ' ' + objAS[j]['ResourceName']);
                                $('#type_' + iRowId + '_resid_' + k).val(objAS[j]['ResourceId']);
                                $('label[for="type_' + iRowId + '_unitname_' + k + '"]').html(objAS[j]['UnitName']);
                                $('#type_' + iRowId + '_unit_' + k).val(objAS[j]['UnitId']);
                                $('#type_' + iRowId + '_qty_' + k).val(objAS[j]['Qty']);
                                $('#type_' + iRowId + '_formula_' + k).val(objAS[j]['CFormula']);
                                if (objAS[j]['ResourceId'] != 0) $("#type_" + iRowId + "_resname_" + k).prop('readonly', true);
                            }
                            $(sRow).val(k);
                        }
                        if (k != 0) AddNewRowRes(iRowId);
                        else {
                            var $resname = $('#type_' + iRowId + '_resname_1');
                            if ($resname.length != 0) bindResRowAutoComplete($resname);
                        }
                        var objAR = $.grep(objAT, function (element, index) {
                            return element.Type == 'R';
                        });
                        var k = 0;
                        for (var j = 0; j < objAR.length; j++) {
                            k = k + 1;
                            var sRow = '#wrowRid_' + iRowId;
                            sTransType = isNullCheck(objAR[j]['TransType'], 'string');
                            if (sTransType == "H") {
                                var sValue = isNullCheck(objAR[j]['Description'], 'string');

                                var stabelrow = '#typeR_' + iRowId + '_restable',
                                    sStr= '<tr id="typeR__1_RowId__9" class="tr-header">' + $("#typeR__1_header__9").html() + '</tr>';

                                sStr = sStr.replace(/__1/g, '_' + iRowId);
                                sStr = sStr.replace(/__9/g, '_' + k);
//                                $(stabelrow + " tbody.sorting  tr:nth-child(" + (iheaderid - 1) + ")").before(sStr);
//                                $('.autocomplete-suggestions').hide();

                                $(stabelrow + " tbody tr:last").after(sStr);

                                $('#typeR_' + iRowId + '_resdes_' + k).val(sValue);
                                $('#typeR_' + iRowId + '_rowtype_' + k).val("H");
                                if (k == 1) {
                                    var $row = $('#typeR_' + iRowId + '_RowId_1');
                                    $row.remove();
                                }
                            } else {
                                if (k != 1) {
                                    var stabelrow = '#typeR_' + iRowId + '_restable';
                                    var sStr = '<tr id="typeR__1_RowId__9">' + $("#typeR__1_RowId__9").html() + '</tr>';
                                    sStr = sStr.replace(/__1/g, '_' + iRowId);
                                    sStr = sStr.replace(/__9/g, '_' + k);
                                    sStr = sStr.replace(/R1/g, 'R' + k);
                                    $(stabelrow + " tbody tr:last").after(sStr);
                                }
                                if (objAR[j]['IncludeFlag'] == 1) $('#typeR_' + iRowId + '_inc_' + k).prop("checked", true);
                                else $('#typeR_' + iRowId + '_inc_' + k).prop("checked", false);
                                $('label[for="typeR_' + iRowId + '_ref_' + k + '"]').html('R' + objAR[j]['ReferenceId']);
                                $('#typeR_' + iRowId + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                                $('#typeR_' + iRowId + '_resname_' + k).val(objAR[j]['Code'] + ' ' + objAR[j]['ResourceName']);
                                $('#typeR_' + iRowId + '_resid_' + k).val(objAR[j]['ResourceId']);
                                $('label[for="typeR_' + iRowId + '_unitname_' + k + '"]').html(objAR[j]['UnitName']);
                                $('#typeR_' + iRowId + '_unit_' + k).val(objAR[j]['UnitId']);
                                $('#typeR_' + iRowId + '_qty_' + k).val(objAR[j]['Qty']);
                                $('#typeR_' + iRowId + '_formula_' + k).val(objAR[j]['CFormula']);
                                if (objAR[j]['ResourceId'] != 0) $("#typeR_" + iRowId + "_resname_" + k).prop('readonly', true);
                            }
                            $(sRow).val(k);
                        }
                        if (k != 0) AddNewRowResR(iRowId);
                        else {
                            var $resname = $('#typeR_' + iRowId + '_resname_1');
                            if ($resname.length != 0) bindResRowAutoComplete($resname);
                        }
                        $('#rowid').val(iRowId);
                    }
                }

                bindCheckLists();
            }
        });
        closedetails('');
        expandTrFn(true);
        //bindAutoComplete();
        bindResourceChange();
        bindPopOver();
        $('#edit-list').hide();
        $('#next-btn').hide();
        $('#edit-content').show();
        $('#submit-btn').show();
        $('#back-btn').show();
    } else alert("Select Work Type")
}

function bindCheckLists() {
    // bind checklists
    var checklistTemplate = $('#checklist-template').html();

    // bind work checklists
    var $workCheckLists = $('.workChecklists');
    var renderedTemplate = "";
    $.each(WorkCheckList, function (i,o) {
        renderedTemplate += checklistTemplate.replace(/__1/g, '_'+ (i+1))
            .replace(/\{\{name\}\}/g, o.CheckListName)
            .replace(/\{\{id\}\}/g, o.CheckListId)
            .replace(/\{\{chktype\}\}/g, 'chk-work');
    });
    $.each($workCheckLists,function () {
        var $this = $(this),
            rowid = $this[0].id.split('_')[1];
        $this.html( renderedTemplate.replace(/__0/g, '_' + rowid ) );

        // check selected chklists
        $.each(selectedworkchks, function (index, obj) {
            if(obj.WorkTypeId != $('#worktypeid_'+rowid).val())
                return;

            var $chkInput = $('input[type=checkbox][id^=wtype_'+rowid+'_chkList_][value='+obj.CheckListId+']');
            if($chkInput.length)
                selectList($chkInput, 'chk-work',obj);
        });
    });

    // bind safety checklists
    var $safetyCheckLists = $('.safetyChecklists');
    renderedTemplate = "";
    $.each(SafetyCheckList, function (i,o) {
        renderedTemplate += checklistTemplate.replace(/wtype\_/g, 'stype_')
            .replace(/__1/g, '_'+ (i+1))
            .replace(/\{\{name\}\}/g, o.CheckListName)
            .replace(/\{\{id\}\}/g, o.CheckListId)
            .replace(/\{\{chktype\}\}/g, 'chk-safety');
    });
    $.each($safetyCheckLists,function () {
        var $this = $(this),
            rowid = $this[0].id.split('_')[1];
        $this.html( renderedTemplate.replace(/__0/g, '_' + rowid ) );

        // check selected chklists
        $.each(selectedsafetychks, function (index, obj) {
            if(obj.WorkTypeId != $('#worktypeid_'+rowid).val())
                return;

            var $chkInput = $('input[type=checkbox][id^=stype_'+rowid+'_chkList_][value='+obj.CheckListId+']');
            if($chkInput.length)
                selectList($chkInput, 'chk-safety',obj);
        });
    });

    // bind quality checklists
    var $qualityCheckLists = $('.qualityChecklists');
    renderedTemplate = "";
    $.each(QualityCheckList, function (i,o) {
        renderedTemplate += checklistTemplate.replace(/wtype\_/g, 'qtype_')
            .replace(/__1/g, '_'+ (i+1))
            .replace(/\{\{name\}\}/g, o.CheckListName)
            .replace(/\{\{id\}\}/g, o.CheckListId)
            .replace(/\{\{chktype\}\}/g, 'chk-quality');
    });
    $.each($qualityCheckLists,function () {
        var $this = $(this),
            rowid = $this[0].id.split('_')[1];
        $this.html( renderedTemplate.replace(/__0/g, '_' + rowid ) );

        // check selected chklists
        $.each(selectedqualitychks, function (index, obj) {
            if(obj.WorkTypeId != $('#worktypeid_'+rowid).val())
                return;

            var $chkInput = $('input[type=checkbox][id^=qtype_'+rowid+'_chkList_][value='+obj.CheckListId+']');
            if($chkInput.length)
                selectList($chkInput, 'chk-quality',obj);
        });
    });

    $("#sample12 .single_dropdown").select2({
        placeholder: "",
        allowClear: true
    });
}

function selectList(x, type,data) {
    var $x = $(x),
        ids = $x[0].id.split('_'),
        chkid = $x.val(),
        chkname = $x.attr('data-name'),
        checklistTrTemplate = $('#tr-checklist-template').html();

    switch(type) {
        case 'chk-work':
            var $tbody = $x.parents('div.tab-pane').find('.selectedWorkCheckLists');
            $($tbody).append(checklistTrTemplate.replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, chkid)
                    .replace(/\{\{name\}\}/g, chkname)
                    .replace(/\{\{chktype\}\}/g, type)
                    .replace(/\{\{typelabel\}\}/g, 'work')
            );

            $x.prop('disabled', true);
            $x.closest('li').fadeOut(500, function () {
                $(this).remove();
                $('#wtype_'+ids[1]+'_workchklist').val($('#wtype_'+ids[1]+'_workchklist').val()+ ids[3]+',');
                if(data) {

                    var sPeriority = data.Priority;
                    $('#wtype_'+ids[1]+'_workpriority_'+ids[3]).val(sPeriority).trigger('change');

//                    if(data.IsCritical == '1')
//                        $('#wtype_'+ids[1]+'_workcritical_'+ids[3]).prop('checked', true);

                    $('#wtype_'+ids[1]+'_workwhentype_'+ids[3]).val(data.WhenType).trigger('change');
                    $('#wtype_'+ids[1]+'_workwhenperiod_'+ids[3]).val(data.WhenPeriod);
                    $('#wtype_'+ids[1]+'_workwhenperiodtype_'+ids[3]).val(data.WhenPeriodType).trigger('change');
                    $('#wtype_'+ids[1]+'_workfreqperiod_'+ids[3]).val(data.FrequencyPeriod);
                    $('#wtype_'+ids[1]+'_workfreqperiodtype_'+ids[3]).val(data.FrequencyPeriodType).trigger('change');
                }
            });
            break;
        case 'chk-safety':
            var $tbody = $x.parents('div.tab-pane').find('.selectedSafetyCheckLists');
            $tbody.append(checklistTrTemplate.replace(/wtype\_\_0/g, 'stype__0')
                    .replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, chkid)
                    .replace(/\{\{name\}\}/g, chkname)
                    .replace(/\{\{chktype\}\}/g, type)
                    .replace(/\{\{typelabel\}\}/g, 'safety')
            );

            $x.prop('disabled', true);
            $x.closest('li').fadeOut(500, function () {
                $(this).remove();
                $('#stype_'+ids[1]+'_safetychklist').val($('#stype_'+ids[1]+'_safetychklist').val()+ ids[3]+',');
                if(data) {

                    var sPeriority = data.Priority;
                    $('#stype_'+ids[1]+'_safetypriority_'+ids[3]).val(sPeriority).trigger('change');

//                    if(data.IsCritical == '1')
//                        $('#stype_'+ids[1]+'_safetycritical_'+ids[3]).prop('checked', true);

                    $('#stype_'+ids[1]+'_safetywhentype_'+ids[3]).val(data.WhenType).trigger('change');
                    $('#stype_'+ids[1]+'_safetywhenperiod_'+ids[3]).val(data.WhenPeriod);
                    $('#stype_'+ids[1]+'_safetywhenperiodtype_'+ids[3]).val(data.WhenPeriodType).trigger('change');
                    $('#stype_'+ids[1]+'_safetyfreqperiod_'+ids[3]).val(data.FrequencyPeriod);
                    $('#stype_'+ids[1]+'_safetyfreqperiodtype_'+ids[3]).val(data.FrequencyPeriodType).trigger('change');
                }
            });
            break;
        case 'chk-quality':
            var $tbody = $x.parents('div.tab-pane').find('.selectedQualityCheckLists');
            $tbody.append(checklistTrTemplate.replace(/wtype\_\_0/g, 'qtype__0')
                    .replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, chkid)
                    .replace(/\{\{name\}\}/g, chkname)
                    .replace(/\{\{chktype\}\}/g, type)
                    .replace(/\{\{typelabel\}\}/g, 'quality')
            );

            $x.prop('disabled', true);
            $x.closest('li').fadeOut(500, function () {
                $(this).remove();
                $('#qtype_'+ids[1]+'_qualitychklist').val($('#qtype_'+ids[1]+'_qualitychklist').val()+ ids[3]+',');
                if(data) {
//                    if(data.IsCritical == '1')
//                        $('#qtype_'+ids[1]+'_qualitycritical_'+ids[3]).prop('checked', true);

                    var sPeriority = data.Priority;
                    $('#qtype_'+ids[1]+'_qualitypriority_'+ids[3]).val(sPeriority).trigger('change');

                    $('#qtype_'+ids[1]+'_qualitywhentype_'+ids[3]).val(data.WhenType).trigger('change');
                    $('#qtype_'+ids[1]+'_qualitywhenperiod_'+ids[3]).val(data.WhenPeriod);
                    $('#qtype_'+ids[1]+'_qualitywhenperiodtype_'+ids[3]).val(data.WhenPeriodType).trigger('change');
                    $('#qtype_'+ids[1]+'_qualityfreqperiod_'+ids[3]).val(data.FrequencyPeriod);
                    $('#qtype_'+ids[1]+'_qualityfreqperiodtype_'+ids[3]).val(data.FrequencyPeriodType).trigger('change');
                }
            });
            break;
    }
}

function removeList(x, type) {
    var $x = $(x),
        ids = $x[0].id.split('_'),
        checklistTemplate = $('#checklist-template').html();

    switch(type) {
        case 'chk-work':
            var $chkid = $('#wtype_'+ids[1]+'_workchklistid_'+ids[3]);

            $('#workchecklist_'+ ids[1]).append(checklistTemplate.replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, $chkid.val())
                    .replace(/\{\{name\}\}/g, $chkid.attr('data-name'))
                    .replace(/\{\{chktype\}\}/g, type)
            );

            $x.closest('tr').fadeOut(400, function () {
                $(this).remove();

                // remove id from list
                var listids = '';
                $.each($('input[type=hidden][id^=wtype_'+ids[1]+'_workchklistid_]'), function (i,o) {
                    listids += $(this)[0].id.split('_')[3] + ',';
                });
                $('#wtype_'+ids[1]+'_workchklist').val(listids);
            });
            break;
        case 'chk-safety':
            var $chkid = $('#stype_'+ids[1]+'_safetychklistid_'+ids[3]);

            $('#safetychecklist_'+ ids[1]).append(checklistTemplate.replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, $chkid.val())
                    .replace(/\{\{name\}\}/g, $chkid.attr('data-name'))
                    .replace(/\{\{chktype\}\}/g, type)
            );

            $x.closest('tr').fadeOut(400, function () {
                $(this).remove();

                // remove id from list
                var listids = '';
                $.each($('input[type=hidden][id^=stype_'+ids[1]+'_safetychklistid_]'), function (i,o) {
                    listids += $(this)[0].id.split('_')[3] + ',';
                });
                $('#stype_'+ids[1]+'_safetychklist').val(listids);
            });
            break;
        case 'chk-quality':
            var $chkid = $('#qtype_'+ids[1]+'_qualitychklistid_'+ids[3]);

            $('#qualitychecklist_'+ ids[1]).append(checklistTemplate.replace(/__0/g, '_' + ids[1])
                    .replace(/__1/g, '_'+ ids[3])
                    .replace(/\{\{id\}\}/g, $chkid.val())
                    .replace(/\{\{name\}\}/g, $chkid.attr('data-name'))
                    .replace(/\{\{chktype\}\}/g, type)
            );

            $x.closest('tr').fadeOut(400, function () {
                $(this).remove();

                // remove id from list
                var listids = '';
                $.each($('input[type=hidden][id^=qtype_'+ids[1]+'_qualitychklistid_]'), function (i,o) {
                    listids += $(this)[0].id.split('_')[3] + ',';
                });
                $('#qtype_'+ids[1]+'_qualitychklist').val(listids);
            });
            break;
    }
}

function selectAllChkList(x, type) {
    var $x = $(x);
    var id = $x[0].id.split('_')[1];
    var $chkContainer = $('#workchecklist_'+id);
    switch(type) {
        case 'chk-work':
            $chkContainer = $('#workchecklist_'+id);
            break;
        case 'chk-safety':
            $chkContainer = $('#safetychecklist_'+id);
            break;
        case 'chk-quality':
            $chkContainer = $('#qualitychecklist_'+id);
            break;
    }
    var $chklists = $chkContainer.find('input[type=checkbox][id*=_chkList_]');
    $x.prop('checked', false);
    if($chklists.length == 0) {
        alert('No checklists to select.');
        return;
    }

    $chklists.trigger('click');
}

function createNewCheckList() {
    var name = $.trim($('#newchkname').val()),
        type = $('#newchktype').val();

    if(name.length == 0) {
        alert('Name is required!');
        return;
    }

    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'project/rfc/rfcworktype',
        type: 'POST',
        data: {"name": name, "type": type},
        success: function (data, status, xhr) {
            if(xhr.status == 200) {
                // bind checklists
                data = JSON.parse(data);
                var checklistTemplate = $('#checklist-template').html();
                var renderedTemplate = "";
                switch(type) {
                    case '6': // bind work checklists
                        var $workCheckLists = $('.workChecklists');
                        WorkCheckList.push(data);
                        renderedTemplate = checklistTemplate.replace(/__1/g, '_'+ WorkCheckList.length)
                            .replace(/\{\{name\}\}/g, data.CheckListName)
                            .replace(/\{\{id\}\}/g, data.CheckListId)
                            .replace(/\{\{chktype\}\}/g, 'chk-work');
                        $.each($workCheckLists,function () {
                            var $this = $(this);
                            $this.append( renderedTemplate.replace(/__0/g, '_' + $this[0].id.split('_')[1] ) );
                        });
                        break;
                    case '7': // bind safety checklists
                        var $safetyCheckLists = $('.safetyChecklists');
                        SafetyCheckList.push(data);
                        renderedTemplate = checklistTemplate.replace(/__1/g, '_'+ SafetyCheckList.length)
                            .replace(/\{\{name\}\}/g, data.CheckListName)
                            .replace(/\{\{id\}\}/g, data.CheckListId)
                            .replace(/\{\{chktype\}\}/g, 'chk-safety');
                        $.each($safetyCheckLists,function () {
                            var $this = $(this);
                            $this.append( renderedTemplate.replace(/__0/g, '_' + $this[0].id.split('_')[1] ) );
                        });
                        break;
                    case '8': // bind quality checklists
                        var $qualityCheckLists = $('.qualityChecklists');
                        QualityCheckList.push(data);
                        renderedTemplate = checklistTemplate.replace(/__1/g, '_'+ QualityCheckList.length)
                            .replace(/\{\{name\}\}/g, data.CheckListName)
                            .replace(/\{\{id\}\}/g, data.CheckListId)
                            .replace(/\{\{chktype\}\}/g, 'chk-quality');
                        $.each($qualityCheckLists,function () {
                            var $this = $(this);
                            $this.append( renderedTemplate.replace(/__0/g, '_' + $this[0].id.split('_')[1] ) );
                        });
                        break;
                }
                $('#AddCheckListModal').modal('hide');
            } else if(xhr.status == 202)
                alert('Checklist Name already exists!');
            else
                alert('Checklist not created, Please try again!');

            $('.loading_area').hide();
        }, error: function (xhr, status, error) {
            alert('Checklist not created, Please try again!');
            $('.loading_area').hide();
        }
    });
}

function toggleNewChkListModal(type) {
    var arr_types = {
        "chk-work": 6,
        "chk-safety": 7,
        "chk-quality": 8
    };
    if(!arr_types.hasOwnProperty(type))
        return;

    $('#newchktype').val(arr_types[type]);
    $('#newchkname').val('');
    $('#AddCheckListModal').modal('show');
}

function chkSearch(x) {
    var $x = $(x),
        searchText = $.trim($x.val()),
        $checklistWrapper = $x.parents('.headingWrapper').next('.card'),
        delayTimer = 0;

    clearTimeout(delayTimer);
    delayTimer = setTimeout(function () {
        if(searchText.length == 0) {
            $checklistWrapper.find('.search-element').closest('.search-item').show();
            return;
        }

        var $foundChks = $checklistWrapper.find('.search-element');
        $.each($foundChks, function () {
            var name = $(this).attr('data-name').toLowerCase();
            if(name.indexOf(searchText.toLowerCase()) == -1) {
                $(this).closest('.search-item').fadeOut(100);
                return;
            }

            $(this).closest('.search-item').fadeIn(100);
        });
    }, 300);
}

function inputFocus(i){
    if(i.value==i.defaultValue)  i.value=""; i.style.color="#000";
}
function inputBlur(i){
    if(i.value=="") i.value=i.defaultValue; i.style.color="#888";
}
function closedetails(name) {
    var $mainTRs = $("a[class*=mainTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this);
        if (name != $this[0].className) {
            key = $this[0].className.split('_')[1];
            var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
                $i = $(this).find("i");
            if ($subTr.is(":visible")) {
                $subTr.find(".subDiv").slideUp("slow");
                $subTr.slideUp("slow");
                $i.removeClass("fa-chevron-circle-up");
                $i.addClass("fa-chevron-circle-down");
            }
        }
    });
}

//function closedetails(key) {
//    var $mainTRs = $("a[class*=mainTr_]");
//    $.each($mainTRs, function (i, obj) {
//        var $this = $(this),
//            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
//        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
//        if($mainTr.length != 0) $mainTr.trigger('click');
//    });
//}
function CheckShowDetails() {
    if ($('#concrete_' + iFocusRowId).is(':checked') == false) {

//        $('#cement_' + iFocusRowId).prop("checked", false);
//        $('#sand_' + iFocusRowId).prop("checked", false);
//        $('#metal_' + iFocusRowId).prop("checked", false);
//        $('#thick_' + iFocusRowId).prop("checked", false);
//
//        $('#divconcrete_'+ iFocusRowId).hide();

        $('#mixtype_'+ iFocusRowId).hide();
//        $('#cement_' + iFocusRowId).hide();
//        $('#sand_' + iFocusRowId).hide();
//        $('#metal_' + iFocusRowId).hide();
//        $('#thick_' + iFocusRowId).hide();

    }   else {
        $('#mixtype_' + iFocusRowId).show();
    }
    if ($('#cement_' + iFocusRowId).is(':checked') == false) $('#rateanal_' + iFocusRowId + '_AQty_li').hide();
    else $('#rateanal_' + iFocusRowId + '_AQty_li').show();
    if ($('#sand_' + iFocusRowId).is(':checked') == false) $('#rateanal_' + iFocusRowId + '_BQty_li').hide();
    else $('#rateanal_' + iFocusRowId + '_BQty_li').show();
    if ($('#metal_' + iFocusRowId).is(':checked') == false) $('#rateanal_' + iFocusRowId + '_CQty_li').hide();
    else $('#rateanal_' + iFocusRowId + '_CQty_li').show();
    if ($('#thick_' + iFocusRowId).is(':checked') == false) $('#rateanal_' + iFocusRowId + '_thick_li').hide();
    else $('#rateanal_' + iFocusRowId + '_thick_li').show();
}

function entryValidate() {
    var isValid = true;
    var $narration = $('#narration');
    if ($narration.val().length == 0 || $narration.val().trim() == "Remarks") {
        isValid = false;
        $('#narration').addClass('error').attr('data-original-title', 'Required').attr('data-toggle', 'tooltip');
        $narration.focus();
    }
    return isValid;
}

function getRefNo(key,type) {
    var $reskeyid;
    if (type=="R") {
        $reskeyid = $('input[id*=typeR_' + iFocusRowId + '_ref_]');
    } else {
        $reskeyid = $('input[id*=type_' + iFocusRowId + '_ref_]');
    }
    var iRefId=1;
    $.each($reskeyid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var sRefId = isNullCheck($('#'+name).val(),'string');
        var ioRefId = sRefId.replace(/[^0-9]/g, '');
        if (parseInt(ioRefId) >= iRefId) iRefId = +ioRefId+1;
    });
    return iRefId;
}

function AddNewRowRes(key) {
    iFocusRowId=key;
    var sRow = '#wrowid_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    irowinfoId = +irowinfoId + 1;
    var iRefId = getRefNo(iFocusRowId,"");
    var stabelrow = '#type_'+iFocusRowId + '_restable';
    var sStr= '<tr id="type__1_RowId__9">' + $("#type__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" tbody tr:last").after(sStr);
    //checkResource(iFocusRowId,"");
    $resname =  $('#type_' + iFocusRowId + '_resname_' + irowinfoId);
    $('#type_' + iFocusRowId + '_ref_' + irowinfoId).val('R'+iRefId);
    bindResRowAutoComplete($resname);
    bindMixSortablefn(true);
    SortOrder(iFocusRowId);
    //bindAutoComplete();
    bindResourceChange();
    bindPopOver();
    $(sRow).val(irowinfoId);
}
function AddNewRowResR(key) {
    iFocusRowId=key;
    var sRow = '#wrowRid_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#typeR_'+iFocusRowId + '_restable';
    var iRefId = getRefNo(iFocusRowId,"R");
    var sStr= '<tr id="typeR__1_RowId__9">' + $("#typeR__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" tbody tr:last").after(sStr);
//    checkResource(iFocusRowId,"R");
    $resname =  $('#typeR_' + iFocusRowId + '_resname_' + irowinfoId);
    $('#typeR_' + iFocusRowId + '_ref_' + irowinfoId).val('R'+iRefId);
    bindResRowAutoComplete($resname);
    bindMixSortablefn(true);
    SortOrderR(iFocusRowId);
//    bindAutoComplete();
    bindResourceChange();
    bindPopOver();
    $(sRow).val(irowinfoId);
}
function CheckResourceFocus(x,type) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkResource(key1,type);
    var $resname = $('#' + x);
    bindResRowAutoComplete($resname);
}
function checkResource(key1,restype) {
    iFocusRowId = key1;
    if (restype=="R") {
        arrayresR = arrayreslist;
        var $reskeyid = $('input[id*=typeR_' + iFocusRowId + '_resid_]');
        arrayresR = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.data == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        arrayres = arrayreslist;
        var $reskeyid = $('input[id*=type_' + iFocusRowId + '_resid_]');
        arrayres = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each($reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.data == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    }
}
function showmix(x,y,e) {
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    iFocusRowId = y.split('_')[1];
    e.preventDefault();
    bSiteMix=true;
    if (x=="readymix") {
        $('#type_' + iFocusRowId + '_restable').hide();
        $('#raworktable_' + iFocusRowId).hide();
        $('#typeR_' + iFocusRowId + '_restable').show();
        $('#raworkRtable_' + iFocusRowId).show();
        bSiteMix=false;
        return false;
    }
    $('#typeR_' + iFocusRowId + '_restable').hide();
    $('#raworkRtable_' + iFocusRowId).hide();
    $('#type_' + iFocusRowId + '_restable').show();
    $('#raworktable_' + iFocusRowId).show();
    return false;
}
function showformula(x,bshow) {
    bSiteMix=true;
    var sStr = x.split("_");
    iFocusRowId= sStr[1];
    iTransRowId = sStr[3];
    var sExpression = isNullCheck($("#type_" + iFocusRowId + "_formula_" + iTransRowId).val(),'string');
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#type_" + iFocusRowId + "_qty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#type_" + iFocusRowId + "_qty_" + iTransRowId).val(),'number'));
        }
    }

    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var sCement = '#rateanal_' + iFocusRowId + '_AQty';
            var sSand = '#rateanal_' + iFocusRowId + '_BQty';
            var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
            var sThick = '#rateanal_' + iFocusRowId + '_thick';
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());
            var rows = $('#wrowid_' + iFocusRowId).val();
            for (var i = 1; i <= rows; i++) {
                var $ref = $('#type_' + iFocusRowId + '_ref_' + i);
                if (i != iTransRowId && $ref.length != 0) {
                    var sRef = $ref.val().trim();
                    var dqty= parseFloat(isNullCheck($('#type_' + iFocusRowId + '_qty_' + i).val(),'number'));
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                }
            }
            sformula = sformula.replace(/R[0-9]+/gi, 0); // replace 0 for R(X) values not found
            sformula = sformula.replace(/%/gi, '/100'); // replace % to / 100
            fvaule = computeEval(sformula);
        } catch (e) {
            alert('Expression in invalid.');
        }
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
        $("#formula").on('shown.bs.modal',function () {
            $("#formulaexp").select();
        });
    } else if (bshow==true) {
        $("#type_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#type_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
        $("#formula").on('shown.bs.modal',function () {
            $("#formulaexp").focus();
        });

    } else {
        if ($('#type_' + iFocusRowId + '_resid_' + iTransRowId).val() != '0' && $('#type_' + iFocusRowId + '_resid_' + iTransRowId).val().length != 0)
            $("#type_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
    }
    if (parseFloat(isNullCheck(fvaule,'number')) < 0) {
        $('#formulavalue').addClass('error');
        return;
    } else $('#formulavalue').removeClass('error');
}
function showF(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iFocusRowId = sStr[1];
        iTransRowId = sStr[3];
        if ($('#type_' + iFocusRowId + '_resid_' + iTransRowId).val() != '0' && $('#type_' + iFocusRowId + '_resid_' + iTransRowId).val().length !=0) showformula(x, true);
        event.preventDefault();
    }
}
function showFR(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iFocusRowId = sStr[1];
        iTransRowId = sStr[3];
        if ($('#typeR_' + iFocusRowId + '_resid_' + iTransRowId).val() != '0' && $('#typeR_' + iFocusRowId + '_resid_' + iTransRowId).val().length !=0) showformulaR(x,true);
        event.preventDefault();
    }
}

function changeRatio(x,type) {
    var sStr = x.split("_"),
        key1 = sStr[1];
    var $formula = $('input[id*=_' + key1 + '_formula]');
    $.each($formula, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            arr_names = name.split('_');
        if (name.indexOf('__') != -1) return;
        if ($('#' + name).val().indexOf(type) >= 0) {
            var sitemix = true,
                key2 = arr_names[3];
            if (name.indexOf('typeR') >= 0) sitemix=false;
            formularecalculation($('#' + name).val(),key1,key2,sitemix);
        }
    });
}

function formularecalculation(sformula,key1,key2,sitemix) {
    var fvaule=0;
    if (sformula.length >0) {
        try {
            if  (sitemix==true) {
                var sCement = '#rateanal_' + key1 + '_AQty';
                var sSand = '#rateanal_' + key1 + '_BQty';
                var sMetal = '#rateanal_' + key1 + '_CQty';
                var sThick = '#rateanal_' + key1 + '_thick';
            } else {
                var sCement = '#rateanalR_' + key1 + '_AQty';
                var sSand = '#rateanalR_' + key1 + '_BQty';
                var sMetal = '#rateanalR_' + key1 + '_CQty';
                var sThick = '#rateanalR_' + key1 + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());

            if  (sitemix==true) {
                var rows = $('#wrowid_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    var $ref = $('#type_' + key1 + '_ref_' + key2);
                    if (i != key2) {
                        var sRef = $.trim($ref.val());
                        var dqty= parseFloat(isNullCheck($('#type_' + key1 + '_qty_' + key2).val(),'number'));
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                    }
                }
            } else {
                var rows = $('#wrowRid_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    var $ref = $('#typeR_' + key1 + '_ref_' + key2);
                    if (i != key2 && $ref.length != 0) {
                        var sRef = $.trim($ref.val());
                        var dqty= parseFloat(isNullCheck($('#typeR_' + key1 + '_qty_' + key2).val(),'number'));
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                    }
                }
            }
            sformula = sformula.replace(/R[0-9]+/gi, 0); // replace 0 for R(X) values not found
            sformula = sformula.replace(/%/gi, '/100'); // replace % to / 100
            fvaule = computeEval(sformula);
        } catch (e) {
            alert('Expression in invalid.');
        }
    }
    if  (sitemix==true) {
        $("#type_" + key1 + "_qty_" + key2).val(sanitizeNumber(fvaule,3));
    } else {
        $("#typeR_" + key1 + "_qty_" + key2).val(sanitizeNumber(fvaule,3));
    }
}

function showformulaR(x,bshow) {
    bSiteMix=false;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#typeR_" + iFocusRowId + "formula_" + iTransRowId;
    var sExpression = isNullCheck($(sExp).val(),'string');
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#typeR_" + iFocusRowId + "_qty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#typeR_" + iFocusRowId + "_qty_" + iTransRowId).val(),'number'));
        }
    }
    $("#formulaexp").val(sExpression);
    var sformula = $("#formulaexp").val();
    var fvaule=0;
    if (sformula.length >0) {
        try {
            var sCement = '#rateanalR_' + iFocusRowId + '_AQty';
            var sSand = '#rateanalR_' + iFocusRowId + '_BQty';
            var sMetal = '#rateanalR_' + iFocusRowId + '_CQty';
            var sThick = '#rateanalR_' + iFocusRowId + '_thick';
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/thick/g, $(sThick).val());
            var rows = $('#wrowRid_' + iFocusRowId).val();
            for (var i = 1; i <= rows; i++) {
                var $ref = $('#typeR_' + iFocusRowId + '_ref_' + i);
                if (i != iTransRowId && $ref.length != 0) {
                    var sRef = $.trim($ref.val());
                    var dqty= parseFloat(isNullCheck($('#typeR_' + iFocusRowId + '_qty_' + i).val(),'number'));
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                }
            }
            sformula = sformula.replace(/R[0-9]+/gi, 0); // replace 0 for R(X) values not found
            sformula = sformula.replace(/%/gi, '/100'); // replace % to / 100
            fvaule = computeEval(sformula);
        } catch (e) {
            alert('Expression in invalid.');
        }
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
        $("#formula").on('shown.bs.modal',function () {
            $("#formulaexp").select();
        });
    } else if (bshow==true) {
        $("#typeR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#typeR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
        $("#formula").on('shown.bs.modal',function () {
            $("#formulaexp").focus();
        });
    } else {
        if ($('#typeR_' + iFocusRowId + '_resid_' + iTransRowId).val() != '0' && $('#typeR_' + iFocusRowId + '_resid_' + iTransRowId).val().length!=0)
            $("#typeR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
    }
}
function formulaok() {
    if ($('#formulavalue').hasClass('error')) return;
    var $sExp = null;
    if (bSiteMix==true) {
        $sExp = $("#type_" + iFocusRowId + "_formula_" + iTransRowId);
        var sqty = "#type_" + iFocusRowId + "_qty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        $sExp.val(sformulaexp);
        $(sqty).val(sanitizeNumber(sformulaval,3));
    } else {
        $sExp = $("#typeR_" + iFocusRowId + "_formula_" + iTransRowId);
        var sqty = "#typeR_" + iFocusRowId + "_qty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        $sExp.val(sformulaexp);
        $(sqty).val(sanitizeNumber(sformulaval,3));
    }
    $('#formula').modal('toggle');

    // bind tooltip
    $sExp.attr('data-content', $sExp.val());
    $sExp.blur(function () {
        if (isNullCheck($sExp.val(),'string') == "") $this.removeClass('error');
        $sExp.attr('data-content', $sExp.val());
    });
    $sExp.change(function () {
        $sExp.attr('data-content', $sExp.val());
    });
    //$('#formula').hide();
}
function CheckConcreteMixUnTick() {
    if ($('#concrete_' + iFocusRowId).is(':checked')) {
        CheckShowDetails();
        return;
    }
    var irowinfoId = $('#wrowRid_' + iFocusRowId).val(),
        isValid=true;
    for (var i=1; i <= irowinfoId;i++) {
        if ($('#typeR_' + iFocusRowId + '_resid_'+ i).val().length != 0) {
            isValid=false; break;
        }
    }
    if (isValid) {
        CheckShowDetails();
        return;
    } else {
        alert("Concrete Mix Used, Do not Untick");
        $('#concrete_' + iFocusRowId).prop("checked", true);
    }
}
function CheckCementUnTick() {
    if ($('#cement_' + iFocusRowId).is(':checked')) {
        CheckShowDetails();
        return;
    }
    var value = $('#rateanal_' + iFocusRowId + '_AQty').val();
    if (value.length == 0 || value == 0 || value == '') {
        CheckShowDetails();
        return;
    }
    alert("Cement Ratio Used, Do not Untick");
    $('#cement_' + iFocusRowId).prop("checked", true);
}
function CheckSandUnTick() {
    if ($('#sand_' + iFocusRowId).is(':checked')) {
        CheckShowDetails();
        return;
    }
    var value = $('#rateanal_' + iFocusRowId + '_BQty').val();
    if (value.length == 0 || value == 0 || value == '') {
        CheckShowDetails();
        return;
    }
    alert("Sand Ratio Used, Do not Untick");
    $('#sand_' + iFocusRowId).prop("checked", true);
}
function CheckMetalUnTick() {
    if ($('#metal_' + iFocusRowId).is(':checked')) {
        CheckShowDetails();
        return;
    }
    var value = $('#rateanal_' + iFocusRowId + '_CQty').val();
    if (value.length == 0 || value == 0 || value == '') {
        CheckShowDetails();
        return;
    }
    alert("Metal Ratio Used, Do not Untick");
    $('#metal_' + iFocusRowId).prop("checked", true);
}
function CheckThickUnTick() {
    if ($('#thick_' + iFocusRowId).is(':checked')) {
        CheckShowDetails();
        return;
    }
    var value = $('#rateanal_' + iFocusRowId + '_thick').val();
    if (value.length == 0 || value == 0 || value == '') {
        CheckShowDetails();
        return;
    }
    alert("Thickness, Do not Untick");
    $('#thick_' + iFocusRowId).prop("checked", true);
}
function formulacalculation() {
    var sformula = $("#formulaexp").val();
    var fvaule=0;
    if (sformula.length >0) {
        try {
            if  (bSiteMix==true) {
                var sCement = '#rateanal_' + iFocusRowId + '_AQty';
                var sSand = '#rateanal_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
                var sThick = '#rateanal_' + iFocusRowId + '_thick';
            } else {
                var sCement = '#rateanalR_' + iFocusRowId + '_AQty';
                var sSand = '#rateanalR_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanalR_' + iFocusRowId + '_CQty';
                var sThick = '#rateanalR_' + iFocusRowId + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());

            if  (bSiteMix==true) {
                var rows = $('#wrowid_' + iFocusRowId).val();
                for (var i = 1; i <= rows; i++) {
                    var $ref =$('#type_' + iFocusRowId + '_ref_' + i);
                    if (i != iTransRowId && $ref.length != 0) {
                        var sRef = $.trim($ref.val());
                        var dqty= parseFloat(isNullCheck($('#type_' + iFocusRowId + '_qty_' + i).val(),'number'));
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                    }
                }
            } else {
                var rows = $('#wrowRid_' + iFocusRowId).val();
                for (var i = 1; i <= rows; i++) {
                    var $ref = $('#typeR_' + iFocusRowId + '_ref_' + iTransRowId);
                    if (i != iTransRowId && $ref.length != 0) {
                        var sRef = $.trim($ref.val());
                        var dqty= parseFloat(isNullCheck($('#typeR_' + iFocusRowId + '_qty_' + i).val(),'number'));
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dqty);
                    }
                }
            }
            sformula = sformula.replace(/R[0-9]+/gi, 0); // replace 0 for R(X) values not found
            sformula = sformula.replace(/%/gi, '/100'); // replace % to / 100
            fvaule = computeEval(sformula);
        } catch (e) {
            alert('Expression in invalid.');
        }
    }
    $("#formulavalue").val(sanitizeNumber(fvaule,3));
    if (isNullCheck(fvaule,'number') < 0) {
        $('#formulavalue').addClass('error');
        return;
    } else $('#formulavalue').removeClass('error');

}
function isFormula(evt){
//    var charCode = (evt.which) ? evt.which : evt.keyCode;
//    if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=43 && charCode!=45 && charCode!=47 && charCode!=42 && charCode!=46 && charCode!=65 && charCode!=66 && charCode!=67 && charCode!=40 && charCode!=41 && charCode!=82) return false;
    return true;
}
$(function() {
    $(document).keydown(function(event) {
        if(event.ctrlKey && event.keyCode == 83) {
            $("#donebut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 82) {
            if (bSiteMix == true){$("#butresadd").trigger("click");}
            else{$("#butresRadd").trigger("click");}
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 67) {
            if (bSiteMix==true){var iRows = $('#wrowid_' + iFocusRowId).val();}
            else {var iRows = $('#wrowRid_' + iFocusRowId).val();}
            var arr= [];
            var k=0;
            for (var i = 1; i <= iRows; i++) {
                if (bSiteMix ==true){var sTable = '#type_' + iFocusRowId + '_RowId_' + i;}
                else {var sTable = '#typeR_' + iFocusRowId + '_RowId_' + i;}
                if ($(sTable).hasClass('selected') == true) {
                    if (bSiteMix ==true) {
                        arr.push({
                            inc: $('#type_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#type_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#type_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#type_' + iFocusRowId + '_resid_' + i).val(),
                            unit: $('#type_' + iFocusRowId + '_unit_' + i).val(),
                            qty: $('#type_' + iFocusRowId + '_qty_' + i).val(),
                            formula: $('#type_' + iFocusRowId + '_formula_' + i).val()
                        });
                    } else {
                        arr.push({
                            inc: $('#typeR_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#typeR_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#typeR_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#typeR_' + iFocusRowId + '_resid_' + i).val(),
                            unit: $('#typeR_' + iFocusRowId + '_unit_' + i).val(),
                            qty: $('#typeR_' + iFocusRowId + '_qty_' + i).val(),
                            formula: $('#typeR_' + iFocusRowId + '_formula_' + i).val()
                        });
                    }
                }
            }
            if (arr.length >0) {
                $.post(getBaseURL() + 'project/rfc/updatecopywtanalysis', {ids: arr}, function (data) {
                    //alert (data);
                });
            }
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 86) {
            $.post(getBaseURL() + 'project/rfc/getcopywtanalysis', {ids: arr}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (bSiteMix==true) {
                    var irowinfoId = $('#wrowid_' + iFocusRowId).val();
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#type_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#type_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="type__1_RowId__9">' + $("#type__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#wrowid_' + iFocusRowId).val(irowinfoId);
                        }
                        $('#type_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#type_' + iFocusRowId + '_ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#type_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#type_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#type_' + iFocusRowId + '_unit_' + irowinfoId).val(obj[i]['unit']);
                        $('#type_' + iFocusRowId + '_qty_' + irowinfoId).val(obj[i]['qty']);
                        $('#type_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                } else {
                    var irowinfoId = $('#wrowRid_' + iFocusRowId).val();
                    for (var i = 0; i < obj.length; i++) {
                        if ($('#typeR_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#typeR_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="typeR__1_RowId__9">' + $("#typeR__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#wrowRid_' + iFocusRowId).val(irowinfoId);
                        }
                        $('#typeR_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#typeR_' + iFocusRowId + '_ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#typeR_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#typeR_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#typeR_' + iFocusRowId + '_unit_' + irowinfoId).val(obj[i]['unit']);
                        $('#typeR_' + iFocusRowId + '_qty_' + irowinfoId).val(obj[i]['qty']);
                        $('#typeR_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                }
            });
        }
    });
});

function showPickList(id) {
    var sname = id.split('_')[0],
        key= id.split('_')[1],
        restype = "S";
    if (sname.substr(sname.length-1) == "R") restype = "R";
    $('#picklistrestype').val(restype);
    $('#picklistrow').val(key);

    checkResourcePickList(key,restype);
    bindResourcePickListGrid();
    $("#picklistmodal").modal('show');
}
function checkResourcePickList(key,restype) {
    if (restype=="R") {
        var reskeyid = $('input[id*=typeR_' + key + '_resid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=type_' + key + '_resid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;

            });
            return is_selected;
        });
    }
}
function bindResourcePickListGrid() {
    var parent = $("#respickgrid").parent();
    $("#respickgrid").remove();
    $("<div id='respickgrid'></div>").appendTo(parent);
    var source = {
        localdata:arrrespicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'ResourceId', type: 'string'},
            { name: 'TypeId', type: 'number'},
            { name: 'UnitId', type: 'number'},
            { name: 'Code', type: 'string'},
            { name: 'ResourceName', type: 'string'},
            { name: 'UnitName', type: 'string'},
            { name: 'TypeName', type: 'string'},
            { name: 'ResourceGroup', type: 'string'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'ResourceId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);

    $("#respickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'ResourceId', datafield: 'ResourceId', hidden: true},
            {text: 'TypeId', datafield: 'TypeId', hidden: true},
            {text: 'UnitId', datafield: 'UnitId', hidden: true},
            {text: 'Code', datafield: 'Code', 'editable': false, width: '15%'},
            {text: 'ResourceName', datafield: 'ResourceName', 'editable': false, width: '30%'},
            {text: 'Unit', datafield: 'UnitName', 'editable': false, width: '10%'},
            {text: 'Type', datafield: 'TypeName', 'editable': false, width: '15%'},
            {text: 'ResourceGroup', datafield: 'ResourceGroup', 'editable': false, width: '20%'},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%'}
        ]
    });
}

function updatefromPickList() {
    $('.loading_area').show();
    var resType = $('#picklistrestype').val(),
        key1 = isNullCheck($('#picklistrow').val(),'number'),
        sName = "#type_" + key1;
    if (resType =="R") sName = "#typeR_" + key1;
    var rows = $('#respickgrid').jqxGrid('getrows'),iResourceId= 0,sCode="",sResName="",sSpec="",iUnitId=0,sUnit="";
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#wrowid_' + key1).val();
            if (resType =="R") key2 = $('#wrowRid_' + key1).val();

            iResourceId = rows[i]['ResourceId'];
            sCode = rows[i]['Code'];
            sResName = rows[i]['ResourceName'];
            sSpec = sCode + '   ' + sResName;
            iUnitId= rows[i]['UnitId'];
            sUnit =  rows[i]['UnitName'];
            $(sName + '_resname_' + key2).prop('disabled', true);

            $(sName + '_resname_' + key2).val(sSpec);
            $(sName + '_resid_' + key2).val(iResourceId);
            $(sName + '_unit_' + key2).val(iUnitId);
            $(sName + '_newresname_' + key2).val(sResName);
            if (resType =="R") $("label[for='typeR_" + key1 + "_unitname_"+key2+"']").html(sUnit);
            else $("label[for='type_" + key1 + "_unitname_"+key2+"']").html(sUnit);
            if (resType =="R") AddNewRowResR(key1);
            else AddNewRowRes(key1);
        }
    }
    $('#picklistmodal').modal('toggle');
    $('.loading_area').hide();
}
</script>