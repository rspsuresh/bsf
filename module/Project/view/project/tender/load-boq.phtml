<style>
    .expandDiv{overflow:visible !important;}
    .expandDiv > .docu-spc {height: auto !important;}
    .lstatea ul li label{display:block}
    .lstatea ul li input[type="text"]{width:130px;margin-right: 10px;}
</style>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>" />
<div class="clearfix"></div>
<input type="hidden" name="rfcUId" id="rfcUId" value="<?php echo $rfcid;?>">
<div class="col-lg-12 col-lg-offset-0" id="edit-content">
<div class="table-responsive topsp animated-panel zoomIn" style="animation-delay: 0.2s;">
<table class="table" style=" margin-bottom:0px;" id="sample12">
<thead>
<tr>
    <th>Ref No</th>
    <th>Specification</th>
    <th>Unit</th>
    <th class="text-right">Qty</th>
    <th></th>
    <th class="text-right">Base Rate</th>
    <th class="text-right">Rate</th>
    <th class="text-right">Amount</th>
    <th>&nbsp;</th>
</tr>
</thead>
<tbody>
<?php $i=0; $wovalue=0;
if (isset($rfctrans)):
    foreach($rfctrans as $trans):
        $i=$i+1;
        ?>
        <tr id="IOWiRowId_<?php echo $i; ?>">
            <td width="3%"><input class="parent_text" type="text" name="refserialno_<?php echo $i; ?>" id="refserialno_<?php echo $i; ?>"  value="<?php echo $trans['RefSerialNo'];?>" readonly /></td>
            <td width="15%">
                <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spc">
                        <textarea class="parent_texts" name="spec_<?php echo $i; ?>" readonly id="spec_<?php echo $i; ?>"><?php echo $trans['Specification'];?></textarea>
                        <label>Short Spec</label>
                        <textarea class="parent_texts" name="shortspec_<?php echo $i; ?>" readonly id="shortspec_<?php echo $i; ?>"><?php echo $trans['ShortSpec'];?></textarea>
                    </div>
                </div>
            </td>
            <td width="5%"><input type="text" class="parent_text" name="unitid_<?php echo $i; ?>" id="unitid_<?php echo $i; ?>" value="<?php echo $trans['UnitName'];?>" readonly /></td>
            <td width="5%"> <input class="parent_text text-right" type="text" name="qty_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['Qty'],3, true, true);?>" id="qty_<?php echo $i; ?>" align="right" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" readonly/></td>
            <td width="1%">
                <ul class="expanded-dis">
                    <li>
                        <a href="#" class="wbsTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="WBS Qty" ></i></a>
                    </li>
                </ul>
            </td>

            <td width="5%"><input class="parent_text text-right" type="text" name="rate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['Rate'],2,true);?>" id="rate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)"  onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly /></td>
            <td width="5%"><input class="parent_text text-right" type="text" name="qrate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['QuotedRate'],2,true);?>" id="qrate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly /></td>
            <td width="6%"><input class="parent_text text-right" type="text" name="qamt_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['QuotedAmount'],2,true);?>" id="qamt_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly /></td>
            <input type="hidden" name="iowid_<?php echo $i; ?>" id="iowid_<?php echo $i; ?>" value = "<?php echo $trans['IOWId'];?>" readonly />
            <input type="hidden" name="unitkeyid_<?php echo $i; ?>" id="unitkeyid_<?php echo $i; ?>" value = "<?php echo $trans['UnitId'];?>" readonly />
            <input type="hidden" name="parentkeyid_<?php echo $i; ?>" id="parentkeyid_<?php echo $i; ?>" value = "<?php echo $trans['WorkGroupId'];?>" readonly />
            <input type="hidden" name="rowrefid_<?php echo $i; ?>" id="rowrefid_<?php echo $i; ?>" value = "<?php echo $i;?>" readonly />
            <input type="hidden" name="prevWOTransId_<?php echo $i; ?>" id="prevWOTransId_<?php echo $i; ?>" value="<?php echo $trans['TenderWOTransId']; ?>" readonly />
            <input type="hidden" name="ePrevWOTransId_<?php echo $i; ?>" id="ePrevWOTransId_<?php echo $i; ?>" value="<?php echo $trans['PrevTenderWOTransId']; ?>" readonly />
            <td width="4%" class="action_btns_td">
                <ul class="action_btns">
                    <!--                    <li>-->
                    <!--                        <a href="#" class="mainTrDelete_--><?php //echo $i; ?><!--" style="display: none;">-->
                    <!--                            <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>-->
                    <!--                        </a>-->
                    <!--                    </li>-->
                    <li>
                        <a href="#" class="mainTr_<?php echo $i; ?>">
                            <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                        </a>
                    </li>
                </ul>
            </td>
        </tr>
        <tr style="display:none;" class="wbsmainTr_<?php echo $i; ?>">
            <td colspan="12" style="padding:0px !important; ">
                <div class="col-lg-10 col-lg-offset-1" style="margin-top:10px; margin-bottom:10px;">
                    <div class="subDiv" style="display:none;overflow-y:auto; min-height:100%; max-height:500px;">
                        <table class="table" style="margin-bottom:0px;" id="wbstable_<?php echo $i; ?>">
                            <thead>
                            <tr>
                                <th>WBS Name</th>
                                <th>Qty</th>
                                <th>&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php
                            $qTransId = $trans['QuotationTransId'];
                            $arrwbs = array_filter($rfcwbstrans, function($v) use($qTransId) { return $v['QuotationTransId'] == $qTransId; });
                            $x=1;
                            foreach($arrwbs as $wsbtrans) { ?>
                                <tr>
                                    <td width="15%"> <input class="parent_text" name="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>" value="<?php  echo $wsbtrans['WBSName']; ?>" id="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>"  readonly/></td>
                                    <td width="3%"> <input class="parent_text text-right" name="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" value="<?php  echo $wsbtrans['Qty']; ?>" id="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/></td>
                                    <input type="hidden" name="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" id="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" value="<?php  echo $wsbtrans['WBSId']; ?>">
                                    <td width="1%" class="action_btns_td">
                                        <!--                                        <ul class="action_btns">-->
                                        <!--                                            <li style="float:left;"> <a href="#" class="wbstable_--><?php //echo $i; ?><!--_TrDelete_--><?php //echo $x; ?><!--" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>-->
                                        <!--                                        </ul>-->
                                    </td>
                                </tr>
                                <?php $x=$x+1;} ?>
                            <tr>
                                <td class="rate_pri text-right"><label>Total</label></td>
                                <td><input class="parent_text text-right total-clr" name="wbstable_<?php echo $i; ?>_totalqty" value="" id="wbstable_<?php echo $i; ?>_totalqty" readonly/></td>
                                <input type="hidden" name="wbstable_<?php echo $i; ?>_rows" id="wbstable_<?php echo $i; ?>_rows" value="<?php echo $x; ?>">
                                <td>&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                    </div></div>
            </td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr_<?php echo $i; ?> paintTr">
        <td colspan="9"><div class="subDiv" style="display:none;">
        <div class="col-lg-12">
            <ul id="ulworkgroup_<?php echo $i; ?>" class="short_spc" <?php echo $trans['IOWId']==0 ? 'style="display:none;"' : ''; ?>>
                <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library WorkGroup</label>
                    <textarea class="parent_texts" name="lworkgroupname_<?php echo $i; ?>" id="lworkgroupname_<?php echo $i; ?>" readonly><?php echo $trans['LWorkGroupName'];?></textarea>
                </li>
                <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library SerialNo</label>
                    <textarea class="parent_texts" name="lserialno_<?php echo $i; ?>" id="lserialno_<?php echo $i; ?>" readonly><?php echo $trans['LSerialNo'];?></textarea>
                </li>
                <li class="col-lg-5 col-lg-offset-0 col-md-5 col-md-offset-0 col-sm-5 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library Specification</label>
                    <textarea class="parent_texts" name="lspec_<?php echo $i; ?>" id="lspec_<?php echo $i; ?>" readonly><?php echo $trans['LSpecification'];?></textarea>
                </li>
            </ul>
            <!-- Nav tabs -->
            <div <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="darkmenu" id="mixtab_<?php echo $i; ?>">
                <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">
                    <ul>
                        <li class="active"><a href="#" name="analtype_<?php echo $i; ?>" id="analtype_<?php echo $i; ?>" onclick="showmix('sitemix',this.id,event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                        <li><a href="#" name="analtypeR_<?php echo $i; ?>" id="analtypeR_<?php echo $i; ?>" onclick="showmix('readymix',this.id,event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
                    </ul>
                </div>
                <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3">
                    <ul class="col-lg-12">
                        <li id ="lisitemix_<?php echo $i; ?>" <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                            <label class="spl_siz">Site Mix (%)</label>
                            <input type="text" class="text-right w_100_h30" name="sitemixper_<?php echo $i; ?>" id="sitemixper_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['SiteMixRatio'],2, true, true);?>" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>

                        <li id ="lireadymix_<?php echo $i; ?>" <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                            <label class="spl_siz">Ready Mix (%)</label>
                            <input type="text" class="text-right w_100_h30" name="readymixper_<?php echo $i; ?>" id="readymixper_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['ReadyMixRatio'],2, true, true);?>" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- Tab panes -->
            <div class="lstate">
                <ul  id="raworktable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['WorkingQty'])) echo $this->commonHelper()->sanitizeNumber( $trans['WorkingQty'],3, true, true); else echo 1; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li <?php echo (isset($trans['Cement']) && $trans['Cement']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>AQty_li">
                        <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="<?php if (isset($trans['CementRatio'])) echo $this->commonHelper()->sanitizeNumber( $trans['CementRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li <?php echo (isset($trans['Sand']) && $trans['Sand']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>BQty_li">
                        <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" value="<?php if (isset($trans['SandRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['SandRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li <?php echo (isset($trans['Metal']) && $trans['Metal']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>CQty_li">
                        <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="<?php if (isset($trans['MetalRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['MetalRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                    <li <?php echo (isset($trans['Thickness']) && $trans['Thickness']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>thick_li">
                        <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="<?php if (isset($trans['ThickQty'])) echo $this->commonHelper()->sanitizeNumber($trans['ThickQty'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                </ul>
                <ul  style="display: none;" id="raworkRtable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanalR_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['RWorkingQty'])) echo $this->commonHelper()->sanitizeNumber($trans['RWorkingQty'],3); else echo 1; ?>" onkeypress="return isDecimal(event,this)" readonly/>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12">
        <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
        <!-- Sitemix tabs -->
        <table class="table" style="margin-bottom:0px;" id="rateanal_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref no</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0;$iRefId=1;$weightagetotal=0;
            foreach($rfcrateanal as $ratrans):
                if($ratrans['MixType'] != 'S' || $ratrans['QuotationTransId'] != $trans['QuotationTransId']) continue;
                ?>
                <tr id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="12">
                            <input type="text" class="parent_text"  style="font-weight:bold" name="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>" readonly>
                        </td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $ratrans['ReferenceId'];?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <!--                                        <li>-->
                                <!--                                            <a href="#" name="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" id="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" onclick="javascript:DeleteResource(this.id, event)">-->
                                <!--                                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>-->
                                <!--                                            </a>-->
                                <!--                                        </li>-->
                            </ul>
                        </td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo ($ratrans['IncludeFlag']==1) ? true : false; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" > R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%">
                            <input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php echo $ratrans['Code'] . ' ' .$ratrans['ResourceName']?>" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>">Wastage %</label>
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>">Weightage %</label>
                            </div>
                        </td>
                        <td width="3%">
                            <input class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3,true,true);?>" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" readonly/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],3)?>" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],3)?>" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                            </div>
                        </td>
                        <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ><?php echo $ratrans['UnitName']?></label></td>
                        <td width="5%"><input class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" readonly/></td>
                        <td width="8%"><input class="parent_text text-right" type="text" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <!--                                        <li>-->
                                <!--                                            <a href="#" name="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" id="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" onclick="javascript:DeleteResource(this.id, event)">-->
                                <!--                                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>-->
                                <!--                                            </a>-->
                                <!--                                        </li>-->
                            </ul>
                        </td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount']; $weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1; }
            endforeach; ?>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right"  id="rateanal_<?php echo $i; ?>_totweightage" value="<?php echo $this->commonHelper()->sanitizeNumber($weightagetotal,2,true); ?>" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr	" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['WastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['WastageAmt'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="#" class="wasteTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="wastemainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwaste_<?php echo $i; ?>"></div>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['BaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['BaseRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totbaserate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['QualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['QualifierValue'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totqualrate" readonly/></td>
                <td style="border-right:none;border-top:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="#" class="qualTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrqual)) { $textHtml =  $arrqual[$rfctransid] ; $textHtml = str_replace('__1','_'.$i,$textHtml); } else { $textHtml=''; }  echo $textHtml;?>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['TotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['TotalRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri"  id="rateanal_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['NetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['NetRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totnetrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoid_<?php echo $i; ?>" id="rowinfoid_<?php echo $i; ?>" value="<?php echo $j; ?>" readonly />
        <!-- Readymix tabs -->
        <table class="table" style="display: none;margin-bottom:0px;" id="rateanalR_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref no</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0;
            foreach($rfcrateanal as $ratrans):
                if($ratrans['MixType'] != 'R' || $ratrans['QuotationTransId'] != $trans['QuotationTransId']) continue;
                ?>
                <tr id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="12">
                            <input type="text" class="parent_text"  style="font-weight:bold" name="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>" readonly>
                        </td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $ratrans['ReferenceId'];?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <!--                                        <li>-->
                                <!--                                            <a href="#" name="rateanalR_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" id="rateanalR_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" onclick="javascript:DeleteResourceR(this.id,event)">-->
                                <!--                                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>-->
                                <!--                                            </a>-->
                                <!--                                        </li>-->
                            </ul>
                        </td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php if ($ratrans['IncludeFlag']==1) true; else false; ?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%">
                            <input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php echo $ratrans['Code'] . ' ' .$ratrans['ResourceName']?>" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>">Wastage %</label>
                                <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>">Weightage %</label>
                            </div>
                        </td>
                        <td width="3%">
                            <input class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3)?>" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" readonly/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],3)?>" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],3)?>" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                            </div>
                        </td>
                        <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ><?php echo $ratrans['UnitName']?></label></td>
                        <td width="5%"><input class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly/></td>
                        <td width="8%"><input class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <!--<td width="3%"><a href="#" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <!--                                        <li>-->
                                <!--                                            <a href="#" name="rateanalR_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" id="rateanalR_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" onclick="javascript:DeleteResourceR(this.id,event)">-->
                                <!--                                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>-->
                                <!--                                            </a>-->
                                <!--                                        </li>-->
                            </ul>
                        </td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "<?php echo $ratrans['TransType']; ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount']; $weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1; }
            endforeach; ?>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right" id="rateanalR_<?php echo $i; ?>_totweightage" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['RWastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['RWastageAmt'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="#" class="wasteRTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="wastemainRTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwasteR_<?php echo $i; ?>"></div>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['RBaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RBaseRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totbaserate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['RQualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['RQualifierValue'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totqualrate" readonly/></td>
                <td style="border-right:none;border-top:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="#" class="qualTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrRqual)) { $textHtml =  $arrRqual[$rfctransid] ; $textHtml = str_replace('__1','_'.$i,$textHtml);} else { $textHtml=''; }  echo $textHtml;?>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['RTotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RTotalRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['RNetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RNetRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totnetrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoidR_<?php echo $i; ?>" id="rowinfoidR_<?php echo $i; ?>" value="<?php echo $j; ?>" readonly />
        </div>
        </div>
        </div>
        </td>
        </tr>
        <!--expand end-->
        <?php $wovalue +=  $trans['QuotedAmount']; endforeach; endif;?>
<?php $i=$i+1; ?>
</tbody>
<tbody class="wototal" style="border: none;">
<tr style="border-bottom:none;">
    <td colspan="7" class="rate_pri text-right"><label>Total Amount</label></td>
    <td><input type="text" class="parent_text total-clr text-right"  id="totalwovalue" name="totalwovalue" value="<?php echo $this->commonHelper()->sanitizeNumber($wovalue,2,true); ?>" readonly/></td>
    <td>&nbsp;</td>
</tr>
</tbody>
</table>
<input type="hidden" name="rowid" id="rowid" value="<?php echo $i; ?>" readonly />
</div>
</div>
<!--	<table  id="newrateresource" style="display: none;">-->
<!--        <tr>-->
<!--            <td ><a href="#" id ="butnewrateresource" class="btn btn-link" onclick="return ShowRateResource(event)" >Resource Invloved</a></td>-->
<!--        </tr>-->
<!--    </table>-->
<!--    <table  id="newitems" style="display: none;">-->
<!--        <tr>-->
<!--            <td ><a href="#" id ="butnewitems" class="btn btn-link" onclick="return ShowNewWorkGroup(event)" >New Work Group Created</a></td>-->
<!--        </tr>-->
<!--        <tr>-->
<!--            <table class="table" id ="newwg" style="display: none; width:50%; border:1px solid #ccc;">-->
<!--                <thead>-->
<!--                <tr>-->
<!--                    <th style="border-right:1px solid #ccc;">Work Group Name</th>-->
<!--                    <th class="text-center">&nbsp;</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr>-->
<!--                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newwgname_1" value = "" id="newwgname_1" readonly></td>-->
<!--                    <td width="3%"><button type="button" name="newwgdetails_1" value = "Show Details" id="newwgdetails_1" onclick="return ShowWorkGroup(this.id)" style="margin:0;" ><i class="fa fa-pencil-square-o ctlss"></i></button></td>-->
<!--                    <input type="hidden" name="newwgid_1" value = "" id="newwgid_1" >-->
<!--                    <input type="hidden" name="newwgtypename_1" value = "" id="newwgtypename_1" >-->
<!--                    <input type="hidden" name="newwgactivity_1" value = "" id="newwgactivity_1" >-->
<!--                    <input type="hidden" name="newwgrateanal_1" value = "" id="newwgrateanal_1" >-->
<!--                    <input type="hidden" name="newwgactivityres_1" value = "" id="newwgactivityres_1" >-->
<!--                    <input type="hidden" name="newwgresacttype_1" value = "" id="newwgresacttype_1" >-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </tr>-->
<!--    </table>-->
<!--    <table  id="newresitems" style="display: none;">-->
<!--        <tr>-->
<!--            <td ><a href="#" id ="butnewresitems" class="btn btn-link" onclick="return ShowNewResource(event)" >New Resource Created</a></td>-->
<!--        </tr>-->
<!--        <tr >-->
<!--            <table class="table" id="newres" style="display: none; width:50%;border:1px solid #ccc;">-->
<!--                <thead>-->
<!--                <tr>-->
<!--                    <th style="border-right:1px solid #ccc;">Resource Name</th>-->
<!--                    <th style="border-right:1px solid #ccc;">Type</th>-->
<!--                    <th class="text-center">&nbsp;</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr>-->
<!--                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresname_1" value = "" id="newresname_1" readonly></td>-->
<!--                    <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newrestype_1" value = "" id="newrestype_1" readonly></td>-->
<!--                    <td width="3%"><button type="button" name="newresdetails_1" value = "Show Details" id="newresdetails_1" onclick="return ShowResource(this.id)" style="background-color: #fff;margin:0;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>-->
<!--                    <input type="hidden"  name="newresgroup_1" value = "" id="newresgroup_1">-->
<!--                    <input type="hidden"  name="newresgroupid_1" value = "" id="newresgroupid_1">-->
<!--                    <input type="hidden"  name="newresunit_1" value = "" id="newresunit_1">-->
<!--                    <input type="hidden"  name="newresunitid_1" value = "" id="newresunitid_1">-->
<!--                    <input type="hidden"  name="newresrate_1" value = "" id="newresrate_1">-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </tr>-->
<!--    </table>-->
<!--	<div id="rateResource" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">-->
<!--		<div class="modal-dialog">-->
<!--			<div class="modal-content">-->
<!--				<div class="modal-header">-->
<!--					<button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>-->
<!--					<h1>Resource Rate</h1>-->
<!--				</div>-->
<!--				<div class="modal-body">-->
<!--					<div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">-->
<!--						<table class="table" id="resourcerate" style="margin-bottom: 0">-->
<!--							<thead>-->
<!--							<tr>-->
<!--								<th class="th-modal">ResourceName</th>-->
<!--								<th class="th-modal">Unit</th>-->
<!--								<th class="th-modal">Rate</th>-->
<!--							</tr>-->
<!--							</thead>-->
<!--							<tbody>-->
<!--							<tr>-->
<!--								<td width="15%"><input class="parent_text" type="text" name="rateresname_1" id="rateresname_1" readonly ></td>-->
<!--								<td width="3%"><input class="parent_text" type="text" name="rateresunit_1" id="rateresunit_1" readonly ></td>-->
<!--								<td width="5%"><input  class="parent_text text-right" type="text" name="rateresrate_1" id="rateresrate_1" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)"></td>-->
<!--								<input type="hidden" name="rateresoldrate_1" id="rateresoldrate_1" >-->
<!--								<input type="hidden" name="rateresid_1" id="rateresid_1" >-->
<!--							</tr>-->
<!--							</tbody>-->
<!--						</table>-->
<!--					</div>-->
<!--					<div class="clearfix"></div>-->
<!--				</div>-->
<!--				<div class="modal-footer">-->
<!--					<a href="#" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>-->
<!--					<button type="button" class="md_ok" onclick="return ResourceRateUpdate()" data-dismiss="modal">Apply</button>-->
<!--				</div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<div id="formula" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Formula</h1>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formula Expression</label>
                    <input type="text" class="parent_text" name="formulaexp" value = "" id="formulaexp" onkeypress="return isFormula(event);" >
                </div>
                <div class="form-group">
                    <input type="text" class="parent_text text-right" name="formulavalue" value = "" id="formulavalue" readonly >
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="md_ok" onclick="return formulaok()" data-dismiss="modal" data-toggle="tooltip" data-original-title="OK">OK</button>
            </div>
        </div>
    </div>
</div>

<!--	<div id="workgroupmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">-->
<!--		<div class="modal-dialog">-->
<!--			<div class="modal-content">-->
<!--				<div class="modal-header">-->
<!--					<button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>-->
<!--					<h1>WorkGroup</h1>-->
<!--				</div>-->
<!--				<div class="modal-body">-->
<!--					<input type="hidden" name="wgrowid" id="wgrowid">-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Work Group Name</label>-->
<!--						<input type="text" class="parent_text" name="workgroup" id="workgroup" >-->
<!--					</div>-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Worktype</label>-->
<!--						<input type="text" class="parent_text" name="worktype" id ="worktype" >-->
<!--						<input type="hidden" name="worktype_id" id ="worktype_id" >-->
<!--						<div class="clearfix"></div>-->
<!--					</div>-->
<!--					<div class="radio_check">-->
<!--						<p>-->
<!--							<input type="checkbox" name="resgroup" value="" id="create-activity">-->
<!--							<label for="create-activity" class="ripple has-ripple" style="position: relative; overflow: hidden;">Create Activity Resource Group Same as Work Group<span class="ripple-wrapper"></span></label>-->
<!--						</p>-->
<!--						<p>-->
<!--							<input type="checkbox" value="" id="auto-generate-rate" name="rateanal">-->
<!--							<label for="auto-generate-rate" class="ripple has-ripple" style="position: relative; overflow: hidden;">Automatically generate Rate Analysis for Item of Work based on Work Group Analysis<span class="ripple-wrapper"></span></label>-->
<!--						</p>-->
<!--						<p>-->
<!--							<input type="checkbox" value="" name="resact" id="auto-res-create">-->
<!--							<label for="auto-res-create" class="ripple has-ripple" style="position: relative; overflow: hidden;">Auto Activity Resource Creation Based on<span class="ripple-wrapper"></span></label>-->
<!--						</p>-->
<!--					</div>-->
<!--					<div class="clearfix"></div>-->
<!--					<div class="radio_check">-->
<!--						<p>-->
<!--							<input type="radio" value="workgroup" id="radio-workgroup" name="resacttype">-->
<!--							<label for="radio-workgroup" class="ripple has-ripple" style="position: relative; overflow: hidden;">WorkGroup<span class="ripple-wrapper"></span></label>-->
<!--						</p>-->
<!--						<p>-->
<!--							<input type="radio" value="iow" id="radio-iow" name="resacttype">-->
<!--							<label for="radio-iow" class="ripple has-ripple" style="position: relative; overflow: hidden;">Item of work<span class="ripple-wrapper"></span></label>-->
<!--						</p>-->
<!--					</div>-->
<!--					<div class="clearfix"></div>-->
<!--				</div>-->
<!--				<div class="modal-footer">-->
<!--					<a href="#" class="md_cance" data-dismiss="modal"  data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>-->
<!--					<button type="button" id="workgroupok" class="md_ok" onclick="return WorkGroupUpdate()" data-dismiss="modal" data-toggle="tooltip" data-original-title="OK">OK</button>-->
<!--				</div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<div id="dummyheader" style="display: none">
    <table id="dummyanalhead">
        <tbody>
        <tr id="rateanal__1_header__9">
            <td colspan="12"><input type="text" class="parent_text"  style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanal__1_rowrefid__9" value = "" id="rateanal__1_rowrefid__9">
            <input type="hidden" name="rateanal__1_type__9" value = "H" id="rateanal__1_type__9">
            <input type="hidden" name="rateanal__1_refid__9" value = "" id="rateanal__1_refid__9">
        </tr>
        <tr id="rateanalR__1_header__9">
            <td colspan="12"><input type="text" class="parent_text" style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanalR__1_rowrefid__9" value = "" id="rateanalR__1_rowrefid__9">
            <input type="hidden" name="rateanalR__1_type__9" value = "H" id="rateanalR__1_type__9">
            <input type="hidden" name="rateanalR__1_refid__9" value = "" id="rateanalR__1_refid__9">
        </tr>
        </tbody>
    </table>
</div>
<div id="dummy" style="display: none">
<table id="dummytable">
<tbody>
<tr id="IOWiRowId__1">
    <!--    <td width="11%"><input type="text" class="parent_text" name="parentid__1" id="parentid__1" onblur="return CheckParentValid(this.id)"></td>-->
    <td width="3%"><input class="parent_text" type="text" name="refserialno__1" id="refserialno__1" ></td>
    <td width="3%"><input class="parent_text" type="text" name="serialno__1" value = "" id="serialno__1" readonly></td>
    <td width="11%" align="center"><textarea class="parent_texts" name="spec__1" value = "" id="spec__1"</textarea></td>
    <td width="11%"><textarea class="parent_texts" name="shortspec__1" value = "" id="shortspec__1" ></textarea></td>
    <td width="5%"><input type="text" class="parent_text" name="unitid__1" id="unitid__1" ></td>
    <td width="5%"><input class="parent_text text-right" type="text" name="rate__1" id="rate__1" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly></td>
    <td width="5%"><input class="parent_text text-right" type="text" name="qrate__1" id="qrate__1" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly></td>
    <td width="5%"><input class="parent_text text-right" type="text" name="qamt__1" id="qamt__1" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly></td>
    <input type="hidden" name="iowid__1" value = "" id="iowid__1">
    <input type="hidden" name="unitkeyid__1" value = "" id="unitkeyid__1">
    <input type="hidden" name="parentkeyid__1" value = "" id="parentkeyid__1">
    <input type="hidden" name="rowrefid__1" value = "1" id="rowrefid__1">
    <input type="hidden" name="prevWOTransId__1" id="prevWOTransId__1">
    <input type="hidden" name="ePrevWOTransId__1" id="ePrevWOTransId__1">
    <td width="3%" class="action_btns_td">
        <ul class="action_btns">
            <li>
                <a href="#" class="mainTrDelete__1" style="display: none;">
                    <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                </a>
            </li>
            <li>
                <a href="#" class="mainTr__1">
                    <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                </a>
            </li>
        </ul>
    </td>
</tr>
<!--expand table-->
<tr style="display:none;" class="subTr__1 paintTr">
<td colspan="9"><div class="subDiv" style="display:none;">
<div class="col-lg-12">
    <!-- Nav tabs -->
    <div class="darkmenu" id="mixtab__1">
        <ul>
            <li class="active"><a href="#" name="analtype__1" id="analtype__1" class="ripple" onclick="showmix('sitemix',this.id,event)"><span><i class="fa fa-caret-right "></i></span> Sitemix</a></li>
            <li><a href="#" name="analtypeR__1" id="analtypeR__1" class="ripple" onclick="showmix('readymix',this.id,event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
        </ul>
        <div class="manual_seletc">
            <label>Rate Type</label>
            <div class="select-style select-inline">
                <select  name="ratetype__1" id ="ratetype__1">
                    <option value="">Default Rate Type</option>
                    <option value="S" selected>SiteMix</option>
                    <option value="R">ReadyMix</option>
                </select>
            </div>
        </div>
    </div>
    <!-- Tab panes -->
    <div class="lstate">
        <ul  id="raworktable__<?php echo $i;?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal__1_AnalQty" id="rateanal__1_AnalQty" value="<?php echo $this->commonHelper()->sanitizeNumber(1,3); ?>" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>AQty_li">
                <label>Cement</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal__1_AQty" id="rateanal__1_AQty" title="Cement (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>BQty_li">
                <label>Sand</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal__1_BQty" id="rateanal__1_BQty" title="Sand (B)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>CQty_li">
                <label>Metal</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal__1_CQty" id="rateanal__1_CQty" title="Metal (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>thick_li">
                <label>Thickness (mm)</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanal__1_thick" id="rateanal__1_thick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
            </li>
        </ul>
        <ul  style="display: none;" id="raworkRtable__<?php echo $i;?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" name="rateanalR__1_AnalQty" id="rateanalR__1_AnalQty" value="1" title="Working Qty" onkeypress="return isDecimal(event,this)"/>
            </li>
        </ul>
    </div>
</div>
<div class="col-lg-12">
    <div class="table-responsive topsp animated-panel zoomIn"  style="overflow: visible;animation-delay: 0.2s;">
        <!-- Sitemix tabs -->
        <table class="table" style="margin-bottom:0px;" id="rateanal__1_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref No</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <tr id="rateanal__1_RowId__9">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanal__1_inc__9" value ="<?php echo true; ?>" id="rateanal__1_inc__9" checked class="ios_checkbox" />
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanal__1_ref__9" > R1 </label></td>
                <td width="15%"><input class="parent_text" name="rateanal__1_resid__9"  id="rateanal__1_resid__9" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)"/></td>
                <td width="3%"><input class="parent_text text-right" type="text" name="rateanal__1_resqty__9" id="rateanal__1_resqty__9" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" readonly/></td>
                <td width="5%"><label for ="rateanal__1_resunit__9" ></label></td>
                <td width="5%"><input class="parent_text text-right" type="text" name="rateanal__1_resrate__9"  id="rateanal__1_resrate__9" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" /></td>
                <td width="8%"><input class="parent_text text-right" type="text" name="rateanal__1_resamt__9"  id="rateanal__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
                <td width="3%" class="action_btns_td">
                    <ul class="action_btns">
                        <li>
                            <a href="#" name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id,event)" style="display: none;">
                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="rateanal__1_reskeyid__9" id="rateanal__1_reskeyid__9">
                <input type="hidden" name="rateanal__1_iowkeyid__9" id="rateanal__1_iowkeyid__9">
                <input type="hidden" name="rateanal__1_formula__9" value = "" id="rateanal__1_formula__9">
                <input type="hidden" name="rateanal__1_rowrefid__9" value = "1" id="rateanal__1_rowrefid__9">
                <input type="hidden" name="rateanal__1_type__9" value = "R" id="rateanal__1_type__9">
                <input type="hidden" name="rateanal__1_refid__9" value = "1" id="rateanal__1_refid__9">
                <input type="hidden" name="rateanal__1_restypeid__9"  id="rateanal__1_restypeid__9">
                <input type="hidden" name="rateanal__1_ratetype__9"  id="rateanal__1_ratetype__9">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;" align="right" class="rate_pri">Rate for</td>
                <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanal__1_totrate" id="rateanal__1_totrate" readonly/></td>
                <td style="border-right:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td style="border-right:none; border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanal__1_perrate" id="rateanal__1_perrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td style="border-right:none; border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanal__1_netrate" id="rateanal__1_netrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoid__1" id="rowinfoid__1" value="1">
        <!-- Readymix tabs -->
        <table class="table" style="display: none;margin-bottom:0px;" id="rateanalR__1_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref no</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <tr id="rateanalR__1_RowId__9">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanalR__1_inc__9" value = "<?php echo true; ?>" id="rateanalR__1_inc__9" checked class="ios_checkbox" />
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanalR__1_ref__9" > R1 </label></td>
                <td width="15%"><input class="parent_text" name="rateanalR__1_resid__9" id="rateanalR__1_resid__9" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/></td>
                <td width="3%"><input class="parent_text text-right" type="text" name="rateanalR__1_resqty__9" id="rateanalR__1_resqty__9" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" readonly/></td>
                <td width="5%"><label for ="rateanalR__1_resunit__9"></label></td>
                <td width="5%"><input class="parent_text text-right" type="text" name="rateanalR__1_resrate__9"  id="rateanalR__1_resrate__9" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" /></td>
                <td width="8%"><input class="parent_text text-right" type="text" name="rateanalR__1_resamt__9" id="rateanalR__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
                <td width="3%" class="action_btns_td">
                    <ul class="action_btns">
                        <li>
                            <a href="#" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)" style="display: none;">
                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="rateanalR__1_reskeyid__9" id="rateanalR__1_reskeyid__9">
                <input type="hidden" name="rateanalR__1_iowkeyid__9" id="rateanalR__1_iowkeyid__9">
                <input type="hidden" name="rateanalR__1_formula__9" value = "" id="rateanalR__1_formula__9">
                <input type="hidden" name="rateanalR__1_rowrefid__9" value = "1" id="rateanalR__1_rowrefid__9">
                <input type="hidden" name="rateanalR__1_type__9" value = "R" id="rateanalR__1_type__9">
                <input type="hidden" name="rateanalR__1_refid__9" value = "1" id="rateanalR__1_refid__9">
                <input type="hidden" name="rateanalR__1_restypeid__9" value = "" id="rateanalR__1_restypeid__9">
                <input type="hidden" name="rateanalR__1_ratetype__9" value = "" id="rateanalR__1_ratetype__9">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;"></td>
                <td style="border-right:none;" align="right" class="rate_pri">Rate for</td>
                <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanalR__1_totrate" id="rateanalR__1_totrate" readonly/></td>
                <td style="border-right:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td style="border-right:none; border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanalR__1_perrate" id="rateanalR__1_perrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td style="border-right:none; border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;"></td>
                <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="rateanalR__1_netrate" id="rateanalR__1_netrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoidR__1" id="rowinfoidR__1" value="1">
    </div>
</div>
</div></td>
</tr>
</tbody>
</table>
</div>
<div id="dummyactivity" style="display: none">
    <div class="darkmenu col-lg-12">
        <div class="col-lg-4">
            <ul>
                <li class="active"><a href="#" name="analtypeM" id="analtype" class="ripple" onclick="showAnalmix('manual',this.id, event)"><span><i class="fa fa-magic"></i></span> Manual</a></li>
                <li><a href="#"name="analtype" id="analtypeA" class="ripple" onclick="showAnalmix('machinery',this.id, event)"><span><i class="fa fa-cogs"></i></span> Machinery</a></li>
            </ul>
        </div>
        <div class="col-lg-8 lstatea manual_mac">
            <ul>
                <li>
                    <label >LS Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateL" id="analrateL" title="LS Rate" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Manual Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateM" id="analrateM" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Machinery Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateA" id="analrateA" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Rate Type</label>
                    <div class="select-style select-inline">
                        <select name="analrate" id ="analrate">
                            <option value="L" >LS </option>
                            <option value="M" >Manual </option>
                            <option value="A" >Machinery </option>
                        </select>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-lg-12 clear" id="activitymanual" style="margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right" name="activityAnalQty" id="activityAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12" id="activitymachinery" style="display: none; margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right"  name="activityRAnalQty" id="activityRAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12">
        <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;animation-delay: 0.2s;">
            <!-- Manual tabs -->
            <table class="table" style="margin-bottom:0px;" id="activityrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr">Rate</th>
                    <th class="bg_clo_subTr">Amount</th>
                </tr>
                </thead>
                <tbody >
                <tr id="activityRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityresid_1" id ="activityresid_1" readonly ></td>
                    <td width="5%"><label for ="activityresunit_1" ></label></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresqty_1" id="activityresqty_1" readonly ></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresrate_1" id="activityresrate_1" readonly></td>
                    <td width="8%"><input type="text" class="parent_text text-right" name="activityresamt_1" id="activityresamt_1" readonly ></td>
                    <input type="hidden" name="activityformula_1" value = "" id="activityformula_1">
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none; font-weight:600;" align="right" class="rate_pri">Total</td>
                    <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activitytotrate" id="activitytotrate" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate Per Unit</td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityperrate" id="activityperrate" readonly/></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="arowinfoid" id="arowinfoid" value="1">
            <!-- Machinery tabs -->
            <table class="table" style="display: none;margin-bottom:0px;" id="activityRrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr">Rate</th>
                    <th class="bg_clo_subTr">Amount</th>
                </tr>
                </thead>
                <tbody >
                <tr id="activityRRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityRresid_1" id ="activityRresid_1" readonly ></td>
                    <td width="5%"><label for ="activityRresunit_1" ></label></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresqty_1" id="activityRresqty_1"  readonly></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresrate_1" id="activityRresrate_1" readonly></td>
                    <td width="12%"><input type="text" class="parent_text text-right" name="activityRresamt_1" id="activityRresamt_1" readonly></td>
                    <input type="hidden" name="activityRformula_1" value = "" id="activityRformula_1">
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;font-weight:600; vertical-align: middle; " align="right" class="rate_pri">Total</td>
                    <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityRtotrate" id="activityRtotrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate Per Unit</td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="activityRperrate" id="activityRperrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="arowinfoidR" id="arowinfoidR" value="1">
        </div>
    </div>
</div>
<div id="dummysubiow" style="display: none">
    <tr class="subiow_1">
        <td width="100%"><div class="col-lg-12">
                <!-- Nav tabs -->
                <div class="darkmenu">
                    <ul>
                        <li class="active"><a href="#" name="sanaltypeS" class="ripple" id="sanaltype" onclick="showSubIOWMix('sitemix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Sitemix</a></li>
                        <li><a href="#" name="sanaltype" id="sanaltypeR" class="ripple" onclick="showSubIOWMix('readymix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
                    </ul>
                    <div class="manual_seletc">
                        <label>Rate Type</label>
                        <div class="select-style select-inline">
                            <select name="analrate" id ="analrate">
                                <option value="">Default Rate Type</option>
                                <option value="S" >SiteMix </option>
                                <option value="R" >ReadyMix </option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Tab panes -->
                <div class="lstate">
                    <ul  id="sraworktable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalAnalQty" id="srateanalAnalQty" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly />
                        </li>
                        <li>
                            <label>Cement</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalAQty" id="srateanalAQty" title="Cement (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li>
                            <label>Sand</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalBQty" id="srateanalBQty" title="Sand (B)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li>
                            <label>Metal</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalCQty" id="srateanalCQty" title="Metal (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                        <li>
                            <label>Thickness (mm)</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalthick" id="srateanalthick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                    <ul  style="display: none;" id="sraworkRtable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalRAnalQty" id="srateanalRAnalQty" title="Working Qty" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow: visible;">
                    <!-- Sitemix tabs -->
                    <table class="table" style="margin-bottom:0px;" id="srateanalrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc / Exc</th>
                            <th class="bg_clo_subTr">Ref no</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Rate</th>
                            <th class="bg_clo_subTr">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalinc_1" value ="<?php echo true; ?>" id="srateanalinc_1" checked class="ios_checkbox" readonly />
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="srateanalref_1">R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalresid_1" id ="rateanalresid_1" onblur="return CheckResValid(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" name="srateanalresqty_1" value = "" id="srateanalresqty_1" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" readonly/></td>
                            <td width="5%"><label for ="srateanalresunit_1" ></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" name="srateanalresrate_1" id="srateanal_<?php echo $i;?>resrate_1" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" name="srateanalresamt_1" id="srateanalresamt_1" readonly onkeypress="return isDecimal(event,this)"/></td>
                            <input type="hidden" name="srateanalformula_1" value = "" id="srateanalformula_1">
                            <input type="hidden" name="srateanalrowrefid_1" value = "" id="srateanalrowrefid_1">
                            <input type="hidden" name="srateanaltype_1" value = "R" id="srateanaltype_1">
                            <input type="hidden" name="srateanalrefid_1" value = "1" id="srateanalrefid_1">
                            <input type="hidden" name="srateanalrestypeid_1" value = "" id="srateanalrestypeid_1">
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;" align="right" class="rate_pri">Rate for</td>
                            <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanaltotrate" id="srateanaltotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalperrate" id="srateanalperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalnetrate" id="srateanalnetrate" readonly/></td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="srowinfoid" id="srowinfoid" value="1">
                    <!-- Readymix tabs -->
                    <table class="table" style="display: none;margin-bottom:0px;"  id="srateanalRrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc / Exc</th>
                            <th class="bg_clo_subTr">Ref no</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Rate</th>
                            <th class="bg_clo_subTr">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalRinc_1" value = "<?php echo true; ?>" id="srateanalRinc_1" checked class="ios_checkbox" readonly/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="" >R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalRresid_1" id ="rateanalRresid_1" onblur="return CheckResValid(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" name="srateanalRresqty_1" id="srateanalRresqty_1" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" readonly/></td>
                            <td width="5%"><label for ="srateanalRresunit_1"></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" name="srateanalRresrate_1" id="srateanalR_<?php echo $i;?>resrate_1"  onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" name="srateanalRresamt_1" id="srateanalRresamt_1" readonly onkeypress="return isDecimal(event,this)" readonly/></td>
                            <input type="hidden" name="srateanalRformula_1" value = "" id="srateanalRformula_1">
                            <input type="hidden" name="srateanalRrowrefid_1" value = "" id="srateanalRrowrefid_1">
                            <input type="hidden" name="srateanalRtype_1" value = "R" id="srateanalRtype_1">
                            <input type="hidden" name="srateanalRrefid_1" value = "1" id="srateanalRrefid_1">
                            <input type="hidden" name="srateanalRrestypeid_1" value = "" id="srateanalRrestypeid_1">
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;" class="rate_pri" align="right">Rate for</td>
                            <td style="border-right:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRtotrate" id="srateanalRtotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRperrate"id="srateanalRperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right" type="text" placeholder="00.0" name="srateanalRnetrate" id="srateanalRnetrate" readonly/></td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="srowinfoidR" id="srowinfoidR" value="1">
                </div>
            </div></td>
    </tr>
</div>
<!--	<div id="resourcemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">-->
<!--		<div class="modal-dialog">-->
<!--			<div class="modal-content">-->
<!--				<div class="modal-header">-->
<!--					<button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>-->
<!--					<h1>Resource</h1>-->
<!--				</div>-->
<!--				<div class="modal-body">-->
<!--					<input type="hidden" name="resrowid" id="resrowid" >-->
<!--					<input type="hidden" id="refNewResRowName" />-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Resource Name</label>-->
<!--						<input type="text" class="parent_text" name="resname" id="resname" >-->
<!--					</div>-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Resource Group</label>-->
<!--						<input type="text" class="parent_text" name="resgroup" id="resgroup" autocomplete="off">-->
<!--						<input type="hidden" name="resgroupid" id="resgroupid">-->
<!--					</div>-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Resource Type</label>-->
<!--						<input type="text" class="parent_text"  name="restype" id="restype" readonly>-->
<!--						<input type="hidden" name="restypeid" id="restypeid">-->
<!--					</div>-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Unit</label>-->
<!--						<input type="text" class="parent_text" name="resunit" id="resunit" autocomplete="off">-->
<!--						<input type="hidden" name="resunitid" id="resunitid">-->
<!--					</div>-->
<!--					<div class="form-group">-->
<!--						<label style="margin-bottom: 10px;">Rate</label>-->
<!--						<input type="text" class="parent_text" name="resrate" id="resrate" onkeypress="return isDecimal(event,this)">-->
<!--						</td>-->
<!--						</tr>-->
<!--					</div>-->
<!--				</div>-->
<!--				<div class="modal-footer"> <a href="#" class="md_cance" data-dismiss="modal"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>-->
<!--					<button type="button" id="newresok" class="md_ok" onclick="return ResourceUpdate()" data-dismiss="modal" data-toggle="tooltip"data-original-title="OK">-->
<!--						OK-->
<!--					</button>-->
<!--				</div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<script type="text/javascript">
$(function () {

    $('body').tooltip({
        selector: '.error'
    });

    $('body').on('focus', 'textarea[id^=spec_],textarea[id^=shortspec_]', function () {
        $(this).parents('.on-focus').addClass('expandDiv');
    });

    $('body').on('blur', 'textarea[id^=spec_],textarea[id^=shortspec_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDiv');
    });

    $(document).on('click', function() {
        toogleTooltip();
    });
    $(document).on('keydown',function() {
        toogleTooltip();
    });
    expandwbsTrFn();
    expandwasteTrFn();
    bindQualExpandTr();

});
var iFocusRowId=1;
var iTransRowId=0;
var bSiteMix=true;
var sWGUpdateMode='Add';
var sResUpdateMode='Add'
var arrres = <?php echo json_encode($reslist); ?>;
var arriowres = <?php echo json_encode($resiowlist); ?>;
var arrayreslist1 = $.map(arrres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'Resource' }}; });
var arrayreslist2 = $.map(arriowres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'IOW' }}; });
var arrayreslist = arrayreslist1.concat(arrayreslist2);
var arrayres = arrayreslist;
var arrayresR = arrayreslist;
//var arrayunitlist = <?php //echo json_encode($unit); ?>//;
//var arryparentList = <?php //echo json_encode($parentiow); ?>//;
//var arrayworktype = <?php //echo json_encode($worktype); ?>//;
var arrayresgroup = <?php echo json_encode($resgroup); ?>;
var arrActivityAnal= [];
var arrActivityRes= [];
var arrSubIOW= [];
var arrSubIOWAnal= [];

var bExcelSNo = false,
    bExcelCode = false,
    bExcelSpec = false,
    bExcelUnit = false,
    bExcelQty = false,
    bExcelRate = false,
    bExcelAmount = false;

var formData = new FormData();
var arrayField =[];
arrayField = [{ data :1, value: 'SerialNo' },
    { data :2, value: 'Code' },
    { data :3, value: 'Specification' },
    { data :4, value: 'Unit' },
    { data :5, value: 'Qty' },
    { data :6, value: 'Rate' },
    { data :7, value: 'Amount' }
];

var arrayFieldR = arrayField;

function toogleTooltip() {
    var $expandDivs = $('.expandDiv');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('textarea').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDiv').find('textarea').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDiv');
        $expandDivs.not($parent_focus).find('textarea').trigger('blur');
        return;
    }
}
function expandwbsTrFn(reset) {
    var $mainTRs = $("a[class*=wbsTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wbsmainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewbsdetails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewbsdetails(key) {
    var $mainTRs = $("a[class*=wbsTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}
// Expand Script
function expandTrFn(reset) {
    var $mainTRs = $("a[class*=mainTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            $('rateanal_'+ key +'_restable').show();
            iFocusRowId = key;
            closedetails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}


function expandwasteTrFn(reset) {
    var $mainTRs = $("a[class*=wasteTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewastedtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewastedtails(key) {
    var $mainTRs = $("a[class*=wasteTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}


function expandwasteRTrFn(reset) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainRTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewasteRdtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewasteRdtails(key) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}
function bindQualExpandTr() {
    var $mainTr = $(".qualmainExp");
    $mainTr.unbind('click');
    $mainTr.click(function (e) {
        e.preventDefault();
        if (!$(this).closest("tr").next(".qualsubTr").is(":visible")) {
            closeQualTr();
            $(this).closest("tr").next(".qualsubTr").show();
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideDown("slow");
        }
        else {
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".qualsubTr").slideUp("slow");
        }
    });
}
function closeQualTr() {
    var $mainTr = $(".qualmainExp");
    $.each($mainTr, function () {
        $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
        $(this).closest("tr").next(".qualsubTr").slideUp("slow");
    });
}

//Wastage
function showWastage(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        ssname= 'rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        ssname= 'rateanalR_' + iFocusRowId,
            iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }




    var sHtml = '<table class="table red-thss" style=" margin-bottom:0px;"> \
                 <thead> \
                      <tr> \
                       <th>&nbsp;</th> \
                       <th>Ref</th> \
                       <th>Description</th> \
                       <th class="text-right">Qty</th> \
                       <th class="text-right">Wastage%</th> \
                       <th class="text-right">Wastage Qty</th> \
                       <th class="text-right">Rate</th> \
                       <th class="text-right">Amount</th> \
                       <th>&nbsp;</th> \
                      </tr> \
                 </thead> \
                 <tbody>';

    var bWasteFound=false;
    for (i = 1; i <= iRows; i++) {
        if ($(name + '_inc_' + i).is(':checked') == true) {
            var dwasteper = parseFloat(isNullCheck($(name + "_Wastage_" + i).val(),'number'));
            if (dwasteper !=0) {
                bWasteFound = true;

                var sRef = $('label[for=' + ssname + '_ref_' + i + ']').html().trim(),
                    sDesc = isNullCheck($(name + "_resid_" + i).val(),'string'),
                    dQty = parseFloat(isNullCheck($(name + "_resqty_" + i).val(),'number')),
                    dRate = parseFloat(isNullCheck($(name + "_resrate_" + i).val(),'number')),
                    dwasteQty = parseFloat(isNullCheck($(name + "_WastageQty_" + i).val(),'number')),
                    dwasteAmt = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));

                sHtml = sHtml + '<tr> \
                        <td width="1%">&nbsp;</td> \
                        <td width="3%"><label>' + sRef + '</label></td> \
                        <td width="15%"><input class="parent_text red-non" readonly value="' + sDesc + '"></td> \
                        <td width="5%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dQty,3) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteper,2) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteQty,3) + '"></td> \
                        <td width="8%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dRate,2,true) + '"></td> \
                        <td width="10%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteAmt,2,true) + '"></td> \
                        <td width="4%">&nbsp;</td> \
                        </tr>'
            }
        }
    }
    sHtml = sHtml + '</tbody> </table>';

    if (bWasteFound == false) sHtml="";

    if (sname.substr(sname.length-1) ==  "R") {
        $('#divwasteR_' + iFocusRowId).empty();
        $('#divwasteR_' + iFocusRowId).html(sHtml);
        $('#divwasteR_' + iFocusRowId).fadeIn("slow");
    } else {
        $('#divwaste_' + iFocusRowId).empty();
        $('#divwaste_' + iFocusRowId).html(sHtml);
        $('#divwaste_' + iFocusRowId).fadeIn("slow");
    }
}
function expandResSubTr(tr, id) {
    var $subTr = $('#' + tr),
        $i = $('#' + id).find("i"),
        type = id.split('_')[0],
        rateanal = '#rateanal_';
    if (type.substr(type.length - 1) == 'R') rateanal = '#rateanalR_';
    if($subTr.length ==0) {
        var sStr = id.split('_');
        $(rateanal+ sStr[1] +'_resrate_' + sStr[3]).triggerHandler('focus');
        return;
    }
    if(!$subTr.is(":visible")){
        $subTr.show();
        $subTr.find(".subDiv").slideDown("slow");
        $i.addClass("tform");
    } else{
        $subTr.find(".subDiv").slideUp("slow");
        $subTr.slideUp("slow");
        $i.removeClass("tform");
    }
}

function bindAutoComplete() {
//    var $parent_ids = $('input[id*=parentid_]'),
//      var  $unitids = $('input[id*=unitid_]');
    // unbind previous autocomplete functionality
//    $parent_ids.unbind('autocomplete');
    $unitids.unbind('autocomplete');
//    $.each($parent_ids, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
//        var key1 =  name.split('_')[1];
//        $this.autocomplete({
//            lookup: arryparentList,
//            showNoSuggestionNotice:true,
//            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newworkgroup_'+ key1  +'" class="btn btn-link" id="newworkgroup_'+ key1 +'" value="Work Group" onclick="return AddNewWorkGroup('+name+')" >',
//            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//                if (queryLowerCase =='*') return suggestion.value;
//                else {
//                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                    return re.test(suggestion.value);
//                }
//            },
//            onSelect: function(suggestion) {
//                if(suggestion) {
//                    $("#parentkeyid_"+ key1).val(suggestion.data);
//                    $(this).removeClass('error');
//                }
//            },
//            onSearchStart: function(suggestion) {
//                $("#parentkeyid_"+ key1).val(0);
//            },
//            onSearchComplete: function (query, suggestions) {
//                if(!suggestions.length){
//                    $(this).addClass('error');
//                    $("#parentkeyid_"+ key1).val(0);
//                } else $(this).removeClass('error');
//            }
//        });
//    });
//    $.each($unitids, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
//        var arrname = name.split('_');
//        var key1 = arrname[1];
//        $this.autocomplete({
//            lookup: arrayunitlist,
//            showNoSuggestionNotice:false,
//            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newunit_'+ key1  +'" class="btn btn-link" id="newunit_'+ key1 +'" value="Unit" onclick="return AddNewUnit('+name+')" >',
//            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//                if (queryLowerCase =='*') return suggestion.value;
//                else {
//                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                    return re.test(suggestion.value);
//                }
//            },
//            onSelect: function(suggestion) {
//                if(suggestion) {
//                    $("#unitkeyid_" + key1).val(suggestion.data);
//                    $(this).removeClass('error');
//                    AddNewRowA(name);
//                }
//            },
//            onSearchStart: function(suggestion) {
//                $("#unitkeyid_" + key1).val(0);
//            },
//            onSearchComplete: function (query, suggestions) {
//                if(!suggestions.length){
//                    $(this).addClass('error');
//                    $("#unitkeyid_" + key1).val(0);
//                } else $(this).removeClass('error');
//            }
//        });
//    });
}
function bindResourceAutoComplete() {
    var $resids = $('input[id*=resid_]');
    // unbind previous autocomplete functionality
    $resids.unbind('autocomplete');
    $.each($resids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_'),
            key1 = arrname[1],
            key2 = arrname[3],
            sname = arrname[0];
        if (sname.substr(sname.length-1) === 'R') {
            var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayresR,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id, key1, key2, "R");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id, key1, key2, "R");
                        }
                        var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + (parseInt(key2) + 1));
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowResR(key1);
                            $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        } else {
            var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanal_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayres,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanal_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id,key1, key2,"");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanal_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id,key1, key2,"");
                        }
                        var $rateanal =  $('#rateanal_'+key1+'_RowId_' + (parseInt(key2) + 1));
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowRes(key1);
                            $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        }
    });
}

function bindResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    if (name.substr(name.length-1) === 'R') {
        checkResource(key1,"R");
        var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayresR,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id, key1, key2, "R");
                    }
                    else if (suggestion.data.category == "IOW") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id, key1, key2, "R");
                    }
                    var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowResR(key1);
                        $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    } else {
        checkResource(key1,"");
        var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanal_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayres,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanal_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id,key1, key2,"");
                    } else if (suggestion.data.category == "IOW") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanal_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id,key1, key2,"");
                    }
                    var $rateanal =  $('#rateanal_'+key1+'_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowRes(key1);
                        $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    }
}
//function bindTRDeleteFn(reset) {
//    var $trDelete = $('a[class*=mainTrDelete_]');
//    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
//    $.each($trDelete, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].className,
//            key =  name.split('_')[1];
//        if (name.indexOf('__') != -1) return;
//        if ($('#spec_' + key).val().length ==0) return;
//        if ($('#serialno_' + key).val().length ==0) return;
//        $this.on('click', function(e) {
//            e.preventDefault();
//            if (confirm('Do you want to Delete')) {
//                $this.closest('tr').nextAll('.subTr_' + key)[0].remove();
//                $this.closest('tr').remove();
//            }
//            return false;
//        });
//    });
//}
function bindMixSortablefn(reset) {
    // ReadyMix sortable function
    var $rBody = $('table[id*=rateanalR_] tbody.sorting'),
        $sBody = $('table[id*=rateanal_] tbody.sorting');
    $.each($rBody, function(i, obj){
        if ($(this).parent('table')[0].id.indexOf('__') != -1) {
            $rBody.splice(i, 1);
            $sBody.splice(i, 1);
        }
    });
    var $sRTable = $rBody.find('tr'),
        $sTable = $sBody.find('tr');
    if (typeof reset !== 'undefined' && reset === true) {
        $sRTable.unbind('click', 'dblclick', 'select', 'sortable');
        $sTable.unbind('click', 'dblclick', 'select', 'sortable');
        $rBody.unbind('sortable');
        $sBody.unbind('sortable');
    }
    $sRTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sRTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sRTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $rBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrderR(ifrow);
        }
    });
    // SiteMix sortable function
    $sTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrder(ifrow);
        }
    });
}
$(function () {
    /*if ($('#rfcmode').val().trim() == "edit" || $('#rfcmode').val().trim() == "revise") {
     var url1 = getBaseURL() + "project/rfc/getrfciowpicklist";
     var rfcsource =
     {
     async: false,
     dataType: "json",
     dataFields: [
     {name: 'IOWId', type: 'number'},
     {name: 'SerialNo', type: 'string'},
     {name: 'WorkGroupName', type: 'date'},
     {name: 'Specification', type: 'string'},
     {name: 'available', type: 'boolean'}
     ],
     id: 'ResourceId',
     url: url1
     };
     var rfcdata = new $.jqx.dataAdapter(rfcsource);
     $("#grid").jqxGrid({
     width: "100%",
     height: 436,
     rowsheight: 35,
     pagerButtonsCount: 6,
     pagesize: 10,
     source: rfcdata,
     pageable: true,
     sortable: true,
     altrows: true,
     enabletooltips: true,
     editable: true,
     selectionmode: 'singlerow',
     columns: [
     {text: 'IOWId', datafield: 'IOWId', hidden: true},
     {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '10%'},
     {text: 'WorkGroupName', datafield: 'WorkGroupName', 'editable': false, width: '20%'},
     {text: 'Specification', datafield: 'Specification', 'editable': false, width: '60%'},
     {text: '&nbsp;', align:'center', datafield: 'available', columntype: 'checkbox', width: '10%'},
     ]
     });
     $("#grid").bind('cellendedit', function (event) {
     if (event.args.value) $("#grid").jqxGrid('selectrow', event.args.rowindex);
     else $("#grid").jqxGrid('unselectrow', event.args.rowindex);
     });
     }*/
    var $formulaExp = $("#formulaexp");
    $('#formula').on('shown.bs.modal', function () {
        $formulaExp.focus();
        $formulaExp.select();
    });
//    $('#worktype').autocomplete({
//        lookup: arrayworktype,
//        multiselect:true,
//        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//            if (queryLowerCase =='*') return suggestion.value;
//            else {
//                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                return re.test(suggestion.value);
//            }
//        },
//        onSelect: function(suggestion) {
//            if(suggestion) {
//                $("#worktype_id").val(suggestion.data);
//                $(this).removeClass('error');
//            }
//        },
//        onSearchStart: function(suggestion) {
//            $("#worktype_id").val(0);
//        },
//        onSearchComplete: function (query, suggestions) {
//            if(!suggestions.length){
//                $(this).addClass('error');
//                $("#worktype_id").val(0);
//            } else $(this).removeClass('error');
//        }
//    });
//    $('#resgroup').autocomplete({
//        lookup: arrayresgroup,
//        multiselect:true,
//        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//            if (queryLowerCase =='*') return suggestion.value;
//            else {
//                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                return re.test(suggestion.value);
//            }
//        },
//        onSelect: function(suggestion) {
//            if(suggestion) {
//                $("#resgroupid").val(suggestion.data);
//                $('#restype').val(suggestion.TypeName);
//                $('#restypeid').val(suggestion.TypeId);
//                $(this).removeClass('error');
//            }
//        },
//        onSearchStart: function(suggestion) {
//            $("#resgroupid").val(0);
//        },
//        onSearchComplete: function (query, suggestions) {
//            if(!suggestions.length){
//                $(this).addClass('error');
//                $("#resgroupid").val(0);
//            } else $(this).removeClass('error');
//        }
//    });
//    $('#resunit').autocomplete({
//        lookup: arrayunitlist,
//        multiselect:true,
//        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//            if (queryLowerCase =='*') return suggestion.value;
//            else {
//                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                return re.test(suggestion.value);
//            }
//        },
//        onSelect: function(suggestion) {
//            if(suggestion) {
//                $("#resunitid").val(suggestion.data);
//                $(this).removeClass('error');
//            }
//        },
//        onSearchStart: function(suggestion) {
//            $("#resunitid").val(0);
//        },
//        onSearchComplete: function (query, suggestions) {
//            if(!suggestions.length){
//                $(this).addClass('error');
//                $("#resunitid").val(0);
//            } else $(this).removeClass('error');
//        }
//    });
    // modal forms on close
    $('#resourcemodal').on('hidden.bs.modal', function () {
        $(this).find('input').val('');
    });
    $('#workgroupmodal').on('hidden.bs.modal', function () {
        $(this).find('input[type=text]').val('');
        $(this).find('input[type=checkbox]').removeAttr('checked');
        $(this).find('input[type=radio]').removeAttr('checked');
    });
    bindMixSortablefn();
    expandTrFn();

//    if (parseFloat(isNullCheck($('#OrderAmount').val(),'number')) ==0)
//    {
//        $('#OrderAmount').val(sanitizeNumber(parseFloat(isNullCheck($('#totalwovalue').val(),'number')),2,true)).trigger('change');
//    }
//    bindTRDeleteFn();
//    bindAutoComplete();
//    bindResourceAutoComplete();
    // on edit from rfc bind subrow rateanalysis

//    if($('#rfcUId').val() != 0) {
//        var rowId = $('#rowid').val();
//        for(var i=1; i <= rowId; i++) {
//            var $resrate = $('input[id*=_'+i+'_resrate_]');
//            $.each($resrate, function() {
//                var x = $(this)[0].id,
//                    arrname = x.split('_');
//                if (x.indexOf('__') != -1) return;
//                var key1 = arrname[1],
//                    key2 = arrname[3],
//                    name = arrname[0] + '_' + key1,
//                    id = 0;
//                if($("#" + name + "_type_" + key2).val() == 'R') id = $('#' + name + '_reskeyid_' + key2).val();
//                else id = $('#'  + name + '_iowkeyid_' + key2).val();
//                if (arrname[0].charAt(arrname[0].length - 1) == 'R') cboResChanged(id, key1, key2, "R");
//                else cboResChanged(id, key1, key2, "");
//            });
//            $resrate.triggerHandler( "focus" );
//        }
//    }
});
function submitForm() {
    $('form').submit();
}
function DeleteResource(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId = sStr[1];
    var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanal_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoid_' + iFocusRowId).val(),
            $resname =  $('#rateanal_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrder(iFocusRowId);
    }
    return false;
}
function SortOrder(iRowid) {
    var rows = $('tr[id*=rateanal_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanal_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function SortOrderR(iRowid) {
    var rows = $('tr[id*=rateanalR_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanalR_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}

//function IOWRateUpdate(x) {
//    var sStr = x.split("_");
//    var iARowid = sStr[1];
//    var sVal = $('#ratetype_' + iARowid).val();
//    var dRate=0;
//    if (sVal=='R') dRate = parseFloat(isNullCheck($('#rateanalR_' + iARowid + '_netrate').val(),'number'));
//    else dRate = parseFloat(isNullCheck($('#rateanal_' + iARowid + '_netrate').val(),'number'));
//    $('#rate_' + iARowid).val(sanitizeNumber(dRate,2,true));
//}
//function CheckParentValid(x) {
//    var sStr = x.split("_");
//    var iARowid = sStr[1];
//    if ($('#parentkeyid_' + iARowid).val() == '0' || $('#parentkeyid_' + iARowid).val().length==0) {
//        if ($('#parentid_' + iARowid).val().length >0){$('#parentid_' + iARowid).addClass('error');}
//        else {$('#unitid_' + iARowid).removeClass('error');}
//    } else $('#parentid_' + iARowid).removeClass('error');
//}
//function CheckUnitValid(x) {
//    var sStr = x.split("_");
//    var iARowid = sStr[1];
//    if ($('#unitkeyid_' + iARowid).val() == 0 || $('#unitkeyid_' + iARowid).val().length==0) {
//        if ($('#unitid_' + iARowid).val().length >0){$('#unitid_' + iARowid).addClass('error');}
//        else {$('#unitid_' + iARowid).removeClass('error');}
//        $('#rate_' + iARowid).val(sanitizeNumber(0,2,true));
//    } else {
//        $('#unitid_' + iARowid).removeClass('error');
//        $('#rate_' + iARowid).val(sanitizeNumber(0,2,true));
//        AddNewRowA(x);
//    }
//}
function CheckResValid(x) {
    var iARowid = x.split("_")[3],
        name = '';
    iFocusRowId = x.split("_")[1];
    var sname = x.split('_')[0];
    if (sname.substr(sname.length-1) == "R") name = '#rateanalR_' + iFocusRowId;
    else name = '#rateanal_' + iFocusRowId;
    var sType = $(name + '_type_' + iARowid).val();
    if (sType == "I" || sType=="R") {
        if (sType == "I") {
            if ($(name + '_iowkeyid_' + iARowid).val() == '0' || $(name + '_iowkeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
//                $(name + '_resqty_' + iARowid).prop('readonly', true);
//                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
//                $(name + '_resqty_' + iARowid).prop('readonly', false);
//                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        } else {
            if ($(name + '_reskeyid_' + iARowid).val() == '0' || $(name + '_reskeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
//                $(name + '_resqty_' + iARowid).prop('readonly', true);
//                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
//                $(name + '_resqty_' + iARowid).prop('readonly', false);
//                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        }
    }
}
function ShowNewWorkGroup(e) {
    e.preventDefault();
    var $newwg = $('#newwg');
    if ($newwg.is(":hidden")) $newwg.show();
    else $newwg.hide();
    return false;
}
function ShowRateResource(e) {
    e.preventDefault();
    $("#rateResource").modal('show');
    return false;
}
//ResourceRateUpdate
function ResourceRateUpdate() {
    closedetails();
    var irows = $('#resourcerate tbody tr').length;
    var bFound=false;
    var dRate=0;
    var dOldRate=0;
    var iResid = 0;
    for (i = 1; i <= irows; i++) {
        iResid= $('#rateresid_' + i).val();
        dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
        dOldRate = parseFloat(isNullCheck($('#rateresoldrate_' + i).val(),'number'));
        if (dRate != dOldRate) {
            UpdateResourceRate(iResid,dRate);
            $('#rateresoldrate_' + i).val(dRate);
            UpdateActivityResourceRate(iResid,dRate);
            UpdateSubIOWResourceRate(iResid,dRate);
        }
    }
}
function UpdateActivityResourceRate(resid,rate) {
    for(var i=0;i<arrActivityAnal.length;i++) {
        if (arrActivityAnal[i].resourceid == resid) {
            arrActivityAnal[i].rate = rate;
            arrActivityAnal[i].amount = parseFloat(arrActivityAnal[i].qty) * rate;
            UpdateActivityRate(arrActivityAnal[i].activityid);
        }
    }
}
function UpdateActivityRate(iAResid) {
    var dmAmt = 0, daAmt = 0,dmQty= 0, daQty= 0;
    var objR = $.grep(arrActivityAnal, function (element, index) {
        return element.activityid == iAResid;});
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].activitytype =="A") daAmt = daAmt + parseFloat(objR[i].amount);
        else dmAmt = dmAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrActivityRes.length;i++) {
        if (arrActivityRes[i].activityid == iAResid) {
            dmQty = parseFloat(arrActivityRes[i].analysisMQty);
            daQty = parseFloat(arrActivityRes[i].analysisAQty);
            if (dmQty==0) { dmQty=1; arrActivityRes[i].AnalysisMQty = dmQty; }
            if (daQty==0) { daQty=1; arrActivityRes[i].AnalysisAQty = dmQty; }
            arrActivityRes[i].mRate = dmAmt/dmQty;
            arrActivityRes[i].aRate = daAmt/daQty;
            UpdateActivityMainRate(iAResid,arrActivityRes[i].lRate,arrActivityRes[i].mRate,arrActivityRes[i].aRate)
            break;
        }
    }
}
function UpdateResourceRate(iResid,dRate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateActivityMainRate(iResid,dLRate,dMRate,dARate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "M") { dRate =  dMRate; }
        else if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "A") { dRate =  dARate; }
        else { dRate =  dLRate; }
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateSubIOWResourceRate(resid,rate) {
    for(var i=0;i<arrSubIOWAnal.length;i++) {
        if (arrSubIOWAnal[i].resourceid == resid) {
            arrSubIOWAnal[i].rate = rate;
            arrSubIOWAnal[i].amount = parseFloat(arrSubIOWAnal[i].qty) * rate;
            UpdateSubIOWRate(arrSubIOWAnal[i].subiowid);
        }
    }
}
function UpdateSubIOWRate(isubiowid) {
    var dsAmt = 0, drAmt = 0,dsQty= 0, drQty= 0;
    var objR = $.grep(arrSubIOWAnal, function (element, index) {
        return element.subiowid == isubiowid;
    });
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].mixtype =="R") drAmt = drAmt + parseFloat(objR[i].amount);
        else dsAmt = dsAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrSubIOW.length;i++) {
        if (arrSubIOW[i].subiowid == isubiowid) {
            dsQty = parseFloat(arrSubIOW[i].workingqty);
            drQty = parseFloat(arrSubIOW[i].rworkingQty);
            if (dsQty==0) { dsQty=1; arrSubIOW[i].workingqty = dsQty; }
            if (drQty==0) { drQty=1; arrSubIOW[i].rworkingQty = drQty; }
            arrSubIOW[i].srate = dsAmt/dsQty;
            arrSubIOW[i].rrate = drAmt/drQty;
            UpdateSubIOWMainRate(isubiowid,arrSubIOW[i].srate,arrSubIOW[i].rrate)
            break;
        }
    }
}
function UpdateSubIOWMainRate(isubiowid,dSRate,dRRate) {
    var $reskeyids = $('input[id*=_iowkeyid_][value="'+isubiowid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "R") dRate =  dRRate;
        else dRate =  dSRate;
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function ShowNewResource(e) {
    e.preventDefault();
    var $newr = $('#newres');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function DeleteResourceR(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanalR_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
            $resname =  $('#rateanalR_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvityR_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrderR(iFocusRowId);
    }
    return false;
}
function closeIOWAnalysis(x) {
    var sStr = x.split("_"),
        key1 = sStr[1],
        activityName = 'resactvity_';
    if(sStr[0].substr(sStr[0].length - 1) == 'R') activityName = 'resactvityR_';
    $('tr[id*=resactvity_' + key1 +'_RowId_]').remove();
    $('tr[id*=resactvityR_' + key1 +'_RowId_]').remove();
    $('a[id*=resactvity_' + key1 +'_resTr_] i').removeClass('tform');
    $('a[id*=resactvityR_' + key1 +'_resTr_] i').removeClass('tform');
}
function showAnalysis(x,mtype) {
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    var sName = "rateanal_",
        activityName = 'resactvity_';
    if (mtype != 'undefined' && mtype =="R")  { sName = "rateanalR_"; activityName = 'resactvityR_'; }
    var iARowid = sStr[3],
        sRateType = $('#' + sName + iFocusRowId + '_ratetype_' + iARowid).val(),
        trName = activityName + iFocusRowId + '_RowId_' + iARowid,
        aLink = activityName + iFocusRowId + '_resTr_' + iARowid,
        iResId= 0,
        expandLink = '<li><a id="'+aLink+'" href="javascript: expandResSubTr(\''+trName+'\', \''+aLink+'\')"><span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-up"></i></span></a></li>';
    if($('#' + trName).length != 0) return;
    closeIOWAnalysis(x);
    if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "R") {
        iResId = isNullCheck($('#' + sName + iFocusRowId + '_reskeyid_' + iARowid).val(),'number');
        if (iResId == 0 || $('#' + sName + iFocusRowId + '_restypeid_' + iARowid).val() != 4) return;
        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv bs_bord" style="display: none;">').children().html($('#dummyactivity').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
        var objR = $.grep(arrActivityRes, function (element, index) {
            return element.activityid == iResId;
        });
        var dmQty =  parseFloat(objR[0].analysisMQty),
            daQty =  parseFloat(objR[0].analysisMQty);
        if (dmQty ==0) dmQty=1;
        if (daQty ==0) daQty=1;
        if (sRateType != "") { $('#analrate').val(sRateType); }
        else { $('#analrate').val(objR[0].ratetype); }
        $('#analrateL').val(objR[0].lRate);
        $('#analrateM').val(objR[0].mRate);
        $('#analrateA').val(objR[0].aRate);
        $('#analrate').trigger('change');
        $('#activityAnalQty').val(dmQty);
        $('#activityRAnalQty').val(daQty);
        var objAS = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'M';
        });
        var k = 0;
        var sOldid = "_1"
        var dmAmt=0;
        for (j = 0; j < objAS.length; j++) {
            k = k + 1;
            var sNewid = "_" + k;
            if (k != 1) {
                $("#activityrestable tbody.sorting tr:last").after("<tr>" + $("#activityrestable tbody tr:first").html() + "</tr>");
                $("#activityrestable tbody.sorting tr:last").find("input:text").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#activityrestable tbody.sorting tr:last").find("select").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#activityrestable tbody.sorting tr:last").find("input:hidden").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
            }
            $('#activityresid_' + k).val(objAS[j]['resourcename']);
            //$('#activityresunit_' + k).val(objAS[j]['unitname']);
            $("label[for='activityresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#activityresqty_' + k).val(objAS[j]['qty']);
            $('#activityresrate_' + k).val(objAS[j]['rate']);
            $('#activityresamt_' + k).val(objAS[j]['amount']);
            dmAmt = dmAmt + parseFloat(objAS[j]['amount']);
            $('#arowinfoid').val(k);
        }
        $('#activitytotrate').val(sanitizeNumber(dmAmt,2,true));
        var dmRate = dmAmt/dmQty;
        $('#activityperrate').val(sanitizeNumber(dmRate,2,true));
        $('#analrateM').val(sanitizeNumber(dmRate,2,true));
        var objAR = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'A';
        });
        var k = 0;
        var daAmt=0;
        for (j = 0; j < objAR.length; j++) {
            k = k + 1;
            var sNewid = "_" + k;
            if (k != 1) {
                $("#activityRrestable tbody.sorting tr:last").after("<tr>" + $("#activityRrestable tbody tr:first").html() + "</tr>");
                $("#activityRrestable tbody.sorting tr:last").find("input:text").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#activityRrestable tbody.sorting tr:last").find("select").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#activityRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
            }
            $('#activityRresid_' + k).val(objAR[j]['resourcename']);
            //$('#activityRresunit_' + k).val(objAR[j]['unitname']);
            $("label[for='activityRresunit_" + k + "']").html(objAR[j]['unitname']);
            $('#activityRresqty_' + k).val(objAR[j]['qty']);
            $('#activityRresrate_' + k).val(objAR[j]['rate']);
            $('#activityRresamt_' + k).val(objAR[j]['amount']);
            daAmt = daAmt + parseFloat(objAR[j]['amount']);
            $('#arowinfoidR').val(k);
        }
        $('#activityRtotrate').val(sanitizeNumber(daAmt,2,true));
        var daRate = daAmt/daQty;
        $('#activityRperrate').val(sanitizeNumber(daRate,2,true));
        $('#analrateA').val(sanitizeNumber(daRate,2,true));
        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();
    } else if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "I") {
        iResId = isNullCheck($('#' + sName + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number');
        if (iResId == 0 ) return;
        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv" style="display: none;">').children().html($('#dummysubiow').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
        var objR = $.grep(arrSubIOW, function (element, index) {
            return element.subiowid == iResId;
        });
        var dsQty =  parseFloat(isNullCheck(objR[0].workingqty,'number'));
        var drQty =  parseFloat(isNullCheck(objR[0].rworkingqty,'number'));
        if (dsQty ==0) dsQty=1;
        if (drQty ==0) drQty=1;
        if (sRateType != "") { $('#analrate').val(sRateType); }
        else { $('#analrate').val(objR[0].mixtype); }
        $('#srateanalAQty').val(objR[0].cementratio);
        $('#srateanalBQty').val(objR[0].sandratio);
        $('#srateanalCQty').val(objR[0].metalratio);
        $('#srateanalthick').val(objR[0].thickqty);
        $('#srateanalAnalQty').val(dsQty);
        $('#srateanalRAnalQty').val(drQty);
        var objAS = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype != 'R';
        });
        var dsAmt=0;
        var k = 0;
        var sOldid = "_1"
        for (j = 0; j < objAS.length; j++) {
            k = k + 1;
            var sNewid = "_" + k;
            if (k != 1) {
                $("#srateanalrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalrestable tbody tr:first").html() + "</tr>");
                $("#srateanalrestable tbody.sorting tr:last").find("input:text").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#srateanalrestable tbody.sorting tr:last").find("select").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#srateanalrestable tbody.sorting tr:last").find("input:hidden").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
            }
            $('#srateanalinc_' + k).val(objAS[j]['includeflag']);
            $('#srateanalref_' + k).val(objAS[j]['referenceid']);
            $('#srateanalresid_' + k).val(objAS[j]['resourcename']);
            $("label[for='srateanalresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#srateanalresqty_' + k).val(objAS[j]['qty']);
            $('#srateanalresrate_' + k).val(objAS[j]['rate']);
            $('#srateanalresamt_' + k).val(objAS[j]['amount']);
            $('#srateanalformula_' + k).val(objAS[j]['formula']);
            dsAmt = dsAmt + parseFloat(objAS[j]['amount']);
            $('#srowinfoid').val(k);
        }
        $('#srateanaltotrate').val(sanitizeNumber(dsAmt,2,true));
        var dsRate = dsAmt/dsQty;
        $('#srateanalperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalnetrate').val(sanitizeNumber(dsRate,2,true));
        var objAR = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype == 'R';
        });
        var drAmt =0;
        var k = 0;
        for (j = 0; j < objAR.length; j++) {
            k = k + 1;
            var sNewid = "_" + k;
            if (k != 1) {
                $("#srateanalRrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalRrestable tbody tr:first").html() + "</tr>");
                $("#srateanalRrestable tbody.sorting tr:last").find("input:text").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#srateanalRrestable tbody.sorting tr:last").find("select").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
                $("#srateanalRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
                });
            }
            $('#srateanalRinc_' + k).val(objAR[j]['includeflag']);
            $('#srateanalRref_' + k).val(objAR[j]['referenceid']);
            $('#srateanalRresid_' + k).val(objAR[j]['resourcename']);
            $("label[for='srateanalRunit_" + k + "']").html(objAR[j]['unitname']);
            $('#srateanalRresqty_' + k).val(objAR[j]['qty']);
            $('#srateanalRresrate_' + k).val(objAR[j]['rate']);
            $('#srateanalRresamt_' + k).val(objAR[j]['amount']);
            $('#srateanalRformula_' + k).val(objAR[j]['formula']);
            drAmt = drAmt + parseFloat(objAR[j]['amount']);
            $('#srowinfoidR').val(k);
        }
        $('#srateanalRtotrate').val(sanitizeNumber(drAmt,2,true));
        var drRate = drAmt/drQty;
        $('#srateanalRperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalRnetrate').val(sanitizeNumber(dsRate,2,true));
        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();
        $('#sraworktable').show();
        $('#srateanalrestable').show();
    }
    expandResSubTr(trName, aLink);
}
function printtable() {
    var pageTitle = 'Page Title',
        stylesheet = '//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css',
        win = window.open('', 'Print', 'width=500,height=300');
    win.document.write('<html><head><title>' + pageTitle + '</title>' +
    '<link rel="stylesheet" href="' + stylesheet + '">' +
    '</head><body>' + $('#sample12')[0].innerHTML + '</body></html>');
    win.document.close();
    win.print();
    win.close();
}
function nextiow() {
    var rows = $("#grid").jqxGrid('getrows');
    var id = "";
    for (var m = 0; m < rows.length; m++) {
        var row = $("#grid").jqxGrid('getrowdata', m);
        if (row.available==true) {
            id=id + row.IOWId + ',';
        }
    }
    if (id.length ==0)
        return;

    id = id.slice(0,-1);
    $.post(getBaseURL() + 'project/rfc/getiowedit', {ids: id}, function (data) {
        var obj = jQuery.parseJSON(data);
        var objT =obj['trans'];
        var sOldid = "_1";
        var iRowId=0;
        for (i = 0; i < objT.length; i++) {
            var ioRowId =  iRowId;
            iRowId = +iRowId + 1;
            if (iRowId !=1) {
                var snid = 'IOWiRowId_' + iRowId;
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId != 1) {
                    ioRowId = (ioRowId * 2) - 1;
                }
                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
            }

            $('#rowid').val(iRowId);
            $('#groupid_'+iRowId).val(objT[i].WorkGroupId);
            $('#parentid_'+iRowId).val(objT[i].ParentId);
            $('#refserialno_'+iRowId).val(objT[i].RefSerialNo);
            $('#serialno_'+iRowId).val(objT[i].SerialNo);
            $('#spec_'+iRowId).val(objT[i].Specification);
            $('#unitid_'+iRowId).val(objT[i].UnitId);
        }
    });


    $('#next-btn').hide();
    $('#submit-btn').show();
    $('#back-btn').show();

    $('#edit-list').hide();
    $('#edit-content').show();
}
function AddNewRowA(id) {
    var iRowId = $('#rowid').val(),
        key =   id.split('_')[1];
    if($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;
    if ($('#parentid_' + iRowId).length !=0) {
        if ($('#parentid_' + iRowId).val().length == 0) return;
        if ($('#serialno_' + iRowId).val().length == 0) return;
        if ($('#spec_' + iRowId).val().length == 0) return;
        // if ($('#unitkeyid_' + iRowId).val().length == 0 || $('#unitkeyid_' + iRowId).val() == 0) return;
    }
    var ioRowId =  iRowId;
    iRowId = +iRowId + 1;
    var snid = 'IOWiRowId_'+iRowId,
        sStr = $('#dummytable tbody').html();
    sStr = sStr.replace(/__1/g,'_'+ iRowId);
    sStr = sStr.replace(/__9/g,'_1');
    //if (ioRowId != 1) {ioRowId = (ioRowId*2)-1 ;}
    $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
    $('#rowrefid_' + iRowId).val(iRowId);
    $('#rowid').val(iRowId);
    checkResource(iRowId,"");
    checkResource(iRowId,"R");
    closedetails();
    bindAutoComplete();
    bindResourceAutoComplete();
    expandTrFn(true);
//    bindTRDeleteFn(true);
    bindMixSortablefn(true);
    $('.mainTrDelete_' + key).show(); // show delete icon
    var aSNo = $('#parentkeyid_' +key).val().split('.');
    if (aSNo.length >0) GetWorkGroupDetails( isNullCheck(aSNo[0],'number'),id);
}
var fixHelperModified = function(e, tr) {
        var $originals = tr.children();
        var $helper = tr.clone();
        $helper.children().each(function(index) {
            $(this).width($originals.eq(index).width())
        });
        return $helper;
    },
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };
function AddNewRowRes(key1) {
    var sRow = '#rowinfoid_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanal_'+key1+'_resdel_' + irowinfoId).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#rateanal_'+key1 + '_restable';
    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
    $('#rateanal_' + key1 + '_refid_' + irowinfoId).val(irowinfoId);
    checkResource(key1,"");
    bindResourceAutoComplete();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrder(key1);
    return true;
}
function AddNewRowIOW() {
    var sRow = '#rowinfoid_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrder(iFocusRowId);
    $(sRow).val(irowinfoId);
}
function AddNewRowIOWR() {
    var sRow = '#rowinfoidR_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanalR_'+iFocusRowId + 'restable';
    var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrderR(iFocusRowId);
    $(sRow).val(irowinfoId);
}
function AddNewRowResHeader(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3];
    irowinfoId = iARowid;
    var sValue = $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanal_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#rateanal_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val("");
    var sRow = '#rowinfoid_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
}
function AddNewRowResHeaderR(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3];
    irowinfoId = iARowid;
    var sValue = $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanalR_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#rateanalR_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val("");
    var sRow = '#rowinfoidR_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
}
function closeactivity() {
    $('#resactvity').remove();
}
function AddNewRowjResR(key1) {
    var sRow = '#rowinfoidR_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanalR_'+key1+'_resdel_' + irowinfoId).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#rateanalR_'+key1 + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody.sorting > tr:last-child").after(sStr);
    $('#rateanalR_' + key1 + '_refid_' + irowinfoId).val(irowinfoId);
    checkResource(key1,"R");
    bindResourceAutoComplete();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrderR(key1);
}
//function ValueChange(x) {
//    var iARowid = x.split("_")[3],
//        iFocusRowId=x.split("_")[1],
//        name = '#rateanal_' + iFocusRowId,
//        iRows = $('#rowinfoid_' + iFocusRowId).val(),
//        sname = x.split("_")[0];
//    if (sname.substr(sname.length-1) ==  "R") {
//        name = '#rateanalR_' + iFocusRowId;
//        iRows = $('#rowinfoidR_' + iFocusRowId).val();
//    }
//    var dQty =  parseFloat(isNullCheck($(name + "_resqty_" + iARowid).val(),'number')),
//        dRate = parseFloat(isNullCheck($(name + "_resrate_" + iARowid).val(),'number')),
//        dAmt = dQty*dRate;
//    $(name + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        if ($(name + '_inc_' + i).is(':checked') == true) {
//            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number'));
//            dTAmt = dTAmt + val;
//        }
//    }
//    $(name + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
//    var dNetRate = dTAmt/dAnalQty;
//    $(name + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $(name + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    else {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_netrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    }
//    $('#rate_'+ iFocusRowId).val(dFRate);
//}
function CalculateFull() {
    //SiteMix
    var iRows = $('#rowinfoid_' + iFocusRowId).val();
    var dTAmt = 0;
    for (i = 1; i <= iRows; i++) {
        var dAmt = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat( isNullCheck( $("#rateanal_" + iFocusRowId + "_resrate_" + i).val(),'number'));
        $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
        if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
    }
    $('#rateanal_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
    var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0)  { dAnalQty = 1; $('#rateanal_' + iFocusRowId + '_AnalQty').val(dAnalQty); }
    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
    $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
    $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
    var dNetRate = dTAmt/dAnalQty;
    $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
    $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    //Readymix
    var iRows = $('#rowinfoidR_' + iFocusRowId).val();
    var dTAmt = 0;
    for (i = 1; i <= iRows; i++) {
        var dAmt = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resrate_" + i).val(),'number'));
        $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
        if ($('#rateanalR_' + iFocusRowId + 'inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat( isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
    }
    $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
    var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0) { dAnalQty = 1; $('#rateanalR_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
    $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
    $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
    var dNetRate = dTAmt/dAnalQty;
    $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
    $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    var dFRate=0;
    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val()));
    else  {
        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_netrate').val(),'number'));
        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
    }
//    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
}
//function ChangeIOWs(x) {
//    closedetails();
//    var iARowid = x.split("_")[1];
//    if ($('#unitid_'+iARowid).val().length >0) {
//        $('#but_'+iARowid).prop('disabled', false);
//        $('#rate_'+iARowid).prop('readonly', false);
//    } else {
//        $('#unitid_'+iARowid).val(0);
//        $('#but_'+iARowid).prop('disabled', true);
//        $('#rate_'+iARowid).prop('readonly', true);
//    }
//}
function CheckSerialNo(x) {
    var iARowid = x.split("_")[1],
        iParentkeyId = $('#parentkeyid_' + iARowid).val(),
        sRefSlNo =  $('#refserialno_' + iARowid).val().trim(),
        sSlNo =  $('#serialno_' + iARowid).val().trim();
    $.post( getBaseURL() + 'project/rfc/checkserialfound', {serialno:sSlNo}, function( data ) {
        if (data == "Y") {
            var $refserialno = $('#refserialno_' + iARowid);
            $refserialno.addClass('error').attr('data-original-title', 'Serial no. already used').attr('data-toggle', 'tooltip');
            $refserialno.tooltip();
            $('#serialno_' + iARowid).val("");
            return;
        }
    });
    var irows = $('#sample12 tr').length-1;
    for (i = 1; i <= irows; i++) {
        $('#refserialno_' + iARowid).removeClass('error');
        if (i != iARowid) {
            if (iParentkeyId ==  $('#parentkeyid_' + i).val()) {
                if (sRefSlNo == $('#refserialno_' + i).val().trim()) {
                    var $refserialno = $('#refserialno_' + iARowid);
                    $refserialno.addClass('error').attr('data-original-title', 'Serial no. already used').attr('data-toggle', 'tooltip');
                    $refserialno.tooltip();
                    $('#serialno_' + iARowid).val("");
                    break;
                }
            }
        }
    }
}
//function SerialUpdate(x) {
//    var sStr = x.split("_"),
//        iARowid = sStr[1],
//        sParent = 'parentid_'+iARowid,
//        sParentText =  $('#' + sParent).val(),
//        aSerialNo = sParentText.split(" "),
//        sSerialNo = aSerialNo[0],
//        aSNo = sSerialNo.split('.');
//    if (aSNo[1] == "0") sSerialNo = aSNo[0];
//    if ($('#refserialno_' + iARowid).val() != ""  && $('#parentid_'+ iARowid).val().length>0) {
//        var sSerialNo = sSerialNo + '.' + $('#refserialno_' + iARowid).val();
//        $('#serialno_' + iARowid).val(sSerialNo);
//    } else $('#serialno_' + iARowid).val("");
//    var sField = sStr[0];
//    if (sField == "parentid") {
//        if (aSNo[0] != 'Add') {GetWorkGroupDetails(iWGId,x)}
//    }
//    CheckSerialNo(x);
//}
function cboIOWChanged(ival,ifRowid, iARowid,itype) {
    iFocusRowId = ifRowid;
    var name = "rateanal_";
    if (itype == "R") name = "rateanalR_";
    $.ajax({
        url: getBaseURL() + "project/rfc/getiowunit/"+ival,
        async: false,
        type: 'post',
        success: function(data,status) {
            var obj = jQuery.parseJSON(data);
            var objD = obj['details'];
            var objT = obj['trans'];
            var objA = obj['activity'];
            $("label[for='" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
            var dIRate=0;
            if (objT['MixType'] == "R")  dIRate= parseFloat(objT['RRate']);
            else dIRate= parseFloat(objT['SRate']);
            $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dIRate,2,true));
            var objF = $.grep(arrSubIOW, function (element, index) {
                return element.subiowid == ival;
            });
            if  (objF.length ==0) {
                arrSubIOW.push({
                    subiowid: ival,
                    mixtype: objT['MixType'],
                    srate: objT['SRate'],
                    rrate: objT['RRate'],
                    workingqty: objT['WorkingQty'],
                    cementratio: objT['CementRatio'],
                    metailratio: objT['MetalRatio'],
                    sandratio: objT['SandRatio'],
                    thickqty: objT['ThickQty'],
                    rworkingQty: objT['RWorkingQty']
                });
                for (j = 0; j < objA.length; j++) {
                    var irows = $('#resourcerate tr').length;
                    var bFound=false;
                    var iResid = objA[j]['ResourceId'];
                    var dRate=parseFloat(objA[j]['Rate']);
                    for (i = 1; i <= irows; i++) {
                        if ($('#rateresid_' + i).val == iResid) {
                            bFound = true;
                            dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
                            break;
                        }
                    }
//                    if (bFound==false) { RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid); }
                    arrSubIOWAnal.push({
                        subiowid: ival,
                        mixtype: objA[j]['MixType'],
                        includeflag: objA[j]['IncludeFlag'],
                        referenceid: objA[j]['ReferenceId'],
                        code: objA[j]['Code'],
                        resourcename: objA[j]['ResourceName'],
                        unitname: objA[j]['UnitName'],
                        resourceid: objA[j]['ResourceId'],
                        qty: objA[j]['Qty'],
                        rate: objA[j]['Rate'],
                        amount: parseFloat(objA[j]['Qty'])*dRate,
                        formula: objA[j]['Formula']
                    });
                }
            }
        }
    });
}

function cboResChanged(ival,ifRowid, iARowid,rtype) {
    iFocusRowId=ifRowid;
    if (ival.trim() !='') {
//        var irows = $('#resourcerate tr').length;
        var bFound=false;
        var dRate=0;
        var $resid = $('input[id^=rateresid_]');
        $.each($resid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var ickey = isNullCheck(name.split('_')[1],'number');
            if (ickey !=0) {
                if ($('#rateresid_' + i).val() == ival) {
                    bFound = true;
                    dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(), 'number'));
                    return;
                }
            }
        });
        var name = "rateanal_";
        if (rtype == "R") name = "rateanalR_";
        $.ajax({
            url: getBaseURL() + "project/rfc/getresourceunit/"+ival,
            async: false,
            async: false,
            type: 'post',
            success: function(data,status) {
                var obj = jQuery.parseJSON(data);
                var objD = obj['details'];
                var objT = obj['trans'];
                var objA = obj['activity'];
                $("label[for= '" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
                $("#" + name + iFocusRowId + "_restypeid_" + iARowid).val(objD[0].TypeId);
                if (bFound == true) $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dRate,2,true));
                else {
                    $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(objD[0].Rate,2,true));
                    var resName = $("#" + name + iFocusRowId + "_resid_" + iARowid).val();
//                    RateResourceUpdate(resName, objD[0].UnitName, parseFloat(objD[0].Rate), ival)
                }
                var objF = $.grep(arrActivityRes, function (element, index) {
                    return element.activityid == ival;
                });
                if  (objF.length ==0 && objD[0].TypeId==4) {
                    arrActivityRes.push({
                        activityid: ival,
                        ratetype: objT['RateType'],
                        lRate: objT['LRate'],
                        mRate: objT['MRate'],
                        aRate: objT['MRate'],
                        analysisMQty: objT['AnalysisMQty'],
                        analysisAQty: objT['AnalysisAQty']
                    });
                    for (j = 0; j < objA.length; j++) {
                        var iResid = objA[j]['ResourceId'];
                        bFound=false;
                        dRate=objA[j]['Rate'];
                        $.each($resid, function (i, obj) {
                            var $this = $(this),
                                name = $this[0].id;
                            var ickey = isNullCheck(name.split('_')[1],'number');
                            if (ickey !=0) {
                                if ($('#rateresid_' + i).val() == iResid) {
                                    bFound = true;
                                    dRate = isNullCheck($('#rateresrate_' + i).val(), 'number');
                                    return;
                                }
                            }
                        });
//                        if (bFound==false)  RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid);
                        arrActivityAnal.push({
                            activityid: ival,
                            activitytype: objA[j]['ActivityType'],
                            resourceid: objA[j]['ResourceId'],
                            resourcename: objA[j]['ResourceName'],
                            unitname: objA[j]['UnitName'],
                            qty: objA[j]['Qty'],
                            rate: dRate,
                            amount: parseFloat(objA[j]['Qty'])*dRate
                        });
                    }
                }
            }
        });
    }
}
function clickbut(x) {
    iARowId = x.split("_")[1];
    if ($('.subTr_' + iARowId).is(':visible')) return;
    $('.mainTr_' + iARowId).trigger('click');
}
function validateRow(x) {
    iARowId = x.split("_")[1];
    var scurId = "_" + iARowId,
        sparentId = $('#parentkeyid' + scurId).val(),
//        $sparentId = $('#parentid' + scurId),
//        $sserialno = $('#serialno' + scurId),
        $sspec = $('#spec' + scurId),
        sUnit = $('#unitkeyid' + scurId).val();
//    if (sparentId.length==0) {
//        //alert("Parent Not Selected");
//        $sparentId.focus();
//        return false;
//    } else if($sserialno.val().length==0) {
//        alert("Serial No is Empty");
//        $sserialno.focus();
//        return false;
    if($sspec.val().length==0) {
        alert("Specification is Empty");
        $sspec.focus();
        return false;
    } else if(sUnit.length==0 || sUnit==0) {
        alert("Unit Not Selected");
        $('#unitid' + scurId).focus();
        return false;
    }
//    $sparentId.prop('readonly', true);
    bSiteMix = true;
    CheckShowDetails();
    CalculateFull();
    return true;
}
function CheckShowDetails() {
    if ($('#concrete_' + iFocusRowId).is(':checked') == false) $('#ramixtable'+'_'+iFocusRowId).hide();
    else $('#ramixtable_'+'_'+iFocusRowId).show();
}
function closedetails(key) {
    var $mainTRs = $("a[class*=mainTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}
function IOWUpdate() {
    if (excelSheetValid()==false) {
        alert("Invalid Sheet");
        return;
    }
    var iMRowId = $('#rowid').val();
    ioRowId = iMRowId;
    var iRowTransId=1;
    //var irows = $('#excelTable tr').length-1;
    var $excelpids = $('input[id^=excelparentid_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        //for (i = 1; i <= irows; i++) {
        if ($('#excelrowtype_'+key1).val() == "I") {
            ioRowId = iMRowId;
            if ($('#spec_' + iMRowId).val() != "")  iMRowId = + iMRowId+1;
            if (iMRowId !=1) {
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId !=1) {ioRowId = (ioRowId*2)-1 ;}
                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
            }
            var pId =$("#excelwgid_"+key1).val();
            if ($("#excelparentid_"+key1).val() !=0) pId = pId + "." + $("#excelparentid_"+key1).val();
            $('#parentkeyid_' + iMRowId).val(pId);
            $('#refserialno_' + iMRowId).val($('#excelrefslno_'+key1).val());
            $('#serialno_' + iMRowId).val($('#excelserialno_'+ key1).val());
            $('#spec_' + iMRowId).val($('#excelspec_'+ key1).val());
            $('#unitid_' + iMRowId).val($('#excelunit_'+ key1).val());
            $('#unitkeyid_' + iMRowId).val($('#excelunitid_'+ key1).val());
            $('#parentid_' + iMRowId).val($('#excelparentspec_'+ key1).val());

            $('#rowid').val(iMRowId);
            iRowTransId=1;
        } else {
            if (iRowTransId!=1) {
                var stabelrow = '#rateanal_' + iMRowId + '_restable';
                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_' + iRowTransId);
                sStr = sStr.replace(/R1/g, 'R' + iRowTransId);
                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                //$(stabelrow+" tbody tr:nth-child(" + (iRowTransId - 1) + ")").after(sStr);
                $('#rateanal_' + iMRowId + '_refid_' + iRowTransId).val(iRowTransId);
            }
            $('#rateanal_' + iMRowId + '_code_' + iRowTransId).val($('#excelcode_' + key1).val());
            $('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId).val($('#excelresid_' + key1).val());
            $('#rateanal_' + iMRowId + '_resqty_' + iRowTransId).val($('#excelqty_' + key1).val());
            $('#rateanal_' + iMRowId + '_resunit_' + iRowTransId).val($('#excelunit_' + key1).val());
            $('#rateanal_' + iMRowId + '_resrate_' + iRowTransId).val($('#excelrate_' + key1).val());
            $('#rateanal_' + iMRowId + '_resamt_' + iRowTransId).val($('#excelamount_' + key1).val());
            $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).val($('#excelparentspec_'+ key1).val());
            if (isNullCheck($('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId),'number') !=0) $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).prop('readonly', true);

            $('#rowinfoid_' + iMRowId).val(iRowTransId);
            SortOrder(iMRowId);
            iRowTransId = +iRowTransId+1;
        }
    });
    bindAutoComplete();
    bindResourceAutoComplete();
    expandTrFn(true);
//    bindTRDeleteFn(true);
    bindMixSortablefn(true);
    $('#excelmodal').modal('toggle');
}

function fileupload(x) {
    var isValid=true;
    var $excelpids = $('input[id^=field_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#field_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    if (isValid==false) {alert ("Please Assign Fields Correctly"); return;}

    $("#excelfieldmodal").modal('hide');
    var bValid=true;
    var arrHeader =[];
    for (var i = 0; i < $("#excelfieldTable").find("th").length; i++) {
        arrHeader.push({efield: $('#efield_'+i).val(), field: $('#field_'+i).val()});
    }
    arrHeader =  JSON.stringify(arrHeader);
    formData.append('arrHeader', arrHeader);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() + "project/rfc/uploadiow",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);
            var key1=1;
            if (obj[0].Valid==true) {
                $('#excelTable tr:gt(1)').remove();
                var $excelpids = $('input[id^=excelserialno_]');
                $.each($excelpids, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    key1 = name.split('_')[1];
                });
                var irow = key1;

                $("#excelserialno_" + irow).val('');
                $("#excelcode_" + irow).val('');
                $("#excelspec_" + irow).val('');
                $("#exceliows_" + irow).val('');
                $("#excelunit_" + irow).val('');
                $("#excelqty_" + irow).val('');
                $("#excelrate_" + irow).val('');
                $("#excelamount_" + irow).val('');
                $("#excelrefslno_" + irow).val('');
                $("#excelrowtype_" + irow).val('');
                $("#exceliowid_" + irow).val('');
                $("#excelparentid_" + irow).val('');
                $("#excelwgid_" + irow).val('');
                $("#excelresid_" + irow).val('');
                $("#excelunitid_" + irow).val('');
                $("#excelparentspec_" + irow).val('');
                var sOldid = "_" + key1;
                for (i = 0; i < obj.length; i++) {
                    if (irow != key1)  {
                        $("#excelTable tbody tr:last").after('<tr>' + $("#excelTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("textarea").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                    }
                    bindExcelDeleteFn(true);
                    $("#excelserialno_" + irow).val(obj[i].SerialNo);
                    $("#excelcode_" + irow).val(obj[i].Code);
                    $("#excelspec_" + irow).val(obj[i].Specification);
                    $("#exceliows_" + irow).val(obj[i].IOWs);
                    $("#excelunit_" + irow).val(obj[i].UnitName);
                    $("#excelqty_" + irow).val(obj[i].Qty);
                    $("#excelrate_" + irow).val(obj[i].Rate);
                    $("#excelamount_" + irow).val(obj[i].Qty * obj[i].Rate);
                    $("#excelrefslno_" + irow).val(obj[i].RefSerialNo);
                    $("#excelrowtype_" + irow).val(obj[i].RowType);
                    $("#exceliowid_" + irow).val(obj[i].IOWId);
                    $("#excelparentid_" + irow).val(obj[i].ParentId);
                    $("#excelwgid_" + irow).val(obj[i].WGId);
                    $("#excelresid_" + irow).val(obj[i].ResourceId);
                    $("#excelunitid_" + irow).val(obj[i].UnitId);
                    $("#excelparentspec_" + irow).val(obj[i].ParentSpec);

                    irow = +irow + 1;
                }
            } else bValid=false;
            if (bValid==true) $("#excelmodal").modal('show');
            else  alert("Invalid File Format");
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400) alert(xhr.responseText);
            else alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));
    excelvalid();
}

function bindExcelDeleteFn(reset) {
    var $trDelete = $('a[class*=excelTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className;
        $this.on('click', function(e) {
            e.preventDefault();
            var ikey1=0;
            if (name.indexOf('__')  != -1) ikey1=1;
            else ikey1 = name.split('_')[1];
            if (isNullCheck($("#excelserialno_" + ikey1).val(),'string') != "") {
                var ikey2 = + ikey1+1;
                if ($("#excelcode_" + ikey2).length !=0) {
                    if (isNullCheck($("#excelcode_" + ikey2).val(),'string') != "") return;
                }
            }
            if (confirm('Do you want to Delete')) {
                var tr_length = $('#excelTable tr').length;
                if (tr_length ==2) {
                    var $excelpids = $('input[id*=excelserialno_]');
                    $.each($excelpids, function (i, obj) {
                        var $this = $(this),
                            name = $this[0].id;
                        var key1 = name.split('_')[1];
                        $("#excelserialno_" + key1).val('');
                        $("#excelcode_" + key1).val('');
                        $("#excelspec_" + key1).val('');
                        $("#exceliows_" + key1).val('');
                        $("#excelunit_" + key1).val('');
                        $("#excelqty_" + key1).val('');
                        $("#excelrate_" + key1).val('');
                        $("#excelamount_" + key1).val('');
                        $("#excelrefslno_" + key1).val('');
                        $("#excelrowtype_" + key1).val('');
                        $("#exceliowid_" + key1).val('');
                        $("#excelparentid_" + key1).val('');
                        $("#excelwgid_" + key1).val('');
                        $("#excelresid_" + key1).val('');
                        $("#excelunitid_" + key1).val('');
                        $("#excelparentspec_" + key1).val('');
                    });
                } else {
                    $this.closest('tr').remove();
                }
            }
            return false;
        });
    });
}
function formulacalculation() {
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            if  (bSiteMix==true) {
                var sCement = '#rateanal_' + iFocusRowId + '_AQty';
                var sSand = '#rateanal_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
                var sThick = '#rateanal_' + iFocusRowId + '_thick';
            } else {
                var sCement = '#rateanalR_' + iFocusRowId + '_AQty';
                var sSand = '#rateanalR_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanalR_' + iFocusRowId + '_CQty';
                var sThick = '#rateanalR_' + iFocusRowId + '_thick';
            }
            sformula = sformula.replace(/cement/g, $(sCement).val());
            sformula = sformula.replace(/sand/g, $(sSand).val());
            sformula = sformula.replace(/metal/g, $(sMetal).val());
            sformula = sformula.replace(/thick/g, $(sThick).val());
            if  (bSiteMix==true) {
                var rows = $('#rowinfoid_' + iFocusRowId).val();
                for (i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            } else {
                var rows = $('#rowinfoidR_' + iFocusRowId).val();
                for (i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            alert('Expression Invalid.');
        }
    }
    $("#formulavalue").val(sanitizeNumber(fvaule,3));
}
function showformulaR(x,bshow) {
    bSiteMix=false;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = $(sExp).val();
    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var rows = $('#rowinfoidR_' + iFocusRowId).val();
            for (i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            alert('Expression in invalid.');
        }
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    }


//    else {
//        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
//        if (stype=="R") {
////            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
////                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
//        }
//        else if (stype=="I") {
//            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
////                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
//        }
//    }
}
function showF(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }  else if (stype=="I"){
            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }
        event.preventDefault();
    }
}
function showFR(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        } else if (stype=="I"){
            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        }
        event.preventDefault();
    }
}
function showformula(x,bshow) {
    bSiteMix=true;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = $(sExp).val();
    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var sCement = '#rateanal_' + iFocusRowId + '_AQty';
            var sSand = '#rateanal_' + iFocusRowId + '_BQty';
            var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
            var sThick = '#rateanal_' + iFocusRowId + '_thick';
            sformula = sformula.replace(/cement/g, $(sCement).val());
            sformula = sformula.replace(/sand/g, $(sSand).val());
            sformula = sformula.replace(/metal/g, $(sMetal).val());
            sformula = sformula.replace(/thick/g, $(sThick).val());
            var rows = $('#rowinfoid_' + iFocusRowId).val();
            for (i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            //fvaule = eval(sformula);
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            res = 'Expression Invalid.';
            $('#btnformula').prop('disabled', true);
            alert(res);
        }
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    }

//    else {
//        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
//        if (stype=="R") {
//            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
////                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
//        }
//        else if (stype=="I") {
//            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
////                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
//        }
//    }
}
function formulaok() {
    if (bSiteMix == true) {
        var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanal_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanal_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));
        var iRows = $('#rowinfoid_' + iFocusRowId).val();
        var dTAmt = 0;
        for (i = 1; i <= iRows; i++) {
            if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        }
        $('#rateanal_' + iFocusRowId + 'totrate').val(sanitizeNumber(dTAmt,2,true));
        var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
        if (dAnalQty.length == 0 || dAnalQty == 0 || dAnalQty == "Working Qty") {
            dAnalQty = 1;
            $('#rateanal_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
        }
        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
        $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
        $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
        var dNetRate = dTAmt / dAnalQty;
        $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
        $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    } else {
        var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanalR_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanalR_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));
        var iRows = parseInt(isNullCheck($('#rowinfoidR_' + iFocusRowId).val(),'number'));
        var dTAmt = 0;
        for (i = 1; i <= iRows; i++) {
            if ($('#rateanalR_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        }
        $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
        var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
        if (dAnalQty.length == 0 || dAnalQty == 0) {
            dAnalQty = 1;
            $('#rateanalR_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
        }
        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
        $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + sanitizeNumber(dAnalQty,3) + ' ' + sUnit);
        $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
        var dNetRate = dTAmt / dAnalQty;
        $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
        $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    }
    $('#formula').hide();
}
function showAnalmix(sVal,y,e) {
    e.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="manual") {
        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();
    } else {
        $('#activitymanual').hide()
        $('#activityrestable').hide();
        $('#activitymachinery').show();
        $('#activityRrestable').show();
    }
    return false;
}
function showSubIOWMix(sVal,y,event) {
    event.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="sitemix") {
        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();
        $('#sraworktable').show();
        $('#srateanalrestable').show();
    } else {
        $('#sraworktable').hide();
        $('#srateanalrestable').hide();
        $('#sraworkRtable').show();
        $('#srateanalRrestable').show();
    }
    return false;
}
function showmix(x,y,event) {
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    iFocusRowId = y.split('_')[1];
    event.preventDefault();
    if (x=="readymix") {
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).hide();
        $('#rabuttable_'+iFocusRowId).hide();
        $('#rateanal_'+ iFocusRowId + '_restable').hide();
        $('#raworkRtable_'+iFocusRowId).show();
        $('#rabutRtable_'+iFocusRowId).show();
        $('#rateanalR_'+ iFocusRowId + '_restable').show();
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRR_'+iFocusRowId).prop("checked", true);
        bSiteMix=false;
    } else {
        $('#raworkRtable_'+iFocusRowId).hide();
        $('#rabutRtable_'+iFocusRowId).hide();
        $('#rateanalR_'+ iFocusRowId + '_restable').hide();
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).show();
        $('#rabuttable_'+iFocusRowId).show();
        $('#rateanal_'+ iFocusRowId + '_restable').show();
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSS_'+iFocusRowId).prop("checked", true);
        bSiteMix=true;
    }
}
function AddNewWorkGroup(x) {
    sWGUpdateMode='Add';
    $("#workgroupok").html('Create');
    $("#workgroupmodal").modal('show');
    $('.autocomplete-suggestions').hide();
    $('#workgroup').val($(x).val());
}
function ShowWorkGroup(id) {
    var irow = id.split('_')[1];
    sWGUpdateMode='Edit';
    $('#slno').val($('#newwgcode_'+ irow).val());
    $('#workgroup').val($('#newwgname_'+ irow).val());
    $('#worktype').val($('#newwgtypename_'+ irow).val());
    $('#worktype_id').val($('#newwgid_'+ irow).val());
    $('#create-activity').prop('checked', ($('#newwgactivity_'+ irow).val() == 1) ? true : false);
    $('#auto-generate-rate').prop('checked', ($('#newwgrateanal_'+ irow).val() == 1) ? true : false);
    $('#auto-res-create').prop('checked', ($('#newwgactivityres_'+ irow).val() == 1) ? true : false);
    var actTypeValue = $('#newwgresacttype_' + irow).val();
    // check and remove radio checked
    if (actTypeValue.length == 0) $('input[type=radio][name=resacttype]').removeAttr('checked');
    else $('input[type=radio][name=resacttype][value='+actTypeValue+']').prop('checked', true);
    $("#workgroupok").html('Save');
    $("#workgroupmodal").modal('show');
}
function ShowResource(id) {
    var irow = id.split('_')[1];
    $("#newresok").html('Save');
    sResUpdateMode='Edit';
    $('#resname').val($('#newresname_'+ irow).val());
    $('#resgroup').val($('#newresgroup_'+ irow).val());
    $('#resgroupid').val($('#newresgroupid_'+ irow).val());
    $('#restype').val($('#newrestype_'+ irow).val());
    $('#restypeid').val($('#newrestypeid_'+ irow).val());
    $('#resunit').val($('#newresunit_'+ irow).val());
    $('#resunitid').val($('#newresunitid_'+ irow).val());
    $('#resrate').val($('#newresrate_'+ irow).val());
    $("#resourcemodal").modal('show');
}
function AddNewResource(x) {
    sResUpdateMode='Add';
    $("#newresok").html('Create');
    $("#resourcemodal").modal('show');
    $('#refNewResRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#resname').val($(x).val());
//    $('#' + x.id).prop('readonly', false);
}

//function WorkGroupUpdate() {
//    if (sWGUpdateMode=='Add') {
//        var irows = $('#newwg tr').length;
//        var irow = irows-1;
//        if ((irow !=1) || ( irow==1 && $('#newwgname_1').val() !="")) {
//            irow = +irow+1;
//            var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
//            $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
//        }
//        $('#wgrowid').val(irow);
//    } else irow = $('#wgrowid').val();
//    $('#newwgcode_'+ irow).val($('#slno').val());
//    $('#newwgname_'+ irow).val($('#workgroup').val());
//    $('#newwgtypename_'+ irow).val($('#worktype').val());
//    $('#newwgid_'+ irow).val($('#worktype_id').val());
//    $('#newwgactivity_'+ irow).val(($('#create-activity').is(':checked')) ? 1 : 0);
//    $('#newwgrateanal_'+ irow).val(($('#auto-generate-rate').is(':checked')) ? 1 : 0);
//    $('#newwgactivityres_'+ irow).val(($('#auto-res-create').is(':checked')) ? 1 : 0);
//    $('#newwgresacttype_' + irow).val($('input[type=radio][name=resacttype]:checked').val());
//    $('#newitems').show();
//    $('#butnewitems').html("New Work Group Created" + "<span class='badge'> " + irow + "</span>").show();
//    var sWid = "0." + irow;
//    var sWSpec = 'New.' + irow + '   ' + $('#workgroup').val();
//    arryparentList.push({
//        data: sWid,
//        value: sWSpec
//    });
//}

//function SpecChange(id) {
//    var iRowId = $('#rowid').val(),
//        key =   id.split('_')[1];
//    if($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;
//    if ($('#parentid_' + iRowId).length !=0) {
//        if ($('#parentid_' + iRowId).val().length == 0) return;
//        if ($('#serialno_' + iRowId).val().length == 0) return;
//        if ($('#spec_' + iRowId).val().length == 0) return;
//        // if ($('#unitkeyid_' + iRowId).val().length == 0 || $('#unitkeyid_' + iRowId).val() == 0) return;
//    }
//    if (parseInt(isNullCheck($('#unitkeyid_' + iRowId).val(),'number')) == 0) {
//        var sSlNo = isNullCheck($('#serialno_' + iRowId).val(),'string');
//        var sSpec = isNullCheck($('#spec_' + iRowId).val(),'string');
//        ParentIOWUpdate(sSlNo,sSpec);
//    }
//    AddNewRowA(id);
//}

//function ParentIOWUpdate(slno,spec) {
//    var sWid = "0." + slno;
//    var sWSpec = 'New.' + slno + '   ' + spec;
//
//    arryparentList.push({
//        data: sWid,
//        value: sWSpec
//    });
//    console.log(arryparentList);
//}

//function RateResourceUpdate(resName,unit,rate,resId) {
//    var irow = 0;
//    var irows = $('#resourcerate tr').length;
//    irow = irows-1;
//    if ((irow !=1) || ( irow==1 && $('#rateresname_1').val() !="")) {
//        irow = +irow+1;
//        var html = $("#resourcerate tbody tr:first").html().replace(/_1/g, '_' + irow);
//        $("#resourcerate tbody tr:last").after("<tr>" + html + "</tr>");
//    }
//    $('#rateresname_'+ irow).val(resName);
//    $('#rateresunit_'+ irow).val(unit);
//    $('#rateresrate_'+ irow).val(rate);
//    $('#rateresoldrate_'+ irow).val(rate);
//    $('#rateresid_'+ irow).val(resId);
//    $('#newrateresource').show();
//    $('#butnewrateresource').html("Resource Involved" + "<span class='badge'> " + irow + "</span>").show();
//}
//function ResourceUpdate() {
//    var resname = $('#resname').val(),
//        resgroupid = $('#resgroupid').val(),
//        resgroup = $('#resgroup').val(),
//        resunit = $('#resunit').val(),
//        resunitid = $('#resunitid').val(),
//        restype = $('#restype').val(),
//        restypeid= $('#restypeid').val(),
//        resrate = $('#resrate').val();
//    var irow = 0;
//    if (sResUpdateMode=='Add') {
//        var irows = $('#newres tr').length;
//        irow = irows-1;
//        if ((irow !=1) || ( irow==1 && $('#newresname_1').val() !="")) {
//            irow = +irow+1;
//            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
//            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
//        }
//        $('#resrowid').val(irow);
//    } else irow = $('#resrowid').val();
//    $('#newresname_'+ irow).val(resname);
//    $('#newresgroup_'+ irow).val(resgroup);
//    $('#newresgroupid_'+ irow).val(resgroupid);
//    $('#newrestype_'+ irow).val(restype);
//    $('#newrestypeid_'+ irow).val(restypeid);
//    $('#newresunit_'+ irow).val(resunit);
//    $('#newresunitid_'+ irow).val(resunitid);
//    $('#newresrate_'+ irow).val(resrate);
//    $('#newresitems').show();
//    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();
//    var sWid = "0." + irow;
//    var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;
//    arrayreslist.push({
//        data: sWid,
//        value: sWSpec,
//        UnitName: resunit,
//        UnitId: resunitid,
//        Rate: resrate
//    });
//    var $newResRow = $('#' + $('#refNewResRowName').val()),
//        key = $newResRow[0].id.split('_');
//    if (sResUpdateMode=='Add') {
//        if (bSiteMix==true) $resname = $('#rateanal_' + key[1] + '_resid_' + key[3]);
//        else $resname = $('#rateanal_' + key[1] + '_resid_' + key[3]);
//        $resname.val('');
//        $resname.removeClass('error');
//        bindResRowAutoComplete($resname);
//    }
//    $newResRow.val(sWSpec);
//    $newResRow.trigger('focus');
//}
function CheckResourceFocus(x,restype) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkResource(key1,restype);
}
function checkResource(key1,restype) {
    iFocusRowId = key1;
    var $reskeyid ="";
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanalR_' + iFocusRowId + '_iowkeyid_]');
        arrayresR = arrayreslist;
        arrayresR = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(iowkeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanal_' + iFocusRowId + '_iowkeyid_]');
        arrayres = arrayreslist;
        arrayres = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    }
}
function checkIOWUsed(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoid_'+ iFocusRowId).val();
    for (i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanal_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanal_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanal_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
function checkIOWUsedR(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoidR_'+ iFocusRowId).val();
    for (i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanalR_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanalR_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanalR_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
//function entryValidate() {
//    var isValid = true,
//        $trIOW = $('tr[id*=IOWiRowId_]');
//    $.each($trIOW, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id,
//            key = name.split('_')[1];
//        if (name.indexOf('__') != -1) return;
//        if ($('#parentid_' + key).val().length==0 && $('#serialno_' + key).val().length==0 && $('#spec_' + key).val().length==0 && $('#unitid_' + key).val().length==0) return;
//        if ($('#parentid_' + key).val().length==0) {
//            isValid=false;
//            alert("Parent Not Selected");
//            $('#parentid_' + key).focus();
//            return;
//        } else if ($('#serialno_' + key).val().length==0) {
//            isValid = false;
//            alert("Serial No is Empty");
//            $('#refserialno_' + key).focus();
//            return;
//        } else if ($('#spec_' + key).val().length==0) {
//            isValid = false;
//            alert("Specification is Empty");
//            $('#spec_' + key).focus();
//            return;
//        } else if ($('#unitkeyid_' + key).val().length==0) {
//            isValid = false;
//            alert("Unit Not Selected");
//            $('#unitid_' + key).focus();
//            return;
//        }
//    });
//    return isValid;
//}
function MainRateUpdate(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iResId = $('#' + name + iFRowId + '_reskeyid_' + iTRowId).val();
    var rateInputs = $(x).parents('li').siblings('li').find('input[type=text]');
    var dRate = 0;
    if($('#' + x.id).val() == "M") { dRate = parseFloat(isNullCheck($(rateInputs[1]).val(),'number')); }
    else if($('#' + x.id).val() == "A") { dRate = parseFloat(isNullCheck($(rateInputs[2]).val(),'number')); }
    else { dRate = parseFloat(isNullCheck($(rateInputs[0]).val(),'number')); }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
//    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function MainRateUpdateIOW(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iiowId = $('#' + name + iFRowId + '_iowkeyid_' + iTRowId).val();
    var objAS = $.grep(arrSubIOW, function (element, index) {
        return element.subiowid == iiowId;
    });
    var dRate = 0;
    if (objAS.length >0) {
        if ($('#' + x.id).val() == "R") dRate = parseFloat(isNullCheck(objAS[0]["rrate"],'number'));
        else dRate = parseFloat(isNullCheck(objAS[0]["srate"],'number'));
    }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
//    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function isFormula(evt){
    return true;
}
function GetWorkGroupDetails(ival,x) {
    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0) {
        $.post( getBaseURL() + 'project/rfc/getworkgroupdetails', {resId:ival}, function( data ) {
            var obj = jQuery.parseJSON(data);
            var objT =obj['trans'];
            var objA=obj['anal'];
            var sStr = x.split("_");
            var iARowid = sStr[1];
            if (objT['ConcreteMix'] == 1) {
                $('#concrete_' + iARowid).prop("checked", true); $('#mixtab_' + iARowid).show();
                $('#rateanalR_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['RWorkingQty'],3));
            } else {
                $('#mixtab_' + iARowid).hide();
                $('#rateanalR_' + iARowid + '_AnalQty').hide();
            }
            $('#rateanal_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['WorkingQty'],3));
            $('#rateanal_' + iARowid + '_AQty').val(sanitizeNumber(objT['CementRatio'],3));
            $('#rateanal_' + iARowid + '_BQty').val(sanitizeNumber(objT['SandRatio'],3));
            $('#rateanal_' + iARowid + '_CQty').val(sanitizeNumber(objT['MetalRatio'],3));
            $('#rateanal_' + iARowid + '_thick').val(sanitizeNumber(objT['ThickQty'],3));
            if (objT['Cement'] == 1) { $('#rateanal_' + iARowid + 'AQty_li').show(); }
            else {$('#rateanal_' + iARowid + 'AQty_li').hide();}
            if (objT['Sand'] == 1) $('#rateanal_' + iARowid + 'BQty_li').show();
            else $('#rateanal_' + iARowid + 'BQty_li').hide();
            if (objT['Metal'] == 1)  $('#rateanal_' + iARowid + 'CQty_li').show();
            else  $('#rateanal_' + iARowid + 'CQty_li').hide();
            if (objT['Thickness'] == 1)  $('#rateanal_' + iARowid + 'thick_li').show();
            else $('#rateanal_' + iARowid + 'thick_li').hide();
            var objAS = $.grep(objA, function (element, index) {
                return element.Type != 'R';
            });
            var k = 0;
            for (j = 0; j < objAS.length; j++) {
                k = k + 1;
                var sRow = '#rowinfoid_' + iARowid;
                if (k != 1) {
                    var stabelrow = '#rateanal_' + iARowid + '_restable';
                    var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                    sStr = sStr.replace(/__1/g, '_' + iARowid);
                    sStr = sStr.replace(/__9/g, '_' + k);
                    sStr = sStr.replace(/R1/g, 'R' + k);
                    $(stabelrow + " tbody tr:last").after(sStr);
                    $('#rateanal_' + iARowid + '_refid_' + k).val(k);
                    SortOrder(iARowid);
                }
                if (objAS[j]['IncludeFlag'] == 1) $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
                else $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
                $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
                $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
                $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceId']);
                $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
                $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAS[j]['Qty'],3));
                $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'],2,true));
                $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['CFormula']);
                $(sRow).val(k);
            }
            var objAR = $.grep(objA, function (element, index) {
                return element.Type == 'R';
            });
            var k = 0;
            for (j = 0; j < objAR.length; j++) {
                k = k + 1;
                var sRow = '#rowinfoidR_' + iARowid;
                if (k != 1) {
                    var stabelrow = '#rateanalR_' + iARowid + '_restable';
                    var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                    sStr = sStr.replace(/__1/g, '_' + iARowid);
                    sStr = sStr.replace(/__9/g, '_' + k);
                    sStr = sStr.replace(/R1/g, 'R' + k);
                    $(stabelrow + " tbody tr:last").after(sStr);
                    $('#rateanalR_' + iARowid + '_refid_' + k).val(k);
                    SortOrderR(iARowid);
                }
                if (objAR[j]['IncludeFlag'] == 1) $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
                else $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
                $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
                $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceId']);
                $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);
                $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAR[j]['Qty'],3));
                $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'],2,true));
                $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['CFormula']);
                $(sRow).val(k);
            }
        });
    }
}
$(function() {
    $(document).keydown(function(event) {
        if(event.keyCode == 13) event.preventDefault();
        else if(event.ctrlKey && event.keyCode == 78) {
            $("#addbut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 83) {
            $("#donebut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 82) {
            if (bSiteMix == true){$("#butresadd").trigger("click");}
            else{$("#butresRadd").trigger("click");}
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 67) {
            if (bSiteMix==true){var iRows = $('#rowinfoid_' + iFocusRowId).val();}
            else {var iRows = $('#rowinfoidR_' + iFocusRowId).val();}
            var arr= [];
            var k=0;
            for (i = 1; i <= iRows; i++) {
                if (bSiteMix ==true) var sTable = '#rateanal_' + iFocusRowId + '_RowId_' + i;
                else var sTable = '#rateanalR_' + iFocusRowId + '_RowId_' + i;
                if ($(sTable).hasClass('selected') == true) {
                    if (bSiteMix ==true) {
                        arr.push({
                            inc: $('#rateanal_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanal_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanal_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanal_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanal_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanal_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanal_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanal_' + iFocusRowId + '_formula_' + i).val()
                        });
                    } else {
                        arr.push({
                            inc: $('#rateanalR_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanalR_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanalR_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanalR_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanalR_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanalR_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanalR_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanalR_' + iFocusRowId + '_formula_' + i).val()
                        });
                    }
                }
            }
            if (arr.length >0) {
                $.post(getBaseURL() + 'project/rfc/UpdateCopyAnalysis', {ids: arr}, function (data) {
                    //alert (data);
                });
            }
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 86) {
            $.post(getBaseURL() + 'project/rfc/GetCopyAnalysis', {ids: arr}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (bSiteMix==true) {
                    var irowinfoId = $('#rowinfoid_' + iFocusRowId).val();
                    for (i = 0; i < obj.length; i++) {
                        if ($('#rateanal_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoid_' + iFocusRowId).val(irowinfoId);
                            SortOrder(iFocusRowId);
                        }
                        $('#rateanal_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanal_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanal_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanal_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanal_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanal_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanal_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanal_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanal_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                } else {
                    var irowinfoId = $('#rowinfoidR_' + iFocusRowId).val();
                    for (i = 0; i < obj.length; i++) {
                        if ($('#rateanalR_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanalR_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoidR_' + iFocusRowId).val(irowinfoId);
                            SortOrderR(iFocusRowId);
                        }
                        $('#rateanalR_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanalR_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanalR_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanalR_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanalR_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanalR_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanalR_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanalR_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanalR_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                }
            });
        }
    });
    bindExcelDeleteFn();
});
function excelvalid() {
    var $excelslnos = $('input[id^=excelserialno_]');
    $.each($excelslnos, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = name.split('_')[1];
        if (isNullCheck($("#excelserialno_" + ikey).val(), 'string') != "") {
            if (isNullCheck($("#excelwgid_" + ikey).val(), 'number') == 0)  $('#excelserialno_' + ikey).addClass('error');
            else $('#excelserialno_' + ikey).prop('readonly',true);
            if (isNullCheck($("#excelunitid_" + ikey).val(), 'number') == 0)  $('#excelunit_' + ikey).addClass('error');
            else $('#excelunit_' + ikey).prop('readonly',true);
            $('#excelcode_' + ikey).prop('readonly',true);
        }
        if (isNullCheck($("#excelcode_" + ikey).val(), 'string') != "") {
            if (isNullCheck($("#excelresid_" + ikey).val(), 'number') == 0)  $('#excelcode_' + ikey).addClass('error');
            else $('#excelcode_' + ikey).prop('readonly',true);
            $('#excelunit_' + ikey).prop('readonly',true);
            $('#excelserialno_' + ikey).prop('readonly',true);
        }
    });
}
function excelSheetValid() {
    var isValid=true;
    var $excelpids = $('input[id^=excelserialno_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#excelserialno_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelcode_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelunit_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    return isValid;
}
function excelRowvalid(irowId) {
    var ikey = irowId;
    if ($('#excelserialno_' + ikey).hasClass('error')) $("#excelserialno_" + ikey).prop('readonly', false);
    else $("#excelserialno_" + ikey).prop('readonly', true);
    if ($('#excelcode_' + ikey).hasClass('error')) $("#excelcode_" + ikey).prop('readonly', false);
    else $("#excelcode_" + ikey).prop('readonly', true);
    if ($('#excelunit_' + ikey).hasClass('error')) $("#excelunit_" + ikey).prop('readonly', false);
    else $("#excelunit_" + ikey).prop('readonly', true);
}
function excelUnitFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelunit_' + key).hasClass('error')) $('#excelunit_' + key).addClass('error').attr('data-original-title', 'Invalid unit').attr('data-toggle', 'tooltip');
}
function excelUnitvalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelunit_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkunitfound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelunit_' + key).addClass('error');
        else {
            $('#excelunitid_' + key).val(iPId);
            $('#excelunit_' + key).removeClass('error');
        }
    }
}
function getexcelfield(x) {
    var bValid=true;

    bExcelParent = false;
    bExcelType = false;
    bExcelCode = false;
    bExcelResGroup = false;

    formData = new FormData();
    formData.append('file', $('#myfile').prop("files")[0]);
    $.ajax({
        url: getBaseURL() +"project/rfc/getrgfielddata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);

            $("#excelfieldTable").find("th").remove();
            $("#excelfieldTable").find("td").remove();
            //$("#excelfield").find("td").remove();

            var sStr="Select Field";
            for (var i = 0; i < obj.length; i++) {
                $("#excelfieldTable").append('<tr><th width="20%"><input id="efield_'+i+'" class="text-reon text-right" type="text" value="'+obj[i]['Field']+'" style="background: transparent;"/></th><td width="70%"><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td></tr>');
                //$("#excelfield").append('<td><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td>');
                $('#efield_'+i).prop('readonly', true);

                if (obj[i]['Field'].trim().toUpperCase() == 'SERIALNO') { $('#field_'+i).val('SerialNo'); bExcelSNo=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'CODE') { $('#field_'+i).val('Code'); bExcelCode=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'SPECIFICATION') { $('#field_'+i).val('Specification'); bExcelSpec=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'UNIT') { $('#field_'+i).val('Unit'); bExcelUnit=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'QTY') { $('#field_'+i).val('Qty'); bExcelQty=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE') { $('#field_'+i).val('Rate'); bExcelRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'AMOUNT') { $('#field_'+i).val('Amount'); bExcelAmount=true;}
            }

            bindexcelFieldComplete();
            $("#excelfieldmodal").modal('show');
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));
}

function bindexcelFieldComplete() {
    var $excelfield = $('input[id^=field_]');
    $excelfield.unbind('autocomplete');
    $.each($excelfield, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkexcelFieldUsed(key1);
        $this.autocomplete({
            lookup: arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) removeError($(this));
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) showError($(this), 'Invalid');
                else removeError($(this));
            }
        });
    });
}

function clearInputFile(file){
    var f = file[0];
    if(f.value){
        try{
            f.value = '';
        }catch(err){ }
        if(f.value){
            var form = document.createElement('form'),
                parentNode = f.parentNode, ref = f.nextSibling;
            form.appendChild(f);
            form.reset();
            parentNode.insertBefore(f,ref);
        }
    }
}

function checkexcelFieldFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkexcelFieldUsed(key1);
}
function checkexcelFieldUsed(id) {
    var reskeyid = $('input[id*=field_]');
    arrayFieldR = arrayField;
    arrayFieldR= $.grep(arrayField, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.value == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}
</script>