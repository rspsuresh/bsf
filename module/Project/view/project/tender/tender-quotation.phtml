<!--STYLE-->
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqwidgets/jqxgrid.aggregates.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/amcharts/amcharts.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/amcharts/pie.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/amcharts/serial.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/amcharts/themes/light.js"></script>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<!--STYLE-->
<style>
    .bk_inpt1{width:150px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;background:none}
    .tagcrd{margin-bottom:0}
    .popuptable table tr th					{background:#E2EBEF!important;padding:5px;border-right:2px solid #5D9BB6;}
    .popuptable table tr th input[type=text]{ font-size:14px; font-weight:600; color:#333}
    .docu-spc 								{float:left;height:34px;overflow:hidden;width:100%;}
    .popuptable table tr tr					{border-bottom:1px solid #dcdbdb; width:100%;}
    .popuptable table						{border:1px solid #c2c2c2;}
    .expandDiv{overflow:visible !important;}
    .expandDiv > .docu-spc {height: auto !important;}
    .expandDivn > .docu-spcn {height: auto !important;}
    .row_header input[type=text] {font-weight:600 !important; font-size:15px !important; border:none !important; color: #015de6;}
    .row_specheader input[type=text],.row_specheader textarea {font-weight:600 !important; font-size:15px !important; color: #015de6;}
    .perAmtSpan								{display: inline-block;margin-top: 10px;width: 20%;float: right;padding-left: 8px;}
    #datagrid .jqx-grid-header 	{ height:75px !important;}
    .modal-lg1{width:1040px}
    .font-icon{ position: relative;}
    .print-icon {color: #E01488; font-size: 18px;padding:14px 0 0 15px;position: absolute; top:-3px;right: 0;background:#EDD8E4; border:1px solid #CC78A8;width:50px;height:50px; border-radius:50px;}
    #chart1 {width:100%;height:350px;font-size:10px;overflow:hidden!important;}
    #chart2 {width:100%;height:240px;font-size:10px;overflow:hidden!important;}
    #datagrid .jqx-grid-cell{font-size:12px;}
    #datagrid .jqx-grid-header{font-size:12px;}
    #datagrid1 .jqx-grid-cell{font-size:13px;}
    #datagrid1 .jqx-grid-header{font-size:12px;}
    #datagrid2 .jqx-grid-cell{font-size:13px;}
    #datagrid2 .jqx-grid-header{font-size:13px;}
    #iowtree .jqx-grid-header{ height:75px !important;font-size:12px;}
    #iowtree .jqx-checkbox {border:1px solid;}
    .lstatea ul li label{display:block}
    .lstatea ul li input[type="text"]{width:130px;margin-right: 10px;}
    .step_by_liner{height:7px; background-image: -webkit-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -moz-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -ms-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: -o-linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);
        background-image: linear-gradient(top, #F2F2F2 0%, #E3E3E3 100%);top:39px}
    .step_by li .step_by_sep p {margin:-4px 5px 0 0;line-height: 14px;transform: rotate(-45deg) !important;}
    .step_by li .step_by_sep{border-radius: 100px 100px 0px 100px; -webkit-transform: rotate(45deg); -moz-transform: rotate(45deg);transform: rotate(45deg) !important;margin-top:10px;width:25px;height:25px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);}
    .model-middle{padding:0}
    .cnt_slider{padding-top:0 !important}
    .step_by{margin:0 auto}
    .cnt_slider .carousel-inner,.cnt_slider{margin:0; padding:0;min-height:auto}
    .cnt_slider .carousel-inner .item{min-height:auto; width:100%;float:left;padding-top:0}
    .cnt_slider{border:none !important;padding:0 20px 20px 20px}
    .carousel-control{ position: inherit;}
    .stepby_mb23{left:15%}
    .step_by li {width:11.11%}
    .h1-head{text-align:center; font-size:22px; margin:15px 0;line-height:35px;}
    .excel1 td input{ font-size: 14px !important;font-weight: 700 !important; }
    .excel2 td input{ font-size: 13px !important;font-weight: 700 !important; }
    .excel3 td input{ font-size: 12px !important;font-weight: 700 !important; }
    .excel4 td input{ font:Italic normal 12px/15px "roboto"; font-size: 12px !important;}
    .excelvalid { background:#D8F0C2; border: 1px solid #d9d782;}
    .ad-btn{background:#3399ff; text-shadow: 0 0 1px #546082;right:4px;text-align: center;padding-top: 2px; box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff; width:25px; height:25px; border-radius:50%; color:#fff; position:absolute}
</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form action="" id="mainform" onsubmit="return entryValidate()"  method="post">
<input type="hidden" name="quotationId" id="quotationId" value="<?php echo $quotationId;?>">
<input type="hidden" name="pquotationId" id="pquotationId" value="<?php echo ($pworkorderid !=0) ? 1 : 0; ?>"/>
<input type="hidden" name="amendment" id="amendment" value="<?php echo ($pquotationId !=0) ? 1 : 0; ?>"/>
<input type="hidden" name="rfcmode" id="rfcmode" value="<?php echo $mode;?>">
<!--<input type="hidden" name="editid" id="editid" value="--><?php //echo $editid;?><!--">-->
<input type="hidden" name="codegenType" id="codegenType" value="<?php echo $codegenType;?>">
<input type="hidden" name="wgcodegenType" id="wgcodegenType" value="<?php echo $wgcodegenType;?>">
<input type="hidden" name="enquiryId" id="enquiryId" value="<?php echo $enquiryId;?>"/>

<input type="hidden" name="amendment" id="amendment" value="<?php echo ($pworkorderid !=0) ? 1 : 0; ?>"/>
<div class="col-lg-12 col-sm-12 page_tittle">
    <h1 class="col-lg-3 col-sm-12">Quotation - <?php if($mode == 'revise') { echo 'Revise'; } else if($mode == 'edit') { echo 'Edit'; } else { echo 'Add'; } ?></h1>
    <div class="col-lg-9 col-sm-12 col-xs-12">
        <a href="javascript:void(0);" data-toggle="modal" data-target="#RateApply" class="sele-max2">Rate Apply</a>
        <a href="javascript:void(0);" data-toggle="modal" onclick="showWBSMaster()" class="sele-max"><i class="fa fa-th-list"></i> WBS Master</a>
        <a href="javascript:void(0);" data-toggle="modal" onclick="showFaceSheet()" class="sele-max1"><i class="fa fa-file-text"></i> Face Sheet</a>
        <a href="javascript:void(0);" data-toggle="modal" onclick="showSequentialView();" class="sele-max2"><i class="fa fa-clipboard"></i> Matrix View</a>
        <a href="javascript:void(0);" data-toggle="modal" onclick="showDataSheet();" class="sele-max2"><i class="fa fa-clipboard"></i> Analytics</a>
        <a href="javascript:void(0);" data-toggle="modal" onclick="showQualifier();" class="sele-max2"><i class="fa fa-clipboard"></i> Apply Qualifier</a>
    </div>
</div>
<!--content-->
<!--Excel-->
<?php if ($mode != 'edit' && $mode != 'revise'):?>
    <div class="fixed-action-btn active fixtopbtn" data-toggle="tooltip" data-placement="left" id="divExcelImport" title="Import From Excel">
        <div class="col-lg-12 col-sm-12 col-xs-12">
            <span class="butclr-ns btn-file">
             <p class="sam-up"><i class="fa fa-folder-open sap"></i></p>
              <a href="javascript:void(0);"><input type="file" name="myfile" id="myfile" class="input-large filestyle"  accept=".xls, .xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" onchange="getexcelfield(this)">
              </a></span>
        </div>
    </div>
<?php endif; ?>
<!--Excel end-->
<div class="col-lg-12 col-lg-offset-0" style="padding:0 !important;">
    <div class="tagcrd">
        <ul>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr1">
                    <div class="icon-bg"><i class="fa fa-list-alt i-text-111"></i></div>
                    <h2 class="comtex commargin_bottom_5 crmbrdrclrhed1 comnelips" style="font-weight:600 !important;">Reference No</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"><input type="text" class="bk_inpt1 splcharc" name="refno" data-bsfshare="refno" id="refno" onchange="" value="<?php  if ($quotationId!=0) { echo $rfcregister['RefNo'];}  else { echo $svNo; } ?>" <?php if ($genType==true) { ?> readonly <?php } ?> /></h5>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr2">
                    <div class="icon-bg"><i class="fa fa-tasks i-text-111"></i></div>
                    <h2 class="comtex  commargin_bottom_5 crmbrdrclrhed2 comnelips" style="font-weight:600 !important;">Reference Date </h2>
                    <h5 class="tetmuted tet-clr11 comnelips"><input type="text" class="date_picker no_bg bk_inpt " name="refdate" data-bsfshare="refdate" readonly id="refdate" onchange="validateDate(this);" value="<?php if ($quotationId!=0)  { echo date("d-m-Y", strtotime($rfcregister['RefDate']));} else { echo date('d-m-Y');}?>" /></h5>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr3">
                    <div class="icon-bg"><i class="fa fa-user i-text-111"></i></div>
                    <h2 class="comtex  commargin_bottom_5 crmbrdrclrhed3 comnelips" style="font-weight:600 !important;">Enquiry Name</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"> <input type="text" class="bk_inpt1 splcharc" name="enquiryname" data-bsfshare="enquiryname" readonly id="enquiryname" value="<?php echo $EnquiryName; ?>"/></h5>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr4">
                    <div class="icon-bg"><i class="fa fa-suitcase i-text-111"></i></div>
                    <h2 class="comtex commargin_bottom_5 crmbrdrclrhed4 comnelips" style="font-weight:600 !important;">Client Name</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"><?php echo $clientName;?></h5>
                </div>
            </li>
        </ul></div></div>
<!--form start-->


<!--<div class="col-lg-12 top_ct col-sm-12 col-xs-12" >-->
<!--    <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">-->
<!--        <div class="form-group col-lg-12"> <span class="date_icon"><i class="fa fa-calendar"></i></span>-->
<!--            <input type="text" name="refdate" id="refdate" class="form-control date_picker lbl_move" label="Reference Date"  value="--><?php // if ($quotationId != 0) { echo date("d-m-Y", strtotime($rfcregister['RefDate'])); } else { echo date("d-m-Y"); }?><!--" />-->
<!--            <input type="hidden" name="enquiryId" id="enquiryId" value="--><?php //if ($enquiryId != 0) { echo $enquiryId; } else { echo ''; } ?><!--" />-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">-->
<!--        <div class="form-group col-lg-12">-->
<!--            <input type="text" name="refno" id="refno" class="form-control lbl_move" label="Reference No" value="--><?php //if($quotationId != 0 && $mode == 'revise') { echo $revSvNo; } else if($quotationId != 0) { echo $rfcregister['RefNo']; } else { echo $svNo; } ?><!--" --><?php //echo ($genType==true) ? 'readonly' : ''; ?><!-- />-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0">-->
<!--        <div class="form-group col-lg-12">-->
<!--            <input type="text" class="form-control lbl_move" label="Enquiry Name" value="--><?php //echo $EnquiryName; ?><!--" readonly/>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<!--table Jq Gride start-->
<!--accordion start-->
<div class="col-lg-12 clear padtop20">
<div id="accordion" class="panel-group">
<div class="panel panel-info">
<div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads">
    <h4 class="panel-title accordion-toggle defa_panels">Bill Of Quantity <span id="boqAmount" class="acctitle_amt"></span></h4>
</div>
<div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
<div class="panel-body bgcolr">
<!--------------------------------Bill of quantity-------------------------------->
<!--table Jq Gride start-->
<div class="col-lg-12 col-lg-offset-0" style="<?php echo ($mode!='edit' || $quotationId !=0) ? '': 'display: none';?>" id="edit-content">
<a href="#" data-toggle="modal" onclick="showIOWMaster()" class="multiple-data"><i class="fa fa-check-circle-o"></i>Library IOW PickList</a>
<div class="table-responsive topsp animated fadeInUp">
<table class="table" style=" margin-bottom:0px; <?php ($mode =='edit' || $quotationId ==0) ? 'display: none;' : '' ?>" id="sample12">
<thead>
<tr>
    <th>WorkGroup/ IOW Header</th>
    <th>RefNo</th>
    <th>Specification</th>
    <th>Unit</th>
    <th class="text-right">Qty</th>
    <th></th>
    <th class="text-right">Rate</th>
    <th class="text-right">Amount</th>
    <th class="text-right">Quoted Rate</th>
    <th class="text-right">Quoted Amount</th>
    <th class="text-right">Quote %</th>
    <th>&nbsp;</th>
</tr>
</thead>
<tbody>
<?php $i=0; $totbaseAmt=0; $totquoteAmt=0;
if (isset($rfctrans)):
    foreach($rfctrans as $trans):
        $iQTransId = $trans['QuotationTransId'];
        $i=$i+1;
        ?>
        <tr id="IOWiRowId_<?php echo $i; ?>">
            <td width="11%">
                <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spcn">
                        <input type="text" class="parent_texts_piow" name="parentid_<?php echo $i; ?>" id="parentid_<?php echo $i; ?>" readonly value="<?php echo $trans['ParentText'];?>"/>
                        <label for="lblfromiow_<?php echo $i; ?>" style="font-size: 12px; font-style: italic" >From Library IOW</label>
                        <input type="text" class="parent_texts_piow" name="libiowid_<?php echo $i; ?>" id="libiowid_<?php echo $i; ?>" value="<?php echo $trans['LSpecification'];?>" readonly/>
                        <input type="hidden" name="workgroupid_<?php echo $i; ?>" id="workgroupid_<?php echo $i; ?>" value="<?php echo $trans['WorkGroupId'];?>"/>
                        <input type="hidden" name="pworkgroupid_<?php echo $i; ?>" id="pworkgroupid_<?php echo $i; ?>" value="<?php echo $trans['ProjectWorkGroupId'];?>"/>
                        <input type="hidden" name="pworkgroupname_<?php echo $i; ?>" id="pworkgroupname_<?php echo $i; ?>" value="<?php echo $trans['ProjectWorkGroupName'];?>"/>
                        <input type="hidden" name="worktypeid_<?php echo $i; ?>" id="worktypeid_<?php echo $i; ?>" value="<?php echo $trans['WorkTypeId'];?>"/>
                        <input type="hidden" name="worktypename_<?php echo $i; ?>" id="worktypename_<?php echo $i; ?>" value="<?php echo $trans['WorkType'];?>"/>
                    </div>
                </div>
            </td>
            <td width="3%">
                <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spcn">
                        <input class="parent_texts_piow" type="text" maxlength="50" name="refserialno_<?php echo $i; ?>" value="<?php echo $trans['RefSerialNo'];?>" id="refserialno_<?php echo $i; ?>"  onblur = "return CheckSerialNo(this.id)" value="<?php echo $trans['RefSerialNo'];?>"/>
                        <div class="radio_check">
                            <p>
                                <input type="checkbox" name="" value ="" id="raheader_<?php echo $i; ?>" class="ripple"  onchange="checkHeader(this.id)" <?php echo ($trans['Header'] == '1') ? 'checked' : '';?> disabled/>
                                <label for="raheader_<?php echo $i; ?>" class="ripple">Header</label>
                                <input type="hidden" name="raheaderval_<?php echo $i; ?>" id="raheaderval_<?php echo $i; ?>" value = "<?php echo $trans['Header']; ?>">
                            </p>
                        </div>
                    </div>
                </div>
            </td>
            <td width="11%">
                <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                    <div class="docu-spc">
                        <textarea class="parent_texts" name="spec_<?php echo $i; ?>" id="spec_<?php echo $i; ?>" onchange = "return SpecChange(this.id)"><?php echo $trans['Specification'];?></textarea>
                        <label>Short Spec</label>
                        <textarea class="parent_texts" maxlength="255" name="shortspec_<?php echo $i; ?>" id="shortspec_<?php echo $i; ?>"><?php echo $trans['ShortSpec'];?></textarea>
                    </div>
                </div>
            </td>
            <td width="8%"><input type="text" class="parent_text" name="unitid_<?php echo $i; ?>" id="unitid_<?php echo $i; ?>" value="<?php echo $trans['UnitName'];?>" onblur="return CheckUnitValid(this.id)"></td>
            <td width="8%"> <input class="parent_text text-right" type="text" name="qty_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['Qty'],3, true, true);?>" id="qty_<?php echo $i; ?>" align="right" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" onchange="return rateUpdate(this.id);AddNewRowA(this.id, true);"/></td>
            <td width="1%">
                <ul class="expanded-dis">
                    <li>
                        <a href="javascript:void(0);" class="wbsTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="WBS Qty" ></i></a>
                    </li>
                </ul>
            </td>
            <td width="9%"><input class="parent_text text-right" type="text" name="rate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['Rate'],2,true);?>" id="rate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly /></td>
            <td width="10%"><input class="parent_text text-right" type="text" name="amt_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['Amount'],2, true, true);?>" id="amt_<?php echo $i; ?>" align="right" onblur="return FormatNum(this, 2)" onfocus="return clickbut(this.id)" readonly/></td>
            <td width="10%"><input class="parent_text text-right" type="text" name="qrate_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['QuotedRate'],2,true);?>" id="qrate_<?php echo $i; ?>" onchange="return calQRate('roId_<?php echo $i; ?>')" onkeypress="return isDecimal(event,this)" /></td>
            <td width="10%"><input class="parent_text text-right" type="text" name="qamt_<?php echo $i; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($trans['QuotedAmount'],2, true, true);?>" id="qamt_<?php echo $i; ?>" align="right" readonly /></td>
            <td width="5%"><input class="parent_text text-right" type="text" name="qper_<?php echo $i; ?>" value = "<?php $dPer=0; if ($trans['QuotedRate'] !=0 && $trans['Rate'] !=0) { $dPer = (($trans['QuotedRate']-$trans['Rate'])/$trans['Rate']*100);}   echo $this->commonHelper()->sanitizeNumber($dPer,2, true, true);?>" id="qper_<?php echo $i; ?>" align="right" onkeypress="return isDecimal(event,this)" onchange="changeQPer(this.id)"/></td>

            <input type="hidden" name="iowid_<?php echo $i; ?>" id="iowid_<?php echo $i; ?>" value = "<?php echo $trans['IOWId'];?>">
            <input type="hidden" name="unitkeyid_<?php echo $i; ?>" id="unitkeyid_<?php echo $i; ?>" value = "<?php echo $trans['UnitId'];?>">
            <input type="hidden" name="parentkeyid_<?php echo $i; ?>" id="parentkeyid_<?php echo $i; ?>" value = "<?php echo $trans['WorkGroupId'];?>">
            <input type="hidden" name="rowrefid_<?php echo $i; ?>" id="rowrefid_<?php echo $i; ?>" value = "<?php echo $i;?>">
            <input type="hidden" name="libiowkeyid_<?php echo $i; ?>" id="libiowkeyid_<?php echo $i; ?>" value = "<?php echo $trans['IOWId'];?>">
            <input type="hidden" name="prevQuotTransId_<?php echo $i; ?>" id="prevQuotTransId_<?php echo $i; ?>" value="<?php echo $trans['PrevQuotationTransId']; ?>">
            <input type="hidden" name="newparentname_<?php echo $i; ?>" id="newparentname_<?php echo $i; ?>" value = "<?php echo $trans['ParentName']; ?>">
            <input type="hidden" name="piowid_<?php echo $i; ?>" id="piowid_<?php echo $i; ?>" value = "<?php echo $trans['ParentId'];?>">
            <td width="5%" class="action_btns_td">
                <ul class="action_btns">
                    <li>
                        <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="display: none;">
                            <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>">
                            <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                        </a>
                    </li>
                </ul>
            </td>
        </tr>
        <tr style="display:none;" class="wbsmainTr_<?php echo $i; ?>">
            <td colspan="12" style="padding:0px !important; ">
                <div class="col-lg-10 col-lg-offset-1" style="margin-top:10px; margin-bottom:10px;">
                    <div class="subDiv" style="display:none;overflow-y:auto; min-height:100%; max-height:500px;">
                        <table class="table" style="margin-bottom:0px;" id="wbstable_<?php echo $i; ?>">
                            <thead>
                            <tr>
                                <th>WBS Name</th>
                                <th>Qty</th>
                                <th>&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php
                            $qTransId = $trans['QuotationTransId'];
                            $arrwbs = array_filter($rfcwbstrans, function($v) use($qTransId) { return $v['QuotationTransId'] == $qTransId; });
                            $x=1; $dWBSTotal=0;
                            foreach($arrwbs as $wsbtrans) { ?>
                                <tr>
                                    <td width="15%"> <input class="parent_text" name="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>" value="<?php  echo $wsbtrans['WBSName']; ?>" id="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>"  onfocus="return CheckWBSFocus(this)"/></td>
                                    <td width="3%"> <input class="parent_text text-right" name="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" value="<?php  echo $this->commonHelper()->sanitizeNumber($wsbtrans['Qty'],3); ?>" id="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return wbsQtyChange(this.id)"/></td>
                                    <input type="hidden" name="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" id="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" value="<?php  echo $wsbtrans['WBSId']; ?>">
                                    <td width="1%" class="action_btns_td">
                                        <ul class="action_btns">
                                            <li style="float:left;"> <a href="javascript:void(0);" class="wbstable_<?php echo $i; ?>_TrDelete_<?php echo $x; ?>" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>
                                        </ul>
                                    </td>
                                </tr>
                                <?php $x=$x+1; $dWBSTotal +=  $wsbtrans['Qty']; } ?>
                            <tr>
                                <td width="15%"> <input class="parent_text" name="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>" value="" id="wbstable_<?php echo $i; ?>_wbsname_<?php echo $x; ?>" onfocus="return CheckWBSFocus(this)"/></td>
                                <td width="3%">
                                    <input class="parent_text text-right" name="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" value="" id="wbstable_<?php echo $i; ?>_qty_<?php echo $x; ?>" onblur="return FormatNum(this, 3);return removeTooltip();" onkeypress="return isDecimal(event,this)"  onchange="return wbsQtyChange(this.id)"/>
                                </td>
                                <input type="hidden" name="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" id="wbstable_<?php echo $i; ?>_wbsid_<?php echo $x; ?>" value="">
                                <td width="1%" class="action_btns_td">
                                    <ul class="action_btns">
                                        <li style="float:left;"> <a href="javascript:void(0);" class="wbstable_<?php echo $i; ?>_TrDelete_<?php echo $x; ?>" style="display: none;" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td class="rate_pri text-right"><label>Total</label></td>
                                <td><input class="parent_text text-right total-clr" name="wbstable_<?php echo $i; ?>_totalqty" value="<?php echo $this->commonHelper()->sanitizeNumber($dWBSTotal,3);?>" id="wbstable_<?php echo $i; ?>_totalqty" readonly/></td>
                                <input type="hidden" name="wbstable_<?php echo $i; ?>_rows" id="wbstable_<?php echo $i; ?>_rows" value="<?php echo $x; ?>">
                                <td>&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                    </div></div>
            </td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr_<?php echo $i; ?> paintTr">
        <td colspan="12"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
        <div class="col-lg-12">
            <ul id="ulworkgroup_<?php echo $i; ?>" class="short_spc" <?php echo $trans['IOWId']==0 ? 'style="display:none;"' : ''; ?>>
                <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library WorkGroup</label>
                    <textarea class="parent_texts" name="lworkgroupname_<?php echo $i; ?>" id="lworkgroupname_<?php echo $i; ?>" readonly><?php echo $trans['LWorkGroupName'];?></textarea>
                </li>
                <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library SerialNo</label>
                    <textarea class="parent_texts" name="lserialno_<?php echo $i; ?>" id="lserialno_<?php echo $i; ?>" readonly><?php echo $trans['LSerialNo'];?></textarea>
                </li>
                <li class="col-lg-5 col-lg-offset-0 col-md-5 col-md-offset-0 col-sm-5 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Library Specification</label>
                    <textarea class="parent_texts" name="lspec_<?php echo $i; ?>" id="lspec_<?php echo $i; ?>" readonly><?php echo $trans['LSpecification'];?></textarea>
                </li>
            </ul>
            <!-- Nav tabs -->
            <div <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="darkmenu" id="mixtab_<?php echo $i; ?>">
                <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">
                    <ul>
                        <li class="active"><a href="javascript:void(0);" name="analtype_<?php echo $i; ?>" id="analtype_<?php echo $i; ?>" onclick="showmix('sitemix',this.id,event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                        <li><a href="javascript:void(0);" name="analtypeR_<?php echo $i; ?>" id="analtypeR_<?php echo $i; ?>" onclick="showmix('readymix',this.id,event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
                    </ul>
                </div>
                <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3">
                    <ul class="col-lg-12">
                        <li id ="lisitemix_<?php echo $i; ?>" <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                            <label class="spl_siz">Site Mix (%)</label>
                            <input type="text" class="text-right w_100_h30" name="sitemixper_<?php echo $i; ?>" id="sitemixper_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['SiteMixRatio'],2, true, true);?>" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                        </li>

                        <li id ="lireadymix_<?php echo $i; ?>" <?php echo $trans['ConcreteMix']==0 ? 'style="display:none;"' : ''; ?> class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                            <label class="spl_siz">Ready Mix (%)</label>
                            <input type="text" class="text-right w_100_h30" name="readymixper_<?php echo $i; ?>" id="readymixper_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($trans['ReadyMixRatio'],2, true, true);?>" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- Tab panes -->
            <div class="lstate">
                <ul  id="raworktable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['WorkingQty'])) echo $this->commonHelper()->sanitizeNumber( $trans['WorkingQty'],3, true, true); else echo 1; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
                    </li>
                    <li <?php echo (isset($trans['Cement']) && $trans['Cement']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>AQty_li">
                        <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="<?php if (isset($trans['CementRatio'])) echo $this->commonHelper()->sanitizeNumber( $trans['CementRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
                    </li>
                    <li <?php echo (isset($trans['Sand']) && $trans['Sand']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>BQty_li">
                        <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" value="<?php if (isset($trans['SandRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['SandRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'S')"/>
                    </li>
                    <li <?php echo (isset($trans['Metal']) && $trans['Metal']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>CQty_li">
                        <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="<?php if (isset($trans['MetalRatio'])) echo $this->commonHelper()->sanitizeNumber($trans['MetalRatio'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
                    </li>
                    <li <?php echo (isset($trans['Thickness']) && $trans['Thickness']==0) ? 'style="display:none;"' : ''; ?> id="rateanal_<?php echo $i; ?>thick_li">
                        <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="<?php if (isset($trans['ThickQty'])) echo $this->commonHelper()->sanitizeNumber($trans['ThickQty'],3, true, true); else echo ''; ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
                    </li>
                    <li>
                        <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)" ><i class="fa fa-window-restore" aria-hidden="true"></i></a>
                    </li>
                    <li><a  id="rateanal_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                </ul>
                <ul  style="display: none;" id="raworkRtable_<?php echo $i;?>">
                    <li>
                        <label class="lbl_style">Working Qty</label>
                        <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanalR_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php if (isset($trans['RWorkingQty'])) echo $this->commonHelper()->sanitizeNumber($trans['RWorkingQty'],3); else echo 1; ?>" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
                    </li>
                    <li><a  id="rateanalR_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
                </ul>
            </div>
        </div>
        <div class="col-lg-12">
        <div class="table-responsive topsp animated fadeInUp">
        <!-- Sitemix tabs -->
        <table class="table" style="margin-bottom:0px;" id="rateanal_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref no</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0;$iRefId=1;$weightagetotal=0;
            $qqTransId = $trans['QuotationTransId'];
            $smix= 'R';
            $arrqanal = array_filter($rfcrateanal, function($v) use($qqTransId,$smix) { return $v['QuotationTransId'] == $qqTransId && $v['MixType'] !=$smix; });
            foreach($arrqanal as $ratrans):
            ?>
                <tr id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="12">
                            <input type="text" class="parent_text"  style="font-weight:bold" name="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>">
                        </td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $ratrans['ReferenceId'];?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <li>
                                    <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)">
                                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                                    </a>
                                </li>
                            </ul>
                        </td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo ($ratrans['IncludeFlag']==1) ? true : false; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" > R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%">
                            <input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php echo $ratrans['Code'] . ' ' .$ratrans['ResourceName']?>" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>">Wastage %</label>
                                <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>">Weightage %</label>
                            </div>
                        </td>
                        <td width="3%">
                            <input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3,true,true);?>" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" align="right" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],3)?>" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],3)?>" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                            </div>
                        </td>
                        <!--                                    <td width="3%"><input class="parent_text text-right" type="text" name="rateanal_--><?php //echo $i; ?><!--_resqty_--><?php //echo $j; ?><!--" value = "--><?php //echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3)?><!--" id="rateanal_--><?php //echo $i; ?><!--_resqty_--><?php //echo $j; ?><!--"  onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/></td>-->
                        <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ><?php echo $ratrans['UnitName']?></label></td>
                        <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <!--                                    <td width="4%"><a href="javascript:void(0);" name="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" id="rateanal_--><?php //echo $i;?><!--_resdel_--><?php //echo $j;?><!--" onclick="javascript:DeleteResource(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <li>
                                    <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)">
                                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                                    </a>
                                </li>
                            </ul>
                        </td>
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount']; $weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1; }
            endforeach; ?>
            <tr id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo true; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" checked/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $iRefId; ?></label></td>
                <td width="15%">
                    <input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)"/>
                    <div class="divwastage" style="display: none">
                        <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>"  style="display: none">Wastage %</label>
                        <label class="lab-Wastage" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="display: none">Weightage %</label>
                    </div>
                </td>
                <td width="3%">
                    <input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
                    <div class="short-spic divwastage" style="display: none">
                        <input style="display: none"class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                        <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                    </div>
                </td>
                <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ></label></td>
                <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                <!--<td width="3%"><a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                <td width="4%" class="action_btns_td">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id, event)" style="display: none;">
                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>"">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>"">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" >
                <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value="<?php echo $i; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right"  id="rateanal_<?php echo $i; ?>_totweightage" value="<?php echo $this->commonHelper()->sanitizeNumber($weightagetotal,2,true); ?>" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr	" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['WastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['WastageAmt'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" class="wasteTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="wastemainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwaste_<?php echo $i; ?>"></div>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['BaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['BaseRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totbaserate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['QualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['QualifierValue'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totqualrate" readonly/></td>
                <td style="border-right:none;border-top:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrqual)) { $textHtml =  $arrqual[$iQTransId] ; $textHtml = str_replace('__1','_'.$i,$textHtml); } else { $textHtml=''; }  echo $textHtml;?>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['TotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['TotalRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri"  id="rateanal_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['NetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['NetRate'],2,true); else echo '0.00'; ?>" id="rateanal_<?php echo $i; ?>_totnetrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoid_<?php echo $i; ?>" id="rowinfoid_<?php echo $i; ?>" value="<?php echo $j; ?>">
        <!-- Readymix tabs -->
        <table class="table" style="display: none;margin-bottom:0px;" id="rateanalR_<?php echo $i; ?>_restable">
            <thead>
            <tr>
                <th class="bg_clo">Inc / Exc</th>
                <th class="bg_clo">Ref no</th>
                <th class="bg_clo">Resource</th>
                <th class="bg_clo">Coefficient</th>
                <th class="bg_clo">Unit</th>
                <th class="bg_clo">Rate</th>
                <th class="bg_clo">Amount</th>
                <th class="bg_clo text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sorting">
            <?php $j=1; $total=0;
            $smix= 'R';
            $arrqanal = array_filter($rfcrateanal, function($v) use($qqTransId,$smix) { return $v['QuotationTransId'] == $qqTransId && $v['MixType'] ==$smix; });
            foreach($arrqanal as $ratrans):
                ?>
                <tr id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                    <?php if($ratrans['TransType'] == 'H'):?>
                        <td colspan="12">
                            <input type="text" class="parent_text"  style="font-weight:bold" name="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_resdes_<?php echo $j ?>" value="<?php echo $ratrans['Description'];?>">
                        </td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j ?>" value="<?php echo $ratrans['ReferenceId'];?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value="<?php echo $ratrans['TransType'] ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <li>
                                    <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)">
                                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                                    </a>
                                </li>
                            </ul>
                        </td>
                    <?php else: ?>
                        <td width="1%"><label>
                                <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php if ($ratrans['IncludeFlag']==1) true; else false; ?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" <?php echo ($ratrans['IncludeFlag'] == '1') ? 'checked' : '';?>/>
                                <div class="ios_switch"><span></span></div>
                            </label></td>
                        <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $ratrans['ReferenceId']; ?></label></td>
                        <td width="15%">
                            <input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" value="<?php echo $ratrans['Code'] . ' ' .$ratrans['ResourceName']?>" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)" disabled/>
                            <div class="divwastage" style="display: none">
                                <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>">Wastage %</label>
                                <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>">Weightage %</label>
                            </div>
                        </td>
                        <td width="3%">
                            <input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Qty'],3)?>" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
                            <div class="short-spic divwastage" style="display: none">
                                <input style="<?php if ($ratrans['TypeId'] !=2) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Wastage'],3)?>" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=2) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                                <input style="<?php if ($ratrans['TypeId'] !=4) { echo 'display: none'; } else  { echo ''; } ?>" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Weightage'],3)?>" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>"  <?php echo ($ratrans['TypeId']!=4) ? 'readonly' : ''; ?> onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                            </div>
                        </td>
                        <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ><?php echo $ratrans['UnitName']?></label></td>
                        <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Rate'],2,true) ?>" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                        <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "<?php echo $this->commonHelper()->sanitizeNumber($ratrans['Amount'],2,true) ?>" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                        <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
                        <td width="4%" class="action_btns_td">
                            <ul class="action_btns">
                                <li>
                                    <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)">
                                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                                    </a>
                                </li>
                            </ul>
                        </td>
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" value="<?php echo $ratrans['WastageQty'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" value="<?php echo $ratrans['WastageAmount'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" value="<?php echo $ratrans['ResourceId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" value="<?php echo $ratrans['SubIOWId'] ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "<?php echo $ratrans['Formula'] ?>" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "<?php echo $ratrans['TransType']; ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "<?php echo $ratrans['ReferenceId']; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value="<?php echo $ratrans['TypeId'] ?>" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "<?php echo $ratrans['RateType'] ?>" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                        <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "<?php echo $ratrans['ResourceName'] ?>" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
                    <?php endif; ?>
                </tr>
                <?php $j=$j+1; $total +=  $ratrans['Amount']; $weightagetotal +=  $ratrans['Weightage']; if(intval($ratrans['ReferenceId']) >= $iRefId) {$iRefId = intval($ratrans['ReferenceId'])+1; }
            endforeach; ?>
            <tr id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
                <td width="1%"><label>
                        <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php echo true;?>" id="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" checked/>
                        <div class="ios_switch"><span></span></div>
                    </label></td>
                <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R<?php echo $iRefId; ?></label></td>
                <td width="15%">
                    <input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
                    <div class="divwastage" style="display: none">
                        <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>" style="display: none">Wastage %</label>
                        <label class="lab-Wastage" id="rateanalR_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>" style="display: none" >Weightage %</label>
                    </div>
                </td>
                <td width="3%">
                    <input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
                    <div class="short-spic divwastage" style="display: none">
                        <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"  onchange="return ValueChange(this.id)"/>
                        <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
                    </div>
                </td>
                <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>" ></label></td>
                <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" readonly onkeypress="return isDecimal(event,this)"/></td>
                <td width="3%" class="action_btns_td">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id,event)" style="display: none;">
                                <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value="<?php echo $i; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value="L" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
                <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
            </tr>
            </tbody>
            <tbody class="total" style="border: none;">
            <tr style="border-bottom:none;">
                <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
                <td><input type="text" class="parent_text total-clr text-right" id="rateanalR_<?php echo $i; ?>_totweightage" readonly/></td>
                <td>&nbsp;</td>
                <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
                <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totwastage" value = "<?php if (isset($trans['RWastageAmt'])) echo $this->commonHelper()->sanitizeNumber($trans['RWastageAmt'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totwastage" readonly/></td>
                <td style="border-right:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" class="wasteRTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="wastemainRTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <div id="divwasteR_<?php echo $i; ?>"></div>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totbaserate" value = "<?php if (isset($trans['RBaseRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RBaseRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totbaserate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totqualrate" value = "<?php if (isset($trans['RQualifierValue'])) echo $this->commonHelper()->sanitizeNumber($trans['RQualifierValue'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totqualrate" readonly/></td>
                <td style="border-right:none;border-top:none;">
                    <ul class="action_btns">
                        <li>
                            <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>">
                                <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
                <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                        <?php if (!empty($arrRqual)) { $textHtml =  $arrRqual[$iQTransId] ; $textHtml = str_replace('__1','_'.$i,$textHtml);} else { $textHtml=''; }  echo $textHtml;?>
                </td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totrate" value = "<?php if (isset($trans['RTotalRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RTotalRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            <tr style="border-bottom:none;">
                <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
                <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totnetrate" value = "<?php if (isset($trans['RNetRate'])) echo $this->commonHelper()->sanitizeNumber($trans['RNetRate'],2,true); else echo '0.00'; ?>" id="rateanalR_<?php echo $i; ?>_totnetrate" readonly/></td>
                <td style="border-right:none;border-top:none;">&nbsp;</td>
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="rowinfoidR_<?php echo $i; ?>" id="rowinfoidR_<?php echo $i; ?>" value="<?php echo $j; ?>">
        </div>
        </div>
        </div>
        </td>
        </tr>
        <!--expand end-->
        <?php $totbaseAmt +=  $trans['Amount'];$totquoteAmt +=  $trans['QuotedAmount'];  endforeach; endif;?>
<?php $i=$i+1; ?>
<tr id="IOWiRowId_<?php echo $i; ?>">
    <td width="11%">
        <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spcn">
                <input type="text"  class="parent_texts_piow" name="parentid_<?php echo $i; ?>" id="parentid_<?php echo $i; ?>" value=""/>
                <label for="lblfromiow_<?php echo $i; ?>" style="font-size: 12px; font-style: italic" >From Library IOW</label>
                <input type="text" class="parent_texts_piow" name="libiowid_<?php echo $i; ?>" id="libiowid_<?php echo $i; ?>" value="">
                <input type="hidden" name="workgroupid_<?php echo $i; ?>" id="workgroupid_<?php echo $i; ?>" value=""/>
                <input type="hidden" name="pworkgroupid_<?php echo $i; ?>" id="pworkgroupid_<?php echo $i; ?>" value=""/>
                <input type="hidden" name="pworkgroupname_<?php echo $i; ?>" id="pworkgroupname_<?php echo $i; ?>" value=""/>
                <input type="hidden" name="worktypeid_<?php echo $i; ?>" id="worktypeid_<?php echo $i; ?>" value=""/>
                <input type="hidden" name="worktypename_<?php echo $i; ?>" id="worktypename_<?php echo $i; ?>" value=""/>
            </div>
        </div>
    </td>
    <td width="3%">
        <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spcn">
                <input class="parent_texts_piow" type="text" maxlength="50" name="refserialno_<?php echo $i; ?>" id="refserialno_<?php echo $i; ?>" onblur = "return CheckSerialNo(this.id)"/>
                <div class="radio_check">
                    <p>
                        <input type="checkbox" name="" value ="" id="raheader_<?php echo $i; ?>" class="ripple"  onchange="checkHeader(this.id)"/>
                        <label for="raheader_<?php echo $i; ?>" class="ripple">Header</label>
                        <input type="hidden" name="raheaderval_<?php echo $i; ?>" id="raheaderval_<?php echo $i; ?>" value = "0">
                    </p>
                </div>
            </div>
        </div>
    </td>
    <td width="11%">
        <div class="on-focus clearfix" style="position:relative; overflow: hidden;">
            <div class="docu-spc">
                <textarea class="parent_texts" name="spec_<?php echo $i; ?>" id="spec_<?php echo $i; ?>" onchange = "return SpecChange(this.id)"></textarea>
                <label>Short Spec</label>
                <textarea class="parent_texts" maxlength="255" name="shortspec_<?php echo $i; ?>" id="shortspec_<?php echo $i; ?>"></textarea>
            </div>
        </div>
    </td>
    <td width="8%"><input type="text" class="parent_text" name="unitid_<?php echo $i; ?>" id="unitid_<?php echo $i; ?>" onblur="return CheckUnitValid(this.id)" ></td>
    <td width="8%">
        <input class="parent_text text-right" type="text" name="qty_<?php echo $i; ?>" value = "0" id="qty_<?php echo $i; ?>" align="right" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" onchange="return rateUpdate(this.id);AddNewRowA(this.id, true);"/>
    </td>
    <td width="1%">
        <ul class="expanded-dis">
            <li>
                <a href="javascript:void(0);" class="wbsTr_<?php echo $i; ?>"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="WBS Qty" ></i></a>
            </li>
        </ul>
    </td>
    <td width="9%"><input class="parent_text text-right" type="text" name="rate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber(0,2,true); ?>" id="rate_<?php echo $i; ?>" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly/></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="amt_<?php echo $i; ?>" value="0" id="amt_<?php echo $i; ?>" align="right" onblur="return FormatNum(this, 2)" onfocus="return clickbut(this.id)" readonly/></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="qrate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber(0,2,true); ?>" id="qrate_<?php echo $i; ?>" onchange="return calQRate('roId_<?php echo $i; ?>')" onkeypress="return isDecimal(event,this)" /></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="qamt_<?php echo $i; ?>" value="0" id="qamt_<?php echo $i; ?>" align="right" readonly /></td>
    <td width="5%"><input class="parent_text text-right" type="text" name="qper_<?php echo $i; ?>" value="0" id="qper_<?php echo $i; ?>" align="right" onkeypress="return isDecimal(event,this)" onchange="changeQPer(this.id)" /></td>

    <input type="hidden" name="iowid_<?php echo $i; ?>" value = "" id="iowid_<?php echo $i; ?>">
    <input type="hidden" name="unitkeyid_<?php echo $i; ?>" value = "" id="unitkeyid_<?php echo $i; ?>">
    <input type="hidden" name="parentkeyid_<?php echo $i; ?>" value = "" id="parentkeyid_<?php echo $i; ?>">
    <input type="hidden" name="libiowkeyid_<?php echo $i; ?>" id="libiowkeyid_<?php echo $i; ?>" value = "">
    <input type="hidden" name="rowrefid_<?php echo $i; ?>" value = "<?php echo $i; ?>" id="rowrefid_<?php echo $i; ?>">
    <input type="hidden" name="prevQuotTransId_<?php echo $i; ?>" id="prevQuotTransId_<?php echo $i; ?>" value="">
    <input type="hidden" name="piowid_<?php echo $i; ?>" id="piowid_<?php echo $i; ?>" value = "">
    <input type="hidden" name="newparentname_<?php echo $i; ?>" id="newparentname_<?php echo $i; ?>" value = "">
    <td width="5%" class="action_btns_td">
        <ul class="action_btns">
            <li>
                <a href="javascript:void(0);" class="mainTrDelete_<?php echo $i; ?>" style="display: none;">
                    <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                </a>
            </li>
            <li>
                <a href="javascript:void(0);" class="mainTr_<?php echo $i; ?>">
                    <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                </a>
            </li>
        </ul>
    </td>
</tr>
<tr style="display:none;" class="wbsmainTr_<?php echo $i; ?>">
    <td colspan="12" style="padding:0px !important; ">
        <div class="col-lg-10 col-lg-offset-1" style="margin-top:10px; margin-bottom:10px;">
            <div class="subDiv" style="display:none;overflow-y:auto; min-height:100%; max-height:500px;">
                <table class="table" style="margin-bottom:0px;" id="wbstable_<?php echo $i; ?>">
                    <thead>
                    <tr>
                        <th>WBS Name</th>
                        <th>Qty</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td width="15%"> <input class="parent_text" name="wbstable_<?php echo $i; ?>_wbsname_1" value="" id="wbstable_<?php echo $i; ?>_wbsname_1" onfocus="return CheckWBSFocus(this)"/></td>
                        <td width="3%"> <input class="parent_text text-right" name="wbstable_<?php echo $i; ?>_qty_1" value="" id="wbstable_<?php echo $i; ?>_qty_1" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return wbsQtyChange(this.id)"/></td>
                        <input type="hidden" name="wbstable_<?php echo $i; ?>_wbsid_1" id="wbstable_<?php echo $i; ?>_wbsid_1" value="">
                        <td width="1%" class="action_btns_td">
                            <ul class="action_btns">
                                <li style="float:left;"> <a href="javascript:void(0);" class="wbstable_<?php echo $i; ?>_TrDelete_1" style="display: none;" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>
                            </ul>
                        </td>
                    </tr>

                    <tr>
                        <td class="rate_pri text-right"><label>Total</label></td>

                        <td><input class="parent_text text-right total-clr" name="wbstable_<?php echo $i; ?>_totalqty" value="" id="wbstable_<?php echo $i; ?>_totalqty" readonly/></td>
                        <input type="hidden" name="wbstable_<?php echo $i; ?>_rows" id="wbstable_<?php echo $i; ?>_rows" value="<?php echo $i; ?>">
                        <td>&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </td>
</tr>
<!--expand table-->
<tr style="display:none;" class="subTr_<?php echo $i; ?> paintTr">
<td colspan="12"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
<div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
    <ul class="short_spc" id="ulworkgroup_<?php echo $i; ?>" style="display: none">
        <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library WorkGroup</label>
            <textarea class="parent_texts" name="lworkgroupname_<?php echo $i; ?>" id="lworkgroupname_<?php echo $i; ?>" readonly></textarea>
        </li>
        <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library SerialNo</label>
            <textarea class="parent_texts" name="lserialno_<?php echo $i; ?>" id="lserialno_<?php echo $i; ?>" readonly></textarea>
        </li>
        <li class="col-lg-5 col-lg-offset-0 col-md-5 col-md-offset-0 col-sm-5 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library Specification</label>
            <textarea class="parent_texts" name="lspec_<?php echo $i; ?>" id="lspec_<?php echo $i; ?>" readonly></textarea>
        </li>
    </ul>
    <!-- Nav tabs -->
    <div class="darkmenu" id="mixtab_<?php echo $i; ?>">
        <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">
            <ul>
                <li class="active"><a href="javascript:void(0);" name="analtype_<?php echo $i; ?>" id="analtype_<?php echo $i; ?>" onclick="showmix('sitemix',this.id,event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                <li><a href="javascript:void(0);" name="analtypeR_<?php echo $i; ?>" id="analtypeR_<?php echo $i; ?>" onclick="showmix('readymix',this.id,event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
            </ul>
        </div>
        <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3">
            <ul class="col-lg-12">
                <li id ="lisitemix_<?php echo $i; ?>" class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Site Mix (%)</label>
                    <input type="text" class="text-right w_100_h30" name="sitemixper_<?php echo $i; ?>" id="sitemixper_<?php echo $i; ?>" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                </li>
                <li id ="lireadymix_<?php echo $i; ?>" class="col-lg-6 col-md-6 col-sm-6">
                    <label class="spl_siz">Ready Mix (%)</label>
                    <input type="text" class="text-right w_100_h30" name="readymixper_<?php echo $i; ?>" id="readymixper_<?php echo $i; ?>" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                </li>
            </ul>
        </div>
    </div>
    <!-- Tab panes -->
    <div class="lstate">
        <ul  id="raworktable_<?php echo $i;?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AnalQty" id="rateanal_<?php echo $i; ?>_AnalQty" title="Working Qty" value="1" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>AQty_li">
                <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_AQty" id="rateanal_<?php echo $i; ?>_AQty" title="Cement (C)" value="" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>BQty_li">
                <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_BQty" id="rateanal_<?php echo $i; ?>_BQty" title="Sand (S)" value="" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'S')"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>CQty_li">
                <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_CQty" id="rateanal_<?php echo $i; ?>_CQty" title="Aggregate (A)" value="" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
            </li>
            <li id="rateanal_<?php echo $i; ?>thick_li">
                <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal_<?php echo $i; ?>_thick" id="rateanal_<?php echo $i; ?>_thick" title="Thickness (mm) (T)" value="" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
            </li>
            <li>
                <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn" id="copyformat_<?php echo $i;?>" onclick="refreshFromWorkGroup(this.id)" ><i class="fa fa-window-restore" aria-hidden="true"></i></a>
            </li>
            <li><a  id="rateanal_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
        <ul  style="display: none;" id="raworkRtable_<?php echo $i;?>">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR_<?php echo $i; ?>_AnalQty" id="rateanalR_<?php echo $i; ?>_AnalQty" title="Working Qty" value="<?php echo $this->commonHelper()->sanitizeNumber(1,3); ?>" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li><a  id="rateanalR_<?php echo $i; ?>_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
    </div>
</div>
<div class="col-lg-12">
<div class="table-responsive topsp animated fadeInUp">
<!-- Sitemix tabs -->
<table class="table" style="margin-bottom:0px;" id="rateanal_<?php echo $i; ?>_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc / Exc</th>
        <th class="bg_clo">Ref no</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo">Rate</th>
        <th class="bg_clo">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <?php $j=1; ?>
    <tr id="rateanal_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
        <td width="1%"><label>
                <input type="checkbox" name="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" value ="<?php echo true; ?>" id="rateanal_<?php echo $i; ?>_inc_<?php echo $j; ?>" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)"/>
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanal_<?php echo $i; ?>_ref_<?php echo $j; ?>" >R1</label></td>
        <td width="15%">
            <input class="parent_text" data-toggle="popover" name="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resid_<?php echo $j; ?>"  onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)" />
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id ="rateanal_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanal_<?php echo $i; ?>_lblWeightage_<?php echo $j; ?>">Weightage %</label>
            </div>
        </td>
        <td width="3%">
            <input class="parent_text text-right" type="text" maxlength="15" name="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div>
        </td>
        <td width="5%"><label for ="rateanal_<?php echo $i; ?>_resunit_<?php echo $j; ?>"></label></td>
        <td width="5%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id)" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
        <td width="8%"><input class="parent_text text-right" maxlength="15" type="text" name="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_resamt_<?php echo $j; ?>"  onkeypress="return isDecimal(event,this)" readonly/></td>
        <!--<td width="3%"><a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" name="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanal_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResource(this.id,event)" style="display: none;">
                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                    </a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanal_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_formula_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "1" id="rateanal_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_type_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "1" id="rateanal_<?php echo $i; ?>_refid_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanal_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
        <input type="hidden" name="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanal_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
        <td><input type="text" class="parent_text total-clr text-right" id="rateanal_<?php echo $i; ?>_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totwastage" value = "" id="rateanal_<?php echo $i; ?>_totwastage" readonly/></td>
        <td style="border-right:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="wasteTr_<?php echo $i; ?>">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="wastemainTr_<?php echo $i; ?>">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div id="divwaste_<?php echo $i; ?>"></div>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totbaserate" value = "" id="rateanal_<?php echo $i; ?>_totbaserate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totqualrate" value = "" id="rateanal_<?php echo $i; ?>_totqualrate" readonly/></td>
        <td style="border-right:none;border-top:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>

    </tr>
    <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <?php $textHtml = str_replace('__1','_'.$i,$qualHtml);  echo $textHtml;?>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totrate" value = "" id="rateanal_<?php echo $i; ?>_totrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal_<?php echo $i; ?>_totnetrate" value = "" id="rateanal_<?php echo $i; ?>_totnetrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    </tbody>
</table>
<input type="hidden" name="rowinfoid_<?php echo $i; ?>" id="rowinfoid_<?php echo $i; ?>" value="<?php echo $j; ?>">
<!--  Readymix tabs-->
<table class="table" style="display: none;margin-bottom:0px;" id="rateanalR_<?php echo $i; ?>_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc / Exc</th>
        <th class="bg_clo">Ref no</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo">Rate</th>
        <th class="bg_clo">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <?php $j=1; ?>
    <tr id="rateanalR_<?php echo $i; ?>_RowId_<?php echo $j; ?>">
        <td width="1%"><label>
                <input type="checkbox" name="rateanalR_<?php echo $i; ?>_inc_<?php echo $j; ?>" value = "<?php echo true; ?>" id="rateanalR_<?php echo $i; ?>inc_<?php echo $j; ?>" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanalR_<?php echo $i; ?>_ref_<?php echo $j; ?>">R1</label></td>
        <td width="15%">
            <input class="parent_text" data-toggle="popover" name="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resid_<?php echo $j; ?>" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id ="rateanalR_<?php echo $i; ?>_lblWastage_<?php echo $j; ?>">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>">Weightage %</label>
            </div>
        </td>
        <td width="3%">
            <input class="parent_text text-right" type="text" maxlength="15" name="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resqty_<?php echo $j; ?>" onblur="return FormatNum(this, 3)" onfocus ="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_Wastage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_Weightage_<?php echo $j; ?>" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div>
        </td>
        <td width="5%"><label for ="rateanalR_<?php echo $i; ?>_resunit_<?php echo $j; ?>"></label></td>
        <td width="5%"><input class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_resrate_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i;?>_resrate_<?php echo $j; ?>" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
        <td width="8%"><input class="parent_text text-right" type="text" name="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_resamt_<?php echo $j; ?>" onkeypress="return isDecimal(event,this)" readonly/></td>
        <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
        <td width="4%" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" name="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" id="rateanalR_<?php echo $i;?>_resdel_<?php echo $j;?>" onclick="javascript:DeleteResourceR(this.id, event)" style="display: none;">
                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                    </a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageQty_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_WastageAmount_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_reskeyid_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>" id="rateanalR_<?php echo $i; ?>_iowkeyid_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_formula_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>" value = "1" id="rateanalR_<?php echo $i; ?>_rowrefid_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_type_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>" value = "1" id="rateanalR_<?php echo $i; ?>_refid_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_restypeid_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>" value = "L" id="rateanalR_<?php echo $i; ?>_ratetype_<?php echo $j; ?>">
        <input type="hidden" name="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>" value = "" id="rateanalR_<?php echo $i; ?>_newresname_<?php echo $j; ?>">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
        <td><input type="text" class="parent_text" id="rateanalR_<?php echo $i; ?>_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totwastage" value = "" id="rateanalR_<?php echo $i; ?>_totwastage" readonly/></td>
        <td style="border-right:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="wasteRTr_<?php echo $i; ?>">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="wastemainRTr_<?php echo $i; ?>">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div id="divwasteR_<?php echo $i; ?>"></div>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totbaserate" value = "" id="rateanalR_<?php echo $i; ?>_totbaserate" readonly /></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totqualrate" value = "" id="rateanalR_<?php echo $i; ?>_totqualrate" readonly /></td>
        <td style="border-right:none;border-top:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="qualTr_<?php echo $i; ?>">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>

    </tr>
    <tr style="display:none;" class="qualmainTr_<?php echo $i; ?>">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <?php $textHtml = str_replace('__1','_'.$i,$qualRHtml);  echo $textHtml;?>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotrate">Rate for</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totrate" value = "" id="rateanalR_<?php echo $i; ?>_totrate" readonly /></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR_<?php echo $i; ?>_lbltotnetrate">Net Rate per</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR_<?php echo $i; ?>_totnetrate" value = "" id="rateanalR_<?php echo $i; ?>_totnetrate" readonly /></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    </tbody>
</table>
<input type="hidden" name="rowinfoidR_<?php echo $i; ?>" id="rowinfoidR_<?php echo $i; ?>" value="<?php echo $j; ?>">
</div>
</div>
</div></td>
</tr>
</tbody>
<tbody class="wototal" style="border: none;">
<tr style="border-bottom:none;">
    <td colspan="7" class="rate_pri text-right"><label>Total</label></td>
    <td><input type="text" class="parent_text total-clr text-right"  id="totalbasevalue" name="totalbasevalue" value="<?php echo $this->commonHelper()->sanitizeNumber($totbaseAmt,2,true); ?>" readonly/></td>
    <td>&nbsp;</td>
    <td><input type="text" class="parent_text total-clr text-right"  id="totalquotevalue" name="totalquotevalue" value="<?php echo $this->commonHelper()->sanitizeNumber($totquoteAmt,2,true); ?>" readonly/></td>
    <td><input type="text" class="parent_text total-clr text-right"  id="totalquoteper" name="totalquoteper" value="<?php $dTPer=0; if ($totquoteAmt !=0 && $totbaseAmt !=0) { $dTPer = (($totquoteAmt-$totbaseAmt)/$totbaseAmt*100);} echo $this->commonHelper()->sanitizeNumber($dTPer,2,true); ?>" readonly/></td>
    <td>&nbsp;</td>
</tr>
</tbody>

</table>
<input type="hidden" name="rowid" id="rowid" value="<?php echo $i; ?>">
</div>
</div>
<!--table end-->
<!--------------------------------Bill of quantity end-------------------------------->
</div>
</div>
</div>
<div class="panel panel-info">
    <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads">
        <h4 class="panel-title accordion-toggle defa_panels">Other Cost <span id="ocTotalAmount" class="acctitle_amt"></span></h4>
    </div>
    <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
        <div class="panel-body bgcolr">
            <!--------------------------------other cost-------------------------------->
            <div class="col-lg-12 col-lg-offset-0">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style=" margin-bottom:0px;" id="OtherCostTable">
                        <thead>
                        <tr>
                            <th>Other Cost Name</th>
                            <th>Type</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <input type="hidden" name="ocrowid" id="ocrowid" value="0"/>
                    <input type="hidden" name="rowdeleteids" id="rowdeleteids" value="0"/>
                </div>
            </div>
            <!--New OtherCost-->
            <div class="col-lg-12">
                <table  id="NewOtherCostWrapper" style="display: none;">
                    <tr>
                        <td ><a href="javascript:void(0);" id ="butnewitems" class="btn btn-link" onclick="ShowNewOtherCost(); return false;" >New Other Cost(s) Created <span class='badge badge_count'>0</span></a></td>
                    </tr>
                </table>
                <table class="table" id ="NewOtherCostTable" style="display: none; width:50%; border:1px solid #ccc;">
                    <thead>
                    <tr>
                        <th style="border-right:1px solid #ccc;">Other Cost Name</th>
                        <th class="text-center">&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <input type="hidden" name="NewOtherCostRowId" id="NewOtherCostRowId" value="0" >

            <!--------------------------------other cost end-------------------------------->
        </div>
    </div>
</div>

<div class="panel panel-info">
    <div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads">
        <h4 class="panel-title accordion-toggle defa_panels">Summary</h4>
    </div>
    <div class="panel-collapse collapse" id="collapseThree" style="height: 0px;">
        <div class="panel-body bgcolr">
            <!--------------------------------Summary-------------------------------->
            <div class="col-lg-12 col-lg-offset-0">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style=" margin-bottom:0px;" id="summaryTable">
                        <tbody>
                        <tr style="border-bottom:none;">
                            <td width="20%">&nbsp;</td>
                            <td width="25%" style="border-right:none;" align="right" class="rate_pri"><label>Base Amount</label></td>
                            <td width="30%" style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="baseAmount" value="" id="baseAmount" readonly style="width:80%; float:left" /> <span class="perAmtSpan" id="perBaseAmt"></span></td>
                            <td width="35%">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td width="20%">&nbsp;</td>
                            <td width="25%" style="border-right:none;" align="right" class="rate_pri"><label>Other Cost Amount</label></td>
                            <td width="20%" style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="otherCostAmount" value="" id="otherCostAmount" readonly style="width:80%; float:left" /> <span class="perAmtSpan" id="perOCAmt"></span></td>
                            <td width="35%">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td width="20%">&nbsp;</td>
                            <td width="25%" style="border-right:none;" align="right" class="rate_pri"><label>Total Amount</label></td>
                            <td width="20%" style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="finalAmount" value="" id="finalAmount" readonly style="width:80%; float:left" /> <span class="perAmtSpan" id="perFinalAmt"></span></td>
                            <td width="35%">&nbsp;</td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td width="20%">&nbsp;</td>
                            <td width="25%" style="border-right:none;" align="right" class="rate_pri"><label>Quoted Amount<label></td>
                            <td width="30%" style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="quotedAmount" value="" id="quotedAmount" readonly style="width:80%; float:left" /> <span class="perAmtSpan" id="perQuoteAmt"></span></td>
                            <td width="35%">&nbsp;</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--------------------------------Summary-------------------------------->
        </div>
    </div>
</div>

<div class="panel panel-info">
    <div data-target="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads">
        <h4 class="panel-title accordion-toggle defa_panels">Resource Summary</h4>
    </div>
    <div class="panel-collapse collapse" id="collapseFour" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-12 col-lg-offset-0">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" id="resourcerate" style="margin-bottom: 0">
                        <thead>
                        <tr>
                            <th class="th-modal">Resource Name</th>
                            <th class="th-modal">Unit</th>
                            <th class="th-modal">Qty</th>
                            <th class="th-modal">Rate</th>
                            <th class="th-modal">Amount</th>
                        </tr>
                        </thead>
                        <tbody class="resdata"></tbody>
                        <tbody class="restotal">
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><input class="parent_text text-right total-clr" name="restotalamt" id="restotalamt" readonly/></td>
                        </tr>
                        </tbody>
                        <input type="hidden" name="resrows" value = "" id="resrows" >
                    </table>
                </div>
                <div style="float:right">
                    <label class="rate_pri" style="margin-right: 10px;">*Apply Resource Rate</label>
                    <button type="button" class="md_ok pull-right" onclick="return ResourceRateUpdate()" data-dismiss="modal" id="btn-resourcerate" style="display: none;">Update</button>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
<!--accordion end-->
<div class="col-lg-12 col-lg-offset-0" style="<?php echo ($mode!='edit' || $quotationId !=0) ? 'display: none': '';?>" id="edit-list">
    <div class="col-lg-12 clear">
        <div class="table-responsive clear animated fadeInUp">
            <div id='jqxWidget'>
                <div id="grid"></div>
            </div>
        </div>
    </div>
</div>

<table  id="newitems" style="display: none;">
    <tr>
        <td ><a href="javascript:void(0);" id ="butnewitems" class="btn btn-link" onclick="return ShowNewWorkGroup(event)" >New Work Group Created</a></td>
    </tr>
    <tr>
        <table class="table" id ="newwg" style="display: none; width:50%; border:1px solid #ccc;">
            <thead>
            <tr>
                <th>SlNo</th>
                <th style="border-right:1px solid #ccc;">Work Group Name</th>
                <th class="text-center">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td width="10%" style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newwgslno_1" value = "" id="newwgslno_1" align="right" readonly></td>
                <td width="30%" style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newwgname_1" value = "" id="newwgname_1" align="right" readonly></td>
                <td width="4%">
                    <ul class="action_btns">
                        <li>
                            <button type="button" name="newwgdetails_1" value = "Show Details" id="newwgdetails_1" onclick="return ShowWorkGroup(this.id)" style="margin:0;" ><i class="fa fa-pencil-square-o"></i></button>
                        </li>
                    </ul>
                </td>
                <input type="hidden" name="newlwgid_1" value = "" id="newlwgid_1" >
                <input type="hidden" name="newlwgname_1" value = "" id="newlwgname_1" >
                <input type="hidden" name="newwgtype_1" value = "" id="newwgtype_1" >
                <input type="hidden" name="newwgtypeid_1" value = "" id="newwgtypeid_1" >
            </tr>
            </tbody>
            <input type="hidden" name="newwgowid" id="newwgowid" >
        </table>
    </tr>
</table>
<table  id="newresitems" style="display: none;">
    <tr>
        <td ><a href="javascript:void(0);" id ="butnewresitems" class="btn btn-link" onclick="return ShowNewResource(event)" >New Resource Created</a></td>
    </tr>
    <tr >
        <table class="table" id="newres" style="display: none; width:50%;border:1px solid #ccc;">
            <thead>
            <tr>
                <th style="border-right:1px solid #ccc;">Resource Name</th>
                <th style="border-right:1px solid #ccc;">Type</th>
                <th class="text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newresname_1" value = "" id="newresname_1" readonly></td>
                <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newrestype_1" value = "" id="newrestype_1" readonly></td>
                <td width="3%"><button type="button" name="newresdetails_1" value = "Show Details" id="newresdetails_1" onclick="return ShowResource(this.id)" style="background-color: #fff;margin:0;"><i class="fa fa-pencil-square-o ctlss"></i></button></td>
                <input type="hidden"  name="newresgroup_1" value = "" id="newresgroup_1">
                <input type="hidden"  name="newresgroupid_1" value = "" id="newresgroupid_1">
                <input type="hidden"  name="newrestypeid_1" value = "" id="newrestypeid_1">
                <input type="hidden"  name="newresunit_1" value = "" id="newresunit_1">
                <input type="hidden"  name="newresunitid_1" value = "" id="newresunitid_1">
                <input type="hidden"  name="newresrate_1" value = "" id="newresrate_1">
                <input type="hidden"  name="newwresunit_1" value = "" id="newwresunit_1">
                <input type="hidden"  name="newwresunitid_1" value = "" id="newwresunitid_1">
                <input type="hidden"  name="newwresrate_1" value = "" id="newwresrate_1">
                <input type="hidden"  name="newresmattype_1" value = "" id="newresmattype_1">
                <input type="hidden"  name="newreslead_1" value = "" id="newreslead_1">
                <input type="hidden"  name="newrescode_1" value = "" id="newrescode_1">
                <input type="hidden"  name="newrowrefid_1" value = "" id="newrowrefid_1">
            </tr>
            </tbody>
        </table>
        <input type="hidden" name="newresrowid" id="newresrowid">
    </tr>
</table>
</form>
</div>
<!--<table  id="newrateresource" style="display: none;">-->
<!--    <tr>-->
<!--        <td ><a href="javascript:void(0);" id ="butnewrateresource" class="btn btn-link" onclick="return ShowRateResource(event)" >Resource Invloved</a></td>-->
<!--    </tr>-->
<!--</table>-->
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r" id="submit-btn" style="<?php if ($quotationId !=0) { if ($rfcregister['Approve']=='Y') { echo 'display: none;'; } else { echo '';} }?>"><a href="javascript:submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
        <li class="dropdown save_btn float_r" id="next-btn" style="<?php echo ($mode!='edit' || $quotationId !=0) ? 'display: none;' : '';?>"><a href="javascript:nextiow();" data-toggle="tooltip" class="ripple" title="Go to next">Next</a></li>
        <!--    <li class="dropdown save_btn float_r" id="next-print"><a href="javascript:printtable();" data-toggle="tooltip" class="ripple" title="Print">Print</a></li>-->
        <li class="cancel_btn float_r" id="back-btn" style="<?php echo ($mode!='edit' || $quotationId !=0) ? '' : 'display: none;';?>"><a href="<?php echo $this->basePath() . '/project/followup/followup/'.$enquiryId;?>" data-toggle="tooltip" class="ripple" title="Cancel">Cancel</a></li>
    </ul>
</div>
<!-- Modal -->
<div id="rateResource" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource Rate</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive topsp animated fadeInUp">
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>

            </div>
        </div>
    </div>
</div>
<div id="formula" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Formula</h1>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formula Expression</label>
                    <input type="text" class="parent_text" name="formulaexp"  maxlength="20" value = "" id="formulaexp" onchange="return formulacalculation()" onkeypress="return isFormula(event);" >
                </div>
                <div class="form-group">
                    <input type="text" class="parent_text text-right" name="formulavalue" value = "" id="formulavalue" readonly >
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="md_ok" onclick="return formulaok()" data-dismiss="modal" data-toggle="tooltip" data-original-title="OK">OK</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Resource/IOW Picklist</h1>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs nav-controls" role="tablist">
                    <li role="presentation" class="active"><a href="#res-view" aria-controls="task-view" role="tab" data-toggle="tab">Resource</a></li>
                    <li role="presentation"><a href="#iow-view" aria-controls="iow-view" role="tab" data-toggle="tab">Item of Work</a></li>
                </ul>
                <div class="tab-content goal-bg col-md-12" style="background:#fff; padding:0 !important">
                    <div class="col-md-12 tab-pane active" style="padding:0 !important" role="tabpanel" id="res-view">
                        <div class="table-responsive clear">
                            <div id="respickgrid"> </div>
                        </div>
                    </div>
                    <div class="col-md-12 tab-pane" style="padding:0 !important" role="tabpanel" id="iow-view">
                        <div class="table-responsive clear">
                            <div id="iowpickgrid"> </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="picklistrestype" value="">
                <input type="hidden" id="picklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="workgroupmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>WorkGroup</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="wgrowid" id="wgrowid">
                <input type="hidden" id="refNewWGRowName" />
                <div class="form-group">
                    <label style="margin-bottom: 10px;">SerialNo</label>
                    <input type="text" class="parent_text" maxlength="50" name="workgroupslno" id="workgroupslno" >
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Project Work Group Name</label>
                    <input type="text" class="parent_text" maxlength="255" name="workgroup" id="workgroup" >
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Library Work Group Name</label>
                    <input type="text" class="parent_text" name="lworkgroup" id ="lworkgroup" >
                    <input type="hidden" name="lworkgroup_id" id ="lworkgroup_id" >
                    <div class="clearfix"></div>
                </div>
                <div class="form-group">
                    <label style="margin-bottom: 10px;">Work Type</label>
                    <input type="text" class="parent_text" name="lworktype" id ="lworktype" >
                    <input type="hidden" name="lworktypeid" id ="lworktypeid" >
                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return workgroupClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="workgroupok" class="md_ok" onclick="return WorkGroupUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<div id="dummyheader" style="display: none">
    <table id="dummyanalhead">
        <tbody>
        <tr id="rateanal__1_header__9">
            <td colspan="12"><input type="text" class="parent_text"  style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanal__1_rowrefid__9" value = "" id="rateanal__1_rowrefid__9">
            <input type="hidden" name="rateanal__1_type__9" value = "H" id="rateanal__1_type__9">
            <input type="hidden" name="rateanal__1_refid__9" value = "" id="rateanal__1_refid__9">
        </tr>
        <tr id="rateanalR__1_header__9">
            <td colspan="12"><input type="text" class="parent_text" style="font-weight:bold" name="rateanal__1_resdes__9" id="rateanal__1_resdes__9"></td>
            <input type="hidden" name="rateanalR__1_rowrefid__9" value = "" id="rateanalR__1_rowrefid__9">
            <input type="hidden" name="rateanalR__1_type__9" value = "H" id="rateanalR__1_type__9">
            <input type="hidden" name="rateanalR__1_refid__9" value = "" id="rateanalR__1_refid__9">
        </tr>
        </tbody>
    </table>
</div>
<div id="dummy" style="display: none">
<table id="dummytable">
<tbody>
<tr id="IOWiRowId__1">
    <td width="11%">
        <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spcn">
                <input type="text" class="parent_texts_piow" name="parentid__1" id="parentid__1" value=""/>
                <label for="lblfromiow__1" style="font-size: 12px; font-style: italic" >From Library IOW</label>
                <input type="text" class="parent_texts_piow" name="libiowid__1" id="libiowid__1" value="">
                <input type="hidden" name="workgroupid__1" id="workgroupid__1" value=""/>
                <input type="hidden" name="pworkgroupid__1" id="pworkgroupid__1" value=""/>
                <input type="hidden" name="pworkgroupname__1" id="pworkgroupname__1" value=""/>
                <input type="hidden" name="worktypeid__1" id="worktypeid__1" value=""/>
                <input type="hidden" name="worktypename__1" id="worktypename__1" value=""/>
            </div>
        </div>
    </td>
    <td width="3%">
        <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
            <div class="docu-spcn">
                <input class="parent_texts_piow" type="text" maxlength="50" name="refserialno__1" id="refserialno__1" onblur = "return CheckSerialNo(this.id)">
                <div class="radio_check">
                    <p>
                        <input type="checkbox" name="" value ="" id="raheader__1" class="ripple"  onchange="checkHeader(this.id)"/>
                        <label for="raheader__1" class="ripple">Header</label>
                        <input type="hidden" name="raheaderval__1" id="raheaderval__1" value = "0">
                    </p>
                </div>
            </div>
        </div>
    </td>
    <td width="11%"
    <div class="on-focus clearfix" style="position:relative;overflow: hidden;">
        <div class="docu-spc">
            <textarea class="parent_texts" name="spec__1" id="spec__1" onchange = "return SpecChange(this.id)"></textarea>
            <label>Short Spec</label>
            <textarea class="parent_texts" maxlength="255" name="shortspec_<?php echo $i; ?>" id="shortspec_<?php echo $i; ?>"></textarea>
        </div>
    </div>
    </td>
    <td width="8%"><input type="text" class="parent_text" name="unitid__1" id="unitid__1" onblur="return CheckUnitValid(this.id)" ></td>
    <td width="8%">
        <input class="parent_text text-right" type="text" name="qty__1" id="qty__1" align="right" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" onchange="return rateUpdate(this.id);AddNewRowA(this.id, true);">
    </td>
    <td width="1%">
        <ul class="expanded-dis">
            <li>
                <a href="javascript:void(0);" class="wbsTr__1"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="WBS Qty" ></i></a>
            </li>
        </ul>
    </td>
    <td width="9%"><input class="parent_text text-right" type="text" name="rate__1" id="rate__1" onblur="return FormatNum(this, 2,true)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="amt__1" id="amt__1" align="right" onblur="return FormatNum(this, 2)" onfocus="return clickbut(this.id)" onkeypress="return isDecimal(event,this)" readonly></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="qrate__1" id="qrate__1" onchange="return calQRate('roId__1');" onkeypress="return isDecimal(event,this)" /></td>
    <td width="10%"><input class="parent_text text-right" type="text" name="qamt__1" id="qamt__1" align="right" onkeypress="return isDecimal(event,this)" readonly /></td>
    <td width="5%"><input class="parent_text text-right" type="text" name="qper__1" id="qper__1" align="right" onkeypress="return isDecimal(event,this)" onchange="changeQPer(this.id)" /></td>
    <input type="hidden" name="iowid__1" value = "" id="iowid__1">
    <input type="hidden" name="unitkeyid__1" value = "" id="unitkeyid__1">
    <input type="hidden" name="parentkeyid__1" value = "" id="parentkeyid__1">
    <input type="hidden" name="libiowkeyid__1" id="libiowkeyid__1" value = "">
    <input type="hidden" name="rowrefid__1" value = "1" id="rowrefid__1">
    <input type="hidden" name="prevQuotTransId__1" id="prevQuotTransId__1">
    <input type="hidden" name="piowid__1" id="piowid__1" value = "">
    <input type="hidden" name="newparentname__1" id="newparentname__1" value = "">
    <td width="5%" class="action_btns_td">
        <ul class="action_btns">
            <li>
                <a href="javascript:void(0);" class="mainTrDelete__1" style="display: none;">
                    <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                </a>
            </li>
            <li>
                <a href="javascript:void(0);" class="mainTr__1">
                    <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                </a>
            </li>
        </ul>
    </td>
</tr>
<tr style="display:none;" class="wbsmainTr__1">
    <td colspan="12" style="padding:0px !important; ">
        <div class="col-lg-10 col-lg-offset-1" style="margin-top:10px; margin-bottom:10px;">
            <div class="subDiv" style="display:none;overflow-y:auto; min-height:100%; max-height:500px;">
                <table class="table" style="margin-bottom:0px;" id="wbstable__1">
                    <thead>
                    <tr>
                        <th>WBS Name</th>
                        <th>Qty</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td width="15%"> <input class="parent_text" name="wbstable__1_wbsname__9" value="" id="wbstable__1_wbsname__9" onfocus="return CheckWBSFocus(this)"/></td>
                        <td width="3%"> <input class="parent_text text-right" name="wbstable__1_qty__9" value="" id="wbstable__1_qty__9" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return wbsQtyChange(this.id)"/></td>
                        <input type="hidden" name="wbstable__1_wbsid__9" id="wbstable__1_wbsid__9" value="">
                        <td width="1%" class="action_btns_td">
                            <ul class="action_btns">
                                <li style="float:left;"> <a href="javascript:void(0);" class="wbstable__1_TrDelete__9" style="display: none;" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>
                            </ul>
                        </td>
                    </tr>

                    <tr>
                        <td class="rate_pri"><label>Total</label></td>

                        <td><input class="parent_text text-right total-clr" name="wbstable__1_totalqty" value="" id="wbstable__1_totalqty" readonly/></td>
                        <input type="hidden" name="wbstable__1_rows" id="wbstable__1_rows" value="<?php echo $i; ?>">
                        <td>&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
            </div></div>
    </td>
</tr>
<!--expand table-->
<tr style="display:none;" class="subTr__1 paintTr">
<td colspan="12"><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
<div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;">
    <ul class="short_spc" id="ulworkgroup__1" style="display: none">
        <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library WorkGroup</label>
            <textarea class="parent_texts" name="lworkgroupname__1" id="lworkgroupname__1" readonly></textarea>
        </li>
        <li class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library SerialNo</label>
            <textarea class="parent_texts" name="lserialno__1" id="lserialno__1" readonly></textarea>
        </li>
        <li class="col-lg-5 col-lg-offset-0 col-md-5 col-md-offset-0 col-sm-5 col-sm-offset-0" style="padding-left:2px !important; padding-right:2px !important;">
            <label class="spl_siz">Library Specification</label>
            <textarea class="parent_texts" name="lspec__1" id="lspec__1" readonly></textarea>
        </li>
    </ul>
    <!-- Nav tabs -->
    <div class="darkmenu" id="mixtab__1">
        <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-3 col-sm-offset-0">
            <ul>
                <li class="active"><a href="javascript:void(0);" name="analtype__1" id="analtype__1" onclick="showmix('sitemix',this.id,event)"><i class="fa fa-caret-right"></i> Sitemix</a></li>
                <li><a href="javascript:void(0);" name="analtypeR__1" id="analtypeR__1" onclick="showmix('readymix',this.id,event)"><i class="fa fa-caret-right"></i> Readymix</a></li>
            </ul>
        </div>
        <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3">
            <ul class="col-lg-12">
                <li id ="lisitemix__1" class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Site Mix (%)</label>
                    <input type="text" class="text-right w_100_h30" name="sitemixper__1" id="sitemixper__1" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                </li>
                <li id ="lireadymix__1" class="col-lg-6 col-md-6 col-sm-6" style="padding-left:2px !important; padding-right:2px !important;">
                    <label class="spl_siz">Ready Mix (%)</label>
                    <input type="text" class="text-right w_100_h30" name="readymixper__1" id="readymixper__1" onchange="MixRateUpdate(this.id)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)"/>
                </li>
            </ul>
        </div>
    </div>
    <!-- Tab panes -->
    <div class="lstate">
        <ul  id="raworktable__1">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AnalQty" id="rateanal__1_AnalQty" value="1" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li id="rateanal__1AQty_li">
                <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_AQty" id="rateanal__1_AQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'C')"/>
            </li>
            <li id="rateanal__1BQty_li">
                <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_BQty" id="rateanal__1_BQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'S')"/>
            </li>
            <li id="rateanal__1CQty_li">
                <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_CQty" id="rateanal__1_CQty" title="Metal (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'A')"/>
            </li>
            <li id="rateanal__1thick_li">
                <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanal__1_thick" id="rateanal__1_thick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="changeRatio(this.id,'T')"/>
            </li>
            <li>
                <a href="javascript:void(0);" data-original-title="From WorkGroup" data-placement="left" data-toggle="tooltip" class="from_work_btn" id="copyformat__1" onclick="refreshFromWorkGroup(this.id)" ><i class="fa fa-window-restore" aria-hidden="true"></i></a>
            </li>
            <li><a  id="rateanal__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
        <ul  style="display: none;" id="raworkRtable__1">
            <li>
                <label class="lbl_style">Working Qty</label>
                <input type="text" class="col-lg-2 parent_texters text-right" maxlength="15" name="rateanalR__1_AnalQty" id="rateanalR__1_AnalQty" value="1" title="Working Qty" onkeypress="return isDecimal(event,this)" onchange="return CalculateRate(this.id)"/>
            </li>
            <li><a  id="rateanalR__1_PickList" href="javascript:void(0);" onclick="showPickList(this.id)" class="ad-btn" data-original-title="Resource/IOW PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a></li>
        </ul>
    </div>
</div>
<div class="col-lg-12">
<div class="table-responsive topsp animated fadeInUp">
<!-- Sitemix tabs -->
<table class="table" style="margin-bottom:0px;" id="rateanal__1_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc / Exc</th>
        <th class="bg_clo">Ref no</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo">Rate</th>
        <th class="bg_clo">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <tr id="rateanal__1_RowId__9">
        <td width="1%"><label>
                <input type="checkbox" name="rateanal__1_inc__9" value ="<?php echo true; ?>" id="rateanal__1_inc__9" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanal__1_ref__9" > R1 </label></td>
        <td width="15%">
            <input class="parent_text" name="rateanal__1_resid__9"  id="rateanal__1_resid__9" onfocus="return CheckResourceFocus(this.id,'')" onblur="return CheckResValid(this.id)"/>
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id ="rateanal__1_lblWastage__9">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanal__1_lblWeightage__9">Weightage %</label>
            </div>
        </td>
        <td width="3%">
            <input class="parent_text text-right" type="text" maxlength="15" name="rateanal__1_resqty__9" id="rateanal__1_resqty__9" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_Wastage__9" id="rateanal__1_Wastage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanal__1_Weightage__9" id="rateanal__1_Weightage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div>
        </td>
        <td width="5%"><label for ="rateanal__1_resunit__9" ></label></td>
        <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal__1_resrate__9"  id="rateanal__1_resrate__9" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)"/></td>
        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanal__1_resamt__9"  id="rateanal__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
        <!--<td width="3%"><a href="javascript:void(0);"  name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id,event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Add new"></i></a></td>-->
        <td width="3%" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" name="rateanal__1_resdel__9" id="rateanal__1_resdel__9" onclick="javascript:DeleteResource(this.id,event)" style="display: none;">
                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                    </a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="rateanal__1_WastageQty__9" id="rateanal__1_WastageQty__9">
        <input type="hidden" name="rateanal__1_WastageAmount__9" id="rateanal__1_WastageAmount__9">
        <input type="hidden" name="rateanal__1_reskeyid__9" id="rateanal__1_reskeyid__9">
        <input type="hidden" name="rateanal__1_iowkeyid__9" id="rateanal__1_iowkeyid__9">
        <input type="hidden" name="rateanal__1_formula__9" value = "" id="rateanal__1_formula__9">
        <input type="hidden" name="rateanal__1_rowrefid__9" value = "1" id="rateanal__1_rowrefid__9">
        <input type="hidden" name="rateanal__1_type__9" value = "R" id="rateanal__1_type__9">
        <input type="hidden" name="rateanal__1_refid__9" value = "1" id="rateanal__1_refid__9">
        <input type="hidden" name="rateanal__1_restypeid__9"  id="rateanal__1_restypeid__9">
        <input type="hidden" name="rateanal__1_ratetype__9" value="L" id="rateanal__1_ratetype__9">
        <input type="hidden" name="rateanal__1_newresname__9" value = "" id="rateanal__1_newresname__9">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right"><label>Total Weightage %</label></td>
        <td width="10%"><input type="text" class="parent_text" id="rateanal__1_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totwastage" value = "" id="rateanal__1_totwastage" readonly/></td>
        <td style="border-right:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="wasteTr__1">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="wastemainTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;"></div>
            <div id="divwaste__1"></div>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totbaserate" id="rateanal__1_totbaserate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totqualrate" id="rateanal__1_totqualrate" readonly/></td>
        <td style="border-right:none;border-top:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="qualTr__1">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>

    </tr>
    <tr style="display:none;" class="qualmainTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <?php echo $qualHtml;?>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal__1_lbltotrate">Rate for</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totrate" id="rateanal__1_totrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanal__1_lbltotnetrate">Net Rate per</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totnetrate" id="rateanal__1_totnetrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    </tbody>
    <!--                  <tbody class="total" style="border: none;">-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;" align="right" class="rate_pri">Rate for</td>-->
    <!--                      <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_totrate" id="rateanal__1_totrate" readonly/></td>-->
    <!--                      <td style="border-right:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none; border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>-->
    <!--                      <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_perrate" id="rateanal__1_perrate" readonly/></td>-->
    <!--                      <td style="border-right:none;border-top:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none; border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>-->
    <!--                      <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanal__1_netrate" id="rateanal__1_netrate" readonly/></td>-->
    <!--                      <td style="border-right:none;border-top:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                  </tbody>-->
</table>
<input type="hidden" name="rowinfoid__1" id="rowinfoid__1" value="1">
<!-- Readymix tabs -->
<table class="table" style="display: none;margin-bottom:0px;" id="rateanalR__1_restable">
    <thead>
    <tr>
        <th class="bg_clo">Inc / Exc</th>
        <th class="bg_clo">Ref no</th>
        <th class="bg_clo">Resource</th>
        <th class="bg_clo">Coefficient</th>
        <th class="bg_clo">Unit</th>
        <th class="bg_clo">Rate</th>
        <th class="bg_clo">Amount</th>
        <th class="bg_clo text-center">&nbsp;</th>
    </tr>
    </thead>
    <tbody class="sorting">
    <tr id="rateanalR__1_RowId__9">
        <td width="1%"><label>
                <input type="checkbox" name="rateanalR__1_inc__9" value = "<?php echo true; ?>" id="rateanalR__1_inc__9" checked class="ios_checkbox inc_exc" onchange="return ValueChange(this.id)" />
                <div class="ios_switch"><span></span></div>
            </label></td>
        <td width="3%"><label for ="rateanalR__1_ref__9" > R1 </label></td>
        <td width="15%">
            <input class="parent_text" name="rateanalR__1_resid__9" id="rateanalR__1_resid__9" onfocus="return CheckResourceFocus(this.id,'R')" onblur="return CheckResValid(this.id)"/>
            <div class="divwastage" style="display: none">
                <label class="lab-Wastage" style="display: none" id="rateanalR__1_lblWastage__9">Wastage %</label>
                <label class="lab-Wastage" style="display: none" id="rateanalR__1_lblWeightage__9">Weightage %</label>
            </div>
        </td>
        <td width="3%">
            <input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resqty__9" id="rateanalR__1_resqty__9" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)"/>
            <div class="short-spic divwastage" style="display: none">
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR__1_Wastage__9" id="rateanalR__1_Wastage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/>
                <input style="display: none" class="parent_text text-right" maxlength="15" type="text" name="rateanalR__1_Weightage__9" id="rateanalR__1_Weightage__9" readonly onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return weigtageCheck(this.id)"/>
            </div>
        </td>
        <td width="5%"><label for ="rateanalR__1_resunit__9"></label></td>
        <td width="5%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resrate__9"  id="rateanalR__1_resrate__9" onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)"/></td>
        <td width="8%"><input class="parent_text text-right" type="text" maxlength="15" name="rateanalR__1_resamt__9" id="rateanalR__1_resamt__9" readonly onkeypress="return isDecimal(event,this)"/></td>
        <!--<td width="3%"><a href="javascript:void(0);" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)"><i class="fa fa-trash-o ctlss" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></td>-->
        <td width="3%" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" name="rateanalR__1_resdel__9" id="rateanalR__1_resdel__9" onclick="javascript:DeleteResourceR(this.id, event)" style="display: none;">
                        <span data-original-title="Delete" data-placement="left" data-toggle="tooltip"><i class="fa fa-trash-o"></i></span>
                    </a>
                </li>
            </ul>
        </td>
        <input type="hidden" name="rateanalR__1_WastageQty__9" id="rateanalR__1_WastageQty__9">
        <input type="hidden" name="rateanalR__1_WastageAmount__9" id="rateanalR__1_WastageAmount__9">
        <input type="hidden" name="rateanalR__1_reskeyid__9" id="rateanalR__1_reskeyid__9">
        <input type="hidden" name="rateanalR__1_iowkeyid__9" id="rateanalR__1_iowkeyid__9">
        <input type="hidden" name="rateanalR__1_formula__9" value = "" id="rateanalR__1_formula__9">
        <input type="hidden" name="rateanalR__1_rowrefid__9" value = "1" id="rateanalR__1_rowrefid__9">
        <input type="hidden" name="rateanalR__1_type__9" value = "R" id="rateanalR__1_type__9">
        <input type="hidden" name="rateanalR__1_refid__9" value = "1" id="rateanalR__1_refid__9">
        <input type="hidden" name="rateanalR__1_restypeid__9" value = "" id="rateanalR__1_restypeid__9">
        <input type="hidden" name="rateanalR__1_ratetype__9" value = "L" id="rateanalR__1_ratetype__9">
        <input type="hidden" name="rateanalR__1_newresname__9" value = "" id="rateanalR__1_newresname__9">
    </tr>
    </tbody>
    <tbody class="total" style="border: none;">
    <tr style="border-bottom:none;">
        <td colspan="3" class="rate_pri text-right" ><label>Total Weightage %</label></td>
        <td><input type="text" class="parent_text total-clr text-right" id="rateanalR__1_totweightage" readonly/></td>
        <td>&nbsp;</td>
        <td style="border-right:none;" align="right" class="rate_pri"><label>Wastage Amount</label></td>
        <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totwastage" value = "" id="rateanalR__1_totwastage" readonly/></td>
        <td style="border-right:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="wasteRTr__1">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="wastemainRTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;"></div>
            <div id="divwasteR__1"></div>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label>Base Rate</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totbaserate" id="rateanalR__1_totbaserate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label>Qualifier Value</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totqualrate" id="rateanalR__1_totqualrate" readonly/></td>
        <td style="border-right:none;border-top:none;">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="qualTr__1">
                        <span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                    </a>
                </li>
            </ul>
        </td>

    </tr>
    <tr style="display:none;" class="qualmainTr__1">
        <td colspan="10" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;"></div>
            <?php echo $qualRHtml;?>
        </td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR__1_lbltotrate">Rate for</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totrate" id="rateanalR__1_totrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    <tr style="border-bottom:none;">
        <td colspan="6" style="border-right:none;border-top:none;" align="right" class="rate_pri"><label class="rate_pri" id="rateanalR__1_lbltotnetrate">Net Rate per</label></td>
        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totnetrate" id="rateanalR__1_totnetrate" readonly/></td>
        <td style="border-right:none;border-top:none;">&nbsp;</td>
    </tr>
    </tbody>
    <!--                  <tbody class="total" style="border: none;">-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;"></td>-->
    <!--                      <td style="border-right:none;" align="right" class="rate_pri">Rate for</td>-->
    <!--                      <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_totrate" id="rateanalR__1_totrate" readonly/></td>-->
    <!--                      <td style="border-right:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none; border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Rate per</td>-->
    <!--                      <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_perrate" id="rateanalR__1_perrate" readonly/></td>-->
    <!--                      <td style="border-right:none;border-top:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                    <tr style="border-bottom:none;">-->
    <!--                      <td style="border-right:none; border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;"></td>-->
    <!--                      <td style="border-right:none;border-top:none;" align="right" class="rate_pri">Net rate</td>-->
    <!--                      <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="rateanalR__1_netrate" id="rateanalR__1_netrate" readonly/></td>-->
    <!--                      <td style="border-right:none;border-top:none;">&nbsp;</td>-->
    <!--                    </tr>-->
    <!--                  </tbody>-->
</table>
<input type="hidden" name="rowinfoidR__1" id="rowinfoidR__1" value="1">
</div>
</div>
</div></td>
</tr>
</tbody>
</table>
</div>
<div id="dummywbs" style="display: none">
    <table id="dummywbstable">
        <tbody>
        <tr>
            <td width="15%"> <input class="parent_text" name="wbstable__1_wbsname__9" value="" id="wbstable__1_wbsname__9" onfocus="return CheckWBSFocus(this)"/></td>
            <td width="3%"> <input class="parent_text text-right" name="wbstable__1_qty__9" value="" id="wbstable__1_qty__9" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onchange="return wbsQtyChange(this.id)"/></td>
            <input type="hidden" name="wbstable__1_wbsid__9" id="wbstable__1_wbsid__9" value="">
            <td width="1%" class="action_btns_td">
                <ul class="action_btns">
                    <li style="float:left;"> <a href="javascript:void(0);" class="wbstable__1_TrDelete__9" style="display: none;" onclick="deleteWBS(this, event);"> <span><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></span> </a> </li>
                </ul>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="dummyactivity" style="display: none">
    <div class="darkmenu col-lg-12">
        <div class="col-lg-4">
            <ul>
                <li class="active"><a href="javascript:void(0);" name="analtypeM" id="analtype" class="ripple" onclick="showAnalmix('manual',this.id, event)"><span><i class="fa fa-magic"></i></span> Manual</a></li>
                <li><a href="javascript:void(0);"name="analtype" id="analtypeA" class="ripple" onclick="showAnalmix('machinery',this.id, event)"><span><i class="fa fa-cogs"></i></span> Machinery</a></li>
            </ul>
        </div>
        <div class="col-lg-8 lstatea manual_mac">
            <ul>
                <li>
                    <label >LS Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateL" id="analrateL" title="LS Rate" onblur="return FormatNum(this, 2,true)" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Manual Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateM" id="analrateM" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Machinery Rate</label>
                    <input class="parent_text text-right" type="text" name="analrateA" id="analrateA" onkeypress="return isDecimal(event,this)" readonly/>
                </li>
                <li>
                    <label>Rate Type</label>
                    <div class="select-style select-inline">
                        <select name="analrate" id ="analrate"  onchange="return MainRateUpdate(this)">
                            <option value="L" >LS </option>
                            <option value="M" >Manual </option>
                            <option value="A" >Machinery </option>
                        </select>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-lg-12 clear" id="activitymanual" style="margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right" name="activityAnalQty" id="activityAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12" id="activitymachinery" style="display: none; margin-bottom:5px;">
        <label class="lbl_style">Working Qty</label>
        <input type="text" class="parent_texters work_qt text-right"  name="activityRAnalQty" id="activityRAnalQty" onkeypress="return isDecimal(event,this)" readonly>
    </div>
    <div class="col-lg-12">
        <div class="table-responsive topsp animated fadeInUp">
            <!-- Manual tabs -->
            <table class="table" style="margin-bottom:0px;" id="activityrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr">Rate</th>
                    <th class="bg_clo_subTr">Amount</th>
                </tr>
                </thead>
                <tbody >
                <tr id="activityRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityresid_1" id ="activityresid_1" readonly ></td>
                    <!--<td width="5%"><input type="text" class="parent_text" name="activityresunit_1" id="activityresunit_1" readonly></td>-->
                    <td width="5%"><label for ="activityresunit_1" ></label></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresqty_1" id="activityresqty_1" readonly ></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityresrate_1" id="activityresrate_1" readonly></td>
                    <td width="8%"><input type="text" class="parent_text text-right" name="activityresamt_1" id="activityresamt_1" readonly ></td>
                    <input type="hidden" name="activityformula_1" value = "" id="activityformula_1">
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none; font-weight:600;" align="right" class="rate_pri"><label>Total</label></td>
                    <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activitytotrate" id="activitytotrate" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate Per Unit</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityperrate" id="activityperrate" readonly/></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="arowinfoid" id="arowinfoid" value="1">
            <!-- Machinery tabs -->
            <table class="table" style="display: none;margin-bottom:0px;" id="activityRrestable">
                <thead>
                <tr>
                    <th class="bg_clo_subTr">Resource name</th>
                    <th class="bg_clo_subTr">Unit</th>
                    <th class="bg_clo_subTr">Qty</th>
                    <th class="bg_clo_subTr">Rate</th>
                    <th class="bg_clo_subTr">Amount</th>
                </tr>
                </thead>
                <tbody >
                <tr id="activityRRowId_1">
                    <td width="25%"><input type="text" class="parent_text" name="activityRresid_1" id ="activityRresid_1" readonly ></td>
                    <td width="5%"><label for ="activityRresunit_1" ></label></td>
                    <!--<td width="8%"><input type="text" class="parent_text" name="activityRresunit_1" id="activityRresunit_1" readonly></td> -->
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresqty_1" id="activityRresqty_1"  readonly></td>
                    <td width="5%"><input type="text" class="parent_text text-right" name="activityRresrate_1" id="activityRresrate_1" readonly></td>
                    <td width="12%"><input type="text" class="parent_text text-right" name="activityRresamt_1" id="activityRresamt_1" readonly></td>
                    <input type="hidden" name="activityRformula_1" value = "" id="activityRformula_1">
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;"></td>
                    <td style="border-right:none;font-weight:600; vertical-align: middle; " align="right" class="rate_pri"><label>Total</label></td>
                    <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityRtotrate" id="activityRtotrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
                <tr style="border-bottom:none;">
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;"></td>
                    <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate Per Unit</label></td>
                    <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="activityRperrate" id="activityRperrate" onkeypress="return isDecimal(event,this)" readonly/></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="arowinfoidR" id="arowinfoidR" value="1">
        </div>
    </div>
</div>
<div id="dummysubiow" style="display: none">
    <tr class="subiow_1">
        <td width="100%"><div class="col-lg-12">
                <!-- Nav tabs -->
                <div class="darkmenu">
                    <ul>
                        <li class="active"><a href="javascript:void(0);" name="sanaltypeS" class="ripple" id="sanaltype" onclick="showSubIOWMix('sitemix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Sitemix</a></li>
                        <li><a href="javascript:void(0);" name="sanaltype" id="sanaltypeR" class="ripple" onclick="showSubIOWMix('readymix',this.id, event)"><span><i class="fa fa-caret-right"></i></span> Readymix</a></li>
                    </ul>
                    <div class="manual_seletc">
                        <label>Rate Type</label>
                        <div class="select-style select-inline">
                            <select name="analrate" id ="analrate" onchange="return MainRateUpdate(this)">
                                <option value="">Default Rate Type</option>
                                <option value="S" >SiteMix </option>
                                <option value="R" >ReadyMix </option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Tab panes -->
                <div class="lstate">
                    <ul  id="sraworktable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalAnalQty" id="srateanalAnalQty" title="Working Qty" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="subiowcement">
                            <label>Cement<span align="center" class="wrktype_label_span">(C)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalAQty" id="srateanalAQty" title="Cement (C)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="subiowsand">
                            <label>Sand<span align="center" class="wrktype_label_span">(S)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalBQty" id="srateanalBQty" title="Sand (S)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="subiowmetal">
                            <label>Aggregate<span align="center" class="wrktype_label_span">(A)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalCQty" id="srateanalCQty" title="Aggregate (A)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                        <li id="subiowthick">
                            <label>Thickness (mm)<span align="center" class="wrktype_label_span">(T)</span></label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalthick" id="srateanalthick" title="Thickness (mm) (T)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)"/>
                        </li>
                    </ul>
                    <ul  style="display: none;" id="sraworkRtable">
                        <li>
                            <label class="lbl_style">Working Qty</label>
                            <input type="text" class="col-lg-2 parent_texters text-right" name="srateanalRAnalQty" id="srateanalRAnalQty" title="Working Qty" onkeypress="return isDecimal(event,this)" readonly/>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp" style="overflow: visible;">
                    <!-- Sitemix tabs -->
                    <table class="table" style="margin-bottom:0px;" id="srateanalrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc / Exc</th>
                            <th class="bg_clo_subTr">Ref no</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Rate</th>
                            <th class="bg_clo_subTr">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalinc_1" value ="<?php echo true; ?>" id="srateanalinc_1" checked class="ios_checkbox inc_exc" readonly />
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="srateanalref_1">R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalresid_1" id ="rateanalresid_1" onblur="return CheckResValid(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" name="srateanalresqty_1" value = "" id="srateanalresqty_1" onfocus="return showformula(this.id)" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" onkeydown="return showF(this.id,event)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="5%"><label for ="srateanalresunit_1" ></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" name="srateanalresrate_1" id="srateanal_<?php echo $i;?>resrate_1" onfocus="return showAnalysis(this.id)" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" name="srateanalresamt_1" id="srateanalresamt_1" readonly onkeypress="return isDecimal(event,this)"/></td>
                            <input type="hidden" name="srateanalformula_1" value = "" id="srateanalformula_1">
                            <input type="hidden" name="srateanalrowrefid_1" value = "" id="srateanalrowrefid_1">
                            <input type="hidden" name="srateanaltype_1" value = "R" id="srateanaltype_1">
                            <input type="hidden" name="srateanalrefid_1" value = "1" id="srateanalrefid_1">
                            <input type="hidden" name="srateanalrestypeid_1" value = "" id="srateanalrestypeid_1">
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;" align="right" class="rate_pri"><label>Rate for</label></td>
                            <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanaltotrate" id="srateanaltotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanalperrate" id="srateanalperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Net rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanalnetrate" id="srateanalnetrate" readonly/></td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="srowinfoid" id="srowinfoid" value="1">
                    <!-- Readymix tabs -->
                    <table class="table" style="display: none;margin-bottom:0px;"  id="srateanalRrestable">
                        <thead>
                        <tr>
                            <th class="bg_clo_subTr">Inc / Exc</th>
                            <th class="bg_clo_subTr">Ref no</th>
                            <th class="bg_clo_subTr">Resource</th>
                            <th class="bg_clo_subTr">Coefficient</th>
                            <th class="bg_clo_subTr">Unit</th>
                            <th class="bg_clo_subTr">Rate</th>
                            <th class="bg_clo_subTr">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="srateanalRRowId_1">
                            <td width="1%"><label>
                                    <input type="checkbox" name="srateanalRinc_1" value = "<?php echo true; ?>" id="srateanalRinc_1" checked class="ios_checkbox inc_exc" readonly/>
                                    <div class="ios_switch"><span></span></div>
                                </label></td>
                            <td width="3%"><label for ="" >R1</label></td>
                            <td width="15%"><input class="parent_text" name="srateanalRresid_1" id ="rateanalRresid_1" onblur="return CheckResValid(this.id)" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" name="srateanalRresqty_1" id="srateanalRresqty_1" onblur="return FormatNum(this, 3)" onfocus="return showformulaR(this.id)" onkeypress="return isDecimal(event,this)" onkeydown="return showFR(this.id,event)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="5%"><label for ="srateanalRresunit_1"></label></td>
                            <td width="5%"><input class="parent_text text-right" type="text" name="srateanalRresrate_1" id="srateanalR_<?php echo $i;?>resrate_1"  onfocus="return showAnalysis(this.id,'R')" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" onchange="return ValueChange(this.id)" readonly/></td>
                            <td width="8%"><input class="parent_text text-right" type="text" name="srateanalRresamt_1" id="srateanalRresamt_1" readonly onkeypress="return isDecimal(event,this)" readonly/></td>
                            <input type="hidden" name="srateanalRformula_1" value = "" id="srateanalRformula_1">
                            <input type="hidden" name="srateanalRrowrefid_1" value = "" id="srateanalRrowrefid_1">
                            <input type="hidden" name="srateanalRtype_1" value = "R" id="srateanalRtype_1">
                            <input type="hidden" name="srateanalRrefid_1" value = "1" id="srateanalRrefid_1">
                            <input type="hidden" name="srateanalRrestypeid_1" value = "" id="srateanalRrestypeid_1">
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;"></td>
                            <td style="border-right:none;" class="rate_pri" align="right"><label>Rate for</label></td>
                            <td style="border-right:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanalRtotrate" id="srateanalRtotrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Rate per</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanalRperrate"id="srateanalRperrate" readonly/></td>
                        </tr>
                        <tr style="border-bottom:none;">
                            <td style="border-right:none; border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;"></td>
                            <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Net rate</label></td>
                            <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="srateanalRnetrate" id="srateanalRnetrate" readonly/></td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="srowinfoidR" id="srowinfoidR" value="1">
                </div>
            </div></td>
    </tr>
</div>
<div id="resourcemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Resource</h1>
            </div>
            <div class="modal-body">
                <input type="hidden" name="resrowid" id="resrowid" >
                <input type="hidden" id="refNewResRowName" />
                <div class="col-lg-12" <?php echo ($codegenType == 1) ? 'style="display:none;"': ''; ?>>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Code</label>
                        <input type="text" class="parent_text" maxlength="100" name="rescode" id="rescode" onblur="CheckResCode()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-12">
                        <label style="margin-bottom: 10px;">Resource Name</label>
                        <input type="text" class="parent_text" maxlength="255" name="resname" id="resname" onblur="CheckResName()">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Group</label>
                        <input type="text" class="parent_text" name="resgroup" id="resgroup" autocomplete="off">
                        <input type="hidden" name="resgroupid" id="resgroupid">
                    </div>
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Resource Type</label>
                        <input type="text" class="parent_text"  name="restype" id="restype" readonly>
                        <input type="hidden" name="restypeid" id="restypeid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Unit</label>
                        <input type="text" class="parent_text" name="resunit" id="resunit" autocomplete="off">
                        <input type="hidden" name="resunitid" id="resunitid">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkunit">
                        <label style="margin-bottom: 10px;">Working Unit</label>
                        <input type="text" class="parent_text" name="wresunit" id="wresunit" autocomplete="off">
                        <input type="hidden" name="wresunitid" id="wresunitid">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group col-lg-6">
                        <label style="margin-bottom: 10px;">Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="resrate" id="resrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                    <div class="form-group col-lg-6" id ="divworkrate">
                        <label style="margin-bottom: 10px;">Working Rate</label>
                        <input type="text" class="parent_text text-right" maxlength="15" name="wresrate" id="wresrate" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2)">
                    </div>
                </div>
                <div class="col-lg-12" id ="divmattype">
                    <div class="form-group col-lg-6">
                        <label>Material Type</label>
                        <div class="select-style rfc_meoption">
                            <select name="resmattype" id ="resmattype">
                                <option value="G">General</option>
                                <option value="F">Fuel</option>
                                <option value="S">Steel</option>
                                <option value="P">Production</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Lead Time (in Days)</label>
                        <input type="text" class="parent_text text-right"  name="restlead" maxlength="3" id="reslead" onkeypress="return isDecimal(event,this)">
                    </div>
                </div>
            </div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" onclick="return ResourceClose()"  data-toggle="tooltip"  title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="newresok" class="md_ok" onclick="return ResourceUpdate()" data-toggle="tooltip" data-original-title="OK"></button>
            </div>
        </div>
    </div>
</div>
<!--<div id="excelfieldmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">-->
<!--    <div class="modal-dialog modal-lg" style="width: 50%">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>-->
<!--                <h1>Work Group Import Sheet - Assign Fields</h1>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <div class="table-responsive popuptable animated fadeInUp">-->
<!--                    <table class="table" width="100%" style=" margin-bottom:0px;">-->
<!--                        <tbody>-->
<!--                        <tr id="excelfieldTable"></tr>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="clearfix"></div>-->
<!--            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>-->
<!--                <button type="button" class="md_ok" onclick="return fileupload(true)" >Next</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<div id="excelmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-lg" style="width: 90%">
<div class="modal-content">
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
    <h1>Item of Work Import Sheet - Validation Steps</h1>
</div>
<div class="modal-body model-middle">
<div class="col-lg-12">
    <div class="row">
        <div class="step_by_liner animated slideInDown"></div>
        <ul class="step_by stepby_mb23">
            <li class="opacity_08">
                <div id="divstep1" class="step_by_sep animated slideInRight">
                    <p>1</p>
                </div>
                <p id="p_1" class="stepli_p2">Fields</p>
            </li>
            <li class="opacity_08">
                <div id="divstep2" class="step_by_sep animated slideInRight">
                    <p>2</p>
                </div>
                <p id="p_2">RowType</p>
            </li>
            <li class="opacity_08">
                <div id="divstep3" class="step_by_sep animated slideInRight">
                    <p>3</p>
                </div>
                <p id="p_3">Workgroup</p>
            </li>
            <li class="opacity_08">
                <div id="divstep4" class="step_by_sep animated slideInRight">
                    <p>4</p>
                </div>
                <p id="p_4">Specification</p>
            </li>
            <li class="opacity_08">
                <div id="divstep5" class="step_by_sep animated slideInRight">
                    <p>5</p>
                </div>
                <p id="p_5">Library Reference</p>
            </li>
            <li class="opacity_08">
                <div id="divstep6" class="step_by_sep animated slideInRight">
                    <p>6</p>
                </div>
                <p id="p_6">WBS</p>
            </li>
            <li class="opacity_08">
                <div id="divstep7" class="step_by_sep animated slideInRight" >
                    <p>7</p>
                </div>
                <p id="p_7">Resource</p>
            </li>
            <li class="opacity_08">
                <div id="divstep8" class="step_by_sep animated slideInRight">
                    <p>8</p>
                </div>
                <p id="p_8">Units</p>
            </li>
            <li class="opacity_08">
                <div id="divstep9" class="step_by_sep animated slideInRight">
                    <p>9</p>
                </div>
                <p id="p_9">Finalise</p>
            </li>
        </ul>
    </div>
</div>
<div class="col-lg-12  col-md-12 col-sm-12 cnt_slider">
    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner" role="listbox">
            <div class="item active" id="divitem1">
                <div class="col-md-7 col-md-offset-3">
                    <h1 class="h1-head">Assign Fields</h1>
                    <div class="table-responsive popuptable animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                        <table class="table" width="100%" style=" margin-bottom:0px;">
                            <tbody>
                            <tr id="excelfieldTable"></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="item" id="divitem2">
                <h1 class="h1-head" id="excelboqname">Bill of Quantities</h1>
                <div class="table-responsive parent-scroll" id="diviowtable" style="display: block">
                    <table class="fixTable table" style="margin-bottom:0px;" id="excelTable">
                        <thead>
                        <tr>
                            <th class="th-modal">Lib Ref</th>
                            <th class="th-modal">Parent</th>
                            <th class="th-modal">RefNo</th>
                            <th class="th-modal">Specification</th>
                            <th class="th-modal">Unit</th>
                            <th class="th-modal">Qty</th>
                            <th class="th-modal text-right">Rate</th>
                            <th class="th-modal text-right">Amount</th>
                            <th class="th-modal text-right">Quote Rate</th>
                            <th class="th-modal text-right">Quote Amount</th>
                            <th class="th-modal">RowType</th>
                            <th class="th-modal">&nbsp; </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr id="excelrowid_1">
                            <td style="width:10%"><input type="text" class="parent_text"  id="excellibref_1" readonly></td>
                            <td style="width:10%"><input type="text" class="parent_text"  id="excelparent_1" ></td>
                            <td style="width:10%"><input type="text" class="parent_text"  id="excelserialno_1" ></td>
                            <!--                                            <td style="width:10%"><input type="text" class="parent_text"  name="excelcode_1" id="excelcode_1" ></td>-->
                            <td style="width:15%"><input type="text" class="parent_text"  id="excelspec_1" ></td>
                            <td style="width:5%"><input type="text" class="parent_text"  id="excelunit_1" onfocus="excelUnitFocus(this.id)" onchange="excelUnitvalid(this.id)"></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelqty_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelrate_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelamount_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:8%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelqrate_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" id="excelqamount_1" onkeypress="return isDecimal(event,this)"></td>
                            <td style="width:5%"><input type="text" class="parent_text"  id="excelrowtype_1" onchange="validRowType(this.id)"></td>
                            <td width="3%" align="center"><a href="javascript:void(0);" class="excelTrDelete_1" style="margin-right: 10px;display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></td>
                            <input type="hidden" id="exceliowid_1" >
                            <input type="hidden" id="excelparentid_1">
                            <input type="hidden" id="excelwgid_1" >
                            <input type="hidden" id="excelwbsid_1" >
                            <input type="hidden" id="excelwgtypeid_1" >
                            <input type="hidden" id="excelunitid_1" >
                            <input type="hidden" id="excelresid_1" >
                            <input type="hidden" id="excelrestypeid_1" >
                            <input type="hidden" id="excelnewresspec_1" >
                            <input type="hidden" id="excelnewworkgroupname_1" >
                            <input type="hidden" id="excelparentspec_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="item" id="divitem3">
                <h1 class="h1-head">Undefined WorkGroup</h1>
                <div class="table-responsive parent-scroll" id="divwgtable" style="display: block">
                    <table class="fixTable table" style="margin-bottom:0px;" id="excelwgTable">
                        <thead>
                        <tr>
                            <th>Undefined WorkGroup</th>
                            <th>Library WorkGroup</th>
                            <th>WorkType</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td style="width:35%"><input type="text" class="parent_text" id="excelunworkgroup_1" readonly></td>
                            <td style="width:30%"><input type="text" class="parent_text" id="excelrefworkgroup_1"></td>
                            <td style="width:30%"><input type="text" class="parent_text" id="excelrefworktype_1"></td>
                            <input type="hidden" id="excelrefworkgroupid_1" >
                            <input type="hidden" id="excelrefworktypeid_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="item" id="divitem4">
                <h1 class="h1-head">Undefined WBS</h1>
                <div class="table-responsive parent-scroll" id="divwbstable" style="display: block">
                    <table class="fixTable table" style="margin-bottom:0px;" id="excelwbsTable">
                        <thead>
                        <tr>
                            <th>Undefined WBS</th>
                            <th>WBS</th>
                            <!--                            <th>Parent WBS</th>-->
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td style="width:50%"><input type="text" class="parent_text" id="excelunwbs_1" readonly></td>
                            <td style="width:50%"><input type="text" class="parent_text" id="excelrefwbs_1" onfocus="return checkExcelWBSFocus(this.id)"></td>
                            <!--                            <td style="width:30%"><input type="text" class="parent_text" id="excelrefwbsparent_1"></td>-->
                            <input type="hidden" id="excelrefwbsid_1" >
                            <!--                            <input type="hidden" id="excelrefwbsparentid_1" >-->
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="item" id="divitem5">
                <h1 class="h1-head">Undefined Resource</h1>
                <div class="table-responsive parent-scroll form-group" id="divrestable" style="display: block">
                    <table class="fixTable table" style=" box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);border:1px solid #ddd" id="excelresTable">
                        <thead>
                        <tr>
                            <th style="width:20%" class="th-modal">Undefined Resource</th>
                            <th style="width:20%" class="th-modal">Resource</th>
                            <th style="width:20%" class="th-modal">Resource Group</th>
                            <th style="width:10%" class="th-modal">Unit</th>
                            <th style="width:10%" class="th-modal">Type</th>
                            <th style="width:10%" class="th-modal">MaterialType</th>
                            <th style="width:10%" class="th-modal text-right">WorkingUnit</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td style="width:20%"><input type="text" class="parent_text"  id="excelresresource_1" readonly></td>
                            <td style="width:20%"><input type="text" class="parent_text"  id="excelresoldresource_1" onfocus="return checkExcelResourceFocus(this.id)"></td>
                            <td style="width:20%"><input type="text" class="parent_text"  id="excelresresgroup_1"></td>
                            <td style="width:10%"><input style="display: none;" type="text" class="parent_text" id="excelresunit_1"></td>
                            <td style="width:10%"><input style="display: none;" type="text" class="parent_text" id="excelrestype_1" readonly></td>
                            <td style="width:10%">
                                <select style="display: none;" id ="excelresmaterialtype_1">
                                    <option value="G">General</option>
                                    <option value="F">Fuel</option>
                                    <option value="S">Steel</option>
                                    <option value="P">Production</option>
                                </select>
                            </td>
                            <td style="width:10%"><input style="display: none;" type="text" class="parent_text"  id="excelreswunit_1"></td>
                            <input type="hidden" id="excelresold_1" >
                            <input type="hidden" id="excelresunitid_1" >
                            <input type="hidden" id="excelresresgroupid_1" >
                            <input type="hidden" id="excelresrestypeid_1" >
                            <input type="hidden" id="excelreswunitid_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="item" id="divitem6">
                <h1 class="h1-head">Undefined Units</h1>
                <div class="table-responsive parent-scroll" id="divunittable" style="display: block">
                    <table class="fixTable table" style="margin-bottom:0px;" id="excelunitTable">
                        <thead>
                        <tr>
                            <th>Undefined Unit</th>
                            <th>Unit</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td style="width:50%"><input type="text" class="parent_text" id="excelununit_1" readonly></td>
                            <td style="width:50%"><input type="text" class="parent_text" id="excelrefunit_1"></td>
                            <input type="hidden" id="excelrefunitid_1" >
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<div class="clearfix"></div>
<div class="modal-footer">
    <div align="carousel">
        <a class="carousel-control md_ok" id="carouselNext" href="javascript:void(0);" data-slide="next">Next</a></div>
    <a style="display: none" class="carousel-control md_ok" id="carouselApply" href="javascript:IOWUpdate();">Apply</a></div>
</div>
</div>
</div>

<!-- Modal -->
<!-- WBS Master-->
<div class="modal fade bs-example-modal-lg" id="wbsmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-th-list"></i> WBS Master</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <div id="treeWrapper" style="display: none;">
                        <div class="bread_crumb first_step" id="tree-structure"></div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="table-responsive clear" style="overflow: visible;" id="grid-wrapper">
                        <div id='jqxWidget'>
                            <div id='jqxTree'></div>
                            <div id='jqxMenu'>
                                <ul>
                                    <li id="menu-newwbs">Add WBS</li>
                                    <li>Edit WBS</li>
                                    <li id="menu-removewbs">Remove WBS</li>
                                    <!--                               <li id="menu-addiow">Add IOW</li>-->
                                    <!--                               <li id="menu-showiow">Show IOW</li>-->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return wbsUpdate()" data-dismiss="modal">Apply</button>
            </div>
        </div>
    </div>
</div>
<!-- WBS Master end -->
<!-- multiple select end -->
<div class="modal fade bs-example-modal-lgs" id="iowmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i>Library IOW PickList</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <div class="table-responsive clear">
                        <div id="iowtree"> </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="return selectedIOWUpdate()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<!-- Face Sheet end -->
<div class="modal fade bs-example-modal-lg1" id ="facemodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-file-text"></i> Face Sheet</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible; animation-delay: 0.2s;">
                        <table class="fixTable table" style=" margin-bottom:0px;">
                            <thead>
                            <tr>
                                <th>RefNo</th>
                                <th>Specification</th>
                                <th>Unit</th>
                                <th class="text-right">Qty</th>
                                <th class="text-right">Rate</th>
                                <th class="text-right">Amount</th>
                                <th class="text-right">QRate</th>
                                <th class="text-right">QAmount</th>
                            </tr>
                            </thead>
                            <tbody id="facebody"></tbody>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td class="rate_pri text-right"><label>Total</label></td>
                                <td><input class="parent_text total-clr text-right" type="text" id="facetotal" readonly/></td>
                                <td>&nbsp;</td>
                                <td><input class="parent_text total-clr text-right" type="text" id="faceqtotal" readonly/></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <!--   <div class="modal-footer"> -->
            <!--   <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>-->
            <!--<!--   <button type="button" class="md_ok">OK</button>-->
            <!--            </div>-->
        </div>
    </div>
</div>
<!-- Face end -->
<div class="modal fade bs-example-modal-lg1" id ="qualifiermodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg modal-lg1">
        <div class="modal-content">
            <div class="modal-header col-sm-12">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1 class="col-sm-4 font-icon"><i class="fa fa-file-text"></i> Qualifier</h1>
                <div class="col-sm-7">
                    <label class="col-sm-3" style="padding-top:5px;text-align:right">Type</label>
                    <div class="col-sm-7">
                        <select name="qualtype" id="qualtype" class="form-control single_dropdown lbl_move"  style="width:100%;" onchange="return changeQual();">
                            <option value="1">Over all</option>
                            <option value="2">Work Group Wise</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-body" style="height:460px; overflow-y:scroll">
                <div id="divworkgroup"  class="col-lg-12" style="display: none"> </div>
                <div id="divqual" class="col-lg-12">
                    <?php  echo $qualGHtml; ?>
                </div>

            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="return applyQualifier()" >Apply</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lg1" id ="datamodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg modal-lg1">
        <div class="modal-content">
            <div class="modal-header col-sm-12">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1 class="col-sm-4 font-icon"><i class="fa fa-file-text"></i> Analytic Reports</h1>
                <div class="col-sm-7">
                    <label class="col-sm-3" style="padding-top:5px;text-align:right">Type</label>
                    <div class="col-sm-7">
                        <select name="reporttype" id="reporttype" class="form-control single_dropdown lbl_move"  style="width:100%;" onchange="return changeReport();">
                            <option value="1">Summary Sheet</option>
                            <option value="2">Work Group Summary</option>
                            <option value="3">Resource Type Summary</option>
                            <option value="4">Resource Summary</option>
                            <option value="5">BOQ Quoted Only</option>
                            <option value="6">BOQ Base Rate Only</option>
                            <option value="7">BOQ Base Vs Quoted</option>
                        </select></div>
                    <div class="col-md-2">
                        <a id="print" href="javascript:void(0);"><i class="fa fa-print print-icon"></i></a>
                    </div>
                </div>
            </div>
            <div class="modal-body" style="height:460px; overflow-y:scroll">
                <div id="divgrid" class="col-lg-12" style="display: none">
                    <div id="datagrid"></div>
                </div>
                <div id="divchart" class="col-lg-12" style="display: none">
                    <div class="col-lg-5">
                        <div id="datagrid1"></div>
                    </div>
                    <div class="col-lg-7">
                        <div id="chart1"></div>
                    </div>
                </div>
                <div id="divwg" class="col-lg-12" style="display: none">
                    <div id="datagrid2"></div>
                    <div id="chart2"></div>
                </div>
            </div>
            <div class="clearfix"></div>
            <!--   <div class="modal-footer"> -->
            <!--   <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>-->
            <!--<!--   <button type="button" class="md_ok">OK</button>-->
            <!--            </div>-->
        </div>
    </div>
</div>
<!-- Sequential View -->
<div class="modal fade bs-example-modal-lg3" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-clipboard"></i> Matrix View</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12"></div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance">Cancel</a>
                <button type="button" class="md_ok">OK</button>
            </div>
        </div>
    </div>
</div>
<!-- Sequential View end -->

<!--New Vendor Modal-->
<div id="NewOtherCostModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1 id="NewOtherCostModalHeader">Create Other Cost</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <input type="hidden" id="MNewOtherCostId"/>
                    <div class="row">
                        <div class="form-group col-lg-12">
                            <input type="text" id="MNewOtherCostName" class="form-control lbl_move" label="Name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-lg-12">
                            <select id="MNewOtherCostType" style="width:100%;" class="form-control single_dropdown lbl_move hei-43" data-size="5" label="Type">
                                <option></option>
                                <?php if(isset($ohtypes)):
                                    foreach($ohtypes as $type): if ($type['data'] !=1): ?>
                                        <option value="<?php echo $type['data']; ?>"><?php echo $type['value']; ?></option>
                                    <?php endif; endforeach; endif; ?>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer"> <a href="javascript:void(0);" class="md_cance" data-dismiss="modal"  data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" id="MNewOtherCostBtn" class="md_ok" onclick="return NewOtherCostUpdate()">Create</button>
            </div>
        </div>
    </div>
</div>
<!--Rate Apply Modal-->
<div id="RateApply" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h1>Quote % Apply</h1>
            </div>
            <div class="modal-body modal_body_min_h200">
                <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1">
                    <form class="form-horizontal">
                        <div class="form-group col-lg-12">
                            <div class="col-lg-8 col-md-8 col-lg-offset-2">
                                <div class="radio_check">
                                    <p class="col-lg-3">
                                        <input type="radio" value="1" id="applyAll" name="rateApply" onclick="return changeRateApply('1');" checked />
                                        <label for="applyAll" class="ripple">All</label>
                                    </p>
                                    <p class="col-lg-9">
                                        <input type="radio" value="2" id="wgwise" name="rateApply" onclick="return changeRateApply('2');" />
                                        <label for="wgwise" class="ripple">Work Group Wise</label>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class=" col-lg-12">
                            <div id="allInp" class="form-group col-lg-8 col-md-8 col-lg-offset-2" style="display:block;">
                                <input type="text" class="form-control parent_text" name="inpAll" value="" id="inpAll" onkeypress="return isDecimal(event,this)" maxlength="3" />
                            </div>
                            <div id="wgwiseInp" class="form-group col-lg-8 col-md-8 col-lg-offset-2" style="display:none;">
                            </div>
                            <div class="form-group col-lg-8 col-md-8 col-lg-offset-2">
                                <label style="margin-bottom: 10px; padding-top:5px;" class="col-lg-6 col-md-6 col-sm-6">Rounding Off</label>
                                <input type="text" style="width:50%;" class="col-lg-6 col-md-6 col-sm-6 parent_text" name="roundOff" value="" id="roundOff" onkeypress="return isDecimal(event,this)" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer clear">
                <button type="button" class="md_ok" onclick="return rateApply()" data-dismiss="modal" data-toggle="tooltip" data-original-title="OK">Apply</button>
            </div>
        </div>
    </div>
</div>

<!-- Sequential View -->
<div class="modal fade bs-example-modal-lg2" id="sequentialViewModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-clipboard"></i> Matrix View</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12" style="width: 100%; overflow-x: scroll;">
                    <table class="fixTable table" style=" margin-bottom:0px;" id="sequentialViewTable">
                        <thead>
                        <tr>
                            <th>From Library IOW</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="applySequentialValues()">Apply</button>
            </div>
        </div>
    </div>
</div>
<!-- Sequential View end -->
<script type="text/template" id="template-resource-summary">
    <tr>
        <td width="15%"><input class="parent_text" data-toggle="popover" type="text" name="rateresname__" id="rateresname__" readonly ></td>
        <td width="3%"><input class="parent_text" type="text" name="rateresunit__" id="rateresunit__" readonly ></td>
        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateresqty__" id="rateresqty__" readonly ></td>
        <td width="5%"><input  class="parent_text text-right" type="text" maxlength="15" name="rateresrate__" id="rateresrate__" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 2,true)" onchange="raterescalc(this)"></td>
        <td width="3%"><input class="parent_text text-right" type="text" maxlength="15" name="rateresamt__" id="rateresamt__" readonly ></td>
        <input type="hidden" name="rateresoldrate__" id="rateresoldrate__" >
        <input type="hidden" name="rateresid__" id="rateresid__" >
        <input type="hidden" name="ratetypeid__" id="ratetypeid__" >
    </tr>
</script>
<!--Dummy OtherCost New Row-->
<script id="dummy-new-othercost" type="text/template" class="hide">
    <tr class="padi05">
        <td width="30%" style="border-right:1px solid #ccc;"><input type="text" class="parent_padi05" name="NewOtherCostName__" id="NewOtherCostName__" align="right" readonly></td>
        <td width="3%"><button type="button" id="BtnNewOtherCostEdit__" onclick="return EditNewOtherCost(this.id)" style="margin:0;" > <i class="fa fa-pencil-square-o ctlss"></i> </button></td>
        <input type="hidden" name="NewOtherCostId__" id="NewOtherCostId__" >
        <input type="hidden" name="NewOtherCostType__" id="NewOtherCostType__" >
    </tr>
</script>

<script id="dummy-othercost" type="text/template" class="hide">
    <tr id="mainTr__">
        <input type="hidden" name="TransId__" id="TransId__"/>
        <input type="hidden" name="UpdateRow__" id="UpdateRow__"/>
        <td width="13%">
            <input class="parent_text OtherCostNameInputs" type="text" name="ohname__" id="ohname__" onfocus="return checkOHName(this.id)"/>
            <input type="hidden" class="OtherCostIdInputs" name="ohid__" id="ohid__"/>
        </td>
        <td width="12%">
            <input class="parent_text" type="text" name="ohtypename__" id="ohtypename__" readonly/>
            <input type="hidden" name="ohtypeid__" id="ohtypeid__"/>
        </td>
        <td width="10%"><input class="parent_text text-right" type="text" name="amount__" id="amount__" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" readonly/></td>
        <td width="3%" align="center">
            <ul class="action_btns">
                <li><a id="deleteTr__" onclick="deleteRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a id="expandTr__" href="javascript:void(0);" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li>
            </ul>
        </td>
    </tr>
    <!--expand table-->
    <tr style="display:none;" class="subTr"></tr>
    <!--expand end-->
</script>
<!--service,labour,item,material type table-->
<script id="dummy-type-1"  type="text/template" class="hide">
    <td colspan="12" style="padding:0px !important; "><div class="subDiv" style="display:none; overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th id='ohheader__'>Desc</th>
                            <th>Unit</th>
                            <th class="text-right">Qty</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="15%">
                                <input class="parent_text" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="5%" >
                                <input class="parent_text" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text text-right" type="text" name="type___qty_1" id="type___qty_1" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" maxlength="12" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___rate_1" id="type___rate_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="12%" >
                                <input class="parent_text text-right" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                            <td width="5%" align="center">
                                <ul class="action_btns">
                                    <li><a id="type___deleteTr_1" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                </ul>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script>
<!--general & advertisement type table-->
<script id="dummy-type-2"  type="text/template" class="hide">
    <td colspan="12" style="padding:0px !important; "><div class="subDiv" style="display:none; overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Expense</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___amount_1" id="type___amount_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcExpenseAmount(this);addNewTypeRow(this,'INPUTDATATYPE');" />
                            </td>
                            <td width="5%" align="center">
                                <ul class="action_btns">
                                    <li><a id="type___deleteTr_1" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                </ul>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script>
<!--salary type table-->
<script id="dummy-type-3"  type="text/template" class="hide">
    <td colspan="12" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Position</th>
                            <th>Nos</th>
                            <th>Salary Per Month</th>
                            <th>Working Months</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___nos_1" id="type___nos_1" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___salpermonth_1" id="type___salpermonth_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event, this)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___workingmonths_1" id="type___workingmonths_1" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___amount_1" id="type___amount_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
                            </td>
                            <td width="5%" align="center">
                                <ul class="action_btns">
                                    <li><a id="type___deleteTr_1" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                </ul>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script>
<!--fuel type table-->
<script id="dummy-type-4"  type="text/template" class="hide">
    <td colspan="12" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Plant & Machinery</th>
                            <th>Fuel</th>
                            <th>Unit</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Qty</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="13%">
                                <input class="parent_text" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="13%">
                                <input class="parent_text" type="text" name="type___fuel_1" id="type___fuel_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___fuelid_1" id="type___fuelid_1"/>
                            </td>
                            <td width="8%" >
                                <input class="parent_text" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___rate_1" id="type___rate_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___qty_1" id="type___qty_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                            <td width="5%" align="center">
                                <ul class="action_btns">
                                    <li><a id="type___deleteTr_1" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                </ul>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script>
<!--machinery type table-->
<script id="dummy-type-5"  type="text/template" class="hide">
    <td colspan="12" style="padding:0px !important; "><div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:350px;">
            <div class="col-lg-12">
                <div class="table-responsive topsp animated fadeInUp">
                    <table class="table" style="margin-bottom:0px;" id="OtherCostSubTable__">
                        <thead>
                        <tr>
                            <th>Plant & Machinery</th>
                            <th>Working Unit</th>
                            <th>Nos</th>
                            <th class="text-right">Working Qty</th>
                            <th class="text-right">Total Qty</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Amount</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <input type="hidden" name="type___TransId_1" id="type___TransId_1"/>
                            <input type="hidden" name="type___UpdateRow_1" id="type___UpdateRow_1"/>
                            <td width="15%">
                                <input class="parent_text" type="text" name="type___desc_1" id="type___desc_1" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
                                <input type="hidden" name="type___desctypeid_1" id="type___desctypeid_1"/>
                            </td>
                            <td width="5%" >
                                <input class="parent_text" type="text" name="type___unit_1" id="type___unit_1" readonly/>
                                <input type="hidden" name="type___unitid_1" id="type___unitid_1"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___nos_1" id="type___nos_1" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___wqty_1" id="type___wqty_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___tqty_1" id="type___tqty_1" readonly/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___rate_1" id="type___rate_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
                            </td>
                            <td width="10%" >
                                <input class="parent_text text-right" type="text" name="type___amount_1" id="type___amount_1" readonly/>
                            </td>
                            <td width="6%" align="center">
                                <ul class="action_btns">
                                    <li><a id="type___deleteTr_1" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                    <li> <a id="type___expandTr_1" href="javascript:void(0);" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li>
                                </ul>
                            </td>
                        </tr>
                        <tr style="display:none;" class="subTr">
                            <td colspan="12" style="padding:0px !important; ">
                                <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                                    <div class="col-lg-12">
                                        <div class="table-responsive topsp animated fadeInUp">
                                            <table class="table" style="margin-bottom:0px;" id="type___machinerySubTable_1">
                                                <thead>
                                                <tr>
                                                    <th>Item of Work</th>
                                                    <th>Percentage</th>
                                                    <th class="text-right">Amount</th>
                                                    <th>&nbsp;</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <input type="hidden" name="type___m_1_TransId_1" id="type___m_1_TransId_1"/>
                                                    <input type="hidden" name="type___m_1_UpdateRow_1" id="type___m_1_UpdateRow_1"/>
                                                    <td width="15%">
                                                        <input class="parent_text" type="text" name="type___m_1_desc_1" id="type___m_1_desc_1" onfocus="return checkMachineryName(this.id)" data-type="machineryiow"/>
                                                        <input type="hidden" name="type___m_1_desctypeid_1" id="type___m_1_desctypeid_1"/>
                                                    </td>
                                                    <td width="10%" >
                                                        <input class="parent_text text-right" type="text" name="type___m_1_per_1" id="type___m_1_per_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);"/>
                                                    </td>
                                                    <td width="10%" >
                                                        <input class="parent_text text-right" type="text" name="type___m_1_amount_1" id="type___m_1_amount_1" readonly/>
                                                    </td>
                                                    <td width="5%" align="center">
                                                        <ul class="action_btns">
                                                            <li><a id="type___m_1_deleteTr_1" onclick="deleteMachineryRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                            <input type="hidden" name="type___m_1_rowid" id="type___m_1_rowid" value="1"/>
                                            <input type="hidden" name="type___m_1_rowdeleteids" id="type___m_1_rowdeleteids" value="0"/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="type___rowid" id="type___rowid" value="1"/>
                    <input type="hidden" name="type___rowdeleteids" id="type___rowdeleteids" value="0"/>
                </div>
            </div>
        </div>
    </td>
</script>
<!--service,labour,item,material type tr-->
<script id="dummy-type-tr-1"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text text-right" type="text" name="type___qty_0" id="type___qty_0" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" maxlength="12" onchange="calcAmount(this);addNewTypeRow(this, 'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___rate_0" id="type___rate_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this, 'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___deleteTr_0" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<!--general & advertisement type tr-->
<script id="dummy-type-tr-2"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___amount_0" id="type___amount_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcExpenseAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___deleteTr_0" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<!--salary type tr-->
<script id="dummy-type-tr-3"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___nos_0" id="type___nos_0" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___salpermonth_0" id="type___salpermonth_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event, this)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___workingmonths_0" id="type___workingmonths_0" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcSalAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___amount_0" id="type___amount_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewTypeRow(this,'INPUTDATATYPE');" readonly/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___deleteTr_0" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<!--fuel type tr-->
<script id="dummy-type-tr-4"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="13%">
            <input class="parent_text" type="text" name="type___fuel_0" id="type___fuel_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___fuelid_0" id="type___fuelid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___rate_0" id="type___rate_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___qty_0" id="type___qty_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___deleteTr_0" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<!--machinery type tr-->
<script id="dummy-type-tr-5"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___TransId_0" id="type___TransId_0"/>
        <input type="hidden" name="type___UpdateRow_0" id="type___UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___desc_0" id="type___desc_0" data-type="INPUTDATATYPE" onfocus="return checkOHTypeName(this.id, 'INPUTDATATYPE')"/>
            <input type="hidden" name="type___desctypeid_0" id="type___desctypeid_0"/>
        </td>
        <td width="8%" >
            <input class="parent_text" type="text" name="type___unit_0" id="type___unit_0" readonly/>
            <input type="hidden" name="type___unitid_0" id="type___unitid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___nos_0" id="type___nos_0" onblur="return FormatNum(this, 0)" onkeypress="return isNumberKey(event)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___wqty_0" id="type___wqty_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___tqty_0" id="type___tqty_0" readonly/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___rate_0" id="type___rate_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryAmount(this);addNewTypeRow(this,'INPUTDATATYPE');"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___amount_0" id="type___amount_0" readonly/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___deleteTr_0" data-type="INPUTDATATYPE" onclick="deleteTypeRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                <li> <a id="type___expandTr_0" href="javascript:void(0);" class="mainTr" style="display: none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li>
            </ul>
        </td>
    </tr>
    <tr style="display:none;" class="subTr">
        <td colspan="12" style="padding:0px !important; ">
            <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                <div class="col-lg-12">
                    <div class="table-responsive topsp animated fadeInUp">
                        <table class="table" style="margin-bottom:0px;" id="type___machinerySubTable_0">
                            <thead>
                            <tr>
                                <th>Desc</th>
                                <th>Percentage</th>
                                <th class="text-right">Amount</th>
                                <th>&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <input type="hidden" name="type___m_0_TransId_1" id="type___m_0_TransId_1"/>
                                <input type="hidden" name="type___m_0_UpdateRow_1" id="type___m_0_UpdateRow_1"/>
                                <td width="13%">
                                    <input class="parent_text" type="text" name="type___m_0_desc_1" id="type___m_0_desc_1" onfocus="return checkMachineryName(this.id)" data-type="machineryiow"/>
                                    <input type="hidden" name="type___m_0_desctypeid_1" id="type___m_0_desctypeid_1"/>
                                </td>
                                <td width="10%" >
                                    <input class="parent_text text-right" type="text" name="type___m_0_per_1" id="type___m_0_per_1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);"/>
                                </td>
                                <td width="10%" >
                                    <input class="parent_text text-right" type="text" name="type___m_0_amount_1" id="type___m_0_amount_1" readonly/>
                                </td>
                                <td width="5%" align="center">
                                    <ul class="action_btns">
                                        <li><a id="type___m_0_deleteTr_1" onclick="deleteMachineryRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
                                    </ul>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <input type="hidden" name="type___m_0_rowid" id="type___m_0_rowid" value="1"/>
                        <input type="hidden" name="type___m_0_rowdeleteids" id="type___m_0_rowdeleteids" value="0"/>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</script>
<!--machinery tr-->
<script  id="dummy-machinery-tr"  type="text/template" class="hide">
    <tr>
        <input type="hidden" name="type___m__9_TransId_0" id="type___m__9_TransId_0"/>
        <input type="hidden" name="type___m__9_UpdateRow_0" id="type___m__9_UpdateRow_0"/>
        <td width="13%">
            <input class="parent_text" type="text" name="type___m__9_desc_0" id="type___m__9_desc_0" onfocus="return checkMachineryName(this.id)" data-type="machineryiow"/>
            <input type="hidden" name="type___m__9_desctypeid_0" id="type___m__9_desctypeid_0"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___m__9_per_0" id="type___m__9_per_0" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="calcMachineryPerAmount(this);addNewMachineryRow(this);"/>
        </td>
        <td width="10%" >
            <input class="parent_text text-right" type="text" name="type___m__9_amount_0" id="type___m__9_amount_0" readonly/>
        </td>
        <td width="5%" align="center">
            <ul class="action_btns">
                <li><a id="type___m__9_deleteTr_0" onclick="deleteMachineryRow(this, event);" style="display: none;"><i class="fa fa-trash-o" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script type="text/template" id="excelwbstd-template">
    <tr style="display:none;" class="excelwbsmainTr__1">
        <td colspan="12" style="padding:0px !important; ">
            <div class="col-lg-10 col-lg-offset-1" style="margin-top:10px; margin-bottom:10px;">
                <div class="subDiv" style="display:none;overflow-y:auto; min-height:100%; max-height:500px;">
                    <table class="table" style="margin-bottom:0px;" id="excelwbstable__1">
                        <thead>
                        <tr>
                            <th>WBS Name</th>
                            <th>Qty</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <input type="hidden" id="excelwbsrowid__1" value="0"/>
                </div>
            </div>
        </td>
    </tr>
</script>
<script type="text/template" id="excelwbstr-template">
    <tr>
        <td width="15%"><input class="parent_text" name="excelwbstable__1_wbsname__9" value="" id="excelwbstable__1_wbsname__9"/></td>
        <td width="3%"><input class="parent_text text-right" name="excelwbstable__1_qty__9" value="" id="excelwbstable__1_qty__9" onkeypress="return isDecimal(event,this)" /></td>
        <input type="hidden" name="excelwbstable__1_wbsid__9" id="excelwbstable__1_wbsid__9" value="">
    </tr>
</script>
<!--<script type="text/template" id="excelimport-template">-->
<!--    <tr>-->
<!--        <td style="width:10%"><input type="text" class="parent_text"  name="excelserialno__" id="excelserialno__" ></td>-->
<!--        <td style="width:10%"><input type="text" class="parent_text"  name="excelcode__" id="excelcode__" ></td>-->
<!--        <td style="width:40%"><input type="text" class="parent_text"  name="excelspec__" id="excelspec__" ></td>-->
<!--        <td style="width:10%"><input type="text" class="parent_text"  name="excelunit__" id="excelunit__" onfocus="excelUnitFocus(this.id)" onchange="excelUnitvalid(this.id)"></td>-->
<!--        <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelqty__" id="excelqty__" onkeypress="return isDecimal(event,this)"></td>-->
<!--        <td width="1%" id="excelwbstd__"></td>-->
<!--        <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelrate__" id="excelrate__" onkeypress="return isDecimal(event,this)"></td>-->
<!--        <td style="width:10%"><input type="text" class="parent_text text-right"  maxlength="15" name="excelamount__" id="excelamount__" onkeypress="return isDecimal(event,this)"></td>-->
<!--        <td width="3%" align="center"><a href="javascript:void(0);" class="excelTrDelete__" style="margin-right: 10px;display: none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></td>-->
<!--        <input type="hidden" name="excelrefslno__" id="excelrefslno__" >-->
<!--        <input type="hidden" name="excelrowtype__" id="excelrowtype__" >-->
<!--        <input type="hidden" name="exceliows__" id="exceliows__" >-->
<!--        <input type="hidden" name="exceliowid__" id="exceliowid__" >-->
<!--        <input type="hidden" name="excelparentid__" id="excelparentid__">-->
<!--        <input type="hidden" name="excelwgid__" id="excelwgid__" >-->
<!--        <input type="hidden" name="excelunitid__" id="excelunitid__" >-->
<!--        <input type="hidden" name="excelresid__" id="excelresid__" >-->
<!--        <input type="hidden" name="excelparentspec__" id="excelparentspec__" >-->
<!--    </tr>-->
<!--</script>-->
<script type="text/template" id="newwbs-tr-template">
    <tr>
        <td style="width:10%"><input type="text" class="parent_text" id="excelwbsparent__" readonly></td>
        <td style="width:10%"><input type="text" class="parent_text" id="excelwbs__" readonly></td>
    </tr>
</script>
<script type="text/javascript">
var arr_ohs = <?php echo (isset($arr_ohs)) ? json_encode($arr_ohs) : '[]'; ?>;
var tmp_arr_ohs = <?php echo (isset($arr_ohs)) ? json_encode($arr_ohs) : '[]'; ?>;
var arr_fuel_types = <?php echo (isset($oh_fueltypes)) ? json_encode($oh_fueltypes) : '[]'; ?>;
var arr_machinery_iows = <?php echo (isset($oh_items)) ? json_encode($oh_items) : '[]'; ?>;
var tmp_arr_machinery_iows = <?php echo (isset($oh_items)) ? json_encode($oh_items) : '[]'; ?>;
//var editid = <?php //echo (isset($editid)) ? $editid : 0; ?>//;
var editid =0;
var bShowAnalysis=false;
var arrresourceused = <?php echo (isset($resourceused)) ? json_encode($resourceused) : '[]'; ?>;

var arr_service = <?php echo (isset($oh_services)) ? json_encode($oh_services) : '[]'; ?>;
var arr_labour = <?php echo (isset($oh_labours)) ? json_encode($oh_labours) : '[]'; ?>;
var arr_item = <?php echo (isset($oh_items)) ? json_encode($oh_items) : '[]'; ?>;
var arr_material = <?php echo (isset($oh_materials)) ? json_encode($oh_materials) : '[]'; ?>;
var arr_adminexpense = <?php echo (isset($oh_adminexpenses)) ? json_encode($oh_adminexpenses) : '[]'; ?>;
var arr_salary = <?php echo (isset($oh_wfpositions)) ? json_encode($oh_wfpositions) : '[]'; ?>;
var arr_fuel = <?php echo (isset($oh_materialtypes)) ? json_encode($oh_materialtypes) : '[]'; ?>;
var arr_machinery = <?php echo (isset($oh_machineries)) ? json_encode($oh_machineries) : '[]'; ?>;

var arr_oh_types = [];
arr_oh_types['service'] = arr_service;
arr_oh_types['labour'] = arr_labour;
arr_oh_types['item'] = arr_item;
arr_oh_types['material'] = arr_material;
arr_oh_types['adminexpense'] = arr_adminexpense;
arr_oh_types['salary'] = arr_salary;
arr_oh_types['fuel'] = arr_fuel;
arr_oh_types['machinery'] = arr_machinery;

var tmp_arr_oh_types = [];
tmp_arr_oh_types['service'] = [];
tmp_arr_oh_types['labour'] = [];
tmp_arr_oh_types['item'] = [];
tmp_arr_oh_types['material'] = [];
tmp_arr_oh_types['adminexpense'] = [];
tmp_arr_oh_types['salary'] = [];
tmp_arr_oh_types['fuel'] = [];
tmp_arr_oh_types['machinery'] = [];

// New Other Cost Modal Elements
var $NewOtherCostWrapper = $('#NewOtherCostWrapper'),
    $NewOtherCostTable = $('#NewOtherCostTable'),
    $NewOtherCostModal = $('#NewOtherCostModal'),
    $NewOtherCostModalHeader = $('#NewOtherCostModalHeader'),
    $MNewOtherCostBtn = $('#MNewOtherCostBtn'),
    $MNewOtherCostId = $('#MNewOtherCostId'),
    $MNewOtherCostName = $('#MNewOtherCostName'),
    $MNewOtherCostType = $('#MNewOtherCostType');

// edit fns
var arr_rfcohtrans = <?php echo (isset($arr_rfcohtrans)) ? json_encode($arr_rfcohtrans) : '[]'; ?>;

$(function () {
    $(".content_wrapper").on('click','.mainTr', function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        }
        else{
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });

    $('.modal').on('shown.bs.modal', function () {
        $('body').removeClass('modal-open').addClass('modal-open').css('padding-right','10px');
    });

    // render rows on edit
    var $rowid = $('#ocrowid');
    var template = $('#dummy-othercost').html();
    var $tbody = $('#OtherCostTable').find('tbody');
    var rowid = parseInt($rowid.val());
    if(typeof arr_rfcohtrans != 'undefined' && arr_rfcohtrans.length !== 0) {
        $.each(arr_rfcohtrans, function (i, o) {
            rowid += 1;
            $tbody.append(template.replace(/__/g, '_' + rowid));

            // set values
            $('#TransId_' + rowid).val(o.RFCTransId);
            $('#ohname_' + rowid).val(o.OHName).prop('readonly', true);
            $('#ohid_' + rowid).val(o.OHId);
            $('#ohtypename_' + rowid).val(o.OHTypeName);
            $('#ohtypeid_' + rowid).val(o.OHTypeId);
            $('#amount_' + rowid).val(sanitizeNumber(o.Amount));

            $('#deleteTr_' + rowid).attr('onclick', 'deleteRow(this, event,true);').show();
            $('#expandTr_' + rowid).show();

            if(o.OHTypeId == 9 || o.OHTypeId == 10) {
                $('#expandTr_' + rowid).hide();
                $('#amount_' + rowid).prop('readonly', false);
            }

            // add type row priorly
            var arr_type_1 = ['1','2','3', '4'];
            var arr_type_names = {'1': 'item', '2': 'material', '3': 'labour', '4': 'service', '5': 'machinery', '6': 'adminexpense', '7': 'salary', '8': 'fuel'};
            var typeTemplate = '';

            if($.inArray(o.OHTypeId, arr_type_1) != -1) {
                typeTemplate = $('#dummy-type-1').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));

                if (o.OHTypeId==1) $('#ohheader_'+ rowid).text('Item of Work');
                if (o.OHTypeId==2) $('#ohheader_'+ rowid).text('Material Name');
                if (o.OHTypeId==3) $('#ohheader_'+ rowid).text('Labour Type');
                if (o.OHTypeId==4) $('#ohheader_'+ rowid).text('Service Name');


                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc).prop('readonly', true);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_qty_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Qty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate)).trigger('change');
                        $('#type_' + rowid + '_rate_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        $('#type_' + rowid + '_deleteTr_' + count).attr('onclick', 'deleteTypeRow(this, event, true);').show();
                        count++;
                    });
                }
            } else if(o.OHTypeId == 6) {
                typeTemplate = $('#dummy-type-2').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc).prop('readonly', true);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount)).trigger('change');
                        $('#type_' + rowid + '_amount_' + count).attr('onchange', 'calcExpenseAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_deleteTr_' + count).attr('onclick', 'deleteTypeRow(this, event, true);').show();
                        count++;
                    });
                }
            } else if(o.OHTypeId == 7) {
                typeTemplate = $('#dummy-type-3').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc).prop('readonly', true);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_nos_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Nos);
                        $('#type_' + rowid + '_salpermonth_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(sanitizeNumber(t.Salary));
                        $('#type_' + rowid + '_workingmonths_' + count).val(t.cMonths).trigger('change');
                        $('#type_' + rowid + '_workingmonths_' + count).attr('onchange', 'calcSalAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        $('#type_' + rowid + '_deleteTr_' + count).attr('onclick', 'deleteTypeRow(this, event, true);').show();
                        count++;
                    });
                }
            } else if(o.OHTypeId == 8) {
                typeTemplate = $('#dummy-type-4').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.Desc).prop('readonly', true);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.DescTypeId);
                        $('#type_' + rowid + '_fuel_' + count).val(t.Fuel);
                        $('#type_' + rowid + '_fuelid_' + count).val(t.FuelId);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_qty_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Qty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate)).trigger('change');
                        $('#type_' + rowid + '_rate_' + count).attr('onchange', 'calcAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        $('#type_' + rowid + '_deleteTr_' + count).attr('onclick', 'deleteTypeRow(this, event, true);').show();
                        count++;
                    });
                }
            } else if(o.OHTypeId == 5) {
                typeTemplate = $('#dummy-type-5').html();
                $('#mainTr_' + rowid).next('.subTr').html(typeTemplate.replace(/__/g, '_' + rowid).replace(/INPUTDATATYPE/g, arr_type_names[o.OHTypeId]));
                var count = 1;
                if(typeof o.typeTrans != 'undefined') {
                    $.each(o.typeTrans, function (i, t) {
                        $('#type_' + rowid + '_desc_' + count).val(t.ResourceName).prop('readonly', true);
                        $('#type_' + rowid + '_TransId_' + count).val(t.RFCTypeTransId);
                        $('#type_' + rowid + '_desctypeid_' + count).val(t.MResourceId);
                        $('#type_' + rowid + '_nos_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.Nos);
                        $('#type_' + rowid + '_unit_' + count).val(t.UnitName);
                        $('#type_' + rowid + '_unitid_' + count).val(t.UnitId);
                        $('#type_' + rowid + '_wqty_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);').val(t.WorkingQty);
                        $('#type_' + rowid + '_tqty_' + count).val(t.TotalQty);
                        $('#type_' + rowid + '_rate_' + count).val(sanitizeNumber(t.Rate)).trigger('change');
                        $('#type_' + rowid + '_rate_' + count).attr('onchange', 'calcMachineryAmount(this);addNewTypeRow(this,"'+arr_type_names[o.OHTypeId]+'",true);');
                        $('#type_' + rowid + '_amount_' + count).val(sanitizeNumber(t.Amount));
                        $('#type_' + rowid + '_deleteTr_' + count).attr('onclick', 'deleteTypeRow(this, event, true);').show();
                        $('#type_' + rowid + '_expandTr_' + count).show();
                        var mcount = 1;
                        $.each(t.details, function (i, d) {
                            $('#type_' + rowid + '_m_' + count + '_TransId_' + mcount).val(d.RFCMachineryDetailId);
                            $('#type_' + rowid + '_m_' + count + '_desc_' + mcount).val(d.Name);
                            $('#type_' + rowid + '_m_' + count + '_desctypeid_' + mcount).val(d.ProjectIOWId);
                            $('#type_' + rowid + '_m_' + count + '_per_' + mcount).val(d.Percentage).trigger('change');
                            $('#type_' + rowid + '_m_' + count + '_per_' + mcount).attr('onchange', 'calcMachineryPerAmount(this);addNewMachineryRow(this,true);');
                            $('#type_' + rowid + '_m_' + count + '_amount_' + mcount).val(sanitizeNumber(d.Amount));

                            $('#type_' + rowid + '_m_' + count + '_deleteTr_' + mcount).attr('onclick', 'deleteMachineryRow(this, event, true);');
                            mcount++;
                        });
                        count++;
                    });
                }
            }

            bindOHTypeAutocomplete(arr_type_names[o.OHTypeId]);
            if(o.OHTypeId == 8) {
                bindOHFuelTypeAutocomplete();
            }
        });
    }

    // init rows
    if (editid ==0) {
        rowid += 1;
        $tbody.append(template.replace(/__/g, '_' + rowid));
        $rowid.val(rowid);
        bindOHAutocomplete();
    } else {
        $rowid.val(rowid);
    }

    calcResQty();
    calcBoqAmount();

    var iRowId = parseInt(isNullCheck($('#rowid').val(),'number'));
    if (iRowId >1) $('#divExcelImport').hide();

});

function bindOHAutocomplete() {
    var $names = $('input[id^=ohname_]');
    $.each($names, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.unbind('autocomplete');
        $this.autocomplete({
            lookup: tmp_arr_ohs,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" class="btn btn-link" id="NewOtherCost_'+ key1 +'" value="Other Cost" onclick="AddNewOtherCost(\'#'+name+'\')" >',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $("#ohname_" + key1).prop('readonly', true);
                    $("#ohid_" + key1).val(suggestion.data);
                    $("#ohtypename_" + key1).val(suggestion.OHTypeName);
                    $("#ohtypeid_" + key1).val(suggestion.OHTypeId);
                    removeError($(this));

                    $('#expandTr_' + key1).show();
                    if(suggestion.OHTypeId == 9 || suggestion.OHTypeId == 10) {
                        $('#expandTr_' + key1).hide();
                        $('#amount_' + key1).prop('readonly', false);
                    }

                    // add type row priorly
                    var arr_type_1 = ['1','2','3', '4'];
                    var arr_type_names = {'1': 'item', '2': 'material', '3': 'labour', '4': 'service', '5': 'machinery', '6': 'adminexpense', '7': 'salary', '8': 'fuel'};
                    var template = '';
                    if($.inArray(suggestion.OHTypeId, arr_type_1) != -1) {
                        template = $('#dummy-type-1').html();
                    } else if(suggestion.OHTypeId == 6) {
                        template = $('#dummy-type-2').html();
                    } else if(suggestion.OHTypeId == 7) {
                        template = $('#dummy-type-3').html();
                    } else if(suggestion.OHTypeId == 8) {
                        template = $('#dummy-type-4').html();
                    } else if(suggestion.OHTypeId == 5) {
                        template = $('#dummy-type-5').html();
                    }

                    $('#mainTr_' + key1).next('.subTr').html(template.replace(/__/g, '_' + key1).replace(/INPUTDATATYPE/g, arr_type_names[suggestion.OHTypeId]));


                    if (suggestion.OHTypeId==1) $('#ohheader_'+ key1).text('Item of Work');
                    if (suggestion.OHTypeId==2) $('#ohheader_'+ key1).text('Material Name');
                    if (suggestion.OHTypeId==3) $('#ohheader_'+ key1).text('Labour Type');
                    if (suggestion.OHTypeId==4) $('#ohheader_'+ key1).text('Service Name');


                    addNewRow($(this));
                    bindOHTypeAutocomplete(arr_type_names[suggestion.OHTypeId]);
                    if(suggestion.OHTypeId == 8) {
                        bindOHFuelTypeAutocomplete();
                    }
                }
            }, onSearchStart: function(suggestion) {
                $("#ohid_" + key1).val(0);
                $("#ohtypename_" + key1).val('');
                $("#ohtypeid_" + key1).val(0);
                removeError($(this));
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    showError($(this), 'Required');
                    $("#ohid_" + key1).val(0);
                    $("#ohtypename_" + key1).val('');
                    $("#ohtypeid_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function bindOHTypeAutocomplete(type) {
    //console.log(type);
    var $names = $('input[id*=_desc_][data-type='+type+']');
    $.each($names, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var rowid = arrname[1];
        var key1 = arrname[3];
        $this.unbind('autocomplete');

        if(tmp_arr_oh_types[type].length == 0 || typeof tmp_arr_oh_types[type][rowid]  == 'undefined')
            tmp_arr_oh_types[type][rowid] =  arr_oh_types[type];

        $this.autocomplete({
            lookup: tmp_arr_oh_types[type][rowid],
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $("#type_"+rowid+"_desc_" + key1).prop('readonly', true);
                    $("#type_"+rowid+"_desctypeid_" + key1).val(suggestion.data);
                    $("#type_"+rowid+"_unit_" + key1).val(suggestion.UnitName);
                    $("#type_"+rowid+"_unitid_" + key1).val(suggestion.UnitId);
                    $("#type_"+rowid+"_rate_" + key1).val(suggestion.Rate);

                    removeError($(this));
                    addNewTypeRow($(this),type);
                }
            }, onSearchStart: function(suggestion) {
                $("#type_"+rowid+"_desctypeid_" + key1).val(0);
                $("#type_"+rowid+"_unit_" + key1).val('');
                $("#type_"+rowid+"_unitid_" + key1).val(0);
                $("#type_"+rowid+"_rate_" + key1).val(0);
                removeError($(this));
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
//                    showError($(this), 'Required');
                    $("#type_"+rowid+"_desctypeid_" + key1).val(0);
                    $("#type_"+rowid+"_unit_" + key1).val('');
                    $("#type_"+rowid+"_unitid_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function bindOHFuelTypeAutocomplete() {
    var $names = $('input[id*=_fuel_]');
    $.each($names, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var rowid = arrname[1];
        var key1 = arrname[3];
        $this.unbind('autocomplete');

        $this.autocomplete({
            lookup: arr_fuel_types,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $("#type_"+rowid+"_fuelid_" + key1).val(suggestion.data);
                    $("#type_"+rowid+"_unit_" + key1).val(suggestion.UnitName);
                    $("#type_"+rowid+"_unitid_" + key1).val(suggestion.UnitId);

                    removeError($(this));
                    addNewTypeRow($(this), 'fuel');
                }
            }, onSearchStart: function(suggestion) {
                $("#type_"+rowid+"_fuelid_" + key1).val(0);
                $("#type_"+rowid+"_unit_" + key1).val('');
                $("#type_"+rowid+"_unitid_" + key1).val(0);
                removeError($(this));
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    showError($(this), 'Required');
                    $("#type_"+rowid+"_fuelid_" + key1).val(0);
                    $("#type_"+rowid+"_unit_" + key1).val('');
                    $("#type_"+rowid+"_unitid_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function AddNewOtherCost(x) {
    $NewOtherCostModalHeader.html('Create Other Cost');
    $MNewOtherCostBtn.html('Create');
    $NewOtherCostModal.find('input').val(''); // reset modal inputs
    $NewOtherCostModal.data('mode', 'add').data('input', x).modal('show');
    $MNewOtherCostType.select2("enable", true);
    $('.autocomplete-suggestions').hide();
    $('#MNewOtherCostName').val($(x).val());
}

function ShowNewOtherCost() {
    if ($NewOtherCostTable.is(":hidden"))
        $NewOtherCostTable.show();
    else
        $NewOtherCostTable.hide();
}

function EditNewOtherCost(id) {
    var rowid = id.split('_')[1];

    $NewOtherCostModalHeader.html('Edit Other Cost');
    $MNewOtherCostBtn.html('Update');

    $NewOtherCostModal.find('input').val(''); // reset modal inputs
    $MNewOtherCostName.val($('#NewOtherCostName_' + rowid).val());
    $MNewOtherCostId.val($('#NewOtherCostId_' + rowid).val());
    $MNewOtherCostType.val($('#NewOtherCostType_' + rowid).val()).select2("enable", false);

    $NewOtherCostModal.data('mode', 'edit').data('id', rowid).modal('show');
}

function NewOtherCostUpdate() {
    if($MNewOtherCostName.hasClass('error')) // if already exitst
        return false;

    if($MNewOtherCostName.val().length == 0) {
        showError($MNewOtherCostName, 'Name is Required!');
        return false;
    } else
        removeError($MNewOtherCostName);

    if($MNewOtherCostType.val().length == 0) {
        showError($MNewOtherCostType, 'Type is Required!');
        return false;
    } else
        removeError($MNewOtherCostType);

    // add new other cost to array and form
    var $NewOtherCostRowId = $('#NewOtherCostRowId'),
        rowid = parseFloatVal($NewOtherCostRowId.val()),
        OtherCostName = $MNewOtherCostName.val(),
        OtherCostId = '',
        OtherCostTypeName = $.trim($MNewOtherCostType.find(':selected').html()),
        OtherCostTypeId = $MNewOtherCostType.val();

    if($NewOtherCostModal.data('mode') == 'add') {
        rowid += 1;
        $NewOtherCostTable.find('tbody').append($('#dummy-new-othercost').html().replace(/__/g, '_' + rowid));
        $NewOtherCostRowId.val(rowid);
        OtherCostId = 'New' + rowid;
        arr_ohs.push({
            data: OtherCostId,
            value: OtherCostName,
            OHTypeName: OtherCostTypeName,
            OHTypeId: OtherCostTypeId
        });
        $NewOtherCostWrapper.find('.badge').html(rowid);

        // set created OtherCost to prior field
        var refInput = $($NewOtherCostModal.data('input'));
        refInput.trigger('focus');
        refInput.val(OtherCostName).trigger('focus');
    } else {
        var oldOtherCostName = $('#NewOtherCostName_' + $NewOtherCostModal.data('id')).val(),
            index = getJsonArrayIndex(arr_ohs, 'value', oldOtherCostName);
        if(index != -1) {
            arr_ohs[index].value = OtherCostName;
            OtherCostId = arr_ohs[index].data;

            updateOtherCostInputs(OtherCostId, OtherCostName);
        }
        rowid = $NewOtherCostModal.data('id');
    }

    // set values
    $('#NewOtherCostName_' + rowid).val(OtherCostName);
    $('#NewOtherCostId_' + rowid).val(OtherCostId);
    $('#NewOtherCostType_' + rowid).val($MNewOtherCostType.val());
    $NewOtherCostModal.modal('hide');
    $NewOtherCostWrapper.show();
}

function updateOtherCostInputs(id, name) {
    $.each($('.OtherCostIdInputs[value="'+id+'"]'),function () {
        var $name = $(this).siblings('.OtherCostNameInputs');
        $name.val(name);
        $name.trigger('focus');
    });
}

function checkOHName(x) {
    var arrname = x.split('_'),
        id= arrname[1],
        typeids = $('input[id^=ohid_]');
    tmp_arr_ohs = arr_ohs;
    tmp_arr_ohs = $.grep(arr_ohs, function (element, index) {
        var is_selected = true;
        $.each(typeids, function (i, obj) {
            var $this = $(this),
                key = $this[0].id.split('_')[1];
            if (key != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });

    bindOHAutocomplete();
}

function addNewRow(x,updateFlag) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if(typeof updateFlag != 'undefined' && updateFlag) {
        $('#UpdateRow_' + key).val(1);
    }

    if ($tr.nextAll('tr:not(.subTr)').length != 0)
        return;

    if ($('#ohname_' + key).val().length == 0 || $('#ohid_' + key).val().length == 0 || $('#ohid_' + key).val() == 0
        || $('#ohtypename_' + key).val().length == 0)
        return;

    var $rowid = $('#ocrowid'),
        rowid = parseInt($rowid.val());
    $('#deleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-othercost').html();

    $tr.parent('tbody').append(template.replace(/__/g, '_' + count));
    $rowid.val(count);
}

function deleteRow(x,e,deleteFlag) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].id.split('_')[1];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');

    if(typeof deleteFlag != 'undefined' && deleteFlag) {
        var $ids = $('#rowdeleteids');
        $ids.val($ids.val() + ',' + $('#TransId_'+key).val());
    }

    $tr.next('.subTr').remove();
    $tr.remove();

    return false;
}

function calcAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var qty = parseFloatVal($('#type_'+rowid+'_qty_' + key).val()),
            rate = parseFloatVal($('#type_'+rowid+'_rate_' + key).val());

        total += qty * rate;
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(qty * rate));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
    calcOCTotalAmount();
}

function calcSalAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var nos = parseFloatVal($('#type_'+rowid+'_nos_' + key).val()),
            permonth = parseFloatVal($('#type_'+rowid+'_salpermonth_' + key).val()),
            wmonths = parseFloatVal($('#type_'+rowid+'_workingmonths_' + key).val());

        var subtotal = nos * (permonth * wmonths);
        total += subtotal;
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(subtotal));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total));
    calcOCTotalAmount();
}

function calcMachineryAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var nos = parseFloatVal($('#type_'+rowid+'_nos_' + key).val()),
            wqty = parseFloatVal($('#type_'+rowid+'_wqty_' + key).val()),
            rate= parseFloatVal($('#type_'+rowid+'_rate_' + key).val());

        var subtotal = rate * (nos * wqty);
        total += subtotal;
        $('#type_'+rowid+'_tqty_' + key).val(sanitizeNumber(nos * wqty,3));
        $('#type_'+rowid+'_amount_' + key).val(sanitizeNumber(subtotal,2,true));
    });

    $('#amount_' + rowId).val(sanitizeNumber(total,2,true));
    calcOCTotalAmount();
}

function calcExpenseAmount(x) {
    var rowId =  $(x)[0].id.split('_')[1];
    var total = 0;

    $.each($('input[id^=type_'+rowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            key = keys[3];
        var amt = parseFloatVal($('#type_'+rowid+'_amount_' + key).val());

        total += amt;
    });

    $('#amount_' + rowId).val(sanitizeNumber(total,2,true));
    calcOCTotalAmount();
}

function calcOCTotalAmount()
{
    var ocTotAmt = 0;
    $.each($('input[id^=amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            key = keys[1];
        var amt = parseFloatVal($('#amount_' + key).val());

        ocTotAmt += amt;
    });
    if(ocTotAmt > 0) {
        $('#ocTotalAmount').html(sanitizeNumber(ocTotAmt, 2, true));
        $('#otherCostAmount').val(sanitizeNumber(ocTotAmt, 2, true));
    }
    calcFinalAmount();
}

function calcFinalAmount()
{
    var finalAmt = 0;
    var perBaseAmt = 0;
    var perOcAmt = 0;
    var perQuAmt = 0;
    var baseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number'));
    var otherCostAmt = parseFloatVal(isNullCheck($('#otherCostAmount').val(),'number'));
    var quoteCostAmt = parseFloatVal(isNullCheck($('#quotedAmount').val(),'number'));

    finalAmt = baseAmt + otherCostAmt;
    if (finalAmt !=0) {
        perBaseAmt = (baseAmt/finalAmt * 100);
        perOcAmt = (otherCostAmt/finalAmt * 100);
        perQuAmt = ((quoteCostAmt - finalAmt) /finalAmt)*100;
    }

    if(finalAmt > 0) {
        $('#finalAmount').val(sanitizeNumber(finalAmt,2,true));
        $('#perBaseAmt').html(sanitizeNumber(perBaseAmt,2) + '%');
        $('#perOCAmt').html(sanitizeNumber(perOcAmt,2) + '%');
        $('#perFinalAmt').html(100 + '%');
        $('#perQuoteAmt').html(sanitizeNumber(perQuAmt,2) + '%');
    }
}

function calcBoqAmount()
{
    var boqAmt = 0,
        quoteAmt=0;

    $.each($('input[id^=amt_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            key = keys[1];
        var amt = parseFloatVal(isNullCheck($('#amt_' + key).val(),'number')),
            qamt = parseFloatVal(isNullCheck($('#qamt_' + key).val(),'number'));

        boqAmt += amt;
        quoteAmt += qamt;
    });

    $('#totalbasevalue').val(sanitizeNumber(boqAmt, 2, true));
    $('#totalquotevalue').val(sanitizeNumber(quoteAmt, 2, true));

    var tPer= 0;
    if (boqAmt !=0 && quoteAmt !=0) {
        tPer = ((quoteAmt-boqAmt)/boqAmt)*100;
    }
    $('#totalquoteper').val(sanitizeNumber(tPer, 2, true));

    if (quoteAmt > 0) $('#boqAmount').html(sanitizeNumber(quoteAmt, 2, true));
    else $('#boqAmount').html('');
    $('#baseAmount').val(sanitizeNumber(boqAmt, 2, true));
    $('#quotedAmount').val(sanitizeNumber(quoteAmt, 2, true));
    calcFinalAmount();
}

function addNewTypeRow(x,type,updateFlag) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        key = keys[3];

    if(typeof updateFlag != 'undefined' && updateFlag) {
        $('#type_'+rowid+'_UpdateRow_' + key).val(1);
    }

    if ($tr.nextAll('tr:not(.subTr)').length != 0)
        return;

    if ($('#type_'+rowid+'_desctypeid_' + key).val().length == 0 || $('#type_'+rowid+'_desctypeid_' + key).val() == 0 || $('#type_'+rowid+'_desc_' + key).val().length == 0
        || $('#type_'+rowid+'_amount_' + key).val().length == 0)
        return;

    $('#type_'+rowid+'_deleteTr_' + key).show();

    var $typerowid = $('#type_'+rowid+'_rowid'),
        typerowid = parseInt($typerowid.val());
    var count = typerowid + 1,
        template = '',
        type = $('#type_'+rowid+'_desc_' + key).attr('data-type');

    // add type row priorly
    var arr_type_names = {'1': 'item', '2': 'material', '3': 'labour', '4': 'service', '6': 'adminexpense', '7': 'salary'};
    if(type == 'adminexpense')
        template = $('#dummy-type-tr-2').html();
    else if(type == 'salary')
        template = $('#dummy-type-tr-3').html();
    else if(type == 'fuel')
        template = $('#dummy-type-tr-4').html();
    else if(type == 'machinery') {
        template = $('#dummy-type-tr-5').html();
        $('#type_'+rowid+'_expandTr_' + key).show();
    } else
        template = $('#dummy-type-tr-1').html();

    $tr.parent('tbody').append(template.replace(/__/g, '_' + rowid).replace(/_0/g, '_' + count).replace(/INPUTDATATYPE/g, type));
    $typerowid.val(count);

    bindOHTypeAutocomplete(type);
    if(type == 'fuel') {
        bindOHFuelTypeAutocomplete();
    } else if(type == 'machinery') {
        bindMachineryIOWAutocomplete();
    }
}

function deleteTypeRow(x,e,deleteFlag) {
    e.preventDefault();
    var $x = $(x),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        key = keys[3],
        type = $x.attr('data-type');

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');

    if(typeof deleteFlag != 'undefined' && deleteFlag) {
        var $ids = $('#type_'+rowid+'_rowdeleteids');
        $ids.val($ids.val() + ',' + $('#type_'+rowid+'_TransId_'+key).val());
    }

    $tr.next('.subTr').remove();
    $tr.remove();

    if(type == 'salary') {
        calcSalAmount(x);
        return false;
    }

    if(type == 'machinery') {
        calcMachineryAmount(x);
        return false;
    }

    calcAmount(x);
    return false;
}

function checkOHTypeName(x, type) {
    var arrname = x.split('_'),
        rowid=arrname[1],
        id=arrname[3],
        typeids = $('input[id^=type_'+rowid+'_desctypeid_]');
    tmp_arr_oh_types[type][rowid] =  arr_oh_types[type];
    tmp_arr_oh_types[type][rowid] = $.grep(arr_oh_types[type], function (element, index) {
        var is_selected = true;
        $.each(typeids, function (i, obj) {
            var $this = $(this),
                key = $this[0].id.split('_')[3];
            if (key != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });

    bindOHTypeAutocomplete(type);
}

function addNewMachineryRow(x,updateFlag) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        mrowid = keys[3],
        key = keys[5];

    if(typeof updateFlag != 'undefined' && updateFlag) {
        $('#type_'+rowid+'_m_'+mrowid+'_UpdateRow_' + key).val(1);
    }

    if ($tr.nextAll('tr:not(.subTr)').length != 0)
        return;

    if ($('#type_'+rowid+'_m_'+mrowid+'_desctypeid_' + key).val().length == 0 || $('#type_'+rowid+'_m_'+mrowid+'_desctypeid_' + key).val() == 0 || $('#type_'+rowid+'_m_'+mrowid+'_desc_' + key).val().length == 0
        || $('#type_'+rowid+'_m_'+mrowid+'_amount_' + key).val().length == 0)
        return;

    $('#type_'+rowid+'_m_'+mrowid+'_deleteTr_' + key).show();

    var $typerowid = $('#type_'+rowid+'_m_'+mrowid+'_rowid'),
        typerowid = parseInt($typerowid.val());
    var count = typerowid + 1;
    var template = '';
    template = $('#dummy-machinery-tr').html();

    $tr.parent('tbody').append(template.replace(/__9/g, '_' + mrowid).replace(/_0/g, '_' + count).replace(/___/g, '_' + rowid + '_'));
    $typerowid.val(count);
}

function calcMachineryPerAmount(x) {
    var keys =  $(x)[0].id.split('_'),
        rowId =  keys[1],
        mrowId =  keys[3];
    var total = 0,
        totalpercentage = 0;

    $.each($('input[id^=type_'+rowId+'_m_'+mrowId+'_amount_]'), function (i,o) {
        var keys = $(this)[0].id.split('_'),
            rowid = keys[1],
            mrowId = keys[3],
            key = keys[5];
        var totalAmt = parseFloatVal($('#type_'+rowId+'_amount_' + mrowId).val()),
            per = parseFloatVal($('#type_'+rowId+'_m_'+mrowId+'_per_' + key).val());

        totalpercentage += per;
        if(totalpercentage > 100) {
            per = 100 -  (totalpercentage - per);
            if (per < 0) per=0;
            $('#type_'+rowId+'_m_'+mrowId+'_per_' + key).val(sanitizeNumber(per,2));
        }
        var subtotal = totalAmt * (per / 100);
        $('#type_'+rowId+'_m_'+mrowId+'_amount_' + key).val(sanitizeNumber(subtotal,2,true))
        total += subtotal;

    });

    $('#amount_' + rowId).val(sanitizeNumber(total,2,true));

//        if(totalpercentage > 100) {
//            alert('Total percentage for ' + $('type_'+rowId+'_desc_'+mrowId).val() + ' should not exceed 100%');
//        }
}

function deleteMachineryRow(x,e,deleteFlag) {
    e.preventDefault();
    var $x = $(x),
        keys = $x[0].id.split('_'),
        rowid = keys[1],
        mrowid = keys[3],
        key = keys[5];

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');

    if(typeof deleteFlag != 'undefined' && deleteFlag) {
        var $ids = $('#type_'+rowid+'_m_'+mrowid+'_rowdeleteids');
        $ids.val($ids.val() + ',' + $('#type_'+rowid+'_m_'+mrowid+'_TransId_'+key).val());
    }

    $tr.remove();

    calcMachineryPerAmount(x);
    return false;
}

function bindMachineryIOWAutocomplete() {
    var $names = $('input[id*=_desc_][data-type=machineryiow]');
    $.each($names, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var rowid = arrname[1];
        var mrowid = arrname[3];
        var key1 = arrname[5];
        $this.unbind('autocomplete');

        $this.autocomplete({
            lookup: tmp_arr_machinery_iows,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $("#type_"+rowid+'_m_'+mrowid+"_desctypeid_" + key1).val(suggestion.data);

                    removeError($(this));
                    addNewMachineryRow($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#type_"+rowid+'_m_'+mrowid+"_desctypeid_" + key1).val(0);
                removeError($(this));
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    showError($(this), 'Required');
                    $("#type_"+rowid+'_m_'+mrowid+"_desctypeid_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function checkMachineryName(x) {
    var arrname = x.split('_'),
        rowid= arrname[1],
        mrowid= arrname[3],
        id= arrname[5],
        typeids = $('input[id^=type_'+rowid+'_m_'+mrowid+'_desctypeid_]');
    tmp_arr_machinery_iows = arr_machinery_iows;
    tmp_arr_machinery_iows = $.grep(arr_machinery_iows, function (element, index) {
        var is_selected = true;
        $.each(typeids, function (i, obj) {
            var $this = $(this),
                key = $this[0].id.split('_')[5];
            if (key != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });

    bindMachineryIOWAutocomplete();
}
</script>
<script type="text/javascript">
$(function () {
    $('body').tooltip({
        selector: '.error'
    });
});
var iFocusRowId=1;
var iTransRowId=0;
var bSiteMix=true;
var sWGUpdateMode='Add';
var sResUpdateMode='Add'
var arrres = <?php echo json_encode($reslist); ?>;
var arrrespicklist = <?php echo json_encode($respicklist); ?>;
var arrrespicklistR = [];
var arriowpicklist = <?php echo json_encode($iowpicklist); ?>;
var arriowpicklistR = [];
var arriowres = <?php echo json_encode($resiowlist); ?>;
var arrayreslist1 = $.map(arrres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'Resource' }}; });
var arrayreslist2 = $.map(arriowres, function (obj) { return {value: obj.value,id:obj.id,type:obj.type, data: { category: 'IOW' }}; });
var arrayreslist = arrayreslist1.concat(arrayreslist2);
var arrayprojworkgroup = <?php echo json_encode($projectworkgroup); ?>;
var arrayres = arrayreslist;
var arrayresR = arrayreslist;
var arrayunitlist = <?php echo json_encode($unit); ?>;
var arraywunitlist = <?php echo json_encode($wunit); ?>;
var arryparentList = <?php echo json_encode($parentiow); ?>;
var arrayworktype = <?php echo json_encode($worktype); ?>;
var arrayresgroup = <?php echo json_encode($resgroup); ?>;
var arrexcelresgroup = <?php echo json_encode($excelresgroup); ?>;
var arrexcelresource = <?php echo json_encode($excelresource); ?>;
var arrexcelresourceR = arrexcelresource;
var arrayworkgroup = <?php echo json_encode($workgroup); ?>;
var arrActivityAnal= [];
var arrActivityRes= [];
var arrSubIOW= [];
var arrSubIOWAnal= [];
var bLoad=false;

var $jqxTree = $('#jqxTree'),
    treePostData = [],
    arr_wbslist = [];

var arrExcelWBS =[];

var bexcelUpdate =false;
var bexcelRowTypeFound =false;
var bexcelUnitFound =false;
var bexcelResFound =false;
var bexcelWGFound =false;
var bexcelWBSFound =false;
var bexcelSheetValid =false;
var iExcelStep=0;

var bExcelSNo = false,
    bExcelRowType = false,
    bExcelSpec = false,
    bExcelUnit = false,
    bExcelQty = false,
    bExcelRate = false,
    bExcelAmount = false,
    bExcelQRate = false,
    bExcelQAmount = false;

var formData = new FormData();
var arrayField =[];
arrayField = [{ data :1, value: 'SerialNo' },
    { data :2, value: 'Specification' },
    { data :3, value: 'Unit' },
    { data :4, value: 'Qty' },
    { data :5, value: 'Rate' },
    { data :6, value: 'Amount' },
    { data :7, value: 'QRate' },
    { data :8, value: 'QAmount' },
    { data :9, value: 'RowType' },
];

var arrayFieldR = arrayField;

var arrayRowType =[];
arrayRowType = [{ data :1, value: 'I' },
    { data :2, value: 'R' },
    { data :3, value: 'H' },
    { data :4, value: 'WG' },
    { data :5, value: 'WBS' },
];

// Expand Script
function expandTrFn(reset) {
    var $mainTRs = $("a[class*=mainTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            $('rateanal_'+ key +'_restable').show();
            iFocusRowId = key;
            closedetails($(this)[0].className);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}
function expandResSubTr(tr, id) {
    var $subTr = $('#' + tr),
        $i = $('#' + id).find("i"),
        type = id.split('_')[0],
        rateanal = '#rateanal_';
    if (type.substr(type.length - 1) == 'R') rateanal = '#rateanalR_';
    if($subTr.length ==0) {
        var sStr = id.split('_');
        $(rateanal+ sStr[1] +'_resrate_' + sStr[3]).triggerHandler('focus');
        return;
    }
    if(!$subTr.is(":visible")){
        $subTr.show();
        $subTr.find(".subDiv").slideDown("slow");
        $i.addClass("tform");
    } else{
        $subTr.find(".subDiv").slideUp("slow");
        $subTr.slideUp("slow");
        $i.removeClass("tform");
    }
}
function bindAutoComplete() {
//    var $parent_ids = $('input[id*=parentid_]'),
    var  $proj_workgroups = $('input[id*=parentid_]'),
        $unitids = $('input[id*=unitid_]');

    // unbind previous autocomplete functionality
//    $parent_ids.unbind('autocomplete');
    $unitids.unbind('autocomplete');
    $proj_workgroups.unbind('autocomplete');
//    $.each($parent_ids, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
//        var key1 =  name.split('_')[1];
//        $this.autocomplete({
//            lookup: arryparentList,
//            showNoSuggestionNotice:true,
//            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newworkgroup_'+ key1  +'" class="btn btn-link" id="newworkgroup_'+ key1 +'" value="Work Group" onclick="return AddNewWorkGroup('+name+')" >',
//            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
//                if (queryLowerCase =='*') return suggestion.value;
//                else {
//                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
//                    return re.test(suggestion.value);
//                }
//            },
//            onSelect: function(suggestion) {
//                if(suggestion) {
//                    $("#parentkeyid_"+ key1).val(suggestion.data);
//                    GetIOWDetails(suggestion.data,"#parentkeyid_"+ key1)
//                    AddNewRowA("#parentkeyid_"+ key1, true);
//                    $(this).removeClass('error');
//                }
//            },
//            onSearchStart: function(suggestion) {
//                $("#parentkeyid_"+ key1).val(0);
//            },
//            onSearchComplete: function (query, suggestions) {
//                if(!suggestions.length){
//                    $(this).addClass('error');
//                    $("#parentkeyid_"+ key1).val(0);
//                } else $(this).removeClass('error');
//            }
//        });
//    });
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            //noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newunit_'+ key1  +'" class="btn btn-link" id="newunit_'+ key1 +'" value="Unit" onclick="return AddNewUnit('+name+')" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#unitkeyid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                    AddNewRowA(name);
                }
            },
            onSearchStart: function(suggestion) {
                $("#unitkeyid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#unitkeyid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });

    $.each($proj_workgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;

        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1)
            return;

        var key1 =  name.split('_')[1];
        var iLIOWid = parseInt(isNullCheck($('#libiowid_'+ key1),'number'));
        if (iLIOWid !=0) return;;

        $this.autocomplete({
            lookup: arryparentList,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newprojworkgroup_'+ key1  +'" class="btn btn-link" id="newprojworkgroup_'+ key1 +'" value="Project WorkGroup" onclick="return AddNewWorkGroup('+name+')">',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') {
                    return suggestion.value;
                }
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#parentkeyid_"+ key1).val(suggestion.data);
                    $("#worktypeid_"+ key1).val(suggestion.worktypeid);
                    $("#workgroupid_"+ key1).val(suggestion.workgroupid);
                    $("#pworkgroupid_"+ key1).val(suggestion.pworkgroupid);
                    $("#pworkgroupname_"+ key1).val(suggestion.workgroupname);
                    $("#piowid_"+ key1).val(suggestion.iowid);
                    $("#newparentname_"+ key1).val(suggestion.parentname);

                    CheckParentValid('parentid_'+key1);
                    GetWorkTypeDetails(suggestion.worktypeid,"parentid_"+ key1);
                    bindLibraryIOW(suggestion.worktypeid,"libiowid_"+ key1)

//                    $("#workgroupid_"+ key1).val(suggestion.data);
//                    $("#pworkgroupname_"+ key1).val(suggestion.WorkGroupName);
//                    $("#worktypeid_"+ key1).val(suggestion.WorkTypeId);
//                    $("#worktypename"+ key1).val(suggestion.WorkType);
//                    GetWorkTypeDetails(suggestion.WorkTypeId,"workgroupname_"+ key1);
//                    bindLibraryIOW(suggestion.WorkTypeId,"parentid_"+ key1)
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#parentkeyid_"+ key1).val(0);
                $("#workgroupid_"+ key1).val(0);
                $("#pworkgroupid_"+ key1).val(0);
                $("#pworkgroupname_"+ key1).val('');
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    $(this).addClass('error');
                    $("#parentkeyid_"+ key1).val(0);
                    $("#workgroupid_"+ key1).val(0);
                    $("#pworkgroupid_"+ key1).val(0);
                    $("#pworkgroupname_"+ key1).val('');
                } else
                    $(this).removeClass('error');
            }
        });
    });

}
function bindPopOver() {
    var $inputs =  $('input[data-toggle="popover"]');
    $inputs.unbind('popover');
    $inputs.popover({
        placement : 'auto left',
        trigger : 'hover'
    });
}

function bindResourceChange() {
    var $resnames = $('input[id*=_resid_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $('#'+ name).attr('data-content', $('#'+ name).val());
        $this.blur(function () {
            if (isNullCheck($('#'+ name).val(),'string') =="") $this.removeClass('error')
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
        $this.change(function () {
            $('#'+ name).attr('data-content', $('#'+ name).val());
        });
    });
}

function bindResourceAutoComplete() {
    var $resids = $('input[id*=resid_]');
    // unbind previous autocomplete functionality
    $resids.unbind('autocomplete');
    $.each($resids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_'),
            key1 = arrname[1],
            key2 = arrname[3],
            sname = arrname[0];
        if (sname.substr(sname.length-1) === 'R') {
            var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayresR,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id, key1, key2, "R");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id, key1, key2, "R");
                        }
                        var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + (parseInt(key2) + 1));
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowResR(key1,key2);
                            $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        } else {
            var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
                $resname = $('#rateanal_' + key1 + '_resid_' + key2);
            $this.autocomplete({
                lookup: arrayres,
                groupBy: 'category',
                multiselect:true,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
                lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase =='*') return suggestion.value;
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function(suggestion) {
                    if(suggestion) {
                        $resname.prop('disabled', true);
                        if (suggestion.data.category == "Resource") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                            $("#rateanal_" + key1 + "_type_" + key2).val('R');
                            cboResChanged(suggestion.id,key1, key2,"");
                        } else if (suggestion.data.category == "IOW") {
                            $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                            $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                            $("#rateanal_" + key1 + "_type_" + key2).val('I');
                            cboIOWChanged(suggestion.id,key1, key2,"");
                        }
                        var $rateanal =  $('#rateanal_'+key1+'_RowId_' + (parseInt(key2) + 1));
                        if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                            AddNewRowRes(key1,key2);
                            $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                        }
                        $(this).removeClass('error');
                    }
                },
                onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        $(this).addClass('error');
                        $resunit.html('');
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                    } else $(this).removeClass('error');
                }
            });
        }
    });
}
function bindResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    var sName = arr_names[0];
    if (sName.substr(sName.length-1) == 'R') {
        checkResource(key1,"R");
        var $resunit = $("label[for='rateanalR_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanalR_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayresR,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanalR_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanalR_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanalR_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeaderR(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id, key1, key2, "R");
                    }
                    else if (suggestion.data.category == "IOW") {
                        $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanalR_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id, key1, key2, "R");
                    }
                    var $rateanal =  $('#rateanalR_' + key1 + '_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowResR(key1,key2);
                        $('#rateanalR_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanalR_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanalR_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    } else {
        checkResource(key1,"");
        var $resunit = $("label[for='rateanal_" + key1 + "_resunit_"+key2+"']"),
            $resname = $('#rateanal_' + key1 + '_resid_' + key2);
        $this.autocomplete({
            lookup: arrayres,
            groupBy: 'category',
            multiselect:true,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newres_'+key2+'" class="btn btn-link" id="rateanal_' + key1 + '_newres_'+key2+'" value="Resource" onclick="return AddNewResource('+name+')" > or <input type="button" font-weight:bold" name="rateanal_' + key1 + '_newhead_'+key2+'" class="btn btn-link" id="rateanal_' +  key1 +  '_newhead_'+key2+'" value="Header" onclick="return AddNewRowResHeader(this)" >',
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $resname.prop('disabled', true);
                    if (suggestion.data.category == "Resource") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(suggestion.id);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                        $("#rateanal_" + key1 + "_type_" + key2).val('R');
                        cboResChanged(suggestion.id,key1, key2,"");
                    } else if (suggestion.data.category == "IOW") {
                        $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                        $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(suggestion.id);
                        $("#rateanal_" + key1 + "_type_" + key2).val('I');
                        cboIOWChanged(suggestion.id,key1, key2,"");
                    }
                    var $rateanal =  $('#rateanal_'+key1+'_RowId_' + (parseInt(key2) + 1));
                    if ($rateanal.length == 0 || ($rateanal.length == 1 && $rateanal.hasClass('row_header'))) {
                        AddNewRowRes(key1,key2);
                        $('#rateanal_' + key1 + '_resqty_' + key2).focus();
                    }
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $resunit.html('');
                    $('#rateanal_' + key1 + '_reskeyid_' + key2).val(0);
                    $('#rateanal_' + key1 + '_iowkeyid_' + key2).val(0);
                } else $(this).removeClass('error');
            }
        });
    }
}
function bindTRDeleteFn(reset) {
    var $trDelete = $('a[class*=mainTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className,
            key =  name.split('_')[1];
        if (name.indexOf('__') != -1) return;
        if ($('#spec_' + key).val().length ==0) return;
        if ($('#refserialno_' + key).val().length ==0) return;
        $this.on('click', function(e) {
            e.preventDefault();
            if (confirm('Do you want to Delete')) {
//                var tr_length = $('#sample12 > tbody tr[id*=IOWiRowId_]').length;
//                //alert(tr_length);
//                if(tr_length == 1) {
//                    $('#rowid').val(0);
//                    AddNewRowA(name);
//                }
                $this.closest('tr').nextAll('.subTr_' + key)[0].remove();
                $this.closest('tr').remove();
            }
            return false;
        });
    });
}
function bindMixSortablefn(reset) {
    // ReadyMix sortable function
    var $rBody = $('table[id*=rateanalR_] tbody.sorting'),
        $sBody = $('table[id*=rateanal_] tbody.sorting');
    $.each($rBody, function(i, obj){
        if ($(this).parent('table')[0].id.indexOf('__') != -1) {
            $rBody.splice(i, 1);
            $sBody.splice(i, 1);
        }
    });
    var $sRTable = $rBody.find('tr'),
        $sTable = $sBody.find('tr');
    if (typeof reset !== 'undefined' && reset === true) {
        $sRTable.unbind('click', 'dblclick', 'select', 'sortable');
        $sTable.unbind('click', 'dblclick', 'select', 'sortable');
        $rBody.unbind('sortable');
        $sBody.unbind('sortable');
    }
    $sRTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sRTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sRTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $rBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrderR(ifrow);
        }
    });
    // SiteMix sortable function
    $sTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
    $sTable.on( 'click', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sTable.on( 'select', function () {
        var $this = $(this);
        $this.closest("tr").siblings().removeClass("highlighted");
        $this.toggleClass('highlighted',true);
        $this.closest("tr").find(".divwastage").show();
        $this.closest("tr").siblings().find(".divwastage").hide();
    });
    $sBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrder(ifrow);
        }
    });
}
$(function () {
    if ($('#rfcmode').val().trim() == "edit" || $('#rfcmode').val().trim() == "revise") {
        var url1 = getBaseURL() + "project/rfc/getrfciowpicklist";
        var rfcsource =
        {
            async: false,
            dataType: "json",
            dataFields: [
                {name: 'IOWId', type: 'number'},
                {name: 'SerialNo', type: 'string'},
                {name: 'WorkGroupName', type: 'date'},
                {name: 'Specification', type: 'string'},
                {name: 'available', type: 'boolean'}
            ],
            id: 'ResourceId',
            url: url1
        };
        var rfcdata = new $.jqx.dataAdapter(rfcsource);
        $("#grid").jqxGrid({
            width: "100%",
            height: 436,
            rowsheight: 35,
            pagerButtonsCount: 6,
            pagesize: 10,
            source: rfcdata,
            pageable: true,
            sortable: true,
            altrows: true,
            enabletooltips: true,
            editable: true,
            selectionmode: 'singlerow',
            columns: [
                {text: 'IOWId', datafield: 'IOWId', hidden: true},
                {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '10%'},
                {text: 'WorkGroupName', datafield: 'WorkGroupName', 'editable': false, width: '20%'},
                {text: 'Specification', datafield: 'Specification', 'editable': false, width: '60%'},
                {text: '&nbsp;', align:'center', datafield: 'available', columntype: 'checkbox', width: '10%'},
            ]
        });
        $("#grid").bind('cellendedit', function (event) {
            if (event.args.value) $("#grid").jqxGrid('selectrow', event.args.rowindex);
            else $("#grid").jqxGrid('unselectrow', event.args.rowindex);
        });
    }
    var $formulaExp = $("#formulaexp");
    $('#formula').on('shown.bs.modal', function () {
        $formulaExp.focus();
        $formulaExp.select();
    });
    $('#lworktype').autocomplete({
        lookup: arrayworktype,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#lworktypeid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#lworktypeid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $("#lworktypeid").val(0);
            } else
                $(this).removeClass('error');
        }
    });

    $('#lworkgroup').autocomplete({
        lookup: arrayworkgroup,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#lworkgroup_id").val(suggestion.data);
                $("#lworktype").val(suggestion.WorkType);
                $("#lworktypeid").val(suggestion.WorkTypeId);
                $("#lworktype").prop('readonly', true);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#lworkgroup_id").val(0);
            $("#lworktype").val('');
            $("#lworktypeid").val(0);
            $("#lworktype").prop('readonly', false);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $("#lworkgroup_id").val(0);
                $("#lworktype").val('');
                $("#lworktypeid").val(0);
                $("#lworktype").prop('readonly', false);
            } else
                $(this).removeClass('error');
        }
    });

    $('#resgroup').autocomplete({
        lookup: arrayresgroup,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resgroupid").val(suggestion.data);
                $('#restype').val(suggestion.TypeName);
                $('#restypeid').val(suggestion.TypeId);
                $('#divworkunit').hide();
                $('#divworkrate').hide();
                $('#divmattype').hide();
                if (suggestion.TypeId== 2) $('#divmattype').show();
                if (suggestion.TypeId== 3) { $('#divworkunit').show();$('#divworkrate').show();}
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resgroupid").val(0);
            $('#divworkunit').hide();
            $('#divworkrate').hide();
            $('#divmattype').hide();
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $("#resgroupid").val(0);
            } else
                $(this).removeClass('error');
        }
    });
    $('#resunit').autocomplete({
        lookup: arrayunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#resunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#resunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $("#resunitid").val(0);
            } else
                $(this).removeClass('error');
        }
    });
    $('#wresunit').autocomplete({
        lookup: arraywunitlist,
        multiselect:true,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#wresunitid").val(suggestion.data);
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#wresunitid").val(0);
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $("#wresunitid").val(0);
            } else $(this).removeClass('error');
        }
    });
    // modal forms on close
    $('#resourcemodal').on('hidden.bs.modal', function () {
        $(this).find('input').val('');
    });
    $('#workgroupmodal').on('hidden.bs.modal', function () {
        $(this).find('input[type=text]').val('');
        $(this).find('input[type=checkbox]').removeAttr('checked');
        $(this).find('input[type=radio]').removeAttr('checked');
    });
    bindMixSortablefn();
    expandTrFn();
    bindTRDeleteFn();
    expandwasteTrFn();
    expandwbsTrFn();
    bindQualExpandTr();
    bindAutoComplete();
    bindResourceAutoComplete();
    bindResourceChange();
    getWBSMasterList();
    bindWBSautoComplete();
    // on edit from rfc bind subrow rateanalysis
    if($('#quotationId').val() != 0) {
        var $resrate = $('input[id*=_resrate_]');
        $.each($resrate, function() {
            var x = $(this)[0].id,
                arrname = x.split('_');

            if (x.indexOf('__') != -1)
                return;

            var key1 = arrname[1],
                key2 = arrname[3],
                name = arrname[0] + '_' + key1,
                id = 0;

            if($("#" + name + "_type_" + key2).val() != 'I') {
                if (parseInt(isNullCheck($("#" + name + "_restypeid_" + key2).val(),'number')) ==4) {
                    id = $('#' + name + '_reskeyid_' + key2).val();
                    bLoad = true;
                    if (arrname[0].charAt(arrname[0].length - 1) == 'R') cboResChanged(id, key1, key2, "R");
                    else cboResChanged(id, key1, key2, "");
                    bLoad = false;
                } else {
                    if (isNullCheck($("#" + name + "_resid_" + key2).val(),'string') != "") {
                        var ssname = name + '_resunit_' + key2;
                        var qty = 0;
                        var dbOQqty = parseFloatVal(isNullCheck($('#qty_' + key1).val(),'number'));
                        var analQty = parseFloatVal($("#" + name + "_AnalQty").val());

                        var dResQty = parseFloatVal(isNullCheck($("#" + name + "_resqty_" + key2).val(),'number'));
                        var dWasteQty = parseFloatVal(isNullCheck($("#" + name + "_WastageQty_" + key2).val(),'number'));

                        if(analQty != 0) qty =  ((dResQty+dWasteQty) / analQty)*dbOQqty;
                        var iTypeId = $("#" + name + "_restypeid_" + key2).val();

                        RateResourceUpdate($("#" + name + "_resid_" + key2).val(), $("label[for=" + ssname + "]").html(),
                            $("#" + name + "_resrate_" + key2).val(), $("#" + name + "_reskeyid_" + key2).val(),qty,iTypeId);
                    }
                }
            }
            else {
                id = $('#'  + name + '_iowkeyid_' + key2).val();
                if (arrname[0].charAt(arrname[0].length - 1) == 'R') cboIOWChanged(id, key1, key2, "R");
                else cboIOWChanged(id, key1, key2, "");
            }

        });
    }
    checkRAUsed();
});
function submitForm() {
    $('#mainform').submit();
}
function DeleteResource(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId = sStr[1];
    var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanal_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanal_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoid_' + iFocusRowId).val(),
            $resname =  $('#rateanal_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrder(iFocusRowId);
        checkRAUsed();
//        var $row = $('#rateanal_' + iFocusRowId + '_RowId_' + iARowid),
//            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid),
//            tr_length = $('tr[id*=rateanal_' + iFocusRowId + '_RowId_]').length,
//            irid =   $('#rowinfoid_' + iFocusRowId).val(),
//            $lrow = $('#rateanal_' + iFocusRowId + '_RowId_' + irid),
//            $tr_resqty = $('input[id*=rateanal_' + iFocusRowId + '_resqty_]');
//        if (tr_length > 2) {
//            $lrow.remove();
//            $row.remove();
//            $tr_resactivity.remove();
//            $('#rowinfoid_' + iFocusRowId).val(irid-1);
//            AddNewRowRes(iFocusRowId);
//            $tr_resqty.trigger('change');
//        } else {
//            $('#rowinfoid_' + iFocusRowId).val(0);
//            if (tr_length != 2) { AddNewRowRes(iFocusRowId);}
//            $row.remove();
//            $tr_resactivity.remove();
//            $tr_resqty.trigger('change');
//        }
//        SortOrder(iFocusRowId);
    }
    return false;
}
function SortOrder(iRowid) {
    var rows = $('tr[id*=rateanal_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanal_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function SortOrderR(iRowid) {
    var rows = $('tr[id*=rateanalR_'+iRowid+'_RowId_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        var irow = id.split("_")[3];
        $('#rateanalR_' + iRowid + '_rowrefid_' + irow).val(irefid);
        irefid = + irefid+1;
    });
}
function IOWRateUpdate(x) {
    var sStr = x.split("_");
    var iARowid = sStr[1];
    var sVal = $('#ratetype_' + iARowid).val();
    var dRate=0;
    if (sVal=='R') dRate = parseFloat(isNullCheck($('#rateanalR_' + iARowid + '_netrate').val(),'number'));
    else dRate = parseFloat(isNullCheck($('#rateanal_' + iARowid + '_netrate').val(),'number'));
    $('#rate_' + iARowid).val(sanitizeNumber(dRate,2,true));
}
function CheckParentValid(x) {
    var sStr = x.split("_");
    var iARowid = sStr[1];
    var sId = $('#parentkeyid_' + iARowid).val();
    var sVal = sId.split('.');
    var iWGId= 0,iIOWId=0;
    if (sVal.length >0)  iWGId = sVal[0];
    if (sVal.length >1)  iIOWId = sVal[1];
    if (iWGId ==0) {
        var sParentName = isNullCheck($('#newparentname_' + iARowid).val(),'string');
        if (sParentName !="") {
            var $codes = $('textarea[id^=spec_]');
            $.each($codes, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
                var ikey = name.split('_')[1];
                var sSpec = $('#spec_' + ikey).val();
                if (sSpec == sParentName) {
                    $('#raheader_' + ikey).prop('disabled', true);
                    $('#refserialno_' + ikey).prop('readonly', true);
                    $('#parentid_' + ikey).prop('readonly', true);
                    $('#spec_' + ikey).prop('readonly', true);
                    $('.mainTrDelete_' + ikey).hide();
                    return;
                }
            });
        }
    }
}
//function CheckParentValid(x) {
//    var sStr = x.split("_");
//    var iARowid = sStr[1];
//    if ($('#parentkeyid_' + iARowid).val() == '0' || $('#parentkeyid_' + iARowid).val().length==0) {
//        if ($('#parentid_' + iARowid).val().length >0){$('#parentid_' + iARowid).addClass('error');}
//        else {$('#unitid_' + iARowid).removeClass('error');}
//    }
//    else
//        $('#parentid_' + iARowid).removeClass('error');
//}
function CheckUnitValid(x) {
    unitChange(x);
    var sStr = x.split("_");
    var iARowid = sStr[1];
    if (parseFloatVal(isNullCheck($('#unitkeyid_' + iARowid).val(),'number')) == 0 || $('#unitkeyid_' + iARowid).val().length==0) {
        if ($('#unitid_' + iARowid).val().length >0){$('#unitid_' + iARowid).addClass('error');}
        else {$('#unitid_' + iARowid).removeClass('error');}
        if (parseFloatVal(isNullCheck($('#rate_' + iARowid).val(),'number')) !=0) {$('#unitid_' + iARowid).addClass('error');}
    } else {
        $('#unitid_' + iARowid).removeClass('error');
//        $('#rate_' + iARowid).val(sanitizeNumber(0,2,true));
        $('#raheader_' + iARowid).prop('disabled', true);
        AddNewRowA(x);
    }
}

function unitChange(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');
    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }
    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));

    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);
}

function CheckResValid(x) {
    var iARowid = x.split("_")[3],
        name = '';
    iFocusRowId = x.split("_")[1];
    var sname = x.split('_')[0];
    if (sname.substr(sname.length-1) == "R") name = '#rateanalR_' + iFocusRowId;
    else name = '#rateanal_' + iFocusRowId;
    var sType = $(name + '_type_' + iARowid).val();
    if (sType == "I" || sType=="R") {
        if (sType == "I") {
            if ($(name + '_iowkeyid_' + iARowid).val() == '0' || $(name + '_iowkeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resqty_' + iARowid).prop('readonly', true);
                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
                $(name + '_resqty_' + iARowid).prop('readonly', false);
                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        } else {
            if ($(name + '_reskeyid_' + iARowid).val() == '0' || $(name + '_reskeyid_' + iARowid).val().length == 0) {
                $(name + '_resid_' + iARowid).addClass('error');
                $(name + '_resqty_' + iARowid).val(sanitizeNumber(0,3));
                $(name + '_resrate_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resamt_' + iARowid).val(sanitizeNumber(0,2,true));
                $(name + '_resqty_' + iARowid).prop('readonly', true);
                $(name + '_resrate_' + iARowid).prop('readonly', true);
            } else {
                $(name + '_resid_' + iARowid).removeClass('error');
                $(name + '_resqty_' + iARowid).prop('readonly', false);
                $(name + '_resrate_' + iARowid).prop('readonly', false);
            }
        }
    }
}
function ShowNewWorkGroup(e) {
    e.preventDefault();
    var $newwg = $('#newwg');
    if ($newwg.is(":hidden"))
        $newwg.show();
    else
        $newwg.hide();

    return false;
}
function ResourceRateUpdate() {
    closedetails('');
    var irows = $('#resourcerate tbody tr').length;
    var bFound=false;
    var dRate=0;
    var dOldRate=0;
    var iResid = 0;
    for (var i = 1; i <= irows; i++) {
        iResid= $('#rateresid_' + i).val();
        dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
        dOldRate = parseFloat(isNullCheck($('#rateresoldrate_' + i).val(),'number'));
        if (dRate != dOldRate) {
            UpdateResourceRate(iResid,dRate);
            $('#rateresoldrate_' + i).val(dRate);
            UpdateActivityResourceRate(iResid,dRate);
            UpdateSubIOWResourceRate(iResid,dRate);
        }
    }
    closeAllActivity();
}
function UpdateActivityResourceRate(resid,rate) {
    for(var i=0;i<arrActivityAnal.length;i++) {
        if (arrActivityAnal[i].resourceid == resid) {
            arrActivityAnal[i].rate = rate;
            arrActivityAnal[i].amount = parseFloat(arrActivityAnal[i].qty) * rate;
            UpdateActivityRate(arrActivityAnal[i].activityid);
        }
    }
}
function UpdateActivityRate(iAResid) {
    var dmAmt = 0, daAmt = 0,dmQty= 0, daQty= 0;
    var objR = $.grep(arrActivityAnal, function (element, index) {
        return element.activityid == iAResid;});
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].activitytype =="A") daAmt = daAmt + parseFloat(objR[i].amount);
        else dmAmt = dmAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrActivityRes.length;i++) {
        if (arrActivityRes[i].activityid == iAResid) {
            dmQty = parseFloat(arrActivityRes[i].analysisMQty);
            daQty = parseFloat(arrActivityRes[i].analysisAQty);
            if (dmQty==0) { dmQty=1; arrActivityRes[i].AnalysisMQty = dmQty; }
            if (daQty==0) { daQty=1; arrActivityRes[i].AnalysisAQty = dmQty; }
            arrActivityRes[i].mRate = dmAmt/dmQty;
            arrActivityRes[i].aRate = daAmt/daQty;
            UpdateActivityMainRate(iAResid,arrActivityRes[i].lRate,arrActivityRes[i].mRate,arrActivityRes[i].aRate)
            break;
        }
    }
}
function UpdateResourceRate(iResid,dRate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateActivityMainRate(iResid,dLRate,dMRate,dARate) {
    var $reskeyids = $('input[id*=_reskeyid_][value="'+iResid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "M") { dRate =  dMRate; }
        else if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "A") { dRate =  dARate; }
        else { dRate =  dLRate; }
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function UpdateSubIOWResourceRate(resid,rate) {
    for(var i=0;i<arrSubIOWAnal.length;i++) {
        if (arrSubIOWAnal[i].resourceid == resid) {
            arrSubIOWAnal[i].rate = rate;
            arrSubIOWAnal[i].amount = parseFloat(arrSubIOWAnal[i].qty) * rate;
            UpdateSubIOWRate(arrSubIOWAnal[i].subiowid);
        }
    }
}
function UpdateSubIOWRate(isubiowid) {
    var dsAmt = 0, drAmt = 0,dsQty= 0, drQty= 0;
    var objR = $.grep(arrSubIOWAnal, function (element, index) {
        return element.subiowid == isubiowid;
    });
    for(var i=0;i<objR.length;i++) {
        if  (objR[i].mixtype =="R") drAmt = drAmt + parseFloat(objR[i].amount);
        else dsAmt = dsAmt + parseFloat(objR[i].amount);
    }
    for(var i=0;i<arrSubIOW.length;i++) {
        if (arrSubIOW[i].subiowid == isubiowid) {
            dsQty = parseFloat(arrSubIOW[i].workingqty);
            drQty = parseFloat(arrSubIOW[i].rworkingQty);
            if (dsQty==0) { dsQty=1; arrSubIOW[i].workingqty = dsQty; }
            if (drQty==0) { drQty=1; arrSubIOW[i].rworkingQty = drQty; }
            arrSubIOW[i].srate = dsAmt/dsQty;
            arrSubIOW[i].rrate = drAmt/drQty;
            UpdateSubIOWMainRate(isubiowid,arrSubIOW[i].srate,arrSubIOW[i].rrate)
            break;
        }
    }
}
function UpdateSubIOWMainRate(isubiowid,dSRate,dRRate) {
    var $reskeyids = $('input[id*=_iowkeyid_][value="'+isubiowid+'"]');
    var dRate=0;
    $.each($reskeyids, function (j, obj) {
        var name = $(this)[0].id,
            arr_name = name.split('_'),
            key1 = arr_name[1],
            key2 = arr_name[3];
        if ($('#'+ arr_name[0] +'_'+ key1+ '_ratetype_' + key2).val() == "R") dRate =  dRRate;
        else dRate =  dSRate;
        $('#'+ arr_name[0] +'_'+ key1+ '_resrate_' + key2).val(sanitizeNumber(dRate,2,true));
        $('#' +  arr_name[0] + '_' + key1+ '_resqty_' + key2).trigger('change');
    });
}
function ShowNewResource(e) {
    e.preventDefault();
    var $newr = $('#newres');
    if ($newr.is(":hidden")) $newr.show();
    else $newr.hide();
    return false;
}
function DeleteResourceR(x, e) {
    e.preventDefault();
    var sStr = x.split("_"),
        iARowid = sStr[3];
    iFocusRowId= sStr[1];
    var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iARowid).val(),'string');
    if (stype =="R"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="I"){
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number') ==0) return;
    } else if (stype=="H") {
        if  (isNullCheck($('#rateanalR_' + iFocusRowId + '_resdes_' + iARowid).val(),'string') =="") return;
    } else return;
    if (confirm('Do you want to Delete')) {
        var $row = $('#rateanalR_' + iFocusRowId + '_RowId_' + iARowid),
            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
            $resname =  $('#rateanalR_' + iFocusRowId + '_resid_' + irid),
            $tr_resactivity = $('#resactvityR_'+iFocusRowId+'_RowId_' + iARowid);
        $tr_resactivity.remove();
        $row.remove();
        bindResRowAutoComplete($resname);
        SortOrderR(iFocusRowId);
        checkRAUsed();
//        var $row = $('#rateanalR_' + iFocusRowId + '_RowId_' + iARowid),
//            $tr_resactivity = $('#resactvity_'+iFocusRowId+'_RowId_' + iARowid),
//            tr_length = $('tr[id*=rateanalR_' + iFocusRowId + '_RowId_]').length,
//            irid =   $('#rowinfoidR_' + iFocusRowId).val(),
//            $lrow = $('#rateanalR_' + iFocusRowId + '_RowId_' + irid),
//            $tr_resqty = $('input[id*=rateanalR_' + iFocusRowId + '_resqty_]');
//        if (tr_length > 2) {
//            $lrow.remove();
//            $row.remove();
//            $tr_resactivity.remove();
//            $('#rowinfoidR_' + iFocusRowId).val(irid-1);
//            AddNewRowResR(iFocusRowId);
//            $tr_resqty.trigger('change');
//        } else {
//            $('#rowinfoidR_' + iFocusRowId).val(0);
//            if (tr_length != 2) { AddNewRowResR(iFocusRowId);}
//            $row.remove();
//            $tr_resactivity.remove();
//            $tr_resqty.trigger('change');
//        }
//        SortOrderR(iFocusRowId);
    }
    return false;
}
function closeAllActivity() {
    var $resrate = $('input[id*=_resrate_]');
    $.each($resrate, function() {
        var x = $(this)[0].id;
        if (x.indexOf('__') != -1) return;
        closeIOWAnalysis(x);
    });
}

function closeIOWAnalysis(x) {
    var sStr = x.split("_"),
        key1 = sStr[1],
        activityName = 'resactvity_';
    if(sStr[0].substr(sStr[0].length - 1) == 'R') activityName = 'resactvityR_';
    $('tr[id*=resactvity_' + key1 +'_RowId_]').remove();
    $('tr[id*=resactvityR_' + key1 +'_RowId_]').remove();
    $('a[id*=resactvity_' + key1 +'_resTr_] i').removeClass('tform');
    $('a[id*=resactvityR_' + key1 +'_resTr_] i').removeClass('tform');
}
function showAnalysis(x,mtype) {
    if (bShowAnalysis== true) return;

    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    bShowAnalysis=true;

    var sName = "rateanal_",
        activityName = 'resactvity_';
    if (mtype != 'undefined' && mtype =="R")  { sName = "rateanalR_"; activityName = 'resactvityR_'; }

    var iARowid = sStr[3],
        sRateType = $('#' + sName + iFocusRowId + '_ratetype_' + iARowid).val(),
        trName = activityName + iFocusRowId + '_RowId_' + iARowid,
        aLink = activityName + iFocusRowId + '_resTr_' + iARowid,
        iResId= 0,
        expandLink = '<a id="'+aLink+'" href="javascript: expandResSubTr(\''+trName+'\', \''+aLink+'\')"><i class="fa fa-chevron-circle-down " data-toggle="tooltip" data-placement="top" data-original-title="Expand"></i></a>';

    if($('#' + trName).length != 0) { bShowAnalysis=false; return; }

//    closeIOWAnalysis(x);
    closeAllActivity()
    if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "R") {
        iResId = isNullCheck($('#' + sName + iFocusRowId + '_reskeyid_' + iARowid).val(),'number');
        if (iResId == 0 || $('#' + sName + iFocusRowId + '_restypeid_' + iARowid).val() != 4) { bShowAnalysis=false; return; }
        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv bs_bord" style="display: none;">').children().html($('#dummyactivity').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).after(expandLink);

        var objR = $.grep(arrActivityRes, function (element, index) {
            return element.activityid == iResId;
        });
        if (objR.length >0) {
            var dmQty = parseFloatVal(objR[0].analysisMQty),
                daQty = parseFloatVal(objR[0].analysisMQty);
            if (dmQty == 0) {
                dmQty = 1;
            }
            if (daQty == 0) {
                daQty = 1;
            }

            if (sRateType != "") {
                $('#analrate').val(sRateType);
            }
            else {
                $('#analrate').val(objR[0].ratetype);
            }
            $('#analrateL').val(objR[0].lRate);
            $('#analrateM').val(objR[0].mRate);
            $('#analrateA').val(objR[0].aRate);
        }
        $('#analrate').trigger('change');
        $('#activityAnalQty').val(dmQty);
        $('#activityRAnalQty').val(daQty);

        var objAS = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'M';
        });

        var k = 0;
        var sOldid = "_1"
        var dmAmt=0;

        for (var j = 0; j < objAS.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="activityRowId_1">' + $('#activityrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#activityRowId' + sOldid).after(sStr);

//                $("#activityrestable tbody.sorting tr:last").after("<tr>" + $("#activityrestable tbody tr:first").html() + "</tr>");
//
//                $("#activityrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#activityrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#activityrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }

            $('#activityresid_' + k).val(objAS[j]['resourcename']);
//            $('#activityresunit_' + k).val(objAS[j]['unitname']);
            $("label[for='activityresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#activityresqty_' + k).val(sanitizeNumber(objAS[j]['qty'],3));
            $('#activityresrate_' + k).val(sanitizeNumber(objAS[j]['rate'],2,true));
            $('#activityresamt_' + k).val(sanitizeNumber(objAS[j]['amount'],2,true));
            dmAmt = dmAmt + parseFloatVal(objAS[j]['amount']);
            sOldid = '_' + k;
            $('#arowinfoid').val(k);
        }

        $('#activitytotrate').val(sanitizeNumber(dmAmt,2,true));
        var dmRate = dmAmt/dmQty;
        $('#activityperrate').val(sanitizeNumber(dmRate,2,true));
        $('#analrateM').val(sanitizeNumber(dmRate,2,true));

        var objAR = $.grep(arrActivityAnal, function (element, index) {
            return element.activityid == iResId && element.activitytype == 'A';
        });

        var k = 0;
        var daAmt=0;
        sOldid = "_1";
        for (var j = 0; j < objAR.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="activityRRowId_1">' + $('#activityRrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#activityRRowId' + sOldid).after(sStr);

//                $("#activityRrestable tbody.sorting tr:last").after("<tr>" + $("#activityRrestable tbody tr:first").html() + "</tr>");
//
//                $("#activityRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#activityRrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//
//                $("#activityRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }

            $('#activityRresid_' + k).val(objAR[j]['resourcename']);
//            $('#activityRresunit_' + k).val(objAR[j]['unitname']);
            $("label[for='activityRresunit_" + k + "']").html(objAR[j]['unitname']);
            $('#activityRresqty_' + k).val(sanitizeNumber(objAR[j]['qty'],3));
            $('#activityRresrate_' + k).val(sanitizeNumber(objAR[j]['rate'],2,true));
            $('#activityRresamt_' + k).val(sanitizeNumber(objAR[j]['amount'],2,true));

            daAmt = daAmt + parseFloatVal(objAR[j]['amount']);
            sOldid = '_' + k;

            $('#arowinfoidR').val(k);
        }

        $('#activityRtotrate').val(sanitizeNumber(daAmt,2,true));
        var daRate = daAmt/daQty;
        $('#activityRperrate').val(sanitizeNumber(daRate,2,true));
        $('#analrateA').val(sanitizeNumber(daRate,2,true));

        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();

    } else if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "I") {

        iResId = isNullCheck($('#' + sName + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number');

        if (iResId == 0 ) { bShowAnalysis=false; return; }

        $('#' + trName).remove();
        $('#' + aLink).remove();
        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv" style="display: none;">').children().html($('#dummysubiow').html());
        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).after(expandLink);

        var objR = $.grep(arrSubIOW, function (element, index) {
            return element.subiowid == iResId;
        });

        if (objR.length >0) {
            var dsQty = parseFloatVal(objR[0].workingqty);
            var drQty = parseFloatVal(objR[0].rworkingqty);
            if (dsQty == 0) {
                dsQty = 1;
            }
            if (drQty == 0) {
                drQty = 1;
            }

            if (sRateType != "") {
                $('#analrate').val(sRateType);
            }
            else {
                $('#analrate').val(objR[0].mixtype);
            }
            $('#srateanalAQty').val(objR[0].cementratio);
            $('#srateanalBQty').val(objR[0].sandratio);
            $('#srateanalCQty').val(objR[0].metalratio);
            $('#srateanalthick').val(objR[0].thickqty);


            $('#subiowmixtype').show();
            $('#subiowcement').show();
            $('#subiowsand').show();
            $('#subiowmetal').show();
            $('#subiowthick').show();

            if (objR[0].ConcreteMix ==0) $('#subiowmixtype').hide();
            if (objR[0].Cement ==0) $('#subiowcement').hide();
            if (objR[0].Sand==0) $('#subiowsand').hide();
            if (objR[0].Metal==0) $('#subiowmetal').hide();
            if (objR[0].Thickness==0) $('#subiowthick').hide();
        }

        $('#srateanalAnalQty').val(dsQty);
        $('#srateanalRAnalQty').val(drQty);

        var objAS = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype != 'R';
        });

        var dsAmt=0;
        var k = 0;
        var sOldid = "_1"
        for (var j = 0; j < objAS.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="srateanalRowId_1">' + $('#srateanalrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#srateanalRowId' + sOldid).after(sStr);

//                $("#srateanalrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalrestable tbody tr:first").html() + "</tr>");
//
//                $("#srateanalrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#srateanalrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#srateanalrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }

            $('#srateanalinc_' + k).val(objAS[j]['includeflag']);
            $('#srateanalref_' + k).val(objAS[j]['referenceid']);
            $('#srateanalresid_' + k).val(objAS[j]['resourcename']);
            $("label[for='srateanalresunit_" + k + "']").html(objAS[j]['unitname']);
            $('#srateanalresqty_' + k).val(sanitizeNumber(objAS[j]['qty'],3));
            $('#srateanalresrate_' + k).val(sanitizeNumber(objAS[j]['rate'],2,true));
            $('#srateanalresamt_' + k).val(sanitizeNumber(objAS[j]['amount'],2,true));
            $('#srateanalformula_' + k).val(objAS[j]['formula']);

            dsAmt = dsAmt + parseFloatVal(objAS[j]['amount']);
            sOldid = '_' + k;
            $('#srowinfoid').val(k);
        }

        $('#srateanaltotrate').val(sanitizeNumber(dsAmt,2,true));
        var dsRate = dsAmt/dsQty;
        $('#srateanalperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalnetrate').val(sanitizeNumber(dsRate,2,true));


        var objAR = $.grep(arrSubIOWAnal, function (element, index) {
            return element.subiowid == iResId && element.mixtype == 'R';
        });

        var drAmt =0;
        var k = 0;
        sOldid = "_1";
        for (var j = 0; j < objAR.length; j++) {
            k = k + 1;
//            var sNewid = "_" + k;
            if (k != 1) {
                var sStr = '<tr id="srateanalRRowId_1">' + $('#srateanalRrestable tbody tr:first').html() + '</tr>';
                sStr = sStr.replace(/_1/g, '_' + k);
                $('#srateanalRRowId' + sOldid).after(sStr);

//                $("#srateanalRrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalRrestable tbody tr:first").html() + "</tr>");
//
//                $("#srateanalRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#srateanalRrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//
//                $("#srateanalRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
            }

            $('#srateanalRinc_' + k).val(objAR[j]['includeflag']);
            $('#srateanalRref_' + k).val(objAR[j]['referenceid']);
            $('#srateanalRresid_' + k).val(objAR[j]['resourcename']);
            $("label[for='srateanalRunit_" + k + "']").html(objAR[j]['unitname']);
            $('#srateanalRresqty_' + k).val(sanitizeNumber(objAR[j]['qty'],3));
            $('#srateanalRresrate_' + k).val(sanitizeNumber(objAR[j]['rate'],2,true));
            $('#srateanalRresamt_' + k).val(sanitizeNumber(objAR[j]['amount'],2,true));
            $('#srateanalRformula_' + k).val(objAR[j]['formula']);

            drAmt = drAmt + parseFloatVal(objAR[j]['amount']);
            sOldid = '_' + k;
            $('#srowinfoidR').val(k);
        }

        $('#srateanalRtotrate').val(sanitizeNumber(drAmt,2,true));
        var drRate = drAmt/drQty;
        $('#srateanalRperrate').val(sanitizeNumber(dsRate,2,true));
        $('#srateanalRnetrate').val(sanitizeNumber(dsRate,2,true));

        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();

        $('#sraworktable').show();
        $('#srateanalrestable').show();
    }
    expandResSubTr(trName, aLink);
    bShowAnalysis =false;
//    var sStr = x.split("_");
//    iFocusRowId = sStr[1];
//    var sName = "rateanal_",
//        activityName = 'resactvity_';
//    if (mtype != 'undefined' && mtype =="R")  { sName = "rateanalR_"; activityName = 'resactvityR_'; }
//    var iARowid = sStr[3],
//        sRateType = $('#' + sName + iFocusRowId + '_ratetype_' + iARowid).val(),
//        trName = activityName + iFocusRowId + '_RowId_' + iARowid,
//        aLink = activityName + iFocusRowId + '_resTr_' + iARowid,
//        iResId= 0,
//        expandLink = '<li><a id="'+aLink+'" href="javascript: expandResSubTr(\''+trName+'\', \''+aLink+'\')"><span data-original-title="Add lines" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-up"></i></span></a></li>';
//    if($('#' + trName).length != 0) return;
//    closeIOWAnalysis(x);
//    if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "R") {
//        iResId = isNullCheck($('#' + sName + iFocusRowId + '_reskeyid_' + iARowid).val(),'number');
//        if (iResId == 0 || $('#' + sName + iFocusRowId + '_restypeid_' + iARowid).val() != 4) return;
//        $('#' + trName).remove();
//        $('#' + aLink).remove();
//        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv bs_bord" style="display: none;">').children().html($('#dummyactivity').html());
//        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
//        var objR = $.grep(arrActivityRes, function (element, index) {
//                return element.activityid == iResId;
//        });
//          var dmQty =  parseFloat(objR[0].analysisMQty),
//              daQty =  parseFloat(objR[0].analysisMQty);
//          if (dmQty ==0) dmQty=1;
//          if (daQty ==0) daQty=1;
//        if (sRateType != "") { $('#analrate').val(sRateType); }
//        else { $('#analrate').val(objR[0].ratetype); }
//        $('#analrateL').val(objR[0].lRate);
//        $('#analrateM').val(objR[0].mRate);
//        $('#analrateA').val(objR[0].aRate);
//        $('#analrate').trigger('change');
//        $('#activityAnalQty').val(dmQty);
//        $('#activityRAnalQty').val(daQty);
//        var objAS = $.grep(arrActivityAnal, function (element, index) {
//            return element.activityid == iResId && element.activitytype == 'M';
//        });
//        var k = 0;
//        var sOldid = "_1"
//        var dmAmt=0;
//        for (j = 0; j < objAS.length; j++) {
//            k = k + 1;
//            var sNewid = "_" + k;
//            if (k != 1) {
//                $("#activityrestable tbody.sorting tr:last").after("<tr>" + $("#activityrestable tbody tr:first").html() + "</tr>");
//                $("#activityrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//            }
//            $('#activityresid_' + k).val(objAS[j]['resourcename']);
//            //$('#activityresunit_' + k).val(objAS[j]['unitname']);
//            $("label[for='activityresunit_" + k + "']").html(objAS[j]['unitname']);
//            $('#activityresqty_' + k).val(objAS[j]['qty']);
//            $('#activityresrate_' + k).val(objAS[j]['rate']);
//            $('#activityresamt_' + k).val(objAS[j]['amount']);
//            dmAmt = dmAmt + parseFloat(objAS[j]['amount']);
//            $('#arowinfoid').val(k);
//        }
//        $('#activitytotrate').val(sanitizeNumber(dmAmt,2,true));
//        var dmRate = dmAmt/dmQty;
//        $('#activityperrate').val(sanitizeNumber(dmRate,2,true));
//        $('#analrateM').val(sanitizeNumber(dmRate,2,true));
//        var objAR = $.grep(arrActivityAnal, function (element, index) {
//            return element.activityid == iResId && element.activitytype == 'A';
//        });
//        var k = 0;
//        var daAmt=0;
//        for (j = 0; j < objAR.length; j++) {
//            k = k + 1;
//            var sNewid = "_" + k;
//            if (k != 1) {
//                $("#activityRrestable tbody.sorting tr:last").after("<tr>" + $("#activityRrestable tbody tr:first").html() + "</tr>");
//                $("#activityRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityRrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#activityRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//            }
//            $('#activityRresid_' + k).val(objAR[j]['resourcename']);
//            //$('#activityRresunit_' + k).val(objAR[j]['unitname']);
//            $("label[for='activityRresunit_" + k + "']").html(objAR[j]['unitname']);
//            $('#activityRresqty_' + k).val(objAR[j]['qty']);
//            $('#activityRresrate_' + k).val(objAR[j]['rate']);
//            $('#activityRresamt_' + k).val(objAR[j]['amount']);
//            daAmt = daAmt + parseFloat(objAR[j]['amount']);
//            $('#arowinfoidR').val(k);
//        }
//        $('#activityRtotrate').val(sanitizeNumber(daAmt,2,true));
//        var daRate = daAmt/daQty;
//        $('#activityRperrate').val(sanitizeNumber(daRate,2,true));
//        $('#analrateA').val(sanitizeNumber(daRate,2,true));
//        $('#activitymachinery').hide();
//        $('#activityRrestable').hide();
//        $('#activitymanual').show();
//        $('#activityrestable').show();
//    } else if ($('#' + sName + iFocusRowId + '_type_' + iARowid).val() == "I") {
//        iResId = isNullCheck($('#' + sName + iFocusRowId + '_iowkeyid_' + iARowid).val(),'number');
//        if (iResId == 0 ) return;
//        $('#' + trName).remove();
//        $('#' + aLink).remove();
//        $('#'+ x).closest('tr').after('<tr id="'+trName+'" style="display:none;">').next().append('<td colspan="12" class="paintSubTr">').children('td').append('<div class="subDiv" style="display: none;">').children().html($('#dummysubiow').html());
//        $('#' + sName + iFocusRowId + '_resdel_' + iARowid).parent('li').after(expandLink);
//        var objR = $.grep(arrSubIOW, function (element, index) {
//            return element.subiowid == iResId;
//        });
//        var dsQty =  parseFloat(isNullCheck(objR[0].workingqty,'number'));
//        var drQty =  parseFloat(isNullCheck(objR[0].rworkingqty,'number'));
//        if (dsQty ==0) dsQty=1;
//        if (drQty ==0) drQty=1;
//        if (sRateType != "") { $('#analrate').val(sRateType); }
//        else { $('#analrate').val(objR[0].mixtype); }
//        $('#srateanalAQty').val(objR[0].cementratio);
//        $('#srateanalBQty').val(objR[0].sandratio);
//        $('#srateanalCQty').val(objR[0].metalratio);
//        $('#srateanalthick').val(objR[0].thickqty);
//        $('#srateanalAnalQty').val(dsQty);
//        $('#srateanalRAnalQty').val(drQty);
//        var objAS = $.grep(arrSubIOWAnal, function (element, index) {
//            return element.subiowid == iResId && element.mixtype != 'R';
//        });
//        var dsAmt=0;
//        var k = 0;
//        var sOldid = "_1"
//        for (j = 0; j < objAS.length; j++) {
//            k = k + 1;
//            var sNewid = "_" + k;
//            if (k != 1) {
//                $("#srateanalrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalrestable tbody tr:first").html() + "</tr>");
//                $("#srateanalrestable tbody.sorting tr:last").find("input:text").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalrestable tbody.sorting tr:last").find("select").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//                $("#srateanalrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                    $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                    $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                });
//            }
//            $('#srateanalinc_' + k).val(objAS[j]['includeflag']);
//            $('#srateanalref_' + k).val(objAS[j]['referenceid']);
//            $('#srateanalresid_' + k).val(objAS[j]['resourcename']);
//            $("label[for='srateanalresunit_" + k + "']").html(objAS[j]['unitname']);
//            $('#srateanalresqty_' + k).val(objAS[j]['qty']);
//            $('#srateanalresrate_' + k).val(objAS[j]['rate']);
//            $('#srateanalresamt_' + k).val(objAS[j]['amount']);
//            $('#srateanalformula_' + k).val(objAS[j]['formula']);
//            dsAmt = dsAmt + parseFloat(objAS[j]['amount']);
//            $('#srowinfoid').val(k);
//        }
//        $('#srateanaltotrate').val(sanitizeNumber(dsAmt,2,true));
//        var dsRate = dsAmt/dsQty;
//        $('#srateanalperrate').val(sanitizeNumber(dsRate,2,true));
//        $('#srateanalnetrate').val(sanitizeNumber(dsRate,2,true));
//        var objAR = $.grep(arrSubIOWAnal, function (element, index) {
//            return element.subiowid == iResId && element.mixtype == 'R';
//        });
//            var drAmt =0;
//            var k = 0;
//            for (j = 0; j < objAR.length; j++) {
//                k = k + 1;
//                var sNewid = "_" + k;
//                if (k != 1) {
//                    $("#srateanalRrestable tbody.sorting tr:last").after("<tr>" + $("#srateanalRrestable tbody tr:first").html() + "</tr>");
//                    $("#srateanalRrestable tbody.sorting tr:last").find("input:text").each(function () {
//                        $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                        $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                    });
//                    $("#srateanalRrestable tbody.sorting tr:last").find("select").each(function () {
//                        $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                        $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                    });
//                    $("#srateanalRrestable tbody.sorting tr:last").find("input:hidden").each(function () {
//                        $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                        $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                    });
//                }
//                $('#srateanalRinc_' + k).val(objAR[j]['includeflag']);
//                $('#srateanalRref_' + k).val(objAR[j]['referenceid']);
//                $('#srateanalRresid_' + k).val(objAR[j]['resourcename']);
//                $("label[for='srateanalRunit_" + k + "']").html(objAR[j]['unitname']);
//                $('#srateanalRresqty_' + k).val(objAR[j]['qty']);
//                $('#srateanalRresrate_' + k).val(objAR[j]['rate']);
//                $('#srateanalRresamt_' + k).val(objAR[j]['amount']);
//                $('#srateanalRformula_' + k).val(objAR[j]['formula']);
//                drAmt = drAmt + parseFloat(objAR[j]['amount']);
//                $('#srowinfoidR').val(k);
//            }
//            $('#srateanalRtotrate').val(sanitizeNumber(drAmt,2,true));
//            var drRate = drAmt/drQty;
//            $('#srateanalRperrate').val(sanitizeNumber(dsRate,2,true));
//            $('#srateanalRnetrate').val(sanitizeNumber(dsRate,2,true));
//            $('#sraworkRtable').hide();
//            $('#srateanalRrestable').hide();
//            $('#sraworktable').show();
//            $('#srateanalrestable').show();
//    }
//    expandResSubTr(trName, aLink);
}
function printtable() {
    var pageTitle = 'Page Title',
        stylesheet = '//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css',
        win = window.open('', 'Print', 'width=500,height=300');
    win.document.write('<html><head><title>' + pageTitle + '</title>' +
    '<link rel="stylesheet" href="' + stylesheet + '">' +
    '</head><body>' + $('#sample12')[0].innerHTML + '</body></html>');
    win.document.close();
    win.print();
    win.close();
}
function nextiow() {
    var rows = $("#grid").jqxGrid('getrows');
    var id = "";
    for (var m = 0; m < rows.length; m++) {
        var row = $("#grid").jqxGrid('getrowdata', m);
        if (row.available==true) {
            id=id + row.IOWId + ',';
        }
    }
    if (id.length ==0)
        return;

    id = id.slice(0,-1);
    $.post(getBaseURL() + 'project/rfc/getiowedit', {ids: id}, function (data) {
        var obj = jQuery.parseJSON(data);
        var objT =obj['trans'];
        var sOldid = "_1";
        var iRowId=0;
        for (i = 0; i < objT.length; i++) {
            var ioRowId =  iRowId;
            iRowId = +iRowId + 1;
            if (iRowId !=1) {
                var snid = 'IOWiRowId_' + iRowId;
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iRowId);
                sStr = sStr.replace(/__9/g, '_1');
                if (ioRowId != 1) {
                    ioRowId = (ioRowId * 2) - 1;
                }
                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
            }

            $('#rowid').val(iRowId);
            $('#groupid_'+iRowId).val(objT[i].WorkGroupId);
            $('#parentid_'+iRowId).val(objT[i].ParentId);
            $('#refserialno_'+iRowId).val(objT[i].RefSerialNo);
//            $('#serialno_'+iRowId).val(objT[i].SerialNo);
            $('#spec_'+iRowId).val(objT[i].Specification);
            $('#unitid_'+iRowId).val(objT[i].UnitId);
        }
    });

    $('#next-btn').hide();
    $('#submit-btn').show();
    $('#back-btn').show();

    $('#edit-list').hide();
    $('#edit-content').show();
}
function AddNewRowA(id,is_validate) {
    var iRowId = $('#rowid').val(),
        key =   id.split('_')[1];

    if($('#IOWiRowId_' + key).nextAll('tr[id*=IOWiRowId_]').length >= 1)
        return;

    if (typeof is_validate != 'undefined' && is_validate != false) {
        if ($('#parentid_' + key).val().length == 0)
        {
            showError($('#parentid_' + key),'Required');
            $('#parentid_' + key).focus();
            return;
        }

        if ($('#refserialno_' + key).val().length == 0 || $('#refserialno_' + key).val() == 0) {
            showError($('#refserialno_' + key),'Required');
            $('#refserialno_' + key).focus();
            return;
        }

        if ($('#spec_' + key).val().length == 0) {
            showError($('#spec_' + key),'Required');
            $('#spec_' + key).focus();
            return;

        }

        if (!($('#raheader_'+ key).is(':checked'))) {
            if ($('#unitkeyid_' + key).val().length == 0 || $('#unitkeyid_' + key).val() == 0) {
                showError($('#unitid_' + key),'Required');
                $('#unitid_' + key).focus();
                return;
            }
        }
    }
    if (bexcelUpdate==true) return;

    var ioRowId =  iRowId;
    iRowId = +iRowId + 1;
    var snid = 'IOWiRowId_'+iRowId,
        sStr = $('#dummytable tbody').html();
    sStr = sStr.replace(/__1/g,'_'+ iRowId);
    sStr = sStr.replace(/__9/g,'_1');
    //if (ioRowId != 1) {ioRowId = (ioRowId*2)-1 ;}
    $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
    $('#rowrefid_' + iRowId).val(iRowId);
    $('#rowid').val(iRowId);
    checkResource(iRowId,"");
    checkResource(iRowId,"R");
    closedetails('');
    bindAutoComplete();
    bindResourceAutoComplete();
    bindResourceChange();
    expandTrFn(true);
    bindTRDeleteFn(true);
    bindMixSortablefn(true);
    expandwasteTrFn(true);
    expandwbsTrFn(true);
    bindQualExpandTr();
    getWBSMasterList();
    bindWBSautoComplete();
    checkRAUsed();


    $('.mainTrDelete_' + key).show(); // show delete icon
//    var aSNo = $('#parentkeyid_' +key).val().split('.');
//    if (aSNo.length >0) GetWorkGroupDetails( isNullCheck(aSNo[0],'number'),id);
}
var fixHelperModified = function(e, tr) {
        var $originals = tr.children();
        var $helper = tr.clone();
        $helper.children().each(function(index) {
            $(this).width($originals.eq(index).width())
        });
        return $helper;
    },
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };
function getRefNo(key,type) {
    if (type=="R") {
        $reskeyid = $('input[id*=rateanalR_' + key + '_refid_]');
    } else {
        $reskeyid = $('input[id*=rateanal_' + key + '_refid_]');
    }
    var iRefId=1;
    $.each($reskeyid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var sRefId = isNullCheck($('#'+name).val(),'string')
        var ioRefId = sRefId.replace(/[^0-9]/g, '');
        if (parseInt(ioRefId) >= iRefId) iRefId = +ioRefId+1;
    });
    return iRefId;
}
function AddNewRowRes(key1,key2) {
    var sRow = '#rowinfoid_' + key1;
    var irowinfoId  = $(sRow).val();
    $('#rateanal_'+key1+'_resdel_' + key2).show();
    irowinfoId = +irowinfoId + 1;
    var iRefId = getRefNo(key1,"");
    var stabelrow = '#rateanal_'+key1 + '_restable';

    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';

    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
    $('#rateanal_' + key1 + '_refid_' + irowinfoId).val(iRefId);
    checkResource(key1,"");
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    bindMixSortablefn(true);

    $(sRow).val(irowinfoId);

    SortOrder(key1);
    checkRAUsed();

    return true;

//    var sRow = '#rowinfoid_' + key1,
//        irowinfoId  = $(sRow).val();
//    $('#rateanal_'+key1+'_resdel_' + irowinfoId).show(); // show delete icon
//    irowinfoId = +irowinfoId + 1;
//    var stabelrow = '#rateanal_'+key1 + '_restable';
//    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
//    sStr = sStr.replace(/__1/g,'_'+ key1);
//    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
//    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
//    $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
//    $('#rateanal_' + key1 + '_refid_' + irowinfoId).val(irowinfoId);
//    checkResource(key1,"");
//    bindResourceAutoComplete();
//    bindResourceChange();
//    bindMixSortablefn(true);
//    $(sRow).val(irowinfoId);
//    SortOrder(key1);
//    return true;
}
function AddNewRowResR(key1,key2) {
    var sRow = '#rowinfoidR_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanalR_'+key1+'_resdel_' + key2).show();
    irowinfoId = +irowinfoId + 1;
    var iRefId = getRefNo(iFocusRowId,"R");
    var stabelrow = '#rateanalR_'+key1 + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';

    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ iRefId);
    $(stabelrow+" tbody.sorting > tr:last-child").after(sStr);
    $('#rateanalR_' + key1 + '_refid_' + irowinfoId).val(iRefId);
    checkResource(key1,"R");
    bindResourceAutoComplete();
    bindResourceChange();
    bindPopOver();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrderR(key1);
    checkRAUsed();
}
function AddNewRowIOW() {
    var sRow = '#rowinfoid_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
    var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrder(iFocusRowId);
    $(sRow).val(irowinfoId);
    checkRAUsed();
}
function AddNewRowIOWR() {
    var sRow = '#rowinfoidR_' + iFocusRowId;
    var irowinfoId  = $(sRow).val();
    var sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId;
    var stabelrow = '#rateanalR_'+iFocusRowId + 'restable';
    var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_iow__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody tr:last").after(sStr);
    $(stabelrow+" tbody tr:last").after(sStr);
    $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
    SortOrderR(iFocusRowId);
    $(sRow).val(irowinfoId);
    checkRAUsed();
}
function AddNewRowResHeader(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId = parseInt(isNullCheck($('#rowinfoid_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];

    var sValue = $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanal_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';

    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);

//    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
    $('.autocomplete-suggestions').hide();

    $('#rateanal_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val("");
    $('#rateanal_' + iFocusRowId + '_type_' + irowinfoId).val("H");
    var sRow = '#rowinfoid_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
    checkRAUsed();

//    var sStr = x.id.split("_"),
//        iARowid = sStr[3];
//    irowinfoId = iARowid;
//    var sValue = $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val(),
//        sOldid = "_1";
//    irowinfoId = +irowinfoId + 1;
//    var sNewid = "_" + irowinfoId,
//        stabelrow = '#rateanal_'+iFocusRowId + '_restable',
//        sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';
//    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
//    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
//    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
//    $('.autocomplete-suggestions').hide();
//    $('#rateanal_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
//    $('#rateanal_' + iFocusRowId + '_resid_' + iARowid).val("");
//    var sRow = '#rowinfoid_' + iFocusRowId;
//    $(sRow).val(irowinfoId);
//    SortOrder(iFocusRowId);
}
function AddNewRowResHeaderR(x) {
    var sStr = x.id.split("_"),
        iARowid = sStr[3],
        irowinfoId =  parseInt(isNullCheck($('#rowinfoidR_' + iFocusRowId).val(),'number'));
    iFocusRowId = sStr[1];

    iFocusRowId = sStr[1];
    var sValue = $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanalR_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);

    var sValue = $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val(),
        sOldid = "_1";
    irowinfoId = +irowinfoId + 1;
    var sNewid = "_" + irowinfoId,
        stabelrow = '#rateanalR_'+iFocusRowId + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
    $('.autocomplete-suggestions').hide();
    $('#rateanalR_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
    $('#rateanalR_' + iFocusRowId + '_type_' + irowinfoId).val("H");
    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val("");
    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).removeClass('error');
    var sRow = '#rowinfoidR_' + iFocusRowId;
    $(sRow).val(irowinfoId);
    SortOrder(iFocusRowId);
    checkRAUsed();
//    var sStr = x.id.split("_"),
//        iARowid = sStr[3];
//    irowinfoId = iARowid;
//    var sValue = $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val(),
//        sOldid = "_1";
//    irowinfoId = +irowinfoId + 1;
//    var sNewid = "_" + irowinfoId,
//        stabelrow = '#rateanalR_'+iFocusRowId + '_restable',
//        sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';
//    sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
//    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
//    $(stabelrow+" tbody.sorting  tr:nth-child(" + (irowinfoId - 1) + ")").before(sStr);
//    $('.autocomplete-suggestions').hide();
//    $('#rateanalR_' + iFocusRowId + '_resdes_' + (irowinfoId)).val(sValue);
//    $('#rateanalR_' + iFocusRowId + '_resid_' + iARowid).val("");
//    var sRow = '#rowinfoidR_' + iFocusRowId;
//    $(sRow).val(irowinfoId);
//    SortOrder(iFocusRowId);
}
function closeactivity() {
    $('#resactvity').remove();
}
function AddNewRowjResR(key1) {
    var sRow = '#rowinfoidR_' + key1,
        irowinfoId  = $(sRow).val();
    $('#rateanalR_'+key1+'_resdel_' + irowinfoId).show(); // show delete icon
    irowinfoId = +irowinfoId + 1;
    var stabelrow = '#rateanalR_'+key1 + '_restable',
        sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
    sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
    $(stabelrow+" tbody.sorting > tr:last-child").after(sStr);
    $('#rateanalR_' + key1 + '_refid_' + irowinfoId).val(irowinfoId);
    checkResource(key1,"R");
    bindResourceAutoComplete();
    bindResourceChange();
    bindMixSortablefn(true);
    $(sRow).val(irowinfoId);
    SortOrderR(key1);
    checkRAUsed();
}

function wastageCheck(name,iARowid) {
    var dWastePer  =  parseFloat(isNullCheck($(name + "_Wastage_" + iARowid).val(),'number'));
    if (dWastePer >100) {
        alert("Wastage% should not greater than 100%");
        $(name + "_Wastage_" + iARowid).val(sanitizeNumber(100,2));
    }
}

function ValueChange(x) {
    var iARowid = x.split("_")[3],
        iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];
    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }
    wastageCheck(name,iARowid);
    var dQty =  parseFloat(isNullCheck($(name + "_resqty_" + iARowid).val(),'number')),
        dRate = parseFloat(isNullCheck($(name + "_resrate_" + iARowid).val(),'number')),
        dAmt = dQty*dRate;

    var dWastePer  =  parseFloat(isNullCheck($(name + "_Wastage_" + iARowid).val(),'number')),
        dWasteQty  =  dQty*(dWastePer/100),
        dWasteAmt  = dWasteQty*dRate;

    $(name + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
    $(name + "_WastageQty_" + iARowid).val(sanitizeNumber(dWasteQty,2,true));
    $(name + "_WastageAmount_" + iARowid).val(sanitizeNumber(dWasteAmt,2,true));

    showWastage(name);
    CalculateRate(name);
//    calcResourceQtys($(name + "_reskeyid_" + iARowid).val());
    calcResQty();
    calcBoqAmount();

//    $(name + "_resamt_" + iARowid).val(sanitizeNumber(dAmt,2,true));
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        if ($(name + '_inc_' + i).is(':checked') == true) {
//            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number'));
//            dTAmt = dTAmt + val;
//        }
//    }
//    $(name + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
//    var dNetRate = dTAmt/dAnalQty;
//    $(name + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $(name + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    else {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_netrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    }
//    $('#rate_'+ iFocusRowId).val(dFRate);
}
function CalculateRate(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sQualName = "Qual";
    sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
        sQualName = "QualR";
    }

    var dTAmt = 0;
    var dTWasteAmt =0;
    for (var i = 1; i <= iRows; i++) {
        if ($(name + '_inc_' + i).is(':checked') == true) {
            var val = parseFloat(isNullCheck($(name + "_resamt_" + i).val(),'number')),
                wasteval = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));
            dTAmt = dTAmt + val;
            dTWasteAmt = dTWasteAmt + wasteval;
        }
    }

    $(name + '_totwastage').val(sanitizeNumber(dTWasteAmt,2,true));
    dTAmt =  dTAmt + dTWasteAmt;
    $(name + '_totbaserate').val(sanitizeNumber(dTAmt,2,true));

    var dQAmt =  CalculateQualifier(dTAmt,iFocusRowId,sQualName);
    $(name + '_totqualrate').val(sanitizeNumber(dQAmt,2,true));

    var dQualAmt =  parseFloatVal(isNullCheck($(name + '_totqualrate').val(),'number'));
    var dTotRate = dTAmt+ dQualAmt;
    $(name + '_totrate').val(sanitizeNumber(dTotRate,2,true));

    var dAnalQty = parseFloat(isNullCheck($(name + '_AnalQty').val(),'number'));
    if (dAnalQty.length==0 || dAnalQty==0 || dAnalQty == "Working Qty") { dAnalQty = 1; $(name + '_AnalQty').val(dAnalQty);}
    var dNetRate = dTotRate/dAnalQty;

    $(name + '_totnetrate').val(sanitizeNumber(dNetRate,2,true));

    $(name + '_lbltotrate').html('Rate for ' + dAnalQty + ' ' + sUnit);
    $(name + '_lbltotnetrate').html('Rate per ' + sUnit);

//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//    else {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_totnetrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_totnetrate').val(),'number'));
//    }
    //$('#rate_'+ iFocusRowId).val(dFRate);
    MixRateUpdate('#rate_'+ iFocusRowId);
}
function changeRatio(x,type) {
    var sStr = x.split("_"),
        key1 = sStr[1];
    var $formula = $('input[id*=_' + key1 + '_formula]');
    $.each($formula, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            arr_names = name.split('_');
        if (name.indexOf('__') != -1) return;
        if ($('#' + name).val().indexOf(type) >= 0) {
            var sitemix = true,
                key2 = arr_names[3];
            if (name.indexOf('rateanalR') >= 0) sitemix=false;
            formularecalculation($('#' + name).val(),key1,key2,sitemix);
        }
    });
}
function formularecalculation(sformula,key1,key2,sitemix) {
    var fvaule=0;

    if (sformula.length >0) {
        try {
            if  (sitemix==true) {
                var sCement = '#rateanal_' + key1 + '_AQty';
                var sSand = '#rateanal_' + key1 + '_BQty';
                var sMetal = '#rateanal_' + key1 + '_CQty';
                var sThick = '#rateanal_' + key1 + '_thick';
            } else {
                var sCement = '#rateanalR_' + key1 + '_AQty';
                var sSand = '#rateanalR_' + key1 + '_BQty';
                var sMetal = '#rateanalR_' + key1 + '_CQty';
                var sThick = '#rateanalR_' + key1 + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());

            if  (sitemix==true) {
                var rows = $('#rowinfoid_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != key2) {
                        var sRef = $('label[for=rateanal_' + key1 + '_ref_' + key2+ ']').html().trim();
                        var dAmt= $('#rateanal_' + key1 + '_resamt_' + key2).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            } else {
                var rows = $('#rowinfoidR_' + key1).val();
                for (var i = 1; i <= rows; i++) {
                    if (i != key2) {
                        var sRef = $('label[for=rateanalR_' + key1 + '_ref_' + key2+ ']').html().trim();
                        var dAmt= $('#rateanalR_' + key1 + '_resamt_' + key2).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            }
            fvaule = computeEval(sformula);
        } catch (e) {
            res = 'Expression in invalid.';
            alert(res);
        }
    }
    if  (sitemix==true) {
        $("#rateanal_" + key1 + "_resqty_" + key2).val(sanitizeNumber(fvaule,3));
    } else {
        $("#rateanalR_" + key1 + "_resqty_" + key2).val(sanitizeNumber(fvaule,3));
    }
}
//function CalculateFull() {
//    //SiteMix
//    var iRows = $('#rowinfoid_' + iFocusRowId).val();
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        var dAmt = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat( isNullCheck( $("#rateanal_" + iFocusRowId + "_resrate_" + i).val(),'number'));
//        $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
//        if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//    }
//    $('#rateanal_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0)  { dAnalQty = 1; $('#rateanal_' + iFocusRowId + '_AnalQty').val(dAnalQty); }
//    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//    $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
//    $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//    var dNetRate = dTAmt/dAnalQty;
//    $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    //Readymix
//    var iRows = $('#rowinfoidR_' + iFocusRowId).val();
//    var dTAmt = 0;
//    for (i = 1; i <= iRows; i++) {
//        var dAmt = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + i).val(),'number')) *  parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resrate_" + i).val(),'number'));
//        $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(sanitizeNumber(dAmt,2,true));
//        if ($('#rateanalR_' + iFocusRowId + 'inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat( isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
//    }
//    $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
//    var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
//    if (dAnalQty.length==0 || dAnalQty==0) { dAnalQty = 1; $('#rateanalR_' + iFocusRowId + '_AnalQty').val(dAnalQty);}
//    var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
//    $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
//    $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
//    var dNetRate = dTAmt/dAnalQty;
//    $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
//    $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
//    var dFRate=0;
//    if ($('#mixtab_' + iFocusRowId).is(":hidden")) dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val()));
//    else  {
//        var sVal = parseFloat(isNullCheck($('#ratetype_' + iFocusRowId).val(),'number'));
//        if (sVal=="R") dFRate = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_netrate').val(),'number'));
//        else dFRate = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_netrate').val(),'number'));
//    }
//    $('#rate_'+ iFocusRowId).val(sanitizeNumber(dFRate,2,true));
//}
function ChangeIOWs(x) {
    closedetails('');
    var iARowid = x.split("_")[1];
    if ($('#unitid_'+iARowid).val().length >0) {
        $('#but_'+iARowid).prop('disabled', false);
        $('#rate_'+iARowid).prop('readonly', false);
    } else {
        $('#unitid_'+iARowid).val(0);
        $('#but_'+iARowid).prop('disabled', true);
        $('#rate_'+iARowid).prop('readonly', true);
    }
}

function CheckSpecification(x) {
    var iARowid = x.split("_")[1],
        iquotationid = parseInt(isNullCheck($('#quotationId').val(), 'number')),
        iprevtransid = parseInt(isNullCheck($('#prevQuotTransId_' + iARowid).val(), 'number')),
        $spec =$('#spec_' + iARowid),
        sspec =  isNullCheck($('#spec_' + iARowid).val(),'string').trim();

    removeError($spec);

    if (iquotationid != 0) {
        $.ajax({
            url: getBaseURL() + "project/tender/checkiowspecfound",
            async: false,
            type: 'post',
            data: {'spec': sspec, 'quotationid': iquotationid, 'prevtransid': iprevtransid},
            success: function (data, status) {
                if (data == "Y") {
                    showError($spec, 'Already Available');
                    return;
                }
            }
        });
    }

    if ($spec.hasClass('error')) return;
    removeError($spec);
    var $codes = $('textarea[id^=spec_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (sspec.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($spec, 'Already Available');
                    return;
                }
            }
        }
    });
}

function CheckSerialNo(x) {
    var iARowid = x.split("_")[1],
        iquotationid = parseInt(isNullCheck($('#quotationId').val(), 'number')),
        iprevtransid = parseInt(isNullCheck($('#prevQuotTransId_' + iARowid).val(), 'number')),
        sRefSlNo = isNullCheck($('#refserialno_' + iARowid).val().trim(), 'string');

    $('#refserialno_' + iARowid).removeClass('error');
    if (sRefSlNo == "") return;

    if (iquotationid != 0) {
        $.post(getBaseURL() + 'project/tender/checkserialfound', {
            serialno: sRefSlNo,
            quotationid: iquotationid,
            prevtransid: iprevtransid
        }, function (data) {
            if (data == "Y") {
                showError($('#refserialno_' + iARowid), 'RefNo already used');
                return;
            }
        });
    }

    if ($('#refserialno_' + iARowid).hasClass('error')) return;
    removeError($('#refserialno_' + iARowid));
    var $codes = $('input[id^=refserialno_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (sRefSlNo.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($('#refserialno_' + iARowid), 'Already Available');
                    return;
                }
            }
        }
    });
}
//function SerialUpdate(x) {
//    var sStr = x.split("_"),
//        iARowid = sStr[1],
//        sParent = 'parentid_'+iARowid,
//        sParentText =  $('#' + sParent).val(),
//        aSerialNo = sParentText.split(" "),
//        sSerialNo = aSerialNo[0],
//        aSNo = sSerialNo.split('.');
//    if (aSNo[1] == "0") sSerialNo = aSNo[0];
//    if ($('#refserialno_' + iARowid).val() != ""  && $('#parentid_'+ iARowid).val().length>0) {
//        var sSerialNo = sSerialNo + '.' + $('#refserialno_' + iARowid).val();
////        $('#serialno_' + iARowid).val(sSerialNo);
//    }
////    else $('#serialno_' + iARowid).val("");
//    var sField = sStr[0];
//    if (sField == "parentid") {
//        if (aSNo[0] != 'Add') {GetWorkGroupDetails(iWGId,x)}
//    }
//    CheckSerialNo(x);
//}
function cboIOWChanged(ival,ifRowid, iARowid,itype) {
    iFocusRowId = ifRowid;
    var name = "rateanal_";
    if (itype == "R") name = "rateanalR_";
    $.ajax({
        url: getBaseURL() + "project/rfc/getiowunit/"+ival,
        async: false,
        type: 'post',
        success: function(data,status) {
            var obj = jQuery.parseJSON(data);
            var objD = obj['details'];
            var objT = obj['trans'];
            var objA = obj['activity'];
            $("label[for='" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
            var dIRate=0;
            if (objT['MixType'] == "R")  dIRate= parseFloat(objT['RRate']);
            else dIRate= parseFloat(objT['SRate']);
            $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dIRate,2,true));
            var objF = $.grep(arrSubIOW, function (element, index) {
                return element.subiowid == ival;
            });
            if  (objF.length ==0) {
                arrSubIOW.push({
                    subiowid: ival,
                    mixtype: objT['MixType'],
                    srate: objT['SRate'],
                    rrate: objT['RRate'],
                    workingqty: objT['WorkingQty'],
                    cementratio: objT['CementRatio'],
                    metailratio: objT['MetalRatio'],
                    sandratio: objT['SandRatio'],
                    thickqty: objT['ThickQty'],
                    rworkingQty: objT['RWorkingQty']
                });
                for (j = 0; j < objA.length; j++) {
                    var irows = $('#resourcerate tr').length;
                    var bFound=false;
                    var iResid = objA[j]['ResourceId'];
                    var dRate=parseFloat(objA[j]['Rate']);
                    for (i = 1; i <= irows; i++) {
                        if ($('#rateresid_' + i).val == iResid) {
                            bFound = true;
                            dRate = parseFloat(isNullCheck($('#rateresrate_' + i).val(),'number'));
                            break;
                        }
                    }
                    if (bFound==false) {
                        var qty = 0;
                        var analQty = parseFloatVal(objT['WorkingQty']);
                        if(analQty != 0);
                        qty =  parseFloatVal(objA[j]['Qty']) / analQty;

                        RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid,qty,objA[j]['TypeId']);
                    }
                    arrSubIOWAnal.push({
                        subiowid: ival,
                        mixtype: objA[j]['MixType'],
                        includeflag: objA[j]['IncludeFlag'],
                        referenceid: objA[j]['ReferenceId'],
                        code: objA[j]['Code'],
                        resourcename: objA[j]['ResourceName'],
                        unitname: objA[j]['UnitName'],
                        resourceid: objA[j]['ResourceId'],
                        qty: objA[j]['Qty'],
                        rate: objA[j]['Rate'],
                        amount: parseFloat(objA[j]['Qty'])*dRate,
                        formula: objA[j]['Formula']
                    });
                }
            }
        }
    });
}

function newResourceDetailsUpdate(id,key1,key2,rtype) {
    var iresrow = isNullCheck(id.split('.')[1],'number');
    var $sresid = $('input[id^=newrowrefid_]');
    var name = "rateanal_";
    if (rtype == "R") name = "rateanalR_";

    $.each($sresid, function (i, obj) {
        var $this = $(this);
        var ikey = isNullCheck($this[0].id.split('_')[1],'number');
        var irow = isNullCheck($('#newrowrefid_' + ikey).val(),'number');
        if (irow == iresrow) {
            $("label[for= '" + name + key1 + "_resunit_" + key2 + "']").html($('#newresunit_'+ irow).val());
            var iTypeId = parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number')),
                dRate= parseFloat(isNullCheck($('#newresrate_'+ irow).val(),'number'));

            $("#" + name + key1 + "_restypeid_" + key2).val(iTypeId);
            $("#" + name + key1 + "_resrate_" + key2).val(sanitizeNumber(dRate,2,true));
            $("#" + name + key1 + '_newresname_' + key2).val($('#newresname_'+ irow).val());
            if (iTypeId !=2) {
                $("#" + name + key1 + "_Wastage_" + key2).prop('readonly', true);
                $("#" + name + key1 + "_Wastage_" + key2).hide();
                $("#" + name + key1 + "_lblWastage_" + key2).hide();
            } else {
                $("#" + name + key1 + "_Wastage_" + key2).prop('readonly', false);
                $("#" + name + key1 + "_Wastage_" + key2).show();
                $("#" + name + key1 + "_lblWastage_" + key2).show();
            }
            if (iTypeId !=4) {
                $("#" + name + key1 + "_Weightage_" + key2).prop('readonly', true);
                $("#" + name + key1 + "_Weightage_" + key2).hide();
                $("#" + name + key1 + "_lblWeightage_" + key2).hide();
            } else {
                $("#" + name + key1 + "_Weightage_" + key2).prop('readonly', false);
                $("#" + name + key1 + "_Weightage_" + key2).show();
                $("#" + name + key1 + "_lblWeightage_" + key2).show();
            }
            return;
        }
    });
}

function cboResChanged(ival,ifRowid, iARowid,rtype) {
    if (ival.length >2) {
        if (ival.substring(0, 2) == "0.") {
            newResourceDetailsUpdate(ival,ifRowid, iARowid);
            return;
        }
    }

    iFocusRowId=ifRowid;
    var dRate=0;
    if (ival.trim() !='') {
//        var irows = $('#resourcerate tr').length;
        var bFound=false;
        var $resid = $('input[id^=rateresid_]');
        var key=0;
        $.each($resid, function (i, obj) {
            key = +i+1;
            var $this = $(this),
                name = $this[0].id;
            var ickey = isNullCheck(name.split('_')[1],'number');
            if (ickey !=0) {
                if ($('#rateresid_' + key).val() == ival) {
                    bFound = true;
                    dRate = parseFloat(isNullCheck($('#rateresrate_' + key).val(), 'number'));
                    return;
                }
            }
        });
        var name = "rateanal_";
        if (rtype == "R") name = "rateanalR_";
        $.ajax({
            url: getBaseURL() + "project/rfc/getresourceunit/"+ival,
            async: false,
            type: 'post',
            success: function(data,status) {
                var obj = jQuery.parseJSON(data);
                var objD = obj['details'];
                var objT = obj['trans'];
                var objA = obj['activity'];
                if (objD.length == 0) return;
                $("label[for= '" + name + iFocusRowId + "_resunit_" + iARowid + "']").html(objD[0].UnitName);
                $("#" + name + iFocusRowId + "_restypeid_" + iARowid).val(objD[0].TypeId);

                if (objD[0].TypeId !=2) {
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).prop('readonly', true);
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).hide();
                    $("#" + name + iFocusRowId + "_lblWastage_" + iARowid).hide();
                } else {
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).prop('readonly', false);
                    $("#" + name + iFocusRowId + "_Wastage_" + iARowid).show();
                    $("#" + name + iFocusRowId + "_lblWastage_" + iARowid).show();
                }

                if (objD[0].TypeId !=4) {
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).prop('readonly', true);
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).hide();
                    $("#" + name + iFocusRowId + "_lblWeightage_" + iARowid).hide();
                } else {
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).prop('readonly', false);
                    $("#" + name + iFocusRowId + "_Weightage_" + iARowid).show();
                    $("#" + name + iFocusRowId + "_lblWeightage_" + iARowid).show();
                }

                if (bFound == true) $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(dRate,2,true));
                else {
                    if (bLoad == false) $("#" + name + iFocusRowId + "_resrate_" + iARowid).val(sanitizeNumber(objD[0].Rate,2,true));
                    var resName = $("#" + name + iFocusRowId + "_resid_" + iARowid).val();
//                    var qty = 0;
//                    var analQty = parseFloatVal($("#" + name + iFocusRowId + "_AnalQty").val());
//                    if(analQty != 0);
//                    qty =  parseFloatVal(objD[0].Qty) / analQty;

                    var qty = 0;
                    var dbOQqty = parseFloatVal(isNullCheck($('#qty_' + iFocusRowId).val(),'number'));
                    var analQty = parseFloatVal(isNullCheck($("#" + name + iFocusRowId + "_AnalQty").val(),'number'));

                    var dResQty = parseFloatVal(isNullCheck($("#" + name + iFocusRowId + "_resqty_" + iARowid).val(),'number'));
                    var dWasteQty = parseFloatVal(isNullCheck($("#" + name + iFocusRowId + "_WastageQty_" + iARowid).val(),'number'));

                    if(analQty != 0) qty =  ((dResQty+dWasteQty) / analQty)*dbOQqty;

                    RateResourceUpdate(resName, objD[0].UnitName, parseFloat(objD[0].Rate), ival,qty,objD[0].TypeId)
                }
                var objF = $.grep(arrActivityRes, function (element, index) {
                    return element.activityid == ival;
                });
                if  (objF.length ==0 && objD[0].TypeId==4) {
                    arrActivityRes.push({
                        activityid: ival,
                        ratetype: objT['RateType'],
                        lRate: objT['LRate'],
                        mRate: objT['MRate'],
                        aRate: objT['MRate'],
                        analysisMQty: objT['AnalysisMQty'],
                        analysisAQty: objT['AnalysisAQty']
                    });
                    for (j = 0; j < objA.length; j++) {
                        var iResid = objA[j]['ResourceId'];
                        bFound=false;
                        dRate=objA[j]['Rate'];
                        $.each($resid, function (i, obj) {
                            var $this = $(this),
                                name = $this[0].id;
                            var ickey = isNullCheck(name.split('_')[1],'number');
                            if (ickey !=0) {
                                if ($('#rateresid_' + i).val() == iResid) {
                                    bFound = true;
                                    dRate = isNullCheck($('#rateresrate_' + i).val(), 'number');
                                    return;
                                }
                            }
                        });
                        if (bFound==false)  {
                            var qty = 0;
                            var analQty = parseFloatVal(objA[j]['Qty']);
                            if(analQty != 0);
                            qty =  parseFloatVal(objA[j]['Qty']) / analQty;

                            RateResourceUpdate(objA[j]['ResourceName'], objA[j]['UnitName'], dRate, iResid,qty,objA[j]['TypeId']);
                        }
                        arrActivityAnal.push({
                            activityid: ival,
                            activitytype: objA[j]['ActivityType'],
                            resourceid: objA[j]['ResourceId'],
                            resourcename: objA[j]['ResourceName'],
                            unitname: objA[j]['UnitName'],
                            qty: objA[j]['Qty'],
                            rate: dRate,
                            amount: parseFloat(objA[j]['Qty'])*dRate
                        });
                    }
                }
            }
        });
    }
}
function clickbut(x) {
    iARowId = x.split("_")[1];
    if ($('.subTr_' + iARowId).is(':visible')) return;
    $('.mainTr_' + iARowId).trigger('click');
}
function validateRow(x) {
    iARowId = x.split("_")[1];
    var scurId = "_" + iARowId,
        sparentId = $('#parentkeyid' + scurId).val(),
//        $sparentId = $('#parentid' + scurId),
        $sserialno = $('#refserialno' + scurId),
        $sspec = $('#spec' + scurId),
        sUnit = $('#unitkeyid' + scurId).val();
//    if (sparentId.length==0) {
//        //alert("Parent Not Selected");
//        $sparentId.focus();
//        return false;
    if($sserialno.val().length==0) {
        showError($sserialno, 'Required');
        alert("Ref No is Empty");
        $sserialno.focus();
        return false;
    } else if($sspec.val().length==0) {
        showError($sspec, 'Required');
        $sspec.focus();
        return false;
    } else if(sUnit.length==0 || sUnit==0) {
        showError($('#unitid' + scurId, 'Required'));
        $('#unitid' + scurId).focus();
        return false;
    }
//    $sparentId.prop('readonly', true);
    bSiteMix = true;
    CheckShowDetails();
    //  CalculateFull();
    return true;
}
function CheckShowDetails() {
    if ($('#concrete_' + iFocusRowId).is(':checked') == false) $('#ramixtable'+'_'+iFocusRowId).hide();
    else $('#ramixtable_'+'_'+iFocusRowId).show();
}
//function closedetails(key) {
//    var $mainTRs = $("a[class*=mainTr_]");
//    $.each($mainTRs, function (i, obj) {
//        var $this = $(this),
//            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
//        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
//        if($mainTr.length != 0) $mainTr.trigger('click');
//    });
//}
function closedetails(name) {
    var $mainTRs = $("a[class*=mainTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this);
        if (name != $this[0].className) {
            key = $this[0].className.split('_')[1];
            var $subTr = $(this).closest("tr").nextAll(".subTr_" + key),
                $i = $(this).find("i");
            if ($subTr.is(":visible")) {
                $subTr.find(".subDiv").slideUp("slow");
                $subTr.slideUp("slow");
                $i.removeClass("fa-chevron-circle-up");
                $i.addClass("fa-chevron-circle-down");
            }
        }
    });
}

function IOWUpdate() {
    $('.loading_area').show();
//    if (excelSheetValid()==false) {
//        $('.loading_area').hide();
//        alert("Invalid Sheet");
//        return;
//    }
    var iMRowId = $('#rowid').val();
    var ioRowId = iMRowId;
    var iRowTransId=1;
    var iWBSRowTransId=1;
    bexcelUpdate=true;
    //var irows = $('#excelTable tr').length-1;
    var $excelpids = $('input[id^=excelparentid_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        //for (var i = 1; i <= irows; i++) {
        var sRowType = isNullCheck($('#excelrowtype_'+key1).val(),'string');
        if (sRowType == "I" || sRowType == "H") {
            if (iRowTransId >1) AddNewRowRes(iMRowId,iRowTransId);
            if (iWBSRowTransId >1 && iMRowId >1) {
                var iWBSRowId = parseInt(isNullCheck($('#wbstable_'+iMRowId+'_rows').val(),'number'));
                if (iWBSRowId >1) AddNewWBSRow('wbstable_' + iMRowId + '_wbsname_' + iWBSRowId);
            }
            ioRowId = iMRowId;
            if ($('#spec_' + iMRowId).val() != "")  iMRowId = + iMRowId+1;
            if (iMRowId !=1) {
                var sStr = $('#dummytable tbody').html();
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_1');
//                if (ioRowId !=1) {ioRowId = (ioRowId*2)-1 ;}
//                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
                $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
            }
            var pId =$("#excelwgid_"+key1).val();
            if ($("#excelparentid_"+key1).val() !=0) pId = pId + "." + $("#excelparentid_"+key1).val();
            $('#parentkeyid_' + iMRowId).val(pId);
            $('#refserialno_' + iMRowId).val($('#excelserialno_'+key1).val());
//            $('#serialno_' + iMRowId).val($('#excelserialno_'+ key1).val());
            $('#spec_' + iMRowId).val($('#excelspec_'+ key1).val());

            $('#pworkgroupname_' + iMRowId).val($('#excelnewworkgroupname_'+ key1).val());
            $('#worktypeid_' + iMRowId).val($('#excelwgtypeid_'+ key1).val());
            $('#workgroupid_' + iMRowId).val($('#excelwgid_'+ key1).val());
            $('#pworkgroupid_' + iMRowId).val($('#excelwgid_'+ key1).val());
            $('#newparentname_' + iMRowId).val($('#excelparentspec_'+ key1).val());

            if ($('#excelrowtype_'+key1).val() == "I") {
                $('#unitid_' + iMRowId).val($('#excelunit_' + key1).val());
                $('#unitkeyid_' + iMRowId).val($('#excelunitid_' + key1).val());
                $('#headerrow_' + iMRowId).val(0);

                var dQty = parseFloatVal(isNullCheck($('#excelqty_' + key1).val(),'number')),
                    dQRate = parseFloatVal(isNullCheck($('#excelqrate_' + key1).val(),'number')),
                    dQAmt = dQty*dQRate;

                $('#qty_' + iMRowId).val(sanitizeNumber(dQty,3));
                $('#qrate_' + iMRowId).val(sanitizeNumber(dQRate,2,true));
                $('#qamt_' + iMRowId).val(sanitizeNumber(dQAmt,2,true));

                $('.mainTrDelete_' + iMRowId).show();
            } else {
                $('#raheader_'+iMRowId).prop("checked", true);
                checkHeader('raheader_' + iMRowId);
                $('#headerrow_' + iMRowId).val(1);
            }
            $('#parentid_' + iMRowId).val($('#excelparent_'+ key1).val());

            CheckParentValid('parentid_'+iMRowId);
            GetWorkTypeDetails($('#excelwgtypeid_'+ key1).val(),"parentid_"+ iMRowId);
            bindLibraryIOW($('#excelwgtypeid_'+ key1).val(),"libiowid_"+ iMRowId)

            var iIOWId =  parseInt(isNullCheck($('#exceliowid_' + key1).val(),'number'));
            if (iIOWId !=0) {
                $("#libiowkeyid_" + iMRowId).val(iIOWId);
                $('#libiowid_' + iMRowId).val($('#excellibref_' + key1).val());
                GetIOWDetails(iIOWId, "libiowkeyid_" + iMRowId)
            }
            $('#rowid').val(iMRowId);
            iRowTransId=1;
            iWBSRowTransId=1;
        } else if (sRowType=="R") {
            if (iRowTransId!=1) {
                var stabelrow = '#rateanal_' + iMRowId + '_restable';
                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                sStr = sStr.replace(/__1/g, '_' + iMRowId);
                sStr = sStr.replace(/__9/g, '_' + iRowTransId);
                sStr = sStr.replace(/R1/g, 'R' + iRowTransId);
                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                //$(stabelrow+" tbody tr:nth-child(" + (iRowTransId - 1) + ")").after(sStr);
                $('#rateanal_' + iMRowId + '_refid_' + iRowTransId).val(iRowTransId);
            }
            $('#rateanal_' + iMRowId + '_code_' + iRowTransId).val($('#excelserialno_' + key1).val());
            $('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId).val($('#excelresid_' + key1).val());
            $('#rateanal_' + iMRowId + '_newresname_' + iRowTransId).val($('#excelnewresspec_' + key1).val());

            var dQty = parseFloatVal(isNullCheck($('#excelqty_' + key1).val(),'number')),
                dRate= parseFloatVal(isNullCheck($('#excelrate_' + key1).val(),'number')),
                iTypeid = $('#excelrestypeid_' + key1).val();

            $('#rateanal_' + iMRowId + '_resqty_' + iRowTransId).val(sanitizeNumber(dQty,3));
            $('#rateanal_' + iMRowId + '_resunit_' + iRowTransId).val($('#excelunit_' + key1).val());

            dRate = getExcelResourceRate($('#excelnewresspec_'+ key1).val(),$('#excelunit_' + key1).val(),dRate,$('#excelresid_' + key1).val(),dQty,iTypeid);
            var dAmt = dQty*dRate;

            $('#rateanal_' + iMRowId + '_resrate_' + iRowTransId).val(sanitizeNumber(dRate,2,true));
            $('#rateanal_' + iMRowId + '_resamt_' + iRowTransId).val(sanitizeNumber(dAmt,2,true));
            $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).val($('#excelnewresspec_'+ key1).val());
            if (isNullCheck($('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId),'number') !=0) $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).prop('readonly', true);

            var name ="rateanal_";
            $("label[for= '" + name + iMRowId + "_resunit_" + iRowTransId + "']").html($('#excelunit_' + key1).val());
            $("#" + name + iMRowId + "_restypeid_" + iRowTransId).val(iTypeid);

            if (iTypeid !=2) {
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).prop('readonly', true);
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).hide();
                $("#" + name + iMRowId + "_lblWastage_" + iRowTransId).hide();
            } else {
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).prop('readonly', false);
                $("#" + name + iMRowId + "_Wastage_" + iRowTransId).show();
                $("#" + name + iMRowId + "_lblWastage_" + iRowTransId).show();
            }

            if (iTypeid !=4) {
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).prop('readonly', true);
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).hide();
                $("#" + name + iMRowId + "_lblWeightage_" + iRowTransId).hide();
            } else {
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).prop('readonly', false);
                $("#" + name + iMRowId + "_Weightage_" + iRowTransId).show();
                $("#" + name + iMRowId + "_lblWeightage_" + iRowTransId).show();
            }
            $('#rowinfoid_' + iMRowId).val(iRowTransId);
            ValueChange('rateanal_' + iMRowId + '_resqty_' + iRowTransId);
            $('#rateanal_'+iMRowId+'_resdel_' + iRowTransId).show();
            SortOrder(iMRowId);
            iRowTransId = +iRowTransId+1;
        } else if (sRowType=="WBS") {
            if (iWBSRowTransId!=1) {
                var sStr = $('#dummywbstable tbody').html()
                    .replace(/__1/g,'_'+ iMRowId)
                    .replace(/__9/g,'_'+ iWBSRowTransId);
                $('#wbstable_'+ iMRowId +" tbody tr:last").before(sStr);
            }
            var dQty = parseFloatVal(isNullCheck($('#excelqty_' + key1).val(),'number'));
            $('#wbstable_'+iMRowId+'_wbsid_'+iWBSRowTransId).val($('#excelwbsid_'+key1).val());
            $('#wbstable_'+iMRowId+'_wbsname_'+iWBSRowTransId).val($('#excelspec_'+key1).val());
            $('#wbstable_'+iMRowId+'_qty_'+iWBSRowTransId).val(sanitizeNumber(dQty,3));
            $('.wbstable_'+iMRowId+'_TrDelete_'+iWBSRowTransId).show();
            $('#wbstable_'+iMRowId+'_rows').val(iWBSRowTransId);
            wbsQtyChange('#wbstable_'+iMRowId+'_qty_'+iWBSRowTransId);

            iWBSRowTransId = +iWBSRowTransId+1;
        }
    });
    bexcelUpdate=false;
    if (iRowTransId >1 && iMRowId >1) AddNewRowRes(iMRowId,iRowTransId);
    if (iWBSRowTransId >1 && iMRowId >1) {
        var iWBSRowId = parseInt(isNullCheck($('#wbstable_'+iMRowId+'_rows').val(),'number'));
        if (iWBSRowId >1) AddNewWBSRow('wbstable_' + iMRowId + '_wbsname_' + iWBSRowId);
    }
    if (iMRowId >1) { $('#divExcelImport').hide(); AddNewRowA('spec_' +iMRowId); }

    bindAutoComplete();
    bindResourceAutoComplete();
    bindResourceChange();
    expandTrFn(true);
    bindTRDeleteFn(true);
    bindMixSortablefn(true);
    expandwasteTrFn(true);
    expandwbsTrFn(true);
    getWBSMasterList();
    bindWBSautoComplete();
    checkRAUsed();
    $('#excelmodal').modal('toggle');
    $('.loading_area').hide();

//    $('.loading_area').show();
//    if (excelSheetValid()==false) {
//        alert("Invalid Sheet");
//        return;
//    }
//    var iMRowId = $('#rowid').val();
//    ioRowId = iMRowId;
//    var iRowTransId=1;
//    //var irows = $('#excelTable tr').length-1;
//    var $excelpids = $('input[id^=excelparentid_]');
//    $.each($excelpids, function (i, obj) {
//        var $this = $(this),
//            name = $this[0].id;
//        var key1 = name.split('_')[1];
//        //for (i = 1; i <= irows; i++) {
//        if ($('#excelrowtype_'+key1).val() == "I") {
//            ioRowId = iMRowId;
//            if ($('#spec_' + iMRowId).val() != "")  iMRowId = + iMRowId+1;
//            if (iMRowId !=1) {
//                var sStr = $('#dummytable tbody').html();
//                sStr = sStr.replace(/__1/g, '_' + iMRowId);
//                sStr = sStr.replace(/__9/g, '_1');
////                if (ioRowId !=1) {ioRowId = (ioRowId*2)-1 ;}
////                $('#sample12 > tbody > tr').eq(ioRowId).after(sStr);
//                $('#sample12 > tbody > tr.subTr_' + ioRowId).after(sStr);
//            }
//            var pId =$("#excelwgid_"+key1).val();
//            if ($("#excelparentid_"+key1).val() !=0) pId = pId + "." + $("#excelparentid_"+key1).val();
//            $('#parentkeyid_' + iMRowId).val(pId);
//            $('#refserialno_' + iMRowId).val($('#excelrefslno_'+key1).val());
////            $('#serialno_' + iMRowId).val($('#excelserialno_'+ key1).val());
//            $('#spec_' + iMRowId).val($('#excelspec_'+ key1).val());
//            $('#unitid_' + iMRowId).val($('#excelunit_'+ key1).val());
//            $('#unitkeyid_' + iMRowId).val($('#excelunitid_'+ key1).val());
//            $('#parentid_' + iMRowId).val($('#excelparentspec_'+ key1).val());
//            $('.mainTrDelete_' + iMRowId).show();
//
//            $('#rowid').val(iMRowId);
//            iRowTransId=1;
//        } else {
//            if (iRowTransId!=1) {
//                var stabelrow = '#rateanal_' + iMRowId + '_restable';
//                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
//                sStr = sStr.replace(/__1/g, '_' + iMRowId);
//                sStr = sStr.replace(/__9/g, '_' + iRowTransId);
//                sStr = sStr.replace(/R1/g, 'R' + iRowTransId);
//                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
//                //$(stabelrow+" tbody tr:nth-child(" + (iRowTransId - 1) + ")").after(sStr);
//                $('#rateanal_' + iMRowId + '_refid_' + iRowTransId).val(iRowTransId);
//            }
//            $('#rateanal_' + iMRowId + '_code_' + iRowTransId).val($('#excelcode_' + key1).val());
//            $('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId).val($('#excelresid_' + key1).val());
//            $('#rateanal_' + iMRowId + '_resqty_' + iRowTransId).val($('#excelqty_' + key1).val());
//            $('#rateanal_' + iMRowId + '_resunit_' + iRowTransId).val($('#excelunit_' + key1).val());
//            $('#rateanal_' + iMRowId + '_resrate_' + iRowTransId).val($('#excelrate_' + key1).val());
//            $('#rateanal_' + iMRowId + '_resamt_' + iRowTransId).val($('#excelamount_' + key1).val());
//            $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).val($('#excelparentspec_'+ key1).val());
//            if (isNullCheck($('#rateanal_' + iMRowId + '_reskeyid_' + iRowTransId),'number') !=0) $('#rateanal_' + iMRowId + '_resid_' + iRowTransId).prop('readonly', true);
//
//            $('#rowinfoid_' + iMRowId).val(iRowTransId);
//            SortOrder(iMRowId);
//            iRowTransId = +iRowTransId+1;
//        }
//
//        if($('#excelwbsrowid_'+key1).length != 0 && $('#excelwbsrowid_'+key1).val().length != 0) {
//            var wbsrowid = isNullCheck($('#excelwbsrowid_' + key1).val(), 'number');
//            for(var i=1; i <= wbsrowid; i++) {
//                var iRowId = isNullCheck($('#wbstable_' + iMRowId + '_rows').val(), 'number');
//                $('#wbstable_'+iMRowId+'_wbsid_'+iRowId).val($('#excelwbstable_'+key1+'_wbsid_'+i).val());
//                $('#wbstable_'+iMRowId+'_wbsname_'+iRowId).val($('#excelwbstable_'+key1+'_wbsname_'+i).val());
//                $('#wbstable_'+iMRowId+'_qty_'+iRowId).val($('#excelwbstable_'+key1+'_qty_'+i).val());
//                $('.wbstable_'+iMRowId+'_TrDelete_'+iRowId).show();
//                wbsQtyChange('#wbstable_'+iMRowId+'_qty_'+iRowId);
//
//                iRowId++;
//                var sStr = $('#dummywbstable tbody').html()
//                    .replace(/__1/g,'_'+ iMRowId)
//                    .replace(/__9/g,'_'+ iRowId);
//                $('#wbstable_'+ iMRowId +" tbody tr:last").before(sStr);
//                $('#wbstable_' + iMRowId + '_rows').val(iRowId);
//            }
//        }
//    });
//    bindAutoComplete();
//    bindResourceAutoComplete();
//    bindResourceChange();
//    expandTrFn(true);
//    bindTRDeleteFn(true);
//    bindMixSortablefn(true);
//    expandwasteTrFn(true);
//    expandwbsTrFn(true);
//    getWBSMasterList();
//    bindWBSautoComplete();
//
//    $('#excelmodal').modal('toggle');
//    $('.loading_area').hide();
}

function getExcelResourceRate(resName,unit,rate,resId,qty,resTyeId) {
    var bFound=false;
    var $resid = $('input[id^=rateresid_]');
    var key=0;
    var dRate =rate;
    $.each($resid, function (i, obj) {
        key = +i+1;
        var $this = $(this),
            name = $this[0].id;
        var ickey = isNullCheck(name.split('_')[1],'number');
        if (ickey !=0) {
            if ($('#rateresid_' + key).val() == resId) {
                bFound = true;
                dRate = parseFloat(isNullCheck($('#rateresrate_' + key).val(), 'number'));
                return;
            }
        }
    });
    if (bFound==false) RateResourceUpdate(resName,unit,rate,resId,qty,resTyeId);
    return dRate;
}


function fileupload(isWBSRequest) {
    var isValid=true;
    var $excelpids = $('input[id^=field_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#field_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    if (isValid==false) {alert ("Please Assign Fields Correctly"); return isValid;}

//    $("#excelmodal").modal('hide');
    var bValid=true;
    var arrHeader =[];
    for (var i = 0; i < $("#excelfieldTable").find("th").length; i++) {
        arrHeader.push({efield: $('#efield_'+i).val(), field: $('#field_'+i).val()});
    }
    arrHeader =  JSON.stringify(arrHeader);
    formData.append('arrHeader', arrHeader);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() + "project/rfc/uploadLiow",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);
            var key1=1;
            if (obj[0].Valid==true) {
                $('#excelTable tr:gt(1)').remove();
                var $excelpids = $('input[id^=excelserialno_]');
                $.each($excelpids, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    key1 = name.split('_')[1];
                });
                var irow = key1;

                $("#excelserialno_" + irow).val('');
//                $("#excelcode_" + irow).val('');
                $("#excelspec_" + irow).val('');
                $("#excelunit_" + irow).val('');
                $("#excelqty_" + irow).val('');
                $("#excelrate_" + irow).val('');
                $("#excelamount_" + irow).val('');
                $("#excelqrate_" + irow).val('');
                $("#excelqamount_" + irow).val('');

//                $("#excelrefslno_" + irow).val('');
                $("#excelrowtype_" + irow).val('');
                $("#exceliowid_" + irow).val('');
                $("#excelparentid_" + irow).val('');
                $("#excelwgid_" + irow).val('');
                $("#excelwbsid_" + irow).val('');
                $("#excelwgtypeid_" + irow).val('');
                $("#excelresid_" + irow).val('');
                $("#excelrestypeid_" + irow).val('');
                $("#excelunitid_" + irow).val('');
                $("#excelparentspec_" + irow).val('');
                var sOldid = "_" + key1;
                for (var i = 0; i < obj.length; i++) {
                    if (irow != key1)  {
                        $("#excelTable tbody tr:last").after('<tr id ="excelrowid_' + irow +'">' + $("#excelTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("textarea").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                    }
                    bindExcelDeleteFn(true);
                    $("#excelserialno_" + irow).val(obj[i].SerialNo);
//                    $("#excelcode_" + irow).val(obj[i].Code);
                    $("#excelspec_" + irow).val(obj[i].Specification);
                    $("#excelunit_" + irow).val(obj[i].UnitName);
                    $("#excelqty_" + irow).val(obj[i].Qty);
                    $("#excelrate_" + irow).val(obj[i].Rate);
                    $("#excelamount_" + irow).val(obj[i].Qty * obj[i].Rate);
                    $("#excelqrate_" + irow).val(obj[i].QRate);
                    $("#excelqamount_" + irow).val(obj[i].Qty * obj[i].QRate);
                    $("#excelrowtype_" + irow).val(obj[i].RowType);
                    $("#exceliowid_" + irow).val(obj[i].IOWId);
                    $("#excelparentid_" + irow).val(obj[i].ParentId);
                    $("#excelwgid_" + irow).val(obj[i].WGId);
                    $("#excelwgtypeid_" + irow).val(obj[i].WorkTypeId);
                    $("#excelresid_" + irow).val(obj[i].ResourceId);
                    $("#excelunitid_" + irow).val(obj[i].UnitId);
                    $("#excelparent_" + irow).val(obj[i].ParentSpec);
                    $("#excelparentspec_" + irow).val(obj[i].ParentSpec);
                    $("#excelnewresspec_" + irow).val(obj[i].Specification);
                    $("#excelrestypeid_" + irow).val(obj[i].ResTypeId);
                    validRowType("excelrowtype_" + irow);
                    if ($("#excelrowtype_" + irow).hasClass('error')) bexcelRowTypeFound=true;

                    if (obj[i].RowType == "WG") {
                        $('#excelrowid_' + irow).addClass('excel1');
                    } else if (obj[i].RowType == "H") {
                        $('#excelrowid_' + irow).addClass('excel2');
                    } else if (obj[i].RowType == "I") {
                        $('#excelrowid_' + irow).addClass('excel3');
                    }  else if (obj[i].RowType == "R") {
                        $('#excelrowid_' + irow).addClass('excel4');
                    }

                    irow = +irow + 1;
                }
            } else bValid=false;

            isValid =bValid;

            if (bValid==false) alert("Invalid File Format");
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400) alert(xhr.responseText);
            else alert(errorThrown);
        }
    });

    clearInputFile($('#myfile'));
//    excelvalid();
    return isValid;
}

function bindExcelWBSExpand(x) {
    var key = $(x)[0].className.split('_')[1];
    var $subTr = $(x).closest("tr").nextAll(".excelwbsmainTr_" + key),
        $i = $(x).find("i");
    if(!$subTr.is(":visible")){
        $subTr.show();
        $subTr.find(".subDiv").slideDown("slow");
        $i.removeClass("fa-chevron-circle-down");
        $i.addClass("fa-chevron-circle-up");
    } else {
        $subTr.find(".subDiv").slideUp("slow");
        $subTr.slideUp("slow");
        $i.removeClass("fa-chevron-circle-up");
        $i.addClass("fa-chevron-circle-down");
    }
    return false;
}

//function fileupload(x) {
//    var bValid=true;
//    var formData = new FormData();
//    formData.append('file', $('#myfile').prop("files")[0]);
//    $.ajax({
//        url: getBaseURL() + "project/rfc/UploadIOWData",
//        async: false,
//        dataType: 'script',
//        cache: false,
//        contentType: false,
//        processData: false,
//        data: formData,
//        type: 'post',
//        success: function(data,status, xhr) {
//            var obj = jQuery.parseJSON(data);
//            var key1=1;
//            if (obj[0].Valid==true) {
//                $('#excelTable tr:gt(1)').remove();
//                var $excelpids = $('input[id^=excelserialno_]');
//                $.each($excelpids, function (i, obj) {
//                    var $this = $(this),
//                        name = $this[0].id;
//                    key1 = name.split('_')[1];
//                });
//                var irow = key1;
//
//                $("#excelserialno_" + irow).val('');
//                $("#excelcode_" + irow).val('');
//                $("#excelspec_" + irow).val('');
//                $("#exceliows_" + irow).val('');
//                $("#excelunit_" + irow).val('');
//                $("#excelqty_" + irow).val('');
//                $("#excelrate_" + irow).val('');
//                $("#excelamount_" + irow).val('');
//                $("#excelrefslno_" + irow).val('');
//                $("#excelrowtype_" + irow).val('');
//                $("#exceliowid_" + irow).val('');
//                $("#excelparentid_" + irow).val('');
//                $("#excelwgid_" + irow).val('');
//                $("#excelresid_" + irow).val('');
//                $("#excelunitid_" + irow).val('');
//                $("#excelparentspec_" + irow).val('');
//                var sOldid = "_" + key1;
//                for (i = 0; i < obj.length; i++) {
//                    if (irow != key1)  {
//                        var sNewid = "_" + irow;
//                        $("#excelTable tbody tr:last").after("<tr>" + $("#excelTable tbody tr:first").html() + "</tr>");
//                        $("#excelTable tbody tr:last").find("input:text").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                        $("#excelTable tbody tr:last").find("input:hidden").each(function () {
//                            $(this).attr("name", $(this).attr("name").replace(sOldid, sNewid));
//                            $(this).attr("id", $(this).attr("id").replace(sOldid, sNewid));
//                        });
//                        $("#excelTable tbody tr:last").find("a[class*=excelTrDelete_]").each(function () {
//                            $(this).attr("class", $(this).attr("class").replace("__1", sNewid));
//                        });
//                    }
//                    bindExcelDeleteFn(true);
//                    $("#excelserialno_" + irow).val(obj[i].SerialNo);
//                    $("#excelcode_" + irow).val(obj[i].Code);
//                    $("#excelspec_" + irow).val(obj[i].Specification);
//                    $("#exceliows_" + irow).val(obj[i].IOWs);
//                    $("#excelunit_" + irow).val(obj[i].UnitName);
//                    $("#excelqty_" + irow).val(obj[i].Qty);
//                    $("#excelrate_" + irow).val(obj[i].Rate);
//                    $("#excelamount_" + irow).val(obj[i].Qty * obj[i].Rate);
//                    $("#excelrefslno_" + irow).val(obj[i].RefSerialNo);
//                    $("#excelrowtype_" + irow).val(obj[i].RowType);
//                    $("#exceliowid_" + irow).val(obj[i].IOWId);
//                    $("#excelparentid_" + irow).val(obj[i].ParentId);
//                    $("#excelwgid_" + irow).val(obj[i].WGId);
//                    $("#excelresid_" + irow).val(obj[i].ResourceId);
//                    $("#excelunitid_" + irow).val(obj[i].UnitId);
//                    $("#excelparentspec_" + irow).val(obj[i].ParentSpec);
//
//                    irow = +irow + 1;
//                }
//            } else bValid=false;
//            if (bValid==true) $("#excelmodal").modal('show');
//            else  alert("Invalid File Format");
//        },
//        error: function(xhr, status, errorThrown) {
//            if (xhr.status == 400) alert(xhr.responseText);
//            else alert(errorThrown);
//        }
//    });
//    clearInputFile($('#myfile'));
//    excelvalid();
//}


function bindExcelDeleteFn(reset) {
    var $trDelete = $('a[class*=excelTrDelete_]');
    if (typeof reset !== 'undefined' && reset === true) $trDelete.unbind('click');
    $.each($trDelete, function (i, obj) {
        var $this = $(this),
            name = $this[0].className;
        $this.on('click', function(e) {
            e.preventDefault();
            var ikey1=0;
            if (name.indexOf('__')  != -1) ikey1=1;
            else ikey1 = name.split('_')[1];
            if (isNullCheck($("#excelserialno_" + ikey1).val(),'string') != "") {
                var ikey2 = + ikey1+1;
                if ($("#excelcode_" + ikey2).length !=0) {
                    if (isNullCheck($("#excelcode_" + ikey2).val(),'string') != "") return;
                }
            }
            if (confirm('Do you want to Delete')) {
                var tr_length = $('#excelTable tr').length;
                if (tr_length ==2) {
                    var $excelpids = $('input[id*=excelserialno_]');
                    $.each($excelpids, function (i, obj) {
                        var $this = $(this),
                            name = $this[0].id;
                        var key1 = name.split('_')[1];
                        $("#excelserialno_" + key1).val('');
                        $("#excelcode_" + key1).val('');
                        $("#excelspec_" + key1).val('');
                        $("#exceliows_" + key1).val('');
                        $("#excelunit_" + key1).val('');
                        $("#excelqty_" + key1).val('');
                        $("#excelrate_" + key1).val('');
                        $("#excelamount_" + key1).val('');
                        $("#excelrefslno_" + key1).val('');
                        $("#excelrowtype_" + key1).val('');
                        $("#exceliowid_" + key1).val('');
                        $("#excelparentid_" + key1).val('');
                        $("#excelwgid_" + key1).val('');
                        $("#excelresid_" + key1).val('');
                        $("#excelunitid_" + key1).val('');
                        $("#excelparentspec_" + key1).val('');
                    });
                } else {
                    $this.closest('tr').remove();
                }
            }
            return false;
        });
    });
}
function formulacalculation() {
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            if  (bSiteMix==true) {
                var sCement = '#rateanal_' + iFocusRowId + '_AQty';
                var sSand = '#rateanal_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
                var sThick = '#rateanal_' + iFocusRowId + '_thick';
            } else {
                var sCement = '#rateanalR_' + iFocusRowId + '_AQty';
                var sSand = '#rateanalR_' + iFocusRowId + '_BQty';
                var sMetal = '#rateanalR_' + iFocusRowId + '_CQty';
                var sThick = '#rateanalR_' + iFocusRowId + '_thick';
            }
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/A/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());
            if  (bSiteMix==true) {
                var rows = $('#rowinfoid_' + iFocusRowId).val();
                for (i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            } else {
                var rows = $('#rowinfoidR_' + iFocusRowId).val();
                for (i = 1; i <= rows; i++) {
                    if (i != iTransRowId) {
                        var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                        var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                        sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                    }
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            alert('Expression Invalid.');
        }
    }
    $("#formulavalue").val(sanitizeNumber(fvaule,3));
}
function showformulaR(x,bshow) {
    bSiteMix=false;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = $(sExp).val();
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }

    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var rows = $('#rowinfoidR_' + iFocusRowId).val();
            for (i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanalR_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanalR_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            $('#btnformula').prop('disabled', true);
            alert('Expression in invalid.');
        }
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else {
        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
        else if (stype=="I") {
            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
                $("#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
    }
}
function showF(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }  else if (stype=="I"){
            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformula(x, true);
        }
        event.preventDefault();
    }
}
function showFR(x,event) {
    if(event.keyCode ==113) {
        var sStr = x.split("_");
        iTransRowId = sStr[3];
        var stype =  isNullCheck($('#rateanalR_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        } else if (stype=="I"){
            if ($('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanalR_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0) showformulaR(x, true);
        }
        event.preventDefault();
    }
}
function showformula(x,bshow) {
    bSiteMix=true;
    var sStr = x.split("_");
    iFocusRowId = sStr[1];
    iTransRowId = sStr[3];
    var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId,
        sExpression = $(sExp).val();
    if (sExpression == "" && bshow==true) {
        if (parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number')) !=0) {
            sExpression = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        }
    }
    $("#formulaexp").val(sExpression)
    var sformula = $("#formulaexp").val(),
        fvaule=0;
    if (sformula.length >0) {
        try {
            var sCement = '#rateanal_' + iFocusRowId + '_AQty';
            var sSand = '#rateanal_' + iFocusRowId + '_BQty';
            var sMetal = '#rateanal_' + iFocusRowId + '_CQty';
            var sThick = '#rateanal_' + iFocusRowId + '_thick';
            sformula = sformula.replace(/C/g, $(sCement).val());
            sformula = sformula.replace(/S/g, $(sSand).val());
            sformula = sformula.replace(/M/g, $(sMetal).val());
            sformula = sformula.replace(/T/g, $(sThick).val());
            var rows = $('#rowinfoid_' + iFocusRowId).val();
            for (i = 1; i <= rows; i++) {
                if (i != iTransRowId) {
                    var sRef = $('label[for=rateanal_' + iFocusRowId + '_ref_' + iTransRowId + ']').html().trim();
                    var dAmt= $('#rateanal_' + iFocusRowId + '_resamt_' + iTransRowId).val();
                    sformula = sformula.replace(new RegExp(sRef, 'g'), dAmt);
                }
            }
            //fvaule = eval(sformula);
            fvaule = computeEval(sformula);
            $('#btnformula').prop('disabled', false);
        } catch (e) {
            res = 'Expression Invalid.';
            $('#btnformula').prop('disabled', true);
            alert(res);
        }
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else if (bshow==true) {
        $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', true);
        fvaule = parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).val(),'number'));
        $("#formulavalue").val(sanitizeNumber(fvaule,3));
        $("#formula").modal('show');
    } else {
        var stype =  isNullCheck($('#rateanal_' + iFocusRowId + '_type_' + iTransRowId).val(),'string');
        if (stype=="R") {
            if ($('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_reskeyid_' + iTransRowId).val().length != 0)
                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
        else if (stype=="I") {
            if ($('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val() != '0' && $('#rateanal_' + iFocusRowId + '_iowkeyid_' + iTransRowId).val().length != 0)
                $("#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId).prop('readonly', false);
        }
    }
}
function formulaok() {
    if (bSiteMix == true) {
        var sExp = "#rateanal_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanal_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanal_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanal_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));
        var iRows = $('#rowinfoid_' + iFocusRowId).val();
        var dTAmt = 0;
        for (i = 1; i <= iRows; i++) {
            if ($('#rateanal_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanal_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        }
        $('#rateanal_' + iFocusRowId + 'totrate').val(sanitizeNumber(dTAmt,2,true));
        var dAnalQty = parseFloat(isNullCheck($('#rateanal_' + iFocusRowId + '_AnalQty').val(),'number'));
        if (dAnalQty.length == 0 || dAnalQty == 0 || dAnalQty == "Working Qty") {
            dAnalQty = 1;
            $('#rateanal_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
        }
        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
        $('#rateanal_' + iFocusRowId + 'ltotrate').val('Rate for ' + dAnalQty + ' ' + sUnit);
        $('#rateanal_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
        var dNetRate = dTAmt / dAnalQty;
        $('#rateanal_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
        $('#rateanal_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    } else {
        var sExp = "#rateanalR_" + iFocusRowId + "_formula_" + iTransRowId;
        var sqty = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sformulaexp = $("#formulaexp").val();
        var sformulaval = parseFloat(isNullCheck($("#formulavalue").val(),'number'));
        if (sformulaexp != sformulaval) $(sExp).val(sformulaexp);
        else $(sExp).val("");
        $(sqty).val(sanitizeNumber(sformulaval,3));
        var sQtyRow = "#rateanalR_" + iFocusRowId + "_resqty_" + iTransRowId;
        var sRateRow = "#rateanalR_" + iFocusRowId + "_resrate_" + iTransRowId;
        var sAmtRow = "#rateanalR_" + iFocusRowId + "_resamt_" + iTransRowId;
        var dQty = parseFloat(isNullCheck($(sQtyRow).val(),'number'));
        var dRate = parseFloat(isNullCheck($(sRateRow).val(),'number'));
        var dAmt = dQty * dRate;
        $(sAmtRow).val(sanitizeNumber(dAmt,2,true));
        var iRows = parseInt(isNullCheck($('#rowinfoidR_' + iFocusRowId).val(),'number'));
        var dTAmt = 0;
        for (i = 1; i <= iRows; i++) {
            if ($('#rateanalR_' + iFocusRowId + '_inc_' + i).is(':checked') == true) dTAmt = dTAmt + parseFloat(isNullCheck($("#rateanalR_" + iFocusRowId + "_resamt_" + i).val(),'number'));
        }
        $('#rateanalR_' + iFocusRowId + '_totrate').val(sanitizeNumber(dTAmt,2,true));
        var dAnalQty = parseFloat(isNullCheck($('#rateanalR_' + iFocusRowId + '_AnalQty').val(),'number'));
        if (dAnalQty.length == 0 || dAnalQty == 0) {
            dAnalQty = 1;
            $('#rateanalR_' + iFocusRowId + '_AnalQty').val(sanitizeNumber(dAnalQty,3));
        }
        var sUnit = $('select[name= unitid_' + iFocusRowId + '] option:selected').text();
        $('#rateanalR_' + iFocusRowId + 'ltotrate').val('Rate for ' + sanitizeNumber(dAnalQty,3) + ' ' + sUnit);
        $('#rateanalR_' + iFocusRowId + 'lperrate').val('Rate per ' + sUnit);
        var dNetRate = dTAmt / dAnalQty;
        $('#rateanalR_' + iFocusRowId + '_perrate').val(sanitizeNumber(dNetRate,2,true));
        $('#rateanalR_' + iFocusRowId + '_netrate').val(sanitizeNumber(dNetRate,2,true));
    }
    $('#formula').hide();
}
function showAnalmix(sVal,y,e) {
    e.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="manual") {
        $('#activitymachinery').hide();
        $('#activityRrestable').hide();
        $('#activitymanual').show();
        $('#activityrestable').show();
    } else {
        $('#activitymanual').hide()
        $('#activityrestable').hide();
        $('#activitymachinery').show();
        $('#activityRrestable').show();
    }
    return false;
}
function showSubIOWMix(sVal,y,event) {
    event.preventDefault();
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    if (sVal=="sitemix") {
        $('#sraworkRtable').hide();
        $('#srateanalRrestable').hide();
        $('#sraworktable').show();
        $('#srateanalrestable').show();
    } else {
        $('#sraworktable').hide();
        $('#srateanalrestable').hide();
        $('#sraworkRtable').show();
        $('#srateanalRrestable').show();
    }
    return false;
}
function showmix(x,y,event) {
    $('#' + y).parent('li').addClass('active').siblings('li').removeClass('active');
    iFocusRowId = y.split('_')[1];
    event.preventDefault();
    if (x=="readymix") {
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).hide();
        $('#rabuttable_'+iFocusRowId).hide();
        $('#rateanal_'+ iFocusRowId + '_restable').hide();
        $('#raworkRtable_'+iFocusRowId).show();
        $('#rabutRtable_'+iFocusRowId).show();
        $('#rateanalR_'+ iFocusRowId + '_restable').show();
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRR_'+iFocusRowId).prop("checked", true);
        bSiteMix=false;
    } else {
        $('#raworkRtable_'+iFocusRowId).hide();
        $('#rabutRtable_'+iFocusRowId).hide();
        $('#rateanalR_'+ iFocusRowId + '_restable').hide();
        $('#ramixtable_'+iFocusRowId).show();
        $('#raworktable_'+iFocusRowId).show();
        $('#rabuttable_'+iFocusRowId).show();
        $('#rateanal_'+ iFocusRowId + '_restable').show();
        $('#analtypeSR_'+iFocusRowId).prop("checked", false);
        $('#analtypeRS_'+iFocusRowId).prop("checked", false);
        $('#analtypeSS_'+iFocusRowId).prop("checked", true);
        bSiteMix=true;
    }
}
function AddNewWorkGroup(x) {
    sWGUpdateMode='Add';
    var irow = x.id.split('_')[1];
    $('#wgrowid').val(0);
    $("#workgroupok").html('Create');
    $("#workgroupmodal").modal('show');
    $('#refNewWGRowName').val(x.id);
    $('.autocomplete-suggestions').hide();

    $('#workgroup').val($(x).val());
    $('#lworkgroup').val($('#lworkgroupname_'+ irow).val());
    $('#lworkgroup_id').val($('#workgroupid_'+ irow).val());
    $('#lworktype').val($('#worktypename_'+ irow).val());
    $('#lworktypeid').val($('#worktypeid_'+ irow).val());
}
function ShowWorkGroup(id) {

    var irow = id.split('_')[1];
    $("#workgroupok").html('Save');
    sWGUpdateMode='Edit';
    $('#wgrowid').val(irow);
    $('#workgroupslno').val($('#newwgslno_'+ irow).val());
    $('#workgroup').val($('#newwgname_'+ irow).val());
    $('#lworkgroup').val($('#newlwgname_'+ irow).val());
    $('#lworkgroup_id').val($('#newlwgid_'+ irow).val());
    $('#lworktype').val($('#newwgtype_'+ irow).val());
    $('#lworktypeid').val($('#newwgtypeid_'+ irow).val());
    $("#workgroupmodal").modal('show');
}
function ShowResource(id) {
    var irow = id.split('_')[1];
    $("#newresok").html('Save');
    sResUpdateMode='Edit';
    $('#resrowid').val(irow);
    $('#resname').val($('#newresname_'+ irow).val());
    $('#rescode').val($('#newrescode_'+ irow).val());
    $('#resgroup').val($('#newresgroup_'+ irow).val());
    $('#resgroupid').val($('#newresgroupid_'+ irow).val());
    $('#restype').val($('#newrestype_'+ irow).val());
    $('#restypeid').val($('#newrestypeid_'+ irow).val());
    $('#resunit').val($('#newresunit_'+ irow).val());
    $('#resunitid').val($('#newresunitid_'+ irow).val());
    $('#wresunit').val($('#newwresunit_'+ irow).val());
    $('#wresunitid').val($('#newwresunitid_'+ irow).val());
    $('#resrate').val($('#newresrate_'+ irow).val());
    $('#wresrate').val($('#newwresrate_'+ irow).val());
    $('#resmattype').val($('#newresmattype_'+ irow).val());
    $('#reslead').val($('#newreslead_'+ irow).val());

    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 2) $('#divmattype').show();
    if (parseInt(isNullCheck($('#newrestypeid_'+ irow).val(),'number'))== 3) { $('#divworkunit').show();$('divworkrate').show();}
    $("#resourcemodal").modal('show');
}
function AddNewResource(x) {
    sResUpdateMode='Add';
    $("#newresok").html('Create');
    $('#divworkunit').hide();
    $('#divworkrate').hide();
    $('#divmattype').hide();
    $("#resourcemodal").modal('show');
    $('#resrowid').val(0);
    $('#refNewResRowName').val(x.id);
    $('.autocomplete-suggestions').hide();
    $('#resname').val($(x).val());
    $('#' + x.id).prop('readonly', false);
}
function workgroupClose() {
    if (sWGUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewWGRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#workgroupmodal').modal('toggle');
}
function WorkGroupUpdate() {
    var isValid =true;

//    checkwgslno();
    $('#workgroupslno').removeClass('error');
    if ($('#workgroupslno').hasClass('error')) isValid = false;
    if ($('#workgroupslno').val().length==0) {
        showError($('#workgroupslno'), 'Required');
        isValid = false;
    }

//    checkWorkGroupName();
    if ($('#workgroup').hasClass('error')) isValid=false;
    if ($('#workgroup').val().length==0) isValid = false;
    if ($('#lworkgroup').hasClass('error')) isValid=false;
    if ($('#lworktype').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#lworktypeid').val(),'number') ==0) isValid=false;

    if (isValid==false) return;
    var irow = 0;
    if (sWGUpdateMode=='Add') {
//        var irows = $('#newwg tr').length;
        var irows =  parseInt(isNullCheck($('#newwgowid').val(),'number'));
        irow = +irows+1;
        if ($('#newwgname_'+irow).val() !="") {
            var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newwgowid').val(irow);
    } else irow = $('#wgrowid').val();

    $('#newwgslno_'+ irow).val($('#workgroupslno').val());
    $('#newwgname_'+ irow).val($('#workgroup').val());
    $('#newlwgname_'+ irow).val($('#lworkgroup').val());
    $('#newlwgid_'+ irow).val($('#lworkgroup_id').val());
    $('#newwgtype_'+ irow).val($('#lworktype').val());
    $('#newwgtypeid_'+ irow).val($('#lworktypeid').val());

    $('#newitems').show();
    $('#butnewitems').html("New Work Group Created : <i class='fa fa-long-arrow-right'></i> <span class='badge'> " + irow + "</span>").show();

    if (sWGUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWGName = isNullCheck($('#workgroup').val(),'string');
        var iworktypeid = $('#lworktypeid').val();
        var ilworkgroupid = $('#lworkgroup_id').val();
        var sWSpec = 'New.' + irow + '   ' + sWGName;

        arryparentList.push({
            data: sWid,
            value: sWSpec,
            worktypeid: iworktypeid,
            workgroupid: ilworkgroupid,
            pworkgroupid: 0,
            iowid: 0,
            workgroupname: sWGName,
            parentname: ''
        });

        var $newResRow = $('#' + $('#refNewWGRowName').val()),
            key = $newResRow[0].id.split('_');
        // $('#workgroupid_'+ key[1]).val(sWid);
        $('#pworkgroupname_'+ key[1]).val(sWGName);
        $('#worktypeid_'+ key[1]).val($('#lworktypeid').val());
        $('#worktypename'+ key[1]).val($('#lworktype').val());
        $("#workgroupid_"+ key[1]).val(ilworkgroupid);
        $("#pworkgroupid_"+ key[1]).val(0);
        $("#piowid_"+ key[1]).val(0);
        $("#newparentname_"+ key[1]).val('');

        $newResRow.val('');
        $newResRow.removeClass('error');
        $newResRow.val(sWSpec);
//        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
    }
    $('#workgroupmodal').modal('toggle');
}

function SpecChange(id) {
    $('#'+id).removeClass('error');
    CheckSpecification(id);
    if ($('#'+id).hasClass('error')) return;


    var iRowId = $('#rowid').val(),
        key =   id.split('_')[1];

//    if ($('#parentid_' + key).val().length == 0) return;
    if ($('#refserialno_' + key).val().length == 0) return;
    if ($('#spec_' + key).val().length == 0) return;

    if (parseInt(isNullCheck($('#unitkeyid_' + key).val(),'number')) == 0) {
        if ($('#raheader_'+ key).is(':checked')) {
            var sSlNo="";
//            var sSlNo = isNullCheck($('#refserialno_' + key).val(), 'string');
            var sSpec = isNullCheck($('#spec_' + key).val(), 'string');

            var sWid = "0." + sSlNo;
            var sWSpec = 'New.' + sSlNo + '   ' + sSpec;
            var iworktypeid = isNullCheck($('#worktypeid_' + key).val(), 'number');
            var ilworkgroupid = isNullCheck($('#workgroupid_' + key).val(), 'number');
            var iworkgroupid = isNullCheck($('#pworkgroupid_' + key).val(), 'number');
            var sworkgroupname = isNullCheck($('#pworkgroupname_' + key).val(), 'string');
            var ipiowid = isNullCheck($('#piowid_' + key).val(), 'number');
            var sparentname = sSpec;

            var bFound=false;
            for(var i=0;i<arryparentList.length;i++){
                if (arryparentList[i]['data'] == sWid) {
                    arryparentList[i]['value'] = sWSpec;
                    arryparentList[i]['worktypeid'] = iworktypeid;
                    arryparentList[i]['workgroupid'] = ilworkgroupid;
                    arryparentList[i]['pworkgroupid'] = iworkgroupid;
                    arryparentList[i]['iowid'] = ipiowid;
                    arryparentList[i]['workgroupname'] = sworkgroupname;
                    arryparentList[i]['parentname'] = sparentname;
                    bFound=true;
                    return;
                }
            }

            if (bFound==false) {
                arryparentList.push({
                    data: sWid,
                    value: sWSpec,
                    worktypeid: iworktypeid,
                    workgroupid: ilworkgroupid,
                    pworkgroupid: iworkgroupid,
                    iowid: ipiowid,
                    workgroupname: sworkgroupname,
                    parentname: sparentname
                });
            }
        }
    }
    if($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;
    AddNewRowA(id);

//    $('#'+id).removeClass('error');
//    CheckSpecification(id);
//    if ($('#'+id).hasClass('error')) return;
//
//    var iRowId = $('#rowid').val(),
//        key =   id.split('_')[1];
//    if($('#IOWiRowId_' + key).nextAll('tr[id^=IOWiRowId_]').length == 1) return;
//    if (parseInt(isNullCheck($('#workgroupid_' + iRowId).val(),'number'))== 0) return;
//    if ($('#refserialno_' + iRowId).val().length == 0) return;
//    if ($('#spec_' + iRowId).val().length == 0) return;
//    if (parseInt(isNullCheck($('#unitkeyid_' + iRowId).val(),'number')) == 0) {
//        if ($('#raheader_'+ iRowId).is(':checked')) {
//            var sSlNo = isNullCheck($('#refserialno_' + iRowId).val(), 'string');
//            var sSpec = isNullCheck($('#spec_' + iRowId).val(), 'string');
//            ParentIOWUpdate(sSlNo, sSpec);
//        }
//    }
//    AddNewRowA(id);
}

//function ParentIOWUpdate(slno,spec) {
//    var sWid = "0." + slno;
//    var sWSpec = 'New.' + slno + '   ' + spec;
//
//    arryparentList.push({
//        data: sWid,
//        value: sWSpec
//    });
//    //console.log(arryparentList);
//}

function RateResourceUpdate(resName,unit,rate,resId,qty,resTyeId) {
//    $("#resourcerate > tbody > tr.nodata").remove();
    var bFound=false;
    var ifrow = 0;
    var $resid = $('input[id^=rateresid_]');
    $.each($resid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if ($('#'+name).val() == resId) {
            ifrow = name.split('_')[1];
            bFound =true;
            return;
        }
    });

    if (bFound==false) {
        var irow = ($('#resourcerate tr').length - 2);

//    if ((irow !=1) || ( irow==1 && $('#rateresname_1').val() != "") ) {
        irow++;
        $("#resourcerate > tbody.resdata").append($("#template-resource-summary").html().replace(/__/g, '_' + irow));
//    }
        $('#rateresname_' + irow).val(resName);
        $('#rateresunit_' + irow).val(unit);
        $('#rateresqty_' + irow).val(sanitizeNumber(qty, 3));
        $('#rateresrate_' + irow).val(sanitizeNumber(rate, 2));
        $('#rateresamt_' + irow).val(sanitizeNumber((rate * qty), 2,true));
        $('#rateresoldrate_' + irow).val(rate);
        $('#rateresid_' + irow).val(resId);
        $('#ratetypeid_' + irow).val(resTyeId);
        $('#resrows').val(irow);
        $('#btn-resourcerate').show();
    } else  {

        var dQty  = parseFloatVal(isNullCheck($('#rateresqty_' + ifrow).val(),'number'));
        dQty = dQty + qty;
        $('#rateresqty_' + ifrow).val(sanitizeNumber(dQty, 3));
        $('#rateresamt_' + ifrow).val(sanitizeNumber((rate * dQty), 2,true));
    }
    calcResTotal();
}
function raterescalc(x) {
    var $x = $(x),
        id = $x[0].id.split('_')[1];
    var rate = parseFloatVal($x.val()),
        qty = parseFloatVal($('#rateresqty_'+id).val());
    $('#rateresamt_'+id).val(sanitizeNumber(rate * qty,2));
    calcResTotal();
}


function calcResTotal() {
    var dTAmt = 0,dAmt=0;
    var $codes = $('input[id^=rateresamt_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        dAmt = parseFloatVal(isNullCheck($('#'+name).val(),'number'));
        dTAmt = dTAmt+dAmt;
    });
    $('#restotalamt').val(sanitizeNumber(dTAmt,2,true));
}

function calcResQty() {
    var $codes = $('input[id^=rateresid_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var resids = name.split('_');
        var iresid = $('#'+name).val();
        var dQty = 0,dAmt =0;
        dRate = parseFloatVal(isNullCheck($('#rateresrate_' + resids[1]).val(),'number'));
        dQty = getResQty(iresid);
        dAmt = dQty*dRate;
        $('#rateresqty_' + resids[1]).val(sanitizeNumber(dQty,3));
        $('#rateresamt_' + resids[1]).val(sanitizeNumber(dAmt,2,true));
    });
    calcResTotal();
}
function getResQty(resId) {
    var dTQty = 0;
    if(resId == '') return;
    $.each($('input[id*=_reskeyid_][value="'+resId+'"]'), function(i,o) {
        var $rateResId = $('input[id^=rateresid_][value="'+resId+'"]');
        if($rateResId.length == 0)
            return;

        var resids = $(this)[0].id.split('_');
        var name = resids[0] + '_';

        var dqty = 0,
            resqty =  parseFloatVal( isNullCheck($('#' + name + resids[1]+'_resqty_'+resids[3]).val(),'number')),
            wasteqty =  parseFloatVal( isNullCheck($('#' + name + resids[1]+'_WastageQty_'+resids[3]).val(),'number')),

            analqty =  parseFloatVal(isNullCheck($('#' + name + resids[1]+'_AnalQty').val(),'number')),
            boqqty = parseFloatVal(isNullCheck($('#qty_' + resids[1]).val(),'number'));

        if (analqty !=0) dqty = ((resqty+wasteqty)/analqty)*boqqty;
        dTQty = dTQty + dqty;
    });
    return dTQty;
}



function calcResourceQtys(resId) {
    if(resId == '') return;

    $.each($('input[id*=_reskeyid_][value="'+resId+'"]'), function(i,o) {
        var $rateResId = $('input[id^=rateresid_][value="'+resId+'"]');
        if($rateResId.length == 0)
            return;


        var resids = $(this)[0].id.split('_');

        var qty = parseFloatVal($('#rateanal_'+resids[1]+'_resqty_'+resids[3]).val())
            / parseFloatVal($('#rateanal_'+resids[1]+'_AnalQty').val());
        var rowid = $rateResId[0].id.split('_')[1];
        $('#rateresqty_'+rowid).val(sanitizeNumber(qty,2));
        $('#rateresrate_'+rowid).trigger('change');
    });
}
function ResourceClose() {
    if (sResUpdateMode=='Add') {
        var $newResRow = $('#' + $('#refNewResRowName').val());
        $newResRow.val("");
        $newResRow.trigger('focus');
    }
    $('#resourcemodal').modal('toggle');
}

function ResourceUpdate() {
    var isValid =true;
    var icodegenType = parseInt(isNullCheck($('#codegenType').val(),'number'));
    if (icodegenType==0) {
        CheckResCode();
        if ($('#rescode').val().length == 0){
            showError($('#rescode'), 'Required');
            isValid = false;
        }
        if ($('#rescode').hasClass('error')) isValid = false;
    }
    CheckResName();
    if ($('#resname').hasClass('error')) isValid=false;
    if ($('#resgroup').hasClass('error')) isValid=false;
    else if ($('#resunit').hasClass('error')) isValid=false;
    else if (isNullCheck( $('#resgroupid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#restypeid').val(),'number') ==0) isValid=false;
    else if (isNullCheck( $('#resunitid').val(),'number') ==0) isValid=false;
    if (isValid==false) return;
    var restypeid= parseInt(isNullCheck($('#restypeid').val(),'number'));
    if (restypeid==3) {
        if (isNullCheck( $('#wresunitid').val(),'number') ==0) isValid=false;
    }
    var resname = $('#resname').val(),
        resgroupid = isNullCheck($('#resgroupid').val(),'number'),
        resgroup = isNullCheck($('#resgroup').val(),'string'),
        resunit = isNullCheck($('#resunit').val(),'string'),
        resunitid = isNullCheck($('#resunitid').val(),'number'),
        wresunit = isNullCheck($('#wresunit').val(),'string'),
        wresunitid = isNullCheck($('#wresunitid').val(),'number'),
        restype = isNullCheck($('#restype').val(),'string'),
        resrate = isNullCheck($('#resrate').val(),'number'),
        wresrate = isNullCheck($('#wresrate').val(),'number'),
        reslead = isNullCheck($('#reslead').val(),'number'),
        resmattype = isNullCheck($('#resmattype').val(),'string'),
        rescode = isNullCheck($('#rescode').val(),'string');
    var irow = 0;
    if (sResUpdateMode=='Add') {
        var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
        irow = +irows+1;
        if ($('#newresname_'+irow).val() !="") {
            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
        }
        $('#newresrowid').val(irow);

//        var irows = $('#newres tr').length;
//        irow = irows-1;
//        if ((irow !=1) || ( irow==1 && $('#newresname_1').val() !="")) {
//            irow = +irow+1;
//            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
//            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
//        }
//        $('#resrowid').val(irow);
    } else irow = $('#resrowid').val();
    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();

    if (sResUpdateMode=='Add') {
        var sWid = "0." + irow;
        var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;

        var sUnit =resunit,iUnitId=resunitid;
        if (restypeid==3) {
            sUnit =wresunit;
            iUnitId=wresunitid;
            resrate=wresrate;
        }

        arrayreslist.push({
            id: sWid,
            value: sWSpec,
            UnitName: sUnit,
            UnitId: iUnitId,
            Rate: resrate,
            data: {category:'Resource'}
        });

        var $newResRow = $('#' + $('#refNewResRowName').val()),
            key = $newResRow[0].id.split('_');
        if (bSiteMix==false) {
            var ssname = 'rateanalR_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#rateanalR_' + key[1] + '_reskeyid_' + key[3]).val(sWid);
            $("#rateanalR_" + key[1] + "_type_" + key[3]).val('R');
            $("#rateanalR_" + key[1] + "_resrate_" + key[3]).val(sanitizeNumber(resrate,2,true));
            $('#rateanalR_' + key[1] + '_newresname_' + key[3]).val(resname);
            $('#rateanalR_' + key[1] + '_restypeid_' + key[3]).val(restypeid);
            if (restypeid !=2) {
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).prop('readonly', true);
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).hide();
                $('#rateanalR_' + key[1] + '_lblWastage_' + key[3]).hide();
            } else {
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).prop('readonly', false);
                $('#rateanalR_' + key[1] + '_Wastage_' + key[3]).show();
                $('#rateanalR_' + key[1] + '_lblWastage_' + key[3]).show();
            }

            if (restypeid !=4) {
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).prop('readonly', true);
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).hide();
                $('#rateanalR_' + key[1] + '_lblWeightage_' + key[3]).hide();
            } else {
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).prop('readonly', false);
                $('#rateanalR_' + key[1] + '_Weightage_' + key[3]).show();
                $('#rateanalR_' + key[1] + '_lblWeightage_' + key[3]).show();
            }
//            cboResChanged(suggestion.id, key1, key2, "R");
        } else {
            var ssname = 'rateanal_' + key[1] + '_resunit_' + key[3];
            $("label[for=" + ssname + "]").html(sUnit);
            $('#rateanal_' + key[1] + '_reskeyid_' + key[3]).val(sWid);
            $("#rateanal_" + key[1] + "_type_" + key[3]).val('R');
            $("#rateanal_" + key[1] + "_resrate_" + key[3]).val(sanitizeNumber(resrate,2,true));
            $('#rateanal_' + key[1] + '_newresname_' + key[3]).val(resname);
            $('#rateanal_' + key[1] + '_restypeid_' + key[3]).val(restypeid);
            if (restypeid !=2) {
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).prop('readonly', true);
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).hide();
                $('#rateanal_' + key[1] + '_lblWastage_' + key[3]).hide();
            } else {
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).prop('readonly', false);
                $('#rateanal_' + key[1] + '_Wastage_' + key[3]).show();
                $('#rateanal_' + key[1] + '_lblWastage_' + key[3]).show();
            }
            if (restypeid !=4) {
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).prop('readonly', true);
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).hide();
                $('#rateanal_' + key[1] + '_lblWeightage_' + key[3]).hide();
            } else {
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).prop('readonly', false);
                $('#rateanal_' + key[1] + '_Weightage_' + key[3]).show();
                $('#rateanal_' + key[1] + '_lblWeightage_' + key[3]).show();
            }
//            cboResChanged(suggestion.id, key1, key2);
        }
        $newResRow.removeClass('error');
        bindResRowAutoComplete($newResRow);
        bindResourceChange();
        bindPopOver();
        $newResRow.val(sWSpec);
        $newResRow.prop('readonly', true);
        $newResRow.trigger('focus');
        if (bSiteMix==false) AddNewRowResR(key[1],key[3]);
        else AddNewRowRes(key[1],key[3]);
    }  else {
        var sresId =   "0." + irow;
        UpdateResourceRate(sresId,resrate);
    }
    $('#resourcemodal').modal('toggle');

//    var resname = $('#resname').val(),
//        resgroupid = $('#resgroupid').val(),
//        resgroup = $('#resgroup').val(),
//        resunit = $('#resunit').val(),
//        resunitid = $('#resunitid').val(),
//        restype = $('#restype').val(),
//        restypeid= $('#restypeid').val(),
//        resrate = $('#resrate').val();
//    var irow = 0;
//    if (sResUpdateMode=='Add') {
//        var irows = $('#newres tr').length;
//        irow = irows-1;
//        if ((irow !=1) || ( irow==1 && $('#newresname_1').val() !="")) {
//            irow = +irow+1;
//            var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
//            $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
//        }
//        $('#resrowid').val(irow);
//    } else irow = $('#resrowid').val();
//    $('#newresname_'+ irow).val(resname);
//    $('#newresgroup_'+ irow).val(resgroup);
//    $('#newresgroupid_'+ irow).val(resgroupid);
//    $('#newrestype_'+ irow).val(restype);
//    $('#newrestypeid_'+ irow).val(restypeid);
//    $('#newresunit_'+ irow).val(resunit);
//    $('#newresunitid_'+ irow).val(resunitid);
//    $('#newresrate_'+ irow).val(resrate);
//    $('#newresitems').show();
//    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();
//    var sWid = "0." + irow;
//    var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;
//    arrayreslist.push({
//        data: sWid,
//        value: sWSpec,
//        UnitName: resunit,
//        UnitId: resunitid,
//        Rate: resrate
//    });
//    var $newResRow = $('#' + $('#refNewResRowName').val()),
//        key = $newResRow[0].id.split('_');
//    if (sResUpdateMode=='Add') {
//        if (bSiteMix==true) $resname = $('#rateanal_' + key[1] + '_resid_' + key[3]);
//        else $resname = $('#rateanal_' + key[1] + '_resid_' + key[3]);
//        $resname.val('');
//        $resname.removeClass('error');
//        bindResRowAutoComplete($resname);
//    }
//    $newResRow.val(sWSpec);
//    $newResRow.trigger('focus');
}
function CheckResCode() {

    var iARowid  = $('#resrowid').val(),
        $resCode = $('#rescode'),
        resCode =  $resCode.val().trim();

    removeError($resCode);
    if (resCode.length ==0)
        return;

    var rfcId = isNullCheck($('#quotationId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkrescodefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'rescode':resCode,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resCode, 'Already used');
                return;
            }
        }
    });

    if ($resCode.hasClass('error')) return;
    removeError($resCode);
    var $codes = $('input[id^=newrescode_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resCode.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resCode, 'Already used');
                    return;
                }
            }
        }
    });
}

function CheckResName() {
    var iARowid  = $('#resrowid').val(),
        $resName = $('#resname'),
        resName =  $resName.val().trim();

    removeError($resName);
    if (resName.length ==0)
        return;

    var rfcId = isNullCheck($('#quotationId').val(), 'number'),
        editid = 0;

    $.ajax({
        url: getBaseURL() + "project/rfc/checkresnamefound",
        async: false,
        type: 'post',
        data: {'resid': editid, 'resname':resName,'rfcid':rfcId},
        success: function(data,status) {
            if (data == "Y") {
                showError($resName, 'Already used');
                return;
            }
        }
    });

    if ($resName.hasClass('error')) return;
    removeError($resName);
    var $codes = $('input[id^=newresname_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = isNullCheck(name.split('_')[1],'number');
        if (ikey !=0) {
            if (ikey != iARowid ) {
                if (resName.toLowerCase() == $('#'+name).val().trim().toLowerCase()) {
                    showError($resName, 'Already used');
                    return;
                }
            }
        }
    });
}
function CheckResourceFocus(x,restype) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkResource(key1,restype);
    var $resname = $('#' + x);
    bindResRowAutoComplete($resname);
}
function checkResource(key1,restype) {
    iFocusRowId = key1;
    var $reskeyid ="";
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanalR_' + iFocusRowId + '_iowkeyid_]');
        arrayresR = arrayreslist;
        arrayresR = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(iowkeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + iFocusRowId + '_reskeyid_]');
        var iowkeyid = $('input[id*=rateanal_' + iFocusRowId + '_iowkeyid_]');
        arrayres = arrayreslist;
        arrayres = $.grep(arrayreslist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'Resource') is_selected = false;
            });
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.id == $this.val() && element.data.category == 'IOW') is_selected = false;
            });
            return is_selected;
        });
    }
}
function checkIOWUsed(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoid_'+ iFocusRowId).val();
    for (i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanal_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanal_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanal_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
function checkIOWUsedR(x) {
    var sStr = x.split("_");
    var iARowid = sStr[3];
    var iRows = $('#rowinfoidR_'+ iFocusRowId).val();
    for (i = 1; i <= iRows; i++) {
        if (i != iARowid) {
            if ($('#rateanalR_' + iFocusRowId + '_type_' + i).val() == 'I') {
                var iResId = $('#rateanalR_' + iFocusRowId + '_resid_' + i).val();
                $("#rateanalR_" + iFocusRowId + "_resid_" + iARowid + " option[value='" + iResId + "']").remove();
            }
        }
    }
}
function entryValidate() {
    var isValid = true,
        validRows = 0,
        $trIOW = $('tr[id*=IOWiRowId_]');
    $.each($trIOW, function (i, obj) {
        var $this = $(this),
            name = $this[0].id,
            key = name.split('_')[1];
        if (name.indexOf('__') != -1) return;
//        if ($('#parentid_' + key).val().length==0 && $('#serialno_' + key).val().length==0 && $('#spec_' + key).val().length==0 && $('#unitid_' + key).val().length==0) return;
        if ($('#refserialno_' + key).val().length==0 && $('#spec_' + key).val().length==0 && $('#unitid_' + key).val().length==0) return;

        if ($('#parentid_' + key).hasClass('error')) isValid = false;
        if ($('#spec_' + key).hasClass('error')) isValid = false;
        if ($('#unitid_' + key).hasClass('error')) isValid = false;
        if ($('#refserialno_' + key).hasClass('error')) isValid = false;

//        if ($('#parentid_' + key).val().length==0) {
//            isValid=false;
//            alert("Parent Not Selected");
//            $('#parentid_' + key).focus();
//            return;
        if ($('#refserialno_' + key).val().length==0) {
            isValid = false;
            showError($('#refserialno_' + key, 'Required'));
            $('#refserialno_' + key).focus();
            return;
        } else if ($('#spec_' + key).val().length==0) {
            alert('spec');
            alert(key);

            isValid = false;
            showError($('#spec_' + key, 'Required'));
            $('#spec_' + key).focus();
            return;
        }
//        else if ($('#unitkeyid_' + key).val().length==0) {
//            alert('UNIT');
//            alert(key);
//            alert($('#unitkeyid_' + key).val());
//            isValid = false;
//            showError($('#unitid_' + key, 'Required'));
//            $('#unitid_' + key).focus();
//            return;
//        }
        if ($('#raheader_'+ key).is(':checked')==false) {
            if ($('#unitkeyid_' + key).val().length==0) {
                isValid = false;
                showError($('#unitid_' + key), 'Required');
                $('#unitid_' + key).focus();
                return;
            }
        }
        var wbsids = $('input[id*=wbstable_' + key + '_wbsname_]');
        $.each(wbsids, function (i, obj) {
            var $this = $(this),
                sname = $this[0].id;
            var arrname = sname.split('_');
            var key1 = arrname[1],
                key2 = arrname[3];

            if (isNullCheck($this.val(),'string') != "") {
                if (isNullCheck($('#wbstable_' + key1 + '_wbsid_' + key2).val(),'number')==0) {
                    isValid = false;
                    showError($this, 'Required');
                    $this.focus();
                    return;
                }
            }
        });

        validRows++;
    });
    if (validRows == 0) {
        alert('No Item of Work found!');
        return false;
    }
    return isValid;
}

function MainRateUpdate(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iResId = $('#' + name + iFRowId + '_reskeyid_' + iTRowId).val();
    var rateInputs = $(x).parents('li').siblings('li').find('input[type=text]');
    var dRate = 0;
    if($('#' + x.id).val() == "M") { dRate = parseFloat(isNullCheck($(rateInputs[1]).val(),'number')); }
    else if($('#' + x.id).val() == "A") { dRate = parseFloat(isNullCheck($(rateInputs[2]).val(),'number')); }
    else { dRate = parseFloat(isNullCheck($(rateInputs[0]).val(),'number')); }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function MainRateUpdateIOW(x) {
    var sStr = $('#' + $(x).parents('tr')[0].id).prev('tr')[0].id.split("_"),
        iFRowId = sStr[1],
        iTRowId = sStr[3],
        name = sStr[0] + "_";
    $('#' + name + iFRowId + '_ratetype_' + iTRowId).val($('#' + x.id).val());
    var iiowId = $('#' + name + iFRowId + '_iowkeyid_' + iTRowId).val();
    var objAS = $.grep(arrSubIOW, function (element, index) {
        return element.subiowid == iiowId;
    });
    var dRate = 0;
    if (objAS.length >0) {
        if ($('#' + x.id).val() == "R") dRate = parseFloat(isNullCheck(objAS[0]["rrate"],'number'));
        else dRate = parseFloat(isNullCheck(objAS[0]["srate"],'number'));
    }
    $('#' + name + iFRowId + '_resrate_' + iTRowId).val(sanitizeNumber(dRate,2,true));
    ValueChange(name+ iFRowId + '_resrate_' + iTRowId);
}
function isFormula(evt){
    //var charCode = (evt.which) ? evt.which : evt.keyCode
    //alert(charCode);
    //if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=43 && charCode!=45 && charCode!=47 && charCode!=42 && charCode!=46 && charCode!=65 && charCode!=66 && charCode!=67 && charCode!=40 && charCode!=41 && charCode!=82) return false;
    return true;
}

function bindLibraryIOW(ival,x) {
    $('#'+x).unbind('autocomplete');
    var key1 =  x.split('_')[1];
    $.ajax({
        url: getBaseURL() + "project/rfc/getlibraryiow",
        async: false,
        type: 'post',
        data: {resId: ival},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];

            $('#' + x).autocomplete({
                lookup: objT,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    }
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function (suggestion) {
                    if (suggestion) {
                        $("#libiowkeyid_" + key1).val(suggestion.data);
                        GetIOWDetails(suggestion.data, "libiowkeyid_" + key1)
                        AddNewRowA("#libiowkeyid_" + key1, true);
                        $(this).removeClass('error');
                    }
                },
                onSearchStart: function (suggestion) {
                    $("#libiowkeyid_" + key1).val(0);
                },
                onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length && query.length > 1) {
                        $(this).addClass('error');
                        $("#libiowkeyid_" + key1).val(0);
                    } else
                        $(this).removeClass('error');
                }
            });
        }

    });
    checkRAUsed();
}

function GetWorkTypeDetails(ival,x) {
//    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0)
//    {
    $.ajax({
        url: getBaseURL() + "project/rfc/getworktypedetails",
        async: false,
        type: 'post',
        data:{resId:ival},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];
            var objA = obj['anal'];

            var sStr = x.split("_");

            var iARowid = sStr[1];


            if (objT['ConcreteMix'] == 1) {
                $('#mixtab_' + iARowid).show();
                $('#lisitemix_' + iARowid).show();
                $('#lireadymix_' + iARowid).show();
            }
            else {
                $('#mixtab_' + iARowid).hide();
                $('#rateanalR_' + iARowid + '_AnalQty').hide();
                $('#lisitemix_' + iARowid).hide();
                $('#lireadymix_' + iARowid).hide();
            }

            if (objT['Cement'] == 1) {
                $('#rateanal_' + iARowid + 'AQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'AQty_li').hide();
            }

            if (objT['Sand'] == 1) {
                $('#rateanal_' + iARowid + 'BQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'BQty_li').hide();
            }

            if (objT['Metal'] == 1) {
                $('#rateanal_' + iARowid + 'CQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'CQty_li').hide();
            }

            if (objT['Thickness'] == 1) {
                $('#rateanal_' + iARowid + 'thick_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'thick_li').hide();
            }
        }
    });
//    }
}
function refreshFromWorkGroup(id) {
    var key = id.split('_')[1];
    var aSNo = $('#parentkeyid_' + key).val().split('.');
    if (aSNo.length > 0) GetWorkGroupDetails(key,true);
//    SortOrderBOQ();
    checkRAUsed();
}
function checkRAUsed() {
    var $reskeyid = $('input[id*=rowinfoid_]');
    $.each($reskeyid, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var iRow = parseInt(isNullCheck($('#'+name).val(),'number'));
        var key = name.split('_')[1];
        $('#copyformat_' + key).show();
        if (iRow > 1) {
            $('#copyformat_' + key).hide();
        } else {
            var sType = isNullCheck($('#rateanal_' + key + '_type_1').val(),'string');
            if (sType =='H') $('#copyformat_' + key).hide();
            else {
                var sResName = isNullCheck($('#rateanal_' + key + '__resid__1').val(),'string');
                if (sResName.length > 0) $('#copyformat_' + key).hide();
            }
        }
    });
}
function GetWorkGroupDetails(key,refresh) {
    var iARowid = key,
        iWorkgroupid = parseInt(isNullCheck($('#workgroupid_' + key).val(),'number')),
        iWorktypeid = parseInt(isNullCheck($('#worktypeid_' + key).val(),'number'));

    var sUrl="",iresid=0;
    if (iWorkgroupid !=0) {
        iresId =iWorkgroupid;
        sUrl=getBaseURL() + "project/rfc/getworkgroupdetails";
    } else {
        iresId =iWorktypeid;
        sUrl=getBaseURL() + "project/rfc/getworktypenewdetails";
        refresh=true;
    }

//    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0) {
    $.ajax({
        url: sUrl,
        async: false,
        type: 'post',
        data:{resId:iresId},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT =obj['trans'];
            var objA=obj['anal'];

            if (objT['ConcreteMix'] == 1) {
                $('#concrete_' + iARowid).prop("checked", true);
                $('#mixtab_' + iARowid).show();
            } else {
                $('#concrete_' + iARowid).hide();
                $('#mixtab_' + iARowid).hide();
            }

            $('#rateanalR_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['RWorkingQty'],3));
            $('#rateanal_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['WorkingQty'],3));
            $('#rateanal_' + iARowid + '_AQty').val(sanitizeNumber(objT['CementRatio'],3));
            $('#rateanal_' + iARowid + '_BQty').val(sanitizeNumber(objT['SandRatio'],3));
            $('#rateanal_' + iARowid + '_CQty').val(sanitizeNumber(objT['MetalRatio'],3));
            $('#rateanal_' + iARowid + '_thick').val(sanitizeNumber(objT['ThickQty'],3));
            $('#worktypeid_' +iARowid).val(objT['WorkTypeId'])

            if (objT['Cement'] == 1) { $('#rateanal_' + iARowid + 'AQty_li').show(); }
            else {$('#rateanal_' + iARowid + 'AQty_li').hide();}
            if (objT['Sand'] == 1) $('#rateanal_' + iARowid + 'BQty_li').show();
            else $('#rateanal_' + iARowid + 'BQty_li').hide();
            if (objT['Metal'] == 1)  $('#rateanal_' + iARowid + 'CQty_li').show();
            else  $('#rateanal_' + iARowid + 'CQty_li').hide();
            if (objT['Thickness'] == 1)  $('#rateanal_' + iARowid + 'thick_li').show();
            else $('#rateanal_' + iARowid + 'thick_li').hide();

//            } else {
//                $('#concrete_' + iARowid).hide();
//                $('#mixtab_' + iARowid).hide();
//                $('#rateanalR_' + iARowid + '_AnalQty').hide();
//                $('#rateanal_' + iARowid + 'AQty_li').hide();
//                $('#rateanal_' + iARowid + 'BQty_li').hide();
//                $('#rateanal_' + iARowid + 'CQty_li').hide();
//                $('#rateanal_' + iARowid + 'thick_li').hide();
//            }

            if (objT['AutoRateAnalysis'] == 1 || refresh==true) {

                var objAS = $.grep(objA, function (element, index) {
                    return element.Type != 'R';
                });
                var k = 0;
                for (var j = 0; j < objAS.length; j++) {
                    k = k + 1;
                    var sRow = '#rowinfoid_' + iARowid;
                    sTransType = isNullCheck(objAS[j]['TransType'], 'string');
                    if (sTransType == "H") {
                        var sValue = isNullCheck(objAS[j]['Description'], 'string');


                        var stabelrow = '#rateanal_' + iARowid+ '_restable',
                            sStr= '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';

                        sStr = sStr.replace(/__1/g, '_' + iARowid);
                        sStr = sStr.replace(/__9/g, '_' + k);

//                        $(stabelrow + " tbody tr:last").after(sStr);
                        $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);

                        $('#rateanal_' + iARowid + '_resdes_' + k).val(sValue);
                        $('#rateanal_' + iARowid + '_type_' + k).val("H");

                        if (k == 1) {
                            var $row = $('#rateanal_' + iARowid + '_RowId_1');
                            $row.remove();
                        }

                    } else {
                        if (k != 1) {
                            var stabelrow = '#rateanal_' + iARowid + '_restable';
                            var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g, '_' + iARowid);
                            sStr = sStr.replace(/__9/g, '_' + k);
                            sStr = sStr.replace(/R1/g, 'R' + k);
//                            $(stabelrow + " tbody.sorting tr:last").after(sStr);
                            $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                            $('#rateanal_' + iARowid + '_refid_' + k).val(k);
                            SortOrder(iARowid);
                        }

                        if (objAS[j]['IncludeFlag'] == 1) $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
                        else $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
                        $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
                        $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
                        $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceName']);
                        $('#rateanal_' + iARowid + '_resid_' + k).prop('disabled', true);
                        $('#rateanal_' + iARowid + '_reskeyid_' + k).val(objAS[j]['ResourceId']);
//                    $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
                        $("label[for='" + "rateanal_" + iARowid + "_resunit_" + k + "']").html(objAS[j]['UnitName']);

                        $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAS[j]['Qty'], 3));
                        $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'], 2, true));
                        $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['CFormula']);
                        $('#rateanal_' + iARowid + '_type_' + k).val("R");


                        $('#rateanal_' + iARowid + '_Wastage_' + k).val(objAS[j]['Wastage']);
                        $('#rateanal_' + iARowid + '_Weightage_' + k).val(objAS[j]['Weightage']);
                        $('#rateanal_' + iARowid + '_WastageQty_' + k).val(objAS[j]['WastageQty']);
                        $('#rateanal_' + iARowid + '_WastageAmount_' + k).val(objAS[j]['WastageAmount']);
                        $('#rateanal_' + iARowid + '_restypeid_' + k).val(objAS[j]['TypeId']);

                        if (objAS[j]['TypeId'] != 2) {
                            $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                            $('#rateanal_' + iARowid + '_Wastage_' + k).hide();
                            $('#rateanal_' + iARowid + '_lblWastage_' + k).hide();
                        } else {
                            $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                            $('#rateanal_' + iARowid + '_Wastage_' + k).show();
                            $('#rateanal_' + iARowid + '_lblWastage_' + k).show();
                        }

                        if (objAS[j]['TypeId'] != 4) {
                            $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                            $('#rateanal_' + iARowid + '_Weightage_' + k).hide();
                            $('#rateanal_' + iARowid + '_lblWeightage_' + k).hide();
                        } else {
                            $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                            $('#rateanal_' + iARowid + '_Weightage_' + k).show();
                            $('#rateanal_' + iARowid + '_lblWeightage_' + k).show();
                        }
                        $('#rateanal_' + iARowid + '_resdel_' + k).show();

                        $(sRow).val(k);
                        cboResChanged(objAS[j]['ResourceId'], iARowid, k, "");
                        showAnalysis('rateanal_' + iARowid + '_resrate_' + k, "");
                        $('#rateanal_' + iARowid + '_resqty_' + k).trigger('change');
                    }
                }
                if (k!=0)  AddNewRowRes(iARowid,k);
                if (objT['ConcreteMix'] == 1) {
                    var objAR = $.grep(objA, function (element, index) {
                        return element.Type == 'R';
                    });
                    var k = 0;
                    for (var j = 0; j < objAR.length; j++) {
                        k = k + 1;
                        var sRow = '#rowinfoidR_' + iARowid;
                        sTransType = isNullCheck(objAR[j]['TransType'], 'string');
                        if (sTransType == "H") {
                            var sValue = isNullCheck(objAR[j]['Description'], 'string');
                            var stabelrow = '#rateanalR_' + iARowid+ '_restable',
                                sStr= '<tr id="rateanalR__1_RowId__9" class="row_header">' + $("#rateanalR__1_header__9").html() + '</tr>';

                            sStr = sStr.replace(/__1/g, '_' + iARowid);
                            sStr = sStr.replace(/__9/g, '_' + k);

//                            $(stabelrow + " tbody tr:last").after(sStr);
                            $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);

                            $('#rateanalR_' + iARowid + '_resdes_' + k).val(sValue);
                            $('#rateanalR_' + iARowid + '_type_' + k).val("H");

                            if (k == 1) {
                                var $row = $('#rateanalR_' + iARowid + '_RowId_1');
                                $row.remove();
                            }
                        } else {
                            if (k != 1) {
                                var stabelrow = '#rateanalR_' + iARowid + '_restable';
                                var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                                sStr = sStr.replace(/__1/g, '_' + iARowid);
                                sStr = sStr.replace(/__9/g, '_' + k);
                                sStr = sStr.replace(/R1/g, 'R' + k);
//                                $(stabelrow + " tbody.sorting tr:last").after(sStr);
                                $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);
                                $('#rateanalR_' + iARowid + '_refid_' + k).val(k);
                                SortOrderR(iARowid);
                            }
                            if (objAR[j]['IncludeFlag'] == 1) $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
                            else $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
                            $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                            $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
                            $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceName']);
                            $('#rateanalR_' + iARowid + '_resid_' + k).prop('disabled', true);
                            $('#rateanalR_' + iARowid + '_reskeyid_' + k).val(objAR[j]['ResourceId']);
//                        $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);
                            $("label[for='" + "rateanalR_" + iARowid + "_resunit_" + k + "']").html(objAR[j]['UnitName']);
                            $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAR[j]['Qty'], 3));
                            $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'], 2, true));
                            $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['CFormula']);
                            $('#rateanalR_' + iARowid + '_type_' + k).val("R");
                            $('#rateanalR_' + iARowid + '_Wastage_' + k).val(objAR[j]['Wastage']);
                            $('#rateanalR_' + iARowid + '_Weightage_' + k).val(objAR[j]['Weightage']);
                            $('#rateanalR_' + iARowid + '_WastageQty_' + k).val(objAR[j]['WastageQty']);
                            $('#rateanalR_' + iARowid + '_WastageAmount_' + k).val(objAR[j]['WastageAmount']);
                            $('#rateanalR_' + iARowid + '_restypeid_' + k).val(objAR[j]['TypeId']);

                            if (objAR[j]['TypeId'] != 2) {
                                $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                                $('#rateanalR_' + iARowid + '_Wastage_' + k).hide();
                                $('#rateanalR_' + iARowid + '_lblWastage_' + k).hide();
                            } else {
                                $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                                $('#rateanalR_' + iARowid + '_Wastage_' + k).show();
                                $('#rateanalR_' + iARowid + '_lblWastage_' + k).show();
                            }

                            if (objAR[j]['TypeId'] != 4) {
                                $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                                $('#rateanalR_' + iARowid + '_Weightage_' + k).hide();
                                $('#rateanalR_' + iARowid + '_lblWeightage_' + k).hide();
                            } else {
                                $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                                $('#rateanalR_' + iARowid + '_Weightage_' + k).show();
                                $('#rateanalR_' + iARowid + '_lblWeightage_' + k).show();
                            }

                            $('#rateanalR_' + iARowid + '_resdel_' + k).show();
                            $(sRow).val(k);
                            cboResChanged(objAR[j]['ResourceId'], iARowid, k, "R");
                            showAnalysis('rateanalR_' + iARowid + '_resrate_' + k, "R");
                            $('#rateanalR_' + iARowid + '_resqty_' + k).trigger('change');
                        }
                    }
                    if (k!=0)  AddNewRowResR(iARowid,k);
                }
            }

        }
    });
//    }
}

//function GetWorkGroupDetails(ival,x) {
////    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0) {
//    $.post( getBaseURL() + 'project/rfc/getworkgroupdetails', {resId:ival}, function( data ) {
//        var obj = jQuery.parseJSON(data);
//        var objT =obj['trans'];
//        var objA=obj['anal'];
//        var sStr = x.split("_");
//        var iARowid = sStr[1];
//        console.log(objT);
//
//        if (objT['ConcreteMix'] == 1) {
//            $('#concrete_' + iARowid).prop("checked", true); $('#mixtab_' + iARowid).show();
//            $('#rateanalR_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['RWorkingQty'],3));
//        } else {
//            $('#mixtab_' + iARowid).hide();
//            $('#rateanalR_' + iARowid + '_AnalQty').hide();
//        }
//        $('#rateanal_' + iARowid + '_AnalQty').val(sanitizeNumber(objT['WorkingQty'],3));
//        $('#rateanal_' + iARowid + '_AQty').val(sanitizeNumber(objT['CementRatio'],3));
//        $('#rateanal_' + iARowid + '_BQty').val(sanitizeNumber(objT['SandRatio'],3));
//        $('#rateanal_' + iARowid + '_CQty').val(sanitizeNumber(objT['MetalRatio'],3));
//        $('#rateanal_' + iARowid + '_thick').val(sanitizeNumber(objT['ThickQty'],3));
//        if (objT['Cement'] == 1) { $('#rateanal_' + iARowid + 'AQty_li').show(); }
//        else {$('#rateanal_' + iARowid + 'AQty_li').hide();}
//        if (objT['Sand'] == 1) $('#rateanal_' + iARowid + 'BQty_li').show();
//        else $('#rateanal_' + iARowid + 'BQty_li').hide();
//        if (objT['Metal'] == 1)  $('#rateanal_' + iARowid + 'CQty_li').show();
//        else  $('#rateanal_' + iARowid + 'CQty_li').hide();
//        if (objT['Thickness'] == 1)  $('#rateanal_' + iARowid + 'thick_li').show();
//        else $('#rateanal_' + iARowid + 'thick_li').hide();
//        var objAS = $.grep(objA, function (element, index) {
//            return element.Type != 'R';
//        });
//        var k = 0;
//        for (j = 0; j < objAS.length; j++) {
//            k = k + 1;
//            var sRow = '#rowinfoid_' + iARowid;
//            if (k != 1) {
//                var stabelrow = '#rateanal_' + iARowid + '_restable';
//                var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
//                sStr = sStr.replace(/__1/g, '_' + iARowid);
//                sStr = sStr.replace(/__9/g, '_' + k);
//                sStr = sStr.replace(/R1/g, 'R' + k);
//                $(stabelrow + " tbody tr:last").after(sStr);
//                $('#rateanal_' + iARowid + '_refid_' + k).val(k);
//                SortOrder(iARowid);
//            }
//            if (objAS[j]['IncludeFlag'] == 1) $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
//            else $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
//            $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
//            $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
//            $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceId']);
//            $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
//            $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAS[j]['Qty'],3));
//            $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'],2,true));
//            $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['CFormula']);
//            $(sRow).val(k);
//        }
//        var objAR = $.grep(objA, function (element, index) {
//            return element.Type == 'R';
//        });
//        var k = 0;
//        for (j = 0; j < objAR.length; j++) {
//            k = k + 1;
//            var sRow = '#rowinfoidR_' + iARowid;
//            if (k != 1) {
//                var stabelrow = '#rateanalR_' + iARowid + '_restable';
//                var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
//                sStr = sStr.replace(/__1/g, '_' + iARowid);
//                sStr = sStr.replace(/__9/g, '_' + k);
//                sStr = sStr.replace(/R1/g, 'R' + k);
//                $(stabelrow + " tbody tr:last").after(sStr);
//                $('#rateanalR_' + iARowid + '_refid_' + k).val(k);
//                SortOrderR(iARowid);
//            }
//            if (objAR[j]['IncludeFlag'] == 1) $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
//            else $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
//            $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
//            $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
//            $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceId']);
//            $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);
//            $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(objAR[j]['Qty'],3));
//            $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(objAS[j]['Rate'],2,true));
//            $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['CFormula']);
//            $(sRow).val(k);
//        }
//    });
////    }
//}
$(function() {

    $('body').tooltip({
        selector: '.error'
    });

    $('body').on('focus', 'textarea[id^=spec_],textarea[id^=shortspec_]', function () {
        $(this).parents('.on-focus').addClass('expandDiv');
    });

    $('body').on('blur', 'textarea[id^=spec_],textarea[id^=shortspec_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDiv');
    });
    $('body').on('focus', 'input[id^=libiowid_],input[id^=parentid_],input[id^=refserialno_]', function () {
        $(this).parents('.on-focus').addClass('expandDivn');
    });
    $('body').on('blur', 'input[id^=libiowid_],input[id^=parentid_],input[id^=refserialno_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDivn');
    });
    $(document).on('click', function() {
        toogleTooltip();
        toogleTooltipn();
    });

    $(document).keydown(function(event) {
        toogleTooltip();
        toogleTooltipn();
        if(event.keyCode == 13) event.preventDefault();
        else if(event.ctrlKey && event.keyCode == 78) {
            $("#addbut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 83) {
            $("#donebut").trigger("click");
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 82) {
            if (bSiteMix == true){$("#butresadd").trigger("click");}
            else{$("#butresRadd").trigger("click");}
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 67) {
            if (bSiteMix==true){var iRows = $('#rowinfoid_' + iFocusRowId).val();}
            else {var iRows = $('#rowinfoidR_' + iFocusRowId).val();}
            var arr= [];
            var k=0;
            for (i = 1; i <= iRows; i++) {
                if (bSiteMix ==true) var sTable = '#rateanal_' + iFocusRowId + '_RowId_' + i;
                else var sTable = '#rateanalR_' + iFocusRowId + '_RowId_' + i;
                if ($(sTable).hasClass('selected') == true) {
                    if (bSiteMix ==true) {
                        arr.push({
                            inc: $('#rateanal_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanal_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanal_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanal_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanal_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanal_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanal_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanal_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanal_' + iFocusRowId + '_formula_' + i).val()
                        });
                    } else {
                        arr.push({
                            inc: $('#rateanalR_' + iFocusRowId + '_inc_' + i).val(),
                            ref: $('#rateanalR_' + iFocusRowId + '_ref_' + i).val(),
                            code: $('#rateanalR_' + iFocusRowId + '_code_' + i).val(),
                            resid: $('#rateanalR_' + iFocusRowId + '_resid_' + i).val(),
                            resqty: $('#rateanalR_' + iFocusRowId + '_resqty_' + i).val(),
                            resunit: $('#rateanalR_' + iFocusRowId + '_resunit_' + i).val(),
                            resrate: $('#rateanalR_' + iFocusRowId + '_resrate_' + i).val(),
                            resamt: $('#rateanalR_' + iFocusRowId + '_resamt_' + i).val(),
                            formula: $('#rateanalR_' + iFocusRowId + '_formula_' + i).val()
                        });
                    }
                }
            }
            if (arr.length >0) {
                $.post(getBaseURL() + 'project/rfc/UpdateCopyAnalysis', {ids: arr}, function (data) {
                    //alert (data);
                });
            }
            event.preventDefault();
        } else if(event.ctrlKey && event.keyCode == 86) {
            $.post(getBaseURL() + 'project/rfc/GetCopyAnalysis', {ids: arr}, function (data) {
                var obj = jQuery.parseJSON(data);
                if (bSiteMix==true) {
                    var irowinfoId = $('#rowinfoid_' + iFocusRowId).val();
                    for (i = 0; i < obj.length; i++) {
                        if ($('#rateanal_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanal_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanal_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoid_' + iFocusRowId).val(irowinfoId);
                            SortOrder(iFocusRowId);
                        }
                        $('#rateanal_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanal_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanal_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanal_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanal_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanal_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanal_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanal_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanal_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                } else {
                    var irowinfoId = $('#rowinfoidR_' + iFocusRowId).val();
                    for (i = 0; i < obj.length; i++) {
                        if ($('#rateanalR_' + iFocusRowId + '_resid_'+ irowinfoId).val().length != 0) {
                            irowinfoId = +irowinfoId + 1;
                            var stabelrow = '#rateanalR_'+iFocusRowId + '_restable';
                            var sStr= '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                            sStr = sStr.replace(/__1/g,'_'+ iFocusRowId);
                            sStr = sStr.replace(/__9/g,'_'+ irowinfoId);
                            sStr = sStr.replace(/R1/g,'R'+ irowinfoId);
                            $(stabelrow+" tbody tr:last").after(sStr);
                            $('#rateanalR_' + iFocusRowId + '_refid_' + irowinfoId).val(irowinfoId);
                            $('#rowinfoidR_' + iFocusRowId).val(irowinfoId);
                            SortOrderR(iFocusRowId);
                        }
                        $('#rateanalR_' + iFocusRowId + '_inc_' + irowinfoId).val(obj[i]['inc']);
                        //$('#rateanalR_' + iFocusRowId + 'ref_' + irowinfoId).val(obj[i]['ref']);
                        $('#rateanalR_' + iFocusRowId + '_code_' + irowinfoId).val(obj[i]['code']);
                        $('#rateanalR_' + iFocusRowId + '_resid_' + irowinfoId).val(obj[i]['resid']);
                        $('#rateanalR_' + iFocusRowId + '_resqty_' + irowinfoId).val(obj[i]['resqty']);
                        $('#rateanalR_' + iFocusRowId + '_resunit_' + irowinfoId).val(obj[i]['resunit']);
                        $('#rateanalR_' + iFocusRowId + '_resrate_' + irowinfoId).val(obj[i]['resrate']);
                        $('#rateanalR_' + iFocusRowId + '_resamt_' + irowinfoId).val(obj[i]['resamt']);
                        $('#rateanalR_' + iFocusRowId + '_formula_' + irowinfoId).val(obj[i]['formula']);
                    }
                }
            });
        }
    });
    bindExcelDeleteFn();
});
function toogleTooltip() {
    var $expandDivs = $('.expandDiv');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('textarea').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDiv').find('textarea').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDiv');
        $expandDivs.not($parent_focus).find('textarea').trigger('blur');
        return;
    }
}
function toogleTooltipn() {

    var $expandDivs = $('.expandDivn');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('input').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDivn').find('input').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDivn');
        $expandDivs.not($parent_focus).find('input').trigger('blur');
        return;
    }
}
function excelvalid() {
    var $excelslnos = $('input[id^=excelserialno_]');
    $.each($excelslnos, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var ikey = name.split('_')[1];
        if (isNullCheck($("#excelserialno_" + ikey).val(), 'string') != "") {
            if (isNullCheck($("#excelwgid_" + ikey).val(), 'number') == 0)  $('#excelserialno_' + ikey).addClass('error');
            else $('#excelserialno_' + ikey).prop('readonly',true);
            if (isNullCheck($("#excelunitid_" + ikey).val(), 'number') == 0)  $('#excelunit_' + ikey).addClass('error');
            else $('#excelunit_' + ikey).prop('readonly',true);
            $('#excelcode_' + ikey).prop('readonly',true);
        }
        if (isNullCheck($("#excelcode_" + ikey).val(), 'string') != "") {
            if (isNullCheck($("#excelresid_" + ikey).val(), 'number') == 0)  $('#excelcode_' + ikey).addClass('error');
            else $('#excelcode_' + ikey).prop('readonly',true);
            $('#excelunit_' + ikey).prop('readonly',true);
            $('#excelserialno_' + ikey).prop('readonly',true);
        }
    });
}
function excelSheetValid() {
    var isValid=true;
    var $excelpids = $('input[id^=excelserialno_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#excelserialno_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelcode_' + key1).hasClass('error')) {
            isValid=false;
            return;
        } else if ($('#excelunit_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    return isValid;
}
function excelRowvalid(irowId) {
    var ikey = irowId;
    if ($('#excelserialno_' + ikey).hasClass('error')) $("#excelserialno_" + ikey).prop('readonly', false);
    else $("#excelserialno_" + ikey).prop('readonly', true);
    if ($('#excelcode_' + ikey).hasClass('error')) $("#excelcode_" + ikey).prop('readonly', false);
    else $("#excelcode_" + ikey).prop('readonly', true);
    if ($('#excelunit_' + ikey).hasClass('error')) $("#excelunit_" + ikey).prop('readonly', false);
    else $("#excelunit_" + ikey).prop('readonly', true);
}
function excelUnitFocus(x) {
    var key = x.split('_')[1];
    excelRowvalid(key);
    if ($('#excelunit_' + key).hasClass('error')) $('#excelunit_' + key).addClass('error').attr('data-original-title', 'Invalid unit').attr('data-toggle', 'tooltip');
}
function excelUnitvalid(x) {
    var key = x.split('_')[1];
    var sgName = isNullCheck($("#excelunit_" + key).val().trim(),'string');
    var iPId=0;
    if (sgName != "") {
        $.ajax({
            url: getBaseURL() + "project/rfc/checkunitfound/" + sgName,
            async: false,
            type: 'post',
            success: function (data, status) {
                iPId = isNullCheck(data, 'number');
            }
        });
        if (iPId == 0) $('#excelunit_' + key).addClass('error');
        else {
            $('#excelunitid_' + key).val(iPId);
            $('#excelunit_' + key).removeClass('error');
        }
    }
}
function getexcelfield(x) {
    var bValid=true;

    bExcelParent = false;
    bExcelType = false;
    bExcelRowType = false;
    bExcelResGroup = false;

    formData = new FormData();
    formData.append('file', $('#myfile').prop("files")[0]);
    $.ajax({
        url: getBaseURL() +"project/rfc/getrgfielddata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);

            $("#excelfieldTable").find("th").remove();
            $("#excelfieldTable").find("td").remove();
            //$("#excelfield").find("td").remove();

            var sStr="Select Field";
            for (var i = 0; i < obj.length; i++) {
                $("#excelfieldTable").append('<tr><th width="20%"><input id="efield_'+i+'" class="text-reon text-right" type="text" value="'+obj[i]['Field']+'" style="background: transparent;"/></th><td width="70%"><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td></tr>');
//                $("#excelfield").append('<td><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td>');
                $('#efield_'+i).prop('readonly', true);

                if (obj[i]['Field'].trim().toUpperCase() == 'SERIALNO') { $('#field_'+i).val('SerialNo'); bExcelSNo=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'SPECIFICATION') { $('#field_'+i).val('Specification'); bExcelSpec=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'UNIT') { $('#field_'+i).val('Unit'); bExcelUnit=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'QTY') { $('#field_'+i).val('Qty'); bExcelQty=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE') { $('#field_'+i).val('Rate'); bExcelRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'AMOUNT') { $('#field_'+i).val('Amount'); bExcelAmount=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'QRATE') { $('#field_'+i).val('QRate'); bExcelQRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'QAMOUNT') { $('#field_'+i).val('QAmount'); bExcelQAmount=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'ROWTYPE') { $('#field_'+i).val('RowType'); bExcelRowType=true;}
            }

            bindexcelFieldComplete();
            $('#divitem1').addClass('active');
            iExcelStep=1;
            $('#divstep1').removeClass('stepsep_active');
            $('#divstep2').removeClass('stepsep_active');
            $('#divstep3').removeClass('stepsep_active');
            $('#divstep4').removeClass('stepsep_active');
            $('#divstep5').removeClass('stepsep_active');
            $('#divstep6').removeClass('stepsep_active');
            $('#divstep7').removeClass('stepsep_active');
            $('#divstep8').removeClass('stepsep_active');
            $('#divstep9').removeClass('stepsep_active');

            $('#p_1').removeClass("stepli_p2");
            $('#p_2').removeClass("stepli_p2");
            $('#p_3').removeClass("stepli_p2");
            $('#p_4').removeClass("stepli_p2");
            $('#p_5').removeClass("stepli_p2");
            $('#p_6').removeClass("stepli_p2");
            $('#p_7').removeClass("stepli_p2");
            $('#p_8').removeClass("stepli_p2");
            $('#p_9').removeClass("stepli_p2");

            $('#divitem2').removeClass('active');
            $('#divitem3').removeClass('active');
            $('#divitem4').removeClass('active');
            $('#divitem5').removeClass('active');
            $('#divitem6').removeClass('active');
            $('#carouselNext').show();
            $('#carouselApply').hide();
            $("#excelmodal").modal('show');
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));

}

function bindexcelFieldComplete() {
    var $excelfield = $('input[id^=field_]');
    $excelfield.unbind('autocomplete');
    $.each($excelfield, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkexcelFieldUsed(key1);
        $this.autocomplete({
            lookup: arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) removeError($(this));
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) showError($(this), 'Invalid');
                else removeError($(this));
            }
        });
    });
}

function clearInputFile(file){
    var f = file[0];
    if(f.value){
        try{
            f.value = '';
        }catch(err){ }
        if(f.value){
            var form = document.createElement('form'),
                parentNode = f.parentNode, ref = f.nextSibling;
            form.appendChild(f);
            form.reset();
            parentNode.insertBefore(f,ref);
        }
    }
}

function checkexcelFieldFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkexcelFieldUsed(key1);
}
function checkexcelFieldUsed(id) {
    var reskeyid = $('input[id*=field_]');
    arrayFieldR = arrayField;
    arrayFieldR= $.grep(arrayField, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.value == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}


function expandwbsTrFn(reset) {
    var $mainTRs = $("a[class*=wbsTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wbsmainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewbsdetails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewbsdetails(key) {
    var $mainTRs = $("a[class*=wbsTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}

function expandwasteTrFn(reset) {
    var $mainTRs = $("a[class*=wasteTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewastedtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewastedtails(key) {
    var $mainTRs = $("a[class*=wasteTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}


function expandwasteRTrFn(reset) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
    $mainTRs.click(function(e){
        e.preventDefault();
        var name = $(this)[0].className,
            key = name.split('_')[1];
        if (validateRow(name) == false) return false;
        var $subTr = $(this).closest("tr").nextAll(".wastemainRTr_" + key),
            $i = $(this).find("i");
        if(!$subTr.is(":visible")){
            $subTr.show();
            $subTr.find(".subDiv").slideDown("slow");
            $i.removeClass("fa-chevron-circle-down");
            $i.addClass("fa-chevron-circle-up");
            showWastage(name);
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
            closewasteRdtails(key);
        } else {
            $subTr.find(".subDiv").slideUp("slow");
            $subTr.slideUp("slow");
            $i.removeClass("fa-chevron-circle-up");
            $i.addClass("fa-chevron-circle-down");
        }
        return false;
    });
}

function closewasteRdtails(key) {
    var $mainTRs = $("a[class*=wasteRTr_]");
    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
        if($mainTr.length != 0) $mainTr.trigger('click');
    });
}


//Wastage
function showWastage(x) {
    var iFocusRowId=x.split("_")[1],
        name = '#rateanal_' + iFocusRowId,
        ssname= 'rateanal_' + iFocusRowId,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0],
        sUnit =isNullCheck($('#unitid_' + iFocusRowId).val(),'string');

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        ssname= 'rateanalR_' + iFocusRowId,
            iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }




    var sHtml = '<table class="table red-thss" style=" margin-bottom:0px;"> \
                 <thead> \
                      <tr> \
                       <th>&nbsp;</th> \
                       <th>Ref</th> \
                       <th>Description</th> \
                       <th class="text-right">Qty</th> \
                       <th class="text-right">Wastage%</th> \
                       <th class="text-right">Wastage Qty</th> \
                       <th class="text-right">Rate</th> \
                       <th class="text-right">Amount</th> \
                       <th>&nbsp;</th> \
                      </tr> \
                 </thead> \
                 <tbody>';

    var bWasteFound=false;
    for (i = 1; i <= iRows; i++) {
        if ($(name + '_inc_' + i).is(':checked') == true) {
            var dwasteper = parseFloat(isNullCheck($(name + "_Wastage_" + i).val(),'number'));
            if (dwasteper !=0) {
                bWasteFound = true;

                var sRef = $('label[for=' + ssname + '_ref_' + i + ']').html().trim(),
                    sDesc = isNullCheck($(name + "_resid_" + i).val(),'string'),
                    dQty = parseFloat(isNullCheck($(name + "_resqty_" + i).val(),'number')),
                    dRate = parseFloat(isNullCheck($(name + "_resrate_" + i).val(),'number')),
                    dwasteQty = parseFloat(isNullCheck($(name + "_WastageQty_" + i).val(),'number')),
                    dwasteAmt = parseFloat(isNullCheck($(name + "_WastageAmount_" + i).val(),'number'));

                sHtml = sHtml + '<tr> \
                        <td width="1%">&nbsp;</td> \
                        <td width="3%"><label>' + sRef + '</label></td> \
                        <td width="15%"><input class="parent_text red-non" readonly value="' + sDesc + '"></td> \
                        <td width="5%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dQty,3) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteper,2) + '"></td> \
                        <td width="3%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteQty,3) + '"></td> \
                        <td width="8%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dRate,2,true) + '"></td> \
                        <td width="10%"><input class="parent_text text-right red-non" readonly value="' + sanitizeNumber(dwasteAmt,2,true) + '"></td> \
                        <td width="4%">&nbsp;</td> \
                        </tr>'
            }
        }
    }
    sHtml = sHtml + '</tbody> </table>';

    if (bWasteFound == false) sHtml="";

    if (sname.substr(sname.length-1) ==  "R") {
        $('#divwasteR_' + iFocusRowId).empty();
        $('#divwasteR_' + iFocusRowId).html(sHtml);
        $('#divwasteR_' + iFocusRowId).fadeIn("slow");
    } else {
        $('#divwaste_' + iFocusRowId).empty();
        $('#divwaste_' + iFocusRowId).html(sHtml);
        $('#divwaste_' + iFocusRowId).fadeIn("slow");
    }
}
function weigtageCheck(x) {
    var ikey1 = x.split("_")[1],
        ikey2 = x.split("_")[2],
        name = '#rateanal_' + ikey1,
        iRows = $('#rowinfoid_' + iFocusRowId).val(),
        sname = x.split("_")[0];

    if (sname.substr(sname.length-1) ==  "R") {
        name = '#rateanalR_' + iFocusRowId;
        iRows = $('#rowinfoidR_' + iFocusRowId).val();
    }

    var dweightage=0;
    for (var i = 1; i <= iRows; i++) {
        var dWQty = parseFloat(isNullCheck($(name + "_Weightage_" + i).val(),'number'));
        dweightage = dweightage + dWQty;
    }
    if (dweightage >100) {
        alert("Total Weightage% should not greater than 100%");
        var dWeight = dweightage - 100;
        var dval =  parseFloatVal(isNullCheck($('#'+x).val(),'number'));
        var dvalF = dval -dWeight;
        if (dvalF<0) dvalF=0;
        $('#'+x).val(sanitizeNumber(dvalF,2));
        dweightage=100;
    }
    $(name + "_totweightage").val(sanitizeNumber(dweightage,2));
}

function bindQualExpandTr() {
    var $mainTr = $(".qualmainExp");
    $mainTr.unbind('click');
    $mainTr.click(function (e) {
        e.preventDefault();
        if (!$(this).closest("tr").next(".qualsubTr").is(":visible")) {
            closeQualTr();
            $(this).closest("tr").next(".qualsubTr").show();
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideDown("slow");
        }
        else {
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".qualsubTr").slideUp("slow");
        }
    });
}
function closeQualTr() {
    var $mainTr = $(".qualmainExp");
    $.each($mainTr, function () {
        $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
        $(this).closest("tr").next(".qualsubTr").slideUp("slow");
    });
}

function CalculateQualifier(baseValue, key1,sQualName) {
    var sQName = sQualName + '_';
    var rows = $('#' + sQualName +  'RowId_' + key1).val();
    var sformula="";
    var dbaseAmt=baseValue;
    var dTotalQualAmt=0;

    for (i = 1; i <= rows; i++) {
        var sRef = $('#' + sQName + key1 + '_Ref_' + i).val().trim();
        var sFormula = isNullCheck($('#' + sQName + key1 + '_Exp_'+ i).val(),'string');
        var dPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_ExpPer_'+ i).val(),'number'));
        var sbaseRef = 'R0';
        if (parseFloatVal(dPer) ==0) dPer=100;
        sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);

        for (j = 1; j <= rows; j++) {
            var sFRef = $('#' + sQName + key1 + '_Ref_' + j).val().trim();
            var dFamt = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_Amount_'+ j).val(),'number'));
            sFormula = sFormula.replace(new RegExp(sFRef, 'g'), dFamt);
        }

        var fvaule = computeEval(sFormula);
        $('#' + sQName + key1 + '_ExpValue_' + i).val(sanitizeNumber(fvaule,2,true));

        var iQualTypeid = $('#' + sQName + key1 + '_TypeId_' + i).val();
        if (iQualTypeid==1) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(),'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(),'number'));
            var dCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_CessPer_' + i).val(),'number'));
            var dEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_EduCessPer_' + i).val(),'number'));
            var dHEDCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_HEduCessPer_' + i).val(),'number'));
            var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(sanitizeNumber(dNetPer,2,true));
            $('#' + sQName + key1 + '_ExpPer_'+ i).val(sanitizeNumber(dNetPer,2,true));

            var dTaxableAmt =  fvaule* (dTaxablePer/100);
            var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
            var dCessAmt =  dTaxAmt* (dCess/100);
            var dEDAmt =  dTaxAmt* (dEDCess/100);
            var dHEDAmt =  dTaxAmt* (dHEDCess/100);
            var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;

            $('#' + sQName + key1 + '_TaxableAmt_'+ i).val(sanitizeNumber(dTaxableAmt,2,true));
            $('#' + sQName + key1 + '_TaxPerAmt_'+ i).val(sanitizeNumber(dTaxAmt,2,true));
            $('#' + sQName + key1 + '_CessAmt_'+ i).val(sanitizeNumber(dCessAmt,2,true));
            $('#' + sQName + key1 + '_EduCessAmt_'+ i).val(sanitizeNumber(dEDAmt,2,true));
            $('#' + sQName + key1 + '_HEduCessAmt_'+ i).val(sanitizeNumber(dHEDAmt,2,true));
            $('#' + sQName + key1 + '_NetAmt_'+ i).val(sanitizeNumber(dNetAmt,2,true));

            dAmt = dNetAmt;
        } else if (iQualTypeid==2) {
            var dTaxablePer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxablePer_' + i).val(), 'number'));
            var dTaxPer = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_TaxPer_' + i).val(), 'number'));
            var dKKCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_KKCess_' + i).val(), 'number'));
            var dSBCess = parseFloatVal(isNullCheck($('#' + sQName + key1 + '_SBCess_' + i).val(), 'number'));
            var dNetPer = dTaxPer + dKKCess + dSBCess;

            $('#' + sQName + key1 + '_NetPer_' + i).val(dNetPer);

            $('#' + sQName + key1 + '_NetPer_' + i).val(sanitizeNumber(dNetPer, 2,true));
            $('#' + sQName + key1 + '_ExpPer_' + i).val(sanitizeNumber(dNetPer, 2,true));

            var dTaxableAmt = fvaule * (dTaxablePer / 100);
            var dTaxAmt = dTaxableAmt * (dTaxPer / 100);
            var dKKCessAmt = dTaxableAmt * (dKKCess / 100);
            var dSBCessAmt = dTaxableAmt * (dSBCess / 100);

            var dNetAmt = dTaxAmt + dKKCessAmt + dSBCessAmt;

            $('#' + sQName + key1 + '_TaxableAmt_' + i).val(sanitizeNumber(dTaxableAmt, 2,true));
            $('#' + sQName + key1 + '_TaxPerAmt_' + i).val(sanitizeNumber(dTaxAmt, 2,true));
            $('#' + sQName + key1 + '_KKCessAmt_' + i).val(sanitizeNumber(dKKCessAmt, 2,true));
            $('#' + sQName + key1 + '_SBCessAmt_' + i).val(sanitizeNumber(dSBCessAmt, 2,true));
            $('#' + sQName + key1 + '_NetAmt_' + i).val(sanitizeNumber(dNetAmt, 2,true));

            dAmt = dNetAmt;

        } else {
            var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
        }

        $('#' + sQName + key1 + '_Amount_' + i).val(sanitizeNumber(dAmt,2,true));
        if ($('#' + sQName + key1 + '_YesNo_' + i).is(':checked') == true) {
            var sSign = isNullCheck($('#' + sQName + key1 + '_Sign_' + i).val(),'string');
            if (sSign =="-") dTotalQualAmt = dTotalQualAmt - parseFloatVal(dAmt);
            else dTotalQualAmt = dTotalQualAmt + parseFloatVal(dAmt);
        }
    }
    $('#'+ sQualName + 'TotalAmt_' + key1).val(sanitizeNumber(dTotalQualAmt,2,true));

    return dTotalQualAmt;
    //qualTotal();
}

function bindTaxCalculation() {
    var $mainTr = $(".qualChange");
    $mainTr.change(function (e) {
        CalculateTax($(this)[0].id);
    });
}

function signChange(x) {
    var $this = $(x);
    if ($this.hasClass( "fa-plus" )) {
        $this.removeClass('fa-plus clr-gre');
        $this.addClass('fa-minus clr-red');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
    } else {
        $this.removeClass('fa-minus clr-red');
        $this.addClass('fa-plus clr-gre');
        var sname= $this[0].id.split('_')[0],
            key1 = $this[0].id.split('_')[1],
            key2 = $this[0].id.split('_')[3];
        $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
    }
    CalculateTax($this[0].id);
}

function CalculateTax(id) {
    //if (bReady==false) return;
    var sname= id.split('_')[0],
        key1 = id.split('_')[1],
        key2 = id.split('_')[3];

    var name = '#rateanal_' + key1;
    if (sname == "QualR")  name = '#rateanalR_' + key1;

    CalculateRate(name);

    //var sname = $('#QualRowRef_' + key1).val();
    ///var dbaseAmt= parseFloat($('#' + sname).val());

//    CalculateQualifier(dbaseAmt,key1);
//
//    var dTaxAmt = parseFloat(isNullCheck($('#QualTotalAmt_' + key1).val(),'number'));
//
//    var k1 = sname.split('_')[1],
//        k2 = sname.split('_')[3];
//
//    $('#BillAbs_' + k1 + '_TaxAmt_' + k2).val(dTaxAmt);
//    $('#BillAbs_' + k1 + '_NetAmt_' + k2).val(dTaxAmt+dbaseAmt);
//
//    calcTotal();
}



function showWBSMaster() {
    bindJqxTreeGrid();
    $("#wbsmodal").modal('show');
}
function wbsUpdate() {
    var items = $jqxTree.jqxTree('getItems');
    var exportArray = new Array();
    var j=0;
    var iLastLevel=0;
    for (var i = 0; i < items.length; i++) {
        var currentItem = items[i];
        var currentParentId = currentItem.parentId;
        iLastLevel=0;
        if (currentItem.hasItems==false) iLastLevel=1;
        j = +j+1;
        exportArray.push({ "id": currentItem.id, "name": currentItem.label, "parentid": currentParentId, "value": currentItem.value,"sortId" : j,'lastLevel' : iLastLevel});
    };

//    console.log(exportArray);
//    return;

    arr_wbslist = [];
    var ienquiryId = parseInt(isNullCheck($('#enquiryId').val(),'number'));
    $.ajax({
        url: getBaseURL() + "project/tender/updatetenderwbsmaster",
        async: false,
        data:{'EnquiryId': ienquiryId,'treePostData':treePostData,'masterdata':exportArray},
        type: 'post',
        success: function(data,status) {
            arr_wbslist = jQuery.parseJSON(data);
        }
    });
    treePostData = [];
    $('#wbsmodal').modal('toggle');
    getWBSMasterList();
    bindWBSautoComplete();
}

function getWBSMasterList(isReturnData) {
    arraywbslist = [];
    var iEnquiryId = parseInt(isNullCheck($('#enquiryId').val(), 'number'));
    $.ajax({
        url: getBaseURL() + "project/tender/gettenderwbsmasterlist",
        async: false,
        data: {'EnquiryId': iEnquiryId},
        type: 'post',
        success: function (data, status) {
            arraywbslist = jQuery.parseJSON(data);
        }
    });
    if(typeof isReturnData && isReturnData) {
        return arraywbslist;
    }

    arraywbs = arraywbslist;
}
function bindWBSautoComplete() {
    var $wbsids = $('input[id*=wbsname_]');
    $wbsids.unbind('autocomplete');
    $.each($wbsids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;

        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1)
            return;

        var arrname = name.split('_'),
            key1 = arrname[1],
            key2 = arrname[3];
//        checkwbs(key1,key2);
        $this.autocomplete({
            lookup: arraywbs,
            multiselect:true,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') {
                    return suggestion.value;
                }
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }

            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#wbstable_' + key1 + '_wbsid_' + key2).val(suggestion.data);
                    AddNewWBSRow(name);
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    $(this).addClass('error');
                    $('#wbstable_' + key1 + '_wbsid_' + key2).val(0);
                }
                else
                {
                    $(this).removeClass('error');
                }
            }
        });
    });
}
function bindJqxTreeGrid() {
    treePostData = [];
    getWBSMaster();
    var $jqxMenu = $('#jqxMenu'),
        source = {
            async: false,
            datatype: "json",
            editable:true,
            datafields: [
                { name: 'id' },
                { name: 'parentid' },
                { name: 'text' }
            ],
            id: 'id',
            localdata: arr_wbslist
        };

    var dataAdapter = new $.jqx.dataAdapter(source);
    dataAdapter.dataBind();
    var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{ name: 'text', map: 'label'}]);

    $jqxTree.jqxTree({ source: records, height: 400, width: '100%',allowDrag: true, allowDrop: true, keyboardNavigation: true,
        dragEnd: function (item, dropItem, args, dropPosition, tree) {
            if ((item.level != dropItem.level && item.parentId != dropItem.parentId) || (item.level == dropItem.level && dropPosition=='inside'))
                return false;
        }
    });
    $jqxTree.css('visibility', 'visible');
    var contextMenu = $jqxMenu.jqxMenu({ width: '150px',  height: '81px', autoOpenPopup: false, mode: 'popup' }),
        clickedItem = null,
        attachContextMenu = function () {
            // open the context menu when the user presses the mouse right button.
            $("#jqxTree li").on('mousedown', function (event) {
                var target = $(event.target).parents('li:first')[0],
                    rightClick = isRightClick(event),
                    $menu_newbs = $('#menu-newwbs'),
                    $menu_removewbs = $('#menu-removebs');

                if (rightClick && target != null) {
                    $jqxTree.jqxTree('selectItem', target);
                    var selItem = $jqxTree.jqxTree('selectedItem'),
                        $window = $(window);

                    var hasValues = checkIOWFieldsHasValues(selItem.id);
                    if (hasValues ==true) {
                        $menu_removewbs.hide();
                        $menu_newbs.hide();
                        $jqxMenu.jqxMenu({height: '27px'});
                    } else if (selItem.hasItems ==  true) {
                        $menu_newbs.show();
                        $menu_removewbs.hide();
                        $jqxMenu.jqxMenu({height: '54px'});
                    } else  {
                        $menu_newbs.show();
                        $menu_removewbs.show();
                        $jqxMenu.jqxMenu({height: '81px'});
                    }
                    contextMenu.jqxMenu('open', parseInt(event.clientX) + 5 + $window.scrollLeft(), parseInt(event.clientY) + 5 + $window.scrollTop());
                    return false;
                }
            });
        };

    attachContextMenu();
    $jqxMenu.unbind('itemclick');
    $jqxMenu.on('itemclick', function (event) {
        var item = $.trim($(event.args).text()),
            selectedItem = $jqxTree.jqxTree('selectedItem');

        if (selectedItem == null)
            return;

        switch (item) {
            case "Add WBS":
                $jqxTree.jqxTree('addTo', {label: 'New WBS'}, selectedItem.element);
                $jqxTree.jqxTree('expandItem', selectedItem.element);
                makeEditableContent(selectedItem.element, true);
                attachContextMenu();
                break;
            case "Edit WBS":
                makeEditableContent(selectedItem.element);
                break;
            case "Remove WBS":
                var id = selectedItem.id,
                    hasValues = checkIOWFieldsHasValues(id);
                if(hasValues==true) {
                    alert('Sorry, This WBS cannot be deleted. Since you added a IOW for the same!');
                    return;
                }

                if (confirm('Do you want to Delete')) {
                    // remove other action
                    if(treePostData.length != 0) {
                        $.each(treePostData, function (i, o) {
                            if (o.id == id) {
                                treePostData.splice(i, 1);
                                delete treePostData.length;
                                return;
                            }
                        });
                    }

                    if(id.indexOf('jqxWidget') == -1) {
                        // push data to array
                        treePostData.push({
                            'id': id,
                            'parentid': selectedItem.parentId,
                            'name': selectedItem.label,
                            'action': 'delete'
                        });
                    }

                    $jqxTree.jqxTree('removeItem', selectedItem.element);

                    if(hasValues == false) {
                        $("#newIOW_" + id).remove();
                        //$iowContent.hide();
                        //arrIOWData.splice(index,1);
                    }
                    attachContextMenu();
                }
                break;
//            case "Add IOW":
//                addNewIOW(selectedItem);
//                break;
//            case "Show IOW":
//                showAddedIOW(selectedItem);
//                break;
        }
    });

    $(document).on('contextmenu', function (e) {
        if ($(e.target).parents('.jqx-tree').length > 0)
            return false;

        return true;
    });

//    $('#' + $jqxTree.jqxTree('selectedItem').element.id).focusout(function () {
//        alert('kk');
//    });

    $jqxTree.jqxTree('expandAll');
    //renderIOWS();
}
jQuery.fn.selectText = function(){
    var element = this[0];
    if (document.body.createTextRange) {
        var range = document.body.createTextRange();
        range.moveToElementText(element);
        range.select();
    } else if (window.getSelection) {
        var selection = window.getSelection();
        var range = document.createRange();
        range.selectNodeContents(element);
        selection.removeAllRanges();
        selection.addRange(range);
    }
};

function getObjectKeyIndex(obj, value) {
    var index = null;
    $.each(obj, function(i, o) {
        if (o.id == value) {
            index = i;
            return false;
        }
    });
    return index;
}
function isRightClick(event) {
    var rightclick;
    if (!event) var event = window.event;
    if (event.which) rightclick = (event.which == 3);
    else if (event.button) rightclick = (event.button == 2);
    return rightclick;
}
function makeEditableContent(item, isCreate) {
    var $div = $(item).find('> div'),
        oldValue = $div.html(),
        action = 'update',
        id = item.id,
        parentId = item.parentId;

    if (typeof isCreate != 'undefined' && isCreate  == true) {
        $div = $(item).find('> ul li:last-child > div');
        action = 'create';
        id = $div.parent('li').attr('id');
        parentId = item.id;
        item = $(item).find('> ul li:last-child')[0];
    }

    // check and remove old data in array
    var index = getObjectKeyIndex(treePostData, id);
    if (index != null) {
        treePostData.splice(index,1);
    }

    $('#' + $jqxTree.jqxTree('selectedItem').element.id).focusout(function () {
        var newText =  $div.html();
        newText = newText.replace(/(<br>)*/g, '');
        $jqxTree.jqxTree('updateItem', item, { label:  newText });

    });

    $jqxTree.jqxTree({ keyboardNavigation: false});
    $div.prop('contenteditable', true);
    $div.focus();
    $div.unbind('keydown');
    $div.on('keydown', function(e) {
        if (e.keyCode == 27) {
            $div.html(oldValue);
            $div.prop('contenteditable', false);
            $jqxTree.jqxTree({ keyboardNavigation: true});
        }

        if (e.keyCode == 13) {
            e.preventDefault();
            $div.prop('contenteditable', false);
            $jqxTree.jqxTree({ keyboardNavigation: true});

            var newText =  $div.html();
            newText = newText.replace(/(<br>)*/g, '');
            $jqxTree.jqxTree('updateItem', item, { label:  newText });

//            newText = newText.replace(/(<br>)*/g, '');
//            // push data to array
//            treePostData.push({'id': id, 'parentid': parentId, 'name': newText, 'action': action});
            return false;
        }
    });
}
function getWBSMaster() {
    arr_wbslist = [];
    if (arr_wbslist.length == 0) {
        var iEnquiryId = parseInt(isNullCheck($('#enquiryId').val(), 'number'));
        $.ajax({
            url: getBaseURL() + "project/tender/gettenderwbsmaster",
            async: false,
            data: {'EnquiryId': iEnquiryId},
            type: 'post',
            success: function (data, status) {
                arr_wbslist = jQuery.parseJSON(data);
            }
        });
    }
}
function AddNewWBSRow(id) {
    var key1 =   id.split('_')[1],
        key2 =   id.split('_')[3],
        iRowId = $('#wbstable_' + key1 + '_rows').val();
    if (key2!=iRowId) return;

    if ($('#wbstable_' + key1 + '_wbsid_' + key2).val().length == 0 || parseInt(isNullCheck($('#wbstable_' + key1 + '_wbsid_' + key2).val(),'number')) == 0)
        return;

    if ($('#wbstable_' + key1 + '_wbsname_' + key2).val().length == 0)
        return;

    iRowId = +iRowId + 1;
    var stabelrow = '#wbstable_'+ key1,
        sStr = $('#dummywbstable tbody').html();

    sStr = sStr.replace(/__1/g,'_'+ key1);
    sStr = sStr.replace(/__9/g,'_'+ iRowId);
    $(stabelrow+" tbody tr:last").before(sStr);
    $('#wbstable_' + key1 + '_rows').val(iRowId);

    bindWBSautoComplete();
}
function checkIOWFieldsHasValues(id) {
    var isValid = false;

    var objR = $.grep(arr_wbslist, function (element, index) {
        return element.id == id;
    });

    if (objR['IOWUsed'] ==1) isValid=true;

    if (isValid==false) {
        var $resnames = $('input[id*=_wbsid_]');
        $.each($resnames, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            if (name.indexOf('__') != -1) return;
            var iwbsid = parseInt(isNullCheck($('#' + name).val(), 'number'));
            if (iwbsid == id) {
                isValid = true;
                return;
            }
        });
    }

    return isValid;
}

//function CheckWBSFocus(x)
//{
//    var arrname = x.split('_');
//    var key1 = arrname[1],
//        key2 = arrname[3];
//    checkwbs(key1,key2);
//}
//
//function checkwbs(key1,key2) {
//
//    var $wbskeyid = "";
//
//    var wbskeyid = $('input[id*=wbstable_' + key1 + '_wbsid_]');
//    arraywbs = arraywbslist;
//    arraywbs = $.grep(arraywbslist, function (element, index) {
//        var is_selected = true;
//        $.each(wbskeyid, function (i, obj) {
//            var $this = $(this),
//                name = $this[0].id;
//            var arrname = name.split('_');
//
//            var ikey1 = arrname[1],
//                ikey2 = arrname[3];
//
//            if (ikey2 != key2) {
//                if (element.data == $this.val()) {
//                    is_selected = false;
//                    return false;
//                }
//            }
//        });
//        return is_selected;
//    });
//}
function CheckWBSFocus(x) {
    var arrname = $(x)[0].id.split('_');
    var key1 = arrname[1],
        key2 = arrname[3];

    var wbskeyid = $('input[id*=wbstable_' + key1 + '_wbsid_]');
    arraywbs = arraywbslist;
    arraywbs = $.grep(arraywbslist, function (element, index) {
        var is_selected = true;
        $.each(wbskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');

            var ikey1 = arrname[1],
                ikey2 = arrname[3];

            if (ikey2 != key2) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
    bindWBSRowautoComplete(x);
}

function bindWBSRowautoComplete(x) {

    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1],
        key2 = arr_names[3];
    $this.unbind('autocomplete');
    var sName = arr_names[0];

    $this.autocomplete({
        lookup: arraywbs,
        multiselect:true,
        showNoSuggestionNotice:false,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#wbstable_' + key1 + '_wbsid_' + key2).val(suggestion.data);
                $('.wbstable_'+key1+'_TrDelete_'+key2).show();
                AddNewWBSRow(name);
                $(this).removeClass('error');
            }
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $('#wbstable_' + key1 + '_wbsid_' + key2).val(0);
            }
            else
            {
                $(this).removeClass('error');
            }
        }
    });
}
function GetIOWDetails(ival,x) {
//    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0)
//    {
    $.ajax({
        url: getBaseURL() + "project/rfc/getiowdetailsfromLibrary",
        async: false,
        type: 'post',
        data:{resId:ival},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];
            var objA = obj['anal'];
            var sStr = x.split("_");
            var iARowid = sStr[1];
            var dResQty = 0, dResRate = 0, dResAmt = 0;
            $('#ulworkgroup_'+iARowid).show();

//                $('#serialno_' + iARowid).val(objT['SerialNo']);
            $('#unitid_' + iARowid).val(objT['UnitName']);
            $('#unitkeyid_' + iARowid).val(objT['UnitId']);
            if (isNullCheck($('#spec_' + iARowid).val(),'string') =="") $('#spec_' + iARowid).val(objT['Specification']);
            $('#shortspec_' + iARowid).val(objT['ShortSpec']);
            $('#lworkgroupname_' + iARowid).val(objT['WorkGroupName']);
            $('#lserialno_' + iARowid).val(objT['SerialNo']);
            $('#workgroupid_' + iARowid).val(objT['WorkGroupId']);
            $('#lspec_' + iARowid).val(objT['ParentText']);
            $('#worktypeid_' +iARowid).val(objT['WorkTypeId']);
            $('#worktypename_' +iARowid).val(objT['WorkType']);

            if (parseInt([objT['UnitId']]) !=0) {
                $('#raheader_' + iARowid).prop("checked", false);
                $('#raheaderval_'+ iARowid).val(0);
                checkHeader('raheader_' + iARowid);
                $("#raheader_" + iARowid).prop("disabled", true);
            }

            if (objT['ConcreteMix'] == 1) {
                $('#concrete_' + iARowid).prop("checked", true);
                $('#raheaderval_'+ iARowid).val(1);
                $('#mixtab_' + iARowid).show();

                $('#rateanalR_' + iARowid + '_AnalQty').val(parseFloatVal(objT['RWorkingQty']).toFixed(3));
                $('#lisitemix_'+ iARowid).show();
                $('#lireadymix_'+ iARowid).show();
            }
            else {
                $('#mixtab_' + iARowid).hide();
                $('#rateanalR_' + iARowid + '_AnalQty').hide();
                $('#lisitemix_'+ iARowid).hide();
                $('#lireadymix_'+ iARowid).hide();
            }


            $('#rateanal_' + iARowid + '_AnalQty').val(parseFloatVal(objT['WorkingQty']).toFixed(3));
            $('#rateanal_' + iARowid + '_AQty').val(parseFloatVal(objT['CementRatio']).toFixed(3));
            $('#rateanal_' + iARowid + '_BQty').val(parseFloatVal(objT['SandRatio']).toFixed(3));
            $('#rateanal_' + iARowid + '_CQty').val(parseFloatVal(objT['MetalRatio']).toFixed(3));
            $('#rateanal_' + iARowid + '_thick').val(parseFloatVal(objT['ThickQty']).toFixed(3));

            if (objT['Cement'] == 1) {
                $('#rateanal_' + iARowid + 'AQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'AQty_li').hide();
            }

            if (objT['Sand'] == 1) {
                $('#rateanal_' + iARowid + 'BQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'BQty_li').hide();
            }

            if (objT['Metal'] == 1) {
                $('#rateanal_' + iARowid + 'CQty_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'CQty_li').hide();
            }

            if (objT['Thickness'] == 1) {
                $('#rateanal_' + iARowid + 'thick_li').show();
            }
            else {
                $('#rateanal_' + iARowid + 'thick_li').hide();
            }

            var objAS = $.grep(objA, function (element, index) {
                return element.MixType != 'R';
            });

            var k = 0;
            var dweigtage=0;
            var prevHeader = false;
            for (var j = 0; j < objAS.length; j++) {
                k = k + 1;
                var sRow = '#rowinfoid_' + iARowid;
                if (k != 1) {
                    var stabelrow = '#rateanal_' + iARowid + '_restable';
                    var sStr ="";
                    if  (objAS[j]['ResourceId'] ==0) {
                        sStr = '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';
                        sStr = sStr.replace(/__1/g, '_' + iARowid);
                        sStr = sStr.replace(/__9/g, '_' + k);
                        sStr = sStr.replace(/R1/g, 'R' + k);
                        $(stabelrow + " tbody.sorting  tr:last ").before(sStr);
                        $('#rateanal_' + iARowid + '_refid_' + k).val(k);
                    } else {
                        sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
                        sStr = sStr.replace(/__1/g, '_' + iARowid);
                        sStr = sStr.replace(/__9/g, '_' + k);
                        sStr = sStr.replace(/R1/g, 'R' + k);
                        $(stabelrow + " > tbody.sorting > tr:last-child").after(sStr);
                        $('#rateanal_' + iARowid + '_refid_' + k).val(k);
                    }

                    SortOrder(iARowid);

                } else {
                    if (objAS[j]['ResourceId']==0) {

                        k=+k+1;
                        var stabelrow = '#rateanal_' + iARowid + '_restable';

                        sStr = '<tr id="rateanal__1_RowId__9" class="row_header">' + $("#rateanal__1_header__9").html() + '</tr>';
                        sStr = sStr.replace(/__1/g, '_' + iARowid);
                        sStr = sStr.replace(/__9/g, '_' + k);
                        sStr = sStr.replace(/R1/g, 'R' + k);

                        $(stabelrow+" tbody.sorting  tr:last ").before(sStr);
                        $('#rateanal_' + iARowid + '_refid_' + k).val(1);

                        var $row = $('#rateanal_1_RowId_1');
                        $row.remove();

                    }
                }

                if (objAS[j]['ResourceId'] ==0) {
                    $('#rateanal_' + iARowid + '_resdes_' + k).val(objAS[j]['Description']);
                    $('#rateanal_' + iARowid + '_type_' + k).val('H');
                } else {

                    if (objAS[j]['IncludeFlag'] == 1) {
                        $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
                    }
                    else {
                        $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
                    }

                    dResQty = parseFloatVal(isNullCheck(objAS[j]['Qty'], 'number'));
                    dResRate = parseFloatVal(isNullCheck(objAS[j]['Rate'], 'number'));
                    dResAmt = dResQty * dResRate;

                    $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
                    $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
                    $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceName']);
                    $('#rateanal_' + iARowid + '_resid_' + k).prop('disabled', true);
                    $('#rateanal_' + iARowid + '_reskeyid_' + k).val(objAS[j]['ResourceId']);
                    $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
                    $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(dResQty, 3));
                    $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(dResRate, 2, true));
                    $('#rateanal_' + iARowid + '_resamt_' + k).val(sanitizeNumber(dResAmt, 2, true));

                    $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['Formula']);

                    $('#rateanal_' + iARowid + '_Wastage_' + k).val(objAS[j]['Wastage']);
                    $('#rateanal_' + iARowid + '_Weightage_' + k).val(objAS[j]['Weightage']);

                    dweigtage = +dweigtage + parseFloatVal(isNullCheck(objAS[j]['Weightage'], 'number'));
                    $('#rateanal_' + iARowid + '_WastageQty_' + k).val(objAS[j]['WastageQty']);
                    $('#rateanal_' + iARowid + '_WastageAmount_' + k).val(objAS[j]['WastageAmount']);
                    $('#rateanal_' + iARowid + '_restypeid_' + k).val(objAS[j]['TypeId']);
                    $('#rateanal_' + iARowid + '_type_' + k).val(objAS[j]['TransType']);

                    if (objAS[j]['TypeId'] != 2) {
                        $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                        $('#rateanal_' + iARowid + '_Wastage_' + k).hide();
                        $('#rateanal_' + iARowid + '_lblWastage_' + k).hide();
                    } else {
                        $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                        $('#rateanal_' + iARowid + '_Wastage_' + k).show();
                        $('#rateanal_' + iARowid + '_lblWastage_' + k).show();
                    }

                    if (objAS[j]['TypeId'] != 4) {
                        $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                        $('#rateanal_' + iARowid + '_Weightage_' + k).hide();
                        $('#rateanal_' + iARowid + '_lblWeightage_' + k).hide();
                    } else {
                        $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                        $('#rateanal_' + iARowid + '_Weightage_' + k).show();
                        $('#rateanal_' + iARowid + '_lblWeightage_' + k).show();
                    }
                    $('#rateanal_' + iARowid + '_resdel_' + k).show();

                    //if objAS[j]['TypeId']


                    $(sRow).val(k);

                    cboResChanged(objAS[j]['ResourceId'], iARowid, k, "");
                    showAnalysis('rateanal_' + iARowid + '_resrate_' + k, "");
                    ValueChange('#rateanal_' + iARowid + '_resrate_' + k);
                }
            }
            if (k != 0)  AddNewRowRes(iARowid, k);
            $('#rateanal_' + iARowid + '_totweightage').val(sanitizeNumber(dweigtage,2));

            dweigtage=0;
            if (objT['ConcreteMix'] == 1) {
                var objAR = $.grep(objA, function (element, index) {
                    return element.MixType == 'R';
                });
                dResQty = 0, dResRate = 0, dResAmt = 0;
                var k = 0;
                for (var j = 0; j < objAR.length; j++) {
                    k = k + 1;
                    var sRow = '#rowinfoidR_' + iARowid;

                    if (k != 1) {

                        var stabelrow = '#rateanalR_' + iARowid + '_restable';
                        var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
                        sStr = sStr.replace(/__1/g, '_' + iARowid);
                        sStr = sStr.replace(/__9/g, '_' + k);
                        sStr = sStr.replace(/R1/g, 'R' + k);

                        $(stabelrow+" > tbody.sorting > tr:last-child").after(sStr);

                        $('#rateanalR_' + iARowid + '_refid_' + k).val(k);

                        SortOrderR(iARowid);
                    }

                    if (objAR[j]['IncludeFlag'] == 1) {
                        $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
                    }
                    else {
                        $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
                    }

                    $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                    $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
                    $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceName']);
                    $('#rateanalR_' + iARowid + '_resid_' + k).prop('disabled', true);
                    $('#rateanalR_' + iARowid + '_reskeyid_' + k).val(objAR[j]['ResourceId']);
                    $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);

                    dResQty = parseFloatVal(isNullCheck(objAR[j]['Qty'], 'number'));
                    dResRate = parseFloatVal(isNullCheck(objAR[j]['Rate'], 'number'));
                    dResAmt = dResQty * dResRate;

                    $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
                    $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
                    $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceName']);
                    $('#rateanalR_' + iARowid + '_resid_' + k).prop('disabled', true);
                    $('#rateanalR_' + iARowid + '_reskeyid_' + k).val(objAR[j]['ResourceId']);
                    $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);

                    dResQty = parseFloatVal(isNullCheck(objAR[j]['Qty'], 'number'));
                    dResRate = parseFloatVal(isNullCheck(objAR[j]['Rate'], 'number'));
                    dResAmt = dResQty * dResRate;

                    $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(dResQty, 3));
                    $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(dResRate, 2, true));
                    $('#rateanalR_' + iARowid + '_resamt_' + k).val(sanitizeNumber(dResAmt, 2, true));
                    $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['Formula']);

                    $('#rateanalR_' + iARowid + '_Wastage_' + k).val(objAR[j]['Wastage']);
                    $('#rateanalR_' + iARowid + '_Weightage_' + k).val(objAR[j]['Weightage']);
                    dweigtage = +dweigtage + parseFloatVal(isNullCheck(objAR[j]['Weightage'],'number'));
                    $('#rateanalR_' + iARowid + '_WastageQty_' + k).val(objAR[j]['WastageQty']);
                    $('#rateanalR_' + iARowid + '_WastageAmount_' + k).val(objAR[j]['WastageAmount']);
                    $('#rateanalR_' + iARowid + '_restypeid_' + k).val(objAR[j]['TypeId']);
                    $('#rateanalR_' + iARowid + '_type_' + k).val(objAR[j]['TransType']);

                    if (objAR[j]['TypeId'] != 2) {
                        $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', true);
                        $('#rateanalR_' + iARowid + '_Wastage_' + k).hide();
                        $('#rateanalR_' + iARowid + '_lblWastage_' + k).hide();
                    } else {
                        $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', false);
                        $('#rateanalR_' + iARowid + '_Wastage_' + k).show();
                        $('#rateanalR_' + iARowid + '_lblWastage_' + k).show();
                    }

                    if (objAR[j]['TypeId'] != 4) {
                        $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', true);
                        $('#rateanalR_' + iARowid + '_Weightage_' + k).hide;
                        $('#rateanalR_' + iARowid + '_lblWeightage_' + k).hide;
                    } else {
                        $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', false);
                        $('#rateanalR_' + iARowid + '_Weightage_' + k).show();
                        $('#rateanalR_' + iARowid + '_lblWeightage_' + k).show();
                    }
                    $('#rateanalR_' + iARowid + '_resdel_' + k).show();
                    $(sRow).val(k);
                    cboResChanged(objAR[j]['ResourceId'], iARowid, k, "R");
                    showAnalysis('rateanalR_' + iARowid + '_resrate_' + k, "R");
                    ValueChange('#rateanalR_' + iARowid + '_resrate_' + k);
                }
                if (k != 0)  AddNewRowResR(iARowid, k);
                $('#rateanalR_' + iARowid + '_totweightage').val(sanitizeNumber(dweigtage,2));
            }
            CheckSpecification('spec_'+iARowid);
            $('#libiowid_'+iARowid).prop('readonly',true);
            AddNewRowA("#parentkeyid_" + iARowid, true);
        }
    });
//    }

//    if ($('#rfcmode').val().trim() != 'edit' && $('#rfcid').val()!=0)
//    {
//        $.post( getBaseURL() + 'project/rfc/getiowdetailsfromLibrary', {resId:ival}, function( data )
//        {
//            var obj = jQuery.parseJSON(data);
//            var objT =obj['trans'];
//            var objA=obj['anal'];
//
//            var sStr = x.split("_");
//
//            var iARowid = sStr[1];
//            var dResQty= 0,dResRate= 0,dResAmt= 0;
//
//            $('#serialno_' + iARowid).val(objT['SerialNo']);
//            $('#unitid_' + iARowid).val(objT['UnitName']);
//            $('#unitkeyid_' + iARowid).val(objT['UnitId']);
//            $('#spec_' + iARowid).val(objT['Specification']);
//            $('#shortspec_' + iARowid).val(objT['ShortSpec']);
//            $('#lworkgroupname_' + iARowid).val(objT['WorkGroupName']);
//            $('#lworkgroupid_' + iARowid).val(objT['WorkGroupId']);
//
//
//            if (objT['ConcreteMix'] == 1) {$('#concrete_' + iARowid).prop("checked", true); $('#mixtab_' + iARowid).show();
//
//                $('#rateanalR_' + iARowid + '_AnalQty').val(parseFloatVal(objT['RWorkingQty']).toFixed(3));
//            }
//            else {
//                $('#mixtab_' + iARowid).hide();
//                $('#rateanalR_' + iARowid + '_AnalQty').hide();
//            }
//
//            $('#rateanal_' + iARowid + '_AnalQty').val(parseFloatVal(objT['WorkingQty']).toFixed(3));
//            $('#rateanal_' + iARowid + '_AQty').val(parseFloatVal(objT['CementRatio']).toFixed(3));
//            $('#rateanal_' + iARowid + '_BQty').val(parseFloatVal(objT['SandRatio']).toFixed(3));
//            $('#rateanal_' + iARowid + '_CQty').val(parseFloatVal(objT['MetalRatio']).toFixed(3));
//            $('#rateanal_' + iARowid + '_thick').val(parseFloatVal(objT['ThickQty']).toFixed(3));
//
//            if (objT['Cement'] == 1) { $('#rateanal_' + iARowid + 'AQty_li').show(); }
//            else {$('#rateanal_' + iARowid + 'AQty_li').hide();}
//
//            if (objT['Sand'] == 1) {$('#rateanal_' + iARowid + 'BQty_li').show(); }
//            else {$('#rateanal_' + iARowid + 'BQty_li').hide();}
//
//            if (objT['Metal'] == 1) { $('#rateanal_' + iARowid + 'CQty_li').show(); }
//            else { $('#rateanal_' + iARowid + 'CQty_li').hide();}
//
//            if (objT['Thickness'] == 1) { $('#rateanal_' + iARowid + 'thick_li').show(); }
//            else {$('#rateanal_' + iARowid + 'thick_li').hide(); }
//
//            var objAS = $.grep(objA, function (element, index) {
//                return element.MixType != 'R';
//            });
//
//            var k = 0;
//            for (j = 0; j < objAS.length; j++) {
//                k = k + 1;
//                var sRow = '#rowinfoid_' + iARowid;
//                if (k != 1) {
//                    var stabelrow = '#rateanal_' + iARowid + '_restable';
//                    var sStr = '<tr id="rateanal__1_RowId__9">' + $("#rateanal__1_RowId__9").html() + '</tr>';
//                    sStr = sStr.replace(/__1/g, '_' + iARowid);
//                    sStr = sStr.replace(/__9/g, '_' + k);
//                    sStr = sStr.replace(/R1/g, 'R' + k);
//
//                    $(stabelrow + " tbody.sorting tr:last").after(sStr);
//
//                    $('#rateanal_' + iARowid + '_refid_' + k).val(k);
//
//                    SortOrder(iARowid);
//
//                }
//
//                if (objAS[j]['IncludeFlag'] == 1) {
//                    $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", true);
//                }
//                else {
//                    $('#rateanal_' + iARowid + '_inc_' + k).prop("checked", false);
//                }
//
//                dResQty= parseFloatVal(isNullCheck(objAS[j]['Qty'],'number'));
//                dResRate= parseFloatVal(isNullCheck(objAS[j]['Rate'],'number'));
//                dResAmt = dResQty*dResRate;
//
//                $('#rateanal_' + iARowid + '_ref_' + k).val('R' + objAS[j]['ReferenceId']);
//                $('#rateanal_' + iARowid + '_code_' + k).val(objAS[j]['Code']);
//                $('#rateanal_' + iARowid + '_resid_' + k).val(objAS[j]['ResourceName']);
//                $('#rateanal_' + iARowid + '_reskeyid_' + k).val(objAS[j]['ResourceId']);
//                $('#rateanal_' + iARowid + '_resunit_' + k).val(objAS[j]['UnitName']);
//                $('#rateanal_' + iARowid + '_resqty_' + k).val(sanitizeNumber(dResQty,3));
//                $('#rateanal_' + iARowid + '_resrate_' + k).val(sanitizeNumber(dResRate,2,true));
//                $('#rateanal_' + iARowid + '_resamt_' + k).val(sanitizeNumber(dResAmt,2,true));
//
//                $('#rateanal_' + iARowid + '_formula_' + k).val(objAS[j]['Formula']);
//
//                $('#rateanal_' + iARowid + '_Wastage_' + k).val(objAS[j]['Wastage']);
//                $('#rateanal_' + iARowid + '_Weightage_' + k).val(objAS[j]['Weightage']);
//                $('#rateanal_' + iARowid + '_WastageQty_' + k).val(objAS[j]['WastageQty']);
//                $('#rateanal_' + iARowid + '_WastageAmount_' + k).val(objAS[j]['WastageAmount']);
//                $('#rateanal_' + iARowid + '_restypeid_' + k).val(objAS[j]['TypeId']);
//
//                if (objAS[j]['TypeId'] !=2) {
//                    $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', true);
//                    $('#rateanal_' + iARowid + '_Wastage_' + k).hide();
//                    $('#rateanal_' + iARowid + '_lblWastage_' + k).hide();
//                } else {
//                    $('#rateanal_' + iARowid + '_Wastage_' + k).prop('readonly', false);
//                    $('#rateanal_' + iARowid + '_Wastage_' + k).show();
//                    $('#rateanal_' + iARowid + '_lblWastage_' + k).show();
//                }
//
//                if (objAS[j]['TypeId'] !=4) {
//                    $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', true);
//                    $('#rateanal_' + iARowid + '_Weightage_' + k).hide();
//                    $('#rateanal_' + iARowid + '_lblWeightage_' + k).hide();
//                } else {
//                    $('#rateanal_' + iARowid + '_Weightage_' + k).prop('readonly', false);
//                    $('#rateanal_' + iARowid + '_Weightage_' + k).show();
//                    $('#rateanal_' + iARowid + '_lblWeightage_' + k).show();
//                }
//
//                //if objAS[j]['TypeId']
//
//
//                $(sRow).val(k);
//                ValueChange('#rateanal_'+ iARowid + '_resrate_' + k);
//            }
//
//            if (objT['ConcreteMix'] == 1) {
//                var objAR = $.grep(objA, function (element, index) {
//                    return element.MixType == 'R';
//                });
//                dResQty= 0,dResRate= 0,dResAmt= 0;
//                var k = 0;
//                for (j = 0; j < objAR.length; j++) {
//                    k = k + 1;
//                    var sRow = '#rowinfoidR_' + iARowid;
//
//                    if (k != 1) {
//
//                        var stabelrow = '#rateanalR_' + iARowid + '_restable';
//                        var sStr = '<tr id="rateanalR__1_RowId__9">' + $("#rateanalR__1_RowId__9").html() + '</tr>';
//                        sStr = sStr.replace(/__1/g, '_' + iARowid);
//                        sStr = sStr.replace(/__9/g, '_' + k);
//                        sStr = sStr.replace(/R1/g, 'R' + k);
//
//                        $(stabelrow + " tbody.sorting tr:last").after(sStr);
//
//                        $('#rateanalR_' + iARowid + '_refid_' + k).val(k);
//
//                        SortOrderR(iARowid);
//                    }
//
//                    if (objAR[j]['IncludeFlag'] == 1) {
//                        $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", true);
//                    }
//                    else {
//                        $('#rateanalR_' + iARowid + '_inc_' + k).prop("checked", false);
//                    }
//
//                    $('#rateanalR_' + iARowid + '_ref_' + k).val('R' + objAR[j]['ReferenceId']);
//                    $('#rateanalR_' + iARowid + '_code_' + k).val(objAR[j]['Code']);
//                    $('#rateanalR_' + iARowid + '_resid_' + k).val(objAR[j]['ResourceName']);
//                    $('#rateanalR_' + iARowid + '_reskeyid_' + k).val(objAR[j]['ResourceId']);
//                    $('#rateanalR_' + iARowid + '_resunit_' + k).val(objAR[j]['UnitName']);
//
//                    dResQty= parseFloatVal(isNullCheck(objAR[j]['Qty'],'number'));
//                    dResRate= parseFloatVal(isNullCheck(objAR[j]['Rate'],'number'));
//                    dResAmt = dResQty*dResRate;
//
//                    $('#rateanalR_' + iARowid + '_resqty_' + k).val(sanitizeNumber(dResQty,3));
//                    $('#rateanalR_' + iARowid + '_resrate_' + k).val(sanitizeNumber(dResRate,2,true));
//                    $('#rateanalR_' + iARowid + '_resamt_' + k).val(sanitizeNumber(dResAmt,2,true));
//                    $('#rateanalR_' + iARowid + '_formula_' + k).val(objAR[j]['Formula']);
//
//                    $('#rateanalR_' + iARowid + '_Wastage_' + k).val(objAR[j]['Wastage']);
//                    $('#rateanalR_' + iARowid + '_Weightage_' + k).val(objAR[j]['Weightage']);
//                    $('#rateanalR_' + iARowid + '_WastageQty_' + k).val(objAR[j]['WastageQty']);
//                    $('#rateanalR_' + iARowid + '_WastageAmount_' + k).val(objAR[j]['WastageAmount']);
//                    $('#rateanalR_' + iARowid + '_restypeid_' + k).val(objAR[j]['TypeId']);
//
//                    if (objAR[j]['TypeId'] !=2) {
//                        $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', true);
//                        $('#rateanalR_' + iARowid + '_Wastage_' + k).hide();
//                        $('#rateanalR_' + iARowid + '_lblWastage_' + k).hide();
//                    } else {
//                        $('#rateanalR_' + iARowid + '_Wastage_' + k).prop('readonly', false);
//                        $('#rateanalR_' + iARowid + '_Wastage_' + k).show();
//                        $('#rateanalR_' + iARowid + '_lblWastage_' + k).show();
//                    }
//
//                    if (objAR[j]['TypeId'] !=4) {
//                        $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', true);
//                        $('#rateanalR_' + iARowid + '_Weightage_' + k).hide;
//                        $('#rateanalR_' + iARowid + '_lblWeightage_' + k).hide;
//                    } else {
//                        $('#rateanalR_' + iARowid + '_Weightage_' + k).prop('readonly', false);
//                        $('#rateanalR_' + iARowid + '_Weightage_' + k).show();
//                        $('#rateanalR_' + iARowid + '_lblWeightage_' + k).show();
//                    }
//
//                    $(sRow).val(k);
//                    ValueChange('#rateanalR_'+ iARowid + '_resrate_' + k);
//                }
//            }
//        });
//    }
}
function rateUpdate(x) {
    var key = x.split('_')[1],
        rate = parseFloatVal(isNullCheck($('#rate_' + key).val(),'number')),
        qrate = parseFloatVal(isNullCheck($('#qrate_' + key).val(),'number')),
        dPer= 0,
        qty = parseFloatVal(isNullCheck($('#qty_' + key).val(),'number'));
    $('#amt_' + key).val(sanitizeNumber(rate*qty,2,true));
    if (rate !=0 && qrate !=0) dPer = ((qrate-rate)/rate)*100;
    $('#qper_' + key).val(sanitizeNumber(dPer,2,true));
    calcResQty();
    calcBoqAmount();
}

function MixRateUpdate(x) {
    var iARowid = x.split('_')[1],
        name =  x.split('_')[0],
        sitemix= 0,readymix= 0;
    if (name == "sitemixper") {
        sitemix = parseFloatVal(isNullCheck($('#sitemixper_' + iARowid).val(),'number'));
        readymix = 100 - sitemix;
        $('#readymixper_' + iARowid).val(sanitizeNumber(readymix,2));
    } else  {
        readymix = parseFloatVal(isNullCheck($('#readymixper_' + iARowid).val(),'number'));
        sitemix = 100 - readymix;
        $('#sitemixper_' + iARowid).val(sanitizeNumber(sitemix,2));
    }

    var dRate = isNullCheck($('#rateanal_' + iARowid + '_totnetrate').val(),'number'),
        dRateR = isNullCheck($('#rateanalR_' + iARowid + '_totnetrate').val(),'number');

    var totalMix = dRate * (sitemix / 100);
    totalMix += dRateR * (readymix / 100);
    $('#rate_' + iARowid).val(sanitizeNumber(totalMix,2,true));
    rateUpdate(x);
}
function wbsQtyChange(x) {
    var arrname = x.split('_');
    var key1 = arrname[1],
        key2 = arrname[3],
        irows = parseInt(isNullCheck($('#wbstable_' + key1 + '_rows').val(), 'number')),
        dQty=0;

    for (var i = 1; i <= irows; i++)
    {
        dQty = dQty + parseFloatVal(isNullCheck($('#wbstable_' + key1 + '_qty_' + i).val(),'number'));
    }
    $('#wbstable_' + key1 + '_totalqty').val(sanitizeNumber(dQty,3));
    $('#qty_' + key1).val(sanitizeNumber(dQty,3));
    var rate = parseFloatVal(isNullCheck($('#rate_' + key1).val(),'number')),
        qrate = parseFloatVal(isNullCheck($('#qrate_' + key1).val(),'number')),
        dPer = 0;
    $('#amt_' + key1).val(sanitizeNumber(rate*dQty,2,true));
    if (rate !=0 && qrate !=0) dPer = ((qrate-rate)/rate)*100;
    $('#qper_' + key1).val(sanitizeNumber(dPer,2,true));

    calcResQty();
    calcBoqAmount();
}
function changeRateApply(raType)
{
    if(raType == 1) {
        $("#wgwiseInp").hide();
        $("#inpAll").val('').trigger('change');
        $("#allInp").show();
    } else if(raType == 2) {
        $("#allInp").hide();
        var strWgw = '';
        var arrWG = [];
        $proj_workgroups = $('input[id^=pworkgroupname_]');
        $.each($proj_workgroups, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;

            var key1 = name.split('_')[1];
            var wogId = $("#pworkgroupid_" + key1).val();
            var wogName = $("#pworkgroupname_" + key1).val();
            if(wogId != '' && wogId != undefined) {
                if($.inArray(wogId, arrWG) == -1) {
                    strWgw += '<label style="margin-bottom: 10px; padding-top:5px;" class="col-lg-6 col-md-6 col-sm-6">' + wogName + '</label>';
                    strWgw += '<input type="hidden" name="inpWgw_' + wogId + '" value="' + wogId + '" id="inpWgw_' + wogId + '" />';
                    strWgw += '<input type="text" style="width:50%;" class="col-lg-6 col-md-6 col-sm-6 parent_text" name="inpWgwRate_' + wogId + '" value="" id="inpWgwRate_' + wogId + '" maxlength="3" onkeypress="return isDecimal(event,this)" />';
                    arrWG.push(wogId);
                }
            }
        });
        $("#wgwiseInp").html(strWgw);
        $("#wgwiseInp").show();
    }
}
function deleteWBS(x,e) {
    e.preventDefault();
    var $x = $(x),
        keys = $x[0].className.split('_');

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr');
    $tr.next('tr.subTr').remove();
    $tr.remove();
//    console.log($('#wbstable_'+keys[1]+'_qty_'+ (keys[3] + 1) ))
    $('#wbstable_'+keys[1]+'_qty_'+ (parseInt(keys[3]) + 1) ).trigger('change');
    return false;
}
function rateApply()
{
    var roundOff =  parseFloatVal($('#roundOff').val());
    if ($('#applyAll').is(':checked') == true) {
        var ratePer = parseFloatVal($("#inpAll").val());
        var qrate = 0;
        var qamt = 0;
        $.each($('input[id^=rate_]'), function (i,o) {
            var keys = $(this)[0].id.split('_'),
                key = keys[1];
            var rate = parseFloatVal(isNullCheck($('#rate_' + key).val(),'number'));

            if(rate != 0) {
                qrate = (rate * ratePer) / 100;
                qrate = qrate+rate;
                if(roundOff != '' && roundOff != 0) {
                    qrate = Math.round(qrate / roundOff) * roundOff;
                }
                qamt = (qrate * parseFloatVal(isNullCheck($('#qty_'+key).val(),'number')));
                $('#qrate_'+key).val(sanitizeNumber(qrate,2,true));
                $('#qamt_'+key).val(sanitizeNumber(qamt,2,true));

                var dPer =0;
                if (rate !=0 && qrate !=0) dPer = ((qrate-rate)/rate)*100;
                $('#qper_' + key).val(sanitizeNumber(dPer,2,true));
            }
        });
    } else if ($('#wgwise').is(':checked') == true) {
        $.each($('input[id^=inpWgw_]'), function (i,o) {
            var keys = $(this)[0].id.split('_'),
                key = keys[1];
            var ratePer = parseFloatVal($('#inpWgw_' + key).val());

            $proj_workgroups = $('input[id^=pworkgroupname_]');
            $.each($proj_workgroups, function (ii, obj) {
                var $this = $(this),
                    name = $this[0].id;

                var key1 = name.split('_')[1];
                var wogId = parseFloatVal(isNullCheck($("#pworkgroupid_" + key1).val(),'number'));

                var qrate = 0;
                var qamt = 0;
                if(wogId != 0 && wogId != undefined && wogId == key) {
                    var rate = parseFloatVal(isNullCheck($('#rate_' + key1).val(),'number'));

                    if (rate != 0) {
                        qrate = (rate * ratePer) / 100;
                        qrate = qrate+rate;
                        if(roundOff != '' && roundOff != 0) {
                            qrate = Math.round(qrate / roundOff) * roundOff;
                        }
                        qamt = (qrate * parseFloatVal(isNullCheck($('#qty_' + key1).val(),'number')));
                        $('#qrate_' + key1).val(sanitizeNumber(qrate,2,true));
                        $('#qamt_' + key1).val(sanitizeNumber(qamt,2,true));
                        var dPer =0;
                        if (rate !=0 && qrate !=0) dPer = ((qrate-rate)/rate)*100;
                        $('#qper_' + key1).val(sanitizeNumber(dPer,2,true));

                    }
                }
            });
        });
    }
    calcBoqAmount();
}
function changeQPer(Id) {
    var key = Id.split('_')[1];
    var qper = parseFloatVal(isNullCheck($('#qper_' + key).val(),'number'));
    $('#qper_' + key).val(sanitizeNumber(qper,2,true));
    var drate = parseFloatVal(isNullCheck($('#rate_' + key).val(),'number'));
    var qqty = parseFloatVal(isNullCheck($('#qty_' + key).val(),'number'));
    var qrate = (drate*(1+(qper/100))).toFixed(2);
    $('#qrate_' + key).val(sanitizeNumber(qrate,2,true));
    var qamt = (qrate * qqty);
    $('#qamt_' + key).val(sanitizeNumber(qamt,2,true));
    calcBoqAmount();
}

function calQRate(qrateId)
{
    var qrtId = qrateId.split('_'),
        roId = qrtId[1];
    var qrate = parseFloatVal(isNullCheck($('#qrate_' + roId).val(),'number'));
    var drate = parseFloatVal(isNullCheck($('#rate_' + roId).val(),'number'));
    var qqty = parseFloatVal(isNullCheck($('#qty_' + roId).val(),'number'));
    var qamt = (qrate * qqty);
    var dPer =0;
    if (drate !=0 && qrate !=0) dPer = ((qrate-drate)/drate)*100;
    $('#qrate_' + roId).val(sanitizeNumber(qrate,2,true));
    $('#qamt_' + roId).val(sanitizeNumber(qamt,2,true));
    $('#qper_' + roId).val(sanitizeNumber(dPer,2,true));
    calcBoqAmount();
}
$('.social_profiles').hide();


var wbsListSq = [];
function showSequentialView() {
    $("#sequentialViewModal").modal('show');

    wbsListSq = getWBSMasterList(true);
    var $table = $('#sequentialViewTable tbody');
    $table.html('');
    // set iows and wbs qty
    $.each($('input[id^=parentid_]'), function (i,o) {
        var key = $(this)[0].id.split('_')[1];
        var id = isNullCheck($('#unitkeyid_'+key).val(), 'number');
        var value = isNullCheck($('#spec_'+key).val(), 'string');
        if(id == 0 || id == '' || value == '')
            return;

        var arr_qty = [];
        $.each($('input[id^=wbstable_'+key+'_wbsid_]'), function (j,obj) {
            var wbsid= isNullCheck($(this).val(),'number');
            if(wbsid == 0)
                return;

            var wbskey = $(this)[0].id.split('_')[3];
            arr_qty[wbsid] = parseFloatVal($('#wbstable_'+key+'_qty_'+wbskey).val());
        });
        var rowid =  (i + 1);
        var tbody = '<tr>'
            + '<td><input type="hidden" id="wbsSqparentid_'+ rowid +'" value="'+ id+'"/><label id="wbsSqparenttext_'+(i+1)+'">'+value+'</label></td>';
        $.each(wbsListSq, function (i,o) {
            var wbsvalue = 0;
            if(typeof arr_qty[o.data] != 'undefined')
                wbsvalue = arr_qty[o.data];

            tbody += '<td><input type="text" maxlength="15" class="parent_text" id="wbsSqqty_' + o.data+ '_' + id+ '" data-id="'+o.data+'" value="'+sanitizeNumber(wbsvalue,3)+'" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3)"/></td>';
        });
        tbody += '</tr>';
        $table.append(tbody);
    });

    // set header
    var $thead = $('#sequentialViewTable > thead > tr');
    $thead.html('<th>From Library IOW</th>');
    $.each(wbsListSq, function (i,o) {
        var name = o.value.substr(o.value.lastIndexOf('->') + 2);
        $thead.append('<th>'+name+'</th>');
    });
}
function applySequentialValues() {
    $.each(wbsListSq, function (i,o) {
        $.each($('input[id^=wbsSqqty_'+ o.data+']'), function (j,item) {
            if($(this).length != 1)
                return;

//            var parentid = $(this)[0].id.split('_')[2];
//            var $parentid = $('input[name^=parentkeyid_][value="'+parentid+'"]');
//            if($parentid.length != 1)
//                return;

            var key =  $(this)[0].id.split('_')[2];
            var $input = $('input[id^=wbstable_'+key+'_wbsid_][value="'+ o.data +'"]');
            var qty = isNullCheck($(this).val(), 'number');
            if($input.length == 0) {
                if(qty != 0) {
                    var rowid = $('#wbstable_' + key + '_rows').val();
                    var wbsname = '';
                    $.each(wbsListSq, function (l,d) {
                        if(d.data == o.data) {
                            wbsname = o.value;
                            return false;
                        }
                    });
                    $('#wbstable_'+key+'_wbsname_'+rowid).val(wbsname).trigger('change');
                    $('#wbstable_'+key+'_wbsid_'+rowid).val(o.data);
                    $('#wbstable_'+key+'_qty_'+rowid).val(sanitizeNumber(qty, 3)).trigger('change');
                }
                return;
            }

            var inputkey = $input[0].id.split('_')[3];
            var $inputqty = $('#wbstable_'+key+'_qty_'+inputkey);
            $inputqty.val(sanitizeNumber(qty, 3)).trigger('change');
        });
    });
    $('#sequentialViewModal').modal('hide');
}
function checkHeader(x) {
    var key = x.split('_')[1];
    if ($('#'+ x).is(':checked')) {
        $('#raheaderval_'+ key).val(1);
        $('#unitid_' + key).closest('td').hide();
        $('#qty_' + key).closest('td').hide();
        $('.wbsTr_' + key).closest('td').hide();
        $('#rate_' + key).closest('td').hide();
        $('#amt_' + key).closest('td').hide();
        $('#qrate_' + key).closest('td').hide();
        $('#qamt_' + key).closest('td').hide();
        $('.mainTr_' + key).hide();
        $('#spec_'+ key).closest('td').attr('colspan','8');
        $('#spec_'+ key).closest('tr').addClass('row_specheader');
        $('#libiowid_'+key).hide();
        $("label[for='lblfromiow_" + key + "']").html("");

    } else {
        $('#raheaderval_'+ key).val(0);
        $('#unitid_' + key).closest('td').show();
        $('#qty_' + key).closest('td').show();
        $('.wbsTr_' + key).closest('td').show();
        $('#rate_' + key).closest('td').show();
        $('#amt_' + key).closest('td').show();
        $('#qrate_' + key).closest('td').show();
        $('#qamt_' + key).closest('td').show();
        $('.mainTr_' + key).show();
        $('#spec_'+ key).closest('td').removeAttr('colspan');
        $('#spec_'+ key).closest('tr').removeClass('row_specheader');
        $('#libiowid_'+key).show();
        $('#lblfromiow_'+key).show();
        $("label[for='lblfromiow_" + key + "']").html("From Library IOW");
    }
}
function changeReport() {
    var iReportId = $('#reporttype').val();
    if ( iReportId==1) bindSummary();
    else if ( iReportId==2) bindWorkGroup();
    else if ( iReportId==3) bindResourceType();
    else if ( iReportId==4) bindResourceReport();
    else if ( iReportId==5) bindBOQ();
    else if ( iReportId==6) bindBOQBase();
    else if ( iReportId==7) bindBOQAll();
}

function bindSummary() {
    $('#divgrid').hide();
    $('#print').hide();
    $('#divwg').hide();
    $('#divchart').show();

    var dBaseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number')),
        dOtherCost = parseFloatVal(isNullCheck($('#otherCostAmount').val(),'number')),
        dTotalAmount = parseFloatVal(isNullCheck($('#finalAmount').val(),'number')),
        dTotalPer = 0,
        dQuoteAmt = parseFloatVal(isNullCheck($('#quotedAmount').val(),'number')),
        dBasePer= 0,
        dOtherCostPer= 0,
        dQuotePer = 0,
        dVarAmt = dQuoteAmt-dTotalAmount,
        dVarPer = 0;


    if (dTotalAmount !=0) {
        dBasePer = (dBaseAmt/dTotalAmount * 100);
        dOtherCostPer = (dOtherCost/dTotalAmount * 100);
        dTotalPer= (dTotalAmount/dTotalAmount * 100);
        dQuotePer = (dQuoteAmt/dTotalAmount)*100;
        dVarPer = (dVarAmt/dTotalAmount)*100;
    }

    var arrData=[];
    arrData.push({
        Type: 'Base Amount',
        Amount: dBaseAmt,
        TPer: dBasePer
    });
    arrData.push({
        Type: 'Other Cost Amount',
        Amount: dOtherCost,
        TPer: dOtherCostPer
    });
    arrData.push({
        Type: 'Total Base Amount',
        Amount: dTotalAmount,
        TPer: dTotalPer
    });
    arrData.push({
        Type: 'Quoted Amount',
        Amount: dQuoteAmt,
        TPer: dQuotePer
    });
    arrData.push({
        Type: 'Variance',
        Amount: dVarAmt,
        TPer: dVarPer
    });
    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'Type', type: 'string'},
            {name: 'Amount', type: 'number'},
            {name: 'TPer', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }

    $("#datagrid1").jqxGrid({
        width: "100%",
//            height: 300,
        autoheight: true,
        rowsheight: 60,
        source: rfcdata,
        pageable: false,
        sortable: true,
        altrows: true,
        enabletooltips: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'Description', datafield: 'Type', 'editable': false, width: '40%'},
            {text: 'Cost', datafield: 'Amount', 'editable': false,renderer:columnsrenderer,cellsalign: 'right', width: '40%',
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid1").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                }
            },
            {text: 'Weightage %', datafield: 'TPer', 'editable': false, width: '20%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid1").jqxGrid('getCellValue', row, 'TPer'),2) + '</div>';
                }
            }
        ]
    });
    populateChart1(arrData);
}
function populateChart1(data) {
    var chart = AmCharts.makeChart("chart1", {
        "theme": "light",
        "type": "serial",
        "dataProvider": data,
        "valueAxes": [{
            "id": "v1",
            "position": "left",
            "autoGridCount": false,
            "title": "Cost"
        },
            {
                "unit":"%",
                "id": "v2",
                "position": "right",
                "autoGridCount": false,
                "title": "%"
            }],
        "startDuration": 1,
        "graphs": [{
            "id": "g3",
            "valueAxis": "v1",
            "lineColor": "#FFA500",
            "fillColors": "#FFA500",
            "balloonText": "Cost: <b>[[value]]</b>",
            "fillAlphas": 0.9,
            "lineAlpha": 0.2,
            "title": "Cost",
            "type": "column",
            "valueField": "Amount"
        },
            {
                "id": "g1",
                "valueAxis": "v2",
                "bullet": "round",
                "bulletBorderAlpha": 1,
                "bulletColor": "#FFFFFF",
                "bulletSize": 5,
                "hideBulletsCount": 50,
                "lineThickness": 3,
                "lineColor": "#4B0082",
                "type": "smoothedLine",
                "dashLength": 5,
                "title": "Weightage %",
                "useLineColorForBulletBorder": true,
                "valueField": "TPer",
                "balloonText": "[[value]]",
                "balloonFunction": function(graphDataItem, graph) {
                    var val = sanitizeNumber(graphDataItem.values.value,0);
                    return "Weightage % :<b style='font-size: 130%'>"+val+"</b>%";
                }
            },
        ],
        "plotAreaFillAlphas": 0.1,
        pathToImages: "//cdn.amcharts.com/lib/3/images/",
        "categoryField": "Type",
        "categoryAxis": {
            "gridPosition": "start",
            "labelRotation": 20
        },
        "export": {
            "enabled": true
        },
//            "legend": {
//                "useGraphSettings": true,
//                "position": "top",
//                "valueText": ""
//            },
        "balloon": {
            "borderThickness": 1,
            "shadowAlpha": 0
        },
        "chartScrollbar": {"enabled": true},
        "chartCursor": {
            "valueLineEnabled": true,
            "valueLineBalloonEnabled": true,
            "valueLineAlpha": 0.5,
            "fullWidth": true,
            "cursorAlpha": 0.05
        }
    });
}

function bindBOQAll() {
    $('#divchart').hide();
    $('#divwg').hide();
    $('#divgrid').show();
    $('#print').show();

    var dBaseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number'));
    var dQuoteAmt = parseFloatVal(isNullCheck($('#quotedAmount').val(),'number'));
    var dVar =0;
    if (dBaseAmt !=0) dVar = ((dQuoteAmt-dBaseAmt)/dBaseAmt)*100;

    var iRows = parseInt(isNullCheck($("#rowid").val(),'number')),
        sRefNo="",sSpec="",sUnit="",dQty= 0,dRate= 0,dAmt= 0,dTotAmt= 0,dQTotAmt= 0,dPer=0;
    var arrData=[];
    for (var i = 1; i <= iRows; i++) {
        var sRefNo = isNullCheck($('#refserialno_' + i).val(),'string'),
            sSpec = isNullCheck($('#spec_' + i).val(),'string'),
            sUnit = isNullCheck($('#unitid_' + i).val(),'string'),
            dQty = parseFloatVal(isNullCheck($('#qty_' + i).val(),'number')),
            dRate = parseFloatVal(isNullCheck($('#rate_' + i).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#amt_' + i).val(),'number')),
            dQRate = parseFloatVal(isNullCheck($('#qrate_' + i).val(),'number')),
            dQAmt = parseFloatVal(isNullCheck($('#qamt_' + i).val(),'number'));
        dPer=0;
        if (dQAmt !=0 && dAmt !=0) dPer = ((dQAmt-dAmt)/dAmt)*100;

        if (sSpec !="") {
            arrData.push({
                SerialNo: sRefNo,
                Specification: sSpec,
                Unit: sUnit,
                Qty: dQty,
                Rate: dRate,
                Amount: dAmt,
                QRate: dQRate,
                QAmount: dQAmt,
                Per: dPer
            });
        }
    }

    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'SerialNo', type: 'string'},
            {name: 'Specification', type: 'string'},
            {name: 'Unit', type: 'string'},
            {name: 'Qty', type: 'number'},
            {name: 'Rate', type: 'number'},
            {name: 'Amount', type: 'number'},
            {name: 'QRate', type: 'number'},
            {name: 'QAmount', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }
    $("#datagrid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        showstatusbar: true,
        showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '8%'},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '22%'},
            {text: 'Unit', datafield: 'Unit', 'editable': false, width: '5%'},
            {text: 'Qty', datafield: 'Qty', 'editable': false, width: '8%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Qty'),3) + '</div>';
                }
            },
            {text: 'Base Rate', datafield: 'Rate', 'editable': false, width: '9%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Rate'),2,true) + '</div>';
                }
            },
            {text: 'Base Amount', datafield: 'Amount', 'editable': false, width: '15%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Quoted Rate', datafield: 'QRate', 'editable': false, width: '10%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'QRate'),2,true) + '</div>';
                }
            },
            {text: 'Quoted Amount', datafield: 'QAmount', 'editable': false, width: '15%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'QAmount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Variance %', datafield: 'Per', 'editable': false, width: '8%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Variance<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Per'),2,true) + '</div>';
                },
                aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
//                        $.each(aggregates, function (key, value) {
                    renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(dVar,2,true) +'</div>';
//                        });
                    return renderstring;
                }
            }
        ]
    });
}
function bindBOQBase() {
    $('#divchart').hide();
    $('#divwg').hide();
    $('#print').show();
    $('#divgrid').show();

    var dBaseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number'));
    var iRows = parseInt(isNullCheck($("#rowid").val(),'number')),
        sRefNo="",sSpec="",sUnit="",dQty= 0,dRate= 0,dAmt= 0,dTotAmt= 0,dQTotAmt= 0;
    var arrData=[];
    for (var i = 1; i <= iRows; i++) {
        var sRefNo = isNullCheck($('#refserialno_' + i).val(),'string'),
            sSpec = isNullCheck($('#spec_' + i).val(),'string'),
            sUnit = isNullCheck($('#unitid_' + i).val(),'string'),
            dQty = parseFloatVal(isNullCheck($('#qty_' + i).val(),'number')),
            dRate = parseFloatVal(isNullCheck($('#rate_' + i).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#amt_' + i).val(),'number'));
        dPer=0;
        if (dBaseAmt !=0) dPer = (dAmt/dBaseAmt)*100;
        if (sSpec !="") {
            arrData.push({
                SerialNo: sRefNo,
                Specification: sSpec,
                Unit: sUnit,
                Qty: dQty,
                Rate: dRate,
                Amount: dAmt,
                Per: dPer
            });
        }
    }

    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'SerialNo', type: 'string'},
            {name: 'Specification', type: 'string'},
            {name: 'Unit', type: 'string'},
            {name: 'Qty', type: 'number'},
            {name: 'Rate', type: 'number'},
            {name: 'Amount', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }
    $("#datagrid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        showstatusbar: true,
        showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '10%'},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '40%'},
            {text: 'Unit', datafield: 'Unit', 'editable': false, width: '7%'},
            {text: 'Qty', datafield: 'Qty', 'editable': false, width: '10%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Qty'),3) + '</div>';
                }
            },
            {text: 'Rate', datafield: 'Rate', 'editable': false, width: '10%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Rate'),2,true) + '</div>';
                }
            },
            {text: 'Amount', datafield: 'Amount', 'editable': false, width: '15%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Weightage %', datafield: 'Per', 'editable': false, width: '8%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Per'),2) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            }
        ]
    });
}
function bindBOQ() {
    $('#divchart').hide();
    $('#divwg').hide();
    $('#print').show();
    $('#divgrid').show();
    var dQuoteAmt = parseFloatVal(isNullCheck($('#quotedAmount').val(),'number'));
    var iRows = parseInt(isNullCheck($("#rowid").val(),'number')),
        sRefNo="",sSpec="",sUnit="",dQty= 0,dRate= 0,dAmt= 0,dTotAmt= 0,dPer= 0, dQTotAmt= 0;
    var arrData=[];
    for (var i = 1; i <= iRows; i++) {
        var sRefNo = isNullCheck($('#refserialno_' + i).val(),'string'),
            sSpec = isNullCheck($('#spec_' + i).val(),'string'),
            sUnit = isNullCheck($('#unitid_' + i).val(),'string'),
            dQty = parseFloatVal(isNullCheck($('#qty_' + i).val(),'number')),
            dRate = parseFloatVal(isNullCheck($('#qrate_' + i).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#qamt_' + i).val(),'number'));
        dPer=0;
        if (dQuoteAmt !=0) dPer = (dAmt/dQuoteAmt)*100;
        if (sSpec !="") {
            arrData.push({
                SerialNo: sRefNo,
                Specification: sSpec,
                Unit: sUnit,
                Qty: dQty,
                Rate: dRate,
                Amount: dAmt,
                Per: dPer
            });
        }
    }

    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'SerialNo', type: 'string'},
            {name: 'Specification', type: 'string'},
            {name: 'Unit', type: 'string'},
            {name: 'Qty', type: 'number'},
            {name: 'Rate', type: 'number'},
            {name: 'Amount', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }
    $("#datagrid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        showstatusbar: true,
        showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '10%'},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '40%'},
            {text: 'Unit', datafield: 'Unit', 'editable': false, width: '7%'},
            {text: 'Qty', datafield: 'Qty', 'editable': false, width: '10%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Qty'),3) + '</div>';
                }
            },
            {text: 'Rate', datafield: 'Rate', 'editable': false, width: '10%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Rate'),2,true) + '</div>';
                }
            },
            {text: 'Amount', datafield: 'Amount', 'editable': false, width: '15%', cellsalign: 'right',renderer:columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Weightage %', datafield: 'Per', 'editable': false, width: '8%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Per'),2) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
        ]
    });
}
function showDataSheet() {
    $('#reporttype').val(1).prop('selected', true).trigger('change');
//    bindSummary();
    $('#datamodal').modal('show');
}
function bindResourceReport() {
    $('#divchart').hide();
    $('#divwg').hide();
    $('#print').show();
    $('#divgrid').show();

    var dTotAmt = parseFloat(isNullCheck($('#restotalamt').val(),'number'));
//        if (dTotAmt==0) return;

    var arrData=[];
    var $codes = $('input[id^=rateresid_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sResName = isNullCheck($('#rateresname_' + key).val(),'string'),
            sUnit = isNullCheck($('#rateresunit_' + key).val(),'string'),
            dQty = parseFloatVal(isNullCheck($('#rateresqty_' + key).val(),'number')),
            dRate = parseFloatVal(isNullCheck($('#rateresrate_' + key).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#rateresamt_' + key).val(),'number')),
            dPer=0;
        if (dTotAmt !=0) dPer = (dAmt/dTotAmt)*100;
        if (sResName !="") {
            arrData.push({
                ResourceName: sResName,
                Unit: sUnit,
                Qty: dQty,
                Rate: dRate,
                Amount: dAmt,
                Per: dPer
            });
        }
    });

    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'ResourceName', type: 'string'},
            {name: 'Unit', type: 'string'},
            {name: 'Qty', type: 'number'},
            {name: 'Rate', type: 'number'},
            {name: 'Amount', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }
    $("#datagrid").jqxGrid({
        width: "100%",
        height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        showstatusbar: true,
        showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'Resource', datafield: 'ResourceName', 'editable': false, width: '45%'},
            {text: 'Unit', datafield: 'Unit', 'editable': false, width: '10%'},
            {text: 'Qty', datafield: 'Qty', 'editable': false, width: '10%', cellsalign: 'right',renderer: columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Qty'),3) + '</div>';
                }
            },
            {text: 'Rate', datafield: 'Rate', 'editable': false, width: '10%', cellsalign: 'right',renderer: columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Rate'),2,true) + '</div>';
                }
            },
            {text: 'Amount', datafield: 'Amount', 'editable': false, width: '15%', cellsalign: 'right',renderer: columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Weightage %', datafield: 'Per', 'editable': false, width: '10%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid").jqxGrid('getCellValue', row, 'Per'),2) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            }
        ]
    });
}
function bindResourceType() {
    $('#divgrid').hide();
    $('#divwg').hide();
    $('#print').hide();
    $('#divchart').show();

    var dTotAmt = parseFloat(isNullCheck($('#restotalamt').val(),'number'));
    var arrData=[];
    var $codes = $('input[id^=rateresid_]');
    $.each($codes, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var iResTypeId = parseInt(isNullCheck($('#ratetypeid_' + key).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#rateresamt_' + key).val(),'number')),
            sResType = 'None';
        if (iResTypeId==1) sResType='Labour';
        else if (iResTypeId==2) sResType='Material';
        else if (iResTypeId==3) sResType='Asset';
        else if (iResTypeId==4) sResType='Activity';
        var bFound=false,dCAmt=0;

        for (var k=0;k<arrData.length;k++) {
            if (arrData[k]['ResourceType'] == sResType) {
                dCAmt = parseFloatVal(isNullCheck(arrData[k]['Amount'],'number'));
                arrData[k]['Amount'] = dAmt+dCAmt;
                bFound=true;
                break;
            }
        }

        if (bFound==false) {
            arrData.push({
                ResourceType: sResType,
                Amount: dAmt,
                Per: 0
            });
        }
    });

    for (var k=0;k<arrData.length;k++) {
        var dPer=0;
        dCAmt = parseFloatVal(isNullCheck(arrData[k]['Amount'],'number'));
        if (dTotAmt !=0) dPer = (dCAmt/dTotAmt)*100;
        arrData[k]['Per'] = dPer;
    }

    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'ResourceType', type: 'string'},
            {name: 'Amount', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }

    $("#datagrid1").jqxGrid({
        width: "100%",
        autoheight: true,
        rowsheight: 60,
        source: rfcdata,
        pageable: false,
        sortable: true,
        altrows: true,
        showstatusbar: true,
        showaggregates: true,
        enabletooltips: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'ResourceType', datafield: 'ResourceType', 'editable': false, width: '40%'},
            {text: 'Cost', datafield: 'Amount', 'editable': false,renderer:columnsrenderer,cellsalign: 'right', width: '40%',
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid1").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Weightage %', datafield: 'Per', 'editable': false, width: '20%', renderer:columnsrenderer,cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid1").jqxGrid('getCellValue', row, 'Per'),2) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            }
        ]
    });
    populateChart2(arrData);
}

function populateChart2(data) {
    var chart = AmCharts.makeChart("chart1", {
        "type": "pie",
        "theme": "light",
        "dataProvider": data,
        "valueField": "Amount",
        "titleField": "ResourceType",
        "radius": "30%",
        "innerRadius": "60%",
        "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
        "export": {
            "enabled": true
        }
    });

}
function bindWorkGroup() {
    $('#divgrid').hide();
    $('#print').hide();
    $('#divchart').hide();
    $('#divwg').show();

//        var dBaseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number'));

    var dBaseAmt = parseFloatVal(isNullCheck($('#baseAmount').val(),'number'));
    var dOtherCost = parseFloatVal(isNullCheck($('#otherCostAmount').val(),'number'));
    var dQuoteAmt = parseFloatVal(isNullCheck($('#quotedAmount').val(),'number'));
    var dTotAmt = dBaseAmt+dOtherCost;
    var dVar =0;
    if (dTotAmt !=0) dVar = ((dQuoteAmt-dTotAmt)/dTotAmt)*100;

    var iRows = parseInt(isNullCheck($("#rowid").val(),'number')),
        sRefNo="",sSpec="",sUnit="",dQty= 0,dRate= 0,dAmt= 0,dTotAmt= 0,dQTotAmt= 0;
    var arrData=[];
    for (var i = 1; i <= iRows; i++) {
        var sWGName = isNullCheck($('#pworkgroupname_' + i).val(),'string'),
            dAmt = parseFloatVal(isNullCheck($('#amt_' + i).val(),'number')),
            dQAmt = parseFloatVal(isNullCheck($('#qamt_' + i).val(),'number'));

        if (sWGName !="") {
            var bFound = false, dCAmt = 0, dCQAmt = 0;

            for (var k = 0; k < arrData.length; k++) {
                if (arrData[k]['WorkGroup'] == sWGName) {
                    dCAmt = parseFloatVal(isNullCheck(arrData[k]['Amount'], 'number'));
                    dCQAmt = parseFloatVal(isNullCheck(arrData[k]['QAmount'], 'number'));
                    arrData[k]['Amount'] = dAmt + dCAmt;
                    arrData[k]['QAmount'] = dQAmt + dCQAmt;
                    bFound = true;
                    break;
                }
            }

            if (bFound == false) {
                arrData.push({
                    WorkGroup: sWGName,
                    Amount: dAmt,
                    QAmount: dQAmt,
                    QPer: 0,
                    Per: 0
                });
            }
        }
    }



    if (dOtherCost !=0) {
        arrData.push({
            WorkGroup: 'Other Cost',
            Amount: dOtherCost,
            QAmount: 0,
            QPer: 0,
            Per: 0
        });
    }

    for (var k=0;k<arrData.length;k++) {
        var dPer= 0,dQPer=0;
        dCAmt = parseFloatVal(isNullCheck(arrData[k]['Amount'],'number'));
        dCQAmt = parseFloatVal(isNullCheck(arrData[k]['QAmount'],'number'));
        if (dCAmt !=0) dPer = ((dCQAmt-dCAmt)/dCAmt)*100;
        if (dQuoteAmt !=0) dQPer = (dCQAmt/dQuoteAmt)*100;
        arrData[k]['Per'] = dQPer;
        arrData[k]['QPer'] = dPer;
    }


    var rfcsource =
    {
        async: false,
        dataType: "json",
        localdata: arrData,
        dataFields: [
            {name: 'WorkGroup', type: 'string'},
            {name: 'Amount', type: 'number'},
            {name: 'QAmount', type: 'number'},
            {name: 'QPer', type: 'number'},
            {name: 'Per', type: 'number'}
        ]
    };
    var rfcdata = new $.jqx.dataAdapter(rfcsource);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }

    $("#datagrid2").jqxGrid({
        width: "100%",
        autoheight: false,
        height: 200,
        rowsheight: 30,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        showstatusbar: true,
        showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'WorkGroup', datafield: 'WorkGroup', 'editable': false, width: '40%'},
            {text: 'Base Amount', datafield: 'Amount', 'editable': false, width: '20%', cellsalign: 'right',renderer: columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid2").jqxGrid('getCellValue', row, 'Amount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Quoted Amount', datafield: 'QAmount', 'editable': false, width: '20%', cellsalign: 'right',renderer: columnsrenderer,
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid2").jqxGrid('getCellValue', row, 'QAmount'),2,true) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            },
            {text: 'Variance %', datafield: 'QPer', 'editable': false, width: '10%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Variance<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid2").jqxGrid('getCellValue', row, 'QPer'),2,true) + '</div>';
                }, aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(dVar,2,true) +'</div>';
                    return renderstring;
                }
            },
            {text: 'Weightage %', datafield: 'Per', 'editable': false, width: '10%', cellsalign: 'right',
                renderer: function (defaultText, alignment, height) {
                    return '<div style="margin: 3px 0 0 3px;text-align: right;">Weightage<br>%</div>';
                },
                cellsrenderer: function (row) {
                    return '<div class="text-right" style="overflow: hidden; text-overflow: ellipsis; margin-right: 2px; margin-left: 10px; margin-top: 9.5px;">' + sanitizeNumber($("#datagrid2").jqxGrid('getCellValue', row, 'Per'),2) + '</div>';
                },aggregates: ['sum'],
                aggregatesrenderer: function (aggregates) {
                    var renderstring = "";
                    $.each(aggregates, function (key, value) {
                        renderstring += '<div style="position: relative; margin: 4px; font-size:13px;padding:5px;font-weight:bold; overflow: hidden;">'+ sanitizeNumber(value,2,true) +'</div>';
                    });
                    return renderstring;
                }
            }
        ]
    });
    populateChart3(arrData);
}
function populateChart3(data) {
    var chart = AmCharts.makeChart("chart2", {
        "theme": "light",
        "type": "serial",
        "dataProvider": data,
        "valueAxes": [{
            "id": "v1",
            "position": "left",
            "autoGridCount": false,
            "title": "Cost"
        },
            {
                "unit":"%",
                "id": "v2",
                "position": "right",
                "autoGridCount": false,
                "title": "%"
            }],
        "startDuration": 1,
        "graphs": [{
            "id": "g3",
            "valueAxis": "v1",
            "lineColor": "#FFA500",
            "fillColors": "#FFA500",
            "balloonText": "Base Cost: <b>[[value]]</b>",
            "fillAlphas": 0.9,
            "lineAlpha": 0.2,
            "title": "BaseCost",
            "type": "column",
            "valueField": "Amount"
        },{
            "id": "g4",
            "valueAxis": "v1",
            "balloonText": "Quoted Cost : <b>[[value]]</b>",
            "fillAlphas": 0.9,
            "lineAlpha": 0.2,
            "lineColor": "#228B22",
            "fillColors": "#228B22",
            "title": "QuotedCost",
            "type": "column",
            "clustered":false,
            "columnWidth":0.5,
            "valueField": "QAmount"
        },
            {
                "id": "g1",
                "valueAxis": "v2",
                "bullet": "round",
                "bulletBorderAlpha": 1,
                "bulletColor": "#FFFFFF",
                "bulletSize": 5,
                "hideBulletsCount": 50,
                "lineThickness": 3,
                "lineColor": "#4B0082",
                "type": "smoothedLine",
                "dashLength": 5,
                "title": "Weightage %",
                "useLineColorForBulletBorder": true,
                "valueField": "Per",
                "balloonText": "[[value]]",
                "balloonFunction": function(graphDataItem, graph) {
                    var val = sanitizeNumber(graphDataItem.values.value,0);
                    return "Weightage % :<b style='font-size: 130%'>"+val+"</b>%";
                }
            },
            {
                "id": "g2",
                "valueAxis": "v2",
                "bullet": "round",
                "bulletBorderAlpha": 1,
                "bulletColor": "#FFFFFF",
                "bulletSize": 5,
                "hideBulletsCount": 50,
                "lineThickness": 3,
                "lineColor": "#FF0000",
                "type": "smoothedLine",
                "title": "Variance %",
                "useLineColorForBulletBorder": true,
                "valueField": "QPer",
                "balloonText": "[[value]]",
                "balloonFunction": function(graphDataItem, graph) {
                    var val = sanitizeNumber(graphDataItem.values.value,0);
                    return "Variance % :<b style='font-size: 130%'>"+val+"</b>%";
                }
            }
        ],
        "plotAreaFillAlphas": 0.1,
        pathToImages: "//cdn.amcharts.com/lib/3/images/",
        "categoryField": "WorkGroup",
        "categoryAxis": {
            "gridPosition": "start",
            "labelRotation": 20
        },
        "export": {
            "enabled": true
        },
        "legend": {
            "useGraphSettings": true,
            "position": "top",
            "valueText": ""
        },
        "balloon": {
            "borderThickness": 1,
            "shadowAlpha": 0
        },
        "chartScrollbar": {"enabled": true},
        "chartCursor": {
            "valueLineEnabled": true,
            "valueLineBalloonEnabled": true,
            "valueLineAlpha": 0.5,
            "fullWidth": true,
            "cursorAlpha": 0.05
        }
    });
}
function showFaceSheet() {
    var sHtml ="",
        iRows = parseInt(isNullCheck($("#rowid").val(),'number')),
        sRefNo="",sSpec="",sUnit="",dQty= 0,dRate= 0,dAmt= 0,dTotAmt= 0,dQTotAmt= 0;
    for (var i = 1; i <= iRows; i++) {
        var sRefNo = isNullCheck($('#refserialno_' + i).val(),'string'),
            sSpec = isNullCheck($('#spec_' + i).val(),'string'),
            sUnit = isNullCheck($('#unitid_' + i).val(),'string'),
            dQty = parseFloatVal(isNullCheck($('#qty_' + i).val(),'number')),
            dRate = parseFloatVal(isNullCheck($('#rate_' + i).val(),'number')),
            dAmt = parseFloatVal(isNullCheck($('#amt_' + i).val(),'number')),
            dQRate = parseFloatVal(isNullCheck($('#qrate_' + i).val(),'number')),
            dQAmt = parseFloatVal(isNullCheck($('#qamt_' + i).val(),'number'));

        if (sSpec !=0) {
            dTotAmt = dTotAmt + dAmt;
            dQTotAmt = dQTotAmt + dQAmt;

            sHtml = sHtml + '<tr> \
                <td width="3%"><input class="parent_text bor-non" type="text" value="' + sRefNo + '" readonly/></td> \
                <td width="15%"><p class="parent_text max-min-height bor-non">' + sSpec +'</p></td> \
                <td width="3%"><input class="parent_text bor-non" type="text" value="' + sUnit + '" readonly /></td> \
                <td width="5%"><input class="parent_text text-right bor-non" type="text" value="' + sanitizeNumber(dQty, 3) + '" readonly /></td> \
                <td width="5%"><input class="parent_text text-right bor-non" type="text" value="' + sanitizeNumber(dRate, 2, true) + '" readonly /></td> \
                <td width="6%"><input class="parent_text text-right bor-non" type="text" value="' + sanitizeNumber(dAmt, 2, true) + '" readonly /> </td> \
                <td width="5%"><input class="parent_text text-right bor-non" type="text" value="' + sanitizeNumber(dQRate, 2, true) + '" readonly /></td> \
                <td width="6%"><input class="parent_text text-right bor-non" type="text" value="' + sanitizeNumber(dQAmt, 2, true) + '" readonly /> </td> \
                </tr>';
        }
    }
    $('#facetotal').val(sanitizeNumber(dTotAmt,2,true));
    $('#faceqtotal').val(sanitizeNumber(dQTotAmt,2,true));
    $('#facebody').empty();
    $('#facebody').html(sHtml);
    $('#facemodal').modal('show');
}
function showIOWMaster() {
    bindIOWGrid();
    $("#iowmodal").modal('show');
}
function getIOWMaster() {
    arrIOWlist = [];
    if (arrIOWlist.length == 0) {
        var iquotationid = parseInt(isNullCheck($('#quotationId').val(), 'number'));
        $.ajax({
            url: getBaseURL() + "project/tender/getiowMaster",
            async: false,
            data: {'QuotationId': iquotationid},
            type: 'post',
            success: function (data, status) {
                arrIOWlist = jQuery.parseJSON(data);
            }
        });
    }
}
function bindIOWGrid() {
    getIOWMaster();
    var source = {
        localdata:arrIOWlist,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'IOWId', type: 'number'},
            { name: 'WorkGroupId', type: 'number'},
            { name: 'WorkTypeId', type: 'number'},
            { name: 'SerialNo', type: 'string'},
            { name: 'WorkGroupName', type: 'string'},
            { name: 'WorkTypeName', type: 'string'},
            { name: 'Specification', type: 'string'},
            { name: 'Header', type: 'number'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'IOWId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);
    var columnsrenderer = function (value) {
        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
    }

    $("#iowtree").jqxGrid({
        width: "100%",
//    height: 436,
        rowsheight: 35,
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
//    showstatusbar: true,
//    showaggregates: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'IOWId', datafield: 'IOWId', hidden: true},
            {text: 'WorkGroupId', datafield: 'WorkGroupId', hidden: true},
            {text: 'WorkTypeId', datafield: 'WorkTypeId', hidden: true},
            {text: 'WorkTypeName', datafield: 'WorkTypeName', hidden: true},
            {text: 'Header', datafield: 'Header', hidden: true},
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '15%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowtree").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowtree").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowtree").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    return slNo;
                }},
            {text: 'WorkGroup', datafield: 'WorkGroupName', 'editable': false, width: '20%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowtree").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowtree").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowtree").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    return slNo;
                }},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '55%',cellsrenderer: function (row) {
                var iHeader = $("#iowtree").jqxGrid('getcellvalue', row, "Header"),spec="";
                if (iHeader ==1)  spec = '<div style="font-size:13px; font-weight:600;">' + $("#iowtree").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                else spec ='<div style="font-size:12px;">' + $("#iowtree").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                return spec;
            }},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%',
                cellbeginedit: function (row) {
                    var iHeader = $("#iowtree").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader==1) return false;
                    else return true;
                }
            }
        ]
    });
}
function selectedIOWUpdate() {
    //var item = $('#iowtree').jqxTree('getSelectedItem');
    $('.loading_area').show();
    var rows = $('#iowtree').jqxGrid('getrows'),key1= 0,iIOWId= 0,sSpec="",sSlNo="",iWorkTypeId= 0,iWorkGroupId= 0,sWorkTypeName='',sWorkGroupName='';
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            iIOWId = rows[i]['IOWId'];
            iWorkTypeId = rows[i]['WorkTypeId'];
            iWorkGroupId = rows[i]['WorkGroupId'];
            sWorkGroupName = rows[i]['WorkGroupName'];
            sWorkTypeName = rows[i]['WorkTypeName'];
            sSlNo = rows[i]['SerialNo'];
            sSpec = rows[i]['Specification'];
            sSpec = sSlNo + '   ' + sSpec;
            key1 =  parseInt(isNullCheck($('#rowid').val(),'number'));
            $("#libiowid_"+ key1).val(sSpec);
            $("#libiowkeyid_"+ key1).val(iIOWId);
            GetIOWDetails(iIOWId,"#libiowkeyid_"+ key1);
            $("#libiowid_"+ key1).prop("readonly",true);
            AddNewRowA("#libiowkeyid_"+ key1,false);
            bindParentWorkGroup('parentid_'+key1,sWorkGroupName,iWorkGroupId,iWorkTypeId,sWorkTypeName);
        }
    }
    bindTRDeleteFn();
    $('#iowmodal').modal('toggle');
    $('.loading_area').hide();
}
function bindParentWorkGroup(id,workgroupname,workgroupid,worktypeid,worktypename) {
    var name = id,
        key1 =  name.split('_')[1];
    var objR = $.grep(arryparentList, function (element, index) {
        return element.worktypeid== worktypeid;
    });

    if (objR.length==0) {
        addNewAutoWorkGroup(id,workgroupname,workgroupid,worktypeid,worktypename);
        objR = $.grep(arryparentList, function (element, index) {
            return element.worktypeid== worktypeid;
        });
    } else if (objR.length==1) {
        $("#parentkeyid_"+ key1).val(objR[0]['data']);
        $("#parentid_"+ key1).val(objR[0]['value']);
        $("#worktypeid_"+ key1).val(objR[0]['worktypeid']);
        $("#workgroupid_"+ key1).val(objR[0]['workgroupid']);
        $("#pworkgroupid_"+ key1).val(objR[0]['pworkgroupid']);
        $('#pworkgroupname_'+ key1).val(objR[0]['workgroupname']);
        $("#piowid_"+ key1).val(objR[0]['iowid']);
        $("#newparentname_"+ key1).val(objR[0]['parentname']);

        $('#'+id).val('');
        $('#'+id).removeClass('error');
        $('#'+id).val(objR[0]['value']);
    }


    $('#'+id).unbind('autocomplete');
    $('#'+id).autocomplete({
        lookup: objR,
        showNoSuggestionNotice:true,
        noSuggestionNotice: 'Do you want to Create New <input type="button" font-weight:bold" name="newprojworkgroup_'+ key1  +'" class="btn btn-link" id="newprojworkgroup_'+ key1 +'" value="Project WorkGroup" onclick="return AddNewWorkGroup('+name+')">',
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $("#parentkeyid_"+ key1).val(suggestion.data);
                $("#worktypeid_"+ key1).val(suggestion.worktypeid);
                $("#workgroupid_"+ key1).val(suggestion.workgroupid);
                $("#pworkgroupid_"+ key1).val(suggestion.pworkgroupid);
                $("#pworkgroupname_"+ key1).val(suggestion.workgroupname);
                $("#piowid_"+ key1).val(suggestion.iowid);
                $("#newparentname_"+ key1).val(suggestion.parentname);

//                    CheckParentValid('parentid_'+key1);
//                    GetWorkTypeDetails(suggestion.worktypeid,"parentid_"+ key1);
//                    bindLibraryIOW(suggestion.worktypeid,"libiowid_"+ key1)
                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $("#parentkeyid_"+ key1).val(0);
            $("#workgroupid_"+ key1).val(0);
            $("#pworkgroupid_"+ key1).val(0);
            $("#pworkgroupname_"+ key1).val('');
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $("#parentkeyid_"+ key1).val(0);
                $("#workgroupid_"+ key1).val(0);
                $("#pworkgroupid_"+ key1).val(0);
                $("#pworkgroupname_"+ key1).val('');
            } else
                $(this).removeClass('error');
        }
    });
}
function addNewAutoWorkGroup(id,workgroupname,workgroupid,worktypeid,worktypename) {
    var irow = 0;

    var irows =  parseInt(isNullCheck($('#newwgowid').val(),'number'));
    irow = +irows+1;
    if ($('#newwgname_'+irow).val() !="") {
        var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
        $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
    }
    $('#newwgowid').val(irow);

    $('#newwgslno_'+ irow).val('');
    $('#newwgname_'+ irow).val(workgroupname);
    $('#newlwgname_'+ irow).val(workgroupname);
    $('#newlwgid_'+ irow).val(workgroupid);
    $('#newwgtype_'+ irow).val(worktypename);
    $('#newwgtypeid_'+ irow).val(worktypeid);

    $('#newitems').show();
    $('#butnewitems').html("New Work Group Created : <i class='fa fa-long-arrow-right'></i> <span class='badge'> " + irow + "</span>").show();

    var sWid = "0." + irow;
    var sWGName = workgroupname;
    var sWSpec = 'New.' + irow + '   ' + sWGName;
    arryparentList.push({
        data: sWid,
        value: sWSpec,
        worktypeid: worktypeid,
        workgroupid: workgroupid,
        pworkgroupid: 0,
        iowid: 0,
        workgroupname: sWGName,
        parentname: ''
    });

    var key = id.split('_');
    $('#pworkgroupname_'+ key[1]).val(sWGName);
    $('#worktypeid_'+ key[1]).val(worktypeid);
    $('#worktypename'+ key[1]).val(worktypename);
    $("#workgroupid_"+ key[1]).val(workgroupid);
    $("#pworkgroupid_"+ key[1]).val(0);
    $("#piowid_"+ key[1]).val(0);
    $("#newparentname_"+ key[1]).val('');
    $('#'+id).val('');
    $('#'+id).removeClass('error');
    $('#'+id).val(sWSpec);

}
$("#print").click(function () {
    var repName =$("#reporttype option:selected").text();
    var gridContent = $("#datagrid").jqxGrid('exportdata', 'html');
    var newWindow = window.open('', '', 'width=800, height=500'),
        document = newWindow.document.open(),
        pageContent =
            '<!DOCTYPE html>\n' +
            '<html>\n' +
            '<head>\n' +
            '<meta charset="utf-8" />\n' +
            '<title>'+repName+'</title>\n' +
            '<h1>'+repName+'</h1>\n' +
            '</head>\n' +
            '<body>\n' + gridContent + '\n</body>\n</html>';
    document.write(pageContent);
    document.close();
    newWindow.print();

    /*$("#jqxgrid").jqxGrid('exportdata', 'html', 'jqxGrid', true, null, false);*/
});

function showQualifier() {
    bindQualWorkGroup();
    $("#qualifiermodal").modal('show');
}
function changeQual() {
    var iQId = $('#qualtype').val();
    if (iQId==1) $("#divworkgroup").hide();
    else if (iQId==2) $("#divworkgroup").show();
}
function bindQualWorkGroup() {
    var strWgw = '<table class="table" style="margin-bottom:0px;">';
    var arrWG = [];
    $proj_workgroups = $('input[id^=pworkgroupname_]');
    var iRow=0;
    $.each($proj_workgroups, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        var wogName = $("#pworkgroupname_" + key1).val();
        if(wogName != '' && wogName != undefined) {
            if($.inArray(wogName, arrWG) == -1) {
                iRow = +iRow+1;
                strWgw += '<tr>';
                strWgw += '<td><input type="checkbox" name="" value ="" id="inpqualchk_' + iRow + '" class="ripple"/></td>';
                strWgw += '<td><label style="margin-bottom: 10px; padding-top:5px;" class="col-lg-6 col-md-6 col-sm-6">' + wogName + '</label></td>';
                strWgw += '<input type="hidden" name="inpWgw_' + iRow + '" value="' + wogName + '" id="inpWgw_' + iRow + '" />';
                strWgw += '</tr>';
                arrWG.push(wogName);
            }
        }
    });
    strWgw += '</table>';
    $("#divworkgroup").html(strWgw);
}

function applyQualifier() {
    var iQWId = $('#qualtype').val();

    if (iQWId==2) {
        var arrWG = [];
        $.each($('input[id^=inpWgw_]'), function (i, o) {
            var keys = $(this)[0].id.split('_'),
                key = keys[1];
            if ($('#inpqualchk_' + key).is(':checked')) {
                var wogName = $('#inpWgw_' + key).val();
                arrWG.push(wogName);
            }

        });
    }

    var $resnames = $('input[id*=QualG_1_Id_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = $(this)[0].id.split('_')[3];

        var yesNo = $('#QualG_1_YesNo_' + key).is(':checked'),
            qualid = $('#QualG_1_Id_' + key).val(),
            typeid = $('#QualG_1_TypeId_' + key).val(),
            sExp = $('#QualG_1_Exp_' + key).val(),
            dExpPer = $('#QualG_1_ExpPer_' + key).val();

        var taxablePer= 0,
            taxPer= 0,
            cessPer= 0,
            EducessPer= 0,
            HEducessPer= 0,
            kkcessPer= 0,
            sbcessPer= 0,
            netPer= 0;

        if (typeid ==1) {
            taxablePer= $('#QualG_1_TaxablePer_' + key).val(),
                taxPer= $('#QualG_1_TaxPer_' + key).val(),
                cessPer= $('#QualG_1_CessPer_' + key).val(),
                EducessPer= $('#QualG_1_EduCessPer_' + key).val(),
                HEducessPer= $('#QualG_1_HEduCessPer_' + key).val(),
                netPer= $('#QualG_1_NetPer_' + key).val();
        }

        if (typeid ==2) {
            taxablePer= $('#QualG_1_TaxablePer_' + key).val(),
                taxPer= $('#QualG_1_TaxPer_' + key).val(),
                kkcessPer= $('#QualG_1_KKCessPer_' + key).val(),
                sbcessPer= $('#QualG_1_SBCessPer_' + key).val(),
                netPer= $('#QualG_1_NetPer_' + key).val();
        }

        var rows = $('tr[id*=IOWiRowId_]');
        $.each(rows, function() {
            var id = $(this)[0].id;
            if (id.indexOf('__') != -1 || id.indexOf('excel') != -1) return;
            var irow = id.split("_")[1];
            var wogName = $("#pworkgroupname_" + irow).val();
            if (iQWId ==2) { if($.inArray(wogName, arrWG) == -1) return; }
            var $qualnames = $('input[id*=Qual_' + irow +'_Id_]');
            $.each($qualnames, function (i, obj) {
                var qkey = $(this)[0].id.split('_')[3];
                if  (qualid == $('#Qual_' + irow + '_Id_' + qkey).val()) {
                    if (yesNo==true) $('#Qual_' + irow + '_YesNo_' + qkey).prop('checked',true);
                    else $('#Qual_' + irow + '_YesNo_' + qkey).prop('checked',false);
                    $('#Qual_' + irow + '_Exp_' + qkey).val(sExp);
                    $('#Qual_' + irow + '_ExpPer_' + qkey).val(sanitizeNumber(dExpPer,2));
                    if (typeid ==1) {
                        $('#Qual_' + irow + '_TaxablePer_' + qkey).val(sanitizeNumber(taxablePer,2));
                        $('#Qual_' + irow + '_TaxPer_' + qkey).val(sanitizeNumber(taxPer,2));
                        $('#Qual_' + irow + '_CessPer_' + qkey).val(sanitizeNumber(cessPer,2));
                        $('#Qual_' + irow + '_EduCessPer_' + qkey).val(sanitizeNumber(EducessPer,2));
                        $('#Qual_' + irow + '_HEduCessPer_' + qkey).val(sanitizeNumber(HEducessPer,2));
                    }

                    if (typeid ==2) {
                        $('#Qual_' + irow + '_TaxablePer_' + qkey).val(sanitizeNumber(taxablePer,2));
                        $('#Qual_' + irow + '_TaxPer_' + qkey).val(sanitizeNumber(taxPer,2));
                        $('#Qual_' + irow + '_KKCessPer_' + qkey).val(sanitizeNumber(kkcessPer,2));
                        $('#Qual_' + irow + '_SBCessPer_' + qkey).val(sanitizeNumber(sbcessPer,2));
                    }
                    CalculateTax($(this)[0].id);
                    return;
                }
            });
            var $qualnames = $('input[id*=QualR_' + irow +'_Id_]');
            $.each($qualnames, function (i, obj) {
                var qkey = $(this)[0].id.split('_')[3];
                if  (qualid == $('#QualR_' + irow + '_Id_' + qkey).val()) {
                    if (yesNo==true) $('#QualR_' + irow + '_YesNo_' + qkey).prop(':checked',true);
                    else $('#QualR_' + irow + '_YesNo_' + qkey).prop(':checked',false);
                    $('#QualR_' + irow + '_Exp_' + qkey).val(sExp);
                    $('#QualR_' + irow + '_ExpPer_' + qkey).val(sanitizeNumber(dExpPer,2));

                    if (typeid ==1) {
                        $('#QualR_' + irow + '_TaxablePer_' + qkey).val(sanitizeNumber(taxablePer,2));
                        $('#QualR_' + irow + '_TaxPer_' + qkey).val(sanitizeNumber(taxPer,2));
                        $('#QualR_' + irow + '_CessPer_' + qkey).val(sanitizeNumber(cessPer,2));
                        $('#QualR_' + irow + '_EduCessPer_' + qkey).val(sanitizeNumber(EducessPer,2));
                        $('#QualR_' + irow + '_HEduCessPer_' + qkey).val(sanitizeNumber(HEducessPer,2));
                    }

                    if (typeid ==2) {
                        $('#QualR_' + irow + '_TaxablePer_' + qkey).val(sanitizeNumber(taxablePer,2));
                        $('#QualR_' + irow + '_TaxPer_' + qkey).val(sanitizeNumber(taxPer,2));
                        $('#QualR_' + irow + '_KKCessPer_' + qkey).val(sanitizeNumber(kkcessPer,2));
                        $('#QualR_' + irow + '_SBCessPer_' + qkey).val(sanitizeNumber(sbcessPer,2));
                    }

                    CalculateTax($(this)[0].id);
                    return;
                }
            });
        });
    });
}

//Excel Import

function checkExcelResource() {
    var excelRes=[];
    var excelUnit=[];
    var excelWG=[];
    var excelWBS=[];

    //Resource
    $('#excelresTable tr:gt(1)').remove();
    $("#excelresresource_1").val('');
    $("#excelresoldresource_1").val('');
    $("#excelresresgroup_1").val('');
    $("#excelresunit_1").val('');
    $("#excelrestype_1").val('');
    $("#excelresmaterialtype_1").val('G');

    $("#excelreswunit_1").val('');
    $("#excelresold_1").val(0);
    $("#excelresunitid_1").val(0);
    $("#excelresresgroupid_1").val(0);
    $("#excelresrestypeid_1").val(0);
    $("#excelreswunitid_1").val(0);

    //Unit
    $('#excelunitTable tr:gt(1)').remove();
    $("#excelununit_1").val('');
    $("#excelrefunit_1").val('');
    $("#excelrefunitid_1").val(0);

    //Workgroup
    $('#excelwgTable tr:gt(1)').remove();
    $("#excelunworkgroup_1").val('');
    $("#excelrefworkgroup_1").val('');
    $("#excelrefworktype_1").val('');
    $("#excelrefworkgroupid_1").val(0);
    $("#excelrefworktypeid_1").val(0);


    var irow=1;
    var iUrow=1;
    var iWGrow=1;
    var iWBSrow=1;
    var $resnames = $('input[id*=excelspec_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];
        var sRowType = isNullCheck($('#excelrowtype_'+ key).val(),'string');

        if (sRowType =="R") {
            var iResId = parseInt(isNullCheck($('#excelresid_'+key).val(),'number'));
            if (iResId ==0) {
                var sResName = isNullCheck($('#excelspec_'+key).val(),'string');
                if($.inArray(sResName, excelRes) == -1) {
                    excelRes.push(sResName);
                    if (irow !=1) {
                        $("#excelresTable tbody tr:last").after('<tr>' + $("#excelresTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelresTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace("_1", "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace("_1", "_" + irow));
                        });
                    }
                    $("#excelresresource_" + irow).val(sResName);
                    irow = +irow + 1;
                }
            } else  {
//                $(this).closest('tr').css('color','#228B22');
                $(this).closest('tr').addClass('excelvalid');
                $(this).closest('tr').find("input").attr("readonly", "readonly");
            }
            $('#excelrowid_' + key).addClass('excel4');
            $('#excellibref_'+ key).hide();
            $('#excelparent_'+key).hide();
        } else if (sRowType =="I") {
            var sUnit = isNullCheck($('#excelunit_' + key).val(), 'string');
            if (sUnit != "") {
                var iUnitId = parseInt(isNullCheck($('#excelunitid_' + key).val(), 'number'));
                if (iUnitId == 0) {
                    if ($.inArray(sUnit, excelUnit) == -1) {
                        excelUnit.push(sUnit);
                        if (iUrow != 1) {
                            $("#excelunitTable tbody tr:last").after('<tr>' + $("#excelunitTable tbody tr:first").html() + "</tr>");
                            var $tr = $("#excelunitTable tbody tr:last");
                            $tr.find("input").each(function () {
                                $(this).attr("id", $(this).attr("id").replace("_1", "_" + iUrow));
                            });
                        }
                        $("#excelununit_" + iUrow).val(sUnit);
                        iUrow = +iUrow + 1;
                    }
                }
            }
            $('#excelrowid_' + key).addClass('excel3');
        } else if (sRowType =="H") {
            var iWGId = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));
            if (iWGId !=0) {
                var iWGTypeId =parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                var sSlNo = isNullCheck($('#excelserialno_' + key).val(), 'string');
                var sSpec = isNullCheck($('#excelspec_' + key).val(), 'string');
                var iworktypeid = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));;
                var iworkgroupid = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                var sworkgroupname = isNullCheck($('#excelnewworkgroupname_' + key).val(), 'string');
                var ipiowid = parseInt(isNullCheck($('#excelparentid_' + key).val(), 'number'));;
                var arryHeader =[];
                arryHeader.push({
                    SlNo: sSlNo,
                    Spec: sSpec,
                    WorkTypeId: iworktypeid,
                    WorkGroupId: iworkgroupid,
                    WorkGroupName: sworkgroupname,
                    PIOWId: ipiowid
                });
                excelHeaderUpdatetoMain(arryHeader);
            }
            $('#excelrowid_' + key).addClass('excel2');
            $('#excellibref_'+ key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        } else if (sRowType =="WG") {
            var sWGName =isNullCheck($('#excelspec_' + key).val(),'string');
            if (sWGName !="") {
                var iWGId = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));
                if (iWGId == 0) {
                    if ($.inArray(sWGName, excelWG) == -1) {
                        excelWG.push(sWGName);
                        if (iWGrow != 1) {
                            $("#excelwgTable tbody tr:last").after('<tr>' + $("#excelwgTable tbody tr:first").html() + "</tr>");
                            var $tr = $("#excelwgTable tbody tr:last");
                            $tr.find("input").each(function () {
                                $(this).attr("id", $(this).attr("id").replace("_1", "_" + iWGrow));
                            });
                        }
                        $("#excelunworkgroup_" + iWGrow).val(sWGName);
                        iWGrow = +iWGrow + 1;
                    }

                }
            }
            $('#excelrowid_' + key).addClass('excel1');
            $('#excellibref_'+ key).hide();
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        } else if (sRowType =="WBS") {
            var sWBSName =isNullCheck($('#excelspec_' + key).val(),'string');
            if (sWBSName !="") {
                var iWBSId = parseInt(isNullCheck($('#excelwbsid_' + key).val(), 'number'));
                if (iWBSId == 0) {
                    if ($.inArray(sWBSName, excelWBS) == -1) {
                        excelWBS.push(sWBSName);
                        if (iWBSrow != 1) {
                            $("#excelwbsTable tbody tr:last").after('<tr>' + $("#excelwbsTable tbody tr:first").html() + "</tr>");
                            var $tr = $("#excelwbsTable tbody tr:last");
                            $tr.find("input").each(function () {
                                $(this).attr("id", $(this).attr("id").replace("_1", "_" + iWBSrow));
                            });
                        }
                        $("#excelunwbs_" + iWBSrow).val(sWBSName);
                        iWBSrow = +iWBSrow + 1;
                    }

                }
            }
            $('#excelrowid_' + key).addClass('excel3');
            $('#excellibref_'+ key).hide();
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        }
    });
    bexcelUnitFound =false;
    bexcelResFound =false;
    bexcelWGFound=false;
    bexcelWBSFound=false;
    if (excelRes.length >0) { bexcelResFound =true; bindExcelResAutoComplete(); }
    if (excelUnit.length >0) { bexcelUnitFound=true; bindExcelUnitAutoComplete(); }
    if (excelWG.length >0) { bexcelWGFound=true; bindExcelWGAutoComplete(); }
    if (excelWBS.length >0) { bexcelWBSFound =true; bindExcelWBSAutoComplete();}

//    if (bexcelResFound ==true) { $('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divunittable').hide(); $('#divrestable').show(); }
//    else if (bexcelUnitFound==true) {$('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divrestable').hide(); $('#divunittable').show();  }
//    else { $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();}
}

function bindExcelWBSAutoComplete() {
    getWBSMaster();
    getWBSMasterList();
    arrExcelWBS = arraywbslist;

    var $wbsids = $('input[id*=excelrefwbs_]');
    $wbsids.unbind('autocomplete');
    $.each($wbsids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;

        if (name.indexOf('__') != -1)
            return;

        var arrname = name.split('_'),
            key1 = arrname[1];
        $this.autocomplete({
            lookup: arrExcelWBS,
            multiselect:true,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') {
                    return suggestion.value;
                }
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }

            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#excelrefwbsid_' + key1).val(suggestion.data);
                    $('#excelrefwbsparentid_' + key1).val(suggestion.ParentId);
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length && query.length > 1){
                    $(this).addClass('error');
                    $('#excelrefwbsid_' + key1).val(0);
                    $('#excelrefwbsparentid_' + key1).val(0);
                }
                else
                {
                    $(this).removeClass('error');
                }
            }
        });
    });
}

function bindExcelUnitAutoComplete() {
    $unitids = $('input[id*=excelrefunit_]');
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
}
function bindExcelWGAutoComplete() {
    $workgroupids = $('input[id*=excelrefworkgroup_]');
    $.each($workgroupids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayworkgroup,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefworkgroupid_" + key1).val(suggestion.data);
                    $("#excelrefworktype_" + key1).val(suggestion.WorkType);
                    $("#excelrefworktypeid_" + key1).val(suggestion.WorkTypeId);
                    $("#excelrefworktype_" + key1).prop('readonly',true);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefworkgroupid_" + key1).val(0);
                $("#excelrefworktypeid_" + key1).val(0);
                $("#excelrefworktype_" + key1).val('');
                $("#excelrefworktype_" + key1).prop('readonly',false);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefworkgroupid_" + key1).val(0);
                    $("#excelrefworktypeid_" + key1).val(0);
                    $("#excelrefworktype_" + key1).val('');
                    $("#excelrefworktype_" + key1).prop('readonly',false);
                } else $(this).removeClass('error');
            }
        });
    });

    $workgrouptypeids = $('input[id*=excelrefworktype_]');
    $.each($workgrouptypeids , function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayworktype,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelrefworktypeid_" + key1).val(suggestion.data);
                    $("#excelrefworkgroup_" + key1).prop('readonly',true);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelrefworktypeid_" + key1).val(0);
                $("#excelrefworkgroup_" + key1).prop('readonly',false);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelrefworktypeid_" + key1).val(0);
                    $("#excelrefworkgroup_" + key1).prop('readonly',false);
                } else $(this).removeClass('error');
            }
        });
    });
}
function checkExcelWBSFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkExcelWBSUsed();
    var $resname = $('#' + x);
    bindExcelWBSRowAutoComplete($resname);
}
function checkExcelWBSUsed() {
    var excelresids = $('input[id*=excelrefwbsid_]');
    arrExcelWBS = arraywbslist;
    arrExcelWBS = $.grep(arraywbslist, function (element, index) {
        var is_selected = true;
        $.each(excelresids, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (element.data == $this.val()) is_selected = false;
        });
        return is_selected;
    });
}
function bindExcelWBSRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1];
    $this.unbind('autocomplete');
    $this.autocomplete({
        lookup: arrExcelWBS,
        multiselect:true,
        showNoSuggestionNotice:false,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') {
                return suggestion.value;
            }
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }

        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#excelrefwbsid_' + key1).val(suggestion.data);
                $('#excelrefwbsparentid_' + key1).val(suggestion.ParentId);
                $(this).removeClass('error');
            }
        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length && query.length > 1){
                $(this).addClass('error');
                $('#excelrefwbsid_' + key1).val(0);
                $('#excelrefwbsparentid_' + key1).val(0);
            }
            else
            {
                $(this).removeClass('error');
            }
        }
    });
}
function checkExcelResourceFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkExcelResourceUsed();
    var $resname = $('#' + x);
    bindExcelResRowAutoComplete($resname);
}
function checkExcelResourceUsed() {
    var excelresids = $('input[id*=excelresold_]');
    arrexcelresourceR = arrexcelresource;
    arrexcelresourceR = $.grep(arrexcelresource, function (element, index) {
        var is_selected = true;
        $.each(excelresids, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (element.data == $this.val()) is_selected = false;
        });
        return is_selected;
    });
}

function bindExcelResRowAutoComplete(x) {
    var $this = $(x),
        name = $this[0].id,
        arr_names = name.split('_');
    if (name.indexOf('__') != -1) return;
    var key1 = arr_names[1];
    $this.unbind('autocomplete');
    $this.autocomplete({
        lookup: arrexcelresourceR,
        showNoSuggestionNotice:false,
        lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase =='*') return suggestion.value;
            else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        },
        onSelect: function(suggestion) {
            if(suggestion) {
                $('#excelresold_' + key1).val(suggestion.data);
                $('#excelresresgroup_'+ key1).val(suggestion.ResourceGroupName);
                $('#excelresresgroupid_'+ key1).val(suggestion.ResourceGroupId);
                $('#excelrestype_'+ key1).val(suggestion.TypeName);
                $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);
                $('#excelresunit_'+ key1).val(suggestion.UnitName);
                $('#excelwresunit_'+ key1).val(suggestion.WorkUnit);
                $('#excelresunitid_'+ key1).val(suggestion.UnitId);
                $('#excelwresunitid_'+ key1).val(suggestion.WorkUnitId);
                var sMatType = $.trim(isNullCheck(suggestion.MaterialType,'string'));
                if (sMatType =="") sMatType ="G";
                $('#excelresmaterialtype_' + key1).val(sMatType).prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).show();
                $('#excelrestype_' + key1).show();

                if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                else $('#excelresmaterialtype_' + key1).hide();

                if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                else $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',true);
                $('#excelresunit_'+ key1).prop('readonly',true);
                $('#excelresmaterialtype_'+ key1).prop('readonly',true);
                $('#excelreswunit_'+ key1).prop('readonly',true);
                $('#excelresmaterialtype_'+ key1).prop('disabled',true);

                if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');

                $(this).removeClass('error');
            }
        },
        onSearchStart: function(suggestion) {
            $('#excelresold_' + key1).val(0);
            $('#excelresresgroup_'+ key1).val('');
            $('#excelresresgroupid_'+ key1).val(0);
            $('#excelrestype_'+ key1).val('');
            $('#excelresrestypeid_'+ key1).val(0);
            $('#excelresunit_'+ key1).val('');
            $('#excelwresunit_'+ key1).val('');
            $('#excelresunitid_'+ key1).val(0);
            $('#excelwresunitid_'+ key1).val(0);
            $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

            $('#excelresunit_' + key1).hide();
            $('#excelrestype_' + key1).hide();
            $('#excelresmaterialtype_' + key1).hide();
            $('#excelreswunit_' + key1).hide();

            $('#excelresresgroup_'+ key1).prop('readonly',false);
            $('#excelresunit_'+ key1).prop('readonly',false);
            $('#excelresmaterialtype_'+ key1).prop('readonly',false);
            $('#excelreswunit_'+ key1).prop('readonly',false);
            $('#excelresmaterialtype_'+ key1).prop('disabled',false);

        },
        onSearchComplete: function (query, suggestions) {
            if(!suggestions.length){
                $(this).addClass('error');
                $('#excelresold_' + key1).val(0);
                $('#excelresresgroup_'+ key1).val('');
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresunit_'+ key1).val('');
                $('#excelwresunit_'+ key1).val('');
                $('#excelresunitid_'+ key1).val(0);
                $('#excelwresunitid_'+ key1).val(0);
                $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',false);
                $('#excelresunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                $('#excelreswunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('disabled',false);
            } else $(this).removeClass('error');
        }
    });
}
function bindExcelResAutoComplete() {
    $unitids = $('input[id*=excelresunit_]');
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelresunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelresunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#excelresunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
    $wunitids = $('input[id*=excelreswunit_]');
    $.each($wunitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arraywunitlist,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelreswunitid_" + key1).val(suggestion.data);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelreswunitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#execelreswunitid_" + key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
    $excelresgroupids = $('input[id*=excelresresgroup_]');
    $.each($excelresgroupids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrexcelresgroup,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#excelresresgroupid_'+ key1).val(suggestion.data);
                    $('#excelrestype_'+ key1).val(suggestion.TypeName);
                    $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);

                    $('#excelresunit_' + key1).show();
                    $('#excelrestype_' + key1).show();

                    if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                    else $('#excelresmaterialtype_' + key1).hide();

                    if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                    else $('#excelreswunit_' + key1).hide();

                    if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $('#excelresrestypeid_'+ key1).val(0);
                    $('#excelresresgroupid_'+ key1).val(0);
                    $('#excelrestype_'+ key1).val('');
                    $('#excelresunit_' + key1).hide();
                    $('#excelrestype_' + key1).hide();
                    $('#excelresmaterialtype_' + key1).hide();
                    $('#excelreswunit_' + key1).hide();
                } else $(this).removeClass('error');
            }
        });
    });

    $excelresids = $('input[id*=excelresoldresource_]');
    $.each($excelresids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrexcelresourceR,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $('#excelresold_' + key1).val(suggestion.data);
                    $('#excelresresgroup_'+ key1).val(suggestion.ResourceGroupName);
                    $('#excelresresgroupid_'+ key1).val(suggestion.ResourceGroupId);
                    $('#excelrestype_'+ key1).val(suggestion.TypeName);
                    $('#excelresrestypeid_'+ key1).val(suggestion.TypeId);
                    $('#excelresunit_'+ key1).val(suggestion.UnitName);
                    $('#excelwresunit_'+ key1).val(suggestion.WorkUnit);
                    $('#excelresunitid_'+ key1).val(suggestion.UnitId);
                    $('#excelwresunitid_'+ key1).val(suggestion.WorkUnitId);
                    var sMatType = $.trim(isNullCheck(suggestion.MaterialType,'string'));
                    if (sMatType =="") sMatType ="G";
                    $('#excelresmaterialtype_' + key1).val(sMatType).prop('selected', true).trigger('change');

                    $('#excelresunit_' + key1).show();
                    $('#excelrestype_' + key1).show();

                    if (suggestion.TypeId ==2) $('#excelresmaterialtype_' + key1).show();
                    else $('#excelresmaterialtype_' + key1).hide();

                    if (suggestion.TypeId ==3) $('#excelreswunit_' + key1).show();
                    else $('#excelreswunit_' + key1).hide();

                    $('#excelresresgroup_'+ key1).prop('readonly',true);
                    $('#excelresunit_'+ key1).prop('readonly',true);
                    $('#excelresmaterialtype_'+ key1).prop('readonly',true);
                    $('#excelreswunit_'+ key1).prop('readonly',true);
                    $('#excelresmaterialtype_'+ key1).prop('disabled',true);

                    if (suggestion.TypeId !=0) $('#excelrestype_'+ key1).removeClass('error');

                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $('#excelresold_' + key1).val(0);
                $('#excelresresgroup_'+ key1).val('');
                $('#excelresresgroupid_'+ key1).val(0);
                $('#excelrestype_'+ key1).val('');
                $('#excelresrestypeid_'+ key1).val(0);
                $('#excelresunit_'+ key1).val('');
                $('#excelwresunit_'+ key1).val('');
                $('#excelresunitid_'+ key1).val(0);
                $('#excelwresunitid_'+ key1).val(0);
                $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                $('#excelresunit_' + key1).hide();
                $('#excelrestype_' + key1).hide();
                $('#excelresmaterialtype_' + key1).hide();
                $('#excelreswunit_' + key1).hide();

                $('#excelresresgroup_'+ key1).prop('readonly',false);
                $('#excelresunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                $('#excelreswunit_'+ key1).prop('readonly',false);
                $('#excelresmaterialtype_'+ key1).prop('disabled',false);

            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $('#excelresold_' + key1).val(0);
                    $('#excelresresgroup_'+ key1).val('');
                    $('#excelresresgroupid_'+ key1).val(0);
                    $('#excelrestype_'+ key1).val('');
                    $('#excelresrestypeid_'+ key1).val(0);
                    $('#excelresunit_'+ key1).val('');
                    $('#excelwresunit_'+ key1).val('');
                    $('#excelresunitid_'+ key1).val(0);
                    $('#excelwresunitid_'+ key1).val(0);
                    $('#excelresmaterialtype_' + key1).val("G").prop('selected', true).trigger('change');

                    $('#excelresunit_' + key1).hide();
                    $('#excelrestype_' + key1).hide();
                    $('#excelresmaterialtype_' + key1).hide();
                    $('#excelreswunit_' + key1).hide();

                    $('#excelresresgroup_'+ key1).prop('readonly',false);
                    $('#excelresunit_'+ key1).prop('readonly',false);
                    $('#excelresmaterialtype_'+ key1).prop('readonly',false);
                    $('#excelreswunit_'+ key1).prop('readonly',false);
                    $('#excelresmaterialtype_'+ key1).prop('disabled',false);
                } else $(this).removeClass('error');
            }
        });
    });
}
function validateexcelUnWG() {
    var bValid = true;
    var $resnames = $('input[id*=excelunworkgroup_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1],
            iWGId =  parseInt(isNullCheck($('#excelrefunitid_' + key).val(),'number')),
            iWGTypeId =  parseInt(isNullCheck($('#excelrefworktypeid_' + key).val(),'number'));

        if (iWGTypeId==0) {
            bValid = false;
            showError($('#excelrefworktype_' + key), 'Required');
        }
    });
    if (bValid ==false) return bValid;
    applyWGtoIOW();
    return bValid;
}
function validateexcelUnWBS() {
    var bValid = true;
    var $resnames = $('input[id*=excelrefwbs_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1],
            iWBSId =  parseInt(isNullCheck($('#excelrefwbsid_' + key).val(),'number')),
            iWBSParentId =  parseInt(isNullCheck($('#excelrefwbsparentid_' + key).val(),'number'));

        if (iWBSId==0) {
            bValid = false;
            showError($('#excelrefwbs_' + key), 'Required');
        }
    });
    if (bValid ==false) return bValid;
    applyWBStoIOW();
    return bValid;
}
function bindexcelParentAutoComplete() {
    var $parent_ids = $('input[id*=excelparent_]');
    $parent_ids.unbind('autocomplete');
    $.each($parent_ids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key1 =  name.split('_')[1];
        $this.autocomplete({
            lookup: arryparentList,
            showNoSuggestionNotice:false,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    $("#excelparentid_"+ key1).val(suggestion.data);
                    $("#excelwgtypeid_"+ key1).val(suggestion.worktypeid);
                    $("#excelwgid_"+ key1).val(suggestion.workgroupid);
//                    $("#piowid_"+ key1).val(suggestion.iowid);
                    $("#excelparentspec_"+ key1).val(suggestion.parentname);
//                    CheckParentValid('parentid_'+key1);
                    $(this).removeClass('error');
                }
            },
            onSearchStart: function(suggestion) {
                $("#excelparentid_"+ key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                    $("#parentkeyid_"+ key1).val(0);
                } else $(this).removeClass('error');
            }
        });
    });
}
function nextexcelunit() {
    var bValid = true;
    var $resnames = $('input[id*=excelununit_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1],
            iUnitId =  parseInt(isNullCheck($('#excelrefunitid_' + key).val(),'number'));
        if (iUnitId ==0) {
            bValid = false;
            showError($('#excelrefunit_' + key), 'Required');
        }
    });
    if (bValid ==false) return bValid;
    applyunittoIOW();
    return bValid;

//    $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();
}
function nextexcelresource() {
    var bValid = true;
    var $resnames = $('input[id*=excelresresource_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var ioldResId = parseInt(isNullCheck($('#excelresold_' + key).val(),'number')),
            iUnitId = parseInt(isNullCheck($('#excelresunitid_' + key).val(),'number')),
            iWUnitId = parseInt(isNullCheck($('#excelreswunitid_' + key).val(),'number')),
            iresgroupId = parseInt(isNullCheck($('#excelresresgroupid_' + key).val(),'number')),
            smattype = isNullCheck($('#excelresmaterialtype_' + key).val(),'string'),
            irestypeid = parseInt(isNullCheck($('#excelresrestypeid_' + key).val(),'number'));

        if (ioldResId ==0) {
            if (iresgroupId ==0) {
                bValid = false;
                showError($('#excelresresgroup_' + key), 'Required');
            }
            if (irestypeid ==0) {
                bValid = false;
                showError($('#excelrestype_' + key), 'Required');
            }
            if (iUnitId ==0) {
                bValid = false;
                showError($('#excelresunit_' + key), 'Required');
            }
            if (irestypeid ==2) {
                if (smattype =="") {
                    bValid = false;
                    showError($('#excelresmaterialtype_' + key), 'Required');
                }
            }
            if (irestypeid ==3) {
                if (iWUnitId ==0) {
                    bValid = false;
                    showError($('#excelreswunit_' + key), 'Required');
                }
            }
        }
    });
    if (bValid ==false) return bValid;
    applyresourcetoIOW();
    return bValid;

//    if (bexcelUnitFound==true) {$('#diviowtable').hide(); $('#divexcelapply').hide(); $('#divrestable').hide(); $('#divunittable').show();  }
//    else { $('#divrestable').hide(); $('#divunittable').hide(); $('#diviowtable').show(); $('#divexcelapply').show();}
}
function applyWBStoIOW() {
    var $resnames = $('input[id*=excelunwbs_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sWBSName =isNullCheck($('#excelunwbs_' + key).val(), 'string'),
            sNewWBSName =isNullCheck($('#excelrefwbs_' + key).val(), 'string'),
            iWBSId = parseInt(isNullCheck($('#excelrefwbsid_' + key).val(), 'number'));

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            var sRowType = isNullCheck($('#excelrowtype_' + irow).val(), 'string');
            if (sRowType == "WBS") {
                var sIOWWBS = isNullCheck($('#excelspec_' + irow).val(), 'string'),
                    iIOWWBSId = parseInt(isNullCheck($('#excelwbsid_'+irow).val(),'number'));
                if (iIOWWBSId == 0) {
                    if (sIOWWBS == sWBSName) {
                        $("#excelspec_" + irow).val(sNewWBSName);
                        $('#excelwbsid_' + irow).val(iWBSId);
                    }
                }
            }
        });
    });
}
function applyWGtoIOW() {
    var $resnames = $('input[id*=excelunworkgroup_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sWGName =isNullCheck($('#excelunworkgroup_' + key).val(), 'string'),
            sNewWGName =isNullCheck($('#excelrefworkgroup_' + key).val(), 'string'),
            iWGId = parseInt(isNullCheck($('#excelrefworkgroupid_' + key).val(), 'number')),
            sWGType = parseInt(isNullCheck($('#excelrefworktype_' + key).val(), 'string')),
            iWGTypeId = parseInt(isNullCheck($('#excelrefworktypeid_' + key).val(), 'number'));

        var arrWG=[];
        if (iWGId ==0) {
            arrWG.push({
                SlNo: '',
                WGName: sWGName,
                WGType: sWGType,
                iWGTypeId: iWGTypeId
            });

            var arrResNew =[];
            arrResNew = excelWGUpdateToMain(arrWG);

            iWGId =  arrResNew[0]['data'];
            sNewWGName =  arrResNew[0]['value'];
        }

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            var sRowType = isNullCheck($('#excelrowtype_' + irow).val(), 'string');
            if (sRowType == "WG") {
                var sIOWWG = isNullCheck($('#excelspec_' + irow).val(), 'string'),
                    iIOWWGId = parseInt(isNullCheck($('#excelwgid_'+irow).val(),'number'));
                if (iIOWWGId == 0) {
                    if (sIOWWG == sWGName) {
                        $("#excelspec_" + irow).val(sNewWGName);
                        $('#excelwgid_' + irow).val(iWGId);
                        $('#excelwgtypeid_' + irow).val(iWGTypeId);
                        $('#excelnewworkgroupname_' + irow).val(sWGName);
                        $("#excelspec_" + irow).removeClass('error');
                    }
                }
            } else if (sRowType == "I" || sRowType=='H') {
                var sIOWParent = isNullCheck($('#excelparent_' + irow).val(), 'string'),
                    iIOWWGId = parseInt(isNullCheck($('#excelwgid_'+irow).val(),'number'));
                if (iIOWWGId == 0) {
                    if (sIOWParent == sWGName) {
                        $("#excelparent_" + irow).val(sNewWGName);
                        $('#excelwgid_' + irow).val(iWGId);
                        $('#excelwgtypeid_' + irow).val(iWGTypeId);
                        $('#excelnewworkgroupname_' + irow).val(sWGName);
                        $("#excelparent_" + irow).removeClass('error');
                    }
                    if (sRowType =='H') {
                        var sSlNo = isNullCheck($('#excelserialno_' + key).val(), 'string');
                        var sSpec = isNullCheck($('#excelspec_' + key).val(), 'string');
                        var iworktypeid = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));;
                        var iworkgroupid = parseInt(isNullCheck($('#excelwgid_' + key).val(), 'number'));;
                        var sworkgroupname = isNullCheck($('#excelnewworkgroupname_' + key).val(), 'string');
                        var ipiowid = parseInt(isNullCheck($('#excelparentid_' + key).val(), 'number'));;
                        var arryHeader =[];
                        arryHeader.push({
                            SlNo: sSlNo,
                            Spec: sSpec,
                            WorkTypeId: iworktypeid,
                            WorkGroupId: iworkgroupid,
                            WorkGroupName: sworkgroupname,
                            PIOWId: ipiowid
                        });
                        excelHeaderUpdatetoMain(arryHeader);
                    }
                }
            }
        });
    });
}
function binExcelLibrary() {
    var $resnames = $('input[id*=excelspec_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];
        var sRowType = isNullCheck($('#excelrowtype_' + key).val(), 'string');
        if (sRowType=="I") {
            var iRow =+key+1;
            if(typeof $('#excelrowtype_' + iRow) != 'undefined') {
                var sNextRowType = isNullCheck($('#excelrowtype_' + iRow).val(), 'string');
                if (sNextRowType !== "R") {
                    var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));
                    if (iWGTypeId != 0) { $('#excellibref_' + key).show(); $('#excellibref_' + key).prop('readonly',false); bindExcelLibraryIOW(iWGTypeId, 'excellibref_' + key); }
                }
            } else {
                var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_' + key).val(), 'number'));
                if (iWGTypeId != 0) { $('#excellibref_' + key).show(); $('#excellibref_' + key).prop('readonly',false); bindExcelLibraryIOW(iWGTypeId, 'excellibref_' + key); }
            }
        }
    })
}
function bindExcelLibraryIOW(ival,x) {
    $('#'+x).unbind('autocomplete');
    var key1 =  x.split('_')[1];
    $.ajax({
        url: getBaseURL() + "project/rfc/getlibraryiow",
        async: false,
        type: 'post',
        data: {resId: ival},
        success: function (data, status) {
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];
            $('#' + x).autocomplete({
                lookup: objT,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    }
                    else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                },
                onSelect: function (suggestion) {
                    if (suggestion) {
                        $("#exceliowid_" + key1).val(suggestion.data);
//                        GetIOWDetails(suggestion.data, "parentkeyid_" + key1)
//                        AddNewRowA("#parentkeyid_" + key1, true);
                        $(this).removeClass('error');
                    }
                },
                onSearchStart: function (suggestion) {
                    $("#exceliowid_" + key1).val(0);
                },
                onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length && query.length > 1) {
                        $(this).addClass('error');
                        $("#exceliowid_" + key1).val(0);
                    } else
                        $(this).removeClass('error');
                }
            });
        }

    });
}
function applyunittoIOW() {
    var $resnames = $('input[id*=excelununit_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var sUnit =isNullCheck($('#excelununit_' + key).val(), 'string'),
            sNewUnit =isNullCheck($('#excelrefunit_' + key).val(), 'string'),
            iUnitId = parseInt(isNullCheck($('#excelrefunitid_' + key).val(), 'number'));

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            if (isNullCheck($('#excelrowtype_' + irow).val(), 'string') == "I") {
                var sIOWUnit = isNullCheck($('#excelunit_' + irow).val(), 'string'),
                    iIOWUnitId = parseInt(isNullCheck($('#excelunitid_'+irow).val(),'number'));
                if (iIOWUnitId == 0) {
                    if (sIOWUnit == sUnit) {
                        $("#excelunit_" + irow).val(sNewUnit);
                        $('#excelunitid_' + irow).val(iUnitId);
                        $("#excelunit_" + irow).removeClass('error');
//                        $(this).closest('tr').css('color','#228B22');
//                        $(this).closest('tr').find("input").attr("readonly", "readonly");
                    }
                }
            }
        });
    });
}
function applyresourcetoIOW() {
    var $resnames = $('input[id*=excelresresource_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];

        var snewResName ='',
            sresName = isNullCheck($('#excelresresource_' + key).val(), 'string'),
            ioldResId = parseInt(isNullCheck($('#excelresold_' + key).val(), 'number')),
            soldResName =  isNullCheck($('#excelresoldresource_' + key).val(),'string'),
            iUnitId = parseInt(isNullCheck($('#excelresunitid_' + key).val(), 'number')),
            iWUnitId = parseInt(isNullCheck($('#excelreswunitid_' + key).val(), 'number')),
            sUnit = isNullCheck($('#excelresunit_' + key).val(), 'string'),
            sWUnit = isNullCheck($('#excelreswunit_' + key).val(), 'string'),
            iresgroupId = parseInt(isNullCheck($('#excelresresgroupid_' + key).val(), 'number')),
            sresgroup= isNullCheck($('#excelresresgroup_' + key).val(), 'string'),
            smattype = isNullCheck($('#excelresmaterialtype_' + key).val(), 'string'),
            srestype = isNullCheck($('#excelrestype_' + key).val(), 'string'),
            irestypeid = parseInt(isNullCheck($('#excelresrestypeid_' + key).val(), 'number'));

        var arrRes=[];
        if (ioldResId ==0) {
            arrRes.push({
                resname: sresName,
                resgroupid: iresgroupId,
                resgroup: sresgroup,
                resunit: sUnit,
                resunitid: iUnitId ,
                wresunit: sWUnit,
                wresunitid: iWUnitId,
                restypeid: irestypeid,
                restype: srestype,
                resrate: 0,
                wresrate: 0,
                reslead: 0,
                resmattype: smattype,
                rescode: ''
            });

            var arrResNew =[];
            arrResNew = excelResourceUpdateToMain(arrRes);

            ioldResId =  arrResNew[0]['data'];
            snewResName =  arrResNew[0]['value'];
        } else {
            snewResName =soldResName;
        }

        var $resspecnames = $('input[id*=excelspec_]');
        $.each($resspecnames, function (i, obj) {
            var name = $(this)[0].id;
            if (name.indexOf('__') != -1) return;
            var irow = name.split('_')[1];
            if (isNullCheck($('#excelrowtype_' + irow).val(), 'string') == "R") {
                var sIOWResName = isNullCheck($('#excelspec_' + irow).val(), 'string'),
                    iResId = parseInt(isNullCheck($('#excelresid_'+irow).val(),'number'));
                if (iResId == 0) {
                    if (sIOWResName == sresName) {
                        $("#excelresid_" + irow).val(ioldResId);
                        $('#excelnewresspec_' + irow).val(snewResName);
//                        $('#excelcode_' + irow).val('');
//                        $('#excelcode_' + irow).removeClass('error');
                        $("#excelrestypeid_" + irow).val(irestypeid);
                        if (irestypeid ==3) { $('#excelunit_' + irow).val(sWUnit) ; $("#excelunitid_" + irow).val(iWUnitId); }
                        else { $('#excelunit_' + irow).val(sUnit); $("#excelunitid_" + irow).val(iUnitId); }
//                        $(this).closest('tr').css('color','#228B22');
                        $(this).closest('tr').addClass('excelvalid');
                        $(this).closest('tr').find("input").attr("readonly", "readonly");
                    }
                }
            }
        });
    });
}
function excelHeaderUpdatetoMain(argHeader) {

    var sSlNo = argHeader['SlNo'];
    var sSpec = argHeader['Spec'];
    var iworktypeid = argHeader['WorkTypeId'];
    var iworkgroupid = argHeader['WorkGroupId'];
    var sworkgroupname = argHeader['WorkGroupName'];
    var ipiowid = argHeader['PIOWId'];

    var sWid = "0." + sSlNo;
    var sWSpec = 'New.' + sSlNo + '   ' + sSpec;
    var sparentname = sSpec;

    arryparentList.push({
        data: sWid,
        value: sWSpec,
        worktypeid: iworktypeid,
        workgroupid: iworkgroupid,
        iowid: ipiowid,
        workgroupname: sworkgroupname,
        parentname: sparentname
    });

    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function excelWGUpdateToMain(arrWG) {

    var sWGSlNo = arrWG[0]['SlNo'],
        sWGName= arrWG[0]['WGName'],
        sWGType= arrWG[0]['WGType'],
        iWGTypeId= arrWG[0]['WGTypeId'];

    var irow = 0;
    var irows =  parseInt(isNullCheck($('#newwgowid').val(),'number'));
    irow = +irows+1;
    if ($('#newwgname_'+irow).val() !="") {
        var html = $("#newwg tbody tr:first").html().replace(/_1/g, '_' + irow);
        $("#newwg tbody tr:last").after("<tr>" + html + "</tr>");
    }
    $('#newwgowid').val(irow);

    $('#newwgnameslno_'+ irow).val(sWGSlNo);
    $('#newwgname_'+ irow).val(sWGName);
    $('#newwgtypename_'+ irow).val(sWGType);
    $('#newwgid_'+ irow).val(iWGTypeId);
    $('#newwgrateanal_'+ irow).val(0);
    $('#newitems').show();
    $('#butnewitems').html("New Work Group Created" + "<span class='badge'> " + irow + "</span>").show();
    var sWid = "0." + irow;
    var iworktypeid = $('#worktype_id').val();
    var sWSpec = 'New.' + irow + '   ' + sWGName;
    arryparentList.push({
        data: sWid,
        value: sWSpec,
        worktypeid: iWGTypeId,
        workgroupid: 0,
        workgroupname: sWGName,
        iowid: 0,
        parentname: ''
    });

    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function excelResourceUpdateToMain(arrRes) {

    var resname = arrRes[0]['resname'],
        resgroupid = arrRes[0]['resgroupid'],
        resgroup = arrRes[0]['resgroup'],
        resunit = arrRes[0]['resunit'],
        resunitid = arrRes[0]['resunitid'],
        wresunit = arrRes[0]['wresunit'],
        wresunitid = arrRes[0]['wresunitid'],
        restype = arrRes[0]['restype'],
        restypeid= arrRes[0]['restypeid'],
        resrate = arrRes[0]['resrate'],
        wresrate = arrRes[0]['wresrate'],
        reslead = arrRes[0]['reslead'],
        resmattype = arrRes[0]['resmattype'],
        rescode = arrRes[0]['rescode'];
    var irow = 0;
    var irows =  parseInt(isNullCheck($('#newresrowid').val(),'number'));
    irow = +irows+1;
    if ($('#newresname_'+irow).val() !="") {
        var html = $("#newres tbody tr:first").html().replace(/_1/g, '_' + irow);
        $("#newres tbody tr:last").after("<tr>" + html + "</tr>");
    }
    $('#newresrowid').val(irow);

    $('#newrowrefid_'+irow).val(irow);
    $('#newrescode_'+ irow).val(rescode);
    $('#newresname_'+ irow).val(resname);
    $('#newresgroup_'+ irow).val(resgroup);
    $('#newresgroupid_'+ irow).val(resgroupid);
    $('#newrestype_'+ irow).val(restype);
    $('#newrestypeid_'+ irow).val(restypeid);
    $('#newresunit_'+ irow).val(resunit);
    $('#newresunitid_'+ irow).val(resunitid);
    $('#newwresunit_'+ irow).val(wresunit);
    $('#newwresunitid_'+ irow).val(wresunitid);
    $('#newresrate_'+ irow).val(resrate);
    $('#newwresrate_'+ irow).val(wresrate);
    $('#newresmattype_'+ irow).val(resmattype);
    $('#newreslead_'+ irow).val(reslead);
    $('#newresitems').show();
    $('#butnewresitems').html("New Resource Created" + "<span class='badge' style='border-radius:none!important;'> " + irow + "</span>").show();
    var sWid = "0." + irow;
    var sWSpec = 'R ' + 'New.' + irow + ' ' + resname;
    var sUnit =resunit,iUnitId=resunitid;
    if (restypeid==3) {
        sUnit =wresunit;
        iUnitId=wresunitid;
        resrate=wresrate;
    }

    arrayreslist.push({
        id: sWid,
        value: sWSpec,
        UnitName: sUnit,
        UnitId: iUnitId,
        Rate: resrate,
        data: {category:'Resource'}
    });

    var arrResNew =[];
    arrResNew.push({
        data: sWid,
        value: sWSpec
    });
    return arrResNew;
}
function rowTypeValidation() {
    var bValid=true;
    var $resnames = $('input[id*=excelrowtype_]');
    $.each($resnames, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        var key = name.split('_')[1];
        validRowType(name);
        if ($('#' + name).hasClass('error')) {
            bValid = false;
            return;
        }
        var sRowType = $.trim(isNullCheck($('#' + name).val(), 'string'));
        if (sRowType == "R") {
            var iResId = parseInt(isNullCheck($('#excelresid_' + key).val(), 'number'));
            if (iResId == 0) {
                var sResName = isNullCheck($('#excelspec_' + key).val(), 'string');
                var arrResNew = [];
                arrResNew = getResourceDetails(sResName);
                if (arrResNew.length > 0) {
                    $('#excelunit_' + key).val(arrResNew[0]['Unit']);
                    $('#excelunitid_' + key).val(arrResNew[0]['UnitId']);
                    $('#excelresid_' + key).val(arrResNew[0]['ResourceId']);
                    $('#excelrestypeid_' + key).val(arrResNew[0]['TypeId'])
                }
            }
            $('#excelrowid_' + key).addClass('excel4');
            $('#excellibref_' + key).hide();
            $('#excelparent_' + key).hide();
        } else if (sRowType =="I") {
            $('#excelrowid_' + key).addClass('excel3');
        }else if (sRowType =="WG") {
            $('#excelrowid_' + key).addClass('excel1');
            $('#excellibref_'+ key).hide();
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        } else if (sRowType =="H") {
            $('#excelrowid_' + key).addClass('excel2');
            $('#excellibref_'+ key).hide();
            $('#excelunit_' + key).hide();
            $('#excelqty_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        } else if (sRowType =="WBS") {
            $('#excelrowid_' + key).addClass('excel3');
            $('#excellibref_'+ key).hide();
            $('#excelparent_'+key).hide();
            $('#excelunit_' + key).hide();
            $('#excelrate_' + key).hide();
            $('#excelamount_' + key).hide();
            $('#excelqrate_' + key).hide();
            $('#excelqamount_' + key).hide();
        }
    });
    return bValid;
}
function getResourceDetails(sResName) {
    var arrResNew =[];
    var objR = $.grep(arrexcelresource, function (element, index) {
        return element.value == sResName;});
    if (objR.length >0) {
        var iTypeId =objR[0]['TypeId'],
            iUnitId = 0, sUnit ='',iResId =objR[0]['data'];
        if (iTypeId ==3) {
            sUnit = objR[0]['WorkUnitName'];
            iUnitId = objR[0]['WorkUnitId'];
        } else {
            sUnit = objR[0]['UnitName'];
            iUnitId = objR[0]['UnitId'];
        }
        arrResNew.push({
            ResourceId: iResId ,
            TypeId: iTypeId,
            Unit: sUnit,
            UnitId: iUnitId
        });
    }
    return arrResNew;
}
function validRowType(id) {
    var sRowType = $.trim(isNullCheck($('#'+id).val(),'string'));
    if (sRowType =="R" || sRowType =="I" || sRowType =="H" || sRowType =="WG" || sRowType =="WBS") removeError($('#' + id));
    else showError($('#' + id), 'Enter RowType');
}
$('.cnt_slider .carousel').carousel({
    interval: false
});

function findNextStep() {
    var bValid = true;
    if (iExcelStep==1) {
        bValid = fileupload();
        if (bValid == true) {
            iExcelStep = +iExcelStep+1;
            if (bexcelRowTypeFound==true) {
                bindAutoCompleteRowType();
            } else {
                iExcelStep = +iExcelStep+1;
                checkExcelResource();
                if (bexcelWGFound == true) {
                    bindexcelParentAutoComplete();
                } else {
                    binExcelLibrary();
                    iExcelStep = +iExcelStep+1;
                }
            }
        }
    } else if (iExcelStep==2) {
        bValid = rowTypeValidation();
        if (bValid == true) {
            iExcelStep = +iExcelStep+1;
            checkExcelResource();
            if (bexcelWGFound == true) {
                bindexcelParentAutoComplete();
            } else {
                binExcelLibrary();
                iExcelStep = +iExcelStep+1;
            }
        }
    } else if (iExcelStep==3) {
        bValid  = validateexcelUnWG();
        if (bValid ==true) {
            binExcelLibrary();
            iExcelStep = +iExcelStep + 1;
        }
    }  else if (iExcelStep==4) {
        iExcelStep = +iExcelStep + 1;
    }  else if (iExcelStep==5) {
        iExcelStep = +iExcelStep + 1;
        if (bexcelWBSFound == false) {
            iExcelStep = +iExcelStep + 1;
            if (bexcelResFound == false) {
                iExcelStep = +iExcelStep + 1;
                if (bexcelUnitFound == false) iExcelStep = +iExcelStep + 1;
            }
        }

    }  else if (iExcelStep==6) {
        bValid  = validateexcelUnWBS();
        if (bValid ==true) {
            iExcelStep = +iExcelStep + 1;
            if (bexcelResFound == false) {
                iExcelStep = +iExcelStep + 1;
                if (bexcelUnitFound == false) iExcelStep = +iExcelStep + 1;
            }
        }
    } else if (iExcelStep==7) {
        bValid = nextexcelresource();
        if (bValid  == true) {
            iExcelStep = +iExcelStep + 1;
            if (bexcelUnitFound==false) iExcelStep = +iExcelStep + 1;
        }
    } else if (iExcelStep==8) {
        bValid = nextexcelunit();
        if (bValid ==true) {
            iExcelStep = +iExcelStep + 1;
        }
    }
    return bValid;
}

$('#carouselNext').click(function() {
    var bValid = true;
    var vSteps = 0;
    bValid = findNextStep();
    if (iExcelStep==2) {
        $('#divstep1').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').addClass("stepli_p2");
        $('#excelboqname').html('Row Type Validation');
        vSteps = 1;
    } else if (iExcelStep==3) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').addClass("stepli_p2");
        vSteps = 2;
    } else if (iExcelStep==4) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').addClass("stepli_p2");
        $('.excel4').hide();
        $('#excelboqname').html('Specification Validation');
        vSteps = 1;
    } else if (iExcelStep==5) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').addClass("stepli_p2");
        $('.excel4').hide();
        $('#excelboqname').html('Library Reference');
        vSteps = 1;
    } else if (iExcelStep==6) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').addClass("stepli_p2");
        vSteps = 3;
    } else if (iExcelStep==7) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#divstep6').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').removeClass("stepli_p2");
        $('#p_7').addClass("stepli_p2");
        vSteps = 4;
    }  else if (iExcelStep==8) {
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#divstep6').addClass('stepsep_active');
        $('#divstep7').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').removeClass("stepli_p2");
        $('#p_7').removeClass("stepli_p2");
        $('#p_8').addClass("stepli_p2");
        vSteps = 5;
    } else if (iExcelStep==9) {
        checkExcelSheetValid();
        $('#divstep1').addClass('stepsep_active');
        $('#divstep2').addClass('stepsep_active');
        $('#divstep3').addClass('stepsep_active');
        $('#divstep4').addClass('stepsep_active');
        $('#divstep5').addClass('stepsep_active');
        $('#divstep6').addClass('stepsep_active');
        $('#divstep7').addClass('stepsep_active');
        $('#divstep8').addClass('stepsep_active');
        $('#p_1').removeClass("stepli_p2");
        $('#p_2').removeClass("stepli_p2");
        $('#p_3').removeClass("stepli_p2");
        $('#p_4').removeClass("stepli_p2");
        $('#p_5').removeClass("stepli_p2");
        $('#p_6').removeClass("stepli_p2");
        $('#p_7').removeClass("stepli_p2");
        $('#p_8').removeClass("stepli_p2");
        $('#p_9').addClass("stepli_p2");
        $('#carouselNext').hide();
        $('.excel4').show();
        $('#excelboqname').html('Bill of Quantities');
        if (bexcelSheetValid == true) {
            $('#carouselApply').show();
            $('#divstep9').addClass('stepsep_active');
        } else {
            $('#carouselApply').hide();
        }
        vSteps = 1;
    }
    if (bValid == true) $('.cnt_slider .carousel').carousel(parseInt(vSteps));
});
function bindAutoCompleteRowType() {
    var $parent_ids = $('input[id*=excelrowtype_]');
    $parent_ids.unbind('autocomplete');
    $.each($parent_ids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1) return;
        $this.autocomplete({
            lookup: arrayRowType,
            showNoSuggestionNotice: false,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function (suggestion) {
                if (suggestion) {
                    $(this).removeClass('error');
                }
            },
            onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) $(this).addClass('error');
                else $(this).removeClass('error');
            }
        });
    });
}
function checkExcelSheetValid() {
    bexcelSheetValid=true;
    var $resspecnames = $('input[id*=excelspec_]');
    $.each($resspecnames, function (i, obj) {
        var name = $(this)[0].id;
        if (name.indexOf('__') != -1) return;
        var irow = name.split('_')[1];
        var sRowType = isNullCheck($('#excelrowtype_' + irow).val(), 'string');
        if (sRowType == "WG") {
            var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iWGTypeId == 0) { bexcelSheetValid=false; $(this).closest('tr').removeClass('excelvalid'); }
            else $(this).closest('tr').addClass('excelvalid');
        } else if (sRowType == "I") {
            var iUnitId = parseInt(isNullCheck($('#excelunitid_'+irow).val(),'number')),
                iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iUnitId ==0) {
                bexcelSheetValid=false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelunit_' + irow), 'Required');
            } else removeError($('#excelunit_' + irow));
            if (iWGTypeId == 0) {
                bexcelSheetValid = false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelparent_' + irow), 'Required');
            } else removeError($('#excelparent_' + irow));
            if (iUnitId !=0 && iWGTypeId !=0) $(this).closest('tr').addClass('excelvalid');
        } else if (sRowType == "H") {
            var iWGTypeId = parseInt(isNullCheck($('#excelwgtypeid_'+irow).val(),'number'));
            if (iWGTypeId == 0) {
                bexcelSheetValid = false;
                $(this).closest('tr').removeClass('excelvalid');
                showError($('#excelparent_' + irow), 'Required');
            } else removeError($('#excelparent_' + irow));
        } else if (sRowType == "WBS") {
            var iWBSId = parseInt(isNullCheck($('#excelwbsid_'+irow).val(),'number'));
            if (iWBSId == 0) {
                bexcelSheetValid = false;
                $(this).closest('tr').removeClass('excelvalid');
            } else $(this).closest('tr').addClass('excelvalid');
        }
    });
}
function showPickList(id) {
    var sname = id.split('_')[0],
        key= id.split('_')[1],
        restype = "S";
    if (sname.substr(sname.length-1) == "R") restype = "R";
    $('#picklistrestype').val(restype);
    $('#picklistrow').val(key);

    checkResourcePickList(key,restype);
    bindResourcePickListGrid();
    checkIOWPickList(key,restype);
    bindIOWPickListGrid();
    $("#picklistmodal").modal('show');
}
function checkResourcePickList(key,restype) {
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + key + '_reskeyid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + key + '_reskeyid_]');
        arrrespicklistR = [];
        arrrespicklistR = $.grep(arrrespicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this);
                if (element.ResourceId == $this.val()) is_selected = false;

            });
            return is_selected;
        });
    }
}
function checkIOWPickList(key,restype) {
    if (restype=="R") {
        var reskeyid = $('input[id*=rateanalR_' + key + '_iowkeyid_]]');
        arriowpicklistR = [];
        arriowpicklistR = $.grep(arriowpicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.IOWId == $this.val()) is_selected = false;
            });
            return is_selected;
        });
    } else {
        var reskeyid = $('input[id*=rateanal_' + key + '_iowkeyid_]');
        arriowpicklistR = [];
        arriowpicklistR = $.grep(arriowpicklist, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1],
                    key2 = arrname[3];
                if (element.IOWId == $this.val()) is_selected = false;

            });
            return is_selected;
        });
    }
}

function bindResourcePickListGrid() {
    var parent = $("#respickgrid").parent();
    $("#respickgrid").remove();
    $("<div id='respickgrid'></div>").appendTo(parent);
    var source = {
        localdata:arrrespicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'ResourceId', type: 'string'},
            { name: 'TypeId', type: 'number'},
            { name: 'UnitId', type: 'number'},
            { name: 'Code', type: 'string'},
            { name: 'ResourceName', type: 'string'},
            { name: 'UnitName', type: 'string'},
            { name: 'TypeName', type: 'string'},
            { name: 'ResourceGroup', type: 'string'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'ResourceId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);

//    var dataAdapter = new $.jqx.dataAdapter(source, {
//        downloadComplete: function (data, status, xhr) { },
//        loadComplete: function (data) { },
//        loadError: function (xhr, status, error) { }
//    });


    $("#respickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'ResourceId', datafield: 'ResourceId', hidden: true},
            {text: 'TypeId', datafield: 'TypeId', hidden: true},
            {text: 'UnitId', datafield: 'UnitId', hidden: true},
            {text: 'Code', datafield: 'Code', 'editable': false, width: '15%'},
            {text: 'ResourceName', datafield: 'ResourceName', 'editable': false, width: '30%'},
            {text: 'Unit', datafield: 'UnitName', 'editable': false, width: '10%'},
            {text: 'Type', datafield: 'TypeName', 'editable': false, width: '15%'},
            {text: 'ResourceGroup', datafield: 'ResourceGroup', 'editable': false, width: '20%'},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%'}
        ]
    });
}

function bindIOWPickListGrid() {
    var parent = $("#iowpickgrid").parent();
    $("#iowpickgrid").remove();
    $("<div id='iowpickgrid'></div>").appendTo(parent);

    var source = {
        localdata:arriowpicklistR,
        async: false,
        dataType: "json",
        dataFields: [
            { name: 'IOWId', type: 'number'},
            { name: 'WorkGroupId', type: 'number'},
            { name: 'WorkTypeId', type: 'number'},
            { name: 'SerialNo', type: 'string'},
            { name: 'WorkGroupName', type: 'string'},
            { name: 'WorkTypeName', type: 'string'},
            { name: 'Specification', type: 'string'},
            { name: 'Header', type: 'number'},
            { name: 'Select', type: 'boolean'}
        ],
        id: 'IOWId'
    };

    var rfcdata = new $.jqx.dataAdapter(source);
//    var columnsrenderer = function (value) {
//        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
//    }

    $("#iowpickgrid").jqxGrid({
        width: "100%",
        pagerButtonsCount: 6,
        pagesize: 10,
        source: rfcdata,
        pageable: true,
        sortable: true,
        filterable: true,
        showfilterrow: true,
        altrows: true,
        enabletooltips: true,
        editable: true,
        selectionmode: 'singlerow',
        columns: [
            {text: 'IOWId', datafield: 'IOWId', hidden: true},
            {text: 'WorkGroupId', datafield: 'WorkGroupId', hidden: true},
            {text: 'WorkTypeId', datafield: 'WorkTypeId', hidden: true},
            {text: 'WorkTypeName', datafield: 'WorkTypeName', hidden: true},
            {text: 'Header', datafield: 'Header', hidden: true},
            {text: 'SerialNo', datafield: 'SerialNo', 'editable': false, width: '15%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'SerialNo') + '</div>';
                    return slNo;
                }},
            {text: 'WorkGroup', datafield: 'WorkGroupName', 'editable': false, width: '20%',
                cellsrenderer: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader ==1)  slNo = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    else slNo ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'WorkGroupName') + '</div>';
                    return slNo;
                }},
            {text: 'Specification', datafield: 'Specification', 'editable': false, width: '55%',cellsrenderer: function (row) {
                var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),spec="";
                if (iHeader ==1)  spec = '<div style="font-size:13px; font-weight:600;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                else spec ='<div style="font-size:12px;">' + $("#iowpickgrid").jqxGrid('getCellValue', row, 'Specification') + '</div>';
                return spec;
            }},
            {text: 'Select', datafield: 'Select', columntype: 'checkbox', 'editable': true, width: '10%',
                cellbeginedit: function (row) {
                    var iHeader = $("#iowpickgrid").jqxGrid('getcellvalue', row, "Header"),slNo="";
                    if (iHeader==1) return false;
                    else return true;
                }
            }
        ]
    });
}
function updatefromPickList() {
    $('.loading_area').show();
    var resType = $('#picklistrestype').val(),
        key1 = isNullCheck($('#picklistrow').val(),'number'),
        sName = "#rateanal_" + key1;
    if (resType =="R") sName = "#rateanalR_" + key1;
    var rows = $('#respickgrid').jqxGrid('getrows'),iResourceId= 0,sCode="",sResName="",sSpec="";
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#rowinfoid_' + key1).val();
            if (resType =="R") key2 = $('#rowinfoidR_' + key1).val();

            iResourceId = rows[i]['ResourceId'];
            sCode = rows[i]['Code'];
            sResName = rows[i]['ResourceName'];
            sSpec = sCode + '   ' + sResName;

            $(sName + '_resid_' + key2).val(sSpec);
            $(sName + '_reskeyid_' + key2).val(iResourceId);
            $(sName + '_iowkeyid_' + key2).val(0);
            $(sName + "_type_" + key2).val('R');
            cboResChanged(iResourceId, key1, key2, resType);
            if (resType =="R") AddNewRowResR(key1,key2);
            else AddNewRowRes(key1,key2);
        }
    }
    var rows = $('#iowpickgrid').jqxGrid('getrows'),iiowid= 0,sCode="",sSpecName="",sSpec="";
    for (var i = 0; i < rows.length; i++) {
        if (rows[i]['Select'] == true) {
            var key2 = $('#rowinfoid_' + key1).val();
            if (resType =="R") key2 = $('#rowinfoidR_' + key1).val();

            iiowid = rows[i]['IOWId'];
            sCode = rows[i]['SerialNo'];
            sSpecName = rows[i]['Specification'];
            sSpec = sCode + '   ' + sSpecName;

            $(sName + '_resid_' + key2).val(sSpec);
            $(sName + '_reskeyid_' + key2).val(0);
            $(sName + '_iowkeyid_' + key2).val(iiowid);
            $(sName + "_type_" + key2).val('I');
            $(sName + '_resid_' + key2).prop('disabled', true);
            cboIOWChanged(iiowid, key1, key2, resType);

            cboResChanged(iResourceId, key1, key2, resType);
            if (resType =="R") AddNewRowResR(key1,key2);
            else AddNewRowRes(key1,key2);
        }
    }
    $('#picklistmodal').modal('toggle');
    $('.loading_area').hide();
}
</script>