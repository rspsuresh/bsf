<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/jquery.bootstrap-responsive-tabs.min.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/jquery.bootstrap-responsive-tabs.min.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/workorder.css';?>"/>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places&amp;key=AIzaSyDaNPyxJ7NKmZ4rC8awB-BlBh6ieH1Q9os"></script>
<!--jquery contextmenu-->
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqcontextmenu/jquery.contextMenu.min.js"></script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/library/jqcontextmenu/jquery.ui.position.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/library/jqcontextmenu/jquery.contextMenu.min.css" />
<style type="text/css">
.form-control, .btn-default{height:45px !important}
    .form-control 							{box-shadow:none!important}
    .panel 									{border-radius:0px !important;}
    .panel-info 							{border:none;border-top:none;}
    .seld 									{border:1px solid #c2c2c2 !important;display:block !important;padding:0px !important;margin:0px !important;}
    .opt-listed ul li p 					{height:25px !important;padding-top:0px !important;}
    .opt-listed ul 							{width:100% !important;margin-left:0% !important;}
    /*BOQ Header Total*/
    .panel-title 							{position:relative;}
    #boqtotalSpan 							{position:absolute;right:50px;}
    #billperiodweekdayli, #billperioddayli, #boq-clear-span, #bill-format-clear{display:none;}
    .expandDiv 								{overflow:visible !important;}
    .expandDiv > .docu-spc 					{height:auto !important;}
    .panel-fullscreen 						{display:block;z-index:1000;position:fixed;width:100%;height:100%;top:0;right:0;left:0;bottom:0;overflow:auto;}
    .panel-fullscreen > #panelheading-2 	{position:fixed;top:0px;display:block;width:100%;z-index:999;}
    .boq-budget-txt, #BudgetAmountWrapper 	{display:none;}
    .btm-bt0 li								{padding-bottom:0px !important;}
    .setup_add_btn							{border:1px solid #3580c4; font-size:12px; padding:0; position:absolute; right:-13px; top:10px;width: 30px; height:30px; text-align:center; border-radius:50%}
    .setup_add_btn:hover				    {border:1px solid #960; color:#900;}
    .setup_add_btn span i{padding-top:8px}
    .new-des-bill li > label				{ font-size:13px !important;}
    .cont_bt a.back-btn{background: #f1f1f1; border: 1px solid #d7d7d7; box-shadow: 2px 0 16px #d7d7d7 inset;color: #333333;    padding: 8px 16px;font-weight:bold}
    .cont_bt a.back-btn:hover{border:1px solid #3399ff; color:#3399ff;box-shadow:none;background:#fff;font-weight:bold}
    /*.nav-tabs > li{margin: 1em 20px 1em 0;
   position: relative;}
   .nav-tabs > li:last-child::after{display:none}
    .nav-tabs > li::after {
    content: ""; background-color: #96c03d;
    height: 4px;
    margin: 0;  left: 100%;
   top: 50%;
   transform: translateY(-50%) translateX(-1px);
    width: 50%;
   position: absolute;
    }
   .nav-tabs > li.active > a, .nav-tabs > li > a:hover{background:#3399ff;color:#fff}*/
    .progres-step{margin-top:15px;}
    .nav-pills > li.active > a, .nav-pills > li.active > a:focus{color:#fff !important}
    .nav-pills > li.active > a, .nav-pills > li.active > a:focus, .nav-pills > li.active > a:hover{color:#000; background:#3399ff !important}
    .error-shown{border:1px solid red !important;}
    .form-group1{margin-bottom:10px}
    .form-group1 label{text-align:right !important; margin-top:10px}
</style>
<?php
$viewmode = false;
if(isset($mode) && $mode != 'edit' && isset($workorderid) && $workorderid == 0) $viewmode = true;
$viewmode = false;
?>
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form id="formWrapper" onsubmit="return entryValidate()"  method="post" enctype="multipart/form-data">
<input type="hidden" name="csrf" value="<?php echo isset($csrf)?$csrf:''; ?>">
<input type="hidden" name="workorderid" id="workorderid" value="<?php echo (isset($workorderid)) ? $workorderid  : 0; ?>"/>
<input type="hidden" name="PWorkOrderId" id="PWorkOrderId" value="<?php echo (isset($pworkorderid)) ? $pworkorderid  : 0; ?>"/>
<input type="hidden" name="costcentreId" id="costcentreId" value="<?php echo (isset($costcentreId)) ? $costcentreId : 0; ?>"/>
<input type="hidden" name="amendment" id="amendment" value="<?php echo ($pworkorderid !=0) ? 1 : 0; ?>"/>
<input type="hidden" name="mode" id="mode" value="<?php echo (isset($mode) && $mode != '') ? $mode  : 'add'; ?>" />
<input type="hidden" name="enquiryId" id="enquiryId" value="<?php if(isset($enquiryId)) { echo $enquiryId;}else{echo '';} ?>"/>
<input type="hidden" name="quotationId" id="quotationId" value="<?php if(isset($quotationid)) { echo $quotationid;}else{echo '';} ?>"/>
<input type="hidden" name="setupId" id="setupId" value="<?php echo (isset($setupId)) ? $setupId  : 0; ?>" />
<?php if($viewmode) {?>
    <div id="indexWrapper">
        <div class="col-lg-12">
            <h1 class="text-center compadding_bottom_0 commargin_top">Work Order</h1>
        </div>
        <!--form start-->
        <div class="col-lg-12 zoomIn animated">
            <div class="col-lg-6 col-lg-offset-3 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 prt-next">
                <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 top-next">
                    <div class="form-horizontal">
                        <div class="row">
                            <div class="form-group">
                                <div class="col-lg-12"> <span class="new-pg" id="btn-editclient" data-toggle="modal" data-target="#clientmodal"><i class="fa fa-pencil"></i></span>
                                    <input type="text" name="ClientName" id="ClientName" class="form-control lbl_move" value="<?php if(isset($enqFollowup)) { echo $enqFollowup['ClientName'];}else{echo '';} ?>" label="Client Name"/>
                                    <input type="hidden" name="ClientId" id="ClientId" value="<?php if(isset($enqFollowup)) { echo $enqFollowup['ClientId'];}else{echo '';} ?>"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12"> <strong class="new-pg" id="newProject">New</strong>
                                    <input type="text" name="ProjectName" id="ProjectName" class="form-control lbl_move" label="Enquiry Name" value="<?php if(isset($enqFollowup)) { echo $enqFollowup['EnquiryName'];}else{echo '';} ?>" onchange="return ProjectChange(this.value);" />
                                    <input type="hidden" name="ProjectId" id="ProjectId" value="<?php if(isset($enqFollowup)) { echo $enqFollowup['TenderEnquiryId'];}else{echo '';} ?>"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <select name="OrderType" id="OrderType" class="single_dropdown2 lbl_move" style="width:100%;" label="Work Order Type" onchange="return WOTypeChange(this.value);" />

                                    <option value="N">New Work Order</option>
                                    <option value="A">Amendment</option>
                                    </select>
                                </div>
                                <input type="hidden" name="Order" id="Order" >
                            </div>
                            <div class="form-group" id="workorder" style="display: none">
                                <div class="col-lg-12">
                                    <select name="cbowo" id="cbowo" class="single_dropdown2 lbl_move" style="width:100%;" label="Select Work Order" onchange="return WOChange(this.value);" />

                                    <input type="hidden" name="PrevWorkOrderId" id="PrevWorkOrderId" value="0">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <input type="text" name="WONo" id="WONo" class="form-control lbl_move" label="Work Order No." maxlength="100" onchange="CheckWONo(this, this.value)"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-12"> <span class="date_icon"><i class="fa fa-calendar"></i></span>
                                    <input type="text" name="WODate" id="WODate" class="form-control date_picker lbl_move" readonly="readonly" label="Work Order Date" onchange="validateDate(this)"  value="<?php echo (isset($woregister)) ? $woregister['WODate'] : date('d-m-Y');?>"/>
                                </div>
                            </div>
                            <!--div class="form-group">
                              <div class="col-lg-12">
                               <input type="text" class="form-control lbl_move" label="Project Name" name="ProjectDescription" id="ProjectDescription" readonly />
                              </div>
                            </div>
                            <div class="form-group">
                              <div class="col-lg-12"> <strong class="new-pg" id="newProjectType">New</strong>
                                <input type="text" name="ProjectTypeName" id="ProjectTypeName" class="form-control lbl_move" readonly label="Project Type" />
                                <input type="hidden" name="ProjectTypeId" id="ProjectTypeId" />
                              </div>
                            </div-->
                        </div>

                    </div>
                    <div class="next-bt"><a onclick="return validateIndex();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
                </div>
            </div>
        </div>
    </div>
<?php } ?>
<div id="mainWrapper" <?php echo (!$viewmode) ? 'style="display:block;"' : ''; ?>>
<div class="col-lg-12">
    <h1>Work Order</h1>
</div>
<!--accordion start-->
<div class="clearfix"></div>
<div class="col-lg-12 col-lg-offset-0">
    <div class="tagcrd">
        <ul>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr1">
                    <div class="icon-bg"><i class="fa fa-list-alt i-text-111"></i></div>
                    <h2 class="comtex commargin_bottom_5 crmbrdrclrhed1 comnelips" style="font-weight:600 !important;">Work Order No</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"><input type="text" class="bk_inpt1 splcharc" name="MWorkOrderNo" data-bsfshare="Work Order No" id="MWorkOrderNo" value="<?php  if ($workorderid!=0) { echo $woregister['WONo'];}  else { echo $svNo; } ?>" <?php if ($genType==true) { ?> readonly <?php } ?> /></h5>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr2">
                    <div class="icon-bg"><i class="fa fa-tasks i-text-111"></i></div>
                    <h2 class="comtex  commargin_bottom_5 crmbrdrclrhed2 comnelips" style="font-weight:600 !important;">Work Order Date</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"><input type="text" class="date_picker no_bg bk_inpt " name="MWorkOrderDate" data-bsfshare="Work Order Date" readonly id="MWorkOrderDate" onchange="validateDate(this);" value="<?php if ($workorderid!=0)  { echo date("d-m-Y", strtotime($woregister['WODate']));} else { echo date('d-m-Y');}?>" /></h5>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr3">
                    <div class="icon-bg"><i class="fa fa-user i-text-111"></i></div>
                    <h2 class="comtex  commargin_bottom_5 crmbrdrclrhed3 comnelips" style="font-weight:600 !important;">Client Name</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"> <input type="text" class="bk_inpt1 splcharc" name="MWOClientName" data-bsfshare="Enquiry Name" readonly id="MWOClientName" value="<?php echo $clientName; ?>"/></h5>
                    <input type="hidden" name="TClientId" id="TClientId" value="<?php echo $clientId; ?>"/>
                </div>
            </li>
            <li class="mnimumwidthres90">
                <div class="tagcardhdng pnl-overflow crmbrdrclr4">
                    <div class="icon-bg"><i class="fa fa-suitcase i-text-111"></i></div>
                    <h2 class="comtex commargin_bottom_5 crmbrdrclrhed4 comnelips" style="font-weight:600 !important;">Project Name</h2>
                    <h5 class="tetmuted tet-clr11 comnelips"> <input type="text" class="bk_inpt1 splcharc" name="MProjectName" data-bsfshare="Project Name" readonly id="MProjectName" value="<?php echo $EnquiryName; ?>"/></h5>
                </div>
            </li>
            <!--li class="mnimumwidthres90">
              <div class="tagcardhdng pnl-overflow crmbrdrclr5">
                <div class="icon-bg"><i class="fa fa-tasks i-text-111"></i></div>
                <h2 class="comtex  commargin_bottom_5 crmbrdrclrhed5 comnelips" style="font-weight:600 !important;">Project Description</h2>
                <h5 class="tetmuted tet-clr11 comnelips" id="MProjectDescription"></?php echo (isset($woregister) && $woregister['NameOfWork'] != '') ? $woregister['NameOfWork'] : 'N/A';?></h5>
              </div>
            </li-->
        </ul>
    </div>
</div>
<div class="col-lg-12 clear">
<div id="accordion" class="panel-group">
<!--General-->
<div class="panel panel-info">
    <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
        <h4 class="panel-title accordion-toggle defa_panels">General</h4>
    </div>
    <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="deft_act">
                <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-12 col-sm-offset-0 clear">
                    <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0">
                        <div class="col-lg-12" style="padding-left:0px !important; padding-right:0px !important;">
                            <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 padd-50">
                                <div class="form-group">
                                    <input type="text" class="form-control lbl_move" label="Agreement No" name="AgreementNo" id="AgreementNo" value="<?php echo (isset($woregister)) ? $woregister['AgreementNo'] : '';?>"/>
                                </div>
                            </div>
                            <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 padd-60">
                                <div class="form-group"> <span class="date_icon"><i class="fa fa-calendar"></i></span>
                                    <input type="text" class="form-control date_picker lbl_move" readonly="readonly" label="Agreement Date" name="AgreementDate" id="AgreementDate" onchange="validateDate(this)" value="<?php echo (isset($woregister)) ? $woregister['AgreementDate'] : date('d-m-Y');?>"/>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="form-group">
                            <input type="text" class="form-control lbl_move" label="Awarding Authority" name="AuthorityName" id="AuthorityName" value="<?php echo (isset($woregister)) ? $woregister['AuthorityName'] : '';?>"/>
                        </div>
                        <div class="form-group"> <span class="date_icon"><i class="fa fa-calendar"></i></span>
                            <input type="text" class="form-control date_picker lbl_move" readonly="readonly" label="Date of Actual Commencement" name="StartDate" id="StartDate" onchange="calcStipDate()" value="<?php echo (isset($woregister)) ? $woregister['StartDate'] : '';?>"/>
                        </div>
                        <div class="form-group">
                            <select class="single_dropdown2 lbl_move" style="width:100%;" label="Agreement Type"  id="AgreementType" onchange="changeAgreementType()" <?php echo (isset($woboq) && count($woboq) > 0)?'disabled':''; ?>>
                                <option></option>
                                <option value="R" <?php echo (isset($woregister) && $woregister['AgreementType'] == 'R') ? 'selected' : '';?>>Item Wise Rate</option>
                                <option value="I" <?php echo (isset($woregister) && $woregister['AgreementType'] == 'I') ? 'selected' : '';?>>Item Wise %</option>
                                <!--                              <option value="O" -->
                                <?php //echo (isset($woregister) && $woregister['AgreementType'] == 'O') ? 'selected' : '';?>
                                <!-->Overall %</option>-->
                                <!--                              <option value="T" -->
                                <?php //echo (isset($woregister) && $woregister['AgreementType'] == 'T') ? 'selected' : '';?>
                                <!-->Turn Key</option>-->
                            </select>
                            <input type="hidden" name="AgreementType" id="InputAgreementType" value="<?php echo (isset($woregister['AgreementType']))?$woregister['AgreementType']:''; ?>">
                        </div>
                    </div>
                    <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0">
                        <div class="form-group">
                            <input type="text" class="form-control lbl_move" label="Address of Authority" name="AuthorityAddress" id="AuthorityAddress" value="<?php echo (isset($woregister)) ? $woregister['AuthorityAddress'] : '';?>"/>
                        </div>
                        <div class="form-group input-grouping">
                            <input type="text" class="form-control lbl_move" label="Project Duration" name="Duration" id="Duration" onblur="return FormatNum(this, 0)" onchange="calcStipDate()" onkeypress="return isNumberKey(event,this)" maxlength="12" value="<?php echo (isset($woregister)) ? $woregister['Duration'] : '';?>"/>
                            <div class="input-group-btn">
                                <select class="form-control selectpicker show-tick periodTypeData" name="PeriodType" id="PeriodType" onchange="calcStipDate()">
                                    <option value="D" <?php echo (isset($woregister) && $woregister['PeriodType'] == 'D') ? 'selected' : '';?>>Day</option>
                                    <option value="M" <?php echo (isset($woregister) && $woregister['PeriodType'] == 'M') ? 'selected' : '';?>>Month</option>
                                    <option value="Y" <?php echo (isset($woregister) && $woregister['PeriodType'] == 'Y') ? 'selected' : '';?>>Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control lbl_move" readonly label="Stipulated Date of Completion" name="EndDate" id="EndDate" value="<?php echo (isset($woregister)) ? $woregister['EndDate'] : '';?>"/>
                        </div>
                        <div class="col-lg-12" style="padding-left:0px !important; padding-right:0px !important;">
                            <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 padd-50">
                                <div class="form-group">
                                    <input type="text" class="form-control lbl_move text-right" label="Quotation %" name="OrderPercent" id="OrderPercent" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" value="<?php echo (isset($woregister)) ?  $this->commonHelper()->sanitizeNumber($woregister['OrderPercent'],2) : '';?>" onchange="calculateBOQRate(this)" <?php echo (isset($woboq) && count($woboq) > 0 && $woregister['AgreementType'] != 'O')?'readonly':''; ?>/>
                                </div>
                            </div>
                            <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 padd-60">
                                <div class="form-group">
                                    <input type="text" class="form-control lbl_move text-right" label="Quotation Amount" name="OrderAmount" id="OrderAmount"  value="<?php echo (isset($woregister)) ? $this->commonHelper()->sanitizeNumber($woregister['OrderAmount'],2,true) : '';?>" onkeypress="return isNumberKey(event,this)" onchange="calcMobilAmt(this)" readonly/>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="form-group" id="BudgetAmountWrapper" <?php echo (isset($woregister) && $woregister['BudgetType'] == 'I') ? 'style="display: none;"' : '';?>>
                            <input type="text" class="form-control lbl_move text-right" label="Budget Amount" name="BudgetAmount" id="BudgetAmount"  value="<?php echo (isset($woregister)) ? $this->commonHelper()->sanitizeNumber($woregister['BudgetAmount'],2,true,true) : '';?>" onkeypress="return isNumberKey(event,this)" onblur="return FormatNum(this, 2, true)"/>
                        </div>
                    </div>
                    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                        <ul>
                            <li><a href="javascript:nextAccordian(2)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--General end-->
<!--Tender Details-->
<div class="panel panel-info">
    <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
        <h4 class="panel-title accordion-toggle defa_panels">Bill of Quantity<!--span id="boqtotalSpan"><i class="fa fa-inr"></i> 0</span--></h4>
    </div>
    <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-12" style=" margin-top:10px;">
                <div id="loadBoq"></div>
                <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                    <ul>
                        <li><a href="javascript:nextAccordian(3)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Documents -->
<div class="panel panel-info">
    <div data-target="#collapsethree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-3">
        <h4 class="panel-title accordion-toggle defa_panels">Documents</h4>
    </div>
    <div class="panel-collapse collapse" id="collapsethree" style="height: 0px;">
        <div class="panel-body bgcolr">
            <div class="col-lg-10 col-lg-offset-1 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear">
                <div class="table-responsive topsp" style=" margin-top:10px;">
                    <table class="table tableWithFloatingHeader highlightTable" style=" margin-bottom:0px;" id="docTable">
                        <thead>
                        <tr>
                            <th>Document Type</th>
                            <th>Document Description</th>
                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php $i=1; if(isset($wodocument)):
                            foreach($wodocument as $dtrans): ?>
                                <tr>
                                    <td width="22%"><input type="hidden" name="docId_<?php echo $i; ?>" value="<?php echo $dtrans['DocumentId'];?>">
                                        <input class="parent_text" type="text" name="docType_<?php echo $i; ?>" id="docType_<?php echo $i; ?>"  value="<?php echo $dtrans['Type'];?>" maxlength="155" onchange="addNewDocRow(this)"/></td>
                                    <td width="35%"><textarea class="parent_texts" name="docDesc_<?php echo $i; ?>" id="docDesc_<?php echo $i; ?>"><?php echo $dtrans['Description'];?></textarea></td>
                                    <td width="5%" class="action_btns_td"><ul class="action_btns">
                                            <li style="float:left;"> <a class="pull-left" id="docAttachment_<?php echo $i; ?>" href="<?php echo (trim($dtrans['URL']) == '')?'#': $this->basePath(). $dtrans['URL'];?>" <?php if(trim($dtrans['URL']) != ''): ?> target="_blank" download="" <?php endif; ?>>
                                                    <?php if(trim($dtrans['URL']) == ''): ?>
                                                        <span data-toggle="tooltip" data-placement="left" data-original-title="Click to attach documents" class="btn-file butclr_imp"> <i class="fa fa-paperclip dcm_atch"></i>
                                    <input type="file" name="docFile_<?php echo $i; ?>" id="docFile_<?php echo $i; ?>">
                                    </span>
                                                    <?php else: ?>
                                                        <i class="fa fa-file-o file-do" data-toggle="tooltip" data-placement="left" data-original-title="Download Attachment"></i>
                                                        <input type="hidden" name="docFile_<?php echo $i; ?>" id="docFile_<?php echo $i; ?>" value="<?php echo $dtrans['URL'];?>">
                                                    <?php endif; ?>
                                                </a>
                                                <?php if(trim($dtrans['URL']) != ''): ?>
                                                    <i class="fa fa-chain-broken brkn" onclick="removeAttachment($(this));"></i>
                                                <?php endif; ?>
                                            </li>
                                            <li class=""> <a href="#" class="deleteDocTr_<?php echo $i; ?>" onclick="deleteDoc(this, event, <?php echo $dtrans['DocumentId'];?>);"><span data-toggle="tooltip" data-placement="left" data-original-title="Document Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                                        </ul></td>
                                </tr>
                                <?php $i=$i+1; endforeach;?>
                        <?php endif; ?>
                        <tr>
                            <td width="15%"><input class="parent_text" type="text" name="docType_<?php echo $i; ?>" id="docType_<?php echo $i; ?>" maxlength="155" onchange="addNewDocRow(this)"/></td>
                            <td width="15%"><textarea class="parent_texts" name="docDesc_<?php echo $i; ?>" id="docDesc_<?php echo $i; ?>"></textarea></td>
                            <td width="5%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;" class="lft-doc"> <a id="docAttachment_<?php echo $i; ?>" href="#"><span data-toggle="tooltip" data-placement="left" data-original-title="Click to attach documents" class="btn-file butclr_imp"> <i class="fa fa-paperclip dcm_atch"></i>
                                    <input type="file" name="docFile_<?php echo $i; ?>" id="docFile_<?php echo $i; ?>">
                                    </span></a> </li>
                                    <li style="float:left;"> <a href="#" class="deleteDocTr_<?php echo $i; ?>" onclick="deleteDoc(this, event, 0);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Document Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                                </ul></td>
                        </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="documentrowid" id="documentrowid" value="<?php echo $i;?>"/>
                </div>
            </div>
            <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                <ul>
                    <li><a href="javascript:nextAccordian(4)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!--Documents  end-->
<!--financial -->
<div class="panel panel-info">
    <div data-target="#collapsefour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-4">
        <h4 class="panel-title accordion-toggle defa_panels">Financial</h4>
    </div>
    <div class="panel-collapse collapse" id="collapsefour" style="height: 0px;">
        <div class="panel-body bgcolr">
            <!--new des-->
            <div class="clearfix"></div>
            <!-- Nav tabs -->
            <div class="col-md-12">
                <div class="progres-step">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#fgeneral" aria-controls="settings" role="tab" data-toggle="tab">General</a></li>
                        <li><a href="#Payment" aria-controls="settings" role="tab" data-toggle="tab">Payment Terms</a></li>
                        <li><a href="#deposit" aria-controls="home" role="tab" data-toggle="tab">Deposit</a></li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div class="tab-pane active" id="fgeneral">
                            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 clear">
                                <ul class="new-des-bill">
                                    <li>
                                        <label>Bill Period</label>
                                        <span><i class="fa fa-clock-o"></i></span>
                                        <div class="select-style sel-amoun-new">
                                            <select name="billperiodtype" id="billperiodtype" value="<?php echo (isset($woterms['PeriodType'])) ? $woterms['PeriodType'] : '0';?>" onchange="changeBillPeriod(this.value)">
                                                <option value="0">Select Period</option>
                                                <option value="1"<?php echo (isset($woterms) && $woterms['PeriodType'] == '1') ? 'selected' : '';?>>Weekly</option>
                                                <option value="2"<?php echo (isset($woterms) && $woterms['PeriodType'] == '2') ? 'selected' : '';?>>Biweekly</option>
                                                <option value="3"<?php echo (isset($woterms) && $woterms['PeriodType'] == '3') ? 'selected' : '';?>>Monthly</option>
                                                <option value="4"<?php echo (isset($woterms) && $woterms['PeriodType'] == '4') ? 'selected' : '';?>>Bimonthly</option>
                                                <option value="5"<?php echo (isset($woterms) && $woterms['PeriodType'] == '5') ? 'selected' : '';?>>Quarterly</option>
                                                <option value="6"<?php echo (isset($woterms) && $woterms['PeriodType'] == '6') ? 'selected' : '';?>>Half-Yearly</option>
                                                <option value="7"<?php echo (isset($woterms) && $woterms['PeriodType'] == '7') ? 'selected' : '';?>>Yearly</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li id="billperiodweekdayli">
                                        <label>Day of Bill Submission</label>
                                        <span><i class="fa fa-clock-o"></i></span>
                                        <div class="select-style sel-amoun-new">
                                            <select name="billperiodweekday" id="billperiodweekday" value="<?php echo (isset($woterms['PeriodWeekDay'])) ? $woterms['PeriodWeekDay'] : '0';?>">
                                                <option value="0">Select Day</option>
                                                <option value="1"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '1') ? 'selected' : '';?>>Sunday</option>
                                                <option value="2"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '2') ? 'selected' : '';?>>Monday</option>
                                                <option value="3"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '3') ? 'selected' : '';?>>Tuesday</option>
                                                <option value="4"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '4') ? 'selected' : '';?>>Wednesday</option>
                                                <option value="5"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '5') ? 'selected' : '';?>>Thursday</option>
                                                <option value="6"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '6') ? 'selected' : '';?>>Friday</option>
                                                <option value="7"<?php echo (isset($woterms) && $woterms['PeriodWeekDay'] == '7') ? 'selected' : '';?>>Saturday</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li id="billperioddayli">
                                        <label>Day of Bill Submission</label>
                                        <span><i class="fa fa-calendar-o"></i></span>
                                        <input class="text-right" type="text" name="billperiodday" id="billperiodday" value="<?php echo (isset($woterms['PeriodDay'])) ? $this->commonHelper()->sanitizeNumber($woterms['PeriodDay'],0) : '';?>" maxlength="2" onkeypress="return isNumberKey(event,this)"/>
                                    </li>
                                    <li>
                                        <label>Mobilisation Advance</label>
                                        <span> % </span>
                                        <input class="text-right" type="text" name="MobilisationPercent" id="MobilisationPercent" value="<?php echo (isset($woterms['MobilisationPercent'])) ? $this->commonHelper()->sanitizeNumber($woterms['MobilisationPercent']) : '';?>" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="calcMobilAmt(this)"/>
                                    </li>
                                    <li>
                                        <label>&nbsp;</label>
                                        <span><i class="fa fa-inr"></i></span>
                                        <input class="text-right" type="text" name="MobilisationAmount" readonly id="MobilisationAmount" value="<?php echo (isset($woterms['MobilisationAmount'])) ? $this->commonHelper()->sanitizeNumber($woterms['MobilisationAmount'],2,true) : '';?>" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/>
                                    </li>
                                    <li>
                                        <label>Mobilisation Recovery</label>
                                        <span> % </span>
                                        <input class="text-right" type="text" name="MobilisationRecovery" id="MobilisationRecovery" value="<?php echo (isset($woterms['MobilisationRecovery'])) ? $this->commonHelper()->sanitizeNumber($woterms['MobilisationRecovery']) : '';?>" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/>
                                    </li>
                                    <li>
                                        <label>Retention</label>
                                        <span> % </span>
                                        <input class="text-right" type="text" name="RetentionPercent" id="RetentionPercent" value="<?php echo (isset($woterms['RetentionPercent'])) ? $this->commonHelper()->sanitizeNumber($woterms['RetentionPercent']) : '';?>" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tab-pane" id="deposit">
                            <div class="col-lg-12">
                                <div class="table-responsive topsp">
                                    <table class="table highlightTable" style=" margin-bottom:0px;" id="depositTable">
                                        <thead>
                                        <tr>
                                            <th>Deposit Type</th>
                                            <th class="text-left">Mode</th>
                                            <th class="text-left">Ref No</th>
                                            <th class="text-left">Ref Date</th>
                                            <th class="text-right">Amount</th>
                                            <th class="text-left">Valid Upto</th>
                                            <th>&nbsp;</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <?php $i=1; if(isset($wodeposit)):
                                            foreach($wodeposit as $wdtrans): ?>
                                                <tr>
                                                    <td width="6%"><input class="parent_text" type="text" id="deposit_<?php echo $i; ?>" name="deposit_<?php echo $i; ?>" value="<?php echo $wdtrans['DepositType'];?>"/></td>
                                                    <td width="5%"><input class="parent_text" type="text" id="paymode_<?php echo $i; ?>" name="paymode_<?php echo $i; ?>" value="<?php echo $wdtrans['DepostMode'];?>"/></td>
                                                    <td width="4%"><input class="parent_text" type="text" id="drefno_<?php echo $i; ?>" name="drefno_<?php echo $i; ?>" value="<?php echo $wdtrans['RefNo'];?>"/></td>
                                                    <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
                                                        <input class="parent_text date_picker" type="text" id="drefdate_<?php echo $i; ?>" name="drefdate_<?php echo $i; ?>" readonly value="<?php echo date('d-m-Y', strtotime($wdtrans['RefDate']));?>" /></td>
                                                    <td width="7%"><input class="parent_text text-right" type="text" id="damount_<?php echo $i; ?>" name="damount_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($wdtrans['Amount'], 2, true);?>" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewDepositRow(this)"/></td>
                                                    <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
                                                        <input class="parent_text date_picker" type="text" id="dvaliddate_<?php echo $i; ?>" name="dvaliddate_<?php echo $i; ?>" readonly value="<?php echo date('d-m-Y', strtotime($wdtrans['ValidUpto']));?>"/></td>
                                                    <td width="1%" class="action_btns_td"><ul class="action_btns">
                                                            <li style="float:left;"> <a class="deletedepositTr_<?php echo $i; ?>" href="#" onclick="deleteDeposit(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                                                        </ul></td>
                                                </tr>
                                                <?php $i=$i+1; endforeach;?>
                                        <?php endif; ?>
                                        <tr>
                                            <td width="6%"><input class="parent_text" type="text" id="deposit_<?php echo $i; ?>" name="deposit_<?php echo $i; ?>"/></td>
                                            <td width="5%"><input class="parent_text" type="text" id="paymode_<?php echo $i; ?>" name="paymode_<?php echo $i; ?>" /></td>
                                            <td width="4%"><input class="parent_text" type="text" id="drefno_<?php echo $i; ?>" name="drefno_<?php echo $i; ?>"/></td>
                                            <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
                                                <input class="parent_text date_picker" type="text" id="drefdate_<?php echo $i; ?>" readonly name="drefdate_<?php echo $i; ?>"/></td>
                                            <td width="7%"><input class="parent_text text-right" type="text" id="damount_<?php echo $i; ?>" name="damount_<?php echo $i; ?>" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewDepositRow(this)"/></td>
                                            <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
                                                <input class="parent_text date_picker" type="text" id="dvaliddate_<?php echo $i; ?>" readonly name="dvaliddate_<?php echo $i; ?>"/></td>
                                            <td width="1%" class="action_btns_td"><ul class="action_btns">
                                                    <li style="float:left;"> <a class="deletedepositTr_<?php echo $i; ?>" href="#" onclick="deleteDeposit(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                                                </ul></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <input type="hidden" name="depositrowid" id="depositrowid" value="<?php echo $i;?>"/>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="Payment">
                            <div class="col-lg-12">
                                <ul class="per-tg">
                                    <li>
                                        <input type="text" class="col-lg-2 parent_texters text-right" name="PaymentSubmitPercent" id="PaymentSubmitPercent" onkeypress="return isNumberKey(event,this)" value="<?php echo (isset($woterms['PaymentSubmitPercent'])) ? $this->commonHelper()->sanitizeNumber($woterms['PaymentSubmitPercent'],0) : '';?>"/>
                                        <label>% of payment againts Submitted Bill Due on </label>
                                        <input type="text" class="col-lg-2 parent_texters text-right" name="PaymentFromSubmitDays" id="PaymentFromSubmitDays"  onkeypress="return isNumberKey(event,this)" value="<?php echo (isset($woterms['PaymentFromSubmitDays'])) ? $this->commonHelper()->sanitizeNumber($woterms['PaymentFromSubmitDays'],0) : '';?>"/>
                                        <label>th day of Submission.</label>
                                    </li>
                                    <li>
                                        <label>Bill to be Certified by </label>
                                        <input type="text" class="col-lg-2 parent_texters text-right" name="CertifyDays" id="CertifyDays" onkeypress="return isNumberKey(event,this)" value="<?php echo (isset($woterms['CertifyDays'])) ? $this->commonHelper()->sanitizeNumber($woterms['CertifyDays'],0) : '';?>"/>
                                        <label>day of Submission.  Due on </label>
                                        <input type="text" class="col-lg-2 parent_texters text-right" name="PaymentFromCertifyDays" id="PaymentFromCertifyDays" onkeypress="return isNumberKey(event,this)" value="<?php echo (isset($woterms['PaymentFromCertifyDays'])) ? $this->commonHelper()->sanitizeNumber($woterms['PaymentFromCertifyDays'],0) : '';?>"/>
                                        <label>th day of Certification.</label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Nav tabs -->
            <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                <ul>
                    <li><a href="javascript:nextAccordian(5)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!--financial  end-->
<!--Tender Details end-->
<!--Cost Details-->
<div class="panel panel-info">
<div data-target="#collapsefive" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-5">
    <h4 class="panel-title accordion-toggle defa_panels">Terms and Condition</h4>
</div>
<div class="panel-collapse collapse" id="collapsefive" style="height: 0px;">
<div class="panel-body bgcolr">
<div class="clearfix"></div>
<div class="col-lg-12">
<div class="progres-step">
<ul class="nav nav-tabs">
    <li class="active"><a href="#home1" aria-controls="home" role="tab" data-toggle="tab">Price Escalation</a></li>
    <li><a href="#profile1" aria-controls="profile" role="tab" data-toggle="tab">Client Supply Materials</a></li>
    <li><a href="#messages1" aria-controls="messages" role="tab" data-toggle="tab">Material Advance</a></li>
    <li><a href="#tech-tem" aria-controls="settings" role="tab" data-toggle="tab">Technical Specification</a></li>
    <li><a href="#oterms" aria-controls="settings" role="tab" data-toggle="tab">Other Terms</a></li>
    <li><a href="#Note" aria-controls="settings" role="tab" data-toggle="tab">Note</a></li>
</ul>
<div class="tab-content">
<div class="tab-pane active" id="home1">
    <p>
    <div class="col-lg-12">
        <div class="table-responsive topsp">
            <table class="table highlightTable" style=" margin-bottom:0px;" id="materialTable">
                <thead>
                <tr>
                    <th>Material Name</th>
                    <th class="text-center">Unit</th>
                    <th class="text-right">Rate</th>
                    <th class="text-right">Escalation %</th>
                    <th class="text-right">Condition</th>
                    <th class="text-right">Esc. Rate</th>
                    <th class="text-center">&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <?php $i=1; if(isset($womaterialbase)):
                    foreach($womaterialbase as $mtrans): ?>
                        <tr class="padi05">
                            <td width="13%"><input class="parent_text" type="text" name="materialName_<?php echo $i; ?>" id="materialName_<?php echo $i; ?>"  value="<?php echo $mtrans['MaterialName'];?>" onfocus="return checkMaterialPriceFocus(this.id)"/>
                                <input type="hidden" class="materialNameInputs" name="materialId_<?php echo $i; ?>" id="materialId_<?php echo $i; ?>" value="<?php echo $mtrans['MaterialId'];?>" /></td>
                            <td width="2%"><input class="parent_padi05" type="text" name="materialUnit_<?php echo $i; ?>" id="materialUnit_<?php echo $i; ?>" value="<?php echo $mtrans['UnitName'];?>" readonly/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" name="materialRate_<?php echo $i; ?>" id="materialRate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($mtrans['Rate'],2, true);?>" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                            <td width="2%"><input class="parent_text text-right" type="text" name="escalationper_<?php echo $i; ?>" id="escalationper_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($mtrans['EscalationPer'],2);?>"  onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                            <td width="2%"><div class="select-style heg30">
                                    <select name="materialbase_<?php echo $i; ?>" id="materialbase_<?php echo $i; ?>" >
                                        <option value=">" <?php echo (isset($mtrans['RateCondition']) && $mtrans['RateCondition'] == '>') ? 'selected' : '';?>>&gt;</option>
                                        <option value="<" <?php echo (isset($mtrans['RateCondition']) && $mtrans['RateCondition'] == '<') ? 'selected' : '';?>>&lt;</option>
                                    </select>
                                </div>
                            <td width="8%"><input class="parent_text text-right" type="text" name="materialnewRate_<?php echo $i; ?>" id="materialnewRate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($mtrans['ActualRate'],2,true);?>" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                            <td width="1%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;"> <a class="materialDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterial(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                                </ul></td>
                        </tr>
                        <?php $i=$i+1; endforeach;?>
                <?php endif; ?>
                <tr class="padi05">
                    <td width="13%"><input class="parent_text" type="text" name="materialName_<?php echo $i; ?>" id="materialName_<?php echo $i; ?>" onfocus="return checkMaterialPriceFocus(this.id)"/>
                        <input type="hidden" class="materialNameInputs" name="materialId_<?php echo $i; ?>" id="materialId_<?php echo $i; ?>"/></td>
                    <td width="2%"><input class="parent_padi05" type="text" name="materialUnit_<?php echo $i; ?>" id="materialUnit_<?php echo $i; ?>" value="" readonly/></td>
                    <td width="3%"><input class="parent_text text-right" type="text" name="materialRate_<?php echo $i; ?>" id="materialRate_<?php echo $i; ?>" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                    <td width="2%"><input class="parent_text text-right" type="text" name="escalationper_<?php echo $i; ?>" id="escalationper_<?php echo $i; ?>"  onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                    <td width="2%"><div class="select-style heg30">
                            <select name="materialbase_<?php echo $i; ?>" id="materialbase_<?php echo $i; ?>" />

                            <option value=">">&gt;</option>
                            <option value="<">&lt;</option>
                            </select>
                        </div>
                    <td width="8%"><input class="parent_text text-right" type="text" name="materialnewRate_<?php echo $i; ?>" id="materialnewRate_<?php echo $i; ?>" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                    <td width="1%" class="action_btns_td"><ul class="action_btns">
                            <li style="float:left;"> <a class="materialDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterial(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                        </ul></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="materialrowid" id="materialrowid" value="<?php echo $i;?>"/>
        </div>
    </div>
    </p>
</div>
<div class="tab-pane" id="profile1">
    <p>
    <div class="col-lg-12">
        <div class="table-responsive topsp">
            <table class="table highlightTable" style=" margin-bottom:0px;" id="materialExcTable">
                <thead>
                <tr>
                    <th>Material Name</th>
                    <th>Unit</th>
                    <th class="text-right">Rate</th>
                    <th>Supply Type</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <?php $i=1; if(isset($womaterialexcl)):
                    foreach($womaterialexcl as $metrans): ?>
                        <tr class="padi05">
                            <td width="15%"><input class="parent_text" type="text" name="materialExcName_<?php echo $i; ?>" value="<?php echo $metrans['MaterialName'];?>" id="materialExcName_<?php echo $i; ?>" onfocus="return checkMaterialSupplyFocus(this.id)" />
                                <input type="hidden" class="materialExcNameInputs" name="materialExcId_<?php echo $i; ?>" id="materialExcId_<?php echo $i; ?>" value="<?php echo $metrans['MaterialId'];?>" /></td>
                            <td width="3%"><input class="parent_padi05" type="text" name="materialExcUnit_<?php echo $i; ?>" value="<?php echo $metrans['UnitName'];?>" id="materialExcUnit_<?php echo $i; ?>" readonly/>
                            <td width="3%"><input class="parent_text text-right" type="text" name="materialExcRate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($metrans['Rate'],2,true);?>" id="materialExcRate_<?php echo $i; ?>" onchange="addNewMaterialExcRow(this)"  onblur="return FormatNum(this, 2, true)"/>
                            <td width="6%"><div class="select-style heg30">
                                    <select name="materialExcType_<?php echo $i; ?>" id="materialExcType_<?php echo $i; ?>"/>

                                    <option value="C"<?php echo ($metrans['SType'] == 'C') ? 'selected' : '';?>>Chargeable</option>
                                    <option value="F"<?php echo ($metrans['SType'] == 'F') ? 'selected' : '';?>>Free</option>
                                    </select>
                                </div>
                            <td width="1%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;"> <a class="materialExcDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterialExc(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                                </ul></td>
                        </tr>
                        <?php $i=$i+1; endforeach;?>
                <?php endif; ?>
                <tr class="padi05">
                    <td width="15%"><input class="parent_text" type="text" name="materialExcName_<?php echo $i; ?>" id="materialExcName_<?php echo $i; ?>" onfocus="return checkMaterialSupplyFocus(this.id)"/>
                        <input type="hidden" class="materialExcNameInputs" name="materialExcId_<?php echo $i; ?>" id="materialExcId_<?php echo $i; ?>"/></td>
                    <td width="3%"><input class="parent_padi05" type="text" name="materialExcUnit_<?php echo $i; ?>" id="materialExcUnit_<?php echo $i; ?>"readonly/>
                    <td width="3%"><input class="parent_text" type="text" name="materialExcRate_<?php echo $i; ?>" id="materialExcRate_<?php echo $i; ?>" onkeypress="return isDecimal(event,this)" onchange="addNewMaterialExcRow(this)" onblur="return FormatNum(this, 2, true)"/>
                    <td width="6%"><div class="select-style heg30">
                            <select name="materialExcType_<?php echo $i; ?>" id="materialExcType_<?php echo $i; ?>" />

                            <option value="C">Chargeable</option>
                            <option value="F">Free</option>
                            </select>
                        </div>
                    <td width="1%" class="action_btns_td"><ul class="action_btns">
                            <li style="float:left;"> <a class="materialExcDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterialExc(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                        </ul></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="materialExcrowid" id="materialExcrowid" value="<?php echo $i;?>"/>
        </div>
    </div>
    </p>
</div>
<div class="tab-pane" id="messages1">
    <p>
    <div class="col-lg-12">
        <div class="table-responsive topsp">
            <table class="table highlightTable" style="margin-bottom:0px;" id="materialAdvTable">
                <thead>
                <tr>
                    <th>Material Name</th>
                    <th class="text-left">Percentage</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <?php $i=1; if(isset($womaterialadv)):
                    foreach($womaterialadv as $matrans): ?>
                        <tr>
                            <td width="7%"><input class="parent_text" type="text" name="materialAdvName_<?php echo $i; ?>" id="materialAdvName_<?php echo $i; ?>" value="<?php echo $matrans['MaterialName'];?>" onchange="addNewMaterialAdvRow(this)" onfocus="return checkMaterialAdvFocus(this.id)"/>
                                <input type="hidden" class="materialAdvNameInputs" name="materialAdvId_<?php echo $i; ?>" id="materialAdvId_<?php echo $i; ?>" value="<?php echo $matrans['MaterialId'];?>" /></td>
                            <td width="2%"><input class="parent_text text-right" type="text" name="materialAdvRate_<?php echo $i; ?>" id="materialAdvRate_<?php echo $i; ?>" value="<?php echo $this->commonHelper()->sanitizeNumber($matrans['AdvPercent']);?>" onchange="addNewMaterialAdvRow(this)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                            <td width="1%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;"> <a class="materialAdvDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterialAdv(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                                </ul></td>
                        </tr>
                        <?php $i=$i+1; endforeach;?>
                <?php endif; ?>
                <tr>
                    <td width="7%"><input class="parent_text" type="text" name="materialAdvName_<?php echo $i; ?>" id="materialAdvName_<?php echo $i; ?>" onchange="addNewMaterialAdvRow(this)" onfocus="return checkMaterialAdvFocus(this.id)"/>
                        <input type="hidden" class="materialAdvNameInputs" name="materialAdvId_<?php echo $i; ?>" id="materialAdvId_<?php echo $i; ?>"/></td>
                    <td width="2%"><input class="parent_text text-right" type="text" name="materialAdvRate_<?php echo $i; ?>" id="materialAdvRate_<?php echo $i; ?>" onchange="addNewMaterialAdvRow(this)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
                    <td width="1%" class="action_btns_td"><ul class="action_btns">
                            <li style="float:left;"> <a class="materialAdvDeleteTr_<?php echo $i; ?>" href="#"  onclick="deleteMaterialAdv(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
                        </ul></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="materialAdvrowid" id="materialAdvrowid" value="<?php echo $i;?>"/>
        </div>
    </div>
    </p>
</div>
<div class="tab-pane" id="tech-tem">
    <p>
    <div class="col-lg-12">
        <div class="table-responsive topsp">
            <table class="table tableWithFloatingHeader highlightTable" style=" margin-bottom:0px;" id="techTitleTable">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Specification</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>

                <?php $i=1; if(isset($wotechterms)):
                    foreach($wotechterms as $tetrans): ?>
                        <tr>
                            <td width="15%"><input class="parent_text" type="text" name="techTitle_<?php echo $i; ?>" id="techTitle_<?php echo $i; ?>" maxlength="155"  value="<?php echo $tetrans['Title'];?>" onchange="addNewTechRow(this)"/></td>
                            <td width="15%"><textarea class="parent_texts" name="techDesc_<?php echo $i; ?>" id="techDesc_<?php echo $i; ?>"><?php echo $tetrans['Specification'];?></textarea></td>
                            <td width="4%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;"> <a href="#" class="deleteTechTr_<?php echo $i; ?>" onclick="deleteTech(this, event);"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                                </ul></td>
                        </tr>
                        <?php $i=$i+1; endforeach;?>
                <?php endif; ?>
                <tr>
                    <td width="15%"><input class="parent_text" type="text" name="techTitle_<?php echo $i; ?>" id="techTitle_<?php echo $i; ?>" maxlength="155" onchange="addNewTechRow(this)"/></td>
                    <td width="15%"><textarea class="parent_texts" name="techDesc_<?php echo $i; ?>" id="techDesc_<?php echo $i; ?>"></textarea></td>
                    <td width="4%" class="action_btns_td"><ul class="action_btns">
                            <li style="float:left;"> <a href="#" class="deleteTechTr_<?php echo $i; ?>" onclick="deleteTech(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                        </ul></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="techrowid" id="techrowid" value="<?php echo $i;?>"/>
        </div>
    </div>
    </p>
</div>
<div class="tab-pane" id="oterms">
    <p>
    <div class="col-lg-12">
        <div class="table-responsive topsp" style="margin-top:20px;">
            <table class="table tableWithFloatingHeader highlightTable" style=" margin-bottom:0px;" id="otherTermsTable">
                <thead>
                <tr>
                    <th>Terms Title</th>
                    <th>Terms Description</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <?php $i=1; if(isset($wootherterms)):
                    foreach($wootherterms as $ttrans): ?>
                        <tr>
                            <td width="15%"><input class="parent_text" type="text" name="termTitle_<?php echo $i; ?>" id="termTitle_<?php echo $i; ?>" maxlength="155"  value="<?php echo $ttrans['TermsTitle'];?>" onchange="addNewTermRow(this)"/></td>
                            <td width="15%"><textarea class="parent_texts" name="termDesc_<?php echo $i; ?>" id="termDesc_<?php echo $i; ?>"><?php echo $ttrans['TermsDescription'];?></textarea></td>
                            <td width="4%" class="action_btns_td"><ul class="action_btns">
                                    <li style="float:left;"> <a href="#" class="deleteTermTr_<?php echo $i; ?>" onclick="deleteTerm(this, event);"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                                </ul></td>
                        </tr>
                        <?php $i=$i+1; endforeach;?>
                <?php endif; ?>
                <tr>
                    <td width="15%"><input class="parent_text" type="text" name="termTitle_<?php echo $i; ?>" id="termTitle_<?php echo $i; ?>" maxlength="155" onchange="addNewTermRow(this)"/></td>
                    <td width="15%"><textarea class="parent_texts" name="termDesc_<?php echo $i; ?>" id="termDesc_<?php echo $i; ?>"></textarea></td>
                    <td width="4%" class="action_btns_td"><ul class="action_btns">
                            <li style="float:left;"> <a href="#" class="deleteTermTr_<?php echo $i; ?>" onclick="deleteTerm(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
                        </ul></td>
                </tr>
                </tbody>
            </table>
            <input type="hidden" name="termrowid" id="termrowid" value="<?php echo $i;?>"/>
        </div>
    </div>
    </p>
</div>
<div class="tab-pane" id="Note">
    <p>
    <div class="col-lg-12">
        <textarea class="exp-tex" name="Notes" id="Notes"> <?php echo (isset($woterms['Notes'])) ? $woterms['Notes'] : '';?> </textarea>
    </div>
    </p>
</div>
</div>
</div>
</div>
<div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
    <ul>
        <li><a href="javascript:nextAccordian(6)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
    </ul>
</div>
</div>
</div>
</div>
<!--Cost Details end-->
<!--Setup-->
<div class="panel panel-info">
<div data-target="#collapsesix" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-6">
    <h4 class="panel-title accordion-toggle defa_panels">Setup</h4>
</div>
<div class="panel-collapse collapse" id="collapsesix" style="height: 0px;">
<div class="panel-body bgcolr">
<div class="col-lg-12">
<div class="card">
<ul class="nav nav-pills">
    <li id="ligeneral" class="active"><a href="#general" aria-controls="general" role="tab" data-toggle="tab">General</a></li>
    <li id="liwbs"><a href="#wbs" aria-controls="wbs" role="tab" data-toggle="tab">WBS Required</a></li>
    <li id="limaterial"><a href="#materialoptions" aria-controls="materialoptions" role="tab" data-toggle="tab">Material Options</a></li>
    <li id="liother"><a href="#others" aria-controls="others" role="tab" data-toggle="tab">Others</a></li>
</ul>
<div class="tab-content">
<div class="tab-pane active" id="general">
    <p>
    <div class="col-lg-12 col-sm-12">
        <div class="col-md-offset-1 col-md-8 col-sm-offset-1 col-sm-8 ">
            <div class="col-lg-12 col-sm-12 form-group1">
                <label class="col-md-6  col-sm-6" align="right">Business Type</label>
                <div class="col-md-6  col-sm-6">
                    <select class="form-control single_dropdown lbl_move" name="businessType" id="businessType" style="width:100%;">
                        <option value="">Select</option>
                        <?php foreach($businessTypeMaster as $businessType) { ?>
                            <option value="<?php echo $businessType['BusinessTypeId']; ?>" <?php echo (isset($woSetup) && $woSetup['BusinessTypeId'] == $businessType['BusinessTypeId']) ? 'selected' : ''; ?>><?php echo $businessType['BusinessTypeName']; ?></option>
                        <?php } ?>
                    </select>
                </div>
            </div>
            <div class="col-lg-12 col-sm-12 form-group1" style="position:relative;">
                <!--                                  <input type="text" name="projectDivision" id="projectDivision" value="--><?php //echo (isset($woSetup)) ? $woSetup['ProjectDivision'] : ''; ?><!--" />-->

                <label class="col-md-6  col-sm-6" align="right">Project Division</label>
                <div class="col-md-6  col-sm-6">
                    <select class="form-control single_dropdown lbl_move" name="costCentreId" id="costCentreId" style="width:100%;" data-bsfshare="Project Division">
                        <option value=""></option>
                        <?php foreach($costCentre as $cc) { ?>
                            <option value="<?php echo $cc['CostCentreId']; ?>" <?php echo (isset($woSetup) && $woSetup['ProjectDivision'] == $cc['CostCentreId']) ? 'selected' : ''; ?>><?php echo $cc['CostCentreName']; ?></option>
                        <?php } ?>
                    </select>
                </div>
                <a href="javascript:void(0);" class="setup_add_btn ccForm" data-toggle="tooltip" data-placement="left" title="Add Cost Centre"><span><i class="fa fa-plus"></i></span></a>
            </div>
            <div class="col-lg-12 col-sm-12 form-group1">
                <label class="col-md-6 col-sm-6" align="right">Project Name</label>
                <div class="col-md-6 col-sm-6">
                    <input type="text" class="form-control lbl_move" name="ProjectDescription" id="ProjectDescription" value="<?php echo (isset($woSetup)) ? $woSetup['ProjectDescription'] : ''; ?>" />
                </div></div>
            <div class="col-lg-12 col-sm-12 form-group1">
                <label class="col-md-6 col-sm-6" align="right">Project Type</label>
                <div class="col-md-6 col-sm-6">
                    <select name="ProjectTypeId" class="form-control single_dropdown lbl_move"style="width:100%;" id="ProjectTypeId">
                        <option value="0">Select Project Type</option>
                        <?php foreach($projecttypes as $projType) { ?>
                            <option value="<?php echo $projType['ProjectTypeId']; ?>" <?php echo (isset($woSetup) && $woSetup['ProjectTypeId'] == $projType['ProjectTypeId']) ? 'selected' : ''; ?>><?php echo $projType['ProjectTypeName']; ?></option>
                        <?php } ?>
                    </select>
                </div>
            </div>
            <div class="col-lg-12 col-sm-12" style="margin-top:5px">
                <label class="col-md-9 col-sm-8" style="text-align:right; margin-top:2px;">Is it SEZ Project?</label>
                <div class="col-lg-3 col-md-3 col-sm-4 padlr0" align="left"> <span class="float_r">
                                    <label class="ripple">
                                        <input type="checkbox" class="ios_checkbox inc_exc" name="isSezProject" id="isSezProject" value="1" <?php echo (isset($woSetup) && $woSetup['IsSEZ'] == '1') ? 'checked' : ''; ?> />
                                        <div class="ios_switch"><span></span></div>
                                    </label>
                                    </span> </div>
            </div>
        </div>
    </div>
    <div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
        <div style="float:right" class="next-bt"><a onclick="return showwbstab();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
    </div>
    </p>
</div>
<div class="tab-pane" id="wbs">
    <p>
    <div class="col-md-offset-4 col-md-4 col-sm-offset-1 col-sm-8 ">
        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p>
                    <input type="checkbox" value="1" id="materialStock" name="materialStock" <?php echo (isset($woSetup) && $woSetup['MaterialStock'] == '1') ? 'checked' : ''; ?> />
                    <label for="materialStock" class="ripple">Material Stock-In</label>
                </p>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p>
                    <input type="checkbox" value="1" id="workProgress" name="workProgress" <?php echo (isset($woSetup) && $woSetup['WorkProgress'] == '1') ? 'checked' : ''; ?> />
                    <label for="workProgress" class="ripple">Work Progress</label>
                </p>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p>
                    <input type="checkbox" value="1" id="clientBill" name="clientBill" <?php echo (isset($woSetup) && $woSetup['ClientBill'] == '1') ? 'checked' : ''; ?> />
                    <label for="clientBill" class="ripple">Client Bill</label>
                </p>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p>
                    <input type="checkbox" value="1" id="labourStrength" name="labourStrength" <?php echo (isset($woSetup) && $woSetup['LabourStrength'] == '1') ? 'checked' : ''; ?> />
                    <label for="labourStrength" class="ripple">Labour Strength</label>
                </p>
            </div>
        </div>

        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p style="padding-top:10px;">
                    <input type="checkbox" value="1" id="materialConsumption" name="materialConsumption" <?php echo (isset($woSetup) && $woSetup['MaterialConsumption'] == '1') ? 'checked' : ''; ?> />
                    <label for="materialConsumption" class="ripple">Material Consumption</label>
                </p>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="radio_check">
                <p style="padding-top:10px;">
                    <input type="checkbox" value="1" id="plantMachinery" name="plantMachinery" <?php echo (isset($woSetup) && $woSetup['PlantMachinery'] == '1') ? 'checked' : ''; ?> />
                    <label for="plantMachinery" class="ripple">Plant and Machinery</label>
                </p>
            </div>
        </div>
    </div>
    <div class="cont_bt col-md-6"><a class="ripple back-btn" onclick="return showgeneraltab();" href="#"><i class="fa fa-backward" aria-hidden="true"></i>Back</a></div>
    <div class="cont_bt col-md-6">
        <div style="float:right" class="next-bt"><a onclick="return showmaterialtab();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
    </div>
    </p>
</div>
<div class="tab-pane" id="materialoptions">
    <p>
    <div class="col-md-offset-1 col-md-8 col-sm-offset-1 col-sm-8 ">
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6 col-sm-6">Material Consumption Based On</label>

            <div class="col-lg-6 col-sm-6 ">
                <select name="materialConsumptionBased" class="form-control single_dropdown lbl_move" id="materialConsumptionBased" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="Purchase" <?php echo (isset($woSetup) && $woSetup['MaterialConsumptionBased'] == 'Purchase') ? 'selected' : ''; ?>>Purchase</option>
                    <option value="Issue" <?php echo (isset($woSetup) && $woSetup['MaterialConsumptionBased'] == 'Issue') ? 'selected' : ''; ?>>Issue</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-10  col-sm-8">Item Wise Issue Require</label>
            <div class="col-lg-2 col-md-2 col-sm-4 padlr0"> <span class="float_r">
                                    <label class="ripple" style="text-align:left !important">
                                        <input type="checkbox" class="ios_checkbox inc_exc" name="issueRequire" id="issueRequire" value="1" <?php echo (isset($woSetup) && $woSetup['IssueRequire'] == '1') ? 'checked' : ''; ?> />
                                        <div class="ios_switch"><span></span></div>
                                    </label>
                                    </span> </div>
        </div>
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6  col-sm-6">Issue Rate Based On</label>
            <div class="col-lg-6 col-sm-6">
                <select name="issueRateBased" id="issueRateBased" class="form-control single_dropdown lbl_move" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="FIFO" <?php echo (isset($woSetup) && $woSetup['IssueRateBased'] == 'FIFO') ? 'selected' : ''; ?>>FIFO</option>
                    <option value="LIFO" <?php echo (isset($woSetup) && $woSetup['IssueRateBased'] == 'LIFO') ? 'selected' : ''; ?>>LIFO</option>
                    <option value="Weighted Average" <?php echo (isset($woSetup) && $woSetup['IssueRateBased'] == 'Weighted Average') ? 'selected' : ''; ?>>Weighted Average</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6  col-sm-6">Issue Based On</label>
            <div class="col-lg-6 col-sm-6">
                <select name="issueBased" id="issueBased" class="form-control single_dropdown lbl_move" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="None" <?php echo (isset($woSetup) && $woSetup['IssueBased'] == 'None') ? 'selected' : ''; ?>>None</option>
                    <option value="Request" <?php echo (isset($woSetup) && $woSetup['IssueBased'] == 'Request') ? 'selected' : ''; ?>>Request</option>
                    <option value="MIN/Bill" <?php echo (isset($woSetup) && $woSetup['IssueBased'] == 'MIN/Bill') ? 'selected' : ''; ?>>MIN/Bill</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6  col-sm-6">Transfer Based On</label>
            <div class="col-lg-6 col-sm-6">
                <select name="transferBased" id="transferBased" class="form-control single_dropdown lbl_move" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="Request" <?php echo (isset($woSetup) && $woSetup['TransferBased'] == 'Request') ? 'selected' : ''; ?>>Request</option>
                    <option value="MIN/Bill" <?php echo (isset($woSetup) && $woSetup['TransferBased'] == 'MIN/Bill') ? 'selected' : ''; ?>>MIN/Bill</option>
                </select>
            </div>
        </div>


    </div>
    <div class="cont_bt col-md-6"><a class="ripple back-btn" onclick="return showwbstab();" href="#"><i class="fa fa-backward" aria-hidden="true"></i>Back</a></div>
    <div class="cont_bt col-md-6">
        <div style="float:right" class="next-bt"><a onclick="return showothertab();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
    </div>
    </p>
</div>
<div class="tab-pane" id="others">
    <p>
    <div class="col-md-offset-2 col-md-6 col-sm-offset-1 col-sm-8 ">
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6  col-sm-6">Cost Control Based On</label>
            <div class="col-lg-6 col-sm-6">
                <select name="costControlBased" id="costControlBased" class="form-control single_dropdown lbl_move" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="WBS Budget" <?php echo (isset($woSetup) && $woSetup['CostControlBased'] == 'WBS Budget') ? 'selected' : ''; ?>>WBS Budget</option>
                    <option value="BOQ IOW" <?php echo (isset($woSetup) && $woSetup['CostControlBased'] == 'BOQ IOW') ? 'selected' : ''; ?>>BOQ IOW</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12 form-group1">
            <label class="col-md-6  col-sm-6">OH Budget From</label>
            <div class="col-lg-6 col-sm-6">
                <select name="ohBudgetFrom" id="ohBudgetFrom" class="form-control single_dropdown lbl_move" style="width:100% !important">
                    <option value="">Select</option>
                    <option value="Project" <?php echo (isset($woSetup) && $woSetup['OHBudgetFrom'] == 'Project') ? 'selected' : ''; ?>>Project</option>
                    <option value="FA" <?php echo (isset($woSetup) && $woSetup['OHBudgetFrom'] == 'FA') ? 'selected' : ''; ?>>FA</option>
                </select>
            </div>
        </div>

    </div>
    <div class="cont_bt col-md-6"><a class="ripple back-btn" onclick="return showmaterialtab();" href="#"><i class="fa fa-backward" aria-hidden="true"></i>Back</a></div>
    </p>
</div>
</div>
</div>
</div>
<!--div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
  <ul>
    <li><a href="javascript:nextAccordian(7)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
  </ul>
</div-->
</div>
</div>
</div>
<!--Setup end-->
<!--New Materials-->
<table  id="newmaterials" style="display: none;">
    <tr>
        <td ><a class="btn btn-link" id ="newMaterialCount" onclick="return ShowNewMaterials(event);return false;" >New Material Created <span class='badge badge_count'>0</span></a></td>
    </tr>
    <tr>
        <table class="table" id ="newmaterialwrapper" style="display: none; width:50%; border:1px solid #ccc;">
            <thead>
            <tr>
                <th style="border-right:1px solid #ccc;">Material Name</th>
                <th class="text-center">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <input type="hidden" name="newmaterialrowid" id="newmaterialrowid">
    </tr>
</table>
<!--accordion end-->
<div class="col-lg-12 savebtn_area">
    <ul>
        <!--        <li class="dropdown save_btn float_r"><a onclick="submitForm(); return false;" data-toggle="tooltip" class="ripple" title="Save">Save</a>-->
        <li class="dropdown save_btn float_r" id="submit-btn" style="<?php if ($workorderid !=0) { if ($woregister['Approve']=='Y') { echo 'display: none;'; } else { echo '';} }?>"><a href="javascript:submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
            <!--        <li class="cancel_btn float_r"><a onclick="backfn(); return false;" data-toggle="tooltip" class="ripple" title="Go back">Back</a></li>-->
        <li class="can_btn"><a href="<?php echo $this->basePath(); ?>/project/tender/workorderregister" class="ripple">Cancel</a></li>
    </ul>
</div>
</div>
</div>
</div>
</form>
</div>
</div>
</div>

<!--Material Modal-->
<div id="materialmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1 id="newMaterialHeader">Create Material</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label style="margin-bottom: 10px;">Material Name</label>
                        <input type="text" class="parent_text tex-po" name="MMaterialName" id="MMaterialName">
                    </div>
                    <div class="form-group">
                        <input type="text" name="unitName" id="MMaterialUnitName" class="form-control lbl_move" label="Unit"/>
                        <input type="hidden" name="unitId" id="unitId" />
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <div class="col-lg-12"> <a href="#" class="md_cance" data-dismiss="modal" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                    <button type="button" id="btn-newmaterial" class="md_ok" onclick="return MaterialUpdate()">Create</button>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- Project Division -->
<div id="ccForm" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                    <table class="table" style="margin-bottom:0;" id="ccTable">
                        <thead>
                        <tr>
                            <th class="th-modal" colspan="2">Add Cost Centre</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td width="40%">Name<span>*</span></td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="costCentre" id="costCentre" value="" class="tbl_input" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Company Name<span>*</span></td>
                            <td width="60%" class="tbl_input_td">
                                <div class="select-style">
                                    <select  name="companyId" id="companyId" onchange="loadBranches();">
                                        <option value="">Select Company</option>
                                        <?php foreach($companyMaster as $cc) { ?>
                                            <option value="<?php echo $cc['CompanyId']; ?>"><?php echo $cc['CompanyName']; ?></option>
                                        <?php } ?>
                                    </select>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Company Branch Name</td>
                            <td width="60%" class="tbl_input_td">
                                <div class="select-style">
                                    <select name="branchId" id="branchId">
                                        <option value="">Select Branch</option>
                                    </select>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Address<span>*</span></td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" data-name="name" name="address" id="address" value="" class="tbl_input" /> <!-- id="geocomplete" -->
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">City<span>*</span></td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" data-name="locality" name="city" id="city" value="" class="tbl_input" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Pin Code</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" data-name="postal_code" name="pinCode" id="pinCode" value="" class="tbl_input" onkeypress="return isNumberKey(event);" maxlength="6" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Phone</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="phone" id="phone" value="" class="tbl_input" onkeypress="return isNumberKey(event);" maxlength="11" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Fax</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="fax" id="fax" value="" class="tbl_input" onkeypress="return isNumberKey(event);" maxlength="11" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Mobile</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="mobile" id="mobile" value="" class="tbl_input" onkeypress="return isNumberKey(event);" maxlength="11" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Email</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="email" id="email" value="" class="tbl_input" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Web</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="web" id="web" value="" class="tbl_input" />
                            </td>
                        </tr>
                        <tr>
                            <td width="40%">Contact Person</td>
                            <td width="60%" class="tbl_input_td">
                                <input type="text" name="contactPerson" id="contactPerson" value="" class="tbl_input" />
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="cancel_bt" data-dismiss="modal">Cancel</button>
                <button type="button" class="saves_ok" onclick="return addCostCentre();">OK</button>
            </div>
        </div>
    </div>
</div>
<!--Dummy Material New Row-->
<table id="dummy-new-material" style="display: none;">
    <tbody>
    <tr>
        <td style="border-right:1px solid #ccc;"><input type="text" class="parent_text" name="newmaterial__1" id="newmaterial__1" align="right" readonly></td>
        <td width="3%"><button type="button" name="newwgdetails__1"id="newwgdetails__1" onclick="return ShowMaterial(this.id)" style="margin:0;background: transparent;" > <i class="fa fa-pencil-square-o ctlss"></i> </button></td>
        <input type="hidden" name="newmaterialid__1" id="newmaterialid__1" >
        <input type="hidden" name="newmunitid__1" id="newmunitid__1" >
        <input type="hidden" name="newmunitname__1" id="newmunitname__1" >
    </tr>
    </tbody>
</table>
<!--Dummy Rows-->
<table id="dummy-document" style="display: none;">
    <tbody>
    <tr>
        <td width="15%"><input class="parent_text" type="text" name="docType__1" id="docType__1" maxlength="155" onchange="addNewDocRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="docDesc__1" id="docDesc__1"></textarea></td>
        <td width="5%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a id="docAttachment__1" href="#"> <span  data-toggle="tooltip" data-placement="left" data-original-title="Click to attach documents" class="btn-file butclr_imp"> <i class="fa fa-paperclip dcm_atch dcm_atch"></i>
            <input type="file" name="docFile__1" id="docFile__1">
            </span> </a> </li>
                <li style="float:left;"> <a href="#" class="deleteDocTr__1" onclick="deleteDoc(this, event, 0);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Document Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-deposit" style="display: none;">
    <tbody>
    <tr>
        <td width="6%"><input class="parent_text" type="text" id="deposit__1" name="deposit__1"/></td>
        <td width="5%"><input class="parent_text" type="text" id="paymode__1" name="paymode__1" /></td>
        <td width="4%"><input class="parent_text" type="text" id="drefno__1" name="drefno__1"/></td>
        <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
            <input class="parent_text date_picker" type="text" id="drefdate__1" name="drefdate__1"/></td>
        <td width="7%"><input class="parent_text text-right" type="text" id="damount__1" name="damount__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewDepositRow(this)"/></td>
        <td width="4%" style="position:relative;"><span class="date_icon" style="margin-top:5px;"><i class="fa fa-calendar"></i></span>
            <input class="parent_text date_picker" type="text" id="dvaliddate__1" name="dvaliddate__1"/></td>
        <td width="1%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a class="deletedepositTr__1" href="#" onclick="deleteDeposit(this, event);"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-term" style="display: none;">
    <tbody>
    <tr>
        <td width="15%"><input class="parent_text" type="text" name="termTitle__1" id="termTitle__1" maxlength="155" onchange="addNewTermRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="termDesc__1" id="termDesc__1"></textarea></td>
        <td width="4%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTermTr__1" onclick="deleteTerm(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-tech" style="display: none;">
    <tbody>
    <tr>
        <td width="15%"><input class="parent_text" type="text" name="techTitle__1" id="techTitle__1" maxlength="155" onchange="addNewTechRow(this)"/></td>
        <td width="15%"><textarea class="parent_texts" name="techDesc__1" id="techDesc__1"></textarea></td>
        <td width="4%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a href="#" class="deleteTechTr__1" onclick="deleteTech(this, event);" style="display: none;"><span data-toggle="tooltip" data-placement="left" data-original-title="Term Delete"><i class="fa fa-trash-o"></i></span></a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-material" style="display: none;">
    <tbody>
    <tr class="padi05">
        <td width="7%"><input class="parent_text" type="text" name="materialName__1" id="materialName__1" onfocus="return checkMaterialPriceFocus(this.id)"/>
            <input type="hidden" class="materialNameInputs" name="materialId__1" id="materialId__1"/></td>
        <td width="2%"><input class="parent_padi05" type="text" name="materialUnit__1" id="materialUnit__1" value="" readonly/></td>
        <td width="4%"><input class="parent_text text-right" type="text" name="materialRate__1" id="materialRate__1" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="4%"><input class="parent_text text-right" type="text" name="escalationper__1" id="escalationper__1"  onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="2%"><div class="select-style heg30">
                <select name="materialbase__1" id="materialbase__1" />
                <option value=">">&gt;</option>
                <option value="<">&lt;</option>
                </select>
            </div>
        <td width="4%"><input class="parent_text text-right" type="text" name="materialnewRate__1" id="materialnewRate__1" onchange="addNewMaterialRow(this)" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="1%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a class="materialDeleteTr__1" href="#"  onclick="deleteMaterial(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-material-exclude" style="display: none;">
    <tbody>
    <tr class="padi05">
        <td width="15%"><input class="parent_text" type="text" name="materialExcName__1" id="materialExcName__1" onfocus="return checkMaterialSupplyFocus(this.id)"/>
            <input type="hidden" class="materialExcNameInputs" name="materialExcId__1" id="materialExcId__1"/></td>
        <td width="3%"><input class="parent_padi05" type="text" name="materialExcUnit__1" id="materialExcUnit__1" readonly/>
        <td width="3%"><input class="parent_text" type="text" name="materialExcRate__1" id="materialExcRate__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" onchange="addNewMaterialExcRow(this)"/>
        <td width="6%"><div class="select-style heg30">
                <select name="materialExcType__1" id="materialExcType__1" />
                <option value="C">Chargeable</option>
                <option value="F">Free</option>
                </select>
            </div>
        <td width="1%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a class="materialExcDeleteTr__1" href="#"  onclick="deleteMaterialExc(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-material-advance" style="display: none;">
    <tbody>
    <tr>
        <td width="7%"><input class="parent_text" type="text" name="materialAdvName__1" id="materialAdvName__1" onchange="addNewMaterialAdvRow(this)" onfocus="return checkMaterialAdvFocus(this.id)"/>
            <input type="hidden" class="materialAdvNameInputs"  name="materialAdvId__1" id="materialAdvId__1"/></td>
        <td width="2%"><input class="parent_text text-right" type="text" name="materialAdvRate__1" id="materialAdvRate__1" onchange="addNewMaterialAdvRow(this)" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18"/></td>
        <td width="1%" class="action_btns_td"><ul class="action_btns">
                <li style="float:left;"> <a class="materialAdvDeleteTr__1" href="#"  onclick="deleteMaterialAdv(this, event);" style="display: none;"> <span data-toggle="tooltip" data-placement="right" data-original-title="Delete"><i class="fa fa-trash-o"></i></span> </a> </li>
            </ul></td>
    </tr>
    </tbody>
</table>
<table id="dummy-boq" style="display: none;">
    <tbody>
    <tr id="boqrowrefid__1">
        <input type="hidden" name="boqtranstype__1" value = "I" id="boqtranstype__1">
        <input type="hidden" name="boqtransid__1" id="boqtransid__1"/>
        <input type="hidden" name="boqid__1" id="boqid__1" value="0"/>
        <input type="hidden" name="boqSortid__1" id="boqSortid__1" value="1"/>
        <input type="hidden" name="boqrefids[]" id="boqrefid__1" value="1"/>
        <td width="3%"><input class="parent_text" type="text" name="agtno__1" id="agtno__1" onchange="addNewBOQRow(this)"/></td>
        <td width="10%"><div class="on-focus clearfix" style="position:relative;overflow: hidden;">
                <div class="docu-spc">
                    <textarea class="parent_texts" name="spec__1" id="spec__1" onchange="addNewBOQRow(this)"></textarea>
                    <label>Short Spec</label>
                    <textarea class="parent_texts" name="shortspec__1" id="shortspec__1"></textarea>
                    <div class="tool-tip addbins slideIn">
                        <div class="bin">
                            <button class="tooltipBtn" type="button" name="newhead__1" id="newhead__1" onclick="AddNewHeader(this)" tabindex="-1">Add New Header</button>
                        </div>
                    </div>
                </div>
            </div></td>
        <!--      <td width="8%"><textarea class="parent_texts" name="shortspec__1" id="shortspec__1"></textarea></td>-->
        <td width="3%" class="boq-turnkey-txt"><input type="text" class="parent_text" name="unit__1" id="unit__1"/>
            <input type="hidden" name="unitid__1" id="unitid__1"/>
        <td width="3%" class="boq-turnkey-txt"><input class="parent_text text-right" type="text" name="qty__1" id="qty__1" onblur="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)"/></td>
        <td width="5%" class="boq-budget-txt"><input class="parent_text text-right" type="text" name="budgetamount__1" id="budgetamount__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)"/></td>
        <td width="4%" class="boq-overall-txt"><input class="parent_text text-right" type="text" name="crate__1" id="crate__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)"/></td>
        <td width="4%" class="boq-overall-txt"><input class="parent_text text-right" type="text" name="camt__1" id="camt__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18" readonly/></td>
        <td width="4%" class="boq-turnkey-txt"><input class="parent_text text-right" type="text" name="rate__1" id="rate__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)"/></td>
        <td width="5%" class="boq-amount-edit"><input class="parent_text text-right" type="text" name="amt__1" id="amt__1" onblur="return FormatNum(this, 2, true)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)" readonly/></td>
        <td width="4%" class="boq-overall-txt"><input class="parent_text text-right" type="text" name="ratevariance__1" id="ratevariance__1" onblur="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this)" maxlength="18" onchange="addNewBOQRow(this)" readonly/></td>
        <td width="1%" align="center"><ul class="action_btns">
                <li> <a href="#" class="boqdelete__1" name="boqdelete__1" id="boqdelete__1" style="display: none;" onclick="deleteboqTr(this, event); return false;"> <i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i> </a> </li>
            </ul>
            <input type="hidden" name="boqdelflag__1" id="boqdelflag__1" value="N"/></td>
    </tr>
    </tbody>
</table>
<table id="dummy-header" style="display: none;">
    <tbody>
    <tr id="boqrowrefid__1">
        <input type="hidden" name="boqtranstype__1" value = "H" id="boqtranstype__1">
        <input type="hidden" name="boqtransid__1" id="boqtransid__1"/>
        <input type="hidden" name="boqid__1" id="boqid__1" value="0"/>
        <input type="hidden" name="boqSortid__1" id="boqSortid__1" value="1"/>
        <input type="hidden" name="boqrefids[]" id="boqrefid__1" value="1"/>
        <td width="3%"><input class="parent_text" style="font-weight: bold!important" type="text" name="agtno__1" id="agtno__1" /></td>
        <td width="4%" colspan="2" class="headerTd"><textarea class="parent_texts" style="font-weight: bold!important" name="header__1" id="header__1" maxlength="255" placeholder="Enter Heading"></textarea></td>
        <td colspan="3" width="6%" class="headerTypeTd"><div class="radio_check">
                <p style="padding-top:10px;">
                    <input type="radio" name="headertype__1" value="W" id="radioWBS__1" class="ripple" checked>
                    <label for="radioWBS__1">WBS</label>
                </p>
                <p style="padding-top:10px;">
                    <input type="radio" name="headertype__1" id="radioWO__1" class="ripple" value="G">
                    <label for="radioWO__1">WG</label>
                </p>
                <p style="padding-top:10px;">
                    <input type="radio" name="headertype__1" id="radioPar__1" class="ripple" value="P">
                    <label for="radioPar__1">P</label>
                </p>
            </div></td>
        <td width="2%" align="center"><ul class="action_btns">
                <li> <a href="#" class="boqdelete__1" name="boqdelete__1" id="boqdelete__1" onclick="deleteboqTr(this, event); return false;"> <i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i> </a> </li>
            </ul>
            <input type="hidden" name="boqdelflag__1" id="boqdelflag__1" value="N"/></td>
    </tr>
    </tbody>
</table>
<div id="excelfieldmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="width: 75%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>BOQ Import Sheet - Assign Fields</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                    <table class="table" style=" margin-bottom:0px;">
                        <thead>
                        <tr id="excelfieldTable" class="padi05"></tr>
                        </thead>
                        <tbody >
                        <tr id="excelfield"> </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer"> <a href="#" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return fileupload()" >Next</button>
            </div>
        </div>
    </div>
</div>
<!--Modal-->
<div id="clientmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Client</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-8 col-lg-offset-2" style=" margin-top:15px !important;">
                    <div class="form-group">
                        <input type="text" class="form-control lbl_move tex-po" name="MClientName" id="MClientName" label="Client Name"/>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control lbl_move tex-po" name="MClientAddress" id="MClientAddress" label="Address"/>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control lbl_move tex-po" name="MCityId" id="MCityId" data-name="locality" label="City"/>
                        <input type="hidden" id="state" name="state" class="form-control" data-name="administrative_area_level_1"/>
                        <input type="hidden" id="country" name="country" class="form-control" data-name="country"/>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <div class="col-lg-12"> <a href="#" class="md_cance" data-dismiss="modal" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                    <button type="button" id="btn-newclient" class="md_ok" onclick="return ClientUpdate()">Create</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="excelmodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="width: 75%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>BOQ Import Sheet</h1>
            </div>
            <div class="modal-body">
                <div class="table-responsive topsp animated-panel zoomIn" style="overflow:visible;animation-delay: 0.2s;">
                    <table class="table" style=" margin-bottom:0px;" id="excelTable">
                        <thead>
                        <tr>
                            <th class="excel-wg-txt">WorkGroup</th>
                            <th>Agt No</th>
                            <th>Specification</th>
                            <th class="excel-sspec-txt">Short Spec</th>
                            <th>Unit</th>
                            <th>Qty</th>
                            <th class="excel-budget-txt">Budget</th>
                            <th class="excel-crate-txt">Client Rate</th>
                            <th class="excel-camt-txt">Client Amount</th>
                            <th>Rate</th>
                            <th>Amount</th>
                            <th class="excel-vrate-txt">Rate Variance %</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody >
                        <tr id="excelrowid_1" >
                            <td width="5%" class="excel-wg-txt"><input class="parent_text" type="text" id="excelworkgroup_1"/>
                                <input type="hidden" id="excelworkgroupid_1"></td>
                            <td width="5%"><input class="parent_text" type="text" id="excelagtno_1"/></td>
                            <td width="10%"><textarea class="parent_texts" id="excelspec_1"></textarea></td>
                            <td width="8%" class="excel-sspec-txt"><textarea class="parent_texts" id="excelshortspec_1"></textarea></td>
                            <td width="5%"><input type="text" class="parent_text" id="excelunit_1"/>
                                <input type="hidden" id="excelunitid_1"/></td>
                            <td width="3%"><input class="parent_text text-right" type="text" id="excelqty_1"/></td>
                            <td width="3%" class="excel-budget-txt"><input class="parent_text text-right" type="text" id="excelbudget_1"/></td>
                            <td width="4%" class="excel-crate-txt"><input class="parent_text text-right" type="text" id="excelcrate_1"/></td>
                            <td width="4%" class="excel-camt-txt"><input class="parent_text text-right" type="text" id="excelcamt_1"/></td>
                            <td width="4%"><input class="parent_text text-right" type="text" id="excelrate_1"/></td>
                            <td width="4%"><input class="parent_text text-right" type="text" id="excelamt_1"/></td>
                            <td width="4%" class="excel-vrate-txt"><input class="parent_text text-right" type="text" id="excelratevariance_1" readonly/></td>
                            <td width="1%" align="center"><ul class="action_btns">
                                    <li> <a href="#" class="excelboqdelete" onclick="exceldeleteboqTr(this, event);"> <i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i> </a> </li>
                                </ul></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer"> <a href="#" class="md_cance" data-dismiss="modal" data-toggle="tooltip" title="" data-original-title="Cancel" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                <button type="button" class="md_ok" onclick="return BOQUpdate()" >Apply</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
// UI Script
$('.responsive-tabs').responsiveTabs({
    accordionOn: ['xs', 'sm']
});

var arr_projecttypes = <?php echo (isset($projecttypes)) ? json_encode($projecttypes) : '[]';?>;
var arr_projects = <?php echo (isset($projects)) ? json_encode($projects) : '[]';?>;
var arr_clients = <?php echo (isset($clients)) ? json_encode($clients) : '[]';?>;
var arrayunitlist = <?php echo (isset($unit)) ? json_encode($unit) : '[]';?>;
var materiallists = <?php echo (isset($materiallists)) ? json_encode($materiallists) : '[]';?>;
var depositlist = <?php echo (isset($depositlist)) ? json_encode($depositlist) : '[]';?>;
var paymentmode = <?php echo (isset($paymentmode)) ? json_encode($paymentmode) : '[]';?>;

var materialPrice = materiallists;
var materialSupply = materiallists;
var materialaAdv = materiallists;
var bExcelWG = false;
var bExcelCRate = false;
var bExcelCAmt = false;
var bExcelVRate = false;
var bExcelShortSpec = false;

var $woType = $('#OrderType'),
    $WONo = $('#WONo'),
    $WODate = $('#WODate'),
    $ProjectName = $('#ProjectName'),
    $ProjectId= $('#ProjectId'),
    $WorkOrderId = $('#PWorkOrderId'),
    $ProjectDescription = $('#ProjectDescription'),
//$ProjectTypeName = $('#ProjectTypeName'),
//$ProjectTypeId = $('#ProjectTypeId'),
    $ClientName = $('#ClientName'),
    $ClientId = $('#ClientId'),
    $newProject = $('#newProject'),
    $newProjectType = $('#newProjectType');

var $ModalClientName = $('#MClientName'),
    $ModalClientAddress = $('#MClientAddress'),
    $ModalClientCity = $('#MCityId'),
    tmpClientData = null,
    $btn_newclient = $('#btn-newclient'),
    $btn_editclient = $('#btn-editclient');

var $ModalMaterial = $("#materialmodal"),
    $MMaterialName = $('#MMaterialName'),
    $MMaterialUnitName = $('#MMaterialUnitName'),
    $newMaterialHeader = $("#newMaterialHeader"),
    $btn_newmaterial = $("#btn-newmaterial");

var $AgreementType = $('#AgreementType');
var formData = new FormData();
var arrayField =[];
arrayField = [{ data :1, value: 'Agt No' },
    { data :2, value: 'WorkGroup' },
    { data :3, value: 'Specification' },
    { data :4, value: 'Short Spec' },
    { data :5, value: 'Unit' },
    { data :6, value: 'Qty' },
    { data :7, value: 'Rate' },
    { data :8, value: 'Amount' },
    { data :9, value: 'Client Rate' },
    { data :10, value: 'Client Amount' },
    { data :11, value: 'Rate Variance'},
    { data :12, value: 'Budget' }];

var arrayFieldR = arrayField;

function backfn() {
    <?php if($viewmode):?>
    $('#mainWrapper').hide();
    $('#indexWrapper').fadeIn();
    <?php else: ?>
//    window.location.replace(getBaseURL() + "cb/workorder/editheader/" + <?php //echo (isset($workorderid)) ? $workorderid:''; ?>//);
    <?php endif; ?>
}
function closedetails(key) {
    var $mainTRs = $("a[class*=mainTr_]");

    $.each($mainTRs, function (i, obj) {
        var $this = $(this),
            $mainTr = $this.find('> i.fa-chevron-circle-down.tform');

        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1)
            return;

        if($mainTr.length != 0)
            $mainTr.trigger('click');
    });
}

function entryValidate() {
    var isValid = true;
    if (parseInt(isNullCheck($('#businessType').val(),'number')) ==0) {
        isValid = false;
        showError($('#businessType'), 'Required');
        $('#businessType').focus();
    } else if (parseInt(isNullCheck($('#costCentreId').val(),'number')) ==0) {
        isValid = false;
        showError($('#costCentreId'), 'Required');
        $('#costCentreId').focus();
    } else if (parseInt(isNullCheck($('#ProjectTypeId').val(),'number')) ==0) {
        isValid = false;
        showError($('#ProjectTypeId'), 'Required');
        $('#ProjectTypeId').focus();
    } else if ($('#ProjectDescription').val().length ==0) {
        isValid = false;
        showError($('#ProjectDescription'), 'Required');
        $('#ProjectDescription').focus();
    }

    return isValid;
}

function bindAmendment(argPrevWOId) {
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + "project/tender/workorder",
        data: {rtype: 'PrevWorkOrder', data: argPrevWOId},
        async: false,
        type: 'post',
        success: function (data, status, xhr) {
            var detail = JSON.parse(data),
                woReg = detail['WORegister'],
                woNo = detail['WONo'],
                woTerms = detail['Terms'],
                woDocument = detail['Document'],
                woDeposit = detail['Deposit'],
                woOTerms = detail['OTerms'],
                woPriceEsc = detail['PriceEsc'],
                woSupply = detail['Supply'],
                woAdvance = detail['Advance'],
                woTech = detail['Tech'];
            //woBOQ = detail['BOQ'];

            //General
            $('#MWorkOrderNo').val(woNo);
            $('#AgreementNo').val(woReg['AgreementNo']);
            $('#AuthorityAddress').val(woReg['AuthorityAddress']);
            $('#AuthorityName').val(woReg['AuthorityName']);
            $('#AgreementType').val(woReg['AgreementType']).prop('disabled', true).select2({placeholder: ""});
            $('#InputAgreementType').val(woReg['AgreementType']);
            $('#PeriodType').val(woReg['PeriodType']);
            $('#Duration').val(sanitizeNumber(woReg['Duration'],0));
            $('#StartDate').datepicker({'format': 'dd-mm-yy'}).datepicker('setDate', woReg['StartDate']);
            $('#EndDate').val(woReg['EndDate']);
            $('#OrderPercent').val(sanitizeNumber(woReg['OrderPercent'],3));
            $('#OrderAmount').val(sanitizeNumber(woReg['OrderAmount'],2, true));
            if (woReg['AgreementDate'] != null)
                $('#AgreementDate').datepicker({'format': 'dd-mm-yyyy'}).datepicker('setDate', woReg['AgreementDate']);

            //Terms
            $('#billperiodtype').val(woTerms['PeriodType']);
            $('#billperiodday').val(sanitizeNumber(woTerms['PeriodDay'],0));
            $('#billperiodweekday').val(woTerms['PeriodWeekDay']);
            $('#MobilisationPercent').val(sanitizeNumber(woTerms['MobilisationPercent']));
            $('#MobilisationAmount').val(sanitizeNumber(woTerms['MobilisationAmount'],2 ,true));
            $('#MobilisationRecovery').val(sanitizeNumber(woTerms['MobilisationRecovery']));
            $('#RetentionPercent').val(sanitizeNumber(woTerms['RetentionPercent']));
            $('#PaymentSubmitPercent').val(sanitizeNumber(woTerms['PaymentSubmitPercent']));
            $('#PaymentFromSubmitDays').val(sanitizeNumber(woTerms['PaymentFromSubmitDays'], 0));
            $('#CertifyDays').val(sanitizeNumber(woTerms['CertifyDays'],0));
            $('#PaymentFromCertifyDays').val(sanitizeNumber(woTerms['PaymentFromCertifyDays'],0));
            $('#Notes').val(woTerms['Notes']);

            //Documents
            //reset doc table
            var $docEntryTbody = $('#docTable tbody');
            $docEntryTbody.html('');
            var $documentrowid = $('#documentrowid');
            $documentrowid.val(0);

            for (var j = 0; j < woDocument.length; j++) {
                var rowid = parseInt($documentrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-document tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $docEntryTbody.append(template);

                $documentrowid.val(count);

                $('#docType_' + count).val(woDocument[j]['Type']);
                $('#docDesc_' + count).val(woDocument[j]['Description']);

                //set document download
                if (woDocument[j]['URL'].trim() != '') {
                    $('#docAttachment_' + count).attr('href', getBaseURL() + woDocument[j]['URL'].substring(1)).addClass('pull-left')
                        .html('<i class="fa fa-file-o file-do" data-toggle="tooltip" data-placement="left" data-original-title="Download Attachment"></i>'
                        + '<input type="hidden" name="docFile_"'+count+' id="docFile_"'+count+' value="'+woDocument[j]['URL']+'">')
                        .attr('target', '_blank').attr('download', '')
                        .after('<i class="fa fa-chain-broken brkn" onclick="removeAttachment($(this));"></i>');
                }
                $('.deleteDocTr_' + count).show();
            }
            // add row
            var count = parseInt($documentrowid.val()) + 1,
                template = $('#dummy-document tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $docEntryTbody.append(template);
            $documentrowid.val(count);

            //Deposit
            //reset deposit table
            var $depositEntryTbody = $('#depositTable tbody');
            $depositEntryTbody.html('');
            var $depositrowid = $('#depositrowid');
            $depositrowid.val(0);

            for (var m = 0; m < woDeposit.length; m++) {
                var rowid = parseInt($depositrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-deposit tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $depositEntryTbody.append(template);

                $depositrowid.val(count);

                $('#deposit_' + count).val(woDeposit[m]['DepositType']);
                $('#paymode_' + count).val(woDeposit[m]['DepostMode']);
                $('#drefno_' + count).val(woDeposit[m]['RefNo']);
                $('#drefdate_' + count).datepicker({'format': 'dd-mm-yyyy'}).datepicker('setDate', woDeposit[m]['RefDate']);
                $('#damount_' + count).val(sanitizeNumber(woDeposit[m]['Amount'],2, true));
                $('#dvaliddate_' + count).datepicker({'format': 'dd-mm-yy'}).datepicker('setDate', woDeposit[m]['ValidUpto']);

                $('.deletedepositTr_' + count).show();
            }
            // add row
            var count = parseInt($depositrowid.val()) + 1,
                template = $('#dummy-deposit tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $depositEntryTbody.append(template);
            $depositrowid.val(count);

            binddepositAutoComplete();
            bindpaymentmodeAutoComplete();

            //OtherTerms
            // reset otherTerms table
            var $otherTermsEntryTbody = $('#otherTermsTable tbody:not(.total)');
            $otherTermsEntryTbody.html('');
            var $termrowid = $('#termrowid');
            $termrowid.val(0);

            for (var p = 0; p < woOTerms.length; p++) {
                var rowid = parseInt($termrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-term tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $otherTermsEntryTbody.append(template);

                $termrowid.val(count);

                $('#termTitle_' + count).val(woOTerms[p]['TermsTitle']);
                $('#termDesc_' + count).val(woOTerms[p]['TermsDescription']);

                $('.deleteTermTr_' + count).show();
            }
            // add row
            var count = parseInt($termrowid.val()) + 1,
                template = $('#dummy-term tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $otherTermsEntryTbody.append(template);
            $termrowid.val(count);

            //PriceEscalation
            //reset deposit table
            var $materialEntryTbody = $('#materialTable tbody:not(.total)');
            $materialEntryTbody.html('');
            var $materialrowid = $('#materialrowid');
            $materialrowid.val(0);

            for (var r = 0; r < woPriceEsc.length; r++) {
                var rowid = parseInt($materialrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-material tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $materialEntryTbody.append(template);

                $materialrowid.val(count);

                $('#materialName_' + count).val(woPriceEsc[r]['MaterialName']);
                $('#materialId_' + count).val(woPriceEsc[r]['MaterialId']);
                $('#materialUnit_' + count).val(woPriceEsc[r]['UnitName']);
                $('#materialRate_' + count).val(sanitizeNumber(woPriceEsc[r]['Rate'],2, true));
                $('#escalationper_' + count).val(sanitizeNumber(woPriceEsc[r]['EscalationPer'],2));
                $('#materialbase_' + count).val(woPriceEsc[r]['RateCondition']);
                $('#materialnewRate_' + count).val(sanitizeNumber(woPriceEsc[r]['ActualRate'],2, true));

                $('.materialDeleteTr_' + count).show();
            }
            // add row
            var count = parseInt($materialrowid.val()) + 1,
                template = $('#dummy-material tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $materialEntryTbody.append(template);
            $materialrowid.val(count);

            bindMaterialBaseAutoComplete();

            //MaterialSupply
            //reset material supply table
            var $materialExcEntryTbody = $('#materialExcTable tbody:not(.total)');
            $materialExcEntryTbody.html('');
            var $materialExcrowid = $('#materialExcrowid');
            $materialExcrowid.val(0);

            for (var t = 0; t < woSupply.length; t++) {
                var rowid = parseInt($materialExcrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-material-exclude tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $materialExcEntryTbody.append(template);

                $materialExcrowid.val(count);

                $('#materialExcName_' + count).val(woSupply[t]['MaterialName']);
                $('#materialExcId_' + count).val(woSupply[t]['MaterialId']);
                $('#materialExcUnit_' + count).val(woSupply[t]['UnitName']);
                $('#materialExcRate_' + count).val(sanitizeNumber(woSupply[t]['Rate'],2, true));
                $('#materialExcType_' + count).val(woSupply[t]['SType']);

                $('.materialExcDeleteTr_' + count).show();
            }
            // add row
            var count = parseInt($materialExcrowid.val()) + 1,
                template = $('#dummy-material-exclude tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $materialExcEntryTbody.append(template);
            $materialExcrowid.val(count);

            bindMaterialExcAutoComplete();

            //MaterialAdvance
            //reset material advance table
            var $materialAdvEntryTbody = $('#materialAdvTable tbody:not(.total)');
            $materialAdvEntryTbody.html('');
            var $materialAdvrowid = $('#materialAdvrowid');
            $materialAdvrowid.val(0);
            for (var v = 0; v < woAdvance.length; v++) {
                var rowid = parseInt($materialAdvrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-material-advance tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $materialAdvEntryTbody.append(template);

                $materialAdvrowid.val(count);

                $('#materialAdvName_' + count).val(woAdvance[v]['MaterialName']);
                $('#materialAdvId_' + count).val(woAdvance[v]['MaterialId']);
                $('#materialAdvRate_' + count).val(sanitizeNumber(woAdvance[v]['AdvPercent'],2));

                $('.materialAdvDeleteTr_' + count).show();
            }
            // add row
            var count = parseInt($materialAdvrowid.val()) + 1,
                template = $('#dummy-material-advance tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $materialAdvEntryTbody.append(template);
            $materialAdvrowid.val(count);

            bindMaterialAdvAutoComplete();

            //TechSpec
            //reset tech spec table
            var $techTitleEntryTbody = $('#techTitleTable tbody:not(.total)');
            $techTitleEntryTbody.html('');
            var $techrowid = $('#techrowid');
            $techrowid.val(0);

            for (var x = 0; x < woTech.length; x++) {
                var rowid = parseInt($techrowid.val());
                var count = rowid + 1,
                    template = $('#dummy-tech tbody').html();
                template = template.replace(/__1/g, '_' + count);
                $techTitleEntryTbody.append(template);

                $techrowid.val(count);

                $('#techTitle_' + count).val(woTech[x]['Title']);
                $('#techDesc_' + count).val(woTech[x]['Specification']);

                $('.deleteTechTr_' + count).show();
            }
            // add row
            var count = parseInt($techrowid.val()) + 1,
                template = $('#dummy-tech tbody').html();
            template = template.replace(/__1/g, '_' + count);
            $techTitleEntryTbody.append(template);
            $techrowid.val(count);
        }, error:function(jqXHR, textStatus, errorThrown){
            $('.loading_area').hide();
        }
    });
}


function submitForm() {
    <?php if($viewmode):?>
    validateIndex();
    <?php endif; ?>
    var $OrderType = $('#OrderType');
    var $AgreementNo = $('#AgreementNo');
    var $AgreementDate = $('#AgreementDate');
    var $AuthorityAddress = $('#AuthorityAddress');
    var $AuthorityName = $('#AuthorityName');
    var $Duration = $('#Duration');
    var $StartDate = $('#StartDate');
    var $EndDate = $('#EndDate');
    var $OrderPercent = $('#OrderPercent');

    if($AgreementNo.val().length == 0 && $AgreementNo.val() == 0) {
        alert('AgreementNo should not be empty');
        $AgreementNo.focus();
        return false;
    } else if($AgreementDate.val().length == 0) {
        alert('AgreementDate should not be empty');
        $AgreementDate.focus();
        return false;
    }
//        else if($AuthorityAddress.val().length == 0 && $AuthorityAddress.val() == 0) {
//            alert('AuthorityAddress should not be empty');
//			$AuthorityAddress.focus();
//            return false;
//        } else if($AuthorityName.val().length == 0 && $AuthorityName.val() == 0) {
//            alert('AuthorityName should not be empty');
//			$AuthorityName.focus();
//            return false;
//        }
    else if($Duration.val().length == 0 && $Duration.val() == 0) {
        alert('Duration should not be empty');
        $Duration.focus();
        return false;
    } else if($StartDate.val().length == 0) {
        alert('StartDate should not be empty');
        $StartDate.focus();
        return false;
    } else if($EndDate.val().length == 0) {
        alert('EndDate should not be empty');
        $EndDate.focus();
        return false;
    } else if($ProjectDescription.val().length == 0) {
        alert('Project Name should not be empty');
        $ProjectDescription.focus();
        return false;
    } else {
        var $formWrapper = $('#formWrapper');
        var $errIps = $formWrapper.find('input.error');

        if($errIps.length === 0) {
            setPageChanges(false);
            $('.loading_area').show();
            $formWrapper.submit();
        } else {
            $errIps.first().closest('.panel').find('.panel-heading').trigger('click');
            $errIps.first().focus();
            alert('Input error!');
        }
    }
}

var localProjectName = '',
    localPrevWorkOrderId = 0;
function validateIndex() {
    var projectName = $ProjectName.val(),
    //projectDesc = $ProjectDescription.val(),
        workOrderNo = $WONo.val(),
        workOrderDate = $WODate.val(),
        clientName = $ClientName.val();

    if(projectName.length == 0 || projectName.length ==null) {
        alert('Project Name is required!');
        $ProjectName.focus();
        return false;

    }

    // check for project name if its new
    if($ProjectId.val() == 'new' && localProjectName != projectName) {
        localProjectName = projectName;
        var isNameValid = true;
        $('.loading_area').show();
        $.ajax({
            url: getBaseURL() + 'cb/workorder/checkprojectfound',
            type: "post",
            data: {'ProjectName': projectName},
            async: false,
            success: function (data, textStatus, jqXHR) {
                if(data == 'Y')
                    isNameValid = false;
                else
                    isNameValid = true;

                $('.loading_area').hide();
            }, error: function (jqXHR, textStatus, errorThrown) {
                isNameValid = false;
                $('.loading_area').hide();
            }
        });
        if (!isNameValid) {
            alert('Project Name Already Exists!');
            return false;
        }
    }

    if($woType.val().length == 0 || $woType.val().length ==null) {
        alert('Work Order Type is required!');
        $woType.focus();
        return false;
    }

    if(workOrderNo.length == 0 || workOrderNo.length ==null) {
        alert('Work Order No. is required!');
        $WONo.focus();
        return false;
    }

    if($WONo.hasClass('error')) {
        alert('Work Order No. already exists!');
        $WONo.focus();
        return false;
    }

    if(workOrderDate.length == 0 || workOrderDate.length ==null) {
        alert('Work Order Date is required!');
        $WODate.focus();
        return false;
    }

    if($WODate.val().length == 0 || $WODate.length ==null) {
        alert('Work Order Date is required!');
        $WODate.focus();
        return false;
    }
    if ($woType.val() != 'A') {
        /*if ($ProjectTypeName.val().length == 0 || $ProjectTypeName.val().length ==null || $ProjectTypeId.val().length == 0 || $ProjectTypeId.val().length ==null || $ProjectTypeId.val() == 0) {
         alert('Project Type is required!');
         $ProjectTypeName.focus();
         return false;
         }*/
        if (clientName.length == 0 || clientName.length ==null || $ClientId.val().length == 0 || $ClientId.val().length ==null || $ClientId.val() == 0) {
            alert('Client Name is required!');
            $ClientName.focus();
            return false;
        }
        if ($ProjectName.val().length == 0 || $ProjectName.val().length ==null) {
            alert('Project is required!');
            $ProjectName.focus();
            return false;
        }
    } else {
        if(isNullCheck($('#PrevWorkOrderId').val(),'number') ==0) {
            alert('Select Work Order to be Amended');
            return false;
        }
        $woType.prop('readonly', true);
        $('#cbowo').prop('readonly', true);

        var iPrevWorkOrderId = isNullCheck($('#PrevWorkOrderId').val(),'number');
        if (iPrevWorkOrderId != localPrevWorkOrderId) {
            localPrevWorkOrderId = iPrevWorkOrderId;
            $('.loading_area').show();
            $.ajax({
                url: getBaseURL() + "project/tender/workorder",
                data: {rtype: 'PrevWorkOrder', data: iPrevWorkOrderId},
                async: false,
                type: 'post',
                success: function (data, status, xhr) {
                    var detail = JSON.parse(data),
                        woReg = detail['WORegister'],
                        woTerms = detail['Terms'],
                        woDocument = detail['Document'],
                        woDeposit = detail['Deposit'],
                        woOTerms = detail['OTerms'],
                        woPriceEsc = detail['PriceEsc'],
                        woSupply = detail['Supply'],
                        woAdvance = detail['Advance'],
                        woTech = detail['Tech'];
                    //woBOQ = detail['BOQ'];

                    //General
                    $('#AgreementNo').val(woReg['AgreementNo']);
                    $('#AuthorityAddress').val(woReg['AuthorityAddress']);
                    $('#AuthorityName').val(woReg['AuthorityName']);
                    $('#AgreementType').val(woReg['AgreementType']).prop('disabled', true).select2({placeholder: ""});
                    $('#InputAgreementType').val(woReg['AgreementType']);
                    $('#PeriodType').val(woReg['PeriodType']);
                    $('#Duration').val(sanitizeNumber(woReg['Duration'],0));
                    $('#StartDate').datepicker({'format': 'dd-mm-yy'}).datepicker('setDate', woReg['StartDate']);
                    $('#EndDate').val(woReg['EndDate']);
                    $('#OrderPercent').val(sanitizeNumber(woReg['OrderPercent'],3));
                    $('#OrderAmount').val(sanitizeNumber(woReg['OrderAmount'],2, true));
                    if (woReg['AgreementDate'] != null)
                        $('#AgreementDate').datepicker({'format': 'dd-mm-yy'}).datepicker('setDate', woReg['AgreementDate']);

                    //Terms
                    $('#billperiodtype').val(woTerms['PeriodType']);
                    $('#billperiodday').val(sanitizeNumber(woTerms['PeriodDay'],0));
                    $('#billperiodweekday').val(woTerms['PeriodWeekDay']);
                    $('#MobilisationPercent').val(sanitizeNumber(woTerms['MobilisationPercent']));
                    $('#MobilisationAmount').val(sanitizeNumber(woTerms['MobilisationAmount'],2 ,true));
                    $('#MobilisationRecovery').val(sanitizeNumber(woTerms['MobilisationRecovery']));
                    $('#RetentionPercent').val(sanitizeNumber(woTerms['RetentionPercent']));
                    $('#PaymentSubmitPercent').val(sanitizeNumber(woTerms['PaymentSubmitPercent']));
                    $('#PaymentFromSubmitDays').val(sanitizeNumber(woTerms['PaymentFromSubmitDays'], 0));
                    $('#CertifyDays').val(sanitizeNumber(woTerms['CertifyDays'],0));
                    $('#PaymentFromCertifyDays').val(sanitizeNumber(woTerms['PaymentFromCertifyDays'],0));
                    $('#Notes').val(woTerms['Notes']);

                    //Documents
                    //reset doc table
                    var $docEntryTbody = $('#docTable tbody');
                    $docEntryTbody.html('');
                    var $documentrowid = $('#documentrowid');
                    $documentrowid.val(0);

                    for (var j = 0; j < woDocument.length; j++) {
                        var rowid = parseInt($documentrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-document tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $docEntryTbody.append(template);

                        $documentrowid.val(count);

                        $('#docType_' + count).val(woDocument[j]['Type']);
                        $('#docDesc_' + count).val(woDocument[j]['Description']);

                        //set document download
                        if (woDocument[j]['URL'].trim() != '') {
                            $('#docAttachment_' + count).attr('href', getBaseURL() + woDocument[j]['URL'].substring(1)).addClass('pull-left')
                                .html('<i class="fa fa-file-o file-do" data-toggle="tooltip" data-placement="left" data-original-title="Download Attachment"></i>'
                                + '<input type="hidden" name="docFile_"'+count+' id="docFile_"'+count+' value="'+woDocument[j]['URL']+'">')
                                .attr('target', '_blank').attr('download', '')
                                .after('<i class="fa fa-chain-broken brkn" onclick="removeAttachment($(this));"></i>');
                        }
                        $('.deleteDocTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($documentrowid.val()) + 1,
                        template = $('#dummy-document tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $docEntryTbody.append(template);
                    $documentrowid.val(count);

                    //Deposit
                    //reset deposit table
                    var $depositEntryTbody = $('#depositTable tbody');
                    $depositEntryTbody.html('');
                    var $depositrowid = $('#depositrowid');
                    $depositrowid.val(0);

                    for (var m = 0; m < woDeposit.length; m++) {
                        var rowid = parseInt($depositrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-deposit tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $depositEntryTbody.append(template);

                        $depositrowid.val(count);

                        $('#deposit_' + count).val(woDeposit[m]['DepositType']);
                        $('#paymode_' + count).val(woDeposit[m]['DepostMode']);
                        $('#drefno_' + count).val(woDeposit[m]['RefNo']);
                        $('#drefdate_' + count).datepicker({'format': 'dd-mm-yyyy'}).datepicker('setDate', woDeposit[m]['RefDate']);
                        $('#damount_' + count).val(sanitizeNumber(woDeposit[m]['Amount'],2, true));
                        $('#dvaliddate_' + count).datepicker({'format': 'dd-mm-yy'}).datepicker('setDate', woDeposit[m]['ValidUpto']);

                        $('.deletedepositTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($depositrowid.val()) + 1,
                        template = $('#dummy-deposit tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $depositEntryTbody.append(template);
                    $depositrowid.val(count);

                    binddepositAutoComplete();
                    bindpaymentmodeAutoComplete();

                    //OtherTerms
                    // reset otherTerms table
                    var $otherTermsEntryTbody = $('#otherTermsTable tbody:not(.total)');
                    $otherTermsEntryTbody.html('');
                    var $termrowid = $('#termrowid');
                    $termrowid.val(0);

                    for (var p = 0; p < woOTerms.length; p++) {
                        var rowid = parseInt($termrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-term tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $otherTermsEntryTbody.append(template);

                        $termrowid.val(count);

                        $('#termTitle_' + count).val(woOTerms[p]['TermsTitle']);
                        $('#termDesc_' + count).val(woOTerms[p]['TermsDescription']);

                        $('.deleteTermTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($termrowid.val()) + 1,
                        template = $('#dummy-term tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $otherTermsEntryTbody.append(template);
                    $termrowid.val(count);

                    //PriceEscalation
                    //reset deposit table
                    var $materialEntryTbody = $('#materialTable tbody:not(.total)');
                    $materialEntryTbody.html('');
                    var $materialrowid = $('#materialrowid');
                    $materialrowid.val(0);

                    for (var r = 0; r < woPriceEsc.length; r++) {
                        var rowid = parseInt($materialrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-material tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $materialEntryTbody.append(template);

                        $materialrowid.val(count);

                        $('#materialName_' + count).val(woPriceEsc[r]['MaterialName']);
                        $('#materialId_' + count).val(woPriceEsc[r]['MaterialId']);
                        $('#materialUnit_' + count).val(woPriceEsc[r]['UnitName']);
                        $('#materialRate_' + count).val(sanitizeNumber(woPriceEsc[r]['Rate'],2, true));
                        $('#escalationper_' + count).val(sanitizeNumber(woPriceEsc[r]['EscalationPer'],2));
                        $('#materialbase_' + count).val(woPriceEsc[r]['RateCondition']);
                        $('#materialnewRate_' + count).val(sanitizeNumber(woPriceEsc[r]['ActualRate'],2, true));

                        $('.materialDeleteTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($materialrowid.val()) + 1,
                        template = $('#dummy-material tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $materialEntryTbody.append(template);
                    $materialrowid.val(count);

                    bindMaterialBaseAutoComplete();

                    //MaterialSupply
                    //reset material supply table
                    var $materialExcEntryTbody = $('#materialExcTable tbody:not(.total)');
                    $materialExcEntryTbody.html('');
                    var $materialExcrowid = $('#materialExcrowid');
                    $materialExcrowid.val(0);

                    for (var t = 0; t < woSupply.length; t++) {
                        var rowid = parseInt($materialExcrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-material-exclude tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $materialExcEntryTbody.append(template);

                        $materialExcrowid.val(count);

                        $('#materialExcName_' + count).val(woSupply[t]['MaterialName']);
                        $('#materialExcId_' + count).val(woSupply[t]['MaterialId']);
                        $('#materialExcUnit_' + count).val(woSupply[t]['UnitName']);
                        $('#materialExcRate_' + count).val(sanitizeNumber(woSupply[t]['Rate'],2, true));
                        $('#materialExcType_' + count).val(woSupply[t]['SType']);

                        $('.materialExcDeleteTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($materialExcrowid.val()) + 1,
                        template = $('#dummy-material-exclude tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $materialExcEntryTbody.append(template);
                    $materialExcrowid.val(count);

                    bindMaterialExcAutoComplete();

                    //MaterialAdvance
                    //reset material advance table
                    var $materialAdvEntryTbody = $('#materialAdvTable tbody:not(.total)');
                    $materialAdvEntryTbody.html('');
                    var $materialAdvrowid = $('#materialAdvrowid');
                    $materialAdvrowid.val(0);
                    for (var v = 0; v < woAdvance.length; v++) {
                        var rowid = parseInt($materialAdvrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-material-advance tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $materialAdvEntryTbody.append(template);

                        $materialAdvrowid.val(count);

                        $('#materialAdvName_' + count).val(woAdvance[v]['MaterialName']);
                        $('#materialAdvId_' + count).val(woAdvance[v]['MaterialId']);
                        $('#materialAdvRate_' + count).val(sanitizeNumber(woAdvance[v]['AdvPercent'],2));

                        $('.materialAdvDeleteTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($materialAdvrowid.val()) + 1,
                        template = $('#dummy-material-advance tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $materialAdvEntryTbody.append(template);
                    $materialAdvrowid.val(count);

                    bindMaterialAdvAutoComplete();

                    //TechSpec
                    //reset tech spec table
                    var $techTitleEntryTbody = $('#techTitleTable tbody:not(.total)');
                    $techTitleEntryTbody.html('');
                    var $techrowid = $('#techrowid');
                    $techrowid.val(0);

                    for (var x = 0; x < woTech.length; x++) {
                        var rowid = parseInt($techrowid.val());
                        var count = rowid + 1,
                            template = $('#dummy-tech tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $techTitleEntryTbody.append(template);

                        $techrowid.val(count);

                        $('#techTitle_' + count).val(woTech[x]['Title']);
                        $('#techDesc_' + count).val(woTech[x]['Specification']);

                        $('.deleteTechTr_' + count).show();
                    }
                    // add row
                    var count = parseInt($techrowid.val()) + 1,
                        template = $('#dummy-tech tbody').html();
                    template = template.replace(/__1/g, '_' + count);
                    $techTitleEntryTbody.append(template);
                    $techrowid.val(count);
                }, error:function(jqXHR, textStatus, errorThrown){
                    $('.loading_area').hide();
                }
            });
        }
    }

    calculateBOQRate();
    $('#indexWrapper').hide();
    $('#mainWrapper').fadeIn();

    // Bind Display Info
    $('#MProjectName').html(projectName);
    //$('#MProjectDescription').html((projectDesc == "") ? 'N/A' : projectDesc);
    $('#MWorkOrderNo').html(workOrderNo);
    $('#MWorkOrderDate').html(workOrderDate);
    $('#MWOClientName').html(clientName);

    if($('#workorderid').val() == 0) {
        if ($woType.val() == 'N') {
            var tenquiryId = $ProjectId.val();
            var nwoId = '';
        } else if ($woType.val() == 'A') {
            var tenquiryId = '';
            var nwoId = $('#cbowo').val();
        }
    } else {
        var tenquiryId = '';
        var nwoId = $('#workorderid').val();
    }

    $.ajax({
        url: getBaseURL() + "project/tender/load-boq",
        data: {enquiryId: tenquiryId, woId: nwoId},
        async: false,
        type: 'post',
        success: function (data, status, xhr) {
            $('#loadBoq').html(data);
            $('.loading_area').hide();
        }, error:function(jqXHR, textStatus, errorThrown){
            $('.loading_area').hide();
        }
    });
}

function ProjectChange(val) {
    $ProjectName.removeClass('error');
    if($ProjectId.val().length != 0 && $ProjectId.val() != 'new' ) {
        $ProjectDescription.val('');
        //$ProjectTypeName.val('');
        //$ProjectDescription.prop('readonly', true);
        //$ProjectTypeName.prop('readonly', true);
        /*if($ProjectId.val().length == 0 && $ProjectId.val() == 'new') {
         //alert('Work Order Type should be "New Work Order" for new project!');
         $woType.find('option[value="N"]').prop('selected', true);
         $woType.prop('readonly', true);
         $woType.trigger('change');
         //$woType.addClass('error');
         return;
         } else{
         $woType.find('option[value="A"]').prop('selected', true);
         $woType.prop('readonly', false);
         $woType.trigger('change');
         //bindAmentWOAutoComplete($ProjectId.val());
         }*/
        $woType.find('option[value="N"]').prop('selected', true);
        $woType.prop('readonly', true);
        $woType.trigger('change');

        // fetch data
        $('.loading_area').show();
        $.ajax({
            url: getBaseURL() + "project/tender/workorder",
            data: {rtype:'projectdetails',data:$ProjectId.val()},
            async: false,
            type: 'post',
            success: function(data,status, xhr) {
                var detail = JSON.parse(data);
                $ProjectDescription.val(detail.NameofWork);
                $ProjectDescription.trigger('change');

                //$ProjectTypeName.val(detail.ProjectTypeName);
                //$ProjectTypeId.val(detail.ProjectTypeId);
                //$ProjectTypeName.trigger('change');
                $('.loading_area').hide();
            }, error:function(jqXHR, textStatus, errorThrown){
                $('.loading_area').hide();
            }
        });
        return;
    }
    //$ProjectDescription.prop('readonly', false).val('');
    //$ProjectTypeName.prop('readonly', false).val('');
}

function WOChange(val) {
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + "project/tender/workorder",
        data: {rtype:'Amendment',data:val },
        async: false,
        type: 'post',
        success: function(data,status, xhr) {
            var detail = JSON.parse(data);
            $('#WONo').val(detail[0]);
            $('#PrevWorkOrderId').val(detail[1]);
            $('.loading_area').hide();
        }, error:function(jqXHR, textStatus, errorThrown){
            $('.loading_area').hide();
        }
    });
    return;
}

function WOTypeChange(val) {
    $WONo.removeClass('error');
    $woType.removeClass('error');
    $woType.val(val);
    $('#Order').val($woType.val());
    if(val == 'A') {
        //$ProjectDescription.prop('readonly', true);
        $('#workorder').show();
        // fetch data
        $('.loading_area').show();
        $.ajax({
            url: getBaseURL() + "project/tender/workorder",
            data: {rtype:'projectworkorders',data:$ProjectId.val()},
            async: false,
            type: 'post',
            success: function(data,status, xhr) {
                var detail = JSON.parse(data);
                $('#cbowo').children().remove();

                for (j = 0; j < detail.length; j++) {
                    $('#cbowo').append('<option value="'+detail[j]['WORegisterId']+'">'+detail[j]['WONo']+'</option>');
                }
                $('#cbowo').trigger('change');
                $('.loading_area').hide();
            }, error:function(jqXHR, textStatus, errorThrown){
                $('.loading_area').hide();
            }
        });
        return;
    } else {
        $('#workorder').hide();
        $('#WONo').prop('readonly', false).val('');
        //$ProjectTypeName.prop('readonly', false).val('');
        //$ProjectDescription.prop('readonly', false);
    }
}

function CheckWONo(x, value) {
    var $el = $(x);
    $el.removeClass('error');
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + "project/tender/workorder",
        data: {rtype:'orderno',data:value},
        async: false,
        type: 'post',
        success: function(data,status) {
            if (data == "Y") {
                $el.addClass('error');
                alert('Work Order No. already exists!');
            }
            $('.loading_area').hide();
        }, error:function(jqXHR, textStatus, errorThrown){
            $('.loading_area').hide();
        }
    });
}

function CheckMaterialName(x, value) {
    var $el = $(x);
    removeError($el);
    $.ajax({
        url: getBaseURL() + "cb/workorder/index/"+value,
        data: {rtype:'materialname'},
        async: false,
        type: 'post',
        success: function(data,status) {
            if (data == "Y") {
                showError($el,'Material Name already exists!');
            }
        }
    });
}

$(function () {
    // select2 initialize
    $(".single_dropdown2").select2({
        placeholder: ""
    });

    // on modal show/hide
    $(window).on('shown.bs.modal', function() {
        $('body').addClass('modal-open').css('padding-right','10px');
    }).on('hidden.bs.modal', function() {
        $('body').removeClass('modal-open').css('padding-right','');
    });

    /*$ProjectTypeName.autocomplete({
     lookup: arr_projecttypes,
     lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
     if (queryLowerCase == '*') {
     return suggestion.value;
     } else {
     var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
     return re.test(suggestion.value);
     }
     }, onSelect: function (suggestion) {
     if (suggestion) {
     $ProjectTypeId.val(suggestion.data);
     $newProjectType.hide()
     }
     }, onSearchStart: function (suggestion) {
     $ProjectTypeId.val(0);
     }, onSearchComplete: function (query, suggestions) {
     if (!suggestions.length) {
     $newProjectType.show();
     $ProjectTypeId.val('new');
     } else $newProjectType.hide();
     }
     });*/

    var today = new Date();
    $('input.date_picker[id^="dvaliddate_"]').datepicker({'format': 'dd-mm-yyyy', startDate: today });

    var iWORegId = parseInt(isNullCheck($('#workorderid').val(),'number'));
//    var ipWORegId = parseInt(isNullCheck($('#PWorkOrderId').val(),'number'));
    var iEnquiryId = parseInt(isNullCheck($('#enquiryId').val(),'number'));
//    if (ipWORegId !=0) {
//        bindAmendment(ipWORegId)
//    }

    loadBOQ(iEnquiryId,iWORegId);
    bindClientAutoComplete();
    bindUnitAutoComplete();
    nextAccordian(1);
    bindMaterialBaseAutoComplete();
    bindMaterialExcAutoComplete();
    bindMaterialAdvAutoComplete();
    bindBOQSortablefn();
    binddepositAutoComplete();
    bindpaymentmodeAutoComplete();
    bindDocAttached();
    changeBillPeriod($('#billperiodtype').val());
    calculateBOQRate();
//        changeAgreementType();
    changeBudgetType();

    // prompt dialog on page navigation
    //initPageChangeFn();

    // show/hide add new header
//        var $specEls = $('textarea[id^=spec_],textarea[id^=shortspec_]');
    $('body').on('focus', 'textarea[id^=spec_],textarea[id^=shortspec_]', function () {
        $(this).parents('.on-focus').addClass('expandDiv');
    });
    $('body').on('blur', 'textarea[id^=spec_],textarea[id^=shortspec_]', function (e) {
        if(!$('.tooltipBtn').is(':focus'))
            return;

        $(this).parents('.on-focus').removeClass('expandDiv');
    });

    $(document).on('click', function() {
        toogleTooltip();
    });
    $(document).on('keydown',function() {
        toogleTooltip();
    });

    $('#boq-clear').on('click', function (e) {
        e.preventDefault();
        //reset boq table
        var $boqEntryTbody = $('#boqTable tbody:not(.total)');
        $boqEntryTbody.html('');
        var $boqrowid = $('#boqrowid');
        $boqrowid.val(0);
        $boqrowid.after('<input type="hidden" name="deleteBOQs" value="1"/>');

        $boqEntryTbody.append($('#dummy-boq tbody').html().replace(/__1/g, '_' + 1));
        $boqrowid.val(1);
        calculateBOQRate();

        // enable select
        $('#AgreementType').removeAttr('disabled');
        $('#BudgetType').removeAttr('disabled');

        $(this).parent('span').hide();
        return false;
    });

    if (parseFloat(isNullCheck($('#OrderAmount').val(),'number')) ==0)
    {
        $('#OrderAmount').val(sanitizeNumber(parseFloat(isNullCheck($('#totalwovalue').val(),'number')),2,true)).trigger('change');
    }

});

function loadBOQ(enquiryid,woregid) {
    $.ajax({
        url: getBaseURL() + "project/tender/load-boq",
        data: {enquiryId: enquiryid, woId: woregid},
        async: false,
        type: 'post',
        success: function (data, status, xhr) {
            $('#loadBoq').html(data);
            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            $('.loading_area').hide();
        }
    });
}



function toogleTooltip() {
    var $expandDivs = $('.expandDiv');
    if($expandDivs.length == 0)
        return;

    var $focused_el = $('textarea').filter(':focus');
    if ($focused_el.length == 0) {
        $expandDivs.removeClass('expandDiv').find('textarea').trigger('blur');
        return;
    }

    var $parent_focus = $focused_el.parents('.on-focus');
    if($parent_focus.length != 0) {
        $expandDivs.not($parent_focus).removeClass('expandDiv');
        $expandDivs.not($parent_focus).find('textarea').trigger('blur');
        return;
    }
}
function bindDocAttached() {
    var docFiles = $('input[id^=docFile_]');
    docFiles.unbind('change');

    docFiles.on('change', function() {
        var $this = $(this);
        var $tarEl = $(this).siblings('i');
        var $tooltip = $tarEl.parent('span');
        var $tarA = $tarEl.closest('a');
        if($(this).val() != '') {
            $tarEl.removeClass('fa-paperclip').addClass('fa-file-o file-do');
            $tooltip.attr('data-original-title', 'Document Attached');

            if($tarA.next('i.brkn').length == 0)
                $('<i class="fa fa-chain-broken brkn" onclick="removeAttachment($(this));"></i>').insertAfter($tarA);
        } else {
            $tarA.next('i.brkn').remove();
            $tarEl.addClass('fa-paperclip').removeClass('fa-file-o file-do');
            $tooltip.attr('data-original-title', 'Click to attach documents');
        }
    });
}

var localProjectId = 0;
function bindProjectAutoComplete(clientId) {
    // fetch data
    $.ajax({
        url: getBaseURL() + "project/tender/workorder",
        data: {rtype:'getProject', data: clientId},
        async: false,
        type: 'post',
        success: function(data,status, xhr) {
            var arr_projects = JSON.parse(data);
            $ProjectName.autocomplete({
                lookup: arr_projects,
                showNoSuggestionNotice: false,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        $ProjectId.val(suggestion.data);
                        $woType.find('option[value="A"]').prop('selected', true);

                        if(localProjectId != suggestion.data) {
                            localProjectId = suggestion.data;
                            ProjectChange(suggestion.value);
                        }
                    } else
                        $newProject.hide();
                }, onSearchStart: function (suggestion) {
                    $WorkOrderId.val(0);
                }, onSearchComplete: function (query, suggestion) {
                    if (!suggestion.length) {
                        $ProjectId.val('new');
                        $woType.find('option[value="N"]').prop('selected', true);
                        $woType.trigger('change');
                        $newProject.show();

                        if(localProjectId != suggestion.data) {
                            localProjectId = suggestion.data;
                            ProjectChange(suggestion.value);
                        }
                    } else {
                        $newProject.hide();
                    }
                }
            });
        }
    });
}

function bindAmentWOAutoComplete(projectId) {
    // fetch data
    $.ajax({
        url: getBaseURL() + "cb/workorder/index",
        data: {rtype:'getAmentmentWO', data: projectId},
        async: false,
        type: 'post',
        success: function(data,status, xhr) {
            var arr_AmentWOs = JSON.parse(data);
            $WONo.autocomplete({
                lookup: arr_AmentWOs,
                showNoSuggestionNotice: false,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        $woType.find('option[value="A"]').prop('selected', true);
                        $WorkOrderId.val(suggestion.data);
                    }
                }, onSearchStart: function (suggestion) {
                    $WorkOrderId.val(0);
                }, onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length) {
                        $woType.find('option[value="N"]').prop('selected', true);
                        $WorkOrderId.val(0);
                    }
                }
            });
        }
    });
}

function nextAccordian(id) {
    $('#panelheading-' + id).trigger('click');
}

$MMaterialUnitName.autocomplete({
    lookup: <?php echo (isset($unit))?json_encode($unit):[]; ?>,
    showNoSuggestionNotice: false,
    lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
        if (queryLowerCase == '*') {
            return suggestion.value;
        } else {
            var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
            return re.test(suggestion.value);
        }
    }, onSelect: function (suggestion) {
        if (suggestion) {
            $("#unitId").val(suggestion.data);
            $(this).removeClass('error');
        }
    }, onSearchStart: function (suggestion) {
        $("#unitId").val(0);
    }, onSearchComplete: function (query, suggestions) {
        if (!suggestions.length) {
            $("#unitId").val(0);
            $(this).addClass('error');
        } else $(this).removeClass('error');
    }
});


var localClientId = 0;
function bindClientAutoComplete(noSuggestion) {
    var showSuggestion = true;
    if(typeof noSuggestion != 'undefined' && noSuggestion == true) {
        showSuggestion = false;
    }

    $ClientName.unbind('autocomplete');
    $ClientName.autocomplete({
        lookup: arr_clients,
        <?php (isset($NoOfClientCount) && $NoOfClientCount >= count($clients)) ? 'showNoSuggestionNotice:true,' : ''; ?>
        showNoSuggestionNotice: showSuggestion,
        noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" value="Client" onclick="return AddNewClient()">',
        lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
            if (queryLowerCase == '*') {
                return suggestion.value;
            } else {
                var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                return re.test(suggestion.value);
            }
        }, onSelect: function (suggestion) {
            if (suggestion) {
                $ClientId.val(suggestion.data);
                $(this).removeClass('error');

                if(localClientId != suggestion.data) {
                    localClientId = suggestion.data;

                    if (suggestion.data != 'new') {
                        bindProjectAutoComplete(suggestion.data);
                    } else {
                        // client is new, project will be new
                        $ProjectName.autocomplete({
                            lookup: []});
                        $ProjectId.val('new');
                        $woType.find('option[value="N"]').prop('selected', true);
                        $woType.trigger('change');
                        $newProject.show();
                    }
                }
            }
        }, onSearchStart: function (suggestion) {
            $ClientId.val(0);
        }, onSearchComplete: function (query, suggestions) {
            if (!suggestions.length) {
                $(this).addClass('error');
                $ClientId.val(0);
            } else $(this).removeClass('error');
        }
    });
}

function AddNewClient() {
    if(tmpClientData != null)
        $btn_newclient.html('Update');

    $('.autocomplete-suggestions').hide();
    $ModalClientName.val($ClientName.val());
    $("#clientmodal").modal('show');
}

function AddNewMaterial(x) {
    var sname ='';
    var val=x.split('_')[0];
    if (val =='matadvnew') {sname = 'materialAdvName_' +  x.split('_')[1];}
    else if (val =='matpricenew') {sname = 'materialName_' +  x.split('_')[1];}
    else if (val =='matsupplynew') {sname = 'materialExcName_' +  x.split('_')[1];}

    $MMaterialName.val($('#'+ sname).val());
    $MMaterialUnitName.val('');
    $('#unitId').val('');
    $('.autocomplete-suggestions').hide();
    $btn_newmaterial.html('Create');
    $newMaterialHeader.html('Create Material');
    $ModalMaterial.data('mode','add').data('input','#'+ sname).modal('show');
}


function CheckClientName(value) {
    var isExists = false;
    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + "cb/workorder/index/"+value,
        data: {rtype:'clientname'},
        async: false,
        type: 'post',
        success: function(data,status, jqXHR){
            if (jqXHR.status == 201) {
                alert('Sorry, you are allowed to add only ' + data + ' clients in this plan!');
                $("#clientmodal").modal('hide');
                $('#ClientName').val('').trigger('change');
                bindClientAutoComplete(true);
                isExists = 'restricted';
            }

            if (data == "Y") {
                isExists = true;
            }
            $('.loading_area').hide();
        }, error:function(jqXHR, textStatus, errorThrown){
            $('.loading_area').hide();
            isExists = true;
        }
    });

    return isExists;
}

function ClientUpdate() {
    var clientName = $ModalClientName.val();
    if(clientName.length == 0) {
        alert('Client Name is required!');
        return false;
    }

    if($ModalClientAddress.val().length == 0) {
        alert('Address is required!');
        return false;
    }

    var clientStatus = CheckClientName(clientName);
    if(clientStatus == 'restricted') {
        return false;
    }else if (clientStatus === true) {
        alert('Client Name already exists!');
        return false;
    }

    if(tmpClientData != null)
        arr_clients.pop();

    tmpClientData = clientName;
    arr_clients.push({data: 'new', value: clientName});

    bindClientAutoComplete(); // Rebind data
    $ClientName.val(clientName);
    $ClientName.trigger('focus');
    $btn_editclient.show();
    $("#clientmodal").modal('hide');
}

var localNewMaterialName = '';
function MaterialUpdate() {
    var materialName = $MMaterialName.val();
    if(materialName.length == 0) {
        alert('Material Name is required!');
        return false;
    } else {
        removeError($MMaterialName);
    }

    // check for new material name if its new
    if(localNewMaterialName != materialName) {
        localNewMaterialName = materialName;
        var isNameValid = true;
        $.ajax({
            url: getBaseURL()+ 'cb/workorder/checkmaterialfound',
            type: "post",
            data: {'MaterialName': materialName},
            async: false,
            success: function (data, textStatus, jqXHR) {
                if(data == 'Y')
                    isNameValid = false;
                else
                    isNameValid = true;
            }, error: function (jqXHR, textStatus, errorThrown) {
                isNameValid = false;
            }
        });
        if (!isNameValid) {
            alert('Material Name Already Exists!');
            return false;
        }
    }

    if($MMaterialUnitName.val().length == 0) {
        alert('Unit Name is required!');
        return false;
    } else {
        removeError($MMaterialName);
    }
    if($MMaterialUnitName.hasClass('error')) {
        alert('Invalid Unit Name!');
        return false;
    } else {
        removeError($MMaterialName);
    }

    // add new vendor to array and form
    var $NewMaterialRowId = $('#newmaterialrowid'),
        rowid = parseFloatVal($NewMaterialRowId.val()),
        materialName = $MMaterialName.val(),
        unitName = $MMaterialUnitName.val(),
        materialId = '';
    if ($ModalMaterial.data('mode')=='add') {
        rowid += 1;
        $('#newmaterialwrapper').find('tbody').append($('#dummy-new-material tbody').html().replace(/__1/g, '_' + rowid));
        $NewMaterialRowId.val(rowid);
        materialId = 'New' + rowid;
        materiallists.push({
            data: materialId,
            value: materialName,
            unit:unitName
        });
        $('#newMaterialCount').find('.badge').html(rowid);

        $($ModalMaterial.data('input')).val(materialName);
    } else {
        var oldMaterialName = $('#newmaterial_' + $ModalMaterial.data('id')).val(),
            index = getJsonArrayIndex(materiallists, 'value', oldMaterialName);

        if(index != -1) {
            materiallists[index].value = materialName;
            materiallists[index].unit = unitName;

            materialId = materiallists[index].data;
            updateNewMaterialInputs(materialId, materiallists[index]);
        }
        rowid = $ModalMaterial.data('id');
    }

    bindMaterialBaseAutoComplete();
    bindMaterialExcAutoComplete();
    bindMaterialAdvAutoComplete();

    $('#newmaterial_'+ rowid).val(materialName);
    $('#newmaterialid_'+ rowid).val(materialId);
    $('#newmunitname_'+ rowid).val(unitName);
    $('#newmunitid_'+ rowid).val($('#unitId').val());
    $('#newmaterials').show();
    $($ModalMaterial.data('input')).triggerHandler('focus');
    $('#newMaterialCount').show();
    $ModalMaterial.modal('hide');
}

function updateNewMaterialInputs(id, obj) {
    //price esacalation materials
    $.each($('.materialNameInputs[value="'+id+'"]'),function () {
        var key = $(this)[0].id.split('_')[1];
        $('#materialName_' + key).val(obj.value);
        $('#materialUnit_' + key).val(obj.unit);
    });

    //client supply materials
    $.each($('.materialExcNameInputs[value="'+id+'"]'),function () {
        var key = $(this)[0].id.split('_')[1];
        $('#materialExcName_' + key).val(obj.value);
        $('#materialExcUnit_' + key).val(obj.unit);
    });

    //material advance materials
    $.each($('.materialAdvNameInputs[value="'+id+'"]'),function () {
        var key = $(this)[0].id.split('_')[1];
        $('#materialAdvName_' + key).val(obj.value);
    });
}

function ShowNewMaterials(e) {
    e.preventDefault();
    var $newwg = $('#newmaterialwrapper');
    if ($newwg.is(":hidden")) $newwg.show();
    else $newwg.hide();
    return false;
}

function ShowMaterial(id) {
    var irow = id.split('_')[1];

    $MMaterialName.val($('#newmaterial_'+ irow).val());
    $MMaterialUnitName.val($('#newmunitname_'+ irow).val());
    $('#unitId').val($('#newmunitid_'+ irow).val());
    $btn_newmaterial.html('Save');
    $newMaterialHeader.html('Update Material');
    $ModalMaterial.data('mode','edit').data('id',irow).modal('show');
}

function bindUnitAutoComplete() {
    var $unitids = $('input[id*=unit_]');
    $.each($unitids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        $this.unbind('autocomplete');
        var arrname = name.split('_');
        var key1 = arrname[1];
        $this.autocomplete({
            lookup: arrayunitlist,
            lookupFilter: function(suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase =='*') return suggestion.value;
                else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#unitid_" + key1);
                    $el.val(suggestion.data);
                    removeError($(this));
                    addNewBOQRow($el);
                }
            },
            onSearchStart: function(suggestion) {
                $("#unitid_" + key1).val(0);
            },
            onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#unitid_" + key1).val(0);
                } else
                    removeError($(this));
            }
        });
    });
}

function deleteboqTr(x,e) {
    e.preventDefault();
    var $x = $(x),
        $tr = $x.closest('tr'),
        iRowid = $x[0].id.split("_")[1],
        boqid =  $('#boqid_' + iRowid).val(),
        transType = $('#boqtranstype_' + iRowid).val();

    // if header check for childs
    if(transType == 'H') {
        var nextTr = $tr.next('tr');
        if($tr.next('tr').find('input[name^=boqtranstype_]').val() == 'I' && nextTr.find('a[id^=boqdelete_]').is(':visible')) {
            alert('Cannot delete this header, Since it has sub items!');
            return false;
        }
    }

    if(transType != 'H' && checkBOQUsage(boqid)) {
        alert('Cannot delete this boq, Since it has been used in  billing!');
        return false;
    }

    if (!confirm('Do you want to Delete')) {
        return false;
    }

    var $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr:not(.subTr)').length == 1) {
        var template = $('#dummy-boq tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#boqid').val(1);
    }
    $('#boqdelflag_' + iRowid).val('Y');
    $tr.next('tr.subTr').hide();
    $tr.hide();

    $tr.find('input[id^=crate_]').remove();
    calculateBOQRate();

    // enable AgreementType
    if($tbody.find('tr:visible').length <= 1) {
        $('#AgreementType').removeAttr('disabled');
    }

    return false;
}

function checkBOQUsage(id) {
    if($('#mode').val() != 'edit')
        return false;

    var isUsed = false,
        postData = {'woid': $('#workorderid').val(), 'id': id};

    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'cb/workorder/checkboqusage',
        type: "post",
        data: postData,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(data == 'Y')
                isUsed = true;
            else
                isUsed = false;

            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            isUsed = true;
            $('.loading_area').hide();
        }
    });
    return isUsed;
}

function addNewDocRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#documentrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteDocTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-document tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);

    bindDocAttached();
    $rowid.val(count);
}

function addNewDepositRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#depositrowid'),
        rowid = parseInt($rowid.val());
    $('.deletedepositTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-deposit tbody').html();

    template = template.replace(/__1/g, '_' + count);
    var today = new Date();
    $tr.parent('tbody').append(template);
    $tr.next('tr').find('input.date_picker[id^="drefdate_"]').datepicker({'format': 'dd-mm-yyyy'});
    $tr.next('tr').find('input.date_picker[id^="dvaliddate_"]').datepicker({'format': 'dd-mm-yyyy', startDate: today });
    $tr.next('tr').find('.date_icon').click(function() {
        $(this).parent().find('input').datepicker('show');
    });
    $rowid.val(count);

    binddepositAutoComplete();
    bindpaymentmodeAutoComplete();
}

function deleteDeposit(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-deposit tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#depositrowid').val(1);

        binddepositAutoComplete();
        bindpaymentmodeAutoComplete();
    }

    $tr.remove();
    setPageChanges(true);
    return false;
}

function deleteDoc(x,e, docId) {
    e.preventDefault();

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    if($tr.find('.fa-file-o').length > 0) {
        alert('Document attached. Remove document and then try!');
        return false;
    }

    if (!confirm('Do you want to Delete'))
        return false;



    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-document tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#documentrowid').val(1);
    }

    if(docId != 0) {
        $tr.find('td:first').append('<input type="hidden" name="docDel_'+docId+'" value="'+docId+'">');
    }

    $tr.hide();
    return false;
}

function addNewTermRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#termrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteTermTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-term tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
}

function addNewTechRow(x) {
    var $tr = $(x).closest('tr');
    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#techrowid'),
        rowid = parseInt($rowid.val());
    $('.deleteTechTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-tech tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
}

function deleteTerm(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-term tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#termrowid').val(1);
    }

    $tr.remove();
    setPageChanges(true);
    return false;
}

function deleteTech(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-tech tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#techrowid').val(1);
    }
    $tr.remove();
    setPageChanges(true);
    return false;
}

function addNewMaterialRow(x) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if ($tr.next('tr').length != 0)
        return;

    if ($('#materialName_' + key).val().length == 0 || $('#materialRate_' + key).val().length == 0)
        return;

    var $rowid = $('#materialrowid'),
        rowid = parseInt($rowid.val());
    $('.materialDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-material tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialBaseAutoComplete();
}

function deleteMaterial(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialId_' + key).val();

    if(checkForUsage(materialId, 'PriceEscalation')) {
        alert('Cannot delete this material, Since it has been used in  billing!');
        return false;
    }

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-material tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#materialrowid').val(1);
    }
    $tr.remove();
    setPageChanges(true);
    materialPrice = materiallists;

    bindMaterialBaseAutoComplete();
    return false;
}

function checkForUsage(id, checkfor, type) {
    if($('#mode').val() != 'edit')
        return false;


    var isUsed = false,
        postData = {'woid': $('#workorderid').val(), 'id': id, 'checkfor': checkfor};

    if(typeof type != 'undefined')
        postData.type = type;

    $('.loading_area').show();
    $.ajax({
        url: getBaseURL() + 'cb/workorder/checkforusage',
        type: "post",
        data: postData,
        async: false,
        success: function (data, textStatus, jqXHR) {
            if(data == 'Y')
                isUsed = true;
            else
                isUsed = false;

            $('.loading_area').hide();
        }, error: function (jqXHR, textStatus, errorThrown) {
            isUsed = true;
            $('.loading_area').hide();
        }
    });
    return isUsed;
}

function addNewMaterialExcRow(x) {
    var $tr = $(x).closest('tr');

    if ($tr.next('tr').length != 0)
        return;

    var $rowid = $('#materialExcrowid'),
        rowid = parseInt($rowid.val());
    $('.materialExcDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-material-exclude tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialExcAutoComplete();
}

function deleteMaterialExc(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialExcId_' + key).val(),
        type = $('#materialExcType_' + key).val();

    if(checkForUsage(materialId, 'ClientSupply', type)) {
        alert('Cannot delete this material, Since it has been used in  billing!');
        return false;
    }

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $(x).closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-material-exclude tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#materialExcrowid').val(1);
    }


    $tr.remove();
    setPageChanges(true);
    bindMaterialExcAutoComplete();
    return false;
}
function addNewMaterialAdvRow(x) {
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];

    if ($tr.next('tr').length != 0)
        return;

    if ($('#materialAdvName_' + key).val().length == 0 || $('#materialAdvRate_' + key).val().length == 0)
        return;

    var $rowid = $('#materialAdvrowid'),
        rowid = parseInt($rowid.val());
    $('.materialAdvDeleteTr_' + rowid).show();
    var count = rowid + 1,
        template = $('#dummy-material-advance tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody').append(template);
    $rowid.val(count);
    bindMaterialAdvAutoComplete();
}
function deleteMaterialAdv(x,e) {
    e.preventDefault();
    var $x = $(x),
        key = $x[0].className.split('_')[1],
        materialId = $('#materialAdvId_' + key).val();

    if(checkForUsage(materialId, 'MaterialAdvance')) {
        alert('Cannot delete this material, Since it has been used in  billing!');
        return false;
    }

    if (!confirm('Do you want to Delete'))
        return false;

    var $tr = $x.closest('tr'),
        $tbody = $tr.parent('tbody');

    if ($tbody.find('> tr').length == 1) {
        var template = $('#dummy-material-advance tbody').html();
        template = template.replace(/__1/g, '_' + 1);
        $tbody.append(template);
        $('#materialAdvrowid').val(1);
    }

    $tr.remove();
    setPageChanges(true);
    bindMaterialAdvAutoComplete();
    return false;
}
function addNewBOQRow(x) {
    calculateBOQRate();
    var $x = $(x),
        $tr = $x.closest('tr'),
        key = $x[0].id.split('_')[1];
    if($('#boqrowrefid_' + key).nextAll('tr[id*=boqrowrefid_]').length == 1)
        return;

    if ($tr.next('tr').length != 0)
        return;

    if ($('#agtno_' + key).val().length == 0 || $('#spec_' + key).val().length == 0)
        return;

    var $rowid = $('#boqrowid'),
        rowid = parseInt($rowid.val());
    $('.boqdelete_' + key).show();

    var count = rowid + 1,
        template = $('#dummy-boq tbody').html();

    template = template.replace(/__1/g, '_' + count);
    $tr.parent('tbody:not(.total)').append(template);

    $('#boqrefid_'+count).val(count);

    if(count > 1) {
        $('#AgreementType').attr('disabled', true);
        $('#InputAgreementType').val($('#AgreementType').val());
    }

    $('#boq-clear-span').show();
    $rowid.val(count);
    bindUnitAutoComplete();
    bindBOQSortablefn();
}

function checkMaterialPriceFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkMaterialPriceUsed(key1);
}
function checkMaterialPriceUsed(id) {
    var reskeyid = $('input[id*=materialId_]');
    materialPrice = materiallists;

    materialPrice = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];

            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
}

function checkMaterialSupplyFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkMaterialSupplyUsed(key1);
}
function checkMaterialSupplyUsed(id) {
    var reskeyid = $('input[id*=materialExcId_]');
    materialSupply = materiallists;

    materialSupply = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                    return false;
                }
            }
        });
        return is_selected;
    });
}

function checkMaterialAdvFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkMaterialAdvUsed(key1);
}
function checkMaterialAdvUsed(id) {
    var reskeyid = $('input[id*=materialAdvId_]');
    materialaAdv = materiallists;
    materialaAdv = $.grep(materiallists, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.data == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}

function calculateBOQRate() {
    var total = 0;
    var type = $('#AgreementType').val();
    if(type == 'T') {
        $('input[id^=amt_]').each(function() {
            var $this = $(this),
                el_id = $this[0].id,
                key = el_id.split('_')[1];
            if(el_id.indexOf('__') != -1)
                return;

            var amt = parseFloatVal(isNullCheck($this.val(),'number'));

            $('#amt_'+key).val(sanitizeNumber(amt, 2, true));
            total += amt;
        });

        if(!isNaN(total)) {
            $('#boqTotal').val(sanitizeNumber(total, 2, true));
        }
        return;
    }

    $('input[id^=crate_]').each(function() {
        var el_id = $(this)[0].id,
            key = el_id.split('_')[1];
        if(el_id.indexOf('__') != -1)
            return;

        var qty = parseFloatVal(isNullCheck($('#qty_'+key).val(),'number')),
            rate = parseFloatVal(isNullCheck($('#rate_'+key).val(),'number')),
            crate = parseFloatVal(isNullCheck($('#crate_'+key).val(),'number'));

        var camt = crate * qty,
            amt = rate * qty,
            variance = 0;

        if(crate != 0)
            variance = ((rate-crate)/crate)*100;

        $('#amt_'+key).val(sanitizeNumber(amt, 2, true));
        $('#camt_'+key).val(sanitizeNumber(camt, 2, true));
        $('#ratevariance_'+key).val(sanitizeNumber(variance, 2, true));
        total += amt;
    });


    $('#boqTotal').val(sanitizeNumber(total, 2, true));
    $('#boqtotalSpan').html('<i class="fa fa-inr"></i> '+ sanitizeNumber(total,2,true));

    // calculate order amount
    var orderAmt = total * (1 + ($('#OrderPercent').val() / 100));
    $('#OrderAmount').val(sanitizeNumber(orderAmt,2, true)).trigger('change');
}

function calcMobilAmt() {
    var orderAmt = parseFloatVal($('#OrderAmount').val());
    var mobilePercentage = $('#MobilisationPercent').val();

    var mobileAmt = orderAmt * (mobilePercentage/100);
    $('#MobilisationAmount').val(sanitizeNumber(mobileAmt,2, true));

    var type = $('#AgreementType').val();
    if(type == 'T') {
        $('#boqtotalSpan').html('<i class="fa fa-inr"></i> '+ sanitizeNumber(orderAmt,2,true));
    }
}

function changeBillPeriod(type)
{
    if (type==0) {
        $('#billperioddayli').hide();
        $('#billperiodweekdayli').hide();
        $('#billperioddayspan').hide();
        $('#billperiodweekspan').hide();
    } else if (type==1 || type==2) {
        $('#billperioddayli').hide();
        $('#billperiodweekdayli').show();
        $('#billperioddayspan').hide();
        $('#billperiodweekspan').show();
    } else {
        $('#billperiodweekdayli').hide();
        $('#billperioddayli').show();
        $('#billperiodweekspan').hide();
        $('#billperioddayspan').show();
    }
}

function changeAgreementType() {
    var isValid = true;
    var type = $('#AgreementType').val();
    $('#InputAgreementType').val(type);
    $('input[id^=crate_]').each(function() {
        var el_id = $(this)[0].id,
            key = el_id.split('_')[1];
        if(el_id.indexOf('__') != -1)
            return;
        var crate = parseFloatVal($('#crate_'+key).val()),
            camt = parseFloatVal($('#camt_'+key).val());
        if((crate.length != 0 && crate != 0) || (camt.length != 0 && camt != 0)) {
            isValid = false;
            return false;
        }
    });

    var $tarTd = $('#boqTable').find('tbody.total tr:first-of-type td:first-of-type');
    $tarTd.show();
    if (type=='T') {
        $('#OrderAmount').prop('readonly',false);
        $('#boq-amount-txt').html('Percentage');
//            $('#boq-amount-edit').prop('readonly',false);
        $('input[type=text][id^=amt_]').prop('readonly',false);
    } else {
        $('#OrderAmount').prop('readonly',true);
        $('#boq-amount-txt').html('Amount');
//            $('#boq-amount-edit').prop('readonly',true);
        $('input[type=text][id^=amt_]').prop('readonly',true);
    }

    if (type=="O")
        $('#OrderPercent').prop('disabled',false);
    else {
        $('#OrderPercent').prop('disabled',true).val('');
        $('#OrderPercent').trigger('change');
    }

    var colspan = '2',
        hTypeColSpan = '3';
    if(type == 'I') {
        $('.boq-overall-txt').show();
        $tarTd.hide();
    } else if (type=='T') {
        $('.boq-turnkey-txt').hide();
        colspan = '1';
        hTypeColSpan = '1';
    } else if (isValid) {
        $('.boq-overall-txt').hide();
        $('.boq-turnkey-txt').show();
        colspan = '2';
    } else {
        $AgreementType.find('option[value=O]').prop('selected', true).select2({placeholder: ""});
        alert('Agreement Type can\'t be changed, Since prior values are not empty!');
    }
    $('.headerTd').attr('colspan', colspan);
    $('.headerTypeTd').attr('colspan', hTypeColSpan);
}

function changeBudgetType() {
    var type = $('#BudgetType').val();
    $('#InputBudgetType').val(type);
    var agt_type = $('#AgreementType').val();

    var isValid = true;
    $('input[id^=crate_]').each(function() {
        var el_id = $(this)[0].id,
            key = el_id.split('_')[1];
        if(el_id.indexOf('__') != -1)
            return;
        var crate = parseFloatVal($('#crate_'+key).val()),
            camt = parseFloatVal($('#camt_'+key).val());
        if((crate.length != 0 && crate != 0) || (camt.length != 0 && camt != 0)) {
            isValid = false;
            return false;
        }
    });

    var colspan = 2,
        hTypeColSpan = 3;

    if (type=='T') {
        colspan = 1;
        hTypeColSpan = 1;
    } else if (isValid) {
        colspan = 2;
    }

    if(type == 'O') {
        $('#BudgetAmountWrapper').show();
        $('.boq-budget-txt').hide();
    } else if (type=='I') {
        $('#BudgetAmountWrapper').hide();
        $('.boq-budget-txt').show();
        colspan += 1;
    }
    $('.headerTd').attr('colspan', colspan);
    $('.headerTypeTd').attr('colspan', hTypeColSpan);
}

function bindMaterialBaseAutoComplete() {
    var $matertialName = $('input[id^=materialName_]');
    $matertialName.unbind('autocomplete');
    var addedMaterials = [];
    $.each($matertialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkMaterialPriceUsed(key1);
        $this.autocomplete({
            lookup: materialPrice,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matpricenew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialId_" + key1);
                    $el.val(suggestion.data);
                    $('#materialUnit_' + key1).val(suggestion.unit);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialId_" + key1).val(0);
                } else
                    removeError($(this));
            }
        });
    });
}
function bindMaterialExcAutoComplete() {
    var $materialName = $('input[id^=materialExcName_]');
    $materialName.unbind('autocomplete');

    $.each($materialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkMaterialSupplyUsed(key1);
        $this.autocomplete({
            lookup: materialSupply,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matsupplynew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialExcId_" + key1);
                    $el.val(suggestion.data);
                    $('#materialExcUnit_' + key1).val(suggestion.unit);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialExcId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialExcId_" + key1).val(0);
                } else {
                    removeError($(this));
                }
            }
        });
    });
}

function bindMaterialAdvAutoComplete() {
    var $matertialName = $('input[id^=materialAdvName_]');
    $matertialName.unbind('autocomplete');
    $.each($matertialName, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkMaterialAdvUsed(key1);
        $this.autocomplete({
            lookup: materialaAdv,
            showNoSuggestionNotice:true,
            noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="matadvnew_' + key1+'" value="Material" onclick="return AddNewMaterial(this.id)">',
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $el = $("#materialAdvId_" + key1);
                    $el.val(suggestion.data);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                $("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    showError($(this), 'Required');
                    $("#materialAdvId_" + key1).val(0);
                } else
                    removeError($(this));
            }
        });
    });
}

function binddepositAutoComplete() {
    var $deposit = $('input[id^=deposit_]');
    $deposit.unbind('autocomplete');
    $.each($deposit, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];

        $this.autocomplete({
            lookup: depositlist,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $("#deposit_" + key1).trigger('change');
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    //showError($(this), 'Required');
                    //$("#materialAdvId_" + key1).val(0);
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    });
}

function bindexcelFieldComplete() {
    var $excelfield = $('input[id^=field_]');
    $excelfield.unbind('autocomplete');
    $.each($excelfield, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];
        checkexcelFieldUsed(key1);
        $this.autocomplete({
            lookup: arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) removeError($(this));
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) showError($(this), 'Invalid');
                else removeError($(this));
            }
        });
    });
}


function checkexcelFieldFocus(x) {
    var arrname = x.split('_');
    var key1 = arrname[1];
    checkexcelFieldUsed(key1);
}
function checkexcelFieldUsed(id) {
    var reskeyid = $('input[id*=field_]');
    arrayFieldR = arrayField;
    arrayFieldR= $.grep(arrayField, function (element, index) {
        var is_selected = true;
        $.each(reskeyid, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            if (key1 != id) {
                if (element.value == $this.val()) {
                    is_selected = false;
                }
            }
        });
        return is_selected;
    });
}

function bindpaymentmodeAutoComplete() {
    var $deposit = $('input[id^=paymode_]');
    $deposit.unbind('autocomplete');
    $.each($deposit, function () {
        var $this = $(this),
            name = $this[0].id;
        if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
        var arrname = name.split('_');
        var key1 = arrname[1];

        $this.autocomplete({
            lookup: paymentmode,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    //var $el = $("#materialAdvId_" + key1);
                    //$el.val(suggestion.data);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                //$("#materialAdvId_" + key1).val(0);
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    });
}

function AddNewHeader(x) {
    var key = x.id.split("_")[1],
        $spec = $('#spec_' + key ),
        $agtno = $('#agtno_' + key ),
        $tr = $spec.closest('tr');

    var $rowid = $('#boqrowid'),
        rowid = parseInt($rowid.val());
    var count = rowid + 1,
        template = $('#dummy-header tbody').html();
    template = template.replace(/__1/g, '_' + count);
    $tr.before(template);

    // set header value
    if(!$('#boqdelete_' + key).is(':visible')) {
        $('#header_' + count).val($spec.val());
        $('#agtno_' + count).val($agtno.val());

        $spec.val('');
        $agtno.val('');
    }

    $('#boqrefid_'+count).val(count);

    $rowid.val(count);
    $('.autocomplete-suggestions').hide();

    SortOrderBOQ();
}

function isFormula(evt){
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=43 && charCode!=45 && charCode!=47 && charCode!=42 && charCode!=46 && charCode!=40 && charCode!=41 && charCode!=82 && charCode!=37 && charCode!=39 && charCode!=35 && charCode!=36) return false;
    return true;
}

function bindBOQSortablefn(reset) {
    // ReadyMix sortable function
    var $rBody = $('table[id*=boqTable] tbody.sorting');
    $.each($rBody, function(i, obj){
        if ($(this).parent('table')[0].id.indexOf('__') != -1) {
            $rBody.splice(i, 1);
        }
    });
    var $sRTable = $rBody.find('tr');

    if (typeof reset !== 'undefined' && reset === true) {
        $sRTable.unbind('click', 'dblclick', 'select', 'sortable');
        $rBody.unbind('sortable');
    }
    $sRTable.on( 'dblclick', function () {
        var $this = $(this);
        if ($this.hasClass('selected') == true) $this.toggleClass('selected', false);
        else $this.toggleClass('selected', true);
    });
//        $sRTable.on( 'click', function () {
//            var $this = $(this);
//            $this.closest("tr").siblings().removeClass("highlighted");
//            $this.toggleClass('highlighted',true);
//        });
//        $sRTable.on( 'select', function () {
//            var $this = $(this);
//            $this.closest("tr").siblings().removeClass("highlighted");
//            $this.toggleClass('highlighted',true);
//        });
    $rBody.sortable({
        helper: fixHelperModified,
        stop: updateIndex,
        axis: 'y',
        distance: 40,
        update: function( event, ui ) {
            var ifrow = event.target.children[0].id.split("_")[1];
            SortOrderBOQ();
        }
    });
}

var fixHelperModified = function(e, tr) {
        var $originals = tr.children();
        var $helper = tr.clone();
        $helper.children().each(function(index) {
            $(this).width($originals.eq(index).width())
        });
        return $helper;
    },
    updateIndex = function(e, ui) {
        $('td.index', ui.item.parent()).each(function (i) {
            $(this).html(i + 1);
        });
    };

function SortOrderBOQ() {
    var rows = $('tr[id*=boqrowrefid_]');
    var irefid=1;
    $.each(rows, function() {
        var id = $(this)[0].id;
        if (id.indexOf('__') != -1 || id.indexOf('excel') != -1) return;
        var irow = id.split("_")[1];
        $('#boqSortid_'+ irow).val(irefid);
        $('#boqrefid_'+ irow).val(irow);
        irefid = + irefid+1;
    });
}

// Import from excel
function getexcelfield(x) {
    var bValid=true;

    bExcelWG = false;
    bExcelCRate = false;
    bExcelCAmt = false;
    bExcelBudget = false;
    bExcelVRate = false;
    bExcelShortSpec = false;

    formData = new FormData();
    formData.append('file', $('#myfile').prop("files")[0]);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() +"cb/workorder/getboqfielddata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);

            $("#excelfieldTable").find("th").remove();
            $("#excelfield").find("td").remove();

            var sStr="Select Field";
            for (var i = 0; i < obj.length; i++) {
                $("#excelfieldTable").append('<th><input id="efield_'+i+'" class="text-reon" type="text" value="'+obj[i]['Field']+'" style="background: transparent;"/></th>');
                $("#excelfield").append('<td><input id="field_'+i+'" class="parent_text" type="text"'+sStr+' onfocus="checkexcelFieldFocus(this.id)"</td>');
                $('#efield_'+i).prop('readonly', true);

                if (obj[i]['Field'].trim().toUpperCase() == 'AGT NO') $('#field_'+i).val('Agt No');
                if (obj[i]['Field'].trim().toUpperCase() == 'WORKGROUP') { $('#field_'+i).val('WorkGroup'); bExcelWG=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'SPECIFICATION') $('#field_'+i).val('Specification');
                if (obj[i]['Field'].trim().toUpperCase() == 'SHORT SPEC') { $('#field_'+i).val('Short Spec'); bExcelShortSpec=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'UNIT') $('#field_'+i).val('Unit');
                if (obj[i]['Field'].trim().toUpperCase() == 'QTY') $('#field_'+i).val('Qty');
                if (obj[i]['Field'].trim().toUpperCase() == 'BUDGET') { $('#field_'+i).val('Budget'); bExcelBudget=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE') $('#field_'+i).val('Rate');
                if (obj[i]['Field'].trim().toUpperCase() == 'AMOUNT') $('#field_'+i).val('Amount');
                if (obj[i]['Field'].trim().toUpperCase() == 'CLIENT RATE') { $('#field_'+i).val('Client Rate'); bExcelCRate=true;}
                if (obj[i]['Field'].trim().toUpperCase() == 'CLIENT AMOUNT') { $('#field_'+i).val('Client Amount'); bExcelCAmt=true; }
                if (obj[i]['Field'].trim().toUpperCase() == 'RATE VARIANCE') { $('#field_'+i).val('Rate Variance'); bExcelVrate=true; }
            }

            bindexcelFieldComplete();
            $("#excelfieldmodal").modal('show');
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });
    clearInputFile($('#myfile'));
}

function fileupload() {
    var isValid=true;
    var $excelpids = $('input[id^=field_]');
    $.each($excelpids, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        if ($('#field_' + key1).hasClass('error')) {
            isValid=false;
            return;
        }
    });
    if (isValid==false) {alert ("Please Assign Fields Correctly"); return;}

    $("#excelfieldmodal").modal('hide');
    var bValid=true;
    var arrHeader =[];
    for (var i = 0; i < $("#excelfieldTable").find("th").length; i++) {
        arrHeader.push({efield: $('#efield_'+i).val(), field: $('#field_'+i).val()});
    }
    arrHeader =  JSON.stringify(arrHeader);
    formData.append('arrHeader', arrHeader);
    formData.append('csrf', "<?php echo isset($csrf)?$csrf:''; ?>");
    $.ajax({
        url: getBaseURL() +"cb/workorder/uploadboqdata",
        async: false,
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data:  formData,
        type: 'post',
        success: function(data,status, xhr) {
            var obj = jQuery.parseJSON(data);
            var key1=1;
            if (obj[0].Valid==true) {
                $('#excelTable tr:gt(1)').remove();
                var $excelagtnos = $('input[id^=excelagtno_]');
                $.each($excelagtnos, function (i, obj) {
                    var $this = $(this),
                        name = $this[0].id;
                    key1 = name.split('_')[1];
                });
                var irow = key1;
                $("#excelworkgroup_"+irow).val('');
                $("#excelagtno_"+irow).val('');
                $("#excelspec_"+irow).val('');
                $("#excelshortspec_"+irow).val('');
                $("#excelunit_"+irow).val('');
                $("#excelqty_"+irow).val('');
                $("#excelcrate_"+irow).val('');
                $("#excelcamt_"+irow).val('');
                $("#excelrate_"+irow).val('');
                $("#excelamt_"+irow).val('');
                $("#excelbudget_"+irow).val('');
                $("#excelratevariance_"+irow).val('');

                for (i = 0; i < obj.length; i++) {
                    if (irow != key1)  {
                        $("#excelTable tbody tr:last").after('<tr>' + $("#excelTable tbody tr:first").html() + "</tr>");
                        var $tr = $("#excelTable tbody tr:last");
                        $tr.find("input").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("select").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                        $tr.find("textarea").each(function () {
                            $(this).attr("id", $(this).attr("id").replace( "_" + key1, "_" + irow));
                        });
                    }

                    $("#excelworkgroup_"+irow).val(isNullCheck(obj[i].WorkGroup,'string'));
                    $("#excelworkgroupid_"+irow).val(obj[i].WorkGroupId);
                    $("#excelagtno_"+irow).val(obj[i].AgtNo);
                    $("#excelspec_"+irow).val(obj[i].Spec);
                    $("#excelshortspec_"+irow).val(obj[i].ShortSpec);
                    $("#excelunitid_"+irow).val(obj[i].UnitId);
                    $("#excelunit_"+irow).val(obj[i].Unit);
                    $("#excelqty_"+irow).val(obj[i].Qty);

                    $("#excelcrate_"+irow).val(obj[i].CRate);
                    $("#excelcamt_"+irow).val(obj[i].CAmount);

                    $("#excelrate_"+irow).val(obj[i].Rate);
                    $("#excelamt_"+irow).val(obj[i].Amount);
                    $("#excelbudget_"+irow).val(obj[i].Budget);

                    $("#excelratevariance_"+irow).val(obj[i].RVariance);
                    $('#excelboqdelete_'+irow).show();

                    //$(".th:contains('None')") .remove();
                    irow = +irow + 1;
                }
            } else {
                bValid=false;
            }
            if (bValid==true)
                $("#excelmodal").modal('show');
            else
                alert("Invalid File Format");
        },
        error: function(xhr, status, errorThrown) {
            if (xhr.status == 400)
                alert(xhr.responseText);
            else
                alert(errorThrown);
        }
    });

    if (bExcelWG==false) $('.excel-wg-txt').hide();
    if (bExcelShortSpec==false) $('.excel-sspec-txt').hide();
    if (bExcelCRate==false) $('.excel-crate-txt').hide();
    if (bExcelCAmt==false) $('.excel-camt-txt').hide();
    if (bExcelVRate==false) $('.excel-vrate-txt').hide();
    if (bExcelBudget==false) $('.excel-budget-txt').hide();

    clearInputFile($('#myfile'));
}

function BOQUpdate() {
    var iMRowId = $('#boqrowid').val();
    var iRowId=iMRowId;
    var transtype= isNullCheck($('#boqtranstype_' + iMRowId).val(),'string'),
        rowSpec = "";

    if (transtype == "H") {
        rowSpec = isNullCheck($('#header_' + iMRowId).val(), 'string');
    } else {
        rowSpec = isNullCheck($('#spec_' + iMRowId).val(),'string');
    }

    var agtNo = $("#agtno_" + iMRowId).val();
    if (rowSpec.length == 0 && agtNo.length == 0) {
        $('#boqrowrefid_' + iMRowId).remove();
    }

    var $excelagtnos = $('input[id^=excelagtno_]');
    $.each($excelagtnos, function (i, obj) {
        var $this = $(this),
            name = $this[0].id;
        var key1 = name.split('_')[1];
        var bHeader= false;
        if ($("#excelunit_"+key1).val().length >0) {
            bHeader=false;
            var sStr = $('#dummy-boq tbody').html();
            sStr = sStr.replace(/__1/g, '_' + iMRowId);
            $('#boqTable > tbody:not(.total)').append(sStr);
        } else {
            if (iRowId == iMRowId) iMRowId = +iMRowId+1;
            bHeader=true;
            var sStr = $('#dummy-header tbody').html();
            sStr = sStr.replace(/__1/g, '_' + iMRowId);
            $('#boqTable > tbody:not(.total)').append(sStr);
        }

        if (!bHeader) {
            $("#agtno_" + iMRowId).val($("#excelagtno_" + key1).val());
            $("#spec_" + iMRowId).val($("#excelspec_" + key1).val());
            $("#shortspec_" + iMRowId).val($("#excelshortspec_" + key1).val());
            $("#unit_" + iMRowId).val($("#excelunit_" + key1).val());
            $("#unitid_" + iMRowId).val($("#excelunitid_" + key1).val());
            $("#qty_" + iMRowId).val($("#excelqty_" + key1).val()).trigger('blur');
            $("#crate_" + iMRowId).val($("#excelcrate_" + key1).val()).trigger('blur');
            $("#camt_" + iMRowId).val($("#excelcamt_" + key1).val()).trigger('blur');
            $("#rate_" + iMRowId).val($("#excelrate_" + key1).val()).trigger('blur');
            $("#amt_" + iMRowId).val($("#excelamt_" + key1).val());
            $("#budgetamount_" + iMRowId).val($("#excelbudget_" + key1).val());
            $("#ratevariance_" + iMRowId).val($("#excelratevariance_" + key1).val());
            $('#boqtranstype_' + iMRowId).val("I");
            $('#boqdelflag_' + iMRowId).val('N');
            $('.boqdelete_' + iMRowId).show();
        } else {
            $('#boqtranstype_' + iMRowId).val("H");
            $("#agtno_" + iMRowId).val($("#excelagtno_" + key1).val());
            $('#header_'+iMRowId).val($("#excelspec_" + key1).val());
            $('#boqdelflag_' + iMRowId).val('N');
        }
        $("#boqSortid_" + iMRowId).val(iMRowId);
        $("#boqrefid_" + iMRowId).val(iMRowId);

        iMRowId=+iMRowId+1;
        $('#boqrowid').val(iMRowId);
    });

    if(iMRowId > 1) {
        $('#AgreementType').attr('disabled', true);
        $('#InputAgreementType').val($('#AgreementType').val());
    }

    if (iMRowId != iRowId) {
//            var sStr = $('#dummy-boq tbody').html();
//            sStr = sStr.replace(/__1/g, '_' + iMRowId);
//            $('#boqTable > tbody:not(.total)').append(sStr);
//            if (rowSpec.length == 0 || rowSpec != "") {
//               $('#subTr_'+iRowId).remove();
//               $('#boqrowrefid_'+iRowId).remove();
//            }

        var sStr = $('#dummy-boq tbody').html();
        sStr = sStr.replace(/__1/g, '_' + iMRowId);
        $('#boqTable > tbody:not(.total)').append(sStr);
        $('#boqrefid_' + iMRowId).val(iMRowId);
    }

    calculateBOQRate();
    bindUnitAutoComplete();
    bindBOQSortablefn();
    $('#excelmodal').modal('toggle');
}
function exceldeleteboqTr(x,e) {
    e.preventDefault();
    if (!confirm('Do you want to Delete'))
        return false;
    var $tr = $(x).closest('tr');
    $tr.next('tr.subTr').remove();
    $tr.remove();
    setPageChanges(true);
    return false;
}

function calcStipDate() {
    if($("#StartDate").val().length == 0)
        return;

    var date1 = new Date($("#StartDate").datepicker('getDate'));
    var oDay =parseInt(date1.getDate());
    date1.setDate(date1.getDate()-1);
    var date2 = new Date($("#StartDate").datepicker('getDate'));
    var day = parseInt(date1.getDate());


    var month= parseInt(date1.getMonth())+1;
    var year= parseInt(date1.getFullYear());

    var duration = parseInt(isNullCheck($('#Duration').val(),'number'));
    var periodType = $('#PeriodType').val();

    if(periodType == "D"){
        var days = duration;
        date2.setDate(date2.getDate()+days);
    } else if(periodType == "M"){
        var mm = parseInt(month+duration);
        if (mm > 12) {
            var y1= parseInt(mm/12);
            var m1 = parseInt(mm%12);
            month = m1;
            year = year+y1;
        } else  {
            month =month+duration;
        }

        if ((month==4 || month==6 || month==9 || month==11) && (day==31)) { day=30;}
        if (oDay==1) {if ((month==1 || month==3 || month==5 || month==7  || month==8 || month==10 || month==12) && (day==30)) { day=31;}}
        if (month==2 && day > 29){if (leapYear(year)) day=29;else day=28;}

        var sstr = year + "/" + month + "/" + day;
        date2 = new Date(sstr);

    } else {
        year = year+duration;
        var sstr = year + "/" + month + "/" + day;
        date2 = new Date(sstr);
    }

    var twoDigitDate = (date2.getDate() > 9)? (date2.getDate()) : '0' + (date2.getDate());
    var twoDigitMonth = (date2.getMonth() > 8)? (date2.getMonth()+1) : '0' + (date2.getMonth()+1);
    var formattedDate = twoDigitDate + "-" + twoDigitMonth + "-" + date2.getFullYear();

    $('#EndDate').val(formattedDate);
}

function leapYear(year)
{
    return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0);
}

/*Mapping Address*/
navigator.geolocation.getCurrentPosition(showPosition);
$('#MClientAddress').geocomplete({
    details: "#formWrapper",
    types: ["geocode", "establishment"]
});

function showPosition(position) {
    var coordinates = position.coords.latitude + "," + position.coords.longitude;
    $('#MClientAddress').val(coordinates);
    $('#MClientAddress').trigger("geocode");
}


function removeAttachment($tarEl) {

    if (!confirm('Do you want to Remove')) {
        return false;
    }

    var $tarLi = $tarEl.closest('li');
    var $tarA = $tarLi.find('a');
    var $tarI = $tarA.find('i.fa-file-o');
    var $tarIp = $tarLi.find('input[type="hidden"]');

    $tarIp.attr('type', 'file').removeAttr('value');
    $tarA.attr('href', '#').removeAttr('download').removeAttr('target');
    $tarI.addClass('fa-paperclip').removeClass('fa-file-o file-do');
    $tarA.html('<span class="btn-file butclr_imp">' + $tarA.html() + '</span>');
    bindDocAttached();

    $tarEl.remove();
}

$(function () {
    //Toggle fullscreen
    $("#panel-fullscreen").click(function (e) {
        e.preventDefault();

        var $this = $(this);

        if ($this.children('i').hasClass('glyphicon-resize-full'))
        {
            $this.children('i').removeClass('glyphicon-resize-full');
            $this.children('i').addClass('glyphicon-resize-small');
        }
        else if ($this.children('i').hasClass('glyphicon-resize-small'))
        {
            $this.children('i').removeClass('glyphicon-resize-small');
            $this.children('i').addClass('glyphicon-resize-full');
        }
        $(this).closest('.panel').toggleClass('panel-fullscreen');
    });

    // highlight row
    $('.highlightTable').on( 'focus', 'tbody:not(.total) tr input,textarea', function () {
        var $this = $(this);
        $('tr.highlighted').removeClass("highlighted");
        $this.closest('tr').addClass('highlighted');
    });
});

$(".ccForm").click(function() {
    $('.error_message').hide();
    $("#ccForm").modal('show');
});

function addCostCentre()
{
    if($("#costCentre").val() =="")
    {

        $("#costCentre").addClass("error-shown");
        return false;
    }
    if($("#companyId").val() =="")
    {

        $("#companyId").addClass("error-shown");
        return false;
    }
    if($("#address").val() =="")
    {

        $("#address").addClass("error-shown");
        return false;
    }
    if($("#city").val()=="")
    {
        $("#city").addClass("error-shown");
        return false;
    }

    $.post(getBaseURL()+'kickoff/index/add-cost-centre', { costCentre: $('#costCentre').val(), city: $('#city').val(), companyId: $('#companyId').val(), branchId: $('#branchId').val(), address: $('#address').val(), pinCode: $('#pinCode').val(), phone: $('#phone').val(), fax: $('#fax').val(), mobile: $('#mobile').val(), email: $('#email').val(), web: $('#web').val(), contactPerson: $('#contactPerson').val() },
        function(data) {
            $('#costCentreId').empty();
            $('#costCentreId').append('<option value="">Select Project Division</option>');
            var returnData = JSON.parse(data);
            $.each(returnData, function(key, value){
                $('#costCentreId')
                    .append($("<option></option>")
                        .attr("value",value.CostCentreId)
                        .text(value.CostCentreName));
            });
            $("#costCentreId option").each(function() {
                if($(this).text() == $('#costCentre').val()) {
                    $(this).attr('selected', 'selected').trigger('change');
                }
            });
            $('#newCC').val('1');
            $('#ccTable input:text').each(function() {
                $(this).val('');
            });
            $('#companyId').val('').trigger('change');
            $('#branchId').val('').trigger('change');
            $("#ccForm").modal('hide');
        });
}

$(function() {
    var tempClipboard = null;
    $.contextMenu({
        selector: '#boqTable .sorting tr:not(:last-child)',
        callback: function(key, options) {
            if (key == 'copy'){
                tempClipboard = $(this);
            } else if(key == 'paste') {
                var curRow = parseInt(tempClipboard[0].id.split('_')[1]);
                var rowCount = parseInt($('#boqrowid').val()) + 1;
                var html = tempClipboard[0].outerHTML.replace(new RegExp('_' + curRow, 'gi'), '_' + rowCount).replace(new RegExp('context-menu-active', 'gi'), '');
                $(this).after(html);
                $('#boqrowid').val(rowCount);
                calculateBOQRate();
            }
        },
        items: {
            "copy": {name: "Copy", icon: "copy"},
            "paste": {name: "Paste", icon: "paste"}
        }
    });
});

function loadBranches() {
    var iCompanyId = $('#companyId').val();
    $.ajax({
        url: getBaseURL() + 'project/tender/getBranches',
        type: "post",
        data: {'companyId': iCompanyId},
        async: false,
        success: function (data, textStatus, jqXHR) {
            var obj = JSON.parse(data);
            for (var n = 0; n < obj.length; n++) {
                $('#branchId').append($("<option />").val(obj[n]['BranchId']).text(obj[n]['BranchName']));
            }
        }
    });
}

function showgeneraltab() {
    $('#materialoptions').removeClass('active');
    $('#others').removeClass('active');
    $('#wbs').removeClass('active');
    $('#liwbs').removeClass('active');
    $('#limaterial').removeClass('active');
    $('#liother').removeClass('active');
    $('#ligeneral').addClass('active');
    $('#general').addClass('active');
}
function showwbstab() {
    $('#materialoptions').removeClass('active');
    $('#others').removeClass('active');
    $('#general').removeClass('active');
    $('#limaterial').removeClass('active');
    $('#liother').removeClass('active');
    $('#ligeneral').removeClass('active');
    $('#liwbs').addClass('active');
    $('#wbs').addClass('active');
}
function showmaterialtab() {
    $('#wbs').removeClass('active');
    $('#general').removeClass('active');
    $('#others').removeClass('active');
    $('#liother').removeClass('active');
    $('#ligeneral').removeClass('active');
    $('#liwbs').removeClass('active');
    $('#limaterial').addClass('active');
    $('#materialoptions').addClass('active');
}
function showothertab() {
    $('#materialoptions').removeClass('active');
    $('#wbs').removeClass('active');
    $('#general').removeClass('active');
    $('#ligeneral').removeClass('active');
    $('#liwbs').removeClass('active');
    $('#limaterial').removeClass('active');
    $('#liother').addClass('active');
    $('#others').addClass('active');
}
<?php if(isset($mode) && $mode == 'edit') { ?>
/*$.ajax({
 url: getBaseURL() + "project/tender/load-boq",
 data: {enquiryId: '', woId: $('#workorderid').val()},
 async: false,
 type: 'post',
 success: function (data, status, xhr) {
 $('#loadBoq').html(data);
 $('.loading_area').hide();
 }, error:function(jqXHR, textStatus, errorThrown){
 $('.loading_area').hide();
 }
 });*/
<?php } ?>
</script>
<script>
    $("#costCentre").keyup(function(){
        $("#costCentre").removeClass("error-shown");
    });
    $("#companyId").change(function () {
        var end = this.value;
        if($('#companyId').val() !="")
        {
            $("#companyId").removeClass("error-shown");
        }
    });
    $("#address").keyup(function(){
        $("#address").removeClass("error-shown");
    });
    $("#city").keyup(function(){
        $("#city").removeClass("error-shown");
    });
</script>