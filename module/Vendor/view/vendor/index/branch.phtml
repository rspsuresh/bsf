<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/vendor.css';?>"/>
<?php $this->bsf = new \BuildsuperfastClass(); ?>
<div class="content_wrapper  padlr0">
<div class="container-fluid">
<?php //include("menu.phtml"); ?>
<!--    <div class="col-lg-12">-->
<!--        <h1 class="padbtm0">Branch Details</h1>-->
<!--    </div>-->
    <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1">
        <div class="col-lg-12">
            <div class="row">
                <div class="step_by_liner animated slideInDown"></div>
                <ul class="step_by stepby_mb60">
                    <li class="opacity_08">
                        <div  class="step_by_sep  animated slideInRight"><p>5</p></div>
                        <p class="stepli_p3">Bank Details</p>
                    </li>
                    <li>
                        <div class="step_by_sep stepsep_active animated_1_5s  slideInRight"><p>6</p></div>
                        <p class="stepli_p2">Branch Details</p>
                    </li>
                    <li class="opacity_08">
                        <div class="step_by_sep  animated slideInRight"><p>7</p></div>
                        <p class="stepli_p3">Exprience Details</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
<form action="" method="post" role="form" enctype="multipart/form-data">
<input type="hidden" name="vendorId" id="vendorId" value="<?php echo $this->bsf->encode($vendorId); ?>" />
    <input type="hidden" name="saveExit" id="saveExit" value="1">
<?php
$resp = json_decode($branchResult);
if(count($resp) == 0)
{
    ?>
    <input type="hidden" id="branchTotal" name="branchTotal" value="1">
<?php
}
else
{
    ?>
    <input type="hidden" id="branchTotal" name="branchTotal" value="<?php echo count($resp); ?>">
<?php	}
?>
<div class="row">
    <!--<div class="col-lg-12">
        <h1 class="padbtm0">Branch Details</h1>
    </div>-->
    <div class="col-lg-12 clear commargin_top">
        <div class="table-responsive clear">
            <div class="col-lg-12" style="margin-top:10px;">
                <a href="#" class=" vendor_addnew float_r" id="AddNew">Add Branch</a>
            </div>
            <table class="table clear" id="branchTable">
                <thead>
                <tr>
                    <th>Sl No</th>
                    <th>Branch name</th>
                    <th>Address</th>
                    <th>City</th>
                    <th>TIN No</th>
                    <th>Phone No</th>
                    <th>Cheque No</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <?php
                if(count($resp) == 0){
                    ?>

                    <tr class="Maintr mainClass" bid="1">
                        <td class="vendor_cell" width="4%">1 &nbsp;<a href="#"><span><i class="fa fa-caret-right"></i></span></a></td>
                        <td width="15%"><input class="parent_txts newRow" type="text" name='branch_name_1' id='branch_name_1' onkeypress="return alphaNumeric(event)" tagname='branch_name' /></td>
                        <td width="15%"><input class="parent_txts" type="text" name='branch_address_1' id='branch_address_1' tagname='branch_address' /></td>
                        <td width="15%">
                            <div class="vendor_button">
                                <select name='branch_city_1' id='branch_city_1' tagname='branch_city'>
                                    <option value="-1">Select One</option>
                                    <?php
                                    foreach($branchCity as $cityData){
                                        ?>
                                        <option value="<?php echo $cityData['CityId'];?>"><?php echo $cityData['CityName'];?></option>
                                    <?php
                                    }
                                    ?>
                                </select>
                            </div>
                        </td>
                        <td width="15%"><input class="parent_txts" type="text" name='branch_tin_1' id='branch_tin_1' tagname='branch_tin' maxlength="11" onkeypress="return isNumberKey(event)" /></td>
                        <td width="15%"><input class="parent_txts deleteFun" type="text" name='branch_phone_1' id='branch_phone_1' maxlength="10"  tagname='branch_phone' onKeyPress="return isNumberKey(event)" /></td>
                        <td width="15%"><input class="parent_txts" type="text" name='branch_cheque_1' id='branch_cheque_1' maxlength="6" onKeyPress="return isNumberKey(event)" tagname='branch_cheque' /></td>
                        <td class="del" style="display:none;"><a href="#" class="vendar_styles remove"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a>
                        </td>
                    </tr>
                    <!--dss-->
                    <tr style="display:none;" class="Subtr mainClass" bid="1">
                        <td colspan=8>
                            <div class="projectDiv" style="display:none;">
                                <!--<div class="row">
                                    <input type="button" class="btn btn-primary addContact" value="Add Contact" style="float:right;margin-right:30px;">
                                </div>-->
                                <input type="hidden" class="form-control contactVal" name="contactTotal_1" tagName="contactTotal" value="1">
                                <!--dss-->
                                <table class="table table-hover clear" id="table">
                                    <thead>
                                    <tr>
                                        <th>Contact person</th>
                                        <th>Desgination</th>
                                        <th>Contact no</th>
                                        <th>Email</th>
                                        <th>Fax</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
<!--                                        <td width="1%"><a href="#" class="vendar_plus"><i class="fa fa-plus-circle addContact"></i></a></td>-->
                                        <td width="19%"><input class="parent_txts addContact" type="text" name='contactperson_b1_1' id='contactperson_b1_1' tagname='contactperson_b1' onkeypress="return alphaNumeric(event)" /></td>
                                        <td width="19%"><input class="parent_txts" type="text" name='designation_b1_1' id='designation_b1_1' onkeypress="return alphaNumeric(event)" tagname='designation_b1'/></td>
                                        <td width="19%"><input class="parent_txts deleteFun1" type="text" name='contactno_b1_1' id='contactno_b1_1' tagname='contactno_b1' maxlength="10" onKeyPress="return isNumberKey(event)" /></td>
                                        <td width="19%"><input class="parent_txts" type="text"  onChange="return mailCheck(this);" name='contactemail_b1_1' id='contactemail_b_1'  tagname='contactemail_b1'/></td>
                                        <td width="19%"><input class="parent_txts" type="text" name='contactfax_b1_1' id='contactfax_b1_1'  onKeyPress="return isNumberKey(event)" maxlength="10" tagname='contactfax_b1' /></td>
                                        <td class="del1" style="display:none;"><a class="vendar_styles remove" href="#"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <!--dss-->
                            </div>
                        </td>
                    </tr>
                    <!--dss-->
                <?php
                }
                else{
                    $i=1;
                    foreach($resp as $data){
                        ?>
                        <tr class="Maintr mainClass" bid="<?php echo $i;?>">
                            <td class="vendor_cell" width="4%"><?php echo $i;?> &nbsp;<a href="#"><span><i class="fa fa-caret-right"></i></span></a></td>
                            <td width="15%"><input class="parent_txts newRow" type="text" name="branch_name_<?php echo $i;?>" id="branch_name_<?php echo $i;?>" tagname='branch_name' value="<?php echo $data->BranchName;?>" /></td>
                            <td width="15%"><input class="parent_txts" type="text" name="branch_address_<?php echo $i;?>" id="branch_address_<?php echo $i;?>" tagname='branch_address' value="<?php echo $data->Address;?>"/></td>
                            <td width="15%">
                                <div class="vendor_button">
                                    <select name="branch_city_<?php echo $i;?>" id="branch_city_<?php echo $i;?>" tagname="branch_city">
                                        <option value="-1">Select One</option>
                                        <?php
                                        foreach($branchCity as $cityData){
                                            if($data->CityId == $cityData['CityId']){
                                                ?>
                                                <option value="<?php echo $cityData['CityId'];?>" selected><?php echo $cityData['CityName'];?></option>
                                            <?php
                                            }
                                            else
                                            {
                                                ?>
                                                <option value="<?php echo $cityData['CityId'];?>"><?php echo $cityData['CityName'];?></option>
                                            <?php
                                            }
                                        }
                                        ?>
                                    </select>
                                </div>
                            </td>
                            <td width="15%"><input class="parent_txts" type="text" name="branch_tin_<?php echo $i;?>" id="branch_tin_<?php echo $i;?>" maxlength="11" tagname="branch_tin" onkeypress="return  isNumberKey(event);" value="<?php echo $data->TINNo;?>"/></td>
                            <td width="15%"><input class="parent_txts deleteFun" type="text" name="branch_phone_<?php echo $i;?>" id="branch_phone_<?php echo $i;?>" tagname="branch_phone" value="<?php echo $data->Phone;?>"/></td>
                            <td width="15%"><input class="parent_txts" type="text" name="branch_cheque_<?php echo $i;?>" id="branch_cheque_<?php echo $i;?>" maxlength="6" onKeyPress="return isNumberKey(event)" tagname="branch_cheque" value="<?php echo $data->ChequeNo;?>"/></td>
                            <td class="del"><a href="#" class="vendar_styles remove"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a>
                            </td>
                        </tr>
                        <!--dsds-->
                        <tr style='display:none;' class='Subtr mainClass' bid="<?php echo $i;?>">
                            <td colspan=8>
                                <div class='projectDiv' style='display:none;'>
                                    <!--<div class='row'>
                                        <input type='button' class='btn btn-primary addContact' value='Add Contact' style='float:right;margin-right:30px;'>
                                    </div>-->
                                    <input type='hidden' class='form-control contactVal' name="contactTotal_<?php echo $i;?>" tagName='contactTotal' value="<?php echo count($data->contact);?>">
                                    <!--dsds-->
                                    <table class="table table-hover clear" id="table">
                                        <thead>
                                        <tr>
                                            <th>Contact person</th>
                                            <th>Desgination</th>
                                            <th>Contact no</th>
                                            <th>Email</th>
                                            <th>Fax</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <?php
                                        $j = 1;
                                        foreach($data->contact as $contactData){
                                            ?>
                                            <tr>
<!--                                                <td width="1%"><a href="#" class="vendar_plus addContact"><i class="fa fa-plus-circle"></i></a></td>-->
                                                <td width="19%"><input class="parent_txts addContact" type="text" name="contactperson_b<?php echo $i;?>_<?php echo $j;?>" id="contactperson_b<?php echo $i;?>_<?php echo $j;?>" tagname='contactperson_b1' value="<?php echo $contactData->ContactPerson;?>"/></td>
                                                <td width="19%"><input class="parent_txts" type="text" name="designation_b<?php echo $i;?>_<?php echo $j;?>" id="designation_b<?php echo $i;?>_<?php echo $j;?>" tagname='designation_b1' value="<?php echo $contactData->Designation;?>"/></td>
                                                <td width="19%"><input class="parent_txts deleteFun1" type="text" name="contactno_b<?php echo $i;?>_<?php echo $j;?>" id="contactno_b<?php echo $i;?>_<?php echo $j;?>" tagname='contactno_b1' value="<?php echo $contactData->ContactNo;?>"/></td>
                                                <td width="19%"><input class="parent_txts" type="text" onChange="return mailCheck(this);" name="contactemail_b<?php echo $i;?>_<?php echo $j;?>" id="contactemail_b_<?php echo $i;?>_<?php echo $j;?>" tagname='contactemail_b1' value="<?php echo $contactData->Email;?>" /></td>
                                                <td width="19%"><input class="parent_txts" type="text" name="contactfax_b<?php echo $i;?>_<?php echo $j;?>" maxlength="10"  onKeyPress="return isNumberKey(event)" id="contactfax_b<?php echo $i;?>_<?php echo $j;?>" tagname='contactfax_b1' value="<?php echo $contactData->Fax;?>"/></td>
                                                <td class="del1"><a href="#" class="vendar_styles removeContact"><span class="glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></span></a>
                                                </td>
                                            </tr>

                                            <?php
                                            $j++;
                                        }
                                        ?>
                                        </tbody>
                                    </table>
                                    <!--dsds-->
                                </div>
                            </td>
                        </tr>
                        <!--dsds-->
                        <?php
                        $i++;
                    }
                }
                ?>

                </tbody>
                <input type="hidden" name="count" id="count" value="<?php echo $i;?>" />
            </table>
        </div>
    </div>
</div>
</form>
</div>
</div>
<div class="col-lg-12 savebtn_area">
    <ul>
        <li id="sData" class="save_btn float_r">
            <a href="javascript:void(0);" data-attr="1" class="ripple">Save &amp; Exit </a>
        </li>
        <li id="submitdata" class="dropdown save_btn float_r">
            <a href="javascript:void(0);" class="ripple" >Save &amp; Next</a>
        </li>
            <li class="goto">
            <label for="go_to" class="float_l">Go to</label>
            <select id="dropdown" name="dropdown" class="dropdown float_l goto_select" title="Choose Page to go....">
                <option value="1">Basic Details</option>
                <option value="2">Contact Details</option>
                <option value="3">Statutory Details</option>
                <option value="4">Bank Details</option>
                <option value="5" selected="selected" style="background-color:gray;color:white;">Branch Details</option>
                <option value="6">Experience Details</option>
                <option value="7">Terms</option>
                <option value="8">Assessment</option>
                <option value="9">Registration</option>
                <option value="10">Resource</option>
                <option value="11">Financial</option>
                <option value="12">Supply</option>
                <option value="13">Work Group</option>
                <option value="14">Service</option>
                <option value="15">Other Details</option>
                <option value="16">Manufacture</option>
                <option value="17">Dealer</option>
                <option value="18">Distributor</option>
                <option value="19">Vehicle Details</option>
                <option value="20">Vendor Renewal</option>
                <option value="21">Vendor Profile</option>
            </select>
        </li>
        <li id="back" class="cancel_btn float_r" ><a href="<?php echo $this->basePath();?>/vendor/index/bankfinance-detail/<?php echo $this->bsf->encode($vendorId); ?>" class="ripple">back</a></li>
    </ul>
</div>
<script>

    $("#dropdown").change(function(){
        if($(this).val() == 1){
            $(location).attr('href',"../basic-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 2){
            $(location).attr('href',"../contact-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 3){
            $(location).attr('href',"../statutory-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 4){
            $(location).attr('href',"../bankfinance-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 5){
            $(location).attr('href',"../branch-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 6){
            $(location).attr('href',"../experience-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 7){
            $(location).attr('href',"../vendor-terms/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 8){
            $(location).attr('href',"../assessment-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 9){
            $(location).attr('href',"../vendor-registration/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 10){
            $(location).attr('href',"../resource/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 11){
            $(location).attr('href',"../financial/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 12){
            $(location).attr('href',"../supply/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 13){
            $(location).attr('href',"../works/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 14){
            $(location).attr('href',"../service/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 15){
            $(location).attr('href',"../others/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 16){
            $(location).attr('href',"../manufacture-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 17){
            $(location).attr('href',"../dealer-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 18){
            $(location).attr('href',"../distributor-detail/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 19){
            $(location).attr('href',"../vehicleregister/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 20){
            $(location).attr('href',"../vendor-renewal/<?php echo $this->bsf->encode($vendorId); ?>");
        }
        if($(this).val() == 21){
            $(location).attr('href',"../vendor-profile/<?php echo $vendorId; ?>");
        }
    });

$("#submitdata").click(function()
{
    if( errorFlag == 1){
        alert('Please Enter Valid EmailAddress');
        return false;
    }
    $("form").submit();
});

    $("#sData").click(function()
    {
        if( errorFlag == 1){
            alert('Please Enter Valid EmailAddress');
            return false;
        }
        else{
            var sum=2;
            $("#saveExit").val(sum);
            $("form").submit();
        }
    });

removetr();
trClick();
addContact();
//removeContacttr();

    errorFlag = 0;
function mailCheck(x){
    var id = $(x).val();
    var k = $(x).attr('id').split('_');
    var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!regex.test(id)){
        showError($('#contactemail_b_' + k[2]), "Please Enter Valid EmailAddress  ");
        errorFlag = 1;
        return false;
    }
    else{
        removeError($('#contactemail_b_' + k[2]));
        errorFlag = 0;
    }
}
function removetr(){
    $(".remove").unbind("click");
    $(".remove").bind("click", function(){
        if (!confirm('Do you want to Delete'))
            return false;
        if($(this).closest("tr").index() != 0){
            $(this).closest("tr").next("tr.Subtr").remove();
            $(this).closest("tr").remove();

            var i = 1;
            var n = 1;
            $("#branchTotal").val($("#branchTable tbody tr.Maintr").length);
            $("#branchTable tbody:first tr.mainClass").each(function(){
                if($(this).hasClass("Maintr")){
                    n=i;
                    $(this).next(".Subtr").attr("bid", i);
                    $(this).find("select, input:text").each(function(){
                        $(this).attr("name", $(this).attr("tagname")+'_'+i);
                        $(this).attr("id", $(this).attr("tagname")+'_'+i);
                    });
                    $(this).next(".Subtr").find(".contactVal").attr("name", $(this).next(".Subtr").find(".contactVal").attr("tagName")+"_"+i);
                    i++;
                }
                else{
                    $(this).find("table tbody tr").each(function(){
                        var index=$(this).index() + 1;
                        $(this).find("select, input:text").each(function(){
                            $(this).attr("name", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                            $(this).attr("id", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                            $(this).attr("tagname", $(this).attr("tagname").split("_")[0]+'_b'+n);
                        });
                    });
                }
            });
        }
    });
}

    removetr();
    $(".addTech").bind("click", function(){
        var table = $("#table tbody");
        table.append("<tr>"+table.find("tr:first").html()+"</tr>");
        table.find("tr:last td:last").append("<input type='button' class='btn btn-primary remove' value='Remove'>");
        var len = table.find("tr").length;
        table.find("tr").each(function(){
            var index=$(this).index() + 1;
            $(this).find("select, input:text").each(function(){
                $(this).attr("name", $(this).attr("tagname")+'_'+index);
                $(this).attr("id", $(this).attr("tagname")+'_'+index);
                if(len == index)
                    $(this).val('');
            });
        });
        removetr();
    });
    function removetr(){
        $(".remove").unbind("click");
        $(".remove").bind("click", function(){
            if($(this).closest("tr").index() != 1){
                if (!confirm('Do you want to Delete'))
                    return false;
                var table = $(this).closest("table");
                $(this).closest("tr").remove();
                var len = table.find("tbody:first tr").length;
                table.find("tbody tr").each(function(){
                    var index=$(this).index() + 1;
                    $(this).find("select, input:text").each(function(){
                        $(this).attr("name", $(this).attr("tagname")+'_'+index);
                        $(this).attr("id", $(this).attr("tagname")+'_'+index);
                    });
                });
            }
        });
    }


$("#AddNew").click(function(){
    $("#branchTable tbody:first").append("<tr class='Maintr mainClass'>"+$("#branchTable tbody tr:first").html()+"</tr>");
    //$("#branchTable tbody:first tr:last td:last").append("<input type='button' class='btn btn-primary remove' value='Remove'>");
    $("#branchTable tbody:first").append("<tr class='Subtr mainClass' style='display:none;'>"+$("#branchTable tbody tr:nth-child(2)").html()+"</tr>");

    $("#branchTable tbody:first tr.mainClass:last table tbody tr:gt(0)").remove();
    $("#branchTotal").val($("#branchTable tbody tr.Maintr").length);
    var i = 1;
    var n = 1;
    var len = $("#branchTable tbody tr.Maintr").length;
    $("#branchTable tbody:first tr.mainClass").each(function(){
        if($(this).hasClass("Maintr")){
            n=i;
            $(this).next(".Subtr").attr("bid", i);
            $(this).find("select, input:text").each(function(){
                $(this).attr("name", $(this).attr("tagname")+'_'+i);
                $(this).attr("id", $(this).attr("tagname")+'_'+i);
                $("#branchTable tbody tr:last").find('.del').hide();
                if(i==len){
                    var tag = $(this).prop("tagName").toLowerCase();
                    if(tag == 'input')
                        $(this).val('');
                    else
                        $(this).val(-1);
                }

            });
            $(this).next(".Subtr").find(".contactVal").attr("name", $(this).next(".Subtr").find(".contactVal").attr("tagName")+"_"+i);
            i++;
        }
        else{
            $(this).find("table tbody tr").each(function(){
                var index=$(this).index() + 1;
                $(this).find("select, input:text").each(function(){
                    $(this).attr("tagname", $(this).attr("tagname").split("_")[0]+'_b'+n);
                    $(this).attr("name", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                    $(this).attr("id", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                    $("#branchTable tbody tr:last").find('.del').hide();
                    if(n == len)
                        $(this).val('');
                });
            });
        }
    });
    $('#count').val(i);
    removetr();
    trClick();
    addContact();
    $("#branchTable tbody tr.Maintr:last").find('.vendor_cell').html($("#branchTable tbody tr.Maintr").length+'  <a href="#"><span><i class="fa fa-caret-right"></i></span></a>');
});

function trClick(){
    $(".Maintr").unbind("click");
    $(".Maintr").bind('click', function(){
        //alert($(this).next("tr.showSubData").is(":visible"))
        //$(this).next(".showSubData").show();
        if($(this).next("tr.Subtr").is(":visible")){
            $(this).next("tr.Subtr").find(".projectDiv").slideUp("slow");
            $(this).next("tr.Subtr").fadeOut("slow");
            $(this).find("td:first span").text($(this).find("td:first span").text().replace('▼', '►'));
            $(this).find("td:first span").text().slice(0,-1);
        }
        else{
            $("#branchTable tbody:first tr.Maintr").each(function(){
                $(this).find("td:first span").text($(this).find("td:first span").text().replace('▼', '►'));
            });
            /*Inner div */
            $("#branchTable tbody:first tr.wbsSubtr div").slideUp("slow");
            $("#branchTable tbody:first tr.wbsSubtr").fadeOut("slow");

            $("#branchTable tbody:first tr.Subtr .projectDiv").slideUp("slow");
            $("#branchTable tbody:first tr.Subtr").fadeOut("slow");
            $(this).find("td:first span").text($(this).find("td:first span").text().replace('►', '▼'));
            $(this).next("tr.Subtr").fadeIn("slow");
            $(this).next("tr.Subtr").find(".projectDiv").slideDown("slow");
        }
    });
}
//Master Add
//addRow();
function addRow(){
    $( ".newRow" ).unbind();
    $( ".newRow" ).bind('keyup', function() {

        if($(this).val().length>0 && $(this).closest("tr").index() == $("#branchTable tbody tr:last").index()){
            $("#branchTable tbody:first").append("<tr class='Maintr mainClass'>"+$("#branchTable tbody tr:first").html()+"</tr>");
            //$("#branchTable tbody:first tr:last td:last").append("<input type='button' class='btn btn-primary remove' value='Remove'>");
            $("#branchTable tbody:first").append("<tr class='Subtr mainClass' style='display:none;'>"+$("#branchTable tbody tr:nth-child(2)").html()+"</tr>");

            $("#branchTable tbody:first tr.mainClass:last table tbody tr:gt(0)").remove();
            $("#branchTotal").val($("#branchTable tbody tr.Maintr").length);
            var i = 1;
            var n = 1;
            var len = $("#branchTable tbody tr.Maintr").length;
            $("#branchTable tbody:first tr.mainClass").each(function(){
                if($(this).hasClass("Maintr")){
                    n=i;
                    $(this).next(".Subtr").attr("bid", i);
                    $(this).find("select, input:text").each(function(){
                        $(this).attr("name", $(this).attr("tagname")+'_'+i);
                        $(this).attr("id", $(this).attr("tagname")+'_'+i);
                        $("#branchTable tbody tr:last").find('.del').hide();
                        if(i==len){
                            var tag = $(this).prop("tagName").toLowerCase();
                            if(tag == 'input')
                                $(this).val('');
                            else
                                $(this).val(-1);
                        }

                    });
                    $(this).next(".Subtr").find(".contactVal").attr("name", $(this).next(".Subtr").find(".contactVal").attr("tagName")+"_"+i);
                    i++;
                }
                else{
                    $(this).find("table tbody tr").each(function(){
                        var index=$(this).index() + 1;
                        $(this).find("select, input:text").each(function(){
                            $(this).attr("tagname", $(this).attr("tagname").split("_")[0]+'_b'+n);
                            $(this).attr("name", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                            $(this).attr("id", $(this).attr("tagname").split("_")[0]+'_b'+n+'_'+index);
                            if(n == len)
                                $(this).val('');
                        });
                    });
                }
            });
            removetr();
            trClick();
            addContact();
        }
    });
}

    $(document).on('change','.deleteFun',function(){
        if($(this).val() != ''){
            $(this).parent().parent().find('.del').show();

        } else {
            $(this).parent().parent().find('.del').hide();
        }
    });

    $(document).on('change','.deleteFun1',function(){
        if($(this).val() != ''){
            $(this).parent().parent().find('.del1').show();

        } else {
            $(this).parent().parent().find('.del1').hide();
        }
    });

    addContact();
    function addContact(){
        $( ".addContact" ).unbind();
        $( ".addContact" ).bind('keyup', function() {
            if($(this).val().length>0 && $(this).closest("tr").index() == $("#table tbody tr:last").index()){
                $("#table tbody").append("<tr>"+$("#table tbody tr:first").html()+"</tr>");
                $("#table tbody tr").each(function(){
                    var index=$(this).index() + 1;
                    var lastIndex=$("#table tbody tr:last").index() + 1;
                    $(this).find("select, input:text").each(function(){
                        if(index==lastIndex){
                            if($(this).prop("tagName").toLowerCase() == 'input')
                                $(this).val("");
                            else
                                $(this).val("1");
                        }
                        $(this).attr("name", $(this).attr("tagname")+'_'+index);
                        $(this).attr("id", $(this).attr("tagname")+'_'+index);
                        $("#table tbody tr:last").find('.del1').hide();
                    })
                });
                removetr();
                addContact();
            }
        });
    }
    removetr();
</script>		
