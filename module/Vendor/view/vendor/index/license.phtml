<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/select2.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo $this->basePath(); ?>/css/select2.min.css" />
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>" />
<style>
    .panel {
        border-radius:0px !important;
    }
    .input-grouping > .polymer-form {
        width: 70%;
        float: left;
    }
    .input-grouping > .input-group-btn {
        width: 30%;
        top: 2px;
    }
    .input-grouping > .input-group-btn > select.parent_text {
        padding: 5px 4px 6px 4px;
    }
    .input-grouping  > input.parent_text {
        width: 60%;
        float: left;
    }
</style>
<!--content-->
<div class="content_wrapper padlr0">
<div class="container-fluid">
<div class="row">
<form  onsubmit="return entryValidate()"  method="post" id="formWrapper">
<div class="col-lg-12">
    <h1>Vendor License Details</h1>
</div>
<!--accordion start-->

<div class="col-lg-12 clear">
<div class="panel panel-info">
<div data-target="#collapsefour" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-4">
    <h4 class="panel-title defa_panels">License Details</h4>
</div>
<div class="panel-body bgcolr">
<div class="table-responsive topsp">
<table class="table tableWithFloatingHeader" style=" margin-bottom:0px;">
    <thead>
    <tr>
        <th>License Name</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <?php $i=1; if(isset($transDetail) && !empty($transDetail)): 
        foreach($transDetail as $transDetail): ?>
        <tr>
            <td width="10%">
                <input class="parent_text" type="text" name="licenseName_<?php echo $i;?>" id="licenseName_<?php echo $i;?>" maxlength="50" value="<?php echo $transDetail['LicenseName'];?>" onfocus="checkLicenseFocus(this.id)"/>
                <input type="hidden" name="licenseId_<?php echo $i;?>" id="licenseId_<?php echo $i;?>" value="<?php echo $transDetail['LicenseMasterId'];?>">
            </td>
            <td width="3%" align="center">
				<ul class="action_btns">
				<li><a href="#" class="mainTrDelete_<?php echo $i;?>" style="margin-right: 10px; display: none;" onclick="deleteMainTr(this, event);"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></li>
				<li> <a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li></ul>
			</td>
        </tr>
        <!--expand table-->
                                <tr style="display:none;" class="subTr">
                                    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;">
                                            <!-- Nav tabs -->
                                            <div class="table-responsive">
                                                <table style=" margin-bottom:0px;background:#E8FAFD!important; " class="table">
                                                    <tbody>
                                                    <tr>
                                                        <td style="padding:0px !important; border:none;" colspan="9"><div>
                                                                <div style=" margin-top:10px;" class="col-lg-12">
                                                                    <ul class="nav nav-tabs navs-tabs">
                                                                        <li class="active"><a href="#owner_<?php echo $i;?>" data-toggle="tab" aria-expanded="true">Registration Details</a></li>
                                                                    </ul>
                                                                </div>
                                                                <div class="tab-content">
                                                                    <div class="tab-pane fade active in" id="owner_<?php echo $i;?>">
                                                                        <div class="col-lg-12">
                                                                            <div class="table-responsive topsp">
                                                                                <table style=" margin-bottom:0px;" class="table tableWithFloatingHeader">
                                                                                    <thead>
                                                                                    <tr>
                                                                                        <th class="bg_clo">Registration Date</th>
                                                                                        <th class="bg_clo">Registration No</th>
                                                                                        <th class="bg_clo">From</th>
                                                                                        <th class="bg_clo">To</th>
                                                                                        <th class="bg_clo">Remarks</th>
																						<th class="bg_clo">Attach</th>
                                                                                        <th class="bg_clo">Action</th>
                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php $j=1;
																						if(isset($transDetail['validtrans']) && !empty($transDetail['validtrans']) ):
                                                                                            foreach($transDetail['validtrans'] as $validTransDetail): ?>
                                                                                            <tr>
                                                                                                <td width="8%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_regDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_regDate_<?php echo $j;?>" onchange="addSubTr(this)" maxlength="155" value="<?php echo $validTransDetail['RegDate'];?>" onchange="validateDate(this)"></td>
                                                                                                <td width="8%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_regNo_<?php echo $j;?>" id="trans_<?php echo $i;?>_regNo_<?php echo $j;?>" maxlength="155" value="<?php echo $validTransDetail['VendorRegNo'];?>" onchange="addSubTr(this)"></td>
                                                                                                <td width="6%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_startDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_startDate_<?php echo $j;?>" value="<?php echo date('d-m-Y', strtotime($validTransDetail['ValidFrom']));?>" onchange="validateDate(this)"></td>
                                                                                                <td width="6%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_toDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_toDate_<?php echo $j;?>" maxlength="20" value="<?php echo $validTransDetail['ValidTo'];?>" onchange="validateDate(this)"></td>
                                                                                                <td width="5%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_remarks_<?php echo $j;?>" id="trans_<?php echo $i;?>_remarks_<?php echo $j;?>" maxlength="20" value="<?php echo $validTransDetail['Remarks'];?>"></td>
                                                                                                <td width="6%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_attach_<?php echo $j;?>" id="trans_<?php echo $i;?>_attach_<?php echo $j;?>" maxlength="20" value="" onchange="addSubTr(this)"></td>
                                                                                                <td width="3%" align="center">
                                                                                                <ul class="action_btns"><li><a href="#" class="trans_<?php echo $i;?>_co_subTrDelete_<?php echo $j;?>" onclick="deleteSubTr(this, event);" class="subTrDelete" style="margin-right: 10px; display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></li></ul></td>
                                                                                            </tr>
                                                                                        <?php endforeach; else: ?>
																							<tr>
                                                                                                <td width="8%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_regDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_regDate_<?php echo $j;?>" onchange="addSubTr(this)" maxlength="155" value="" onchange="validateDate(this)"></td>
                                                                                                <td width="8%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_regNo_<?php echo $j;?>" id="trans_<?php echo $i;?>_regNo_<?php echo $j;?>" maxlength="155" value="" onchange="addSubTr(this)"></td>
                                                                                                <td width="6%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_startDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_startDate_<?php echo $j;?>" value="" onchange="validateDate(this)"></td>
                                                                                                <td width="6%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans_<?php echo $i;?>_toDate_<?php echo $j;?>" id="trans_<?php echo $i;?>_toDate_<?php echo $j;?>" maxlength="20" value="" onchange="validateDate(this)"></td>
                                                                                                <td width="5%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_remarks_<?php echo $j;?>" id="trans_<?php echo $i;?>_remarks_<?php echo $j;?>" maxlength="20" value=""></td>
                                                                                                <td width="6%"><input type="text" class="parent_text" name="trans_<?php echo $i;?>_attach_<?php echo $j;?>" id="trans_<?php echo $i;?>_attach_<?php echo $j;?>" maxlength="20" value="" onchange="addSubTr(this)"></td>
                                                                                                <td width="3%" align="center">
                                                                                                <ul class="action_btns"><li><a href="#" class="trans_<?php echo $i;?>_co_subTrDelete_<?php echo $j;?>" onclick="deleteSubTr(this, event);" class="subTrDelete" style="margin-right: 10px; display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></li></ul></td>
                                                                                            </tr>
																						<?php endif; ?>
                                                                                    </tbody>
                                                                                </table>
                                                                                <input type="hidden" name="coownerid_<?php echo $i;?>" id="coownerid_<?php echo $i;?>" value="<?php echo $j;?>">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <!-- Tab panes -->
                                        </div
                                    ></td>
                                </tr>
                                <!--expand end-->
    <?php endforeach; else: ?>
        <tr>
            <td width="10%">
                <input class="parent_text" type="text" name="licenseName_1" id="licenseName_1" maxlength="50" onfocus="checkLicenseFocus(this.id)"/>
                <input type="hidden" name="licenseId_1" id="licenseId_1">
            </td>
            <td width="3%" align="center"><ul class="action_btns">
            <li><a href="#" class="mainTrDelete_1" style="margin-right: 10px; display: none;" onclick="deleteMainTr(this, event);"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a> </li>
            <li><a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand" ></i></a></li></ul></td>
        </tr>
        <!--expand table-->
        <tr style="display:none;" class="subTr">
            <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;">
                    <div class="col-lg-12">
                        <div class="table-responsive topsp">
                            <table class="table tableWithFloatingHeader" style=" margin-bottom:0px;">
                            
                                <tbody>
                                <!--expand table-->
                                <tr style="" class="subTr">
                                    <td colspan="9" style="padding:0px !important; "><div class="subDiv" style="display:none;">
                                            <!-- Nav tabs -->
                                            <div class="table-responsive">
                                                <table style=" margin-bottom:0px;background:#E8FAFD!important; " class="table">
                                                    <tbody>
                                                    <tr>
                                                        <td style="padding:0px !important; border:none;" colspan="9"><div>
                                                                <div style=" margin-top:10px;" class="col-lg-12">
                                                                    <ul class="nav nav-tabs navs-tabs">
                                                                        <li class="active"><a href="#owner__1" data-toggle="tab" aria-expanded="true">Registration Details</a></li>
                                                                    </ul>
                                                                </div>
                                                                <div class="tab-content">
                                                                    <div class="tab-pane fade active in" id="owner__1">
                                                                        <div class="col-lg-12">
                                                                            <div class="table-responsive topsp">
                                                                                <table style=" margin-bottom:0px;" class="table tableWithFloatingHeader">
                                                                                    <thead>
                                                                                    <tr>
                                                                                        <th class="bg_clo">Registration Date</th>
                                                                                        <th class="bg_clo">Registration No</th>
                                                                                        <th class="bg_clo">From</th>
                                                                                        <th class="bg_clo">To</th>
                                                                                        <th class="bg_clo">Remarks</th>
                                                                                        <th class="bg_clo">Attach</th>
                                                                                        <th class="bg_clo">Action</th>
                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                    <tr>
                                                                                        <td width="8%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans_1_regDate_1" id="trans_1_regDate_1" onchange="addSubTr(this)" maxlength="155" onchange="validateDate(this)"></td>
                                                                                        <td width="8%"><input type="text" class="parent_text" name="trans_1_regNo_1" id="trans_1_regNo_1" maxlength="155" onchange="addSubTr(this)"></td>
                                                                                        <td width="6%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans_1_startDate_1" id="trans_1_startDate_1" onchange="validateDate(this)"></td>
                                                                                        <td width="6%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans_1_toDate_1" id="trans_1_toDate_1" maxlength="20" onchange="validateDate(this)"></td>
                                                                                        <td width="5%"><input type="text" class="parent_text" name="trans_1_remarks_1" id="trans_1_remarks_1" maxlength="20" onchange="addSubTr(this)" ></td>
                                                                                        <td width="6%"><input type="text" class="parent_text" name="trans_1_attach_1" id="trans_1_attach_1" maxlength="20" onchange="addSubTr(this)"></td>
                                                                                        <td width="3%" align="center">
                                                                                            <ul class="action_btns">
                                                                                                <li>
                                                                                                    <a href="#" class="trans_1_co_subTrDelete_1" onclick="deleteSubTr(this, event);" class="subTrDelete" style="margin-right: 10px; display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a>
                                                                                                </li>
                                                                                            </ul>
                                                                                        </td>
                                                                                    </tr>
                                                                                    </tbody>
                                                                                </table>
                                                                                <input type="hidden" name="coownerid_1" id="coownerid_1" value="1">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <!-- Tab panes -->
                                        </div></td>
                                </tr>
                                <!--expand end-->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    <?php endif; ?>
    <!--expand end-->
    </tbody>
    </tbody>
</table>
<input type="hidden" name="ownerdetailid" id="ownerdetailid" value="1">
</div>
</div>
</div><!--accordion end-->
</div>
</form>
</div>
</div>
</div>

<!--footer-->
<div class="col-lg-12 savebtn_area">
    <ul>
        <li class="dropdown save_btn float_r" id="submit-btn" ><a href="javascript:submitForm();" data-toggle="tooltip" class="ripple" title="Submit!">Submit</a>
        <li class="cancel_btn float_r" id="back-btn"><a href="<?php echo $this->basePath() . '/project/landbank/enquiry';?>" data-toggle="tooltip" class="ripple" title="Cancel!">Cancel</a></li>
    </ul>
</div>

<!--Dummy Main Tr-->
<table id="dummy-licensedetails" style="display: none;">
    <tbody>
    <tr>
        <td width="10%">
            <input class="parent_text" type="text" name="licenseName__1" id="licenseName__1" maxlength="50" onfocus="checkLicenseFocus(this.id)">
            <input type="hidden" name="licenseId__1" id="licenseId__1">
        </td>
        <td width="3%" align="center">
        <ul class="action_btns">
        <li><a href="#" class="mainTrDelete__1" style="margin-right: 10px; display: none;" onclick="deleteMainTr(this, event);"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a></li>
        <li> <a href="#" class="mainTr"> <i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="top" data-original-title="Expand"></i></a></li></ul></td>
    </tr>
    <!--expand table-->
    <tr style="display: none;" class="subTr">
                                <td colspan="9" style="padding:0px !important;"><div class="subDiv" style="display: none;">
                                        <!-- Nav tabs -->
                                        <div class="table-responsive">
                                            <table style=" margin-bottom:0px;background:#E8FAFD!important; " class="table">
                                                <tbody>
                                                <tr>
                                                    <td style="padding:0px !important; border:none;" colspan="9"><div>
                                                            <div style=" margin-top:10px;" class="col-lg-12">
                                                                <ul class="nav nav-tabs navs-tabs">
                                                                    <li class="active"><a href="#owner__1" data-toggle="tab" aria-expanded="true">Registration Details</a></li>
                                                                </ul>
                                                            </div>
                                                            <div class="tab-content">
                                                                <div class="tab-pane fade active in" id="owner__1">
                                                                    <div class="col-lg-12">
                                                                        <div class="table-responsive topsp">
                                                                            <table style=" margin-bottom:0px;" class="table tableWithFloatingHeader">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th class="bg_clo">Registration Date</th>
                                                                                    <th class="bg_clo">Registration No</th>
                                                                                    <th class="bg_clo">From</th>
                                                                                    <th class="bg_clo">To</th>
                                                                                    <th class="bg_clo">Remarks</th>
                                                                                    <th class="bg_clo">Attach</th>
                                                                                    <th class="bg_clo">Action</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                <tr>
                                                                                    <td width="8%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans__1_regDate_1" id="trans__1_regDate_1" onchange="addSubTr(this)" maxlength="155" onchange="validateDate(this)"></td>
                                                                                    <td width="8%"><input type="text" class="parent_text" name="trans__1_regNo_1" id="trans__1_regNo_1" maxlength="155" onchange="addSubTr(this)"></td>
                                                                                    <td width="6%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans__1_startDate_1" id="trans__1_startDate_1" onchange="validateDate(this)"></td>
                                                                                    <td width="6%"><input type="text" class="parent_text date_picker" readonly placeholder="DD-MM-YYYY" name="trans__1_toDate_1" id="trans__1_toDate_1" maxlength="20" onchange="validateDate(this)"></td>
                                                                                    <td width="5%"><input type="text" class="parent_text" name="trans__1_remarks_1" id="trans__1_remarks_1" maxlength="50" onchange="addSubTr(this)"></td>
                                                                                    <td width="6%"><input type="text" class="parent_text" name="trans__1_attach_1" id="trans__1_attach_1" maxlength="20" onchange="addSubTr(this)"></td>
                                                                                    <td width="3%" align="center"><ul class="action_btns"><li><a href="#" class="trans__1_co_subTrDelete_1" onclick="deleteSubTr(this, event);" class="subTrDelete" style="margin-right: 10px;display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></li></ul></td>
                                                                                </tr>
                                                                                </tbody>
                                                                            </table>
                                                                            <input type="hidden" name="coownerid__1" id="coownerid__1" value="1">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- Tab panes -->
                                    </div></td>
                            </tr>
                            <!--expand end-->
    <!--expand end-->
    </tbody>
</table>

<!--Dummy CoOwner subTr-->
<table id="dummy-details" style="display: none;">
    <tbody>
    <tr>
        <td width="8%"><input type="text" class="parent_text date_picker" name="trans__0_regDate__1" id="trans__0_regDate__1" readonly onchange="addSubTr(this)"></td>
        <td width="8%"><input type="text" class="parent_text" name="trans__0_regNo__1" id="trans__0_regNo__1" onchange="addSubTr(this)"></td>
        <td width="6%"><input type="text" class="parent_text date_picker" placeholder="DD-MM-YYYY" name="trans__0_startDate__1" id="trans__0_startDate__1" readonly onchange="validateDate(this)"></td>
        <td width="6%"><input type="text" class="parent_text date_picker" name="trans__0_toDate__1" id="trans__0_toDate__1" readonly onchange="validateDate(this)" ></td>
        <td width="5%"><input type="text" class="parent_text" name="trans__0_remarks__1" id="trans__0_remarks__1" onchange="addSubTr(this)"></td>
        <td width="6%"><input type="text" class="parent_text" name="trans__0_attach__1" id="trans__0_attach__1" onchange="addSubTr(this)"></td>
        <td width="3%" align="center"><ul class="action_btns"><li><a href="#" class="trans__0_co_subTrDelete__1" onclick="deleteSubTr(this, event);" class="subTrDelete" style="margin-right: 10px;display: none;"><i class="fa fa-trash" data-toggle="tooltip" data-placement="top" data-original-title="Delete" ></i></a></li></ul></td>
    </tr>
    </tbody>
</table>

<div id="licensemodal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1>Create License</h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label style="margin-bottom: 10px;">License Name</label>
                        <input type="text" class="parent_text tex-po" name="MLicenseName" id="MLicenseName">
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <div class="col-lg-12"> <a href="#" class="md_cance" data-dismiss="modal" style="position: relative; overflow: hidden;">Cancel<span class="ripple-wrapper"></span><span class="ripple-wrapper"></span></a>
                    <button type="button" id="btn-newlicense" class="md_ok" onclick="return NewLicenseUpdate()">Create</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var arr_license = <?php echo (isset($arr_license)) ? json_encode($arr_license) : '[]';?>;
    var arr_licenselist = <?php echo (isset($arr_license)) ? json_encode($arr_license) : '[]';?>;
    $(function(){
        bindExpandTr();
        bindLicenseAutoComplete();

        // expand first accordian
        $('#panelheading-1').trigger('click');
    });

    function bindLicenseAutoComplete() {
        var $licenseName = $('input[id^=licenseName_]');
        $licenseName.unbind('autocomplete');
        $.each($licenseName, function () {
            var $this = $(this),
                name = $this[0].id;

            if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;

            var arrname = name.split('_');
            var key1 = arrname[1];
            checkLicenseUsed(key1);

            $this.autocomplete({
                lookup: arr_licenselist,
                showNoSuggestionNotice:true,
                noSuggestionNotice: 'Do you want to Create New <input type="button" style="font-weight:bold" class="btn btn-link" id="licensenew_' + key1+'" value="License" onclick="return AddNewLicense(this.id)">',
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function(suggestion) {
                    if(suggestion) {
                        $("#licenseId_" + key1).val(suggestion.data);
                        addMainTr($(this));
                        removeError($(this));
                    }
                }, onSearchStart: function(suggestion) {
                    $("#licenseId_" + key1).val(0);
                }, onSearchComplete: function (query, suggestions) {
                    if(!suggestions.length){
                        showError($(this), 'Required');
                        $("#licenseId_" + key1).val(0);
                    } else
                        removeError($(this));
                }
            });
        });
    }

    function checkLicenseFocus(x) {
        var arrname = x.split('_');
        var key1 = arrname[1];
        checkLicenseUsed(key1);
    }

    function checkLicenseUsed(id) {
        var reskeyid = $('input[id*=licenseId_]');
        arr_licenselist = arr_license;

        arr_licenselist = $.grep(arr_license, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];

                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
    }

    function AddNewLicense(x) {
        var key=x.split('_')[1];

        $('#MLicenseName').val($('#licenseName_' + key).val());
        $('.autocomplete-suggestions').hide();
        $('#licensemodal').data('input','#licenseName_' + key).modal('show');
    }

    function NewLicenseUpdate () {
        var licenseName = $('#MLicenseName').val();
        if(licenseName.length == 0) {
            alert('License Name is required!');
            return false;
        } else {
            removeError($('#MLicenseName'));
        }


        var isFoundInLocal = false;
        $.each(arr_license, function (i, obj) {
            if(obj.value == licenseName) {
                isFoundInLocal = true;
                return false;
            }
        });

        if (isFoundInLocal) {
            alert('License Name Already Exists!');
            return false;
        }

        // check for new license name if its new
        var isNameValid = true;
        $.ajax({
            url: getBaseURL()+ 'vendor/index/checklicensefound',
            type: "post",
            data: {'LicenseName': licenseName},
            async: false,
            success: function (data, textStatus, jqXHR) {
                if(data == 'Y')
                    isNameValid = false;
                else
                    isNameValid = true;
            }, error: function (jqXHR, textStatus, errorThrown) {
                isNameValid = false;
            }
        });

        if (!isNameValid) {
            alert('License Name Already Exists!');
            return false;
        }

        arr_license.push({
            data: 'new',
            value: licenseName
        });

        bindLicenseAutoComplete();

        $($('#licensemodal').data('input')).val(licenseName).triggerHandler('focus');
        $('#licensemodal').modal('hide');
    }

    function bindExpandTr() {
        var $tr = $(".mainTr");
        $tr.unbind('click');
        $tr.click(function(e){
            e.preventDefault();
            var $subtr = $(this).closest("tr").next(".subTr"),
                $i = $(this).find("i");

            if(!$subtr.is(":visible")){
                $subtr.show();
                $subtr.find(".subDiv").slideDown("slow");
                $i.addClass("tform");
            } else{
                $subtr.find(".subDiv").slideUp("slow");
                $subtr.slideUp("slow");
                $i.removeClass("tform");
            }
        });
    }

    function nextAccordian(id) {
        $('#panelheading-' + id).trigger('click');
    }

    function submitForm() {
        $('#formWrapper').submit();
    }

    function entryValidate() {
        var $error = $('.error');
        if($error.length != 0) {
            alert('Kindly notice the error notifications!');

            $error.parents('.collapse:not(.in)').siblings('.panel-heading').trigger('click');
            return false;
        }

        return true;
    }

    function changeSourceName(x) {
        var $el = $(x),
            name = 'Source Name';

        if ($el.val() != "")
            name = $el.find('option:selected').html() + ' Name';

        $('#SourceName').attr('label', name).nextAll('label.placeholder').html(name);
    }

    function validateEmail(x) {
        var $el = $(x);
        if(!/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test($el.val()))
            $el.addClass('error');
        else
            $el.removeClass('error');

    }

    function validateContactNo(x) {
        var $el = $(x);
        if(!/^[0-9\-\.\+]+$/.test($el.val()))
            $el.addClass('error');
        else
            $el.removeClass('error');
    }

    function contactKeyPress(event,x) {
        var charCode = (event.which) ? event.which : event.keyCode,
            value = $(x).val();
        if ((charCode != 43 || value.indexOf('+') != -1 || value.length != 0) &&
            (charCode < 48 || charCode > 57) && charCode !=37 && charCode!=39 && charCode!=8 && charCode!=35 && charCode!=36 && charCode!=9)
            return false;

        return true;
    }

    // Owner Details
    function deleteSubTr(x,e) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $x = $(x),
            $tr = $x.closest('tr');

        if ($tr.parent('tbody').find('> tr').length == 1)
            addSubTr(x,true);

        $tr.remove();
        return false;
    }

    function deleteMainTr(x,e) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        if ($tbody.find('> tr:not(.subTr)').length == 1) {
            var template = $('#dummy-licensedetails tbody').html();
            template = template.replace(/__1/g, '_' + 1);
            $tbody.append(template);
            $('#ownerdetailid').val(1);

            bindExpandTr();
        }

        $tr.next('tr.subTr').remove();
        $tr.remove();
        return false;
    }

    function addSubTr(x, reset) {
        var $x = $(x),
            $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[1];

        if ($tr.next('tr').length != 0)
            return;

        var $coownerid = $('#coownerid_' + key),
            rowId = parseInt($coownerid.val()),
            count = rowId + 1;

        if ($('#trans_'+key+'_regDate_' + rowId).val().length == 0 || $('#trans_'+key+'_regNo_' + rowId).val().length == 0)
            return;

        var template = $('#dummy-details tbody').html();

        if(typeof reset != 'undefined' && reset == true)
            count = 1;

        template = template.replace(/__0/g, '_' + key).replace(/__1/g, '_' + count);
        $tr.after(template);
        bindDatePicker();

        $('.trans_'+key+'_co_subTrDelete_' + rowId).show();
        $coownerid.val(count);
    }

    function bindDatePicker() {
        $('.date_picker').datepicker({
            'format': 'dd-mm-yyyy'
        }).on('changeDate', function() {
            $('.datepicker').hide();
        }).data('datepicker');
    }

    function addMainTr(x) {
        var $x = $(x),
            rowid  = $x[0].id.split('_')[1],
            $tr = $x.closest('tr');

        if ($tr.nextAll('tr:not(.subTr)').length != 0)
            return;

        if ($('#licenseName_' + rowid).val().length == 0)
            return;

        var $ownerdetailid = $('#ownerdetailid'),
            count = parseInt($ownerdetailid.val()) + 1,
            template = $('#dummy-licensedetails tbody').html();

        template = template.replace(/__1/g, '_' + count);
        $tr.parent('tbody').append(template);

        $ownerdetailid.val(count);
        $('.mainTrDelete_' + rowid).show();
        bindDatePicker();
        bindExpandTr();
        bindLicenseAutoComplete();
    }

    $(function() {
        $(".single_dropdown2").select2({
            placeholder: "",
            minimumResultsForSearch: -1
        });
    });
</script>
