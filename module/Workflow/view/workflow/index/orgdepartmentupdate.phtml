<?php //if($mode=="edit") { $RowList = 0; ?>
<?php $RowList = 0; ?>
<?php if ($DeptId !=0) { ?>
<tr id="rtDivDept" class="close_tr">
<td colspan="4">
<?php } else { ?>
<div class="col-lg-12 clear" id="ocDivDept_1" style="display:none;">

<?php } ?>
<form method="post" action="<?php echo $this->basePath();?>/workflow/index/orgdepartmentupdate" id="editform">
<input type="hidden" name="DeptId" id="DeptId" value="<?php echo $DeptId; ?>" />
<input type="hidden" name="PositionId" id="PositionId" value="0" />
<div class="adddprtmnt_box col-lg-12 padlr0 animated fadeInUp" style="background:#F3F2F5">
<button type="button" class="close mainTr" rel="rt" data-dismiss="modal" aria-label="Close"><span><i class="fa fa-times"></i></span></button>
<div class="col-lg-4 col-md-4 col-sm-4">
    <div class="form-group col-lg-12 req_flds">
        <input type="text" name="deptName" id="deptName" class="form-control lbl_move" label="Department Name"  value="<?php echo $resultDeptRegs['Dept_Name']; ?>"/>
        <div class="error_message">
            <p>Please enter Department Name...</p>
        </div>
    </div>
</div>
<div class="col-lg-4 col-md-4 col-sm-4 col-sm-12">
    <div class="form-group col-lg-12">
        <select class="single_dropdown lbl_move" name="positionTypeId" id="positionTypeId" style="width:100%;" label="Department Type..." >
            <option value="0" <?php if($resultDeptRegs['DeptTypeId']==0) { echo "selected"; } ?>>None</option>
            <?php  if(isset($ResultPositionType)) {
                foreach($ResultPositionType as $trans) { ?>
                    <option value="<?php echo $trans['PositionTypeId'];?>" <?php if($trans['PositionTypeId']==$resultDeptRegs['DeptTypeId']) { echo "selected"; } ?>><?php echo $trans['PositionTypeName']; ?></option>
                <?php }
            }
            ?>
        </select>
        <!--        -->
        <!--        -->
        <!--        <input type="text" name="emailId" id="emailId" class="form-control lbl_move" label="Email Id" value="--><?php //echo $resultDeptRegs['EMail']; ?><!--"/>-->
        <!--        <div class="error_message">-->
        <!--            <p>Please enter valid EmailId...</p>-->
        <!--        </div>-->
    </div>
</div>
<div class="col-lg-4 col-md-4 col-sm-4 col-sm-12">
    <div class="form-group col-lg-12">
        <input type="text" name="emailId" id="emailId" class="form-control lbl_move" label="Email Id" value="<?php echo $resultDeptRegs['EMail']; ?>"/>
<!--        <div class="error_message">-->
<!--            <p>Please enter valid EmailId...</p>-->
<!--        </div>-->
    </div>
</div>
<div id="accordion" class="col-md-12 col-sm-12">
<div class="panel panel-default col-md-12 col-sm-12 col-sm-12" style="padding:0 !important">
    <div class="panel-heading accordion_head" role="tab" data-toggle="collapse" data-parent="#accordion" href="#ckcollapse" aria-expanded="true" aria-controls="ckcollapse" id="panelheading-1">
        <h4>Department Positions</h4>
    </div>
    <div id="ckcollapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ckheading">
        <div class="panel-body" style="padding:10px 15px !important">
            <div class="col-lg-12 padlr0">
                <div class="col-lg-6 col-md-6 col-sm-6">
                    <div class="headingWrapper">
                        <p style="cursor:pointer" onclick="addNewPosition()" class="heading_checkbox">Select Position
                                                                                    <span class="stgedit_btn req_addbtn brad_50" style="top:0">
                                                                                      <a data-toggle="tooltip" style="padding-top:4px" data-placement="right" title="Add New Position" class="btn_newlist"> <i class="fa fa-plus"></i></a>
                                                                                    </span>
                        </p>
                        <section class="search-container">
                            <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                            <input class="form-control lbl_move height25" type="text" onkeyup="chkSearch(this)" placeholder="Search... ">
                        </section>
                    </div>
                    <div class="card">
                        <div class="card-body" style="min-height:50px; max-height:310px;">
                            <!--checkboxtabel-->
                            <?php $RowList = $RowList + 1;?>
                            <ul class="sampleUI list ui-sortable lilen_<?php echo $RowList; ?>" data-sortable="true" id="unCheckedUl_<?php echo $RowList; ?>">
                                <?php foreach($ResultPosition as $rDeptdata1){ ?>
                                    <li class="tile ui-sortable-handle search-item">
                                        <div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">
                                            <label>
                                                <input class="search-element" data-name="<?php echo $rDeptdata1['PositionName'];?>" type="checkbox" data-id="<?php echo $RowList; ?>" name="customize_<?php echo $rDeptdata1['PositionId'];?>" onclick="checkSelectAll('<?php echo $RowList;?>');" tagname='positioncid' cid="<?php echo $rDeptdata1['PositionId'];?>" id="customize_<?php echo $rDeptdata1['PositionId'];?>" value="<?php echo $rDeptdata1['PositionId'];?>_S">
                                                <span><?php echo $rDeptdata1['PositionName'];?></span> </label>
                                            <input class="selId" type="hidden" value="<?php echo $rDeptdata1['PositionId'];?>">
                                        </div>
                                    </li>
                                <?php }	?>
                            </ul>
                            <!--end of checkboxtabel-->
                        </div>
                        <div class="pull-right">
                            <div class="radio_check">
                                <p>
                                    <input type="checkbox" class="mycheck_<?php echo $RowList; ?>" value="1" id="select_all_<?php echo $RowList; ?>" onclick="selectAll('<?php echo $RowList; ?>');" />
                                    <label for="select_all_<?php echo $RowList; ?>" class="ripple">Select all</label>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end of scrollbar-->
                <div class="col-lg-6 col-md-6 col-sm-6">
                    <div class="headingWrapper">
                        <p class="heading_checkbox">Selected Position</p>
                        <section class="search-container">
                            <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                            <input class="form-control lbl_move height25" type="text" onkeyup="chkSearch(this)"  placeholder="Search... ">
                        </section>
                    </div>
                    <div class="card">
                        <div class="card-body" style="min-height:50px; max-height:310px;">
                            <!--checkboxtabel-->
                            <ul class="sampleUI list ui-sortable sellen_<?php echo $RowList; ?>" data-sortable="true" id="checkedUl_<?php echo $RowList; ?>">
                                <?php
                                $Hidcid = array();
                                foreach($ResultPositionSel as $rActivitydataSel1){ ?>
                                    <li class="tile ui-sortable-handle check_vendor_background search-item">
                                        <div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">
                                            <label>
                                                <input class="search-element" type="checkbox" data-name="<?php echo $rActivitydataSel1['PositionName'];?>" data-id="<?php echo $RowList; ?>" name="customize_<?php echo $rActivitydataSel1['PositionId'];?>" onclick="checkSelectAll('<?php echo $RowList;?>');" tagname='positioncid' cid="<?php echo $rActivitydataSel1['PositionId'];?>" id="customize_<?php echo $rActivitydataSel1['PositionId'];?>" value="<?php echo $rActivitydataSel1['PositionId'];?>_S" checked="checked" />
                                                <span><?php echo $rActivitydataSel1['PositionName'];?></span> </label>
                                            <input type="hidden" class="selId" value="<?php echo $rActivitydataSel1['PositionId'];?>">
                                        </div>
                                    </li>
                                    <?php
                                    array_push($Hidcid, $rActivitydataSel1['PositionId']);
                                } ?>
                                <input type="hidden" name="spositioncid" id="spositioncid" value="<?php echo implode(",", $Hidcid); ?>">
                            </ul>
                            <!--end of checkboxtabel-->
                        </div>
                    </div>
                </div>
                <div class="cont_bt col-md-6 col-md-offset-6">
                    <div style="float:right" class="next-bt form-group"><a href="javascript:clickNext();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="panel panel-default col-md-12 col-sm-12" style="padding:0 !important">
    <div class="panel-heading accordion_head" role="tab" data-toggle="collapse" data-parent="#accordion" href="#ckcollapse2" aria-expanded="false" aria-controls="ckcollapse2" id="panelheading-2">
        <h4>Position Setting</h4>
    </div>
    <div id="ckcollapse2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ckheading">
        <div class="panel-body">
            <div class="col-md-12" style="padding:0 !important">
                <div class="col-md-4 col-sm-4">
                    <ul class="list-head col-md-12"style="background:#fff">
                        <?php foreach($ResultPositionSel as $trans) { ?>
                            <li id="opccid_<?php echo $trans['PositionId']; ?>" ><a href="javascript:showDeptPositionDetails(<?php echo $trans['PositionId']; ?>);"><?php echo $trans['PositionName']; ?></a></li>
                        <?php } ?>
                    </ul>
                </div>
                <div class="col-md-8 col-sm-8">
                    <div class="col-md-12 col-sm-12 col-xs-12" style="background:#fff; border:1px solid #ddd; padding:0 !important">
                        <ul class="nav nav-pills list-per">
                            <li class="active" id="per_divactivty"><a href="#activity" aria-controls="activity" role="tab" data-toggle="tab">Activity</a></li>
                            <li id="per_divrole" ><a href="#wrole" aria-controls="wrole" role="tab" data-toggle="tab">Role</a></li>
                            <li id="per_divpermission" ><a href="#permission" aria-controls="permission" role="tab" data-toggle="tab">Permission</a></li>
                            <!--    <li><a href="#variance" aria-controls="variance" role="tab" data-toggle="tab">Variance</a></li>-->
                            <li id="per_divalert"><a href="#alert" aria-controls="alert" role="tab" data-toggle="tab">Alerts</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="activity">
                                <div class="col-lg-12 padlr0">
                                    <div class="col-lg-6 col-sm-12">
                                        <div class="headingWrapper">
                                            <p class="heading_checkbox">Select Activity</p>
                                            <section class="search-container">
                                                <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                                                <input class="form-control lbl_move height25" type="text" onkeyup="chkSearch(this)" placeholder="Search... ">
                                            </section>
                                        </div>
                                        <div class="card">
                                            <div class="card-body" style="min-height:50px; max-height:310px;">
                                                <!--checkboxtabel-->
                                                <?php $RowList = $RowList + 1;?>
                                                <ul class="sampleUI list ui-sortable lilen_<?php echo $RowList; ?>" data-sortable="true" id="unCheckedUl_<?php echo $RowList; ?>"></ul>
                                                <!--end of checkboxtabel-->
                                            </div>
                                            <div class="pull-right">
                                                <div class="radio_check">
                                                    <p>
                                                        <input type="checkbox" class="mycheck_<?php echo $RowList; ?>" value="1" id="select_all_<?php echo $RowList; ?>" onclick="selectAll('<?php echo $RowList; ?>');" />
                                                        <label for="select_all_<?php echo $RowList; ?>" class="ripple">Select all</label>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--end of scrollbar-->
                                    <div class="col-lg-6 col-sm-12">
                                        <div class="headingWrapper">
                                            <p class="heading_checkbox">Selected Activity</p>
                                            <section class="search-container">
                                                <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                                                <input class="form-control lbl_move height25" onkeyup="chkSearch(this)" type="text" placeholder="Search... ">
                                            </section>
                                        </div>
                                        <div class="card">
                                            <div class="card-body" style="min-height:50px; max-height:310px;">
                                                <!--checkboxtabel-->
                                                <ul class="sampleUI list ui-sortable sellen_<?php echo $RowList; ?>" data-sortable="true" id="checkedUl_<?php echo $RowList; ?>"></ul>
                                                <!--end of checkboxtabel-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="wrole">
                                <div class="col-lg-12 padlr0">
                                    <div class="headingWrapper">
                                        <section class="col-md-12">
										<div class="col-md-4" style="margin-top:19px">
										<div class="checkbox checkbox-styled tile-text" style="margin-bottom:0px">
                                            <label>
                                                <input class="search-element" id="selectall" type="checkbox">
                                                <span>Select All</span> </label>
                                            <input class="selId" value="17" type="hidden">
                                        </div>
										</div>
                                            <div class="input-group col-md-6 col-md-offset-6" style="margin-top:5px">
											<input name="search_all" id="search_all" type="text" onkeyup="chkSearchtr(this)" class="form-control grid_search_input"/>
											<span class="input-group-btn">
												<button class="btn grid_search_btn" type="button">
													<span><i class="fa fa-search" aria-hidden="true"></i></span>
												</button>
											</span>
                                            </div>
                                        </section>
                                    </div>
                                    <div class="card col-xs-12" style="padding:0 !important">
                                        <div class="table-responsive topsp parent-scroll">
                                            <table class="table table-fixed" style="margin-bottom:0px;" id="taskTable" >
                                                <thead>
                                                <tr class="col-xs-12" style="padding:0 !important">
                                                    <th class="col-xs-7" width="50%">Task Name</th>
                                                    <th class="col-xs-1" width="10%">Create</th>
                                                    <th class="col-xs-1" width="10%">Edit</th>
                                                    <th class="col-xs-1" width="10%">Delete</th>
                                                    <th class="col-xs-1" width="10%">Approve</th>
                                                    <th class="col-xs-1" width="10%">View</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="permission">
                                <div class="col-lg-12 padlr0">
                                    <div class="col-lg-12 col-md-12 clear">
                                        <div class="headingWrapper">
                                            <section class="col-md-12">
                                                <div class="input-group col-md-offset-8 col-md-4">
                                                    <input name="search_all" id="search_all" type="text" onkeyup="chkSearchtr(this)" class="form-control grid_search_input"/>
                                <span class="input-group-btn">
                                    <button class="btn grid_search_btn" type="button">
                                        <span><i class="fa fa-search" aria-hidden="true"></i></span>
                                    </button>
                                </span>
                                                </div>
                                            </section>
                                        </div>
                                        <div class="card col-xs-12">
                                            <div class="table-responsive" style="min-height:200px;">
                                                <table class="table table-fixed" style="margin-bottom: 0;" id="roleTable">
                                                    <thead>
                                                    <tr class="col-xs-12" style="padding:0 !important">
                                                        <th class="col-xs-1">&nbsp;</th>
                                                        <th class="col-xs-11">Name</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="alert">
                                <div class="col-lg-12 padlr0">
                                    <div class="col-lg-6 col-sm-12 clear">
                                        <div class="headingWrapper">
                                            <p class="heading_checkbox">Select Alerts</p>
                                            <section class="search-container">
                                                <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                                                <input class="form-control lbl_move height25" type="text" onkeyup="chkSearch(this)" placeholder="Search... ">
                                            </section>
                                        </div>
                                        <div class="card">
                                            <div class="card-body" style="min-height:50px; max-height:310px;">
                                                <!--checkboxtabel-->
                                                <?php
                                                $RowList = $RowList + 1; ?>
                                                <ul class="sampleUI list ui-sortable lilen_<?php echo $RowList; ?>" data-sortable="true" id="unCheckedUl_<?php echo $RowList; ?>"></ul>
                                                <!--end of checkboxtabel-->
                                            </div>
                                            <div class="pull-right">
                                                <div class="radio_check">
                                                    <p>
                                                        <input type="checkbox" class="mycheck_<?php echo $RowList; ?>"  value="1" id="select_all_<?php echo $RowList; ?>" onclick="selectAll('<?php echo $RowList; ?>');" />
                                                        <label for="select_all_<?php echo $RowList; ?>" onkeyup="chkSearch(this)" class="ripple">Select all</label>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--end of scrollbar-->
                                    <div class="col-lg-6 col-sm-12">
                                        <div class="headingWrapper">
                                            <p class="heading_checkbox">Selected Alerts</p>
                                            <section class="search-container">
                                                <label> <i class="fa fa-search" aria-hidden="true"></i> <span class="sr-only">Search icons</span> </label>
                                                <input class="form-control lbl_move height25" type="text" onkeyup="chkSearch(this)" placeholder="Search... ">
                                            </section>
                                        </div>
                                        <div class="card">
                                            <div class="card-body" style="min-height:50px; max-height:310px;">
                                                <!--checkboxtabel-->
                                                <ul class="sampleUI list ui-sortable sellen_<?php echo $RowList; ?>" data-sortable="true" id="checkedUl_<?php echo $RowList; ?>"></ul>
                                                <!--end of checkboxtabel-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="cont_bt col-md-6 col-sm-6"><a class="ripple back-btn has-ripple" href="javascript:clickPerBack();" style="position: relative; overflow: hidden;"><i class="fa fa-backward" aria-hidden="true"></i>&nbsp; Back<span class="ripple-wrapper"></span></a></div>
                            <div class="cont_bt col-md-6 col-sm-6">
                                <div id="divnext" style="float:right" class="next-bt form-group"><a href="javascript:clickPerNext();">Next <i class="fa fa-chevron-circle-right"></i></a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-12 savebtn_area padlr0 marg0 clear">
        <ul>
            <li class="save_btn float_r">
                <button type="button" data-slide="next" data-stepno="4" data-toggle="tooltip" data-placement="left" class="ripple editSubmitBtn" title="Update">Update</button>
                <div id="dept-update-loader" class="post_loader ask_post_loader brad_50"> <img title="" alt="" src="/bsf_v1.1/public/images/post-loader.gif"> </div>
            </li>
        </ul>
    </div>
</div>
<input type="hidden" name="arrActivityTrans" id="arrActivityTrans" value="" />
<input type="hidden" name="arrAlertTrans" id="arrAlertTrans" value="" />
<input type="hidden" name="arrRoleTrans" id="arrRoleTrans" value="" />
<input type="hidden" name="arrPermissionTrans" id="arrPermissionTrans" value="" />
</form>
<?php if ($DeptId !=0) { ?>
</td>
</tr>
<?php } else { ?>
    </div>
    </div>
<?php } ?>
<script type="text/javascript">

var arrActivityTrans = <?php echo (isset($ResultActivityTrans)) ? json_encode($ResultActivityTrans) : '[]';?>;
var arrAlertTrans = <?php echo (isset($ResultAlertTrans)) ? json_encode($ResultAlertTrans) : '[]';?>;
var arrActivityMaster = <?php echo (isset($ResultActivity)) ? json_encode($ResultActivity) : '[]';?>;
var arrAlertMaster = <?php echo (isset($ResultAlert)) ? json_encode($ResultAlert) : '[]';?>;
var arrRoleTrans = <?php echo (isset($ResultRoleTrans)) ? json_encode($ResultRoleTrans) : '[]';?>;
var arrPermissionTrans = <?php echo (isset($ResultPermissionTrans)) ? json_encode($ResultPermissionTrans) : '[]';?>;
var arrTaskTransMaster = <?php echo (isset($ResultTaskTransMaster)) ? json_encode($ResultTaskTransMaster) : '[]';?>;
var arrPosActivityTrans = [];
var arrPosAlertTrans = [];
var arrPosRoleTrans = [];
var arrPosPermissionTrans = [];

$(".multiple_dropdown").select2({
    placeholder: ""
});
function chkSearch(x) {
    var $x = $(x),
        searchText = $.trim($x.val()),
        $checklistWrapper = $x.parents('.headingWrapper').next('.card'),
        delayTimer = 0;
//      console.log($checklistWrapper);
    clearTimeout(delayTimer);
    delayTimer = setTimeout(function () {
        if(searchText.length == 0) {
            $checklistWrapper.find('.search-element').closest('.search-item').show();
            return;
        }
        var $foundChks = $checklistWrapper.find('.search-element');

        $.each($foundChks, function () {
            var name = $(this).attr('data-name').toLowerCase();
//                console.log(name);
            if(name.indexOf(searchText.toLowerCase()) == -1) {
                $(this).closest('.search-item').fadeOut(100);
                return;
            }
            $(this).closest('.search-item').fadeIn(100);
//                $(this).closest('tr').fadeIn(100);
        });
    }, 300);
}

function chkSearchtr(x) {
    var $x = $(x),
        searchText = $.trim($x.val()),
        $checklistWrapper = $x.parents('.headingWrapper').next('.card'),
        delayTimer = 0;

    //console.log($checklistWrapper);
    clearTimeout(delayTimer);
    delayTimer = setTimeout(function () {
        if(searchText.length == 0) {
            $checklistWrapper.find('.search-element').closest('tr').show();
            return;
        }
        var $foundChks = $checklistWrapper.find('.search-element');
        $.each($foundChks, function () {
            var name = $(this).attr('data-name').toLowerCase();
            // console.log(name);
            if(name.indexOf(searchText.toLowerCase()) == -1) {
                $(this).closest('tr').fadeOut(100);
                return;
            }
            //$(this).closest('.search-item').fadeIn(100);
            $(this).closest('tr').fadeIn(100);
        });
    }, 300);
}

function UpdatePositionValue(iPositionId) {
    var iDeptId=$('#DeptId').val();

    var arrActivity = $.grep(arrActivityTrans, function (element, index) {
        return element.DeptId != iDeptId || element.PositionId != iPositionId});

    arrActivityTrans = [];
    arrActivityTrans = arrActivity;
    for (var i in arrPosActivityTrans) {
        arrActivityTrans.push({
            DeptId: arrPosActivityTrans[i].DeptId,
            PositionId: arrPosActivityTrans[i].PositionId,
            ActivityId: arrPosActivityTrans[i].ActivityId,
            ActivityName: arrPosActivityTrans[i].ActivityName
        });
    }

    var arrAlert = $.grep(arrAlertTrans, function (element, index) {
        return element.DeptId != iDeptId || element.PositionId != iPositionId});

    arrAlertTrans = [];
    arrAlertTrans = arrAlert;
    for (var i in arrPosAlertTrans) {
        arrAlertTrans.push({
            DeptId: arrPosAlertTrans[i].DeptId,
            PositionId: arrPosAlertTrans[i].PositionId,
            AlertId: arrPosAlertTrans[i].AlertId,
            AlertName: arrPosAlertTrans[i].AlertName
        });
    }

    var arrRole = $.grep(arrRoleTrans, function (element, index) {
        return element.DeptId != iDeptId || element.PositionId != iPositionId});

    arrRoleTrans = [];
    arrRoleTrans = arrRole;
    for (var i in arrPosRoleTrans) {
        arrRoleTrans.push({
            DeptId: arrPosRoleTrans[i].DeptId,
            PositionId: arrPosRoleTrans[i].PositionId,
            TaskName: arrPosRoleTrans[i].TaskName,
            RoleType: arrPosRoleTrans[i].RoleType,
            RoleId: arrPosRoleTrans[i].RoleId
        });
    }

    var arrPermission = $.grep(arrPermissionTrans, function (element, index) {
        return element.DeptId != iDeptId || element.PositionId != iPositionId});

    arrPermissionTrans = [];
    arrPermissionTrans = arrPermission;
    for (var i in arrPosPermissionTrans) {
        arrPermissionTrans.push({
            DeptId: arrPosPermissionTrans[i].DeptId,
            PositionId: arrPosPermissionTrans[i].PositionId,
            RoleName: arrPosPermissionTrans[i].RoleName,
            RoleId: arrPosPermissionTrans[i].RoleId
        });
    }
}


function showDeptPositionDetails(iPositionId) {
    var iOldPositionId=$('#PositionId').val();
    if (iOldPositionId !=0) {
        UpdatePositionValue(iOldPositionId);
    }

    $('#PositionId').val(iPositionId);
    var iDeptId=$('#DeptId').val();
    var bFound=false;

    //Activity
    arrPosActivityTrans = $.grep(arrActivityTrans, function (element, index) {
        return element.DeptId == iDeptId && element.PositionId == iPositionId});

    var arrMPosActivity = [];

    for (var i in arrActivityMaster) {
        var arr = $.grep(arrPosActivityTrans, function (element, index) {
            return element.ActivityId == arrActivityMaster[i].ActivityId});
        if (arr.length ==0) {
            arrMPosActivity.push({
                ActivityId: arrActivityMaster[i].ActivityId,
                ActivityName: arrActivityMaster[i].ActivityName
            });
        }
    }

    $('#unCheckedUl_2').html();
    var sHtml= "";
    for (var i in arrMPosActivity) {
        sHtml = sHtml + '<li class="tile ui-sortable-handle search-item">' +
        '<div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">' +
        '<label>' +
        '<input type="checkbox" class="search-element" data-name="' + arrMPosActivity[i].ActivityName + '" data-id="2" name="customize_' +  arrMPosActivity[i].ActivityId + '" onclick="checkSelectAll(2);"' +
        'tagname="cid" cid="' + arrMPosActivity[i].ActivityName + '" id="customize_' + arrMPosActivity[i].ActivityName + '" value="' + arrMPosActivity[i].ActivityName + '_S">' +
        '<span>' + arrMPosActivity[i].ActivityName + '</span> </label>' +
        '<input class="selId" type="hidden" data-name="' + arrMPosActivity[i].ActivityName + '" value="' + arrMPosActivity[i].ActivityId + '">'+
        '</div></li>';
    }
    $('#unCheckedUl_2').html(sHtml);
    $('#checkedUl_2').html();
    sHtml= "";
    var argActivityIds="";
    for (var i in arrPosActivityTrans) {
        sHtml = sHtml + '<li class="tile ui-sortable-handle check_vendor_background search-item">' +
        '<div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">' +
        '<label>' +
        '<input type="checkbox" class="search-element" data-name="' + arrPosActivityTrans[i].ActivityName + '" data-id="2" name="customize_' +  arrPosActivityTrans[i].ActivityId + '" onclick="checkSelectAll(2);"' +
        'tagname="cid" cid="' + arrPosActivityTrans[i].ActivityName + '" id="customize_' + arrPosActivityTrans[i].ActivityName + '" value="' + arrPosActivityTrans[i].ActivityName + '_S"  checked="checked">' +
        '<span>' + arrPosActivityTrans[i].ActivityName + '</span> </label>' +
        '<input class="selId" type="hidden" data-name="' + arrPosActivityTrans[i].ActivityName + '" value="' + arrPosActivityTrans[i].ActivityId + '">'+
        '</div></li>';
        argActivityIds = argActivityIds + arrPosActivityTrans[i].ActivityId + ",";
    }
    $('#checkedUl_2').html(sHtml);


    //Alert
    arrPosAlertTrans = $.grep(arrAlertTrans, function (element, index) {
        return element.DeptId == iDeptId && element.PositionId == iPositionId});

    var arrMPosAlert = [];

    for (var i in arrAlertMaster) {
        var arr = $.grep(arrPosAlertTrans, function (element, index) {
            return element.AlertId == arrAlertMaster[i].AlertId});
        if (arr.length ==0) {
            arrMPosAlert.push({
                AlertId: arrAlertMaster[i].AlertId,
                AlertName: arrAlertMaster[i].AlertName
            });
        }
    }

    $('#unCheckedUl_3').html();
    var sHtml= "";
    for (var i in arrMPosAlert) {
        sHtml = sHtml + '<li class="tile ui-sortable-handle search-item">' +
        '<div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">' +
        '<label>' +
        '<input type="checkbox" class="search-element" data-name="' + arrMPosAlert[i].AlertName + '" data-id="3" name="alertcustomize_' +  arrMPosAlert[i].AlertId + '" onclick="checkSelectAll(3);"' +
        'tagname="alertcid" cid="' + arrMPosAlert[i].AlertName + '" id="alertcustomize_' + arrMPosAlert[i].AlertName + '" value="' + arrMPosAlert[i].AlertName + '_S">' +
        '<span>' + arrMPosAlert[i].AlertName + '</span> </label>' +
        '<input class="selId" type="hidden" data-name="' + arrMPosAlert[i].AlertName + '" value="' + arrMPosAlert[i].AlertId + '">'+
        '</div></li>';
    }
    $('#unCheckedUl_3').html(sHtml);
    $('#checkedUl_3').html();
    sHtml= "";
    for (var i in arrPosAlertTrans) {
        sHtml = sHtml + '<li class="tile ui-sortable-handle check_vendor_background search-item">' +
        '<div class="checkbox checkbox-styled tile-text vendor_checkboxborder_gray">' +
        '<label>' +
        '<input type="checkbox" class="search-element" data-name="' + arrPosAlertTrans[i].AlertName + '" data-id="3" name="alertcustomize_' +  arrPosAlertTrans[i].AlertId + '" onclick="checkSelectAll(3);"' +
        'tagname="alertcid" cid="' + arrPosAlertTrans[i].AlertName + '" id="alertcustomize_' + arrPosAlertTrans[i].AlertName + '" value="' + arrPosAlertTrans[i].AlertName + '_S"  checked="checked">' +
        '<span>' + arrPosAlertTrans[i].AlertName + '</span> </label>' +
        '<input class="selId" type="hidden" data-name="' + arrPosAlertTrans[i].AlertName + '" value="' + arrPosAlertTrans[i].AlertId + '">'+
        '</div></li>';
    }
    $('#checkedUl_3').html(sHtml);

    if (argActivityIds !="") argActivityIds = argActivityIds.substring(0, argActivityIds.length - 1);
    populateRole(argActivityIds);
}
function clickNext() {
    $("#panelheading-2").trigger('click');
}
function clickPerNext() {
    var sPerName = "";
    var $resnames = $('li[id*=per_]');
    console.log($resnames);
    $.each($resnames, function (i, obj) {
        var name = $(this)[0].id,
            sname = name.split('_')[1];
        if ($("#" + name).hasClass("active")) {
            sPerName =sname;
            return false;
        }
    });
    $('#divnext').show();
    if (sPerName =="") return;
    if (sPerName =="divactivty") $('#per_divrole > a').trigger('click');
    else if (sPerName =="divrole") $('#per_divpermission > a').trigger('click');
    else if (sPerName =="divpermission") { $('#per_divalert > a').trigger('click'); $('#divnext').hide(); }
}
function clickPerBack() {
    var sPerName = "";
    var $resnames = $('li[id*=per_]');
    console.log($resnames);
    $.each($resnames, function (i, obj) {
        var name = $(this)[0].id,
            sname = name.split('_')[1];
        if ($("#" + name).hasClass("active")) {
            sPerName =sname;
            return false;
        }
    });
    $('#divnext').show();
    if (sPerName =="") return;
    if (sPerName =="divactivty") $("#panelheading-1").trigger('click');
    else if (sPerName =="divrole") $('#per_divactivty > a').trigger('click');
    else if (sPerName =="divpermission") $('#per_divrole  > a').trigger('click');
    else if (sPerName =="divalert") $('#per_divpermission  > a').trigger('click');
}


function populateRole(argActivityIds) {
    var arrTaskMaster = [], arrRoleMaster = [];
    $('#taskTable > tbody').html('');
    $('#roleTable > tbody').html('');

    var iPositionId = $('#PositionId').val(),
        iDeptId=$('#DeptId').val();


    if (argActivityIds == "")  return;
    $.ajax({
        url: getBaseURL() + 'workflow/index/getActivityRoles',
        type: 'POST',
        async: false,
        data: {"ActivityId": argActivityIds},
        success: function (data, textStatus, jqXHR) {
            var sHtml = "";
            var obj = jQuery.parseJSON(data);
            arrTaskMaster = obj['taskTrans'];
            arrRoleMaster = obj['roleTrans'];
        },
        error: function (jqXHR, textStatus, errorThrown) {
            alert('Request Failed');
        }
    });
    var sHtml = "";

    arrPosRoleTrans = $.grep(arrRoleTrans, function (element, index) {
        return element.DeptId == iDeptId && element.PositionId == iPositionId});

    for (var i in arrTaskMaster) {
        var bAdd = "",bEdit="",bDelete="";bApprove="",bView="";
        var arr= [];

        arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName == arrTaskMaster[i].TaskName && element.RoleType == 'N'});
        if (arr.length >0) bAdd = "checked";

        arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName == arrTaskMaster[i].TaskName && element.RoleType == 'E'});
        if (arr.length >0) bEdit = "checked";


        arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName == arrTaskMaster[i].TaskName && element.RoleType == 'D'});
        if (arr.length >0) bDelete = "checked";


        arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName == arrTaskMaster[i].TaskName && element.RoleType == 'A'});
        if (arr.length >0) bApprove = "checked";


        arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName == arrTaskMaster[i].TaskName && element.RoleType == 'S'});
        if (arr.length >0) bView = "checked";

        sHtml = sHtml + '<tr class="col-xs-12" style="padding:0 !important">' +
        '<td class="col-xs-7">' + arrTaskMaster[i].TaskName +
        '</td>' +
        '<td class="col-xs-1"><div align="center" class="checkbox checkbox-styled tile-text">' +
        '<label>' +
        '<input  class="search-element case" id="task_N_' + i + '" value="1" data-name="' + arrTaskMaster[i].TaskName + '" onchange="checkChange(this.id)" ' + bAdd + ' type="checkbox">' +
        '<span></span>' +
        '</label>' +
        '</div></td>' +
        '<td class="col-xs-1"><div align="center" class="checkbox checkbox-styled tile-text">' +
        '<label>' +
        '<input class="case" id="task_E_' + i + '" value="1" onchange="checkChange(this.id)" ' + bEdit + ' type="checkbox">' +
        '<span></span>' +
        '</label>' +
        '</div></td>' +
        '<td class="col-xs-1"><div align="center" class="checkbox checkbox-styled tile-text">' +
        '<label>' +
        '<input class="case" id="task_D_' + i + '" value="1" onchange="checkChange(this.id)" ' + bDelete + ' type="checkbox">' +
        '<span></span>' +
        '</label>' +
        '</div></td>' +
        '<td class="col-xs-1"><div align="center" class="checkbox checkbox-styled tile-text">' +
        '<label>' +
        '<input class="case" id="task_A_' + i + '" value="1" onchange="checkChange(this.id)" ' + bApprove + ' type="checkbox">' +
        '<span></span>' +
        '</label>' +
        '</div></td>' +
        '<td class="col-xs-1"><div align="center" class="checkbox checkbox-styled tile-text">' +
        '<label>' +
        '<input class="case" id="task_S_' + i + '" value="1" onchange="checkChange(this.id)" ' + bView + ' type="checkbox">' +
        '<span></span>' +
        '</label>' +
        '</div></td>' +
        '<input type="hidden" id ="taskRowName_'+ i + '" value="' + arrTaskMaster[i].TaskName + '">'+
        '</tr>';
    }
    $('#taskTable > tbody').html(sHtml);
    sHtml = "";

    arrPosPermissionTrans = $.grep(arrPermissionTrans, function (element, index) {
        return element.DeptId == iDeptId && element.PositionId == iPositionId});

    for (var i in arrRoleMaster) {
        var sChecked = "";

        arr = $.grep(arrPosPermissionTrans, function (element, index) {
            return element.RoleId == arrRoleMaster[i].RoleId});
        if (arr.length >0) sChecked = "checked";

        sHtml = sHtml + '<tr class="col-xs-12" style="padding:0 !important">' +
        '<td class="col-xs-1"> <div class="checkbox checkbox-styled">' +
        '<label>' +
        '<input class="search-element"  value="1" data-name="' + arrRoleMaster[i].RoleName + '" onchange="checkPerChange(this.id)" ' + sChecked + ' type="checkbox" id="per_' + arrRoleMaster[i].RoleId + '">' +
        '<span>&nbsp;</span> </label>' +
        '</div></td>' +
        '<td class="col-xs-11">' + arrRoleMaster[i].RoleName + '</td>' +
        '<input type="hidden" id ="perRoleName_'+ arrRoleMaster[i].RoleId + '" value="' + arrRoleMaster[i].RoleName + '">'+
        '</tr>';
    }
    $('#roleTable > tbody').html(sHtml);
}

function checkChange(x) {
    var sRoleType = x.split('_')[1],
        key = x.split('_')[2],
        sTaskName = $('#taskRowName_' + key).val(),
        iPositionId = $('#PositionId').val(),
        iDeptId=$('#DeptId').val();
    if ($('#'+ x).is(':checked')) {
        var arr = $.grep(arrTaskTransMaster, function (element, index) {
            return element.TaskName == sTaskName && element.RoleType == sRoleType});
        var iRoleId = 0;
        if (arr.length >0) iRoleId = arr[0]['RoleId'];

        var arrN = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName != sTaskName || element.RoleType != sRoleType});
        arrPosRoleTrans = [];
        arrPosRoleTrans = arrN;

        arrPosRoleTrans.push({
            DeptId: iDeptId,
            PositionId: iPositionId,
            TaskName: sTaskName,
            RoleType: sRoleType,
            RoleId:iRoleId
        });
    } else {
        var arr = $.grep(arrPosRoleTrans, function (element, index) {
            return element.TaskName != sTaskName || element.RoleType != sRoleType});
        arrPosRoleTrans = [];
        arrPosRoleTrans = arr;
    }
}
function checkPerChange(x) {
    var iRoleId = x.split('_')[1],
        sRoleName = $('#perRoleName_' + iRoleId).val(),
        iPositionId = $('#PositionId').val(),
        iDeptId=$('#DeptId').val();
    if ($('#'+ x).is(':checked')) {
        arrPosPermissionTrans.push({
            DeptId: iDeptId,
            PositionId: iPositionId,
            RoleId:iRoleId,
            RoleName:sRoleName
        });
    } else {
        var arr = $.grep(arrPosPermissionTrans, function (element, index) {
            return element.RoleId != iRoleId});
        arrPosPermissionTrans = [];
        arrPosPermissionTrans = arr;
    }
}

$(document).on('click','.editSubmitBtn',function(){
    var iPositionId=$('#PositionId').val();
    UpdatePositionValue(iPositionId);
    $('#arrActivityTrans').val(JSON.stringify(arrActivityTrans));
    $('#arrAlertTrans').val(JSON.stringify(arrAlertTrans));
    $('#arrRoleTrans').val(JSON.stringify(arrRoleTrans));
    $('#arrPermissionTrans').val(JSON.stringify(arrPermissionTrans));


    $('.editSubmitBtn').hide();
    $('#dept-update-loader').show();
    $(".error_message").hide();
//    var key=$(this).data('editid');
    if($("#deptName").val() == ""){
        $("#deptName").closest(".req_flds").find(".error_message").show();
        $("#deptName").focus();
        $('.editSubmitBtn').show();
        $('#dept-update-loader').hide();
        return;
    }
//    if($("#emailId").val() == ""){
//        $("#emailId").closest(".req_flds").find(".error_message").show();
//        $("#emailId").focus();
//        $('.editSubmitBtn').show();
//        $('#dept-update-loader').hide();
//        return;
//    }
//    if($("#emailId").val() != ""){
//        var emailaddress = $('#emailId').val();
//        var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
//        if(!emailReg.test(emailaddress)) {
//            $("#emailId").closest(".req_flds").find(".error_message").show();
//            $("#emailId").focus();
//            $('.editSubmitBtn').show();
//            $('#dept-update-loader').hide();
//            return;
//        }
//    }

    if($("#deptName").val() != ""){
        $valid=1;
        $depLName=$("#deptName").val();
        $depLId=$("#DeptId").val();
        $.ajax({
            url: getBaseURL() + 'workflow/index/deleteorgdepartment',
            type: 'POST',
            data: {"DepId": $depLId, "Remarks": "", "Type": 'check',"deptName": $depLName },
            async: false,
            success:function(data, textStatus, jqXHR){
                if (jqXHR.status != 200) {
                    $valid=0;
                    alert('Already Exists Department Name!');
                }
            },
            error:function(jqXHR, textStatus, errorThrown){
                //alert('Failed to delete the Department!');
                alert(textStatus+"-----"+errorThrown);
                $valid=0;
            }
        });

        if($valid==0){
            $("#deptName").closest(".req_flds").find(".error_message").show();
            $("#deptName").focus();
            $('.editSubmitBtn').show();
            $('#dept-update-loader').hide();
            return;
        }
    }

    $("#editform").submit();
});

function getPositionId(id) {
    var spIds = "";
    var $ids  = $("#checkedUl_" + id + " .selId");
    $.each($ids, function (i, obj) {
        var $this = $(this);
        spIds = spIds +  $this[0].value + ',';
    });
    if (spIds !="") spIds = spIds.substring(0, spIds.length - 1);
    if (id==1) $('#spositioncid').val(spIds);
}

function getActivityId(id) {
    var iDeptId=$('#DeptId').val(),
        iPositionId=$('#PositionId').val(),
        argActivityIds="";
    arrPosActivityTrans = [];
    var $ids  = $("#checkedUl_" + id + " .selId");
    $.each($ids, function (i, obj) {
        var $this = $(this);
        var iActivityId = $this[0].value,
            sActivityName= "";
        argActivityIds = argActivityIds + iActivityId + ",";
        var arr = $.grep(arrActivityMaster, function (element, index) {
            return element.ActivityId == iActivityId});
        if (arr.length >0) sActivityName = arr[0]['ActivityName'];

        arrPosActivityTrans.push({
            DeptId: iDeptId,
            PositionId: iPositionId,
            ActivityId: iActivityId,
            ActivityName: sActivityName
        });
    });
    if (argActivityIds !="") argActivityIds = argActivityIds.substring(0, argActivityIds.length - 1);
    populateRole(argActivityIds);
}
function getAlertId(id) {
    var iDeptId=$('#DeptId').val(),
        iPositionId=$('#PositionId').val();
    arrPosAlertTrans = [];
    var $ids  = $("#checkedUl_" + id + " .selId");
    $.each($ids, function (i, obj) {
        var $this = $(this);
        var iAlertId = $this[0].value,
            sAlertName= "";

        var arr = $.grep(arrAlertMaster, function (element, index) {
            return element.AlertId == iAlertId});
        if (arr.length >0) sAlertName = arr[0]['AlertName'];

        arrPosAlertTrans.push({
            DeptId: iDeptId,
            PositionId: iPositionId,
            AlertId: iAlertId,
            AlertName: sAlertName
        });
    });
}


$(document).on('change','.sampleUI input:checkbox',function () {
    var current = $(this).closest('li'),
        $checkbox = current.find("input:checkbox"),
        key = $checkbox.data('id');
    if($checkbox.is(':checked')){
        var prependToDiv = $('#checkedUl_' + key);
        current.animate({
            top: -30,
            left: prependToDiv.offset().left
        }, 200, function() {
            current.prependTo(prependToDiv).css({
                top: 'auto',
                left: 'auto'
            });
        });
    }
    else{
        var prependToDiv = $('#unCheckedUl_' + key);
        current.animate({
            top: -30,
            left: -prependToDiv.offset().left

        }, 200, function() {
            current.prependTo(prependToDiv).css({
                top: 'auto',
                left: 'auto'
            });
        });
    }

    var delayTimer = 0;
    clearTimeout(delayTimer);
    delayTimer = setTimeout(function () {
        if (key==1) { getPositionId(key); populatePosition(); }
        else if (key==2) { getActivityId(key); }
        else if (key==3) { getAlertId(key);}
    },300);
});

function populatePosition() {
    $('ul.list-head').html('');
    var sPositionId =  $('#spositioncid').val();
    if (sPositionId =="")  return;
    $.ajax({
        url: getBaseURL() + 'workflow/index/getDeptPosition',
        type: 'POST',
        async: false,
        data: {"sPositionId":sPositionId},
        success:function(data, textStatus, jqXHR) {
            var sHtml = "";
            var obj = jQuery.parseJSON(data);
            var objT = obj['trans'];
            for (var j = 0; j < objT.length; j++) {
                sHtml = sHtml + '<li id="opccid_' + objT[j]['PositionId'] +  '" ><a href="javascript:showDeptPositionDetails(' + objT[j]['PositionId'] + ');">' + objT[j]['PositionName'] + '</a></li>';
            }
            $('ul.list-head').html(sHtml);
        },
        error:function(jqXHR, textStatus, errorThrown){
            alert('Request Failed');
        }
    });
    $('ul.list-head li a').click(function(){
        $('li a').removeClass("active");
        $(this).addClass("active");
    });
    clickPosition();
}
$(document).ready(function(){
    $('ul.list-head li a').click(function(){
        $('li a').removeClass("active");
        $(this).addClass("active");
    });
    $('ul.list-per li').click(function(){
        var name = $(this)[0].id;
        if (name == "per_divalert")  $('#divnext').hide();
        else $('#divnext').show();
    });
    $(".single_dropdown").select2({
        placeholder: "",
        allowClear: true
    });
    clickPosition();
});
function clickPosition() {
    var $resnames = $('li[id*=opccid_]');
    $.each($resnames, function (i, obj) {
        var name = $(this)[0].id,
            ccid = name.split('_')[1];
        $("#" + name + " > a").addClass("active");
        showDeptPositionDetails(ccid);
        return false;
    });
}

$(function(){
    // add multiple select / deselect functionality
    $("#selectall").click(function () {
        $('.case').attr('checked', this.checked);
    });

    // if all checkbox are selected, check the selectall checkbox
    // and viceversa
    $(".case").click(function(){
        if($(".case").length == $(".case:checked").length) {
            $("#selectall").attr("checked", "checked");
        } else {
            $("#selectall").removeAttr("checked");
        }

    });
});

</script>