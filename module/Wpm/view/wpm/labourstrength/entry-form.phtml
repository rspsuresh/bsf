<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/workorder.css'; ?>"/>
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/wpm.css'; ?>"/>
<style>
    #jqxTree {margin-top: 15px;max-height: 450px; font-size: 12px !important;min-height: 400px !important;border: none}
    .jqx-tree-dropdown {padding: 0 0 0 5px}
    .jqx-tree-dropdown-root {min-width: 100% !important;width: 100% !important}
    .jqxgrid {background: #fff;border: 1px solid #ddd;box-shadow: 0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.24);padding: 0px 6px 20px;width: 100% !important; /*height:490px !important; overflow-y:scroll*/}
    .table-responsive table.table tr td, .table-responsive table.table tr th {padding: 4px !important}
    /*----------------------------grid-----------------------*/
    .top-addtip{width: 168px;left: -80px;top: -58px;height: 74px;z-index: 1000001 !important;visibility: visible;}
    .top-addtip:after{content: ""; display: block; width: 0; height: 0; border-left: 6px solid #7d73b3; border-top: 6px solid transparent; border-bottom: 6px solid transparent; position: absolute; top:32px; left:104%;z-index:1}
    .panel {border-radius: 0px !important;}
    .modal-dialog { width: 80%}
    .panel-info {border: none;border-top: none;}
    a.sele-max1, a.sele-max2, a.sele-max {float: left}
    #contractorTable .jqx-grid-header {height: 75px !important;font-size: 12px;}
    #LabourTable .jqx-grid-header {height: 75px !important;font-size: 12px;}
    .subDiv1{background:#BFC4D6 !important; border:1px solid #8796CC}
    .subDiv1 .table thead tr th{background:#D1D5E3;border-bottom:2px solid #8796CC;font-size:14px !important}
    .subDiv1 .table tbody tr td input[type="text"]{font-size:14px !important}
    .subDiv2 .table thead tr th{background:#E3DFD1;border-bottom:2px solid #CCBD87;font-size:13px !important}
    .subDiv2 .table tbody tr td input[type="text"]{font-size:13px !important}
    .subDiv2 .table tbody tr:hover,.subDiv2 .table tbody tr:focus,.subDiv2 .table tbody tr td:focus{background:#D1E3D6 !important}
    .subDiv2{background:#D6D1BF !important; border:1px solid #CCBD87}
    /*----------------------------fixed table-----------------------*/
    .fixedTable .table {background-color: white;margin-bottom: 0;width: auto;}
    .fixedTable .table tr td, .fixedTable .table tr th {min-width: 140px;width: 100px;overflow: hidden;background: #fff;padding: 5px;}
    .fixedTable-sidebar .table tbody tr td, .fixedTable-header .table thead tr th {font-size: 12px;text-transform: uppercase;background: #D8DAE6 !important;border-right: 1px solid #C0C3D1;text-overflow: ellipsis;overflow: hidden;display: inline-block;white-space: nowrap;}
    .fixedTable-header {width: 100%;background: #DAEAF0 none repeat scroll 0 0;border-bottom: 2px solid #5d9bb6 !important;border-top: 1px solid #dddddd !important;color: #424141;line-height: 30px;font-weight: 600;white-space: nowrap;overflow: hidden;height: 40px;}
    .fixedTable-sidebar .table tbody tr td {border-bottom: 2px solid #C0C3D1;line-height: 32px}
    .fixedTable-sidebar {width: 19%;max-height: 350px;min-height: 200px;float: left;overflow: hidden;border-right: 1px solid #5d9bb6;}
    .fixedTable-body .table tbody tr td {font-size: 12px;}
    .fixedTable-body {overflow: auto;width: 81%;max-height: 350px;min-height: 200px;float: left;}
    @media only screen and (max-width: 1024px) {
        .fixedTable-body {width: 75%;}
        .fixedTable-sidebar {width: 25%}
    }
    @media only screen and (max-width: 768px) {
        .fixedTable-body {width: 65%;}
        .fixedTable-sidebar {width: 35%}
    }
    @media only screen and (max-width: 360px) {
        .fixedTable-body {width: 54%;}
        .fixedTable-sidebar {width: 46%}
        .fixedTable .table tr td, .fixedTable .table tr th {min-width: 100px}
    }
    .parent_text[readonly] { border: hidden }
    .top-tip.top-addtip.top-addtip12 {width:200px;height:60px;}
    .ad-btn {
        background: #3399ff none repeat scroll 0 0;
        border-radius: 50%;
        box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff;
        color: #fff;
        height: 25px;
        padding-top: 2px;
        /*position: absolute;*/
        float:right;
        right: 4px;
        text-align: center;
        text-shadow: 0 0 1px #546082;
        width: 25px;
    }
    #withwbsltypepickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #withwbsltypepickgrid .jqx-checkbox {border:1px solid;}
    #withwbsltypepickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #withwbsltypepickgrid .jqx-checkbox {border:1px solid;}
    .modal-dialog{
        width:50%;
    }
</style>

<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <form id="backFormId" method="post" action="<?php echo $this->basePath();?>/wpm/labourstrength/entry" >
               <!-- <input type="hidden" id="backCostCentreId" name="backCostCentreId"
                       value="<?php /*echo $lsRegister['CostCentreId']; */?>"/>-->

                <input type="hidden" id="back_index" name="back_index" value="1"/>
                            <!--<input type="hidden" id="LabourNameWise" name="LabourNameWise"
                       value="<?php /*echo $lsRegister['LabourNameWise']; */?>"/>
                <input type="hidden" id="backCostCentreName" name="backCostCentreName" value="<?php /*echo $lsRegister['CostCentreName']; */?>"/>
                <input type="hidden" id="backwbsrequired" name="backwbsrequired" value="<?php /*echo $lsRegister['WBSRequired']  */?>">
                <input type="hidden" id="backwbsvalue" name="backwbsvalue" value="<?php /*echo $lsRegister['backwbsvalue']  */?>">-->



                <input type="hidden" id="backlabourId" name="backlabourId" value="<?php echo $labourId; ?>"/>
                <input type="hidden" id="backCostCentreName" name="backCostCentreName" value="<?php echo $lsRegister['CostCentreName'];?>"/>
                <input type="hidden" id="backcostCentreId" name="backcostCentreId"
                       value="<?php echo $lsRegister['CostCentreId']; ?>"/>
                <input type="hidden" id="backwbscheck" name="backwbscheck"
                       value="<?php echo $lsRegister['wbsvalue']; ?>"/>
                <input type="hidden" id="backlsTypeId" name="backlsTypeId" value="<?php echo $lsTypeId; ?>"/>
                <input type="hidden" id="backtypeLs" name="backtypeLs" value="<?php echo $typeLs; ?>"/>
                <input type="hidden" id="backEntryForm" name="backEntryForm"
                       value="<?php echo $lsRegister['EntryForm']; ?>"/>
                <input type="hidden" id="backWBSRequired" name="backWBSRequired"
                       value="<?php echo $lsRegister['WBSRequired']; ?>"/>
                <input type="hidden" id="backLabourNameWise" name="backLabourNameWise"
                       value="<?php echo $lsRegister['LabourNameWise']; ?>"/>
                <input type="hidden" name="backURL" id="fileUrl" value="<?php echo $lsRegister['URL']; ?>">

            </form>
            <form method="post" id="formWrapper" enctype="multipart/form-data">
                <div class="col-sm-12">
                    <h1 class="col-sm-8">Labour Strength</h1>
                    <div class="col-sm-4 col-xs-12 savebtn_area" style="border-top:none;margin:0">
                        <ul>
                            <li class="list-btn" id="sequential" style="display:none;">
                                <a href="javascript:void(0)" data-toggle="modal" onclick="showSequentialView();"
                                   id="mtwbsseq" style="display:none;"><i class="fa fa-clipboard"></i> Matrix
                                    View</a>
                                <a href="javascript:void(0)" data-toggle="modal" onclick="showSequentiallabourView();"
                                   id="mtLabourseq" style="display:none;"><i class="fa fa-clipboard"></i> Matrix
                                    View</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div id="div1"
                     style="display:<?php if ($lsRegister['WBSRequired'] == '1' && $lsRegister['LabourNameWise'] == '0') echo 'block'; else echo 'none'; ?>">
                    <div class="col-lg-4 col-lg-offset-8 col-md-6 col-md-offset-0 col-sm-8 col-sm-offset-2">
                        <div class="form-group col-lg-8 col-lg-offset-4"></div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 cnt_slider back-img" id="condivs">
                        <div class="col-lg-6 col-lg-offset-1">
                            <h1 class="animated fadeInRight">Contractor List</h1>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0" align="right">
                            <label style="font-size:15px;">Cost Centre</label>
                            <span id="costCentreName" style="color:#ff0000;font-size:14px;padding-left:6px;font-weight:600"><?php echo $lsRegister['CostCentreName']; ?> </span>
                            <input type="hidden" id="labourId" name="labourId" value="<?php echo $labourId; ?>"/>
                            <input type="hidden" id="costCentreId" name="costCentreId"
                                   value="<?php echo $lsRegister['CostCentreId']; ?>"/>
                            <input type="hidden" id="wbscheck" name="wbscheck"
                                   value="<?php echo $lsRegister['wbsvalue']; ?>"/>
                            <input type="hidden" id="lsTypeId" name="lsTypeId" value="<?php echo $lsTypeId; ?>"/>
                            <input type="hidden" id="typeLs" name="typeLs" value="<?php echo $typeLs; ?>"/>
                            <input type="hidden" id="EntryForm" name="EntryForm"
                                   value="<?php echo $lsRegister['EntryForm']; ?>"/>
                            <input type="hidden" id="WBSRequired" name="WBSRequired"
                                   value="<?php echo $lsRegister['WBSRequired']; ?>"/>
                            <input type="hidden" id="LabourNameWise" name="LabourNameWise"
                                   value="<?php echo $lsRegister['LabourNameWise']; ?>"/>
                            <input type="hidden" name="URL" id="fileUrl" value="<?php echo $lsRegister['URL']; ?>">
                        </div>
                        <div id="directDiv"
                             style="display:<?php if ($lsRegister['EntryForm'] == 'D') echo 'block'; else echo 'none'; ?>">
                            <div class="col-lg-12 col-lg-offset-0 animated fadeInLeft">
                                <div class="col-lg-10 col-lg-offset-1" style="margin-bottom:10px;">
                                    <div id="contractorTable"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="excelDiv"
                         style="display:<?php if ($lsRegister['EntryForm'] == 'E') echo 'block'; else echo 'none'; ?>">
                        <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 col-xs-12 form-group">
                            <div class="error_message" style="padding-top:10px;padding-right:10px;"><p>please assign
                                    fields correctly...</p></div>
                            <div class="table-responsive topsp">
                                <table class="table" id="tableexcel"style="margin-bottom:0px;">
                                    <thead>
                                    <tr>
                                        <th>Excel Sheet Header</th>
                                        <th>Columns</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php $e = 1;
                                    foreach ($excelData as $exData) { ?>
                                        <tr>
                                            <td width="8%"><?php echo $exData['Field']; ?></td>
                                            <!--<td width="13%">
                                <input type="hidden" id="dtField_<?php echo $e;?>"  name="dtField_<?php echo $e;?>" value="<?php echo $e. '##'?>">
                                <input type="text"  onkeypress="return bindexcelmatch(this)" class="parent_text excelmatch" id="dtFieldsearch_<?php echo $e; ?>" autocomplete="off">
                            </td>-->
                                            <td width="13%">
                                                <select class="form-control single_dropdown lbl_move"
                                                        name="dtField_<?php echo $e; ?>" id="dtField_<?php echo $e; ?>"
                                                        style="width:100%;">
                                                    <option value="">Select <?php echo $exData['Field']; ?></option>
                                                    <?php
                                                    foreach ($assignData as $key => $asData) {
                                                        $newAsData = str_replace(' ', '', $asData);
                                                        ?>
                                                        <option value="<?php echo $e . '##' . $newAsData; ?>"><?php echo $asData; ?></option>
                                                    <?php } ?>
                                                </select>
                                            </td>

                                        </tr>
                                        <?php $e++;
                                    } ?>
                                    </tbody>
                                    <input type="hidden" name="excelCount" id="excelCount"
                                           value="<?php echo count($excelData); ?>"/>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<td width="13%">
        <select class="form-control single_dropdown lbl_move"
                name="dtField_<?php echo $e; ?>" id="dtField_<?php echo $e; ?>"
                style="width:100%;">
            <option value="">Select <?php echo $exData['Field']; ?></option>
            <?php
                foreach ($assignData as $key => $asData) {
                    $newAsData = str_replace(' ', '', $asData);
                    ?>
                <option value="<?php echo $e . '##' . $newAsData; ?>"><?php echo $asData; ?></option>
            <?php } ?>
        </select>
        <input type="text" td="" <="" onfocus="checkexcelFieldFocus(this.id)" field="" select="" class="parent_text" id="field_0" autocomplete="off">
    </td>-->
                <div id="div1labourlist"
                     style="display:<?php if ($lsRegister['WBSRequired'] == '0' && $lsRegister['LabourNameWise'] == '1') echo 'block'; else echo 'none'; ?>">
                    <div class="col-lg-4 col-lg-offset-8 col-md-6 col-md-offset-0 col-sm-8 col-sm-offset-2">
                        <div class="form-group col-lg-8 col-lg-offset-4"></div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 cnt_slider back-img">
                        <div class="col-lg-6 col-lg-offset-1">
                            <h1 class="animated fadeInRight" align="left">Labour List</h1>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0" align="right">
                            <label style="font-size:15px;">Project Name</label><span id="costCentreName"
                                                                                     style="color:#ff0000;font-size:14px;padding-left:6px;font-weight:600"> <?php echo $lsRegister['CostCentreName']; ?></span>
                        </div>
                        <div id="directDivlabour"
                             style="display:<?php if ($lsRegister['EntryForm'] == 'D') echo 'block'; else echo 'none'; ?>">
                            <div class="col-lg-12 col-lg-offset-0 animated fadeInLeft">
                                <div class="col-lg-10 col-lg-offset-1" style="margin-bottom:10px;">
                                    <div id="LabourTable"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="div2"
                     style="display:<?php if ($lsRegister['LabourNameWise'] == '1') echo 'block'; else echo 'none'; ?>;">
                    <div class="col-lg-12">
                        <div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
                            <div class="panel-box zoomIn animated">
                                <ul class="">
                                    <li>
                                        <label>Date</label>
                                        <span><input type="text" name="labDate" id="labDate" class="date_picker"
                                                     value="<?php if ($lsRegister['LSDate'] != NULL) {
                                                         echo date("d-m-Y", strtotime($lsRegister['LSDate']));
                                                     } else {
                                                         echo date("d-m-Y");
                                                     } ?>" readonly/></span>
                                    </li>
                                    <li>
                                        <label>Cost Centre</label>
                                        <span><?php echo $lsRegister['CostCentreName']; ?></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
                            <div class="panel-box box2th zoomIn animated">
                                <div class="radio_check">
                                    <p style="text-align:left;" class="padd-radio">
                                        <input type="checkbox" name="mtWbs" id="mtWbs" value="1"
                                               <?php if ($lsRegister['WBSRequired'] == 1) { ?>checked<?php } ?>
                                               <?php if ($lsRegister['LabourNameWise'] == 0) { ?>disabled<?php } ?> />
                                        <label for="mtWbs" class="with-wbs">With WBS</label>
                                    </p>
                                    <p style="text-align:left;">
                                        <input type="checkbox" name="mtLabour" id="mtLabour" value="1"
                                               <?php if ($lsRegister['LabourNameWise'] == 1) { ?>checked<?php } ?>
                                               disabled/>
                                        <label for="mtLabour" class="with-wbs">With Labour Name</label>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-4 col-md-offset-0 col-sm-4 col-sm-offset-0">
                            <div class="panel-box box3th zoomIn animated">
                                <ul>
                                    <li>
                                        <label>LS No</label>
                                        <span><input type="text" name="lsNo" id="lsNo"
                                                     value="<?php if (trim($lsRegister['LSNo']) != '') {
                                                         echo trim($lsRegister['LSNo']);
                                                     } else {
                                                         echo ($genType) ? trim($lsNo) : '';
                                                     } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>CC LS No</label>
                                        <span><input type="text" name="lsCCNo" id="lsCCNo"
                                                     value="<?php if (trim($lsRegister['LSCCNo']) != '') {
                                                         echo $lsRegister['LSCCNo'];
                                                     } else {
                                                         echo '';
                                                     } ?>"/></span>
                                    </li>
                                    <li>
                                        <label>Comp LS No</label>
                                        <span><input type="text" name="lsCompNo" id="lsCompNo"
                                                     value="<?php if (trim($lsRegister['LSCompNo']) != '') {
                                                         echo $lsRegister['LSCompNo'];
                                                     } else {
                                                         echo '';
                                                     } ?>"/></span>
                                    </li>
                                    <li>
                                        <label>Ref No</label>
                                        <span><input type="text" name="refNo" id="refNo"
                                                     value="<?php if (trim($lsRegister['RefNo']) != '') {
                                                         echo $lsRegister['RefNo'];
                                                     } else {
                                                         echo '';
                                                     } ?>"/></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 clear">

                        <?php if($lsRegister['wbsvalue'] == '1'  || $lsRegister['WBSReqWPM']==1) { ?>

                            <div id="divWithWbs" class="table-responsive top-30 animated fadeInUp"
                                 style="display:<?php if ($lsRegister['WBSRequired'] == '1' && $lsRegister['LabourNameWise'] == '0' && $lsRegister['wbsvalue'] == '1' ) echo 'block'; else echo 'none'; ?>;">
                                <a data-toggle="tooltip" data-placement="left" data-original-title="Labour Strength PickList" class="ad-btn" onclick="showPickList()" href="javascript:void(0);" id="labourtypePickList"><i class="fa fa-plus"></i></a>
                                <table class="table" style="margin-bottom:0px;" id="conTable">
                                    <thead>
                                    <tr>
                                        <th>Contractor</th>
                                        <th class="text-right">Total Qty</th>
                                        <th class="text-right">Amount</th>
                                        <th class="text-right">OT Hrs</th>
                                        <th class="text-right">OT Amount</th>
                                        <th class="text-right">Net Amount</th>
                                        <th>&nbsp;</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php
                                    if (isset($lsVendorTrans) && count($lsVendorTrans) != 0) {
                                        $i = 1;
                                        foreach ($lsVendorTrans as $lsvTrans) {
                                            $lsvTransId = $lsvTrans['LSVendorTransId'];
                                            $conId = $lsvTrans['VendorId'];
                                            ?>
                                            <tr id="rowId_<?php echo $i; ?>">
                                                <td width="20%">
                                                    <?php if($conId !=0) { ?>
                                                        <input class="parent_text conSuggest" type="text"
                                                               name="conName_<?php echo $i; ?>" id="conName_<?php echo $i; ?>"
                                                               onfocus="return checkConUsed(this);"
                                                               value="<?php echo $lsvTrans['VendorName']; ?>" readonly/>
                                                        <input type="hidden" name="conId_<?php echo $i; ?>" class="conclass"
                                                               id="conId_<?php echo $i; ?>" value="<?php echo $conId; ?>"/>
                                                        <input type="hidden" name="grpvendortype_<?php echo $i; ?>"
                                                               id="grpvendortype_<?php echo $i; ?>" value="V"/>
                                                    <?php }
                                                    else { ?>
                                                        <input class="parent_text conSuggest" type="text"
                                                               name="conName_<?php echo $i; ?>" id="conName_<?php echo $i; ?>"
                                                               onfocus="return checkConUsed(this);"
                                                               value="<?php echo $lsvTrans['LabourGroupName']; ?>" readonly/>
                                                        <input type="hidden" name="conId_<?php echo $i; ?>" class="conclass"
                                                               id="conId_<?php echo $i; ?>" value="<?php echo $lsvTrans['GroupId']; ?>"/>
                                                        <input type="hidden" name="grpvendortype_<?php echo $i; ?>"
                                                               id="grpvendortype_<?php echo $i; ?>" value="G"/>
                                                    <?php } ?>
                                                </td>
                                                <td width="15%"><input class="parent_text text-right" type="text"
                                                                       name="conQty_<?php echo $i; ?>"
                                                                       id="conQty_<?php echo $i; ?>"
                                                                       value="<?php echo $lsvTrans['Qty']; ?>"
                                                                       onchange="return FormatNum(this)"
                                                                       onclick="return showDiv(this, 'm', '');" readonly/>
                                                </td>
                                                <td width="15%"><input class="parent_text text-right" type="text"
                                                                       name="conAmount_<?php echo $i; ?>"
                                                                       id="conAmount_<?php echo $i; ?>"
                                                                       value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['Amount'],2,true); ?>"
                                                                       readonly/></td>
                                                <td width="15%"><input class="parent_text text-right" type="text"
                                                                       name="conOtHrs_<?php echo $i; ?>"
                                                                       id="conOtHrs_<?php echo $i; ?>"
                                                                       value="<?php echo $lsvTrans['OTHrs']; ?>" readonly/>
                                                </td>
                                                <td width="15%"><input class="parent_text text-right" type="text"
                                                                       name="conOtAmount_<?php echo $i; ?>"
                                                                       id="conOtAmount_<?php echo $i; ?>"
                                                                       value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['OTAmount'],2,true); ?>"
                                                                       readonly/></td>
                                                <td width="15%"><input class="parent_text text-right" type="text"
                                                                       name="conNetAmount_<?php echo $i; ?>"
                                                                       id="conNetAmount_<?php echo $i; ?>"
                                                                       value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['NetAmount'],2,true); ?>"
                                                                       readonly/></td>
                                                <td width="10%" align="center" class="action_btns_td">
                                                    <ul class="action_btns">
                                                        <li>
                                                            <a id="showDivId_<?php echo $i; ?>" href="javascript:void(0);"
                                                               class="mainTr" onclick="return showDiv(this, 'm', '');"><i
                                                                    class="fa fa-chevron-circle-down"
                                                                    data-toggle="tooltip" data-placement="left"
                                                                    data-original-title="Add lines"></i></a>
                                                        </li>
                                                        <li>
                                                            <a href="#" class="conDelete_<?php echo $i; ?>"
                                                               onclick="deleteCon(this, event);"
                                                               id="deleteConTr_<?php echo $i; ?>"><i class="fa fa-trash-o"
                                                                                                     data-toggle="tooltip"
                                                                                                     data-placement="top"
                                                                                                     data-original-title="Delete"></i></a>
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                            <tr id="subRowId_<?php echo $i; ?>" style="display:none;" class="subTr">
                                                <td colspan="7" style="padding:0px !important;">
                                                    <div class="subDiv" style="display:none;">
                                                        <div class="col-lg-12 col-lg-offset-0 rdbt"
                                                             style="margin-top:5px;"></div>
                                                        <div class="col-lg-12">
                                                            <div class="table-responsive topsp">
                                                                <table class="table" style="margin-bottom:0px;"
                                                                       id="wbsTable_<?php echo $i; ?>">
                                                                    <thead>
                                                                    <tr>
                                                                        <th>WBS Name</th>
                                                                        <th class="text-right">Total Qty</th>
                                                                        <th class="text-right">Amount</th>
                                                                        <th class="text-right">OT Hrs</th>
                                                                        <th class="text-right">OT Amount</th>
                                                                        <th class="text-right">Net Amount</th>
                                                                        <th>&nbsp;</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    <?php
                                                                    $j = 1;
                                                                    foreach ($lsWbsTrans as $lswTrans) {
                                                                        if ($lswTrans['LSVendorTransId'] == $lsvTransId) {
                                                                            $lswTransId = $lswTrans['LSWBSTransId'];
                                                                            $wbsId = $lswTrans['WBSId'];
                                                                            ?>
                                                                            <tr id="subRowRowId_<?php echo $conId; ?>_<?php echo $j; ?>">
                                                                                <td width="20%">
                                                                                    <input class="parent_text wbsSuggest"
                                                                                           type="text"
                                                                                           name="wbsName_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                           id="wbsName_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                           onfocus="return checkWbsUsed(this, '<?php echo $conId; ?>', '<?php echo $i; ?>', '<?php echo $j; ?>');"
                                                                                           value="<?php echo $lswTrans['WBSName']; ?>"
                                                                                           readonly/>
                                                                                    <input type="hidden"
                                                                                           name="wbsId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                           id="wbsId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                           value="<?php echo $wbsId; ?>"/>
                                                                                </td>
                                                                                <td width="15%"><input
                                                                                        class="parent_text text-right"
                                                                                        type="text"
                                                                                        name="wbsQty_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        id="wbsQty_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        value="<?php echo $lswTrans['Qty']; ?>"
                                                                                        onchange="return FormatNum(this, 3)"
                                                                                        readonly/></td>
                                                                                <td width="15%"><input
                                                                                        class="parent_text text-right"
                                                                                        type="text"
                                                                                        name="wbsAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        id="wbsAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        value="<?php echo $this->commonHelper()->sanitizeNumber($lswTrans['Amount'],2,true); ?>"
                                                                                        readonly/></td>
                                                                                <td width="15%"><input
                                                                                        class="parent_text text-right"
                                                                                        type="text"
                                                                                        name="wbsOtHrs_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        id="wbsOtHrs_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        value="<?php echo $lswTrans['OTHrs']; ?>"
                                                                                        readonly/></td>
                                                                                <td width="15%"><input
                                                                                        class="parent_text text-right"
                                                                                        type="text"
                                                                                        name="wbsOtAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        id="wbsOtAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        value="<?php echo $this->commonHelper()->sanitizeNumber($lswTrans['OTAmount'],2,true); ?>"
                                                                                        readonly/></td>
                                                                                <td width="15%"><input
                                                                                        class="parent_text text-right"
                                                                                        type="text"
                                                                                        name="wbsNetAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        id="wbsNetAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                        value="<?php echo $this->commonHelper()->sanitizeNumber($lswTrans['NetAmount'],2,true); ?>"
                                                                                        readonly/></td>
                                                                                <td width="10%" align="center"
                                                                                    class="action_btns_td">
                                                                                    <ul class="action_btns">
                                                                                        <li>
                                                                                            <a id="showDivSubId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                               href="javascript:void(0);"
                                                                                               class="mainTr"
                                                                                               onclick="return showDiv(this, 's', '<?php echo $conId; ?>');"><i
                                                                                                    class="fa fa-chevron-circle-down"
                                                                                                    data-toggle="tooltip"
                                                                                                    data-placement="left"
                                                                                                    data-original-title="Add lines"></i></a>
                                                                                        </li>
                                                                                        <li>
                                                                                            <a href="#"
                                                                                               class="wbsDelete_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                               id="deleteWbsTr_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                               onclick="deleteWbs(this, event, '<?php echo $conId; ?>', '<?php echo $i; ?>');"><i
                                                                                                    class="fa fa-trash-o"
                                                                                                    data-toggle="tooltip"
                                                                                                    data-placement="top"
                                                                                                    data-original-title="Delete"></i></a>
                                                                                        </li>
                                                                                    </ul>
                                                                                </td>
                                                                            </tr>
                                                                            <tr id="subRowSubRowId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                style="display:none;" class="subTr">
                                                                                <td colspan="7"
                                                                                    style="padding:0px !important;">
                                                                                    <div class="subDiv"
                                                                                         style="display:none;">
                                                                                        <div class="col-lg-12 col-lg-offset-0 rdbt"
                                                                                             style="margin-top:5px;"></div>
                                                                                        <div class="col-lg-12">
                                                                                            <div class="table-responsive topsp">
                                                                                                <table class="table"
                                                                                                       style="margin-bottom:0px;"
                                                                                                       id="labTable_<?php echo $conId; ?>_<?php echo $j; ?>">
                                                                                                    <thead>
                                                                                                    <tr>
                                                                                                        <th>Labour Type
                                                                                                            Name
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            Qty
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            Rate
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            Amount
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            OT Hrs
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            OT Rate
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            OT Amount
                                                                                                        </th>
                                                                                                        <th class="text-right">
                                                                                                            Total Amount
                                                                                                        </th>
                                                                                                        <th>&nbsp;</th>
                                                                                                    </tr>
                                                                                                    </thead>
                                                                                                    <tbody>
                                                                                                    <?php
                                                                                                    $kk = 1;
                                                                                                    foreach ($lsTypeTrans as $lstTrans) {
                                                                                                        if ($lstTrans['LSVendorTransId'] == $lsvTransId && $lstTrans['LSWBSTransId'] == $lswTransId) {
                                                                                                            ?>
                                                                                                            <tr>
                                                                                                                <td width="15%">
                                                                                                                    <input type="hidden"
                                                                                                                           name="labId_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labId_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $lstTrans['ResourceId']; ?>"/><input
                                                                                                                        class="parent_text labTypeSuggest"
                                                                                                                        type="text"
                                                                                                                        name="labName_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                        id="labName_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                        value="<?php echo $lstTrans['ResourceName']; ?>"
                                                                                                                        onfocus="return checkLabTypeUsed(this, '<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $i; ?>', '<?php echo $j; ?>');"
                                                                                                                        readonly/>
                                                                                                                </td>
                                                                                                                <td width="10%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labQty_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labQty_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $lstTrans['Qty']; ?>"
                                                                                                                           onkeypress="return isDecimal(event,this);"
                                                                                                                           onchange="return pushMainQty(this.id)"
                                                                                                                           maxlength="5"
                                                                                                                           onblur="return calSumAmount('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $j; ?>', '<?php echo $i; ?>', '<?php echo $kk; ?>');"/>
                                                                                                                </td>
                                                                                                                <td width="10%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $lstTrans['Rate']; ?>"
                                                                                                                           onkeypress="return isDecimal(event,this);"
                                                                                                                           maxlength="5"
                                                                                                                           onblur="return calSumAmount('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $j; ?>', '<?php echo $i; ?>', '<?php echo $kk; ?>');"/>
                                                                                                                    <div id="iow___ewbqty_0"
                                                                                                                         style="display:none;">
                                                                                                                        <div class="top-tip top-addtip">
                                                                <span>Estimate Qty : <i
                                                                        name="iow___estimateqty_0"
                                                                        id="iow___estimateqty_0"></i></span>
                                                                <span>Workorder Qty : <i
                                                                        name="iow___workorderqty_0"
                                                                        id="iow___workorderqty_0"></i></span>
                                                                <span>Total Billed Qty : <i
                                                                        name="iow___totbilledqty_0"
                                                                        id="iow___totbilledqty_0"></i></span>
                                                                                                                        </div>
                                                                                                                    </div>
                                                                                                                </td>
                                                                                                                <td width="13%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['Amount'],2,true); ?>"
                                                                                                                           readonly/>
                                                                                                                </td>
                                                                                                                <td width="10%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labOtHrs_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labOtHrs_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $lstTrans['OTHrs']; ?>"
                                                                                                                           onkeypress="return isDecimal(event,this);"
                                                                                                                           onchange="return pushMainQtyOT(this.id)"
                                                                                                                           onblur="return calSumAmount('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $j; ?>', '<?php echo $i; ?>', '<?php echo $kk; ?>');"/>
                                                                                                                </td>
                                                                                                                <td width="10%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labOtRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labOtRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['OTRate'],2,true); ?>"
                                                                                                                           onkeypress="return isDecimal(event,this);"
                                                                                                                           onblur="return calSumAmount('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $j; ?>', '<?php echo $i; ?>', '<?php echo $kk; ?>');"/>
                                                                                                                </td>
                                                                                                                <td width="13%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labOtAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labOtAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['OTAmount'],2,true); ?>"
                                                                                                                           readonly/>
                                                                                                                </td>
                                                                                                                <td width="14%">
                                                                                                                    <input class="parent_text text-right"
                                                                                                                           type="text"
                                                                                                                           name="labNetAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           id="labNetAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                           value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['NetAmount'],2,true); ?>"
                                                                                                                           readonly/>
                                                                                                                </td>
                                                                                                                <td width="10%"
                                                                                                                    align="center"
                                                                                                                    class="action_btns_td">
                                                                                                                    <ul class="action_btns">
                                                                                                                        <li>
                                                                                                                            <a href="#"
                                                                                                                               class="labDelete_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                               id="deleteLabTr_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>"
                                                                                                                               onclick="deleteWbsLab(this, event,'<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $i; ?>', '<?php echo $j; ?>');"><i
                                                                                                                                    class="fa fa-trash-o"
                                                                                                                                    data-toggle="tooltip"
                                                                                                                                    data-placement="top"
                                                                                                                                    data-original-title="Delete"></i></a>
                                                                                                                        </li>
                                                                                                                    </ul>
                                                                                                                </td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $kk++;
                                                                                                        }
                                                                                                    }
                                                                                                    ?>
                                                                                                    </tbody>
                                                                                                </table>
                                                                                                <input type="hidden"
                                                                                                       name="labRows_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                                       id="labRows_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                                       value="<?php echo $kk; ?>"/>
                                                                                            </div>

                                                                                        </div>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                            <?php
                                                                            $j++;
                                                                        }
                                                                    }
                                                                    ?>
                                                                    <tr id="subRowRowId_<?php echo $conId; ?>_<?php echo $j; ?>">
                                                                        <td width="20%">
                                                                            <input class="parent_text wbsSuggest"
                                                                                   type="text"
                                                                                   name="wbsName_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                   id="wbsName_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                   onfocus="return checkWbsUsed(this, '<?php echo $conId; ?>', '<?php echo $i; ?>', '<?php echo $j; ?>');"/>
                                                                            <input type="hidden"
                                                                                   name="wbsId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                   id="wbsId_<?php echo $conId; ?>_<?php echo $j; ?>"/>
                                                                            <input type="hidden"
                                                                                   name="labRows_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                   id="labRows_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                   value="1"/>
                                                                        </td>
                                                                        <td width="15%"><input
                                                                                class="parent_text text-right"
                                                                                type="text"
                                                                                name="wbsQty_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                id="wbsQty_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                readonly/></td>
                                                                        <td width="15%"><input
                                                                                class="parent_text text-right"
                                                                                type="text"
                                                                                name="wbsAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                id="wbsAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                readonly/></td>
                                                                        <td width="15%"><input
                                                                                class="parent_text text-right"
                                                                                type="text"
                                                                                name="wbsOtHrs_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                id="wbsOtHrs_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                readonly/></td>
                                                                        <td width="15%"><input
                                                                                class="parent_text text-right"
                                                                                type="text"
                                                                                name="wbsOtAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                id="wbsOtAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                readonly/></td>
                                                                        <td width="15%"><input
                                                                                class="parent_text text-right"
                                                                                type="text"
                                                                                name="wbsNetAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                id="wbsNetAmount_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                readonly/></td>
                                                                        <td width="10%" align="center"
                                                                            class="action_btns_td">
                                                                            <ul class="action_btns">
                                                                                <li>
                                                                                    <a id="showDivSubId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                       href="javascript:void(0);"
                                                                                       class="mainTr"
                                                                                       onclick="return showDiv(this, 's', '<?php echo $conId; ?>');"
                                                                                       style="display:none;"><i
                                                                                            class="fa fa-chevron-circle-down"
                                                                                            data-toggle="tooltip"
                                                                                            data-placement="left"
                                                                                            data-original-title="Add lines"></i></a>
                                                                                </li>
                                                                                <li>
                                                                                    <a href="#"
                                                                                       class="wbsDelete_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                                       onclick="deleteWbs(this, event, '<?php echo $conId; ?>', '<?php echo $i; ?>');"
                                                                                       style="display:none;"><i
                                                                                            class="fa fa-trash-o"
                                                                                            data-toggle="tooltip"
                                                                                            data-placement="top"
                                                                                            data-original-title="Delete"></i></a>
                                                                                </li>
                                                                            </ul>
                                                                        </td>
                                                                    </tr>
                                                                    <tr id="subRowSubRowId_<?php echo $conId; ?>_<?php echo $j; ?>"
                                                                        style="display:none;" class="subTr">
                                                                        <td colspan="7" style="padding:0px !important;">
                                                                            <div class="subDiv" style="display:none;">
                                                                                <div class="col-lg-12 col-lg-offset-0 rdbt"
                                                                                     style="margin-top:5px;"></div>
                                                                                <div class="col-lg-12">
                                                                                    <div class="table-responsive topsp">
                                                                                        <table class="table"
                                                                                               style="margin-bottom:0px;"
                                                                                               id="labTable_<?php echo $conId; ?>_<?php echo $j; ?>">
                                                                                            <thead>
                                                                                            <tr>
                                                                                                <th>Labour Type Name</th>
                                                                                                <th class="text-right">Qty
                                                                                                </th>
                                                                                                <th class="text-right">
                                                                                                    Rate
                                                                                                </th>
                                                                                                <th class="text-right">
                                                                                                    Amount
                                                                                                </th>
                                                                                                <th class="text-right">OT
                                                                                                    Hrs
                                                                                                </th>
                                                                                                <th class="text-right">OT
                                                                                                    Rate
                                                                                                </th>
                                                                                                <th class="text-right">OT
                                                                                                    Amount
                                                                                                </th>
                                                                                                <th class="text-right">Total
                                                                                                    Amount
                                                                                                </th>
                                                                                                <th>&nbsp;</th>
                                                                                            </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                                <input type="hidden" name="wbsRows_<?php echo $i; ?>"
                                                                       id="wbsRows_<?php echo $i; ?>"
                                                                       value="<?php echo $j; ?>"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <?php $i++;
                                        }
                                    } ?>
                                    </tbody>
                                </table>
                                <table class="table" style="margin-bottom:0px;">
                                    <tfoot>
                                    <tr>
                                        <td width="20%" class="rate_pri">
                                            <label>Total</label>
                                        </td>
                                        <td width="10%">
                                            <input type="text"  class="parent_text text-right total-clr" id="totalconqty" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text" class="parent_text text-right total-clr" id="amtcontractor" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractorothrs" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractorotamount" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractornetamount" readonly>
                                        </td>
                                        <td width="10%"></td>
                                    </tr>
                                    </tfoot>
                                </table>
                                <input type="hidden" name="conRows" id="conRows"
                                       value="<?php echo (isset($lsVendorTrans) && count($lsVendorTrans) != 0) ? count($lsVendorTrans) : 0; ?>"/>
                            </div>
                        <?php }
                        else if($lsRegister['wbsvalue']=='0' || $lsRegister['WBSReqWPM']==0 ) { ?>
                            <!--contractor without wbs-->
                            <div id="divWithoutWbs" class="table-responsive top-30 animated fadeInUp"
                                 style="display:<?php if ($lsRegister['LabourNameWise'] == '0' &&  $lsRegister['wbsvalue']=='0') echo 'block'; else echo 'none'; ?>;">
                                <table class="table" style="margin-bottom:0px;" id="conTable">
                                    <thead>
                                    <tr>
                                        <th>Contractor</th>
                                        <th class="text-right">Total Qty</th>
                                        <th class="text-right">Amount</th>
                                        <th class="text-right">OT Hrs</th>
                                        <th class="text-right">OT Amount</th>
                                        <th class="text-right">Net Amount</th>
                                        <th>&nbsp;</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <?php
                                    if (isset($lsVendorTrans) && count($lsVendorTrans) != 0) {
                                        $i = 1;
                                        foreach ($lsVendorTrans as $lsvTrans) {
                                            $lsvTransId = $lsvTrans['LSVendorTransId'];
                                            $conId = $lsvTrans['VendorId'];
                                            ?>
                                            <tr id="rowId_<?php echo $i ?>">
                                                <td width="20%">
                                                    <?php if($conId !=0) { ?>
                                                        <input type="text" onfocus="return checkConUsed(this);" id="conName_<?php echo $i ?>" name="conName_<?php echo $i ?>" value="<?php echo $lsvTrans['VendorName']; ?>" readonly class="parent_text conSuggest" autocomplete="off">
                                                        <input type="hidden"  class="conclass"  id="conId_<?php echo $i ?>" name="conId_<?php echo $i ?>" value="<?php echo $conId; ?>" >
                                                        <input type="hidden"   id="grpvendortype_<?php echo $i ?>" name="grpvendortype_<?php echo $i ?>" value="V" >
                                                    <?php }
                                                    else { ?>
                                                        <input type="text" onfocus="return checkConUsed(this);" id="conName_<?php echo $i ?>" name="conName_<?php echo $i ?>" value="<?php echo $lsvTrans['LabourGroupName']; ?>" readonly class="parent_text conSuggest" autocomplete="off">
                                                        <input type="hidden"  class="conclass"  id="conId_<?php echo $i ?>" name="conId_<?php echo $i ?>" value="<?php echo $lsvTrans['GroupId'] ; ?>" >
                                                        <input type="hidden"   id="grpvendortype_<?php echo $i ?>" name="grpvendortype_<?php echo $i ?>" value="G" >
                                                    <?php  } ?>
                                                </td>
                                                <td width="10%"><input type="text" readonly="" onclick="return showDiv(this, 'mwbs', '');" id="conQty_<?php echo $i ?>" onchange="return FormatNum(this)"  value="<?php echo $lsvTrans['Qty']; ?>" readonly name="conQty_<?php echo $i ?>" class="parent_text text-right">
                                                </td>
                                                <td width="15%"><input type="text" readonly="" id="conAmount_<?php echo $i ?>" onchange="return FormatNum(this, 2)"  value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['Amount'],2,true); ?>" readonly name="conAmount_<?php echo $i ?>" class="parent_text text-right"></td>
                                                <td width="15%"><input type="text" readonly="" id="conOtHrs_<?php echo $i ?>"  value="<?php echo $lsvTrans['OTHrs']; ?>" readonly name="conOtHrs_1" class="parent_text text-right"></td>
                                                <td width="15%"><input type="text" readonly="" id="conOtAmount_<?php echo $i ?>" onchange="return FormatNum(this, 2)"  value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['OTAmount'],2,true); ?>" name="conOtAmount_<?php echo $i ?>" class="parent_text text-right" readonly></td>
                                                <td width="15%"><input type="text" readonly="" id="conNetAmount_<?php echo $i ?>" onchange="return FormatNum(this, 2)"  value="<?php echo $this->commonHelper()->sanitizeNumber($lsvTrans['NetAmount'],2,true); ?>" name="conNetAmount_<?php echo $i ?>" class="parent_text text-right" readonly></td>
                                                <td align="center" width="10%" class="action_btns_td">
                                                    <ul class="action_btns">
                                                        <li><a style="" onclick="return showDiv(this, 'mwbs', '');" class="mainTr" href="javascript:void(0);" id="showDivId_<?php echo $i ?>"><i data-original-title="Add lines" data-placement="left" data-toggle="tooltip" class="fa fa-chevron-circle-down"></i></a></li>
                                                        <li><a style="" id="deleteConTr_<?php echo $i ?>" onclick="deleteCon(this, event);" class="conDelete_<?php echo $i ?>" href="#"><i data-original-title="Delete" data-placement="top" data-toggle="tooltip" class="fa fa-trash-o"></i></a></li></ul>
                                                </td>
                                            </tr>
                                            <tr class="subTr" style="" id="subRowRowId_<?php echo $i ?>" >
                                                <td style="padding:0px !important;" colspan="7">
                                                    <div style="display:none;" class="subDiv subDiv2"><div style="margin-top:5px;" class="col-lg-12 col-lg-offset-0 rdbt"></div>
                                                        <div class="col-lg-12"><div class="table-responsive topsp">
                                                                <table id="labTable_1" style="margin-bottom:0px;" class="table">
                                                                    <thead>
                                                                    <tr>
                                                                        <th>Labour Type Name</th>
                                                                        <th>Qty</th>
                                                                        <th>Rate</th>
                                                                        <th>Amount</th>
                                                                        <th>OT Hrs</th>
                                                                        <th class="text-right">OT Rate</th>
                                                                        <th class="text-right">OT Amount</th>
                                                                        <th class="text-right">Total Amount</th>
                                                                        <th>&nbsp;</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    <?php
                                                                    $kk = 1;
                                                                    foreach ($lsTypeTrans as $lstTrans) {
                                                                        if ($lstTrans['LSVendorTransId'] == $lsvTransId) {
                                                                            ?>
                                                                            <tr>
                                                                                <td width="15%">

                                                                                    <input type="hidden" value="<?php echo $lstTrans['ResourceId']; ?>" id="labId_<?php echo $i ?>_<?php echo $kk ?>" name="labId_<?php echo $i ?>_<?php echo $kk ?>">
                                                                                    <input type="text" onfocus="return checkLabTypeUsedwithoutwbs(this,'<?php echo $i ?>');" id="labName_<?php echo $i ?>_<?php echo $kk ?>"  value="<?php echo $lstTrans['ResourceName']; ?>" name="labName_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text labTypeSuggest">
                                                                                </td>
                                                                                <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs('<?php echo $i ?>', '<?php echo $kk ?>');" value="<?php echo $lstTrans['Qty']; ?>" onkeypress="return isDecimal(event,this);" onchange="return pushMainQty(this.id)" id="labQty_<?php echo $i ?>_<?php echo $kk ?>" name="labQty_<?php echo $i ?>_<?php echo $kk ?>" maxlength="5" class="parent_text text-right"></td>
                                                                                <td width="10%"><input type="text" onfocus="return showtipwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onblur="return calSumAmountwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onkeypress="return isDecimal(event,this);" value="<?php echo $lstTrans['Rate']; ?>" onchange="return FormatNum(this, 2)" id="labRate_<?php echo $i ?>_<?php echo $kk ?>" maxlength="5" name="labRate_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"><div style="position:relative;display:none;" id="labtip_<?php echo $i ?>_<?php echo $kk ?>"><div class="top-tip top-addtip top-addtip12"><span>Rate : <i id="tiptext_<?php echo $i ?>_<?php echo $kk ?>"></i></span></div></div><input type="hidden" id="amt_<?php echo $i ?>_<?php echo $kk ?>">
                                                                                </td>
                                                                                <td width="13%"><input type="text" readonly="" id="labAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)"  value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['Amount'],2,true); ?>" name="labAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                                <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs('<?php echo $i ?>', '<?php echo $kk ?>');" onchange="return pushMainQtyOT(this.id)" onkeypress="return isDecimal(event,this);" value="<?php echo $lstTrans['OTHrs']; ?>" id="labOtHrs_<?php echo $i ?>_<?php echo $kk ?>" name="labOtHrs_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                                <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs('<?php echo $i ?>', '<?php echo $kk ?>'');" onkeypress="return isDecimal(event,this);" onchange="return FormatNum(this, 2)" value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['OTRate'],2,true); ?>" id="labOtRate_<?php echo $i ?>_<?php echo $kk ?>" name="labOtRate_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                                <td width="13%"><input type="text" readonly="" id="labOtAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)" value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['OTAmount'],2,true); ?>" name="labOtAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                                <td width="14%"><input type="text" readonly="" id="labNetAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)" value="<?php echo $this->commonHelper()->sanitizeNumber($lstTrans['NetAmount'],2,true); ?>" name="labNetAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                                <td align="center" width="10%" class="action_btns_td">
                                                                                    <ul class="action_btns">
                                                                                        <li><a style="display:block;" onclick="deleteWbsLab(this, event, <?php echo $i ?>, <?php echo $kk ?>);" id="deleteLabTr_<?php echo $i ?>_<?php echo $kk ?>" class="labDelete_<?php echo $i ?>_<?php echo $kk ?>" href="#"><i data-original-title="Delete" data-placement="top" data-toggle="tooltip" class="fa fa-trash-o"></i>
                                                                                            </a>
                                                                                        </li>
                                                                                    </ul>
                                                                                </td>
                                                                            </tr>

                                                                            <?php
                                                                            $kk++;
                                                                        }
                                                                    }

                                                                    ?>
                                                                    <tr>
                                                                        <td width="15%">
                                                                            <input type="hidden"  id="labId_<?php echo $i ?>_<?php echo $kk ?>" name="labId_<?php echo $i ?>_<?php echo $kk ?>">
                                                                            <input type="text" onfocus="return checkLabTypeUsedwithoutwbs(this, '<?php echo $i ?>');" id="labName_<?php echo $i ?>_<?php echo $kk ?>"   name="labName_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text labTypeSuggest">
                                                                        </td>
                                                                        <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);"  onkeypress="return isDecimal(event,this);" onchange="return pushMainQty(this.id)" id="labQty_<?php echo $i ?>_<?php echo $kk ?>" name="labQty_<?php echo $i ?>_<?php echo $kk ?>" maxlength="5" class="parent_text text-right"></td>
                                                                        <td width="10%"><input type="text" onfocus="return showtipwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onblur="return calSumAmountwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onkeypress="return isDecimal(event,this);"  onchange="return FormatNum(this, 2)" id="labRate_<?php echo $i ?>_<?php echo $kk ?>" maxlength="5" name="labRate_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"style="position:relative;"><div style="display:none;" id="labtip_<?php echo $i ?>_<?php echo $kk ?>"><div class="top-tip top-addtip"><span>Rate : <i id="tiptext_<?php echo $i ?>_<?php echo $kk ?>"></i></span></div></div><input type="hidden" id="amt_<?php echo $i ?>_<?php echo $kk ?>">
                                                                        </td>
                                                                        <td width="13%"><input type="text" readonly="" id="labAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)"  name="labAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                        <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onchange="return pushMainQtyOT(this.id)" onkeypress="return isDecimal(event,this);"  id="labOtHrs_<?php echo $i ?>_<?php echo $kk ?>" name="labOtHrs_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                        <td width="10%"><input type="text" onblur="return calSumAmountwithoutwbs(<?php echo $i ?>, <?php echo $kk ?>);" onkeypress="return isDecimal(event,this);" onchange="return FormatNum(this, 2)"  id="labOtRate_<?php echo $i ?>_<?php echo $kk ?>" name="labOtRate_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                        <td width="13%"><input type="text" readonly="" id="labOtAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)"  name="labOtAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                        <td width="14%"><input type="text" readonly="" id="labNetAmount_<?php echo $i ?>_<?php echo $kk ?>" onchange="return FormatNum(this, 2)"  name="labNetAmount_<?php echo $i ?>_<?php echo $kk ?>" class="parent_text text-right"></td>
                                                                        <td align="center" width="10%" class="action_btns_td">
                                                                            <ul class="action_btns">
                                                                                <li><a style="display:none;" onclick="deleteWbsLab(this, event, <?php echo $i ?>, <?php echo $kk ?>);" id="deleteLabTr_<?php echo $i ?>_<?php echo $kk ?>" class="labDelete_<?php echo $i ?>_<?php echo $kk ?>" href="#"><i data-original-title="Delete" data-placement="top" data-toggle="tooltip" class="fa fa-trash-o"></i>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                        </td>
                                                                    </tr>
                                                                    <input id="labRows_<?php echo $i ?>" type="hidden" value="<?php echo $kk ?>" name="labRows_<?php echo $i ?>">
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <?php $i++;
                                        }
                                    } ?>
                                    </tbody>
                                </table>
                                <table class="table" style="margin-bottom:0px;">
                                    <tfoot>
                                    <tr>
                                        <td width="20%" class="rate_pri">
                                            <label>Total</label>
                                        </td>
                                        <td width="10%">
                                            <input type="text"  class="parent_text text-right total-clr" id="totalconqty" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text" class="parent_text text-right total-clr" id="amtcontractor" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractorothrs" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractorotamount" readonly>
                                        </td>
                                        <td width="15%">
                                            <input type="text"  class="parent_text text-right total-clr" id="contractornetamount" readonly>
                                        </td>
                                        <td width="10%"></td>
                                    </tr>
                                    </tfoot>
                                </table>
                                <input type="hidden" name="conRows" id="conRows"
                                       value="<?php echo (isset($lsVendorTrans) && count($lsVendorTrans) != 0) ? count($lsVendorTrans) : 0; ?>"/>

                            </div>
                        <?php } ?>
                        <!--end of contrtactor without wbs-->
                        <div id="divWithLab" class="table-responsive top-30 animated fadeInUp"
                             style="display:<?php if ($lsRegister['LabourNameWise'] == '1' && $lsRegister['WBSRequired'] == '0') echo 'block'; else echo 'none'; ?>;">
                            <a id="labourtypePickListlabour" href="javascript:void(0);" onclick="showPickListlabour()" class="ad-btn" data-original-title="Labour Strength PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a>
                            <table class="table" style="margin-bottom:0px;">
                                <thead>
                                <tr>
                                    <th width="14%">Labour Name</th>
                                    <th width="14%" class="hideWbs">WBS Name</th>
                                    <th width="8%">In<br/>Time</th>
                                    <th width="8%">Out<br/> Time</th>
                                    <th width="8%" class="text-right">Day</th>
                                    <th width="8%" class="text-right">Rate</th>
                                    <th width="8%" class="text-right">Amount</th>
                                    <th width="8%" class="text-right">OT<br/> Hrs</th>
                                    <th width="8%" class="text-right">OT<br/>Rate</th>
                                    <th width="8%" class="text-right">OT<br/> Amount</th>
                                    <th width="8%" class="text-right">Net<br/> Amount</th>
                                    <th width="8%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                </tr>
                                </thead>
                            </table>
                            <div style="min-height:30px;max-height:350px;overflow:auto">
                                <table class="table" id="wlabTable" style="margin-bottom:0">
                                    <tbody>
                                    <?php
                                    if (isset($lsLabourTrans) && count($lsLabourTrans) != 0) {
                                        $i = 1;
                                        foreach ($lsLabourTrans as $lslTrans) {
                                            ?>
                                            <tr id="labRowId_<?php echo $i; ?>">
                                                <td width="14%">
                                                    <input class="parent_text labSuggest" type="text"
                                                           name="labConName_<?php echo $i; ?>"
                                                           id="labConName_<?php echo $i; ?>"
                                                           value="<?php echo $lslTrans['LabourName']; ?>"
                                                           onfocus="return checkLabUsed(this);" readonly/>
                                                    <input type="hidden" name="labConId_<?php echo $i; ?>"
                                                           id="labConId_<?php echo $i; ?>"
                                                           value="<?php echo $lslTrans['LabourId']; ?>"/>
                                                    <input type="hidden" name="labConDate_<?php echo $i; ?>"
                                                           id="labConDate_<?php echo $i; ?>"
                                                           value="<?php echo date("d/m/Y", strtotime($lslTrans['InTime'])); ?>"/>
                                                </td>
                                                <td width="14%" class="hideWbs">
                                                    <input class="parent_text" type="text"
                                                           name="labWbsName_<?php echo $i; ?>"
                                                           id="labWbsName_<?php echo $i; ?>"
                                                           value="<?php echo $lslTrans['WBSName']; ?>"/>
                                                    <input type="hidden" name="labWbsId_<?php echo $i; ?>"
                                                           id="labWbsId_<?php echo $i; ?>"
                                                           value="<?php echo $lslTrans['WBSId']; ?>"/>
                                                </td>
                                                <td width="8%"><input class="parent_text time_picker" type="text"
                                                                      name="labConInTime_<?php echo $i; ?>"
                                                                      id="labConInTime_<?php echo $i; ?>"
                                                                      value="<?php echo date('h:i a', strtotime($lslTrans['InTime'])); ?>"
                                                                      onblur="return calInOutTime('roId_<?php echo $i; ?>');"/>
                                                </td>
                                                <td width="8%"><input class="parent_text time_picker" type="text"
                                                                      name="labConOutTime_<?php echo $i; ?>"
                                                                      id="labConOutTime_<?php echo $i; ?>"
                                                                      value="<?php echo date('h:i a', strtotime($lslTrans['OutTime'])); ?>"
                                                                      onblur="return calInOutTime('roId_<?php echo $i; ?>');"/>
                                                </td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConQty_<?php echo $i; ?>"
                                                                      id="labConQty_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['Qty']; ?>"
                                                                      onchange="return FormatNum(this, 3)"
                                                                      onblur="return calLabSumAmount('roId_<?php echo $i; ?>');"
                                                                      readonly/></td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConRate_<?php echo $i; ?>"
                                                                      id="labConRate_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['Rate']; ?>"
                                                                      onchange="return FormatNum(this, 2)"
                                                                      onkeypress="return isDecimal(event,this);"
                                                                      onblur="return calLabSumAmount('roId_<?php echo $i; ?>');"/>
                                                </td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConAmount_<?php echo $i; ?>"
                                                                      id="labConAmount_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['Amount']; ?>"
                                                                      onchange="return FormatNum(this, 2)"
                                                                      onblur="return calLabSumAmount('roId_<?php echo $i; ?>');"
                                                                      readonly/></td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConOtHrs_<?php echo $i; ?>"
                                                                      id="labConOtHrs_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['OTHrs']; ?>"
                                                                      onblur="return calLabSumAmount('roId_<?php echo $i; ?>');"
                                                                      readonly/></td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConOtRate_<?php echo $i; ?>"
                                                                      id="labConOtRate_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['OTRate']; ?>"
                                                                      onchange="return FormatNum(this, 2)"
                                                                      onkeypress="return isDecimal(event,this);"
                                                                      onblur="return calLabSumAmount('roId_<?php echo $i; ?>');"/>
                                                </td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConOtAmount_<?php echo $i; ?>"
                                                                      id="labConOtAmount_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['OTAmount']; ?>"
                                                                      onchange="return FormatNum(this, 2)" readonly/>
                                                </td>
                                                <td width="8%"><input class="parent_text text-right" type="text"
                                                                      name="labConNetAmount_<?php echo $i; ?>"
                                                                      id="labConNetAmount_<?php echo $i; ?>"
                                                                      value="<?php echo $lslTrans['NetAmount']; ?>"
                                                                      onchange="return FormatNum(this, 2)" readonly/>
                                                </td>
                                                <td width="10%" align="center" class="action_btns_td">
                                                    <ul class="action_btns">
                                                        <li>
                                                            <a href="#" class="labConDelete_<?php echo $i; ?>"
                                                               onclick="deleteLabCon(this, event);"><i
                                                                    class="fa fa-trash-o" data-toggle="tooltip"
                                                                    data-placement="top"
                                                                    data-original-title="Delete"></i></a>
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                            <?php $i++;
                                        }
                                    } else { ?>
                                        <tr id="labRowId_1">
                                            <td width="14%">
                                                <input class="parent_text labSuggest" type="text" name="labConName_1"
                                                       id="labConName_1" onfocus="return checkLabUsed(this);"/>
                                                <input type="hidden" name="labConId_1" id="labConId_1"/>
                                                <input type="hidden" name="labConDate_1" id="labConDate_1"
                                                       value="<?php echo date("d/m/Y"); ?>"/>
                                            </td>
                                            <td width="14%" class="hideWbs">
                                                <input class="parent_text" type="text" name="labWbsName_1"
                                                       id="labWbsName_1"/>
                                                <input type="hidden" name="labWbsId_1" id="labWbsId_1"/>
                                            </td>
                                            <td width="8%"><input class="parent_text time_picker" type="text"
                                                                  name="labConInTime_1" id="labConInTime_1"
                                                                  onblur="return calInOutTime('roId_1');"/></td>
                                            <td width="8%"><input class="parent_text time_picker" type="text"
                                                                  name="labConOutTime_1" id="labConOutTime_1"
                                                                  onblur="return calInOutTime('roId_1');"/></td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConQty_1" id="labConQty_1"
                                                                  onchange="return FormatNum(this, 3)"
                                                                  onblur="return calLabSumAmount('roId_1');" readonly/>
                                            </td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConRate_1" id="labConRate_1"
                                                                  onchange="return FormatNum(this, 2)"
                                                                  onkeypress="return isDecimal(event,this);"
                                                                  onblur="return calLabSumAmount('roId_1');"/></td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConAmount_1" id="labConAmount_1"
                                                                  onchange="return FormatNum(this, 2)"
                                                                  onblur="return calLabSumAmount('roId_1');" readonly/>
                                            </td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConOtHrs_1" id="labConOtHrs_1"
                                                                  onblur="return calLabSumAmount('roId_1');" readonly/>
                                            </td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConOtRate_1" id="labConOtRate_1"
                                                                  onchange="return FormatNum(this, 2)"
                                                                  onkeypress="return isDecimal(event,this);"
                                                                  onblur="return calLabSumAmount('roId_1');"/></td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConOtAmount_1" id="labConOtAmount_1"
                                                                  onchange="return FormatNum(this, 2)" readonly/></td>
                                            <td width="8%"><input class="parent_text text-right" type="text"
                                                                  name="labConNetAmount_1" id="labConNetAmount_1"
                                                                  onchange="return FormatNum(this, 2)" readonly/></td>
                                            <td width="10%" align="center" class="action_btns_td">
                                                <ul class="action_btns">
                                                    <li>
                                                        <a href="#" class="labConDelete_1"
                                                           onclick="deleteLabCon(this, event);" style="display:none;"><i
                                                                class="fa fa-trash-o" data-toggle="tooltip"
                                                                data-placement="top"
                                                                data-original-title="Delete"></i></a>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                    <?php } ?>
                                    </tbody>
                                </table></div>
                            <table class="table"
                                   style="margin-bottom:0px;">
                                <tfoot>
                                <tr>
                                    <td width="14%"  class="rate_pri"><label>Total</label></td>
                                    <td width="14%" class="hideWbs"><input class="parent_text text-right  total-clr"
                                                                           type="hidden" /></td>
                                    <td width="8%"><input class="parent_text text-right  total-clr"
                                                          type="hidden" id="in_time" /></td>
                                    <td width="8%"><input class="parent_text text-right  total-clr"
                                                          type="hidden" id="out_time" /></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="daytotal"  readonly=""/></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="ratetotal" readonly=""/></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="amttotal" readonly="" /></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="othrstotal" readonly="" /></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="otratetotal" readonly="" /></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="otamttotal" readonly=""/></td>
                                    <td width="8%" class="text-right"><input class="parent_text text-right  total-clr"
                                                                             type="text" id="netamttotal" readonly="" /></td>
                                    <td width="9%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                </tr>
                                </tfoot>
                            </table>
                            <input type="hidden" name="labConRows" id="labConRows"
                                   value="<?php echo (isset($lsLabourTrans) && count($lsLabourTrans) != 0) ? count($lsLabourTrans) : 1; ?>"/>
                        </div>
                        <div class="clearfix"></div>
                        <div style="margin-top:0;padding:5px 0 20px 0;border-top:1px solid #ddd;background:#fff"
                             class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                            <div class="col-lg-6 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12">
                                <label>Narration</label>
        <textarea id="narration" name="narration" style="height:60px" maxlength="500"
                  class="parent_texts"><?php echo $lsRegister['Narration']; ?></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Labour Strength Picklist</h1>
            </div>
            <div class="modal-body">
                <div class="col-md-12 tab-pane" style="padding:0 !important" role="tabpanel" id="iow-view">
                    <div class="table-responsive clear">
                        <div id="withwbsltypepickgrid"> </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="withwbspicklistrestype" value="">
                <input type="hidden" id="withwbspicklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodallabour" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabellabour" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Labour Strength Labour Picklist</h1>
            </div>
            <div class="modal-body">
                <div class="col-md-12 tab-pane" style="padding:0 !important" role="tabpanel" id="iow-view">
                    <div class="table-responsive clear">
                        <div id="withlabourltypepickgrid"> </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="withlabourpicklistrestype" value="">
                <input type="hidden" id="withlabourpicklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickListlabour()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div id="continueDiv" class="col-lg-12 savebtn_area">
    <ul>
        <?php if ($lsRegister['WBSRequired'] == '1' && $lsRegister['LabourNameWise'] == '0') { ?>

            <li class="dropdown save_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple"
                                                     title="Continue"
                                                     <?php if ($lsRegister['EntryForm'] == 'D') { ?>onclick="return continueForm('c','a');"
                                                     <?php } else { ?>onclick="return continueForm('e','a');"<?php } ?>>Continue</a>
            </li>
            <li class="cancel_btn float_r">
                <a class="ripple has-ripple" href="javascript:void(0);" onclick="return backForm();" style="position: relative; overflow: hidden;">Back<span class="ripple-wrapper"></span></a>
            </li>

            <li class="dropdown save_btn"><a href="<?php echo $this->basePath(); ?>/wpm/labourstrength/entry" data-toggle="tooltip" class="ripple"
                                             title="Cancel">Cancel</a>
            </li>
            <!--<li class="cancel_btn float_r"><a href="</?php /*echo $this->basePath().'/wpm/labourstrength/entry/'.$labourId; */?>" data-toggle="tooltip" class="ripple" title="Go back!">Back</a></li>-->
        <?php } else { ?>
            <li class="dropdown save_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple"
                                                     title="Continue" onclick="return continueFormLab('','labourcontinue')">Continue</a>
            </li>
            <li class="cancel_btn float_r">
                <a class="ripple has-ripple" href="javascript:void(0);" onclick="return backForm();" style="position: relative; overflow: hidden;">Back<span class="ripple-wrapper"></span></a>
            </li>
            <!--<li class="cancel_btn float_r"><a href="</?php /*echo $this->basePath().'/wpm/labourstrength/entry/'.$labourId; */?>" data-toggle="tooltip" class="ripple" title="Go back!">Back</a></li>-->
        <?php } ?>
    </ul>
</div>
<div id="submitDiv" class="col-lg-12 savebtn_area" style="display:none;">
    <ul>
        <li class="dropdown save_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple"
                                                 title="Submit" onclick="return continueForm('s','');">Submit</a>

        <li class="cancel_btn float_r "><a href="<?php echo $this->basePath(); ?>/wpm/labourstrength/entry" data-toggle="tooltip" class="ripple"
                                           title="Cancel!"
                                           onclick="return showcontinueback('labourback','');">Cancel</a></li>
        <?php if ($lsRegister['WBSRequired'] == '1' && $lsRegister['LabourNameWise'] == '0') { ?>
            <li class="cancel_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple"
                                              title="Go back!" onclick="return continueForm('b','');">Back</a></li>
        <?php } else { ?>
            <!--<li class="cancel_btn float_r "><a href="javascript:void(0);" data-toggle="tooltip" class="ripple"
                                              title="Go back!"
                                              onclick="return showcontinueback('labourback','');">Back</a></li>-->
        <?php } ?>
    </ul>
</div>

<div class="modal fade bs-example-modal-lg2" id="sequentialViewModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background:#F0F4F5">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><!--<i class="fa fa-times-circle-o clpot"></i>-->
                </button>
                <h1><i class="fa fa-clipboard"></i> Matrix View</h1>
            </div>
            <div class="modal-body">
                <!--                <div class="col-lg-12" style="width: 100%; overflow-x: scroll;">-->
                <div class="col-lg-12 clear" id="gridWrapper">
                    <div class="col-lg-3 col-md-3 col-sm-4">
                        <div class="col-md-12 jqxgrid" style="margin-bottom:10px;display: block;">
                            <div class="slimScroll"
                                 style="background:#fff; box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);"
                                 id='jqxTree'></div>
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-9 col-sm-8" id="tbodyWrapper">
                        <div class="col-md-5 col-md-offset-7 col-sm-8 col-sm-offset-4" style="margin-bottom:5px"><select name="shifttype" class="form-control single_dropdown lbl_move" id ="shifttype" onchange="shiftChange();" style="width:100%">
                                <option value="1" >Regular (in days)</option>
                                <option value="2" >OT in (hrs)</option>
                            </select>
                        </div>
                        <div class="fixedTable" id="demo">
                            <header class="fixedTable-header">
                                <table class="table table-bordered" id="sequentialViewHeader">
                                    <!--                    <div class="fixedTable-body">-->
                                    <!--                    <table class="fixTable table" style=" margin-bottom:0px;" id="sequentialViewTable">-->
                                    <thead>
                                    <tr>
                                        <th>Contractor</th>
                                    </tr>
                                    </thead>
                                </table>
                            </header>
                            <aside class="fixedTable-sidebar">
                                <table class="table table-bordered" id="sequentialViewTable">
                                    <tbody>

                                    </tbody>
                                </table>
                            </aside>
                            <div class="fixedTable-body">
                                <table class="table table-bordered" id="sequentialViewFooter">
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" id="contractorcancel" data-dismiss="modal">Cancel</a>
                <?php if ($lsRegister['wbsvalue']=='1' || $lsRegister['WBSReqWPM']=='1' ) { ?>
                    <button type="button" class="md_ok" onclick="applySequentialValues()">Apply</button>
                <?php }
                else {  ?>
                    <button type="button" class="md_ok" onclick="applySequentialValueswithoutwbs()">Apply</button>
                <?php } ?>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lg2" id="sequentiallabourViewModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background:#F0F4F5">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i>
                </button>
                <h1><i class="fa fa-clipboard"></i>Labour Attendance - <span
                        id="costcenter"><?php echo $lsRegister['CostCentreName']; ?></span> on <span
                        id="labourdate"><?php if ($lsRegister['LSDate'] != NULL) {
                            echo date("d-m-Y", strtotime($lsRegister['LSDate']));
                        } else {
                            echo date("d-m-Y");
                        } ?></span></h1>
            </div>
            <div class="modal-body">
                <div class="col-lg-12 clear" id="gridWrapper">
                    <div class="col-md-12">
                        <div class="table-responsive topsp" style="margin-top:10px">
                            <table class="table" style="margin-bottom:0px;" id="sequential-labourtable">
                                <thead>
                                <tr>
                                    <th width="1%"></th>
                                    <th width="20%">Labour Name</th>
                                    <th width="8%">Group Name</th>
                                    <th width="5%">WBS</th>
                                    <th width="5%">In Time</th>
                                    <th width="5%">Out Time</th>
                                </tr>
                                </thead>
                                <tbody class="main">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="applylabourSequentialValues()">Apply</button>
            </div>
        </div>
    </div>
</div>
<table id="dummy-labour" style="display:none;">
    <tbody>
    <tr id="labRowId__1">
        <td width="14%">
            <input class="parent_text labSuggest" type="text" name="labConName__1" id="labConName__1"
                   onfocus="return checkLabUsed(this);"/>
            <input type="hidden" name="labConId__1" id="labConId__1"/>
            <input type="hidden" name="labConDate__1" id="labConDate__1" value="<?php echo date("d/m/Y"); ?>"/>
        </td>
        <td width="14%" class="hideWbs">
            <input class="parent_text" type="text" name="labWbsName__1" id="labWbsName__1"/>
            <input type="hidden" name="labWbsId__1" id="labWbsId__1"/>
        </td>
        <td width="8%"><input class="parent_text time_picker" type="text" name="labConInTime__1" id="labConInTime__1"
                              onblur="return calInOutTime('roId__1');"/></td>
        <td width="8%"><input class="parent_text time_picker" type="text" name="labConOutTime__1" id="labConOutTime__1"
                              onblur="return calInOutTime('roId__1');"/></td>
        <td width="7%"><input class="parent_text text-right" type="text" name="labConQty__1" id="labConQty__1"
                              onblur="return calLabSumAmount('roId__1');" readonly/></td>
        <td width="8%"><input class="parent_text text-right" type="text" name="labConRate__1" id="labConRate__1"
                              onkeypress="return isDecimal(event,this);" onblur="return calLabSumAmount('roId__1');"/>
        </td>
        <td width="8%"><input class="parent_text text-right" type="text" name="labConAmount__1" id="labConAmount__1"
                              onblur="return calLabSumAmount('roId__1');" readonly/></td>
        <td width="8%"><input class="parent_text text-right" type="text" name="labConOtHrs__1" id="labConOtHrs__1"
                              onblur="return calLabSumAmount('roId__1');" readonly/></td>
        <td width="7%"><input class="parent_text text-right" type="text" name="labConOtRate__1" id="labConOtRate__1"
                              onkeypress="return isDecimal(event,this);" onblur="return calLabSumAmount('roId__1');"/>
        </td>
        <td width="8%"><input class="parent_text text-right" type="text" name="labConOtAmount__1" id="labConOtAmount__1"
                              readonly/></td>
        <td width="8%"><input class="parent_text text-right" type="text" name="labConNetAmount__1"
                              id="labConNetAmount__1" readonly/></td>
        <td width="10%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="#" class="labConDelete__1" onclick="deleteLabCon(this, event);" style="display:none;"><i
                            class="fa fa-trash-o" data-toggle="tooltip" data-placement="top"
                            data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
    </tr>
    </tbody>
</table>
<script id="labour-sequential" type="text/template" class="hide">
    <tr class="subTr dont-hide">
        <td width="5%">
            <input type="checkbox" class="radio_check" name="labcheck__" id="labcheck__" onclick="checklabour(this)"/>
        </td>
        <td width="10%">
            <input type="text" class="parent_text" name="labourname__" id="labourname__" readonly/>
            <input type="hidden" name="labourid__" id="labourid__"/>
        </td>
        <td width="10%">
            <input type="text" class="parent_text " name="groupname__" id="groupname__" readonly/>
            <input type="hidden" name="groupid__" id="groupid__"/>
        </td>
        <td width="10%">
            <input class="parent_text chqty typeSuggest" type="text" name="wbsname__" id="wbsname__"
                   onkeypress="return seqlabwbsselection(this)"/>
            <input type="hidden" name="wbsid__" id="wbsid__"/>
        </td>
        <td width="10%">
            <input class="parent_text time_picker" type="text" name="intime__" id="intime__"
                   readonly/>
        </td>
        <td width="10%">
            <input class="parent_text time_picker" type="text" name="outtime__" id="outtime__" readonly/>
        </td>
    </tr>
</script>
<script>
    var wbsList = <?php echo (isset($wbsMaster)) ? json_encode($wbsMaster) : '[]'; ?>;
    var vendorList = <?php echo (isset($vendorMaster)) ? json_encode($vendorMaster) : '[]'; ?>;
    var grouplist=  <?php echo (isset($groupMaster)) ? json_encode($groupMaster) : '[]'; ?>;
    var vendorList = vendorList.concat(grouplist);
    var labourList = <?php echo (isset($labourlist)) ? json_encode($labourlist) : '[]'; ?>;
    var tmp_labourpickList = labourList;
    var labourTypeList = <?php echo (isset($labourType)) ? json_encode($labourType) : '[]'; ?>;
    var labourMaster = <?php echo (isset($labourMaster)) ? json_encode($labourMaster) : '[]'; ?>;
    var tmp_vendorList = vendorList;
    var tmp_labourList = <?php echo (isset($labourlistforcostcentre)) ? json_encode($labourlistforcostcentre) : '[]'; ?>;
    var tmp_newlabourList = <?php echo (isset($labourlistforcostcentre)) ? json_encode($labourlistforcostcentre) : '[]'; ?>;
    var tmp_dlabourList=<?php echo (isset($labourlistforcostcentre)) ? json_encode($labourlistforcostcentre) : '[]'; ?>;
    var tmp_wbsList = wbsList;
    var tmp_labourTypeList = labourTypeList;
    var tmp_labourTypeListwithoutwbs = labourTypeList;
    var arrLabourTypelist = [];
    var arrLabourName = [];
    var arrLabourQty = [];
    var arrLabourAttn = [];
    var arrayField =[];
    arrayField = [{ data :1, value: 'Contractor Name' },
        { data :2, value: 'WBS Name' },
        { data :3, value: 'Labour Name' },
        { data :4, value: 'Labour Type' },
        { data :5, value: 'Date' },
        { data :6, value: 'In Time' },
        { data :7, value: 'Out Time' },
        { data :8, value: 'Day' },
        { data :9, value: 'Hours' },
        { data :10, value: 'Qty' },
        { data :11, value: 'Rate' },
        { data :12, value: 'OT Hours' },
        { data :13, value: 'OT Rate' },
    ];
    var  wbscheck=$('#wbscheck');
    var arrayFieldR = arrayField;
    var $jqxTree = $('#jqxTree'),
        $tbodyWrapper = $('#tbodyWrapper'),
        g_WBSId = 0,
        arr_wbslist = [];
    $(function () {
        $('#continueDiv').show();

        $('.ripple').materialripple();
        if ($('#mtLabour').is(':checked')) {
            loadLabourMatrix();
            loadLabMatrixValue()
        }
        else if(wbscheck.val()==0) {

            $('.jqxgrid').hide();
            loadContractorMatrix();
            $tbodyWrapper.show();
        }
        else {
            $tbodyWrapper.hide();
            $jqxTree.on('select', function (event) {
                var item = $('#jqxTree').jqxTree('getItem', event.args.element);
                $tbodyWrapper.hide();

                if (item.hasItems)
                    return;
                g_WBSId = item.id;

                loadContractorMatrix();
                $tbodyWrapper.show();
            });
        }
    });

    function shiftChange() {
        if (g_WBSId !=0) loadContractorMatrix();
    }

    function loadLabMatrixValue() {
        var reskeyid = $('input[id*=labConId_]');
        $.each(reskeyid, function (i, obj) {
            var $this = $(this);
            pushAttn($this[0].id);
        });
    }

    function showSequentialView() {
        $('#contractorcancel').show();
        $('#shifttype').val(1).prop('selected', true);
        if (g_WBSId !=0 || $('#wbscheck').val() =='0')
            loadContractorMatrix();
        $("#sequentialViewModal").modal('show');
    }

    function loadContractorMatrix() {
        ;
        var $table = $('#sequentialViewTable tbody');
        var $tableF = $('#sequentialViewFooter tbody');
        $table.html('');
        $tableF.html('');
        // set iows and wbs qty
        $.each($('input[id^=conName_]'), function (i, o) {
            var key = $(this)[0].id.split('_')[1];
            var id = isNullCheck($('#conId_' + key).val(), 'number');
            var value = isNullCheck($('#conName_' + key).val(), 'string');
            if (id == 0 || id == '' || value == '')
                return;

            var arr_qty = [];
            var rowid = (i + 1);
            var tbody = '<tr>'
                + '<td><input type="hidden" id="ltypeid_' + rowid + '" value="' + key + '"/><label id="ltypeidtext_' + (i + 1) + '">' + value + '</label></td>';
            tbody += '</tr>';

            var tbodyF = '<tr>'
            $.each(arrLabourTypelist, function (i, o) {
                var wbsvalue = 0;
                var idtype = (i + 1);
                if($("#wbscheck").val()=='1') {
                    tbodyF += '<td><input type="text" class="parent_text text-right" id="ltypeqty_' + o.ResourceId + '_' + id + '_' + key + '" data-id="' + o.ResourceId + '" value="' + sanitizeNumber(wbsvalue, 3) + '" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3)" onchange="pushQtywithoutwbs(this.id)"/></td>';
                }
                else
                {
                    tbodyF += '<td><input type="text" class="parent_text text-right" id="ltypeqty_' + rowid+ '_' + idtype + '" data-name="' + o.ResourceName + '"data-id="' + o.ResourceId + '" value="' + sanitizeNumber(wbsvalue, 3) + '" onkeypress="return isDecimal(event,this)" onblur="return FormatNum(this, 3)" onchange="pushQtywithoutwbs(this.id)"/></td>';
                }
            });
            tbodyF += '</tr>';
            $table.append(tbody);
            $tableF.append(tbodyF);
        });

        // set header
        var $thead = $('#sequentialViewHeader > thead > tr');
        $thead.html('<th>Contractor</th>');
        $.each(arrLabourTypelist, function (i, o) {
            var name = o.ResourceName;
            $thead.append('<th>' + name + '</th>');
        });

        fillContractorMatrix()
    }

    function fillContractorMatrix() {
        //alert("fillContractorMatrix");
        var iShiftId = $('#shifttype').val();
        var objcom = $.grep(arrLabourQty, function (element, index) {

            return element.WBSId == g_WBSId && element.Qty!=0;});
        for (var i in objcom) {
            var iResId =  objcom[i].ResourceId,
                iWBSId = g_WBSId,
                iContId = objcom[i].ContractorId,
                dQty = isNullCheck(objcom[i].Qty,'number'),
                dOTQty = isNullCheck(objcom[i].OTQty,'number');

            var reskeyid = $('input[id*=ltypeqty_]');
            $.each(reskeyid, function (i, obj) {
                var iLResId = this.id.split('_')[1],
                    iLContId = this.id.split('_')[2];

                if (iLResId == iResId && iLContId == iContId) {
                    if (iShiftId ==1) $('#' + this.id).val(dQty);
                    else if (iShiftId ==2) $('#' + this.id).val(dOTQty);
                    return false;
                }
            });
        }
    }

    function loadLabourMatrix() {
        var rowid = 0;
        var labtemplate = $('#labour-sequential').html();
        $.ajax({
            url: getBaseURL() + "wpm/labourstrength/entry-form",
            type: 'post',
            data: {'CostcentreId': $('#costCentreId').val(),'type':'labourlist'},
            success: function (data, status, xhr) {
                if (xhr.status == 200) {
                    $('#labour-sequential').html('');
                    data = JSON.parse(data);
                    arr_lablist = data;
                    var $tbody = $('#sequential-labourtable').find('>tbody.main');
                    $.each(arr_lablist, function (i, obj) {
                        rowid = rowid + 1;
                        $tbody.append(labtemplate.replace(/__/g, '_' + rowid));
                        $('#labourname_' + rowid).val(obj.LabourName);
                        $('#labourid_' + rowid).val(obj.LabourId);
                        $('#groupname_' + rowid).val(obj.GroupName);
                        $('#groupid_' + rowid).val(obj.VendorgroupId);
                        bindTimePicker();
                    });
                } else {
                    arr_lablist = [];
                }
            },
            error: function (status, error, xhr) {
                arr_lablist = [];
            }
        });
    }

    function showSequentiallabourView() {
        fillMatrixView();
        $("#sequentiallabourViewModal").modal('show');
    }

    function pushMainQty(id) {
        var icontId = id.split('_')[1],
            iWBSId = id.split('_')[2],
            key1 = id.split('_')[3],
            key2 = id.split('_')[4],
            iResId = isNullCheck($('#labId_' + icontId + '_' + iWBSId + '_' + key1 + '_' + key2).val(),'number'),
            dQty = isNullCheck($('#' + id).val(), 'number');
        var bFound = false;
        for (var i in arrLabourQty) {
            if (arrLabourQty[i].ResourceId == iResId && arrLabourQty[i].WBSId == iWBSId && arrLabourQty[i].ContractorId == icontId) {
                arrLabourQty[i].Qty = dQty;
                bFound = true;
                break;
            }
        }
        if (bFound == false) {
            arrLabourQty.push({
                ResourceId: iResId,
                WBSId: iWBSId,
                ContractorId: icontId,
                Qty: dQty
            });
        }
    }

    function pushMainQtyOT(id) {
        var icontId = id.split('_')[1],
            iWBSId = id.split('_')[2],
            key1 = id.split('_')[3],
            key2 = id.split('_')[4],
            iResId = isNullCheck($('#labId_' + icontId + '_' + iWBSId + '_' + key1 + '_' + key2).val(),'number'),
            dQty = isNullCheck($('#' + id).val(), 'number');

        var bFound = false;
        for (var i in arrLabourQty) {
            if (arrLabourQty[i].ResourceId == iResId && arrLabourQty[i].WBSId == iWBSId && arrLabourQty[i].ContractorId == icontId) {
                arrLabourQty[i].OTQty = dQty;
                bFound = true;
                break;
            }
        }
        if (bFound == false) {
            arrLabourQty.push({
                ResourceId: iResId,
                WBSId: iWBSId,
                ContractorId: icontId,
                OTQty: dQty
            });
        }
    }


    function pushQty(id) {
        var iResId = id.split('_')[1],
            icontId = id.split('_')[2],
            dQty = isNullCheck($('#' + id).val(), 'number');

        var iShiftId = $('#shifttype').val();
        var bFound = false;
        for (var i in arrLabourQty) {
            if (arrLabourQty[i].ResourceId == iResId && arrLabourQty[i].WBSId == g_WBSId && arrLabourQty[i].ContractorId == icontId) {
                if (iShiftId==1) arrLabourQty[i].Qty = dQty;
                else if (iShiftId==2) arrLabourQty[i].OTQty = dQty;
                bFound = true;
                break;
            }
        }
        if (bFound == false) {
            if (iShiftId==1) {
                arrLabourQty.push({
                    ResourceId: iResId,
                    WBSId: g_WBSId,
                    ContractorId: icontId,
                    Qty: dQty
                });
            } else if (iShiftId==2) {
                arrLabourQty.push({
                    ResourceId: iResId,
                    WBSId: g_WBSId,
                    ContractorId: icontId,
                    OTQty: dQty
                });
            }
        }
        $('#contractorcancel').hide();
    }

    function pushQtywithoutwbs(id) {

        var iResId = id.split('_')[1],
            icontId = id.split('_')[2],
            dQty = isNullCheck($('#' + id).val(), 'number');
        dataname=$('#' + id).attr('data-name');
        var iShiftId = $('#shifttype').val();
        var bFound = false;
        for (var i in arrLabourQty) {
            if (arrLabourQty[i].ResourceId == iResId && arrLabourQty[i].WBSId == g_WBSId && arrLabourQty[i].ContractorId == icontId) {
                if (iShiftId==1) arrLabourQty[i].Qty = dQty;
                else if (iShiftId==2) arrLabourQty[i].OTQty = dQty;
                bFound = true;
                break;
            }
        }
        if (bFound == false) {
            if (iShiftId==1) {
                arrLabourQty.push({
                    ResourceId: iResId,
                    WBSId: g_WBSId,
                    ContractorId: icontId,
                    Qty: dQty,
                    name:dataname
                });
            } else if (iShiftId==2) {
                arrLabourQty.push({
                    ResourceId: iResId,
                    WBSId: g_WBSId,
                    ContractorId: icontId,
                    OTQty: dQty,
                    name:dataname
                });
            }
        }
        $('#contractorcancel').hide();
    }
    function applySequentialValues() {
        $('.loading_area').show();
        for (var i in arrLabourQty) {
            var iResId = arrLabourQty[i].ResourceId,
                iWBSId = arrLabourQty[i].WBSId,
                iContId = arrLabourQty[i].ContractorId,
                bFound = false,
                dQty = arrLabourQty[i].Qty,
                dOTQty=arrLabourQty[i].OTQty;

            var $labname = $('input[id^=labQty_' + iContId + '_' + iWBSId + ']');
            $.each($labname, function (i, obj) {
                var iMContId = $(this)[0].id.split('_')[1],
                    iMWBSId = $(this)[0].id.split('_')[2],
                    key1 = $(this)[0].id.split('_')[3],
                    key2 = $(this)[0].id.split('_')[4],
                    iMResId = isNullCheck($('#labId_' + iMContId + '_' + iMWBSId + '_' + key1 + '_' + key2).val(),'number');
                if (iContId==iMContId && iWBSId == iMWBSId && iResId ==iMResId) {
                    $('#' + $(this)[0].id).val(sanitizeNumber(dQty,3)).trigger('blur');
                    $('#labOtHrs_' + iMContId + '_' + iMWBSId + '_' + key1 + '_' + key2).val(sanitizeNumber(dOTQty,3)).trigger('blur');
                    bFound = true;
                    return false;
                }
            });

            if (bFound==false) {
                var bWBSFound = false;
                var $conname = $('input[id^=conId_]');
                var ckey1 =0;
                $.each($conname, function (i, obj) {
                    ckey1 = $(this)[0].id.split('_')[1];
                    var iCContId = isNullCheck($('#' + $(this)[0].id).val(),'number');
                    if (iContId == iCContId) return false;
                });

                var $wbsname = $('input[id^=wbsName_' + iContId + ']');
                var wkey1 =0;
                $.each($wbsname, function (i, obj) {
                    var iWContId = $(this)[0].id.split('_')[1];
                    wkey1 = $(this)[0].id.split('_')[2];
                    var iWWBSId = isNullCheck($('#wbsId_' + iWContId + '_' + wkey1).val(),'number');
                    if (iWBSId == iWWBSId) {
                        bWBSFound = true;
                        return false;
                    }
                });
                if (bWBSFound==false) {
                    var objW = $.grep(arr_wbslist, function (element, index) {
                        return element.id == iWBSId});

                    var wbsRowId = isNullCheck($('#wbsRows_' + ckey1).val(),'number');

                    var sWBSName ="";
                    if (objW.length > 0) sWBSName = objW[0].text;

//                    var lrowid = isNullCheck($('#labRows_' + iContId + '_' + wbsRowId),'number');

                    $wbsrow =  $('#wbsName_' + iContId + '_' + wbsRowId);
                    $wbsrow.val(sWBSName);
                    $('#wbsId_' + iContId + '_' + wbsRowId).val(iWBSId);
                    $('#labTable_' + iContId + '_' + wbsRowId + ' tbody').append(addLineLabour(iContId, iWBSId, wbsRowId, ckey1, ''));
                    addWbsRow($wbsrow, iContId, ckey1, wbsRowId);
                    bindLabTypeAutoComplete(iContId, iWBSId, ckey1, wbsRowId);

                }

                var objL = $.grep(labourTypeList, function (element, index) {
                    return element.data == iResId });

                var sResName ="", dRate= 0,dOTRate=0;
                if (objL.length >0) {
                    sResName = objL[0].value;
                    dRate = objL[0].rate;
                    dOTRate = dRate/8;
                }

                var $wwbsname = $('input[id^=wbsName_' + iContId + ']');
                var wwkey1 =0;
                $.each($wwbsname, function (i, obj) {
                    var iWContId = $(this)[0].id.split('_')[1];
                    wwkey1 = $(this)[0].id.split('_')[2];
                    var iWWBSId = isNullCheck($('#wbsId_' + iWContId + '_' + wwkey1).val(),'number');
                    if (iWBSId == iWWBSId)  {  return false; }
                });

                if (wwkey1 !=0) {
                    var lrowid = isNullCheck($('#labRows_' + iContId + '_' + wwkey1).val(), 'number');
                    $('#labId_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(iResId);
                    $('#labName_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(sResName);
                    $labrow = $('#labName_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid);

                    $('#tiptext_' + lrowid).text(dRate);
                    $('#labRate_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(dRate);
                    $('#labQty_'+ iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(sanitizeNumber(dQty,3)).trigger('blur');
                    $('#labOtRate_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(sanitizeNumber(dOTRate,2,true));
                    $('#labOtHrs_' + iContId + '_' + iWBSId + '_' + wwkey1 + '_' + lrowid).val(sanitizeNumber(dOTQty,3)).trigger('blur');

                    addLabTypeRow($labrow, iContId, iWBSId, ckey1, wwkey1);
                }
            }
        }
        $('.loading_area').hide();
        $('#sequentialViewModal').modal('hide');
    }
    // without wbs contractor

    function applySequentialValueswithoutwbs() {

        $('.loading_area').show();
        for (var i in arrLabourQty) {
            var iResId = arrLabourQty[i].ResourceId,
                iWBSId = arrLabourQty[i].WBSId,
                iContId = arrLabourQty[i].ContractorId,
                bFound = false,
                dQty = arrLabourQty[i].Qty,
                dOTQty=arrLabourQty[i].OTQty,
                name=arrLabourQty[i].name;
            var $labname = $('input[id*=labQty_' + iContId + '_]' );
            $.each($labname, function (i, obj) {
                var iMContId = $(this)[0].id.split('_')[1],
                    key1 = $(this)[0].id.split('_')[2],
                    iMResId = isNullCheck($('#labId_' + iMContId + '_' + key1 ).val(),'number');
                if (iContId==iMContId) {
                    $('#' + $(this)[0].id).val(sanitizeNumber(dQty,3)).trigger('blur');
                    $('#labId_' + iContId + '_' + key1).val(iResId).trigger('blur');
                    $('#labName_' + iContId + '_' + key1).val(name).trigger('blur');
                    $('#labOtHrs_' + iContId + '_' + key1).val(sanitizeNumber(dOTQty,3)).trigger('blur');
                    bFound = true;
                    return false;
                }
                addLabTypeRowwithoutwbs($(this)[0].id);
            });

            if (bFound==false) {

                var $conname = $('input[id^=conId_]');
                var ckey1 =0;
                $.each($conname, function (i, obj) {
                    ckey1 = $(this)[0].id.split('_')[1];
                    var iCContId = isNullCheck($('#' + $(this)[0].id).val(),'number');
                    if (iContId == iCContId) return false;
                });
                var objL = $.grep(labourTypeList, function (element, index) {
                    return element.data == iResId });

                var sResName ="", dRate= 0,dOTRate=0;
                if (objL.length >0) {
                    sResName = objL[0].value;
                    dRate = objL[0].rate;
                    dOTRate = dRate/8;
                }
                var lrowid = isNullCheck($('#labRows_' + iContId ).val(), 'number');
                addLabTypeRowwithoutwbs ($(this)[0].id);

            }
        }
        $('.loading_area').hide();
        $('#sequentialViewModal').modal('hide');
    }

    function fillData(iContId, iWBSId, iResId, dQty) {
        var $codes = $('input[id^=conId_]');
        $.each($codes, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            if ($('#' + name).val() == iContId) {
                var key1 = isNullCheck(name.split('_')[1], 'number'),
                    key2 = 0,
                    key3 = 0;

                if (iWBSId != 0) {
                    var bWBSFound = false;
                    var $wbsids = $('input[id^=wbsId_' + key1 + ']');
                    $.each($wbsids, function (i, obj) {
                        var sWBSName = $(this)[0].id;
                        if ($('#' + sWBSName).val() == iWBSId) {
                            bWBSFound = true;
                            key2 = isNullCheck(sWBSName.split('_')[2], 'number');
                            return false;
                        }
                    });


                    var bLTFound = false;
                    var $ltsids = $('input[id^=labId_' + key1 + '_' + key2 + ']');
                    $.each($ltsids, function (i, obj) {
                        var sLTName = $(this)[0].id;
                        if ($('#' + sLTName).val() == iResId) {
                            bLTFound = true;
                            key3 = isNullCheck(sLTName.split('_')[2], 'number');
                            return false;
                        }
                    });

                    $('#labQty_' + key1 + '_' + key2 + '_' + key3).val(sanitizeNumber(dQty, 3)).trigger('change');


                } else {


                }
            }


        });

    }

    function getWBSData() {
        var iCCId = $('#costCentreId').val();
        arr_wbslist = [];
        $.ajax({
            url: getBaseURL() + "wpm/labourstrength/getprojectWBSList",
            type: 'post',
            data: {'costCentreId': iCCId},
            success: function (data, status, xhr) {
                if (xhr.status == 200) {
                    data = JSON.parse(data);
                    arr_wbslist = data;
                } else {
                    arr_wbslist = [];
                }
                bindTreeGrid();
            },
            error: function (status, error, xhr) {
                arr_wbslist = [];
                bindTreeGrid();
            }
        });
    }

    function bindTreeGrid() {
        var source = {
            async: false,
            datatype: "json",
            editable: false,
            datafields: [
                {name: 'id'},
                {name: 'parentid'},
                {name: 'text'}
            ],
            id: 'id',
            localdata: arr_wbslist
        };

        var dataAdapter = new $.jqx.dataAdapter(source);
        dataAdapter.dataBind();
        var records = dataAdapter.getRecordsHierarchy('id', 'parentid', 'items', [{name: 'text', map: 'label'}]);

        $jqxTree.jqxTree({
            source: records, width: '100%', allowDrag: false,
            allowDrop: false
        });
        $('.loading_area').hide();
    }

    function getLabourType() {
        var iCCId = $('#costCentreId').val();
        arrLabourTypelist = [];
        $.ajax({
            url: getBaseURL() + "wpm/labourstrength/getLabourTypeList",
            async: false,
            data: {'costCentreId': iCCId,'type':"typelist"},
            type: 'post',
            success: function (data, status) {
                arrLabourTypelist = jQuery.parseJSON(data);
                loadContractorMatrix();
                getLabourname();
            }
        });
    }

    function getLabourname() {
        var iCCId = $('#costCentreId').val();
        $.ajax({
            url: getBaseURL() + "wpm/labourstrength/getLabourTypeList",
            async: false,
            data: {'costCentreId': iCCId,'type':"labourname"},
            type: 'post',
            success: function (data, status) {
                arrLabourName = jQuery.parseJSON(data);
                //validateName(arrLabourName);
            }
        });
    }
    /* For Contractor */
    <?php if($lsRegister['WBSRequired'] == '1' && $lsRegister['LabourNameWise'] == '0') { ?>
    var source =
    {
        localdata: vendorList,
        dataFields: [
            {name: 'data', type: 'number'},
            {name: 'value', type: 'string'},
            {name: 'IsCheck', type: 'bool'},
            {name: 'type', type: 'string'},
        ],
        dataType: "json"
    };
    var adapter = new $.jqx.dataAdapter(source);
    $("#contractorTable").jqxGrid(
        {
            width: '100%',
            pageable: true,
            rowsheight: 35,
            selectionMode: 'singlecell',
            pagerButtonsCount: 6,
            autoheight: true,
            source: adapter,
            altrows: true,
            filterable: true,
            showfilterrow: true,
            editable: true,
            columnsResize: true,
            columns: [
                {text: '', dataField: 'data', hidden: true, filterable: false},
                {
                    text: '',
                    dataField: 'IsCheck',
                    width: '10%',
                    columntype: 'checkbox',
                    filterable: false,
                    editable: true,
                    resizable: false,
                    type: 'bool'
                },
                {text: 'Contractor', dataField: 'value', width: '90%', editable: false}
            ]
        });
    <?php }
else if($lsRegister['WBSRequired'] == '0' && $lsRegister['LabourNameWise'] == '1') { ?>
    /* For Labour */
    $("#div2").hide();
    var source =
    {
        localdata: labourList,
        dataFields: [
            {name: 'LabourId', type: 'number'},
            {name: 'LabourName', type: 'string'},
            {name: 'IsCheck', type: 'bool'},
        ],
        dataType: "json",
    };
    var adapter = new $.jqx.dataAdapter(source);
    $("#LabourTable").jqxGrid(
        {
            width: '100%',
            pageable: true,
            rowsheight: 35,
            selectionMode: 'singlecell',
            pagerButtonsCount: 6,
            autoheight: true,
            source: adapter,
            altrows: true,
            filterable: true,
            showfilterrow: true,
            editable: true,
            columnsResize: true,
            columns: [
                {
                    text: '',
                    dataField: 'LabourId',
                    hidden: true,
                    columntype: 'checkbox',
                    resizable: false,
                    type: 'bool',
                    filterable: false
                },
                {
                    text: '',
                    dataField: 'IsCheck',
                    width: '10%',
                    columntype: 'checkbox',
                    filterable: false,
                    editable: true,
                    resizable: false,
                    type: 'bool'
                },
                {text: 'Labour Name', dataField: 'LabourName', width: '30%', editable: false},
                {text: 'ContractName', dataField: 'Contractor', width: '30%', editable: false},
                {text: 'Type', dataField: 'ResourceName', width: '30%', editable: false}
            ]
        });
    <?php } ?>

    var oldRow='';
    function showDiv(e, etype, cId) {
        var $x = $(e),
            key = $x[0].id.split('_')[1];

        if (etype == 'm') {

            if(oldRow != ''){
                oldRow.find(".subDiv").slideUp("slow");
                oldRow.slideUp("slow");
            }

            oldRow=$('#subRowId_'+key);

            if ($('#conId_' + key).val() != '') {
                if (!$('#subRowId_' + key).is(":visible")) {
                    $('#subRowId_' + key).show();
                    $('#subRowId_' + key).find(".subDiv").slideDown("slow");
                    $(e).find("i").addClass("tform");
                } else {
                    $('#subRowId_' + key).find(".subDiv").slideUp("slow");
                    $('#subRowId_' + key).slideUp("slow");
                    $(e).find("i").removeClass("tform");
                }
            }
        }
        else if(etype == 'mwbs')
        {
            if(oldRow != ''){
                oldRow.find(".subDiv").slideUp("slow");
                oldRow.slideUp("slow");
            }

            oldRow=$('#subRowRowId_'+key);


            if (!$('#subRowRowId_'+key).is(":visible")) {
                $('#subRowRowId_'+key).show();
                $('#subRowRowId_'+key).find(".subDiv").slideDown("slow");
                //$(e).find("i").addClass("tform");
            } else {
                $('#subRowRowId_'+key).find(".subDiv").slideUp("slow");
                $('#subRowRowId_'+key).slideUp("slow");
                //$(e).find("i").removeClass("tform");
            }
        }

        else {
            var key2 = $x[0].id.split('_')[2];
            if (!$('#subRowSubRowId_' + cId + '_' + key2).is(":visible")) {
                $('#subRowSubRowId_' + cId + '_' + key2).show();
                $('#subRowSubRowId_' + cId + '_' + key2).find(".subDiv").slideDown("slow");
                $(e).find("i").addClass("tform");
            } else {
                $('#subRowSubRowId_' + cId + '_' + key2).find(".subDiv").slideUp("slow");
                $('#subRowSubRowId_' + cId + '_' + key2).slideUp("slow");
                $(e).find("i").removeClass("tform");
            }
        }
    }
    function showcontinueback(lback) {
        $('#sequential').hide();
        if (lback == 'labourback') {
            $("#div2").hide();
            $("#div1labourlist").show();
            $("#submitDiv").hide();
            $("#continueDiv").show();
        }
    }
    function continueFormLab(lback, lcontinue) {
        $('#sequential').show();
        $('#mtLabourseq').show();
        $("#div2").show();
        $("#div1labourlist").hide();
        $("#submitDiv").show();
        $("#continueDiv").hide();
        var rows = $('#LabourTable').jqxGrid('getboundrows');
        var template = $('#dummy-labour tbody').html();
        var sno = 0;
        $('#wlabTable > tbody').html('');
        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            if (row.IsCheck == true) {
                sno++;
                $('#wlabTable > tbody').append(template.replace(/__1/g, '_' + sno));
                $('#labConName_' + sno).val(row.LabourName);
                $('#labConName_' + sno).attr('readonly', true);
                $('#labConId_' + sno).val(row.LabourId);
                $('.labConDelete_' + sno).show();
                pushAttn('labConId_' + sno);
            }
        }
        sno += 1;
        $('#wlabTable > tbody').append(template.replace(/__1/g, '_' + sno));
        $('#labConRows').val(sno);
        bindLabourWbsAutoComplete();
        bindTimePicker();
        loadLabourMatrix();
    }
    function continueForm(cType, aeType) {

        $('#sequential').show();
        $('#mtwbsseq').show();
        getWBSData();
        getLabourType();
        var errFlag = 0;
        $('.red_bdr').removeClass('red_bdr');
            console.log(cType);
        if (cType == 'c') {
            if (aeType == 'a') {
                $.post(getBaseURL() + 'wpm/labourstrength/get-comp-cc-no', {
                        typeId: $('#lsTypeId').val(),
                        ccId: $('#costCentreId').val()
                    },
                    function (data) {
                        var vNo = data.split('###');
                        $('#lsCCNo').val($.trim(vNo[0]));
                        $('#lsCompNo').val($.trim(vNo[1]));
                        if($.trim(vNo[0]) != '')
                            $('#lsCCNo').prop('readonly', true);
                        if($.trim(vNo[1]) != '')
                            $('#lsCompNo').prop('readonly', true);
                    });

                $('#conTable tbody').html('');
                var rows = $('#contractorTable').jqxGrid('getboundrows');
                for (var i = 0; i < rows.length; i++) {
                    var row = rows[i];
                    if (row.IsCheck == true) {
                        addSelConRow(row.data, row.value,row.type);
                    }
                }
            } else {
                $('.cancel_btn').hide();
            }
            addSelConRow('', '');
            $('#continueDiv').hide();
            $('#div1').hide();
            $('#div2').show();
            $('#submitDiv').show();
        } else if (cType == 'b') {
            $('#div2').hide();
            $('#submitDiv').hide();
            $('#div1').show();
            $('#continueDiv').show();
        } else if (cType == 's') {
            if ($.trim($('#lsNo').val()) == '') {
                $('#lsNo').addClass('red_bdr');
                $('#lsNo').focus();
                errFlag = 1;
                return false;
            }
            if ($.trim($('#lsCCNo').val()) == '') {
                $('#lsCCNo').addClass('red_bdr');
//                $('#lsCCNo').focus();
                $('html, body').animate({
                    scrollTop: $("#lsCCNo").offset().top-100
                }, 2000);
                errFlag = 1;
                return false;
            }
            if ($.trim($('#lsCompNo').val()) == '') {
                $('#lsCompNo').addClass('red_bdr');
//                $('#lsCompNo').focus();
                $('html, body').animate({
                    scrollTop: $("#lsCompNo").offset().top-100
                }, 2000);
                errFlag = 1;
                return false;
            }
            if ($.trim($('#refNo').val()) == '') {
                $('#refNo').addClass('red_bdr');
//                $('#refNo').focus();
                $('html, body').animate({
                    scrollTop: $("#refNo").offset().top-100
                }, 2000);
                errFlag = 1;
                return false;
            }

            if (errFlag == 0) {
                $('#formWrapper').submit();
            }
        } else if (cType == 'e') {
            $(".error_message").hide();
            if (aeType == 'a') {
                var formData = new FormData();
                var isValid = true;
                var dupArr = [];
                var exCnt = $('#excelCount').val();

                for (var i = 1; i <= exCnt; i++) {
                    if ($('#dtField_' + i).val() != '') {
                        if ($.inArray($('#dtField_' + i).val(), dupArr) != -1) {
                            isValid = false;
                        } else {
                            dupArr.push($('#dtField_' + i).val());
                        }
                        formData.append('dtField_' + i, $('#dtField_' + i).val());
                    }
                }
                formData.append('labourId', $('#labourId').val());
                formData.append('excelCount', $('#excelCount').val());
                formData.append('fileUrl', $('#fileUrl').val());
                formData.append('costCentreId', $('#costCentreId').val());
                if (isValid == false) {
                    $(".error_message").show();
                    return false;
                } else {
                    $.ajax({
                        url: getBaseURL() + "wpm/labourstrength/get-excel-data",
                        async: false,
                        cache: false,
                        contentType: false,
                        processData: false,
                        data: formData,
                        type: 'post',
                        success: function (data, status, xhr) {
                            var dataSpl = data.split('##%&&%##');
                            if (dataSpl[2] == 'con') {
                                $('#divWithLab').hide();
                                $('#divWithWbs').show();
                                $('#conTable tbody').empty();
                                $('#conTable tbody').append(dataSpl[0]);
                                $('#conRows').val(dataSpl[1]);
                                for (i = 0; i <= dataSpl[1]; i++) {
                                    var eConId = 'c' + i;
                                    bindWbsAutoComplete(eConId, i, '');
                                }
                                addSelConRow('', '');
                            } else if (dataSpl[2] == 'lab') {
                                $('#divWithWbs').hide();
                                $('#divWithLab').show();
                                $('#wlabTable tbody').empty();
                                $('#wlabTable tbody').append(dataSpl[0]);
                                $('#labConRows').val(dataSpl[1]);
                                bindTimePicker();
                                insertLabConRow();
                            }
                            $('#continueDiv').hide();
                            $('#div1').hide();
                            $('#div2').show();
                            $('#submitDiv').show();
                            validateName(arrLabourName,arrLabourTypelist);
                        },
                        error: function (xhr, status, errorThrown) {
                            if (xhr.status == 400)
                                alert(xhr.responseText);
                            else
                                alert(errorThrown);
                        }
                    });
                }
            }
        } else if (cType == 'l') {
            $('#continueDiv').hide();
            $('#submitDiv').show();
        }
    }

    function addSelConRow(vid, vname,type) {
        var $rowid = $('#conRows'),
            count = parseInt($rowid.val()) + 1;
        if($('#wbscheck').val()=='1') {
            $('#conTable > tbody').append(addLineCon(count,type));
        }
        else
        {
            $('#conTable > tbody').append(addLineConwithoutwbs(count,type));

        }
        $rowid.val(count);
        $('#conName_' + count).val(vname);
        $('#conId_' + count).val(vid);
        if (vid != '') {
            if($('#wbscheck').val()=='1') {
                $('#wbsTable_' + count + ' tbody').append(addLineWbs(vid, count, ''));
            }
            else if($('#wbscheck').val()=='0')
            {

                $('#labTable_' + count + ' tbody').append(addLineLabourwithoutwbs(count,1));
            }
            //bindWbsAutoComplete(vid, count, '');
            $('#showDivId_' + count).show();
            $('.conDelete_' + count).show();
        }
        bindContractorAutoComplete();
    }

    function addConRow(x) {

        var $x = $(x),
            $tr = $x.closest('tr');

        key = $x[0].id.split('_')[1];

        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        if ($('#conName_' + key).val().length == 0 && $('#conId_' + key).val().length == 0)
            return;

        var $rowid = $('#conRows'),
            count = parseInt($rowid.val()) + 1;

        $tr.parent('tbody').append(addLineCon(count));
        $rowid.val(count);
        bindContractorAutoCompletepick();
        $('#showDivId_' + key).show();
        $('.conDelete_' + key).show();
        showDiv(x, 'm', '');
    }


    function deleteCon(x, e) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        var key = $(x)[0].id.split('_')[1],
            contId = $('#conId_' + key).val();

        var objcom = $.grep(arrLabourQty, function (element, index) {
            return element.ContractorId !=contId});

        arrLabourQty = [];
        arrLabourQty =objcom;


        if ($tbody.find('tr').length == 1) {
            $tbody.append(addLineCon(1));
            $('#conRows').val(1);
        }

        $tr.next('tr.subTr').remove();
        $tr.remove();
        return false;
    }

    function addWbsRow(x, conId, rId, trId) {
        var $x = $(x),
            $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[2];

        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        if ($('#wbsName_' + conId + '_' + key).val().length == 0 && $('#wbsId_' + conId + '_' + key).val().length == 0)
            return;

        var $rowid = $('#wbsRows_' + rId),
            count = parseInt($rowid.val()) + 1;

        $rowid.val(count);
        $tr.parent('tbody').append(addLineWbs(conId, rId, count));
        bindWbsAutoComplete(conId, rId, trId);
        $('#showDivSubId_' + conId + '_' + trId).show();
        $('.wbsDelete_' + conId + '_' + trId).show();
        showDiv(x, 's', conId);
    }

    function deleteWbs(x, e, conId, rId) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        if ($tbody.find('tr').length == 1) {
            $tbody.append(addLineWbs(conId, rId, 1));
            $('#wbsRows_' + rId).val(1);
        }
        var $x = $(x);
        var ids = $x[0].id.split('_');
//    var conId =ids[1];
        var wbsId = ids[2];

        var iWBSId = $('#wbsId_' +  conId + '_' + wbsId).val();

        var mcQty = parseFloat($('#conQty_' + rId).val()) - parseFloat($('#wbsQty_' + conId + '_' + wbsId).val());
        var mcAmt = parseFloat($('#conAmount_' + rId).val()) - parseFloat($('#wbsAmount_' + conId + '_' + wbsId).val());
        var mcOtHrs = parseFloat($('#conOtHrs_' + rId).val()) - parseFloat($('#wbsOtHrs_' + conId + '_' + wbsId).val());
        var mcOtAmt = parseFloat($('#conOtAmount_' + rId).val()) - parseFloat($('#wbsOtAmount_' + conId + '_' + wbsId).val());
        var mcNetAmt = parseFloat($('#conNetAmount_' + rId).val()) - parseFloat($('#wbsNetAmount_' + conId + '_' + wbsId).val());
        $('#conQty_' + rId).val(mcQty).trigger('change');
        $('#conAmount_' + rId).val(mcAmt).trigger('change');
        $('#conOtHrs_' + rId).val(mcOtHrs);
        $('#conOtAmount_' + rId).val(mcOtAmt).trigger('change');
        $('#conNetAmount_' + rId).val(mcNetAmt).trigger('change');


        var objcom = $.grep(arrLabourQty, function (element, index) {
            return element.ContractorId !=conId || element.WBSId != iWBSId});

        arrLabourQty = [];
        arrLabourQty =objcom;

        $tr.next('tr.subTr').remove();
        $tr.remove();
        return false;
    }

    function addLabTypeRow(x, conId, wbsId, mId, rId) {
        var $x = $(x),
            $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[4];

        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        if ($('#labName_' + conId + '_' + wbsId + '_' + rId + '_' + key).val().length == 0 && $('#labId_' + conId + '_' + wbsId + '_' + rId + '_' + key).length == 0)
            return;

        var $rowid = $('#labRows_' + conId + '_' + rId),
            count = parseInt($rowid.val()) + 1;

        $rowid.val(count);
        $tr.parent('tbody').append(addLineLabour(conId, wbsId, rId, mId, count));
        bindLabTypeAutoComplete(conId, wbsId, mId, rId);
        $('.labDelete_' + conId + '_' + wbsId + '_' + rId + '_' + key).show();
    }
    function addLabTypeRowwithoutwbs(x) {
        var id = $(x)[0].id.split('_')[1];
        var key1=$(x)[0].id.split('_')[2];
        var akey=parseInt(key1) + 1;

        var $x = $(x),
            $tr = $x.closest('tr');
        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        if ($('#labName_' + id + '_' + key1).val().length == 0 && $('#labId_'+ id + '_' + key1).length == 0)
            return;

        var $rowid = $('#labRows_' + id),
            count = parseInt($rowid.val()) + 1;
        $rowid.val(count);
        $tr.parent('tbody').append(addLineLabourwithoutwbs(id,akey));
        bindLabTypeAutoCompletewithoutwbs(x);
        $('.labDelete_'+ id + '_' + key1).show();
    }
    function deleteWbsLab(x, e, conId, wbsId, mId, rId) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        if ($tbody.find('tr').length == 1) {
            $tbody.append(addLineLabour(conId, wbsId, rId, mId, 1));
            $('#labRows_' + conId + '_' + rId).val(1);
        }
        var $x = $(x);
        var $conId = $(conId);
//    console.log($conId)
        var ids = $x[0].id.split('_');
        var row = ids[1];
//    var conId =ids[1];
//    var rId = ids[2];
//    var wbsId = ids[3];
        var rowid = ids[4];

        var iResId =  $('#labId_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val();

        var mQty = parseFloat($('#wbsQty_' + conId + '_' + rId).val()) - parseFloat($('#labQty_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mAmt = parseFloat($('#wbsAmount_' + conId + '_' + rId).val()) - parseFloat($('#labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mOtHrs = parseFloat($('#wbsOtHrs_' + conId + '_' + rId).val()) - parseFloat($('#labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mOtAmt = parseFloat($('#wbsOtAmount_' + conId + '_' + rId).val()) - parseFloat($('#labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mNetAmt = parseFloat($('#wbsNetAmount_' + conId + '_' + rId).val()) - parseFloat($('#labNetAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        $('#wbsQty_' + conId + '_' + rId).val(mQty).trigger('change');
        $('#wbsAmount_' + conId + '_' + rId).val(mAmt).trigger('change');
        $('#wbsOtHrs_' + conId + '_' + rId).val(mOtHrs);
        $('#wbsOtAmount_' + conId + '_' + rId).val(mOtAmt).trigger('change');
        $('#wbsNetAmount_' + conId + '_' + rId).val(mNetAmt).trigger('change');

        var mcQty = parseFloat($('#conQty_' + mId).val()) - parseFloat($('#labQty_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mcAmt = parseFloat($('#conAmount_' + mId).val()) - parseFloat($('#labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mcOtHrs = parseFloat($('#conOtHrs_' + mId).val()) - parseFloat($('#labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mcOtAmt = parseFloat($('#conOtAmount_' + mId).val()) - parseFloat($('#labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        var mcNetAmt = parseFloat($('#conNetAmount_' + mId).val()) - parseFloat($('#labNetAmount_' + conId + '_' + wbsId + '_' + rId + '_' + rowid).val());
        $('#conQty_' + mId).val(mcQty).trigger('change');
        $('#conAmount_' + mId).val(mcAmt).trigger('change');
        $('#conOtHrs_' + mId).val(mcOtHrs);
        $('#conOtAmount_' + mId).val(mcOtAmt).trigger('change');
        $('#conNetAmount_' + mId).val(mcNetAmt).trigger('change');

        var objcom = $.grep(arrLabourQty, function (element, index) {
            return element.ContractorId !=conId || element.WBSId != wbsId || element.ResourceId != iResId;});

        arrLabourQty = [];
        arrLabourQty =objcom;

        $tr.next('tr.subTr').remove();
        $tr.remove();
        return false;
    }

    function bindContractorAutoComplete() {
        $('#conTable .conSuggest').autocomplete({
            lookup: tmp_vendorList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[1];
                    $this.prop('readonly', true).addClass('border-none');
                    $('#conId_' + key1).val(suggestion.data);
                    $('#grpvendortype_'+key1).val(suggestion.type)
                    $('#wbsTable_' + key1 + ' tbody').append(addLineWbs(suggestion.data, key1, ''));
                    addConRow($this);
                    bindWbsAutoComplete(suggestion.data, key1, '');
                    //addLabTypeRowwithoutwbs();
                    removeError($this);
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];

                $('#conId_' + key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }
    function bindContractorAutoCompletepick(x) {
        $('#conTable .conSuggest').autocomplete({
            lookup: tmp_vendorList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {

                    $this.prop('readonly', true).addClass('border-none');
                    $('#conId_' + x).val(suggestion.data);
                    $('#grpvendortype_'+x).val(suggestion.type)
                    $('#wbsTable_' + x + ' tbody').append(addLineWbs(suggestion.data, x, ''));
                    addConRow($this);
                    bindWbsAutoComplete(suggestion.data, x, '');
                    //addLabTypeRowwithoutwbs();
                    removeError($this);
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];

                $('#conId_' + key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }
    function checkConUsed(x) {

        var id = $(x)[0].id.split('_')[1];
        var reskeyid = $('input[id*=conId_]');
        tmp_vendorList = vendorList;
        tmp_vendorList = $.grep(vendorList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                //alert(key1 +'!='+ id);
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindContractorAutoComplete();
    }

    function checkConUsedpick(key) {
        var reskeyid = $('input[id*=conId_]');
        tmp_vendorList = vendorList;
        tmp_vendorList = $.grep(vendorList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != key) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
    }
    function checkLabUsedpick(key) {
        var reskeyid = $('input[id*=labConId_]');
        tmp_dlabourList = tmp_newlabourList;
        tmp_dlabourList = $.grep(tmp_newlabourList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != key) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });

    }
    function bindWbsAutoComplete(conId, rId, trId) {
        $('#wbsTable_' + rId + ' .wbsSuggest').autocomplete({
            lookup: tmp_wbsList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[2];
                    $this.prop('readonly', true).addClass('border-none');

                    $('#wbsId_' + conId + '_' + key1).val(suggestion.data);
                    $('#labTable_' + conId + '_' + key1 + ' tbody').append(addLineLabour(conId, suggestion.data, key1, rId, ''));
                    addWbsRow($this, conId, rId, trId);
                    bindLabTypeAutoComplete(conId, suggestion.data, rId, key1);
                    removeError($(this));
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[2];

                $('#wbsId_' + conId + '_' + key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }

    function checkWbsUsed(x, conId, rId, trId) {
        var id = $(x)[0].id.split('_')[2];
        var reskeyid = $('input[id*=wbsId_' + conId + '_]');
        tmp_wbsList = wbsList;
        tmp_wbsList = $.grep(wbsList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[2];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindWbsAutoComplete(conId, rId, trId);
    }

    function bindLabTypeAutoComplete(conId, wbsId, mId, rId) {
        $('#labTable_' + conId + '_' + rId + ' .labTypeSuggest').autocomplete({
            lookup: tmp_labourTypeList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[4];
                    $this.prop('readonly', true).addClass('border-none');

                    $('#labId_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(suggestion.data);
                    /*$('#tiptext_' + key1).text(suggestion.rate);
                     $('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(suggestion.rate);
                     var dOTRate = suggestion.rate/8;
                     $('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(dOTRate);*/
                    rateqtycalculation(key1, conId, wbsId, mId, rId,suggestion.data);
                    addLabTypeRow($this, conId, wbsId, mId, rId);
                    removeError($(this));
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[4];

                $('#labId_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val('');
                $('#tiptext_' + key1).text('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }
    function rateqtycalculation(key1, conId, wbsId, mId, rId,resourceid)
    {

        $.post(getBaseURL() + 'wpm/labourstrength/entryform', {
                CostcentreId: $('#costCentreId').val(),
                resourceIds: resourceid,
                type: 'rateqty'
            },
            function (data) {
                data=JSON.parse(data);
                $('#apptiptext_' + key1).text(data.ORate);
                $('#prjtiptext_' + key1).text(data.PRate);
                $('#libtiptext_' + key1).text(data.PqRate);
                if(data.ORate !=0) {

                    $('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(data.ORate);
                    var dOTRate = data.ORate/8;
                    $('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(dOTRate);
                }
                else if(data.PRate !=0)
                {

                    $('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(data.PRate);
                    var dOTRate = data.PRate/8;
                    $('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(dOTRate);
                }
                else
                {

                    $('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(data.PqRate);
                    var dOTRate = data.PqRate/8;
                    $('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + key1).val(dOTRate);
                }
            });

    }
    function bindLabTypeAutoCompletewithoutwbs(x) {
        var id = $(x)[0].id.split('_')[1];
        $('#labTable_' + id + ' .labTypeSuggest').autocomplete({
            lookup: tmp_labourTypeListwithoutwbs,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[2];
                    $this.prop('readonly', true).addClass('border-none');

                    $('#labId_' + id + '_' + key1).val(suggestion.data);
                    /* $('#tiptext_' + key1).text(suggestion.rate);
                     $('#labRate_' + id + '_' + key1).val(suggestion.rate);
                     var dOTRate = suggestion.rate/8;
                     $('#labOtRate_'+ id + '_' + key1).val(dOTRate);*/
                    rateqtycalculationwithoutwbs(id,key1,suggestion.data);
                    addLabTypeRowwithoutwbs(x);
                    removeError($(this));
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[4];

                $('#labId_' + id + '_' + key1).val('');
                $('#tiptext_' + key1).text('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }
    function rateqtycalculationwithoutwbs(id,key1,resourceid)
    {
        $.post(getBaseURL() + 'wpm/labourstrength/entryform', {
                CostcentreId: $('#costCentreId').val(),
                resourceIds: resourceid,
                type: 'rateqty'
            },
            function (data) {
                data=JSON.parse(data);
                $('#apptiptext_' + id + '_' + key1).text(data.ORate);
                $('#prjtiptext_' + id + '_' + key1).text(data.PRate);
                $('#libtiptext_' + id + '_' + key1).text(data.PqRate);
                if(data.ORate !=0) {
                    $('#labRate_' + id + '_' + key1).val(data.ORate);
                    var dOTRate =data.ORate/8;
                    $('#labOtRate_'+ id + '_' + key1).val(dOTRate);
                }
                else if(data.PRate !=0)
                {
                    $('#labRate_' + id + '_' + key1).val(data.PRate);
                    var dOTRate = data.PRate/8;
                    $('#labOtRate_'+ id + '_' + key1).val(dOTRate);
                }
                else
                {
                    $('#labRate_' + id + '_' + key1).val(data.PqRate);
                    var dOTRate = data.PqRate/8;
                    $('#labOtRate_'+ id + '_' + key1).val(dOTRate);
                }
            });
    }
    function checkLabTypeUsed(x, conId, wbsId, mId, rId) {
        var id = $(x)[0].id.split('_')[4];
        var reskeyid = $('input[id*=labId_' + conId + '_' + wbsId + '_' + rId + '_]');

        tmp_labourTypeList = labourTypeList;
        tmp_labourTypeList = $.grep(labourTypeList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[4];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindLabTypeAutoComplete(conId, wbsId, mId, rId);
    }
    function checkLabTypeUsedwithoutwbs(x, rId) {
        var id = $(x)[0].id.split('_')[2];
        var key2=$(x)[0].id.split('_')[1];
        var typeused=$('#labId_'+key2+'_'+rId).val();
        var reskeyid = $('input[id*=labId_' + key2 + '_]');
        tmp_labourTypeListwithoutwbs = labourTypeList;
        tmp_labourTypeListwithoutwbs = $.grep(labourTypeList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');

                var key1 = arrname[2];
                if (key1 != id) {
                    if (element.data == $this.val() ) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindLabTypeAutoCompletewithoutwbs(x);
    }
    function addLineCon(rId,type) {
        var conData = '';
        conData += '<tr id="rowId_' + rId + '">' +
        '<td width="20%">' +
        '<input class="parent_text conSuggest" type="text" name="conName_' + rId + '" id="conName_' + rId + '" onfocus="return checkConUsed(this);" />' +
        '<input type="hidden" class="conclass" name="conId_' + rId + '" id="conId_' + rId + '" />'+'<input type="hidden" name="grpvendortype_' + rId + '" id="grpvendortype_' + rId + '"  value="'+type+'" />'+
        '<input type="hidden" name="wbsRows_' + rId + '" id="wbsRows_' + rId + '" value="1" />' +
        '</td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="conQty_' + rId + '"  onchange="return FormatNum(this)" id="conQty_' + rId + '" onclick="return showDiv(this, \'m\', \'\');" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conAmount_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conOtHrs_' + rId + '" id="conOtHrs_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conOtAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conOtAmount_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conNetAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conNetAmount_' + rId + '" readonly /></td>' +
        '<td width="10%" align="center" class="action_btns_td">' +
        '<ul class="action_btns">' +
        '<li>' +
        '<a id="showDivId_' + rId + '" href="javascript:void(0);" class="mainTr" onclick="return showDiv(this, \'m\', \'\');" style="display:none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines"></i></a>' +
        '</li>' +
        '<li>' +
        '<a href="#" class="conDelete_' + rId + '" onclick="deleteCon(this, event);" id="deleteConTr_' + rId + '" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>' +
        '</li>' +
        '</ul>' +
        '</td>' +
        '</tr>' +
        '<tr id="subRowId_' + rId + '" style="display:none;" class="subTr">' +
        '<td colspan="7" style="padding:0px !important;">' +
        '<div class="subDiv subDiv1" style="display:none;">' +
        '<div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>' +
        '<div class="col-lg-12">' +
        '<div class="table-responsive topsp">' +
        '<table class="table" style="margin-bottom:0px;" id="wbsTable_' + rId + '">' +
        '<thead>' +
        '<tr>' +
        '<th>WBS Name</th>' +
        '<th class="text-right">Total Qty</th>' +
        '<th class="text-right">Amount</th>' +
        '<th class="text-right">OT Hrs</th>' +
        '<th class="text-right">OT Amount</th>' +
        '<th class="text-right">Net Amount</th>' +
        '<th>&nbsp;</th>' +
        '</tr>' +
        '</thead>' +
        '<tbody>' +
        '</tbody>' +
        '</table>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</td>' +
        '</tr>';

        return conData;
    }

    function addLineConwithoutwbs(rId,type) {
        var conData = '';
        conData += '<tr id="rowId_' + rId + '">' +
        '<td width="20%">' +
        '<input class="parent_text conSuggest" type="text" name="conName_' + rId + '" id="conName_' + rId + '" onclick="return showDiv(this, \'mwbs\', \'\');" onfocus="return checkConUsed(this);" />' +
        '<input type="hidden" class="conclass" name="conId_' + rId + '" id="conId_' + rId + '" />' +'<input type="hidden" name="grpvendortype_' + rId + '" id="grpvendortype_' + rId + '" value="'+type+'" />'+
        '<input type="hidden" name="labRows_' + rId + '" id="labRows_' + rId + '" value="1" />' +
        '</td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="conQty_' + rId + '"  onchange="return FormatNum(this)" id="conQty_' + rId + '"  readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conAmount_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conOtHrs_' + rId + '" id="conOtHrs_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conOtAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conOtAmount_' + rId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="conNetAmount_' + rId + '" onchange="return FormatNum(this, 2)" id="conNetAmount_' + rId + '" readonly /></td>' +
        '<td width="10%" align="center" class="action_btns_td">' +
        '<ul class="action_btns">' +
        '<li>' +
        '<a id="showDivId_' + rId + '" href="javascript:void(0);" class="mainTr" onclick="return showDiv(this, \'mwbs\', \'\');" style="display:none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines"></i></a>' +
        '</li>' +
        '<li>' +
        '<a href="#" class="conDelete_' + rId + '" onclick="deleteCon(this, event);" id="deleteConTr_' + rId + '" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>' +
        '</li>' +
        '</ul>' +
        '</td>' +
        '</tr>'+
        '<tr id="subRowRowId_' + rId + '" style="display:none;" class="subTr">' +
        '<td colspan="7" style="padding:0px !important;">' +
        '<div class="subDiv subDiv2" style="display:none;">' +
        '<div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>' +
        '<div class="col-lg-12">' +
        '<div class="table-responsive topsp">' +
        '<table class="table" style="margin-bottom:0px;" id="labTable_' + rId + '">' +
        '<thead>' +
        '<tr>' +
        '<th>Labour Type Name</th>' +
        '<th>Qty</th>' +
        '<th>Rate</th>' +
        '<th>Amount</th>' +
        '<th>OT Hrs</th>' +
        '<th class="text-right">OT Rate</th>' +
        '<th class="text-right">OT Amount</th>' +
        '<th class="text-right">Total Amount</th>' +
        '<th>&nbsp;</th>' +
        '</tr>' +
        '</thead>' +
        '<tbody>' +
        '</tbody>' +
        '</table>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</td>' +
        '</tr>';


        return conData;
    }
    function addLineWbs(conId, rId, trId) {
        var wbsData = '';
        if (trId == '') {
            var trId = 1;
        }

        wbsData += '<tr id="subRowRowId_' + conId + '_' + trId + '">' +
        '<td width="20%">' +
        '<input class="parent_text wbsSuggest" type="text" name="wbsName_' + conId + '_' + trId + '" id="wbsName_' + conId + '_' + trId + '" onfocus="return checkWbsUsed(this, \'' + conId + '\', \'' + rId + '\', \'' + trId + '\');" />' +
        '<input type="hidden" name="wbsId_' + conId + '_' + trId + '" id="wbsId_' + conId + '_' + trId + '" />' +
        '<input type="hidden" name="labRows_' + conId + '_' + trId + '" id="labRows_' + conId + '_' + trId + '" value="1" />' +
        '</td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="wbsQty_' + conId + '_' + trId + '" onchange="return FormatNum(this, 3)" id="wbsQty_' + conId + '_' + trId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="wbsAmount_' + conId + '_' + trId + '" onchange="return FormatNum(this, 2)" id="wbsAmount_' + conId + '_' + trId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="wbsOtHrs_' + conId + '_' + trId + '" id="wbsOtHrs_' + conId + '_' + trId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="wbsOtAmount_' + conId + '_' + trId + '" onchange="return FormatNum(this, 2)" id="wbsOtAmount_' + conId + '_' + trId + '" readonly /></td>' +
        '<td width="15%"><input class="parent_text text-right" type="text" name="wbsNetAmount_' + conId + '_' + trId + '" onchange="return FormatNum(this, 2)" id="wbsNetAmount_' + conId + '_' + trId + '" readonly /></td>' +
        '<td width="10%" align="center" class="action_btns_td">' +
        '<ul class="action_btns">' +
        '<li>' +
        '<a id="showDivSubId_' + conId + '_' + trId + '" href="javascript:void(0);" class="mainTr" onclick="return showDiv(this, \'s\', \'' + conId + '\');" style="display:none;"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left" data-original-title="Add lines" ></i></a>' +
        '</li>' +
        '<li>' +
        '<a href="#" class="wbsDelete_' + conId + '_' + trId + '" id="deleteWbsTr_' + conId + '_' + trId + '" onclick="deleteWbs(this, event, \'' + conId + '\', \'' + rId + '\');" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>' +
        '</li>' +
        '</ul>' +
        '</td>' +
        '</tr>' +
        '<tr id="subRowSubRowId_' + conId + '_' + trId + '" style="display:none;" class="subTr">' +
        '<td colspan="7" style="padding:0px !important;">' +
        '<div class="subDiv subDiv2" style="display:none;">' +
        '<div class="col-lg-12 col-lg-offset-0 rdbt" style="margin-top:5px;"></div>' +
        '<div class="col-lg-12">' +
        '<div class="table-responsive topsp">' +
        '<table class="table" style="margin-bottom:0px;" id="labTable_' + conId + '_' + trId + '">' +
        '<thead>' +
        '<tr>' +
        '<th>Labour Type Name</th>' +
        '<th>Qty</th>' +
        '<th>Rate</th>' +
        '<th>Amount</th>' +
        '<th>OT Hrs</th>' +
        '<th class="text-right">OT Rate</th>' +
        '<th class="text-right">OT Amount</th>' +
        '<th class="text-right">Total Amount</th>' +
        '<th>&nbsp;</th>' +
        '</tr>' +
        '</thead>' +
        '<tbody>' +
        '</tbody>' +
        '</table>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</td>' +
        '</tr>';

        return wbsData;
    }

    function addLineLabour(conId, wbsId, rId, mId, thisId) {
        var labourData = '';
        if (thisId == '') {
            var thisId = 1;
        }
        labourData += '<tr>' +
        '<td width="15%"><input type="hidden" name="labId_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="labId_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" value="" /><input class="parent_text labTypeSuggest" type="text" name="labName_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="labName_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onfocus="return checkLabTypeUsed(this, \'' + conId + '\', \'' + wbsId + '\', \'' + mId + '\', \'' + rId + '\');" /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" maxlength="5" name="labQty_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="labQty_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return pushMainQty(this.id)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmount(\'' + conId + '\', \'' + wbsId + '\', \'' + rId + '\', \'' + mId + '\', \'' + thisId + '\');"/></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labRate_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" maxlength="5" id="labRate_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmount(\'' + conId + '\', \'' + wbsId + '\', \'' + rId + '\', \'' + mId + '\', \'' + thisId + '\');" onfocus="return showtip(\'' + conId + '\', \'' + wbsId + '\', \'' + rId + '\', \'' + mId + '\', \'' + thisId + '\');" /><div id="labtip_' + thisId + '" style="position:relative;display:none;"><div class="top-tip top-addtip "><span>Approval Rate : <i  id="apptiptext_' + thisId + '"></i></span><span>Project Rate : <i  id="prjtiptext_' + thisId + '"></i></span><span>Library Rate : <i  id="libtiptext_' + thisId + '"></i></span>' +
        '</div></div><input type="hidden" id="amt_' + thisId + '"></td>' +
        '<td width="13%"><input class="parent_text text-right" type="text" name="labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return FormatNum(this, 2)" id="labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" readonly /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '"  onkeypress="return isDecimal(event,this);" onchange="return pushMainQtyOT(this.id)" onblur="return calSumAmount(\'' + conId + '\', \'' + wbsId + '\', \'' + rId + '\', \'' + mId + '\', \'' + thisId + '\');" /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmount(\'' + conId + '\', \'' + wbsId + '\', \'' + rId + '\', \'' + mId + '\', \'' + thisId + '\');" /></td>' +
        '<td width="13%"><input class="parent_text text-right" type="text" name="labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return FormatNum(this, 2)" id="labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" readonly /></td>' +
        '<td width="14%"><input class="parent_text text-right" type="text" name="labNetAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onchange="return FormatNum(this, 2)" id="labNetAmount_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" readonly /></td>' +
        '<td width="10%" align="center" class="action_btns_td">' +
        '<ul class="action_btns">' +
        '<li>' +
        '<a href="#" class="labDelete_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" id="deleteLabTr_' + conId + '_' + wbsId + '_' + rId + '_' + thisId + '" onclick="deleteWbsLab(this, event, \'' + conId + '\', \'' + wbsId + '\', \'' + mId + '\', \'' + rId + '\');" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>' +
        '</li>' +
        '</ul>' +
        '</td>' +
        '</tr>';
        return labourData;
    }
    function addLineLabourwithoutwbs(conId,lab) {
        var labourData = '';
        if (thisId == '') {
            var thisId = 1;
        }

        labourData += '<tr>' +
        '<td width="15%"><input type="hidden" name="labId_' + conId + '_'+lab+'" id="labId_' + conId + '_'+lab+'" value="" /><input class="parent_text labTypeSuggest" type="text" name="labName_' + conId + '_'+lab+'" id="labName_' + conId + '_'+lab+'" onfocus="return checkLabTypeUsedwithoutwbs(this, \'' + conId + '\');" /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" maxlength="5" name="labQty_' + conId + '_'+lab+'" id="labQty_' + conId + '_'+lab+'" onchange="return pushMainQty(this.id)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmountwithoutwbs(\'' + conId + '\', \'' + lab + '\');"/></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labRate_' + conId + '_'+lab+'" maxlength="5" id="labRate_' + conId + '_'+lab+'" onchange="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmountwithoutwbs(\'' + conId + '\', \'' + lab + '\');" onfocus="return showtipwithoutwbs(\'' + conId + '\', \'' + lab + '\');" /><div id="labtip_' + conId + '_'+lab+'" style="position:relative;display:none;"><div class="top-tip top-addtip">' +
        '<span>Approval Rate : <i  id="apptiptext_' + conId + '_'+lab+'"></i></span><span>Project Rate : <i  id="prjtiptext_' + conId + '_'+lab+'"></i></span><span>Library Rate : <i  id="libtiptext_' + conId + '_'+lab+'"></i></span>' +
        '</div></div><input type="hidden" id="amt_' + conId + '_'+lab+'"></td>' +
        '<td width="13%"><input class="parent_text text-right" type="text" name="labAmount_' + conId + '_'+lab+'" onchange="return FormatNum(this, 2)" id="labAmount_' + conId + '_'+lab+'" readonly /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labOtHrs_' + conId + '_'+lab+'" id="labOtHrs_' + conId + '_'+lab+'"  onkeypress="return isDecimal(event,this);" onchange="return pushMainQtyOT(this.id)" onblur="return calSumAmountwithoutwbs(\'' + conId + '\', \'' + lab + '\');" /></td>' +
        '<td width="10%"><input class="parent_text text-right" type="text" name="labOtRate_' + conId + '_'+lab+'" id="labOtRate_' + conId + '_'+lab+'" onchange="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this);" onblur="return calSumAmountwithoutwbs(\'' + conId + '\', \'' + lab + '\');" /></td>' +
        '<td width="13%"><input class="parent_text text-right" type="text" name="labOtAmount_' + conId + '_'+lab+'" onchange="return FormatNum(this, 2)" id="labOtAmount_' + conId + '_'+lab+'" readonly /></td>' +
        '<td width="14%"><input class="parent_text text-right" type="text" name="labNetAmount_' + conId + '_'+lab+'" onchange="return FormatNum(this, 2)" id="labNetAmount_' + conId + '_'+lab+'" readonly /></td>' +
        '<td width="10%" align="center" class="action_btns_td">' +
        '<ul class="action_btns">' +
        '<li>' +
        '<a href="#" class="labDelete_' + conId + '_'+lab+'" id="deleteLabTr_' + conId + '_'+lab+'" onclick="deleteWbsLab(this, event, \'' + conId + '\', \'' + lab + '\');" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>' +
        '</li>' +
        '</ul>' +
        '</td>' +
        '</tr>';
        return labourData;
    }
    function calSumAmount(conId, wbsId, rId, mId, resId) {

        var labAmt = 0,
            labOtAmt = 0,
            labNetAmt = 0;

        if ($('#labQty_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '' && $('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '') {
            var labAmt = parseFloat($('#labQty_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val()) * parseFloat($('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val());
        }
        $('#labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val(labAmt).trigger('change');

        if ($('#labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '' && $('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '') {
            var labOtAmt = parseFloat($('#labOtHrs_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val()) * parseFloat($('#labOtRate_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val());
        }
        $('#labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val(labOtAmt).trigger('change');

        if ($('#labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '' && $('#labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val() != '') {
            var labNetAmt = parseFloat($('#labAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val()) + parseFloat($('#labOtAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val());
        }
        $('#labNetAmount_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val(labNetAmt).trigger('change');

        var $labQty = $('input[id^=labQty_' + conId + '_' + wbsId + '_]');
        var sumLabQty = 0;
        $.each($labQty, function () {
            var lQty = parseFloat($(this).val());

            if (isNaN(lQty))
                return;

            sumLabQty += lQty;
        });
        $('#wbsQty_' + conId + '_' + rId).val(sumLabQty).trigger('change');

        var $labAmt = $('input[id^=labAmount_' + conId + '_' + wbsId + '_]');
        var sumLabAmt = 0;
        $.each($labAmt, function () {
            var lAmt = parseFloat($(this).val());

            if (isNaN(lAmt))
                return;

            sumLabAmt += lAmt;
        });
        $('#wbsAmount_' + conId + '_' + rId).val(sumLabAmt).trigger('change');

        var $labOt = $('input[id^=labOtHrs_' + conId + '_' + wbsId + '_]');
        var sumLabOt = 0;
        $.each($labOt, function () {
            var lOt = parseFloat($(this).val());

            if (isNaN(lOt))
                return;

            sumLabOt += lOt;
        });
        $('#wbsOtHrs_' + conId + '_' + rId).val(sumLabOt).trigger('change');

        var $labOtAmt = $('input[id^=labOtAmount_' + conId + '_' + wbsId + '_]');
        var sumLabOtAmt = 0;
        $.each($labOtAmt, function () {
            var lOtAmt = parseFloat($(this).val());

            if (isNaN(lOtAmt))
                return;

            sumLabOtAmt += lOtAmt;
        });
        $('#wbsOtAmount_' + conId + '_' + rId).val(sumLabOtAmt).trigger('change');

        var $labNetAmt = $('input[id^=labNetAmount_' + conId + '_' + wbsId + '_]');
        var sumLabNetAmt = 0;
        $.each($labNetAmt, function () {
            var lNetAmt = parseFloat($(this).val());

            if (isNaN(lNetAmt))
                return;

            sumLabNetAmt += lNetAmt;
        });
        $('#wbsNetAmount_' + conId + '_' + rId).val(sumLabNetAmt).trigger('change');

        var $wbsQty = $('input[id^=wbsQty_' + conId + '_]');
        var sumWbsQty = 0;
        $.each($wbsQty, function () {
            var wQty = parseFloat($(this).val());

            if (isNaN(wQty))
                return;

            sumWbsQty += wQty;
        });
        $('#conQty_' + mId).val(sumWbsQty).trigger('change');

        var $wbsAmt = $('input[id^=wbsAmount_' + conId + '_]');
        var sumWbsAmt = 0;
        $.each($wbsAmt, function () {
            var wAmt = parseFloat($(this).val());

            if (isNaN(wAmt))
                return;

            sumWbsAmt += wAmt;
        });
        $('#conAmount_' + mId).val(sumWbsAmt).trigger('change');

        var $wbsOt = $('input[id^=wbsOtHrs_' + conId + '_]');
        var sumWbsOt = 0;
        $.each($wbsOt, function () {
            var wOt = parseFloat($(this).val());

            if (isNaN(wOt))
                return;

            sumWbsOt += wOt;
        });
        $('#conOtHrs_' + mId).val(sumWbsOt).trigger('change');

        var $wbsOtAmt = $('input[id^=wbsOtAmount_' + conId + '_]');
        var sumWbsOtAmt = 0;
        $.each($wbsOtAmt, function () {
            var wOtAmt = parseFloat($(this).val());

            if (isNaN(wOtAmt))
                return;

            sumWbsOtAmt += wOtAmt;
        });
        $('#conOtAmount_' + mId).val(sumWbsOtAmt).trigger('change');

        var $wbsNetAmt = $('input[id^=wbsNetAmount_' + conId + '_]');
        var sumWbsNetAmt = 0;
        $.each($wbsNetAmt, function () {
            var wNetAmt = parseFloat($(this).val());

            if (isNaN(wNetAmt))
                return;

            sumWbsNetAmt += wNetAmt;
        });
        $('#conNetAmount_' + mId).val(sumWbsNetAmt).trigger('change');
        $('#labtip_' + resId).hide();
        var con = conId + "_" + wbsId + "_" + rId + "_" + mId + "_" + resId;
        var textvalue = parseFloat($("#tiptext_" + resId).text());
        var orgval = parseFloat($('#labRate_' + conId + '_' + wbsId + '_' + rId + '_' + resId).val());
        if (orgval > textvalue) {
            alert("Rate should not exceed original rate");
            $("#labRate_" + conId + '_' + wbsId + '_' + rId + '_' + resId).addClass('error');
            $("#labRate_" + conId + '_' + wbsId + '_' + rId + '_' + resId).val('');

        }
        else {
            $("#labRate_" + conId + '_' + wbsId + '_' + rId + '_' + resId).removeClass('error');
        }
        caltotalvaluecontractor();
    }
    /* For Contractor */
    function caltotalvaluecontractor()
    {
        var $conqty = $('input[id^=conQty_');
        var $conamount= $('input[id^=conAmount_');
        var $conothrs=$('input[id^=conOtHrs_');
        var $conotamt=$('input[id^=conOtAmount_');
        var $connetamt=$('input[id^=conNetAmount_');
        var cqty=0,camt=0,cothrs=0,cotamt=0,cnetamt=0,
            contotal=0,
            conamttotal=0,conothrs=0,conotamt=0,connetamt=0;

        $.each($conqty, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];
            cqty=$('#conQty_'+key1).val();
            contotal=parseFloatVal(cqty) +parseFloatVal(contotal);

            camt=$('#conAmount_'+key1).val();
            conamttotal=parseFloatVal(camt) +parseFloatVal(conamttotal);

            cothrs=$('#conOtHrs_'+key1).val();
            conothrs=parseFloatVal(cothrs) +parseFloatVal(conothrs);


            cotamt=$('#conOtAmount_'+key1).val();
            conotamt=parseFloatVal(cotamt) +parseFloatVal(conotamt);

            cnetamt=$('#conNetAmount_'+key1).val();
            connetamt=parseFloatVal(cnetamt) +parseFloatVal(connetamt);
        });
        $('#contractornetamount').val(sanitizeNumber(connetamt,2,true));
        $('#contractorotamount').val(sanitizeNumber(conotamt,2,true));
        $('#contractorothrs').val(conothrs);
        $('#amtcontractor').val(sanitizeNumber(conamttotal,2,true));
        $('#totalconqty').val(contotal);
    }
    /* For Labour */
    bindTimePicker();
    bindLabourAutoComplete();
    bindLabourWbsAutoComplete();
    function calSumAmountwithoutwbs(conid,labid) {

        var labAmt = 0,
            labOtAmt = 0,
            labNetAmt = 0;


        if ($('#labQty_' + conid + '_' + labid ).val() != '' && $('#labRate_' + conid + '_' + labid ).val() != '') {
            var labAmt = parseFloat($('#labQty_' + conid + '_' + labid ).val()) * parseFloat($('#labRate_' + conid + '_' + labid ).val());
        }
        $('#labAmount_' + conid + '_' + labid).val(labAmt).trigger('change');

        if ($('#labOtHrs_' + conid + '_' + labid ).val() != '' && $('#labOtRate_' + conid + '_' + labid ).val() != '') {
            var labOtAmt = parseFloat($('#labOtHrs_' + conid + '_' + labid ).val()) * parseFloat($('#labOtRate_' + conid + '_' + labid ).val());
        }
        $('#labOtAmount_' + conid + '_' + labid ).val(labOtAmt).trigger('change');


        if ($('#labAmount_' + conid + '_' + labid ).val() != '' && $('#labOtAmount_' + conid + '_' + labid).val() != '') {
            var labNetAmt = parseFloat($('#labAmount_' + conid + '_'+labid).val()) + parseFloat($('#labOtAmount_' + conid + '_' +labid).val());
        }
        $('#labNetAmount_' + conid + '_' + labid).val(labNetAmt).trigger('change');


        var $labQty = $('input[id*=labQty_' + conid +'_]');
        var sumLabQty = 0;
        $.each($labQty, function () {
            var lQty = parseFloat($(this).val());

            if (isNaN(lQty))
                return;

            sumLabQty += lQty;
        });
        $('#conQty_'+ conid ).val(sumLabQty).trigger('change');

        var $labAmt1 = $('input[id*=labAmount_' + conid+'_]');
        var sumLabAmt = 0;
        $.each($labAmt1, function () {
            var lAmt = parseFloat($(this).val());

            if (isNaN(lAmt))
                return;

            sumLabAmt += lAmt;
        });
        $('#conAmount_' + conid ).val(sumLabAmt).trigger('change');

        var $labOt = $('input[id*=labOtHrs_' + conid +'_]');
        var sumLabOt = 0;
        $.each($labOt, function () {
            var lOt = parseFloat($(this).val());

            if (isNaN(lOt))
                return;

            sumLabOt += lOt;
        });
        $('#conOtHrs_' + conid ).val(sumLabOt).trigger('change');


        var $labOtAmt = $('input[id^=labOtAmount_' + conid +'_]');
        var sumLabOtAmt = 0;
        $.each($labOtAmt, function () {
            var lOtAmt = parseFloat($(this).val());

            if (isNaN(lOtAmt))
                return;

            sumLabOtAmt += lOtAmt;
        });
        $('#conOtAmount_' + conid ).val(sumLabOtAmt).trigger('change');

        var $labNetAmt = $('input[id*=labNetAmount_' + conid + '_]');
        var sumLabNetAmt = 0;
        $.each($labNetAmt, function () {
            var lNetAmt = parseFloat($(this).val());

            if (isNaN(lNetAmt))
                return;

            sumLabNetAmt += lNetAmt;
        });
        $('#conNetAmount_' + conid ).val(sumLabNetAmt).trigger('change');
        $('#labtip_' + conid + '_' + labid).hide();
        var textvalue = parseFloat($('#tiptext_' + conid + '_' + labid).text());
        var orgval = parseFloat($('#labRate_' + conid + '_' + labid).val());
        if (orgval > textvalue) {
            alert("Rate should not exceed original rate");
            $('#labRate_' + conid + '_' + labid).addClass('error').val('');
        }
        else {
            $('#labRate_' + conid + '_' + labid).removeClass('error');
        }
        caltotalvaluecontractor();
    }

    function addLabConlabRow(x) {
        var $x =x
        $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[1];
        if ($tr.next('tr').length != 0)
            return;
        var key =x;

        if ($('#labConName_' + key).val().length == 0 && $('#labConId_' + key).val().length == 0)
            return;

        var $rowid = $('#labConRows'),
            count = parseInt($rowid.val()) + 1,
            template = $('#dummy-labour tbody').html();

        template = template.replace(/__1/g, '_' + count);
        $tr.parent('tbody').append(template);
        $rowid.val(count);
        $('.labConDelete_' + key).show();
        bindLabourAutoComplete();
        bindLabourWbsAutoComplete();
        bindTimePicker();
    }
    function addLabConRow(x) {
        var key = x.split('_')[1];
        var $rowid = $('#labConRows'),
            count = parseInt($rowid.val()) + 1,
            template = $('#dummy-labour tbody').html();
        template = template.replace(/__1/g, '_' + count);
        $("#wlabTable  tbody tr:last").after(template);
        $rowid.val(count);
        $('.labConDelete_' + key).show();
        bindLabourAutoComplete();
        bindLabourWbsAutoComplete();
        bindTimePicker();
    }

    function deleteLabCon(x, e) {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        var key = $(x)[0].className.split('_')[1],
            ilabourId = $('#labConId_' + key).val();

        var objcom = $.grep(arrLabourAttn, function (element, index) {
            return element.LabourId != ilabourId;});

        arrLabourAttn = [];
        arrLabourAttn =objcom;

        if ($tbody.find('> tr').length == 1) {
            var template = $('#dummy-labour tbody').html();
            template = template.replace(/__1/g, '_' + 1);
            $tbody.append(template);
            $('#labConRows').val(1);
        }

        $tr.remove();
        return false;
    }

    function insertLabConRow() {
        var $rowid = $('#labConRows'),
            count = parseInt($rowid.val()) + 1,
            template = $('#dummy-labour tbody').html();

        template = template.replace(/__1/g, '_' + count);
        $('#wlabTable tbody').append(template);
        $rowid.val(count);
        bindLabourAutoComplete();
        bindLabourWbsAutoComplete();
        bindTimePicker();
    }

    function bindLabourAutoComplete() {

        $('#wlabTable .labSuggest').autocomplete({
            lookup: tmp_dlabourList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[1];
                    $this.prop('readonly', true).addClass('border-none');

                    $('#labConId_' + key1).val(suggestion.data);
                    addLabConRow($this[0].id);
                    pushAttn($this[0].id);
                    removeError($(this));
                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];

                $('#labConId_' + key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }

    function checkLabUsed(x) {
        var id = $(x)[0].id.split('_')[1];
        var reskeyid = $('input[id*=labConId_]');
        tmp_dlabourList = tmp_newlabourList;
        tmp_dlabourList = $.grep(tmp_newlabourList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindLabourAutoComplete();
        bindLabourWbsAutoComplete();
        bindTimePicker();
    }

    function bindLabourWbsAutoComplete() {
        var $labWbsConName = $('input[id^=labWbsName_]');
        $labWbsConName.unbind('autocomplete');
        $.each($labWbsConName, function () {
            var $this = $(this),
                name = $this[0].id;
            if (name.indexOf('__') != -1 || name.indexOf('excel') != -1) return;
            var arrname = name.split('_');
            var key1 = arrname[1];

            $this.autocomplete({
                lookup: wbsList,
                lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                    if (queryLowerCase == '*') {
                        return suggestion.value;
                    } else {
                        var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                        return re.test(suggestion.value);
                    }
                }, onSelect: function (suggestion) {
                    if (suggestion) {
                        $('#labWbsId_' + key1).val(suggestion.data);
                        removeError($(this));
                        pushAttn('labWbsId_' + key1);
                    }
                }, onSearchStart: function (suggestion) {
                    $('#labWbsId_' + key1).val('');
                }, onSearchComplete: function (query, suggestions) {
                    if (!suggestions.length) {
                        $(this).addClass('error');
                    } else
                        removeError($(this));
                }
            });
        });
    }
    function seqlabwbsselection(id) {
        //console.log(wbsList);
        $('#sequential-labourtable .typeSuggest').autocomplete({
            lookup: wbsList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            },
            onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var rowid = $this[0].id.split('_')[1];
                    $('#wbsid_' + rowid).val(suggestion.data);
                    $('#wbsname_' + rowid).val(suggestion.value);

                }
            },
            onSearchStart: function (suggestion) {
                var rowid = $(this)[0].id.split('_')[1];
                $('#wbsid_' + rowid).val('');


            },
            onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    var rowid = $(this)[0].id.split('_')[1];
                    $('#wbsid_' + rowid).val('');
                }
            }
        });
    }
    function calInOutTime(labRowId) {
        var lbrId = labRowId.split('_'),
            roId = lbrId[1],
            labConQty = 0,
            labConOtHrs = 0,
            defHour = 8,
            toDate = $('#labConDate_' + roId).val() + ' ',
            inTime = $('#labConInTime_' + roId).val(),
            outTime = $('#labConOutTime_' + roId).val();

        var totalHour = ( ( Date.parse(toDate + outTime) - Date.parse(toDate + inTime) ) / 1000 / 60 ) / 60;
        if (totalHour == defHour) {
            labConQty = 1;
        } else if (totalHour > defHour) {
            labConQty = 1;
            labConOtHrs = totalHour - defHour;
        } else if (totalHour < defHour) {
            labConOtHrs = totalHour;
        }

        $('#labConQty_' + roId).val(labConQty);
        $('#labConOtHrs_' + roId).val(labConOtHrs);
        pushAttn(labRowId);
        callabourtotal();
    }

    function calLabSumAmount(labRowId) {
        var lbrId = labRowId.split('_'),
            roId = lbrId[1],
            labConQty = 0,
            labConRate = 0,
            labConAmt = 0,
            labConOtHrs = 0,
            labConOtRate = 0,
            labConOtAmt = 0,
            labConNetAmt = 0;

        if (!$('#labConQty_' + roId).val() == '') {
            labConQty = $('#labConQty_' + roId).val();
        }
        if (!$('#labConRate_' + roId).val() == '') {
            labConRate = $('#labConRate_' + roId).val();
        }
        if (!$('#labConOtHrs_' + roId).val() == '') {
            labConOtHrs = $('#labConOtHrs_' + roId).val();
        }
        if (!$('#labConOtRate_' + roId).val() == '') {
            labConOtRate = $('#labConOtRate_' + roId).val();
        }

        var labConAmt = parseFloat(labConQty) * parseFloat(labConRate);
        $('#labConAmount_' + roId).val(labConAmt).trigger('change');

        var labConOtAmt = parseFloat(labConOtHrs) * parseFloat(labConOtRate);
        $('#labConOtAmount_' + roId).val(labConOtAmt.toFixed(2)).trigger('change');

        var labConNetAmt = parseFloat($('#labConAmount_' + roId).val()) + parseFloat($('#labConOtAmount_' + roId).val());
        $('#labConNetAmount_' + roId).val(labConNetAmt.toFixed(2)).trigger('change');
        callabourtotal();
    }
    function callabourtotal()
    {
        var $labourdattotal = $('input[id^=labConQty_');
        var labday=0,labconrate=0,labconamt=0,labconothrs=0,labconotrate=0,labconotamt=0,labconotnetamt=0,labconotnetamttotal=0,
            labdaytotal=0,labconratetotal=0,labconamttotal=0,labconothrstotal=0,labconotratetotal=0,labconotamttotal=0;
        $.each($labourdattotal, function (i, obj) {
            var $this = $(this),
                name = $this[0].id;
            var arrname = name.split('_');
            var key1 = arrname[1];

            labday=$('#labConQty_'+key1).val();
            labdaytotal=parseIntVal(labday) +parseIntVal(labdaytotal);

            labconrate=isNullCheck($('#labConRate_'+key1).val(),'number');
            labconratetotal=parseFloatVal(labconrate) +parseFloatVal(labconratetotal);

            labconamt=isNullCheck($('#labConAmount_'+key1).val(),'number');
            labconamttotal=parseFloatVal(labconamt) +parseFloatVal(labconamttotal);

            labconothrs=isNullCheck($('#labConOtHrs_'+key1).val(),'number');
            labconothrstotal=parseFloatVal(labconothrs) +parseFloatVal(labconothrstotal);

            labconotrate=isNullCheck($('#labConOtRate_'+key1).val(),'number');
            labconotratetotal=parseFloatVal(labconotrate) +parseFloatVal(labconotratetotal);

            labconotamt=isNullCheck($('#labConOtAmount_'+key1).val(),'number');
            labconotamttotal=parseFloatVal(labconotamt) +parseFloatVal(labconotamttotal);

            labconotnetamt=isNullCheck($('#labConNetAmount_'+key1).val(),'number');
            labconotnetamttotal=parseFloatVal(labconotnetamt) +parseFloatVal(labconotnetamttotal);

        });
        $('#netamttotal').val(sanitizeNumber(labconotnetamttotal,2,true));
        $('#otamttotal').val(sanitizeNumber(labconotamttotal,2,true));
        $('#otratetotal').val(labconotratetotal);
        $('#othrstotal').val(labconothrstotal);
        $('#amttotal').val(sanitizeNumber(labconamttotal,2,true));
        $('#daytotal').val(labdaytotal);
        $('#ratetotal').val(labconratetotal);
    }
    function bindTimePicker() {
        $(".time_picker").timepicker({
            timeFormat: 'hh:mm',
            autoclose: true
        });
    }
    /* For Labour */

    /* For Contractor */
    <?php if(isset($lsVendorTrans) && count($lsVendorTrans) != 0) { ?>
    continueForm('c', 'e');
    <?php $k = 1;
foreach($lsVendorTrans as $lsvTrans) {
$lsvTransId = $lsvTrans['LSVendorTransId'];
$conId = $lsvTrans['VendorId'];
?>
    bindWbsAutoComplete('<?php echo $lsvTrans['VendorId']; ?>', '<?php echo $k; ?>', '');
    <?php
$jj = 1;
foreach($lsWbsTrans as $lswTrans) {
if($lswTrans['LSVendorTransId'] == $lsvTransId) {
$wbsId = $lswTrans['WBSId'];
?>
    var cconId = '<?php echo $conId; ?>';
    var rrId = '<?php echo $jj; ?>';
    var ccount = parseInt($('#labRows_' + cconId + '_' + rrId).val());
    $('#labTable_' + cconId + '_' + rrId + ' tbody').append(addLineLabour('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $jj; ?>', '<?php echo $k; ?>', ccount));
    bindLabTypeAutoComplete('<?php echo $conId; ?>', '<?php echo $wbsId; ?>', '<?php echo $k; ?>', '<?php echo $jj; ?>');
    <?php
$jj++;
}
}
$k++;
} ?>
    <?php } ?>
    /* For Contractor */

    /* For Labour */
    <?php if(isset($lsLabourTrans) && count($lsLabourTrans) != 0) { ?>
    insertLabConRow();
    hideWbsFn();
    continueForm('l', '');
    $('.cancel_btn').hide();
    <?php } ?>
    /* For Labour */

    $('#mtWbs').on('change', function () {
        hideWbsFn();
    });

    function hideWbsFn() {
        var isWbsChecked = $("input[name='mtWbs']:checked").val();
        if (isWbsChecked == 1) {
            $('.hideWbs').show();
        } else {
            $('.hideWbs').hide();
        }
    }
    <?php
if(isset($lsVendorTrans) && count($lsVendorTrans) != 0) { ?>
    $("#mtwbsseq").show();
    $("#mtLabourseq").hide();
    caltotalvaluecontractor();
    <?php } ?>
    <?php
if(isset($lsVendorTrans) && count($lsVendorTrans) != 0) {
$i = 1;
foreach($lsVendorTrans as $lsvTrans) {
$lsvTransId = $lsvTrans['LSVendorTransId'];
$conId = $lsvTrans['VendorId'];
?>
    $('#conQty_<?php echo $i; ?>').trigger('change');
    $('#conAmount_<?php echo $i; ?>').trigger('change');
    $('#conOtAmount_<?php echo $i; ?>').trigger('change');
    $('#conNetAmount_<?php echo $i; ?>').trigger('change');
    <?php
$j = 1;
foreach($lsWbsTrans as $lswTrans) {
if($lswTrans['LSVendorTransId'] == $lsvTransId) {
$lswTransId = $lswTrans['LSWBSTransId'];
$wbsId = $lswTrans['WBSId'];
?>
    $('#wbsQty_<?php echo $conId; ?>_<?php echo $j; ?>').trigger('change');
    $('#wbsAmount_<?php echo $conId; ?>_<?php echo $j; ?>').trigger('change');
    $('#wbsOtAmount_<?php echo $conId; ?>_<?php echo $j; ?>').trigger('change');
    $('#wbsNetAmount_<?php echo $conId; ?>_<?php echo $j; ?>').trigger('change');
    <?php
$kk = 1;
foreach($lsTypeTrans as $lstTrans) {
if($lstTrans['LSVendorTransId'] == $lsvTransId && $lstTrans['LSWBSTransId'] == $lswTransId) {
?>
    $('#labQty_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');
    $('#labRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');
    $('#labAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');
    $('#labOtRate_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');
    $('#labOtAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');
    $('#labNetAmount_<?php echo $conId; ?>_<?php echo $wbsId; ?>_<?php echo $j; ?>_<?php echo $kk; ?>').trigger('change');

    <?php
$kk++;
}
}
?>
    <?php
$j++;
}
}
?>
    <?php $i++;}?>
    <?php }?>

    <?php
if(isset($lsLabourTrans) && count($lsLabourTrans) != 0) {
$i = 1;

foreach($lsLabourTrans as $lslTrans) {
?>
    $('#labConQty_<?php echo $i; ?>').trigger('change');
    $('#labConRate_<?php echo $i; ?>').trigger('change');
    $('#labConAmount_<?php echo $i; ?>').trigger('change');
    $('#labConOtRate_<?php echo $i; ?>').trigger('change');
    $('#labConOtAmount_<?php echo $i; ?>').trigger('change');
    $('#labConNetAmount_<?php echo $i; ?>').trigger('change');
    <?php $i++;
}

}
?>
    <?php if($lsRegister['Approve']=='Y') { ?>
    $("#submitDiv").hide();
    <?php } ?>
    <?php
if(isset($lsLabourTrans) && count($lsLabourTrans) != 0) { ?>
    $("#mtwbsseq").hide();
    $("#mtLabourseq").show();
    $("#excelDiv").hide();
    $('#div2').show();
    $('#condivs').hide();
    $('#divWithWbs').hide();
    $("#divWithLab").show();

    callabourtotal();
    <?php } ?>
    <?php if(isset($labourId) && $lsRegister['WBSRequired'] == '0' && $typeLs == '') { ?>
    $("#div2").show();
    $("#div1labourlist").hide();
    <?php } ?>

    function showtip(conId, wbsId, rId, mId, thisId) {
        if ($("#labId_" + conId + "_" + wbsId + "_" + rId + "_" + thisId).val() != '') {
            $('#labtip_' + thisId).show();
            var tiporg = $('#tiptext_' + thisId).text();
            //alert(tiporg);

        }
    }
    function showtipwithoutwbs(conId, labid) {
        if ($("#labId_" + conId + "_" + labid ).val() != '') {
            $('#labtip_' + conId + '_' + labid).show();
            var tiporg = $('#tiptext_' + conId + '_' + labid).text();


            $('#labtip_' + conId + '_' + labid).click(function(){
                $(this).hide();
            });

        }
    }

    (function () {
        var demo, fixedTable;

        fixedTable = function (el) {
            var $body, $header, $sidebar;
            $body = $(el).find('.fixedTable-body');
            $sidebar = $(el).find('.fixedTable-sidebar table');
            $header = $(el).find('.fixedTable-header table');
            return $($body).scroll(function () {
                $($sidebar).css('margin-top', -$($body).scrollTop());
                return $($header).css('margin-left', -$($body).scrollLeft());
            });
        };

        demo = new fixedTable($('#demo'));

    }).call(this);
    function checklabour(id) {
        var id = $(id)[0].id;
        var arr = id.split('_');
        if ($("#labcheck_" + arr[1]).is(':checked')) {
            $('#intime_' + arr[1]).attr('readonly', false);
            $('#outtime_' + arr[1]).attr('readonly', false);
        } else {
            $('#intime_' + arr[1]).attr('readonly', true);
            $('#outtime_' + arr[1]).attr('readonly', true);
        }
    }

    function applylabourSequentialValues() {
        var reskeyid = $('input[id*=labcheck_]');
        var browadd=false;
        var $rowid = $('#labConRows');
        var count = parseInt($rowid.val());
        arrLabourAttn = [];
        $.each(reskeyid, function (i, obj) {
            var currentid =this.id.split('_')[1];
            if ($("#labcheck_" + currentid).is(':checked')) {
                var ilabourId = $('#labourid_' + currentid).val(),
                    swbsname = $('#wbsname_' + currentid).val(),
                    iwbsId =$('#wbsid_' + currentid).val(),
                    groupvendorId=$('#groupid_' + currentid).val(),
                    groupvendorname=$('#groupname_' + currentid).val(),
                    intime=$('#intime_' + currentid).val(),
                    outtime=$('#outtime_' + currentid).val(),
                    labourname=$('#labourname_' + currentid).val();

                arrLabourAttn.push({
                    LabourId: ilabourId,
                    WBSId: iwbsId,
                    WBSName: swbsname,
                    InTime: intime,
                    OutTime: outtime
                });

                if (findLabourFound(iwbsId,swbsname,ilabourId,intime,outtime) ==false) {
                    if (count != 1) {
                        var template = $('#dummy-labour tbody').html();
                        template = template.replace(/__1/g, '_' + count);
                        $("#wlabTable  tbody tr:last").after(template);
                    }

                    $('.labConDelete_' + count).show();
                    $('#labConId_' + count).val(ilabourId);
                    $('#labConName_' + count).val(labourname);
                    $('#labConInTime_' + count).val(intime);
                    $('#labConOutTime_' + count).val(outtime);
                    $('#labWbsName_' + count).val(swbsname);
                    $('#labWbsId_' + count).val(iwbsId);
                    browadd = true;
                    $rowid.val(count);
                    count += 1;
                }
            }
        });
        if (browadd ==true) { count -= 1; addLabConRow('labConId_' + count); }
        $('#sequentiallabourViewModal').modal('hide');
    }

    function fillMatrixView() {
        var reskeyid = $('input[id*=labourid_]');
        $.each(reskeyid, function (i, obj) {
            var key =this.id.split('_')[1];
            $("#labcheck_" + key).prop('disabled',false);
            $("#labcheck_" + key).prop('checked',false);
        });

        for (var i in arrLabourAttn) {
            var ilabourId =  arrLabourAttn[i].LabourId,
                iWBSId = arrLabourAttn[i].WBSId,
                sWBSName = arrLabourAttn[i].WBSName,
                dInTime = arrLabourAttn[i].InTime,
                dOutTime = arrLabourAttn[i].OutTime;

            var bFound =false;
            var reskeyid = $('input[id*=labourid_]');
            $.each(reskeyid, function (i, obj) {
                var key =this.id.split('_')[1];
                if($('#labourid_'+key).val() ==ilabourId)
                {
                    $('#wbsname_' + key).val(sWBSName);
                    $('#wbsid_' + key).val(iWBSId);
                    $('#intime_' + key).val(dInTime);
                    $('#outtime_' + key).val(dOutTime);
                    $("#labcheck_" + key).prop('checked',true);
                    $("#labcheck_" + key).prop('disabled',true);
                    return false;
                }
            });
        }
    }

    function pushAttn(id) {
        var key = id.split('_')[1];

        var ilabourId =  $('#labConId_' + key).val(),
            iWBSId = $('#labWbsId_' + key).val(),
            sWBSName = $('#labWbsName_' + key).val(),
            dInTime = $('#labConInTime_' + key).val(),
            dOutTime = $('#labConOutTime_' + key).val();

        var bFound = false;
        for (var i in arrLabourAttn) {
            if (arrLabourAttn[i].LabourId== ilabourId) {
                arrLabourAttn[i].WBSId = iWBSId;
                arrLabourAttn[i].WBSName = sWBSName;
                arrLabourAttn[i].InTime= dInTime;
                arrLabourAttn[i].OutTime= dOutTime;
                bFound = true;
                break;
            }
        }
        if (bFound == false) {
            arrLabourAttn.push({
                LabourId: ilabourId,
                WBSId: iWBSId,
                WBSName: sWBSName,
                InTime: dInTime,
                OutTime: dOutTime
            });
        }
    }

    function findLabourFound(wbsid,swbsname,lid,intime,outtime) {
        var bFound =false;
        var reskeyid = $('input[id*=labConId_]');
        var i =0;
        $.each(reskeyid, function (i, obj) {
            var key =this.id.split('_')[1];

            if($('#labConId_'+key).val() ==lid )
            {
                $('#labWbsName_' + key).val(swbsname);
                $('#labWbsId_' + key).val(wbsid);
                $('#labConInTime_' + key).val(intime);
                $('#labConOutTime_' + key).val(outtime);

                bFound=true;
                return false;
            }

        });

        return bFound;
    }

    function validateName(labournames,typlist)
    {
        var labname = $('input[id^=labWbsName_]');
        $.each(labname, function (i, obj) {
            var key =this.id.split('_')[1];

            var objcom = $.grep(labournames, function (element, index) {
                var labrname=$('#labConName_'+key).val();
                if((element.LabourName != labrname && labrname !='') || labournames =='' )
                {
                    $('#labConName_'+key).addClass('error')
                }

            });
            var objtype = $.grep(typlist, function (element, index) {
                var labtypelist=$('#labWbsName_'+key).val();
                if(element.ResourceName != labtypelist  && labtypelist !='' )
                {
                    $('#labWbsName_'+key).addClass('error')
                }

            });

        });
    }
    function bindexcelmatch() {

        $('#tableexcel .excelmatch').autocomplete({
            lookup:arrayFieldR,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[1];
                    /* $this.prop('readonly', true).addClass('border-none');*/
                    $('#dtField_' + key1).val(key1+'##'+ suggestion.value);

                }
            }, onSearchStart: function (suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];
                $('#dtField_' + key1).val(key1+'##');
            }, onSearchComplete: function (query, suggestions) {
                if (!suggestions.length) {
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });
    }
    // contractor pick list
    function showPickList() {
        var key1 = $('#conRows').val();
        checkConUsedpick(key1);
        bindLtypePickListGrid();
        $("#picklistmodal").modal('show');
    }

    function bindLtypePickListGrid() {
        var parent = $("#withwbsltypepickgrid").parent();
        $("#withwbsltypepickgrid").remove();
        $("<div id='withwbsltypepickgrid'></div>").appendTo(parent);
        var source = {
            localdata: tmp_vendorList,
            dataFields: [
                {name: 'data', type: 'number'},
                {name: 'value', type: 'string'},
                {name: 'IsCheck', type: 'bool'},
                {name: 'type', type: 'string'},
            ],
            dataType: "json"
        };

        var rfcdata = new $.jqx.dataAdapter(source);


        $("#withwbsltypepickgrid").jqxGrid({
            width: '100%',
            pageable: true,
            rowsheight: 35,
            selectionMode: 'singlecell',
            pagerButtonsCount: 6,
            autoheight: true,
            source: rfcdata,
            altrows: true,
            filterable: true,
            showfilterrow: true,
            editable: true,
            columnsResize: true,
            columns: [
                {text: '', dataField: 'data', hidden: true, filterable: false},
                {text: 'Contractor', dataField: 'value', width: '90%', editable: false},
                {
                    text: 'Select',
                    dataField: 'IsCheck',
                    width: '10%',
                    columntype: 'checkbox',
                    filterable: false,
                    editable: true,
                    resizable: false,
                    type: 'bool'
                }
            ]
        });
    }
    function updatefromPickList() {
        $('.loading_area').show();
        var rows = $('#withwbsltypepickgrid').jqxGrid('getrows');
        for (var i = 0; i < rows.length; i++) {
            if (rows[i]['IsCheck'] == true) {
                var key1 = $('#conRows').val();
                $('#conName_' + key1).val(rows[i]['value']);
                $('#conId_'+ key1).val(rows[i]['data']);
                $('#grpvendortype_' + key1).val(rows[i]['type']);
                $('#wbsTable_' + key1 + ' tbody').append(addLineWbs(rows[i]['data'],key1, key1));
                addConRowpick($('#conName_' + key1));

            }
        }
        $('#picklistmodal').modal('toggle');
        $('.loading_area').hide();
    }
    function addConRowpick(x) {

        var $x = $(x),
            $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[1];
        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        if ($('#conName_' + key).val().length == 0 && $('#conId_' + key).val().length == 0)
            return;

        var $rowid = $('#conRows'),
            count = parseInt($rowid.val()) + 1;

        $tr.parent('tbody').append(addLineCon(count));
        $rowid.val(count);
        // bindContractorAutoComplete();
        $('#showDivId_' + key).show();
        $('.conDelete_' + key).show();
        showDiv(x, 'm', '');
    }

    // labour pick list

    function showPickListlabour() {
        var key1 = $('#labConRows').val();
        checkLabUsedpick(key1);
        bindLtypePickListGridlabour();
        $("#picklistmodallabour").modal('show');
    }

    function bindLtypePickListGridlabour() {
        var parent = $("#withlabourltypepickgrid").parent();
        $("#withlabourltypepickgrid").remove();
        $("<div id='withlabourltypepickgrid'></div>").appendTo(parent);
        var source =
        {
            localdata: tmp_dlabourList,
            dataFields: [
                {name: 'data', type: 'number'},
                {name: 'value', type: 'string'},
                {name: 'IsCheck', type: 'bool'},
            ],
            dataType: "json",
        };
        var adapter = new $.jqx.dataAdapter(source);
        $("#withlabourltypepickgrid").jqxGrid(
            {
                width: '100%',
                pageable: true,
                rowsheight: 35,
                selectionMode: 'singlecell',
                pagerButtonsCount: 6,
                autoheight: true,
                source: adapter,
                altrows: true,
                filterable: true,
                showfilterrow: true,
                editable: true,
                columnsResize: true,
                columns: [
                    {text: 'Labour Name', dataField: 'value', width: '80%', editable: false},
                    {
                        text: 'Select',
                        dataField: 'IsCheck',
                        hidden: false,
                        width: '20%',
                        columntype: 'checkbox',
                        resizable: false,
                        type: 'bool',
                        filterable: false
                    }
                ]
            });
    }

    function updatefromPickListlabour() {
        $('.loading_area').show();
        var rows = $('#withlabourltypepickgrid').jqxGrid('getrows');
        for (var i = 0; i < rows.length; i++) {
            if (rows[i]['IsCheck'] == true) {
                var key1 = $('#labConRows').val();
                $('#labConName_' + key1).val(rows[i]['value']);
                $('#labConId_'+ key1).val(rows[i]['data']);
                addLabConRow($('#labConName_' + key1));


            }
        }
        $('#picklistmodallabour').modal('toggle');
        $('.loading_area').hide();
    }
    function addLabConRow(x) {

        var $x = $(x),
            key = $x[0].id.split('_')[1];


        if ($('#labConName_' + key).val().length == 0 && $('#labConId_' + key).val().length == 0)
            return;

        var $rowid = $('#labConRows'),
            count = parseInt($rowid.val()) + 1;

        template = $('#dummy-labour tbody').html();
        template = template.replace(/__1/g, '_' + count);
        $("#wlabTable  tbody tr:last").after(template);
        $rowid.val(count);
        $('.labConDelete_' + key).show();
        bindLabourAutoComplete();
        bindLabourWbsAutoComplete();
        bindTimePicker();

    }
    function backForm(){
        $('#backFormId').submit();
    }
</script>