<link rel="stylesheet" href="<?php echo $this->basePath().'/css/workorder.css'; ?>" />
<link rel="stylesheet" href="<?php echo $this->basePath().'/css/wpm.css'; ?>" />
<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/project.css';?>"/>
<style>
    .back-img .item h2{color:#333;font-size:16px !important;}
    .top-conts span{color:#ff0000;font-size:14px !important;padding-left:6px;font-weight:600}
    .top-conts{margin:0}
    .ad-btn{background:#3399ff; text-shadow: 0 0 1px #546082;right:18px;text-align: center;padding-top: 2px; box-shadow: 0 0 0 2px #fff, 0 0 0 3px #3399ff; width:25px; height:25px; border-radius:50%; color:#fff; position:absolute;z-index:111}
    #resourceGrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #ltypepickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #ltypepickgrid .jqx-checkbox {border:1px solid;}
    #ltypepickgrid .jqx-grid-header{ height:75px !important;font-size:12px;}
    #ltypepickgrid .jqx-checkbox {border:1px solid;}
    .lab-natt textarea {height: 100px};
	.table-fixed tbody{max-height:250px;min-height:20px; overflow-y:auto;width:100%}
    .table-fixed thead,.table-fixed tbody,.table-fixed tr,.table-fixed td,.table-fixed th{display:block}
    .table-fixed tbody td,.table-fixed thead>tr>th{float:left; border-bottom:0;position:relative;text-overflow:ellipsis;visible;display:inline-block;white-space:nowrap}
	.select2-container .select2-selection--single{border:1px solid #ccc;min-height:37px !important;height:37px}
	.parent_text{height:37px !important}
</style>
<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 id="titleTag" class="text-center">Hire Order</h1>
            </div>
            <form method="post" id="formWrapper">
                <div id="stageTwo" style="">
                    <input type="hidden" id="costCentreId" name="costCentreId" value="<?php if(isset($ccId)){echo $ccId;}elseif(isset($hoRegister)){echo $hoRegister['CostCentreId'];}else{echo '';} ?>" />
                    <input type="hidden" id="projectId" name="projectId" value="<?php if(isset($costCentre)){echo $costCentre['ProjectId'];}elseif(isset($hoRegister)){echo $hoRegister['ProjectId'];}else{echo '';} ?>" />
                    <input type="hidden" id="vendorId" name="vendorId" value="<?php if(isset($venId)){echo $venId;}elseif(isset($hoRegister)){echo $hoRegister['VendorId'];}else{echo '';} ?>" />
                    <input type="hidden" id="eHireTypeId" name="eHireTypeId" value="<?php if(isset($hireTypeId)){echo $hireTypeId;}elseif(isset($hoRegister)){echo $hoRegister['HireTypeId'];}else{echo '';} ?>" />
                    <input type="hidden" id="branchTransId" name="branchTransId" value="<?php if(isset($branchContactDetail['BranchTransId'])){echo $branchContactDetail['BranchTransId'];}else{echo '';} ?>" />
                    <input type="hidden" name="companyId" id="companyId" value="<?php echo (isset($costCentre)) ? $costCentre['CompanyId'] : ''; ?>">
                    <div class="col-lg-12">
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Cost Centre</label>
                                        <span class="hprojName"><?php if(isset($costCentre) ) { echo $costCentre['CostCentreName']; }elseif(isset($hoRegister)){echo $hoRegister['CostCentreName'];}else{echo '';} ?></span>
                                    </li>
                                    <li>
                                        <label>Contractor</label>
                                        <span class="hconName"><?php if(isset($vendor) ) { echo $vendor['VendorName']; } elseif(isset($hoRegister)){echo $hoRegister['VendorName'];}else{echo '';} ?></span>
                                    </li>
                                    <li>
                                        <label>Hire Order Type</label>
                                        <div class="select-style selected-mu">
                                            <select name="hireTypeId" id="hireTypeId" <?php if(isset($hoRegister)) { ?>disabled<?php } ?> style="height:20px !important">
                                                <?php foreach($hireTypeMaster as $htm) { ?>
                                                    <option value="<?php echo $htm['HireTypeId']; ?>"><?php echo $htm['HireTypeName']; ?></option>
                                                <?php } ?>
                                            </select>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box box2th zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Hire Order Date</label>
                                        <span><input type="text" id="hoDate" name="hoDate" class="date_picker" value="<?php if(isset($hoRegister) && ($hoRegister['HODate'] != NULL)) { echo date("d-m-Y", strtotime($hoRegister['HODate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>Ref Date</label>
                                        <span><input type="text" id="refDate" name="refDate" class="date_picker" value="<?php if(isset($hoRegister) && ($hoRegister['RefDate'] != NULL)) { echo date("d-m-Y", strtotime($hoRegister['RefDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>From Date</label>
                                        <span><input type="text" id="fromDate" name="fromDate" class="date_picker" value="<?php if(isset($hoRegister) && ($hoRegister['FromDate'] != NULL)) { echo date("d-m-Y", strtotime($hoRegister['FromDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>To Date</label>
                                        <span><input type="text" id="toDate" name="toDate" class="date_picker" value="<?php if(isset($hoRegister) && ($hoRegister['ToDate'] != NULL)) { echo date("d-m-Y", strtotime($hoRegister['ToDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box box3th zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Hire Order No</label>
                                        <span><input type="text" id="hoNo" name="hoNo" value="<?php if(isset($hoRegister) && trim($hoRegister['HONo']) != '') { echo trim($hoRegister['HONo']); } else { echo ($genType) ? trim($hoNo) : ''; } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>CC Hire Order No</label>
                                        <span><input type="text" id="ccHoNo" name="ccHoNo" value="<?php if(isset($hoRegister) && trim($hoRegister['HOCCNo']) != '') { echo $hoRegister['HOCCNo']; } else { echo ''; } ?>" /></span>
                                    </li>
                                    <li>
                                        <label>Comp Hire Order No</label>
                                        <span><input type="text" id="compHoNo" name="compHoNo" value="<?php if(isset($hoRegister) && trim($hoRegister['HOCompNo']) != '') { echo $hoRegister['HOCompNo']; } else { echo ''; } ?>" /></span>
                                    </li>
                                    <li>
                                        <label>Ref No</label>
                                        <span><input type="text" id="refNo" name="refNo" value="<?php if(isset($hoRegister) && trim($hoRegister['RefNo']) != '') { echo trim($hoRegister['RefNo']); } else { echo ($genType) ? trim($hoNo) : ''; } ?>" /></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="slic">
                        <ul>
                            <li class="face"><a href="#"></a></li>
                            <li><a href="#"></a></li>
                            <li><a href="#"></a></li>
                        </ul>
                    </div>
                    <div class="clearfix"></div>
                    <a id="labourtypePickList" href="javascript:void(0);" onclick="showPickList()" class="ad-btn" data-original-title="Labour Type PickList" data-placement="left" data-toggle="tooltip"><i class="fa fa-plus"></i></a>

                    <div class="col-lg-12 clear top-20">
                        <div id="accordion" class="panel-group">
                            <div class="panel panel-info">
                                <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                                    <h4 class="panel-title accordion-toggle defa_panels hhtName">Period</h4>
                                </div>
                                <div class="error_message selOne" style="padding-right: 20px;"><p>please enter atleast one entry...</p></div>
                                  <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                                    <div class="table-responsive top-30">
                                    <div class="panel-body bgcolr">
                                        <div class="col-lg-12">
                                                <table class="table" style="margin-bottom:0px;" id="hireTable">
                                                    <thead>
                                                    <tr>
                                                        <th>Description</th>
                                                        <th>Unit</th>
                                                        <th class="text-right">Qty</th>
                                                        <th class="hideColumns text-right">Working Qty</th>
                                                        <th class="hideColumns">Working Unit</th>
                                                        <th class="hideColumns text-right">Total Qty</th>
                                                        <th class="text-right">Rate</th>
                                                        <th class="text-right">Amount</th>
                                                        <th>&nbsp;</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <?php
                                                    if(isset($hoHireTrans) && count($hoHireTrans) != 0) {
                                                        $i = 1;
                                                        foreach($hoHireTrans as $hoTrans) {
                                                            ?>
                                                            <tr>
                                                                <td width="30%">
                                                                    <input class="parent_text hireSuggest" type="text" name="hireName_<?php echo $i; ?>" id="hireName_<?php echo $i; ?>" onfocus="return checkHOUsed(this);" value="<?php echo $hoTrans['ResourceName']; ?>" readonly />
                                                                    <input type="hidden" name="hireId_<?php echo $i; ?>" id="hireId_<?php echo $i; ?>" value="<?php echo $hoTrans['ResourceId']; ?>" />
                                                                </td>
                                                                <td width="15%"><input type="hidden" name="unitId_<?php echo $i; ?>" id="unitId_<?php echo $i; ?>" value="<?php echo $hoTrans['UnitId']; ?>" /><input class="parent_text" type="text" name="unitName_<?php echo $i; ?>" id="unitName_<?php echo $i; ?>" value="<?php echo $hoTrans['UnitName']; ?>" readonly /></td>
                                                                <td width="15%"><input class="parent_text text-right" type="text" name="qty_<?php echo $i; ?>" id="qty_<?php echo $i; ?>" value="<?php echo $hoTrans['Qty']; ?>" onblur="return FormatNum(this, 3),checkqty(this,'a')" onclick="qtyClick(this,'a')"  onkeypress="return isDecimal(event,this);" onchange="return calAmount('<?php echo $i; ?>','r');" />
                                                                    <div style="position: relative; display:none;" id="wfirst_<?php echo $i; ?>">
                                                                        <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                            <span style="color:white;text-align:left">EstimateQty:<?php echo $hoTrans['eQty'];?></span>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td class="hideColumns"><input class="parent_text text-right" type="text" name="workingQty_<?php echo $i; ?>" id="workingQty_<?php echo $i; ?>" value="<?php echo $hoTrans['WorkingQty']; ?>" onclick="qtyClick(this,'b')" onblur="return FormatNum(this, 3),checkqty(this,'b')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('<?php echo $i; ?>','r');" />
                                                                    <div style="position: relative; display:none;" id="wQfirst_<?php echo $i; ?>">
                                                                        <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                            <span style="color:white;text-align:left">EstimateQty:<?php echo $hoTrans['eQty'];?></span>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td class="hideColumns">
                                                                    <div class="select-style">
                                                                        <select class="parent_text" name="workingUnitId_<?php echo $i; ?>" id="workingUnitId_<?php echo $i; ?>">
                                                                            <option value="0"></option>
                                                                            <?php foreach($workingUnits as $wou) { ?>
                                                                                <option value="<?php echo $wou['UnitId']; ?>" <?php if($hoTrans['WorkingUnitId']==$wou['UnitId']) { ?>selected<?php } ?>><?php echo $wou['UnitName']; ?></option>
                                                                            <?php } ?>
                                                                        </select>
                                                                    </div>
                                                                </td>
                                                                <td class="hideColumns"><input class="parent_text text-right" type="text" name="totalQty_<?php echo $i; ?>" id="totalQty_<?php echo $i; ?>" value="<?php echo $hoTrans['TotalQty']; ?>" onblur="return FormatNum(this, 3)" readonly /></td>
                                                                <td width="15%"><input class="parent_text text-right" type="text" name="rate_<?php echo $i; ?>" id="rate_<?php echo $i; ?>" value="<?php echo $hoTrans['Rate']; ?>" onclick="qtyClick(this,'c')" onkeypress="return isDecimal(event,this);" onblur="return FormatNum(this, 2),checkqty(this,'c')"  onchange="return calAmount('<?php echo $i; ?>','r');" />
                                                                    <div style="position: relative; display:none;" id="wrfirst_<?php echo $i; ?>">
                                                                        <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                            <span style="color:white;text-align:left">EstimateRate:<?php echo $hoTrans['eRate'];?></span>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td width="20%"><input class="parent_text text-right" type="text" name="amount_<?php echo $i; ?>" id="amount_<?php echo $i; ?>" value="<?php echo $hoTrans['Amount']; ?>" onblur="return FormatNum(this, 2)" readonly /></td>
                                                                <td width="5%" align="center" class="action_btns_td">
                                                                    <ul class="action_btns">
                                                                        <li>
                                                                            <a href="javascript:void(0);" class="hireDelete_<?php echo $i; ?>" id="deleteTr_<?php echo $i; ?>" onclick="deleteHireRow(this, event);"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                                                        </li>
                                                                    </ul>
                                                                </td>
                                                            </tr>
                                                            <?php $i++;
                                                        }
                                                    } else { ?>
                                                        <tr>
                                                            <td width="30%">
                                                                <input class="parent_text hireSuggest" type="text" name="hireName_1" id="hireName_1" onfocus="return checkHOUsed(this);" />
                                                                <input type="hidden" name="hireId_1" id="hireId_1" />
                                                            </td>
                                                            <td width="15%"><input type="hidden" name="unitId_1" id="unitId_1" /><input class="parent_text" type="text" name="unitName_1" id="unitName_1" readonly /></td>
                                                            <td width="15%"><input class="parent_text text-right" type="text" name="qty_1" id="qty_1" onblur="return FormatNum(this, 3),checkqty(this,'a')" onkeypress="return isDecimal(event,this);" onclick="qtyClick(this,'a')"  onchange="return calAmount('1','r');" />
                                                                <div style="position: relative; display:none;" id="wfirst_1">
                                                                    <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                        <span style="color:white;text-align:left">EstimateQty:<i id='workSet_1' style="color:white"></i></span>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td class="hideColumns"><input class="parent_text text-right" type="text" name="workingQty_1" id="workingQty_1" onclick="qtyClick(this,'b')" onblur="return FormatNum(this, 3),checkqty(this,'b')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('1','r');" />
                                                                <div style="position: relative; display:none;" id="wQfirst_1">
                                                                    <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                        <span style="color:white;text-align:left">EstimateQty:<i id='workingSet_1' style="color:white"></i></span>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td class="hideColumns">
                                                                <div class="select-style">
                                                                    <select class="parent_text" name="workingUnitId_1" id="workingUnitId_1">
                                                                        <option value="0"></option>
                                                                        <?php foreach($workingUnits as $wou) { ?>
                                                                            <option value="<?php echo $wou['UnitId']; ?>"><?php echo $wou['UnitName']; ?></option>
                                                                        <?php } ?>
                                                                    </select>
                                                                </div>
                                                            </td>
                                                            <td class="hideColumns"><input class="parent_text text-right" type="text" name="totalQty_1" id="totalQty_1" onblur="return FormatNum(this, 3)" readonly /></td>
                                                            <td width="15%"><input class="parent_text text-right" type="text" name="rate_1" id="rate_1" onclick="qtyClick(this,'c')" onblur="return FormatNum(this, 2),checkqty(this,'c')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('1','r');" />
                                                                <div style="position: relative; display:none;" id="wrfirst_1">
                                                                    <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                                                                        <span style="color:white;text-align:left">EstimateRate:<i id='rateSet_1' style="color:white"></i></span>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td width="20%"><input class="parent_text text-right" type="text" name="amount_1" id="amount_1" onblur="return FormatNum(this, 2)" readonly /></td>
                                                            <td width="5%" align="center" class="action_btns_td">
                                                                <ul class="action_btns">
                                                                    <!--li>
                                                                        <a href="javascript:void(0);" class="mainTr"><i class="fa fa-chevron-circle-down" data-toggle="tooltip" data-placement="left"></i></a>
                                                                    </li-->
                                                                    <li>
                                                                        <a href="javascript:void(0);" class="hireDelete_1" id="deleteTr_1" onclick="deleteHireRow(this, event);" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                                                                    </li>
                                                                </ul>
                                                            </td>
                                                        </tr>
                                                    <?php } ?>
                                                    <tr class="total">
                                                        <td class="colspanId" colspan="6">&nbsp;</td>
                                                        <td align="right" class="rate_pri">base Amount</td>
                                                        <td width="20%"><input class="parent_text bold-text-clr text-right" type="text" name=totalAmount" id="totalAmount" onblur="return FormatNum(this, 2)" onchange="myfunc($(this).val())" readonly />
                                                            <div style="position: relative; display:none;" id="first">
                                                                <div class="top-tip top-addtip"style="background-color:#cc0000 ! important;margin-left:76px ! important;top:-72px !important;width:68px !important;height:29px !important; ">
                                                                    <span style="color:white">required</span>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td width="5%">&nbsp;</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="border-top:none !important" class="colspanId" colspan="6">&nbsp;</td>
                                                        <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label>Qualifier Amount</label></td>
                                                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="qualAmt" id="qualAmt" onblur="return FormatNum(this, 2, true)" value="<?php echo (isset($soRegister)) ? $soRegister['QualifiedAmount'] : '';?>" readonly/></td>
                                                        <td style="border-right:none;border-top:none;">
                                                            <ul class="action_btns">
                                                                <li>
                                                                    <a href="#" class="qualTr">
                                                                        <span data-original-title="Expand" data-placement="left" data-toggle="tooltip"><i class="fa fa-chevron-circle-down"></i></span>
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </td>
                                                    </tr>
                                                    <tr style="display:none;" class="qualmainTr">
                                                        <td colspan="10" style="padding:0px !important; ">
                                                            <div class="subDiv" style="display:none;overflow-y:scroll; min-height:100%; max-height:250px;">
                                                                <?php echo $qualRHtml;?>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <input type="hidden" name="rowid" id="rowid" value="0"/>
                                                    <input type="hidden" name="deleteids" id="deleteids" value="0"/>
                                                    <tr>
                                                        <td  style="border-top:none !important" class="colspanId" colspan="6">&nbsp;</td>
                                                        <td style="border-right:none;border-top:none;" align="right" class="rate_pri"><label id="rateanal__1_lbltotrate">Net Amount</label></td>
                                                        <td style="border-right:none;border-top:none;"><input class="parent_text text-right total-clr" type="text" placeholder="00.0" name="totAmount" id="totAmount" onblur="return FormatNum(this, 2, true)"  readonly/></td>
                                                        <td style="border-right:none;border-top:none;">&nbsp;</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                                <input type="hidden" name="hireRows" id="hireRows" value="<?php echo (isset($hoHireTrans) && count($hoHireTrans) != 0) ? count($hoHireTrans) : 1; ?>" />
                                            </div>
                                            <!--div class="cont_bt col-lg-5 col-lg-offset-7 col-md-9 col-md-offset-3 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-5">
                                                <ul>
                                                    <li><a href="javascript:nextAccordian(2)">Continue &nbsp;<i class="fa fa-chevron-circle-right"></i></a></li>
                                                </ul>
                                            </div-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-info">
                                <div data-target="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-2">
                                    <h4 class="panel-title accordion-toggle defa_panels">Terms and Conditions</h4>
                                </div>
                                <div class="panel-collapse collapse" id="collapseTwo" style="height: 0px;">
                                    <div class="panel-body bgcolr">
                                        <div class="col-lg-12">
                                            <div class="col-lg-3" style="margin-top:10px;">
                                                <select name="valuefrom" id="valuefrom" class="form-control single_dropdown sortoption" data-placeholder="Amount" style="width:100%;">
                                                    <option value="BaseAmount" <?php if($valuefrom == 0) echo "selected";  ?>>BaseAmount</option>
                                                    <option value="NetAmount" <?php if($valuefrom == 1) echo "selected";  ?>>NetAmount</option>
                                                    <option value="GrossAmount" <?php if($valuefrom == 2) echo "selected";  ?>>GrossAmount</option>
                                                </select>

                                                <script>
                                                    $(document).ready(function(){

                                                        var tCount =  $('#gTermsTable tbody tr').length;
                                                        if(tCount > 1){
                                                            $('#valuefrom').attr("disabled", true);
                                                        }
                                                        else
                                                        {
                                                            $('#valuefrom').attr("disabled", false);
                                                        }
                                                    });
                                                </script>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="table-responsive top-30 form-group" style=" box-shadow:0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.16);">
                                                <table class="table table-fixed" style=" margin-bottom:0px;"> <!--id="gTermsTable"-->
                                                   <thead>
															<tr class="col-xs-12" style="padding:0 !important">
															<th class="col-xs-1" width="5%">Select</th>
															<th class="col-xs-3" width="20%">Term Details</th>
															<th class="col-xs-3" width="25%">Input Type</th>
															<th class="col-xs-3" width="25%">Enter value</th>
															<th class="col-xs-2" width="15%">Include value</th>
															</tr>
															</thead>
                                                                <tbody class="main">
																<tr class="col-xs-12" style="padding:0 !important">
																<td class="col-xs-1"><div class="radio_check">
                                                                 <p style="padding-top:10px;margin-top:8px;">
                                                                  <input type="checkbox" value = "ptype">
                                                                   <label for="ptype">&nbsp;</label>
                                                                 </p></div></td>
                                                                <td class="col-xs-3" width="26%">
                                                                  <input class="parent_text" value="" type="text">
                                                                 </td>
																 <td class="col-xs-3" width="26%">
                                                                   <select class="parent_text single_dropdown" style="width:100%">
																   <option value=""></option>
																   <option value="Work">Work</option>
																   <option value="Advance">Advance</option>
															  </select>
                                                                 </td>
																 <td class="col-xs-3" width="26%">
                                                                  <input class="parent_text" value="" type="text">
                                                                 </td>
																 <td class="col-xs-2" width="26%">
                                                                  <div class="radio_check" style="width:100% !important">
                                                                 <p style="padding-top:10px;margin-top:8px;width:100% !important">
                                                                  <input type="checkbox" value = "ptype">
                                                                   <label data-original-title="Include value" data-placement="left" data-toggle="tooltip" for="ptype" style="text-decoration:underline;color: #ff6600 !important;">Include value</label>
                                                                 </p></div>
                                                                 </td>
																</tr>
																</tbody>
                                                </table>
                                                <input type="hidden" name="trowid" id="trowid" value="0"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!----tab3------------------------------>
                            <div class="panel panel-info">
                                <div data-target="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads">
                                    <h4 class="panel-title accordion-toggle defa_panels">Other Details</h4>
                                </div>
                                <div class="panel-collapse collapse" id="collapseThree" style="height: 0px;">
                                    <div class="panel-body bgcolr">
                                        <div class="col-lg-12">
                                            <!-- Nav tabs -->
                                            <ul class="nav nav-tabs nav-controls" role="tablist">
                                                <li role="presentation" class="active"><a href="#project-detail" aria-controls="project-detail" role="tab" data-toggle="tab">Project Detail</a></li>
                                                <li role="presentation"><a href="#vendor-detail" aria-controls="vendor-detail" role="tab" data-toggle="tab">Vendor Detail</a></li>
                                                <li role="presentation"><a href="#scope-detail" aria-controls="scope-detail" role="tab" data-toggle="tab">Scope of Work</a></li>
                                                <li role="presentation"><a href="#narr-detail" aria-controls="narr-detail" role="tab" data-toggle="tab">Narration</a></li>
                                            </ul>
                                            <div class="tab-content col-md-12 col-xs-12 col-sm-12">
                                                <div class="col-md-12 tab-pane active animated-panel zoomIn" role="tabpanel" id="project-detail">
                                                    <div class="col-md-12 col-xs-12 col-sm-12"style="padding:0 !important">
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label  class="col-sm-12">HO Contact Name</label>
                                                            <div class="col-sm-12" style="padding:0 !important">
                                                                <input type="text" Name="HOContactName" id="HOContactName" class="form-control parent_text " value="<?php echo (isset($hoRegister)) ? $hoRegister['HOContactName'] : '';?>"></div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label  class="col-sm-12">HO Contact No</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <input type="text" Name="HOContactNo" id="HOContactNo" class="form-control parent_text " value="<?php echo (isset($hoRegister)) ? $hoRegister['HOContactNo'] : '';?>"></div>
                                                        </div>
                                                        <div class="form-group1 col-md-3 col-sm-4">
                                                            <label class="col-sm-12">Site Contact Name</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <input type="text" Name="sContactName" id="sContactName" class="form-control parent_text " value="<?php echo (isset($hoRegister)) ? $hoRegister['SiteContactName'] : '';?>"></div>
                                                        </div>

                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label class="col-sm-12">Site Contact No</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <input type="text" Name="sContactNo" id="sContactNo" class="form-control parent_text " value="<?php echo (isset($hoRegister)) ? $hoRegister['SiteContactNo'] : '';?>"></div>
                                                        </div>
                                                        <div class="form-group1 col-md-3 col-sm-4">
                                                            <label class="col-sm-12">Site Address</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <textarea class="parent_texts" Name="sAddress"><?php echo (isset($hoRegister)) ? $hoRegister['SiteAddress'] : '';?></textarea></div>
                                                        </div>
                                                    </div>
                                                </div><!---tab1 end------------------------->
                                                <div class="col-md-12 tab-pane animated-panel zoomIn" role="tabpanel" id="vendor-detail">
                                                    <div class="col-md-12" style="padding:0 !important">
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label  class="col-sm-12 control-label">Branch</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <div class="select-style">
                                                                    <select class="parent_text" Name="branch" id="branch" style="width:100%;">
                                                                        <option value="">Select Branch</option>
                                                                        <?php foreach($branch as $bran):?>
                                                                            <option value="<?php echo $bran['BranchId']; ?>" <?php echo ( (isset($hoRegister) && $bran['BranchId'] == $hoRegister['BranchId']) ) ? 'selected' : ''; ?>><?php echo $bran['BranchName']; ?></option>
                                                                        <?php endforeach; ?>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label  class="col-sm-12 control-label">Contact Person</label>
                                                            <div class="col-sm-12"style="padding-right:0 !important">
                                                                <div class="select-style">
                                                                    <select class="parent_text" Name="Contact" id="Contact" style="width:100%;">
                                                                        <?php if(isset($cPerson)) :?>
                                                                            <?php foreach($cPerson as $cPer):?>
                                                                                <option value="<?php echo $cPer['data']; ?>" <?php echo ( (isset($branchContactDetail['BranchTransId']) && $cPer['data'] == $branchContactDetail['BranchTransId']) ) ? 'selected' : ''; ?>><?php echo $cPer['value']; ?></option>
                                                                            <?php endforeach; ?>
                                                                        <?php endif; ?>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label class="col-sm-12 control-label">Designation</label>
                                                            <div class="col-sm-12 "style="padding-right:0 !important">
                                                                <input type="text" Name="Designation" id="Designation" class="form-control parent_text " readonly></div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label class="col-sm-12 control-label">Contact No</label>
                                                            <div class="col-sm-12 "style="padding-right:0 !important">
                                                                <input type="text" Name="contactNo" id="contactNo" class="form-control parent_text " readonly></div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label class="col-sm-12 control-label">Fax</label>
                                                            <div class="col-sm-12" style="padding-right:0 !important">
                                                                <input type="text" Name="Fax" id="Fax" class="form-control parent_text " readonly ></div>
                                                        </div>
                                                        <div class="form-group1 col-md-2 col-sm-4">
                                                            <label class="col-sm-12 control-label">Email</label>
                                                            <div class="col-sm-12" style="padding-right:0 !important">
                                                                <input type="text" class="form-control parent_text " Name="Email" id="Email" readonly ></div>
                                                        </div>
                                                    </div>
                                                </div><!---tab2 end------------------------->
                                                <div class="col-md-12 tab-pane animated-panel zoomIn" role="tabpanel" id="scope-detail">
                                                    <div class="form-group1 col-md-12 col-sm-12">
                                                        <textarea style="height:100%" class="parent_texts" Name="scopeWork"><?php if(isset($hoRegister)){echo $hoRegister['ScopeofWork'];}?></textarea></div>
                                                </div><!---tab3 end------------------------->
                                                <div class="col-md-12 tab-pane animated-panel zoomIn" role="tabpanel" id="narr-detail" >
                                                    <div class="form-group1 col-md-12 col-sm-12">
                                                        <textarea style="height:100%" class="parent_texts" Name="Narration"><?php if(isset($hoRegister)){echo $hoRegister['Narration'];}?></textarea></div>
                                                </div><!---tab4 end------------------------->
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<div id="submitDiv" class="col-lg-12 savebtn_area" style="">
    <ul>
        <li class="dropdown save_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple" title="Submit" onclick="return submitForm();">Submit</a>
            <?php if(isset($hoRegister)){?>
        <li class="cancel_btn cancel_btn_bluecolor float_l"><a href="<?php echo $this->basePath() . '/wpm/workorder/register';?>" class="ripple">Cancel <i class="fa fa-times-circle-o" aria-hidden="true"></i></a></li>
        <?php }else{?>
            <li class="cancel_btn float_r"><a href="<?php echo $this->basePath(); ?>/wpm/workorder/index" class="ripple" title="Go back!" onclick="return showBack('a');">Back</a></li>
        <?php }?>
    </ul>
</div>
<div class="modal fade bs-example-modal-lgs" id="picklistmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle-o clpot"></i></button>
                <h1><i class="fa fa-list"></i> Hire Order PickList</h1>
            </div>
            <div class="modal-body">
                <div class="col-md-12 tab-pane" style="padding:0 !important" role="tabpanel" id="iow-view">
                    <div class="table-responsive clear">
                        <div id="ltypepickgrid"> </div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <input type="hidden" id="picklistrestype" value="">
                <input type="hidden" id="picklistrow" value="">
                <a href="javascript:void(0);" class="md_cance" data-dismiss="modal">Cancel</a>
                <button type="button" class="md_ok" onclick="updatefromPickList()" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<table id="dummy-hire-row" style="display:none;">
    <tbody>
    <tr>
        <td width="30%">
            <input class="parent_text hireSuggest" type="text" name="hireName__1" id="hireName__1" onfocus="return checkHOUsed(this);" />
            <input type="hidden" name="hireId__1" id="hireId__1" />
        </td>
        <td width="15%"><input type="hidden" name="unitId__1" id="unitId__1" /><input class="parent_text" type="text" name="unitName__1" id="unitName__1" readonly /></td>
        <td width="15%"><input class="parent_text text-right" type="text" name="qty__1" id="qty__1" onblur="return FormatNum(this, 3),checkqty(this,'a')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('__1','d');" onclick="qtyClick(this,'a')" />
            <div style="position: relative; display:none;" id="wfirst__1">
                <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                    <span style="color:white;text-align:left">EstimateQty:<i id='workSet__1' style="color:white"></i></span>
                </div>
            </div>
        </td>
        <td class="hideColumns"><input class="parent_text text-right" type="text" name="workingQty__1" id="workingQty__1" onclick="qtyClick(this,'b')" onblur="return FormatNum(this, 3),checkqty(this,'b')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('__1','d');" />
            <div style="position: relative; display:none;" id="wQfirst__1">
                <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                    <span style="color:white;text-align:left">EstimateQty:<i id='workingSet__1' style="color:white"></i></span>
                </div>
            </div>
        </td>
        <td class="hideColumns">
            <div class="select-style">
                <select class="parent_text" name="workingUnitId__1" id="workingUnitId__1">
                    <option value="0"></option>
                    <?php foreach($workingUnits as $wou) { ?>
                        <option value="<?php echo $wou['UnitId']; ?>"><?php echo $wou['UnitName']; ?></option>
                    <?php } ?>
                </select>
            </div>
        </td>
        <td class="hideColumns"><input class="parent_text text-right" type="text" name="totalQty__1" id="totalQty__1" onblur="return FormatNum(this, 3)"readonly /></td>
        <td width="15%"><input class="parent_text text-right" type="text" name="rate__1" id="rate__1" onclick="qtyClick(this,'c')" onblur="return FormatNum(this, 2),checkqty(this,'c')" onkeypress="return isDecimal(event,this);" onchange="return calAmount('__1','d');" />
            <div style="position: relative; display:none;" id="wrfirst__1">
                <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-43px ! important;top:-86px !important;width:140px !important;height:44px !important; ">
                    <span style="color:white;text-align:left">EstimateRate:<i id='rateSet__1' style="color:white"></i></span>
                </div>
            </div></td>
        <td width="20%"><input class="parent_text text-right" type="text" name="amount__1" id="amount__1" onblur="return FormatNum(this, 2)"readonly /></td>
        <td width="5%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="hireDelete__1" id="deleteTr_1" onclick="deleteHireRow(this, event);" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
    </tr>
    </tbody>
</table>
<script id="terms-template"  type="text/template" class="hide">
    <tr>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="slno__" id="slno__" />
        </td>
        <td width="26%">
            <input class="parent_text resourceSuggest" type="text" name="terms__" id="terms__" value="" onfocus="checkTermsUsed(this);" />
            <input type="hidden" name="termsid__" id="termsid__"/>
            <input type="hidden"  name="isper__" id="isper__"/>
            <input type="hidden"  name="isvalue__" id="isvalue__"/>
            <input type="hidden"  name="isperiod__" id="isperiod__"/>
            <input type="hidden"  name="istdate__" id="istdate__"/>
            <input type="hidden"  name="iststring__" id="iststring__"/>
            <input type="hidden"  name="includegross__" id="includegross__"/>
        </td>
        <td width="10%">
            <input class="parent_text border-none" type="text" name="per__" id="per__" style="text-align:right;" onkeypress="return isDecimal(event,this)" onchange="TermsCalculation(this.id);"/>
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="value__" style="text-align:right;" id="value__" onkeypress="return isDecimal(event,this)" onchange="TermsCalculation(this.id);"/></td>
        <td width="10%"><input class="parent_text border-none" type="text" name="period__" style="text-align:right;" onkeypress="return isDecimal(event,this)" id="period__"/></td>
        <td width="14%">
            <div class="col-lg-12 padlr0">
                <input type="text" name="date__" id="date__" class="tbl_input date_picker" style="cursor:pointer;" value='<?php echo Date('d/m/Y'); ?>' />
                <span class="date_icon"><i class="fa fa-calendar"></i></span>
            </div>
        </td>
        <td width="15%"><input class="parent_text border-none" type="text" name="string__" id="string__"/></td>
        <td width="15%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li> <a onclick="deleteRow(this, event);"  id="termsdeleteTr__" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i> </a> </li>
            </ul>
        </td>
    </tr>
</script>
<script>
    $("#backPrev").hide();
    $(document).ready(function() {
        <?php if(isset($hireTypeId)){?>
        $("#hireTypeId").val('<?php echo $hireTypeId?>').trigger('change');
        <?php }?>
        <?php if(isset($hoRegister)){?>
        $("#hireTypeId").val('<?php echo $hoRegister['HireTypeId']?>');
        $("#Contact").trigger('change');
        <?php }?>
    });

    var hireList = <?php echo (isset($resourceMaster)) ? json_encode($resourceMaster) : ''; ?>;
    var tmp_hireList = hireList;
    var arr_edit_terms=<?php echo (isset($arr_edit_terms)) ? json_encode($arr_edit_terms) : '[]';?>;
    var arr_terms=<?php echo (isset($arr_terms)) ? json_encode($arr_terms) : '[]';?>;
    var $workingUnits=<?php echo (isset($workingUnits)) ? json_encode($workingUnits) : '[]';?>;
    var tmp_arr_terms=arr_terms;

    $(function(){
        $('.ripple').materialripple();
        nextAccordian(1);
        expandQualTrFn();
        bindQualExpandTr();
        bindPopOver();
        getCompCCNo();

        //general terms &condition
        var $trowid = $('#trowid');
        var template = $('#terms-template').html();
        var trowid = 0;
        var $tbody = $('#gTermsTable').find('> tbody');

        if(arr_edit_terms.length != 0) {

            $.each(arr_edit_terms, function(i, o) {
                trowid += 1;
                $tbody.append(template.replace(/__/g, '_' + trowid));

                $('#slno_' + trowid).val(o.SlNo).addClass('border-none').prop('disabled', true);
                $('#termsid_' + trowid).val(o.data);
                $('#terms_' + trowid).val(o.value);
                $('#per_' + trowid).val(o.Per);
                $('#value_' + trowid).val(o.Val);
                $('#period_' + trowid).val(o.Period);
                $('#date_' + trowid).val(o.Dte);
                $('#string_' + trowid).val(o.Strg);
                $('#isper_' + trowid).val(o.IsPer);
                $('#isvalue_' + trowid).val(o.IsValue);
                $('#isperiod_' + trowid).val(o.IsPeriod);
                $('#istdate_' + trowid).val(o.IsTDate);
                $('#iststring_' + trowid).val(o.IsTString);
                $('#includegross_' + trowid).val(o.IncludeGross);
                $('#termsdeleteTr_' + trowid).show();
            });
        }
        trowid += 1;
        $tbody.append(template.replace(/__/g, '_' + trowid));
        $trowid.val(trowid);
    });

    $(".mainTr").click(function(e){
        e.preventDefault();
        if(!$(this).closest("tr").next(".subTr").is(":visible")){
            $(this).closest("tr").next(".subTr").show();
            $(this).closest("tr").next(".subTr").find(".subDiv").slideDown("slow");
            $(this).find("i").addClass("tform");
        } else {
            $(this).closest("tr").next(".subTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".subTr").slideUp("slow");
            $(this).find("i").removeClass("tform");
        }
    });

    $('.cnt_slider .carousel').carousel({
        interval: false
    });

    $('#hireTypeId').on('change', function(){
        $('.hhtName').html($('#hireTypeId option:selected').text());
        showCols($(this).val());
        $('#eHireTypeId').val($(this).val()).trigger('change');
    });

    function nextAccordian(id)
    {
        $('#panelheading-' + id).trigger('click');
    }

    var $costCentreId = $('#costCentreId'),
        $vendorId = $('#vendorId'),
        $hireTypeId = $('#eHireTypeId'),
        $selHireTypeId = $('#hireTypeId');

    function validateLabStg()
    {
        $('.error_message').hide();
        var currentIndex = $('#carousel-example-generic .item.active').index();
        //alert(currentIndex);
        if(currentIndex == 0) {
            var lCostCentreId = isNullCheck($costCentreId.val(),'number');
            var lVendorId = isNullCheck($vendorId.val(),'number');
            var lHireType = isNullCheck($hireTypeId.val(),'number');

            if (lCostCentreId == 0) {
                $costCentreId.closest('.form-group').find(".error_message").show();
                return;
            } else {
                var projName = $('#costCentreId option:selected').text();
                $('.projName').val(projName);
                $('.hprojName').html(projName);
                $('#hoDate').val($('#hoeDate').val());
                /*getValueOfSlider('next');
                 $('#carousel-example-generic').carousel({
                 slide: "next"
                 });*/
            }

            if (lVendorId == 0) {
                $vendorId.closest('.form-group').find(".error_message").show();
                return;
            } else if (lHireType == 0) {
                $hireTypeId.closest('.form-group').find(".error_message").show();
                return;
            } else {
                var conName = $('#vendorId option:selected').text();
                var htName = $('#eHireTypeId option:selected').text();
                $('.conName').val(conName);
                $('.htName').val(htName);
                $('.hconName').html(conName);
                $('.hhtName').html(htName);
                $selHireTypeId.val($hireTypeId.val());
                getValueOfSlider('next');
                $('#carousel-example-generic').carousel({
                    slide: "next"
                });
            }
        } else {
            getCompCCNo();
            showBack('e');
            showCols($hireTypeId.val());
            bindHireAutoComplete();
        }
    }

    function goBack()
    {
        $('#carousel-example-generic').carousel({
            slide: "prev"
        });
        getValueOfSlider('prev');
    }

    function getValueOfSlider(slType)
    {
        var curIndex = $('#carousel-example-generic .item.active').index();
        if(slType == 'next') {
            $("#backPrev").show();
        }
        if(curIndex == 1 && slType == 'prev') {
            $("#backPrev").hide();
        } else {
            $("#backPrev").show();
        }
    }

    function showBack(sbType)
    {
        if(sbType == 'a') {
            $('#submitDiv').hide();
            $('#stageTwo').hide();
            $('#stageOne').show();
            $('#titleTag').addClass('text-center');
        } else {
            $('#stageOne').hide();
            $('#stageTwo').show();
            $('#submitDiv').show();
            $('#titleTag').removeClass('text-center');
        }
    }

    function showCols(hTypeId)
    {
        if(hTypeId == 1 || hTypeId == 2) {
            $('.hideColumns').show();
            $('.colspanId').attr("colspan", 6);
        } else if(hTypeId == 3 || hTypeId == 4) {
            $('.hideColumns').hide();
            $('.colspanId').attr("colspan", 3);

            var $wQty = $('input[id^=workingQty_]');
            $.each($wQty, function() {
                $(this).val('');
            });

            var $wUnit = $('select[id^=workingUnitId_]');
            $.each($wUnit, function() {
                $(this).val(0);
            });

            var $totQty = $('input[id^=totalQty_]');
            $.each($totQty, function() {
                $(this).val('');
            });
            typeChangeAmount();
        }
    }

    function submitForm()
    {
        var errFlag = 0;
        var hoRows = $('#hireRows').val();
        var hoCnt = 0;

        $('.error_message').hide();
        $('.red_bdr').removeClass('red_bdr');
        for(i=1;i<hoRows;i++){
            $('#qty_'+i).removeClass('red_bdr');
            if(parseFloat(parseInt($('#qty_'+i).val()) * parseInt($('#totalQty_'+i).val())) > parseFloat($('#workSet_'+i).text())) {
                $('#qty_'+i).addClass('red_bdr');
                $('#qty_'+i).focus();
                errFlag = 1;
                return false;
            }
        }

        if($.trim($('#fromDate').val()) != '' && $.trim($('#toDate').val()) != '') {
            if (!compareDate($('#fromDate').val(), $('#toDate').val())) {
                $('#toDate').addClass('red_bdr');
                $('#toDate').focus();
                errFlag = 1;
                return false;
            }
        }
        if($.trim($('#totalAmount').val()) == 0) {
            $('#totalAmount').addClass('red_bdr');
            $('#first').show();
            $('#totalAmount').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#hoNo').val()) == '') {
            $('#hoNo').addClass('red_bdr');
            $('#hoNo').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#ccHoNo').val()) == '') {
            $('#ccHoNo').addClass('red_bdr');
            $('#ccHoNo').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#compHoNo').val()) == '') {
            $('#compHoNo').addClass('red_bdr');
            $('#compHoNo').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#refNo').val()) == '') {
            $('#refNo').addClass('red_bdr');
            $('#refNo').focus();
            errFlag = 1;
            return false;
        }
        for (var i = 1; i <= hoRows; i++) {
            if($('#hireId_'+i).val() == '') {
                hoCnt = hoCnt + 1;
            }
        }
        if(hoRows == hoCnt) {
            $(".selOne").show();
            errFlag = 1;
            return false;
        }

        if(errFlag == 0) {
            $('#formWrapper').submit();
        }
    }

    /* For Hire */
    function addHireRow(x)
    {
        var $x = $(x),
            $tr = $x.closest('tr'),
            key = $x[0].id.split('_')[1];

        if ($tr.next('tr:not(.total)').length != 0)
            return;

        if ($('#hireName_' + key).val().length == 0 && $('#hireId_' + key).val().length == 0)
            return;

        var $rowid = $('#hireRows'),
            count = parseInt($rowid.val()) + 1,
            template = $('#dummy-hire-row tbody').html();

        template = template.replace(/__1/g, '_' + count);
        $('#hireTable tbody').find('.total').before(template);
        $rowid.val(count);
        $('.hireDelete_' + key).show();
        bindHireAutoComplete();
    }

    function insertHireRow()
    {
        var $rowid = $('#hireRows'),
            count = parseInt($rowid.val()) + 1,
            template = $('#dummy-hire-row tbody').html();

        template = template.replace(/__1/g, '_' + count);
        $('#hireTable tbody').find('.total').before(template);
        $rowid.val(count);
        bindHireAutoComplete();
    }

    function deleteHireRow(x,e)
    {   var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        if ($tbody.find('> tr:not(.total)').length == 1) {
            var template = $('#dummy-hire-row tbody').html();
            template = template.replace(/__1/g, '_' + 1);
            $tbody.append(template);
            $('#hireRows').val(1);
        }
        var mqty=parseFloat($('#totalAmount').val())-parseFloat($('#amount_'+rowid).val());
        $('#totalAmount').val(mqty).trigger('blur');

        var c=0;
        $.each($('input[id^=hireId_'), function(i,o){
            if($('#hireId_'+rowid).val() !=0){
                c+=1;
            }
        });
        if(c == 2){
            $('#hireTypeId').prop('disabled', false);
        }

        $tr.remove();
        return false;
    }

    function bindHireAutoComplete()
    {
        $('#hireTable .hireSuggest').autocomplete({
            lookup: tmp_hireList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[1];
                    $this.prop('readonly', true).addClass('border-none');
                    $('#hireId_'+ key1).val(suggestion.data);
                    $('#unitId_'+ key1).val(suggestion.UnitId);
                    $('#unitName_'+ key1).val(suggestion.UnitName);
                    $('#workSet_'+ key1).text(sanitizeNumber(suggestion.Qty,3));
                    $('#workingSet_'+ key1).text(sanitizeNumber(suggestion.Qty,3));
                    $('#workingUnitId_'+ key1).val(suggestion.WorkUnitId).trigger('change');
                    if(suggestion.Rate != null && suggestion.Rate != 0) {
                        $('#rate_' + key1).val(sanitizeNumber(suggestion.Rate,2));
                        $('#rateSet_'+ key1).text(sanitizeNumber(suggestion.Rate,2));
                    }else{
                        $('#rate_' + key1).val(sanitizeNumber(suggestion.WorkRate,2));
                        $('#rateSet_'+ key1).text(sanitizeNumber(suggestion.WorkRate,2));
                    }
                    if($('#hireId_'+ key1).val() != 0 || $('#hireId_'+ key1).val() !=''){
                        $("#hireTypeId").prop('disabled', true);
                    }
                    addHireRow($this);
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];

                $('#hireId_'+key1).val('');
                $('#unitId_'+ key1).val('');
                $('#unitName_'+ key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                } else removeError($(this));
            }
        });
    }

    function checkHOUsed(x) {
        var id = $(x)[0].id.split('_')[1];
        var reskeyid = $('input[id*=hireId_]');
        tmp_hireList = hireList;
        tmp_hireList = $.grep(hireList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindHireAutoComplete();
    }

    function calAmount(roId,roType)
    {
        var amt = 0;
        if(roType == 'r') {
            rId = roId;
        } else {
            var roIdSp = roId.split('_');
            rId = roIdSp[1];
        }
        var amt = 0;
        if($("#hireTypeId").val()==1 || $("#hireTypeId").val()==2) {
            var totQty = 0;
            if ($('#qty_' + rId).val() != '' && $('#workingQty_' + rId).val() != '') {
                totQty = parseFloat($('#qty_' + rId).val()) * parseFloat($('#workingQty_' + rId).val());
            }
            $('#totalQty_' + rId).val(totQty).trigger('blur');

            if ($('#totalQty_' + rId).val() != '' && $('#rate_' + rId).val() != '') {
                amt = parseFloat($('#totalQty_' + rId).val()) * parseFloat($('#rate_' + rId).val());
            }
        }else if($("#hireTypeId").val()==3){
            if ($('#qty_' + rId).val() != '' && $('#rate_' + rId).val() != '') {
                amt = parseFloat($('#qty_' + rId).val()) * parseFloat($('#rate_' + rId).val());
            }
        }
        $('#amount_'+rId).val(amt).trigger('blur');

        sumAmount();
    }

    function sumAmount()
    {
        var $samt = $('input[id^=amount_]');
        var sumAmt = 0;
        $.each($samt, function() {
            var seAmt = parseFloat($(this).val());

            if (isNaN(seAmt))
                return;

            sumAmt += seAmt;
        });
        $('#totalAmount').val(numberFormat(sumAmt,'C')).trigger('change');
    }

    function typeChangeAmount()
    {
        var $tcQty = $('input[id^=qty_]');
        var x = 1;
        $.each($tcQty, function() {
            var amt = 0;
            if($(this).val() != '' && $('#rate_' + x).val() != '') {
                amt = parseFloat($(this).val()) * parseFloat($('#rate_' + x).val());
            }
            $('#amount_' + x).val(amt);
            x++;
        });
        sumAmount();
    }

    function getCompCCNo()
    {
        $.post(getBaseURL() + 'wpm/labourstrength/get-comp-cc-no', {
                typeId: $('#soTypeId').val(),
                ccId: $('#costCentreId').val()
            },
            function (data) {
                var vNo = data.split('###');
                $('#ccHoNo').val($.trim(vNo[0]));
                $('#compHoNo').val($.trim(vNo[1]));
                if($.trim(vNo[0]) != '')
                    $('#ccHoNo').prop('readonly', true);
                if($.trim(vNo[1]) != '')
                    $('#compHoNo').prop('readonly', true);
            });
    }

    <?php if(isset($hoRegister) && count($hoRegister) != 0) { ?>
    showBack('e');
    //$('.cancel_btn').hide();
    showCols('<?php echo $hoRegister['HireTypeId']; ?>');
    <?php } ?>
    <?php if(isset($hoHireTrans) && count($hoHireTrans) != 0) { ?>
    insertHireRow();
    sumAmount();
    <?php } ?>
    /* For Hire */

    if($('#typeHo').val() == 'e') {
        getCompCCNo();
    }
    <?php if(isset($hoRegister)){?>
    <?php if($hoRegister['Approve'] == 'Y'){?>
    $('.save_btn').hide();
    <?php } }?>

    <?php
    if(isset($hoHireTrans) && count($hoHireTrans) != 0) {
    $i = 1;
    foreach($hoHireTrans as $hoTrans) {
        ?>
    $('#qty_<?php echo $i; ?>').trigger('blur');
    $('#workingQty_<?php echo $i; ?>').trigger('blur');
    $('#totalQty_<?php echo $i; ?>').trigger('blur');
    //$('#rate_<?php //echo $i; ?>//').trigger('blur');
    $('#amount_<?php echo $i; ?>').trigger('blur');
    $('#workSet_<?php echo $i; ?>').val();

    <?php $i++;}?>
    <?php }?>

    function qtyClick(x,y){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        if(y == 'a') {
            $('#wfirst_' + rowid).show();
        }else if(y == 'b'){
            $('#wQfirst_'+rowid).show();
        }else if(y == 'c'){
            $('#wrfirst_'+rowid).show();
        }

    }

    function checkqty(x,y){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        var eVal=parseInt($('#workSet_'+rowid).text());
        var etVal=parseInt($('#workingSet_'+rowid).text());
        var rateVal=parseInt($('#rateSet_'+rowid).text());
        var cQty=parseInt($('#qty_'+rowid).val());
        var wQty=parseInt($('#workingQty_'+rowid).val());
        var wRate=parseInt($('#rate_'+rowid).val());
        var hId=$('#hireTypeId').val();
        if(wQty == '' || isNaN(wQty)) wQty=0;
        if(cQty == '') cQty=0;
        if(wRate == '') wRate=0;
        if(eVal == '') eVal=0;
        if(etVal == '') etVal=0;
        if(rateVal == '' || isNaN(rateVal)) rateVal=0;
        if(y == 'a') {
            $('#wfirst_' + rowid).hide();
            if($("#hireTypeId").val()==1 || $("#hireTypeId").val() ==2) {
                if (parseFloat(eVal) < parseFloat(cQty * wQty)) {
                    $('#qty_' + rowid).addClass('red_bdr');
                    return false;
                } else {
                    $('#qty_' + rowid).removeClass('red_bdr');
                }
            }else if($("#hireTypeId").val() ==3){
                if (parseFloat(etVal) < parseFloat(cQty)) {
                    $('#qty_' + rowid).addClass('red_bdr');
                    return false;
                } else {
                    $('#qty_' + rowid).removeClass('red_bdr');
                }
            }
        }else if(y =='b'){
            $('#wQfirst_'+rowid).hide();
            if (parseFloat(etVal) < parseFloat(cQty * wQty)) {
                $('#workingQty_' + rowid).addClass('red_bdr');
                return false;
            } else {
                $('#workingQty_' + rowid).removeClass('red_bdr');
            }
        }else if(y == 'c'){
            $('#wrfirst_'+rowid).hide();
            if(parseFloat(rateVal) < parseFloat(wRate)){
                $('#rate_' + rowid).addClass('red_bdr');
                return false;
            }else{
                $('#rate_' + rowid).removeClass('red_bdr');
            }
        }
    }

    $('#branch').change(function() {
        var branchid = $(this).val();
        $.ajax({
            type: "POST",
            url: getBaseURL()+'wpm/labourstrength/hire-order',
            data: "branchid="+branchid+"&Type=selectBranchCPerson",
            dataType: "json",
            success: function(data,textStatus,jqXHR){
                if(jqXHR.status == 200) {
                    $("#Contact").html('');
                    $("#Contact").append("<option value='0'>None</option>");
                    $.each(data, function(i,v){
                        $("#Contact").append("<option value='"+v.data+"'>"+v.value+"</option>");
                    });
                }
            }, error: function (jqXHR, textStatus, errorThrown) {

            }
        });
    });

    $('#Contact').change(function() {
        var branchtransid=$(this).val();
        if(branchtransid == 0)
        {
            $('#Designation').val('');
            $('#contactNo').val('');
            $('#Fax').val('');
            $('#Email').val('');
        }
        $.ajax({
            type: "POST",
            url: getBaseURL()+'wpm/labourstrength/hire-order',
            data: "branchtransid="+branchtransid+"&Type=selectCPersonno",
            dataType: "json",
            success: function(data,textStatus,jqXHR){
                if(jqXHR.status == 200) {
                    $('#Designation').val(data['Designation']);
                    $('#Fax').val(data['Fax']);
                    $('#Email').val(data['Email']);
                    $('#contactNo').val(data['ContactNo']);
                }
            }, error: function (jqXHR, textStatus, errorThrown) {
                $('#Designation').val('');
                $('#Fax').val('');
                $('#Email').val('');
                $('#contactNo').val('');
            }
        });
    });

    //Qualifier start
    function expandQualTrFn(reset) {
        var $mainTRs = $("a[class*=qualTr]");
        if (typeof reset !== 'undefined' && reset === true) $mainTRs.unbind('click');
        $mainTRs.click(function(e){
            e.preventDefault();
            var name = $(this)[0].className;
//            key = name.split('_')[1];
//        if (validateRow(name) == false) return false;
            var $subTr = $(this).closest("tr").nextAll(".qualmainTr"),
                $i = $(this).find("i");
            if(!$subTr.is(":visible")){
                $subTr.show();
                $subTr.find(".subDiv").slideDown("slow");
                $i.removeClass("fa-chevron-circle-down");
                $i.addClass("fa-chevron-circle-up");
//            $('rateanal_'+ key +'_restable').show();
//            iFocusRowId = key;
                closeQualdetails();
            } else {
                $subTr.find(".subDiv").slideUp("slow");
                $subTr.slideUp("slow");
                $i.removeClass("fa-chevron-circle-up");
                $i.addClass("fa-chevron-circle-down");
            }
            return false;
        });
    }

    function closeQualdetails(key) {
        var $mainTRs = $("a[class*=qualTr]");
        $.each($mainTRs, function (i, obj) {
            var $this = $(this),
                $mainTr = $this.find('> i.fa-chevron-circle-down.tform');
//        if (typeof key != 'undefined' && $this[0].className.indexOf(key) != -1) return;
            if($mainTr.length != 0) $mainTr.trigger('click');
        });
    }

    function bindQualExpandTr() {
        var $mainTr = $(".qualmainExp");
        $mainTr.unbind('click');
        $mainTr.click(function (e) {
            e.preventDefault();
            if (!$(this).closest("tr").next(".qualsubTr").is(":visible")) {
                closeQualTr();
                $(this).closest("tr").next(".qualsubTr").show();
                $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideDown("slow");
            }
            else {
                $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
                $(this).closest("tr").next(".qualsubTr").slideUp("slow");
            }
        });
    }

    function closeQualTr() {
        var $mainTr = $(".qualmainExp");
        $.each($mainTr, function () {
            $(this).closest("tr").next(".qualsubTr").find(".subDiv").slideUp("slow");
            $(this).closest("tr").next(".qualsubTr").slideUp("slow");
        });
    }

    function bindPopOver() {
        var $inputs =  $('input[data-toggle="popover"]');
        $inputs.unbind('popover');
        $inputs.popover({
            placement : 'auto left',
            trigger : 'hover'
        });
    }

    function myfunc(x){
        $(".base").val(x);
        CalcQualifier();
        var $mainTr = $(".qualChange");
        $mainTr.change(function (e) {
            CalcQualifier();
        });

    }

    function CalcQualifier() {
        $.each($(".base"), function () {
            var qId = $(this).attr('id').split('_')[4];
            var iId = $(this).attr('id').split('_')[2];
            var sFormula = isNullCheck($('#QualR__' + iId + '_Exp_' + qId).val(), 'string');
            var dbaseAmt = isNullCheck($('#QualR__' + iId + '_ExpValue_' + qId).val(), 'string');
            var dPer = parseFloatVal(isNullCheck($('#QualR__' + iId + '_ExpPer_' + qId).val(), 'number'));
            var sbaseRef = 'R0';
            if (parseFloatVal(dPer) == 0) dPer = 100;
            var sFormula = sFormula.replace(new RegExp(sbaseRef, 'g'), dbaseAmt);
            var fvaule = computeEval(sFormula);
            var iQualTypeid = $('#QualR__' + iId + '_TypeId_' + qId).val();

            var dAmt=0;
            if (iQualTypeid==1 || iQualTypeid==2) {
                var dTaxablePer = parseFloatVal(isNullCheck($('#QualR__' + iId + '_TaxablePer_' + qId).val(),'number'));
                var dTaxPer = parseFloatVal(isNullCheck($('#QualR__' + iId + '_TaxPer_' + qId).val(),'number'));
                var dCess = parseFloatVal(isNullCheck($('#QualR__' + iId + '_CessPer_' + qId).val(),'number'));
                var dEDCess = parseFloatVal(isNullCheck($('#QualR__' + iId + '_EduCessPer_' + qId).val(),'number'));
                var dHEDCess = parseFloatVal(isNullCheck($('#QualR__' + iId + '_HEduCessPer_' + qId).val(),'number'));
                var dNetPer = dTaxPer + (dTaxPer * (dCess +  dEDCess + dHEDCess))/100;
                $('#QualR__' + iId + '_NetPer_' + qId).val(dNetPer);

                $('#QualR__' + iId + '_NetPer_' + qId).val(numberFormat(dNetPer,'C'));
                $('#QualR__' + iId + '_ExpPer_'+ qId).val(numberFormat(dNetPer,'C'));

                var dTaxableAmt =  fvaule* (dTaxablePer/100);
                var dTaxAmt =  dTaxableAmt* (dTaxPer/100);
                var dCessAmt =  dTaxAmt* (dCess/100);

                var dEDAmt =  dTaxAmt* (dEDCess/100);
                var dHEDAmt =  dTaxAmt* (dHEDCess/100);
                var dNetAmt = dTaxAmt+dCessAmt+dEDAmt+dHEDAmt;

                $('#QualR__' + iId + '_TaxableAmt_'+ qId).val(numberFormat(dTaxableAmt,'C'));
                $('#QualR__' + iId +  '_TaxPerAmt_'+ qId).val(numberFormat(dTaxAmt,'C'));
                $('#QualR__' + iId + '_CessAmt_'+ qId).val(numberFormat(dCessAmt,'C'));
                $('#QualR__' + iId + '_EduCessAmt_'+ qId).val(numberFormat(dEDAmt,'C'));
                $('#QualR__' + iId + '_HEduCessAmt_'+ qId).val(numberFormat(dHEDAmt,'C'));
                $('#QualR__' + iId + '_NetAmt_'+ qId).val(numberFormat(dNetAmt,'C'));

                dAmt = dNetAmt;
            }else{
                dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
            }
//        var dAmt = parseFloatVal(fvaule) * (parseFloatVal(dPer) / 100);
            $('#QualR__' + iId + '_Amount_' + qId).val(numberFormat(dAmt,'C'));
        });
        sign();
    }

    function sign(){
        var tot=0;
        $.each($(".signCh"), function () {
            var qId = $(this).attr('id').split('_')[4];
            var iId = $(this).attr('id').split('_')[2];
            var cAmt=parseFloatVal($('#QualR__' + iId + '_Amount_' + qId).val());
            var yesNo=$('#QualR__' + iId +'_YesNo_'+ qId).is(':checked');
            var sSign='-';
            if ($('#QualR__' + iId +'_SignC_' + qId).hasClass("fa-plus")) {
                sSign='+';
            }
            if(yesNo== true){
                if (sSign =="-") {
                    tot = tot - parseFloatVal(cAmt);
                } else {
                    tot = tot + parseFloatVal(cAmt);
                }
            }
        });
        $('#QualRTotalAmt__1').val(numberFormat(tot,'C'));
        $('#qualAmt').val(numberFormat(tot,'C'));
        var bAmt = $('#qualAmt').val();
        var qAmt = $('#totalAmount').val();
        $('#totAmount').val(numberFormat((parseFloatVal(bAmt)+parseFloatVal(qAmt)),'C'));
    }

    function signChange(x) {
        var $this = $(x);
        if ($this.hasClass( "fa-plus" )) {
            $this.removeClass('fa-plus clr-gre');
            $this.addClass('fa-minus clr-red');
            var sname= $this[0].id.split('_')[0],
                key1 = $this[0].id.split('_')[1],
                key2 = $this[0].id.split('_')[3];
            $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('-');
        } else {
            $this.removeClass('fa-minus clr-red');
            $this.addClass('fa-plus clr-gre');
            var sname= $this[0].id.split('_')[0],
                key1 = $this[0].id.split('_')[1],
                key2 = $this[0].id.split('_')[3];
            $('#' +  sname + '_' + key1 + '_Sign_' + key2).val('+');
        }
        sign();
    }
    function validPercent(){
        CalcQualifier();
    }
    function yesNo(){
        CalcQualifier();
    }
    function checkTermsUsed(x) {
        var id = $(x)[0].id.split('_')[1];
        var termkeyid = $('input[id*=termsid_]');
        tmp_arr_terms = arr_terms;
        tmp_arr_terms = $.grep(arr_terms, function (element, index) {
            var is_selected = true;
            $.each(termkeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindTermsAutocomplete();
    }
    function bindTermsAutocomplete() {
        // bind resource autocomplete
        $('#gTermsTable .resourceSuggest').autocomplete({
            lookup: tmp_arr_terms,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function (suggestion) {
                if (suggestion) {

                    var $this = $(this);
                    var rowid = $this[0].id.split('_')[1];
                    $this.prop('readonly', true).addClass('border-none');
                    $('#termsid_' + rowid).val(suggestion.data);
                    $('#slno_' + rowid).val(suggestion.SlNo).attr("readonly",true);
                    $('#terms_' + rowid).val(suggestion.value);
                    $('#per_' + rowid).val(suggestion.Per);
                    $('#value_' + rowid).val(suggestion.Val);
                    $('#period_' + rowid).val(suggestion.Period);
                    $('#date_' + rowid).val(suggestion.Dte);
                    $('#string_' + rowid).val(suggestion.Strg);
                    $('#isper_' + rowid).val(suggestion.IsPer);
                    $('#isvalue_' + rowid).val(suggestion.IsValue);
                    $('#isperiod_' + rowid).val(suggestion.IsPeriod);
                    $('#istdate_' + rowid).val(suggestion.IsTDate);
                    $('#iststring_' + rowid).val(suggestion.IsTString);
                    $('#includegross_' + rowid).val(suggestion.IncludeGross);
                    $('#termsdeleteTr_' + rowid).show();
                    if(parseInt($('#isper_' + rowid).val())==0){$('#per_' + rowid).attr("readonly",true);}
                    if(parseInt($('#isvalue_' + rowid).val())==0) {$('#value_' + rowid).attr("readonly",true);}
                    if(parseInt($('#isperiod_' + rowid).val())==0) {$('#period_' + rowid).attr("readonly",true);}
                    if(parseInt($('#istdate_' + rowid).val())==0) {$('#date_' + rowid).attr("readonly",true);}
                    if(parseInt($('#iststring_' + rowid).val())==0) {$('#string_' + rowid).attr("readonly",true);}
                    addNewTermsRow($this);
                }
            }, onSearchStart: function (suggestion) {
                //var rowid = $(this)[0].id.split('_')[1];
                ////$('#terms_' + rowid).val('');
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length) {
                    // var rowid = $(this)[0].id.split('_')[1];
                    // $('#terms_' + rowid).val('');
                }
            }
        });
    }
    function addNewTermsRow(x) {
        var $tr = $(x).closest('tr');
        if ($tr.next('tr:not(.subTr)').length != 0)
            return;

        var $trowid = $('#trowid'),
            trowid = parseInt($trowid.val()),
            $tbody = $('#gTermsTable').find('> tbody.main');

        $('#deleteTr_' + trowid).show();
        var count = trowid + 1,
            template = $('#terms-template').html();

        template = template.replace(/__/g, '_' + count);
        $tbody.append(template);

        $trowid.val(count);
        var tCount =  $('#gTermsTable tbody tr').length;
        if(tCount > 1){
            $('#valuefrom').attr("disabled", true);
        }
        else
        {
            $('#valuefrom').attr("disabled", false);
        }
        bindTermsAutocomplete();
    }

    function deleteRow(x,e) {
        e.preventDefault();
        var $x = $(x),
            key = $x[0].className.split('_')[1];

        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $x.closest('tr');
        $tr.next('.subTr').remove();
        $tr.next('.subTr').remove();
        $tr.remove();
//    calcTotal();
        bindTermsAutocomplete();
//    TermsAutoRefresh();
        return false;
    }

    function TermsCalculation(x)
    {
        var valueFrom=$('#valuefrom').val();
        var sname= x.split('_')[0],
            key= x.split('_')[1];
        var netAmt=0.0;
        if(valueFrom == 'BaseAmount'){
            netAmt = parseFloat(isNullCheck($('#basetotal').val(),'number'));
        }
        else if(valueFrom == 'NetAmount'){
            netAmt=parseFloat(isNullCheck($('#total').val(),'number'));
        }
        else
        {
            netAmt=parseFloat(isNullCheck($('#basetotal').val(),'number'));
        }

        var sTerms=$('#terms_'+key).val();

        var eTerms="";
        var dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer=0.0;
        var dAdvVal,dADelVal,dAWorkVal,dABillVal,dACerVal=0.0;
        var iKey=0;
        $.each($('input[id^=terms_]'), function (i,o) {
            $this=$(this);
            //iKey = iKey + 1;
            iKey = $this[0].id.split('_')[1];
            eTerms = $(this).val();

            //iKey = $this[0].id.split('_')[1];
            if(eTerms == 'Advance'){
                dAdvPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
                dAdvVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            }
            if(eTerms == 'Against Delivery'){
                dADelPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
                dADelVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            }
            if(eTerms == 'Against Work'){
                dAWorkPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
                dAWorkVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            }
            if(eTerms == 'Against Bill'){
                dABillPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
                dABillVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            }
            if(eTerms == 'Against Certification'){
                dACerPer=parseFloat(isNullCheck($('#per_'+iKey).val(),'number'));
                dACerVal=parseFloat(isNullCheck($('#value_'+iKey).val(),'number'));
            }
        });
        if(sTerms == 'Advance' && sname == 'per' || sTerms == 'Against Delivery' && sname == 'per' || sTerms == "Against Work" && sname == 'per' || sTerms == "Against Bill" && sname == 'per' || sTerms == "Against Certification" && sname == 'per')
        {
            if(sTerms == 'Advance' && sname == 'per')
            {
                dCurPer = dAdvPer;
            }
            else if(sTerms == 'Against Delivery' && sname == 'per')
            {
                dCurPer = dADelPer;
            }
            else if(sTerms == 'Against Work' && sname == 'per')
            {
                dCurPer = dAWorkPer;
            }
            else if(sTerms == 'Against Bill' && sname == 'per')
            {
                dCurPer = dABillPer;
            }
            else if(sTerms == 'Against Certification' && sname == 'per')
            {
                dCurPer = dACerPer;
            }

            if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == false)
            {
                PerCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key)
            }
            else
            {
                alert("Enter Valid Amount!");
                $('#per_'+key).val(0);
                $('#value_'+key).val(0);
                return;
            }
        }
        else if(sTerms == 'Advance' && sname == 'value' || sTerms == 'Against Delivery' && sname == 'value' || sTerms == "Against Work" && sname == 'value' || sTerms == "Against Bill" && sname == 'value' || sTerms == "Against Certification" && sname == 'value')
        {
            if(sTerms == 'Advance' && sname == 'value')
            {
                dCurPer = dAdvVal;
            }
            else if(sTerms == 'Against Delivery' && sname == 'value')
            {
                dCurPer = dADelVal;
            }
            else if(sTerms == 'Against Work' && sname == 'value')
            {
                dCurPer = dADelval;
            }
            else if(sTerms == 'Against Bill' && sname == 'value')
            {
                dCurPer = dABillVal;
            }
            else if(sTerms == 'Against Certification' && sname == 'value')
            {
                dCurPer = dACerVal;
            }
            AmtCalc(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer,dCurPer,netAmt,key);
            dCurPer = parseFloat(isNullCheck($('#per_'+key).val(),'number'));

            $.each($('input[id^=terms_]'), function (i,o) {
                eTerms = $(this).val();
                if(eTerms == 'Advance'){
                    dAdvPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                    dAdvVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
                }
                if(eTerms == 'Against Delivery'){
                    dADelPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                    dADelVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
                }
                if(eTerms = 'Against Work'){
                    dAWorkPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                    dAWorkVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
                }
                if(eTerms == 'Against Bill'){
                    dABillPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                    dABillVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
                }
                if(eTerms == 'Against Certification'){
                    dACerPer=parseFloat(isNullCheck($('#per_'+key).val(),'number'));
                    dACerVal=parseFloat(isNullCheck($('#value_'+key).val(),'number'));
                }
            });

            if(TotAmtValidation(dAdvPer,dADelPer,dAWorkPer,dABillPer,dACerPer) == true)
            {
                alert("Enter Valid Amount!");
                $('#per_'+key).val(0);
                $('#value_'+key).val(0);
            }
        }
        //alert(dAdvPer);
//    calcTotal();
    }


    function TotAmtValidation(argAdv,argADel,argAWork,argABill,argACer)
    {
        var bRet=false;
        var dTot=parseFloat(isNullCheck(argAdv,'number')) + parseFloat(isNullCheck(argADel,'number')) + parseFloat(isNullCheck(argABill,'number')) + parseFloat(isNullCheck(argACer,'number')) + parseFloat(isNullCheck(argAWork,'number'));
        if(dTot > 100)
        {
            bRet = true;
        }
        return bRet;
    }
    function AmtCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
    {
        var Val,TotPer = 0.0;
        TotPer = parseFloat(isNullCheck(argAgaDel,'number')) + parseFloat(isNullCheck(argAgaBill,'number')) + parseFloat(isNullCheck(argAgaCer,'number')) + parseFloat(isNullCheck(argAgaWork,'number'));
        Val = AmountToPer(parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(TotPer,'number')));
        $('#per_'+key).val(sanitizeNumber(Val,3,true));
    }
    function PerCalc(argAdv,argAgaDel,argAgaWork,argAgaBill,argAgaCer,argPer,argTotAmt,key)
    {
        var Val,TotPer=0.0;
        TotPer = parseFloat(isNullCheck(argAgaDel,'number'))+parseFloat(isNullCheck(argAgaBill,'number'))+parseFloat(isNullCheck(argAgaCer,'number'))+parseFloat(isNullCheck(argAgaWork,'number'));
        Val = PerToAmount(parseFloat(isNullCheck(argPer,'number')),parseFloat(isNullCheck(argTotAmt,'number')),parseFloat(isNullCheck(TotPer,'number')));
        $('#value_'+key).val(sanitizeNumber(Val,3,true));
    }
    function PerToAmount(argPer,argAmt,argTotPer)
    {
        if(parseFloat(isNullCheck(argAmt,'number'))>0 && parseFloat(isNullCheck(argPer,'number')) > 0)
        {
            argPer = (parseFloat(isNullCheck(argPer,'number')) / 100) * parseFloat(isNullCheck(argAmt,'number'));
        }
        return argPer;
    }
    function AmountToPer(argAmt,argPer,argTotPer)
    {
        if(parseFloat(isNullCheck(argAmt,'number')) > 0 && parseFloat(isNullCheck(argPer,'number')) >0)
        {
            argAmt = ((parseFloat(isNullCheck(argPer,'number')) / parseFloat(isNullCheck(argAmt,'number'))) * 100)
        }
        return argAmt;
    }

//    pickList
    function showPickList() {
        var key2 = $('#hireRows').val();
        checkHOPickUsed(key2);
        bindLtypePickListGrid();
        $("#picklistmodal").modal('show');
    }
    function checkHOPickUsed(key2) {
        var reskeyid = $('input[id*=hireId_]');
        tmp_hireList = hireList;
        tmp_hireList = $.grep(hireList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != key2) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
    }
    function bindLtypePickListGrid(){
        var parent = $("#ltypepickgrid").parent();
        $("#ltypepickgrid").remove();
        $("<div id='ltypepickgrid'></div>").appendTo(parent);
        var source = {
            localdata:tmp_hireList,
            async: false,
            dataType: "json",
            dataFields: [
                { name: 'data', type: 'number'},
                { name: 'value', type: 'string'},
                { name: 'UnitId', type: 'number'},
                { name: 'WorkRate', type: 'number'},
                { name: 'WorkUnitId', type: 'number'},
                { name: 'Rate', type: 'number'},
                { name: 'Qty', type: 'number'},
                { name: 'UnitName', type: 'string'},
                { name: 'wUnitName', type: 'string'},
                { name: 'Include', type: 'boolean'}
            ],
            id: 'ResourceId'
        };

        var rfcdata = new $.jqx.dataAdapter(source);
//    var columnsrenderer = function (value) {
//        return '<div style="text-align: right; margin-top: 5px;">' + value + '</div>';
//    }

        $("#ltypepickgrid").jqxGrid({
            width: "100%",
            pagerButtonsCount: 6,
            pagesize: 10,
            source: rfcdata,
            pageable: true,
            sortable: true,
            filterable: true,
            showfilterrow: true,
            altrows: true,
            enabletooltips: true,
            editable: true,
            selectionmode: 'singlerow',
            columns: [
                {text: 'data', datafield: 'data', hidden: true},
                {text: 'ResourceName', datafield: 'value', 'editable': false, width: '75%'},
                {text: 'UnitName', datafield: 'UnitName', 'editable': false, width: '15%'},
                {text: 'UnitId', datafield: 'UnitId', hidden: true},
                {text: 'WorkRate', datafield: 'WorkRate', hidden: true},
                {text: 'WorkUnitId', datafield: 'WorkUnitId', hidden: true},
                {text: 'Rate', datafield: 'Rate', hidden: true},
                {text: 'Quantity', datafield: 'Qty', hidden: true},
                {text: 'wUnitName', datafield: 'wUnitName', hidden: true},
                {text: 'Select', datafield: 'Include', columntype: 'checkbox', 'editable': true, width: '10%'}
            ]
        });
    }
//    function checkLRAUsed(x){
//
//    }
    function updatefromPickList() {
        $('.loading_area').show();
        var rows = $('#ltypepickgrid').jqxGrid('getrows');
        for (var i = 0; i < rows.length; i++) {
            if (rows[i]['Include'] == true) {
                var key1 = $('#hireRows').val();
                $('#hireName_' + key1).val(rows[i]['value']);
                $('#hireId_'+ key1).val(rows[i]['data']);
                $('#unitId_'+ key1).val(rows[i]['UnitId']);
                $('#unitName_'+ key1).val(rows[i]['UnitName']);
                $('#workSet_'+ key1).text(sanitizeNumber(rows[i]['Qty'],3));
                $('#workingSet_'+ key1).text(sanitizeNumber(rows[i]['Qty'],3));
                $('#workingUnitId_'+ key1).val(rows[i]['WorkUnitId']).trigger('change');
                if(rows[i]['Rate'] != null && rows[i]['Rate'] != 0) {
                    $('#rate_' + key1).val(sanitizeNumber(rows[i]['Rate'],2));
                    $('#rateSet_'+ key1).text(sanitizeNumber(rows[i]['Rate'],2));
                }else{
                    $('#rate_' + key1).val(sanitizeNumber(rows[i]['WorkRate'],2));
                    $('#rateSet_'+ key1).text(sanitizeNumber(rows[i]['WorkRate'],2));
                }
                if($('#hireId_'+ key1).val() != 0 || $('#hireId_'+ key1).val() !=''){
                    $("#hireTypeId").prop('disabled', true);
                }
                addHireRow($('#hireName_'+ key1));
            }
        }
        $('#picklistmodal').modal('toggle');
        $('.loading_area').hide();
    }
</script>