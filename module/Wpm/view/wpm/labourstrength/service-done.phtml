<link rel="stylesheet" href="<?php echo $this->basePath() . '/css/workorder.css'; ?>"
      xmlns="http://www.w3.org/1999/html"/>
<link rel="stylesheet" href="<?php echo $this->basePath().'/css/wpm.css'; ?>" />
<style>
    .panel {
        border-radius:0px !important;
    }
    .panel-info {
        border:none;border-top:none;
    }
</style>
<style>

    #jqxTree {
        margin-top: 15px;
        max-height: 450px;
        font-size: 12px !important;
        min-height: 400px !important;
        border: none
    }

    .jqx-tree-dropdown {
        padding: 0 0 0 5px
    }

    .jqx-tree-dropdown-root {
        min-width: 100% !important;
        width: 100% !important
    }

    .jqxgrid {
        background: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.12), 0 1px 1px rgba(0, 0, 0, 0.24);
        padding: 0px 6px 20px;
        width: 100% !important; /*height:490px !important; overflow-y:scroll*/
    }

    .table-responsive table.table tr td, .table-responsive table.table tr th {
        padding: 4px !important
    }

    /*----------------------------grid-----------------------*/
    .panel {
        border-radius: 0px !important;
    }

    .modal-dialog {
        width: 80%
    }

    .panel-info {
        border: none;
        border-top: none;
    }

    .top-addtip12 {
        bottom: 0;
        height: 30px;
        left: -12px;
        margin-left: 0;
        right: -13px;
        top: -71px;
        width: 105px;
    }

    a.sele-max1, a.sele-max2, a.sele-max {
        float: left
    }

    #contractorTable .jqx-grid-header {
        height: 75px !important;
        font-size: 12px;
    }

    #LabourTable .jqx-grid-header {
        height: 75px !important;
        font-size: 12px;
    }
    .subDiv1{background:#BFC4D6 !important; border:1px solid #8796CC}
    .subDiv1 .table thead tr th{background:#D1D5E3;border-bottom:2px solid #8796CC;font-size:14px !important}
    .subDiv1 .table tbody tr td input[type="text"]{font-size:14px !important}
    .subDiv2 .table thead tr th{background:#E3DFD1;border-bottom:2px solid #CCBD87;font-size:13px !important}
    .subDiv2 .table tbody tr td input[type="text"]{font-size:13px !important}
    .subDiv2 .table tbody tr:hover,.subDiv2 .table tbody tr:focus,.subDiv2 .table tbody tr td:focus{background:#D1E3D6 !important}
    .subDiv2{background:#D6D1BF !important; border:1px solid #CCBD87}
    /*----------------------------fixed table-----------------------*/
    .fixedTable .table {
        background-color: white;
        margin-bottom: 0;
        width: auto;
    }

    .fixedTable .table tr td, .fixedTable .table tr th {
        min-width: 140px;
        width: 100px;
        overflow: hidden;
        background: #fff;
        padding: 5px;
    }

    .fixedTable-sidebar .table tbody tr td, .fixedTable-header .table thead tr th {
        font-size: 12px;
        text-transform: uppercase;
        background: #D8DAE6 !important;
        border-right: 1px solid #C0C3D1;
        text-overflow: ellipsis;
        overflow: hidden;
        display: inline-block;
        white-space: nowrap;
    }

    .fixedTable-header {
        width: 100%;
        background: #DAEAF0 none repeat scroll 0 0;
        border-bottom: 2px solid #5d9bb6 !important;
        border-top: 1px solid #dddddd !important;
        color: #424141;
        line-height: 30px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        height: 40px;
    }

    .fixedTable-sidebar .table tbody tr td {
        border-bottom: 2px solid #C0C3D1;
        line-height: 32px
    }

    .fixedTable-sidebar {
        width: 19%;
        max-height: 350px;
        min-height: 200px;
        float: left;
        overflow: hidden;
        border-right: 1px solid #5d9bb6;
    }

    .fixedTable-body .table tbody tr td {
        font-size: 12px;
    }

    .fixedTable-body {
        overflow: auto;
        width: 81%;
        max-height: 350px;
        min-height: 200px;
        float: left;
    }

    @media only screen and (max-width: 1024px) {
        .fixedTable-body {
            width: 75%;
        }

        .fixedTable-sidebar {
            width: 25%
        }
    }

    @media only screen and (max-width: 768px) {
        .fixedTable-body {
            width: 65%;
        }

        .fixedTable-sidebar {
            width: 35%
        }
    }

    @media only screen and (max-width: 360px) {
        .fixedTable-body {
            width: 54%;
        }

        .fixedTable-sidebar {
            width: 46%
        }

        .fixedTable .table tr td, .fixedTable .table tr th {
            min-width: 100px
        }
    }
    .parent_text[readonly] { border:1px solid #ddd; background:#f1f1f1 }
</style>
<div class="content_wrapper padlr0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 id="titleTag" class="text-center">Service Done</h1>
            </div>
            <form method="post" id="formWrapper">
                <input type="hidden" name="frm_index" value="1"/>
                <div id="resourceInputsWrapper" class="hide"></div>
                <div id="stageOne" class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 cnt_slider back-img">
                    <div class="col-lg-4 col-lg-offset-8 col-md-4 col-md-offset-8 col-sm-4 col-sm-offset-8">
                        <div class="col-lg-8 col-lg-offset-4">
                            <span class="date_icon wmp-date"><i class="fa fa-calendar"></i></span>
                            <input type="text" name="sdeDate" id="sdeDate" class="date_picker parnt-text" value="<?php echo date("d-m-Y"); ?>" readonly />
                            <input type="hidden" id="serDoneId" name="serDoneId" value="<?php echo $serDoneId; ?>" />
                            <input type="hidden" id="sdTypeId" name="sdTypeId" value="<?php echo $sdTypeId; ?>" />
                            <input class="parent_text text-right" type="hidden" name="sAmount" id="sAmount" value="<?php if(isset($sdRegister) && $sdRegister['Amount'] != '') { echo $sdRegister['Amount']; } ?>"  />
                        </div>
                    </div>
                    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner" role="listbox">
                            <div class="item active" id="firstWin">
                                <div class="col-lg-9 col-lg-offset-3 col-md-9 col-md-offset-3 col-sm-9 col-sm-offset-3 col-xs-12 top-sl-10">
                                    <div class="col-lg-8 col-lg-offset-0 col-md-8 col-md-offset-0 col-sm-8 col-sm-offset-0 col-xs-12 form-group">
                                        <input type="text" class="form-control lbl_move" label="Select Cost Centre" value="<?php if(isset($sdRegister) && trim($sdRegister['CostCentreId']) != '') { echo $sdRegister['CostCentreId']; } else { echo ''; } ?>" name="costCentreName" id="costCentreName" />
                                        <input type="hidden"  value="" name="costCentreId" id="costCentreId" />
                                        <div class="error_message"><p>Required</p></div>
                                    </div>
                                    <div class="col-lg-8 col-lg-offset-0 col-md-8 col-md-offset-0 col-sm-8 col-sm-offset-0 col-xs-12 form-group">
                                        <input type="text" class="form-control lbl_move" label="Select Contractor" value="<?php if(isset($sdRegister) && trim($sdRegister['VendorId']) != '') { echo $sdRegister['VendorId']; } else { echo ''; } ?>" name="vendorName" id="vendorName" />
                                        <input type="hidden"  value="" name="vendorId" id="vendorId" />
                                        <div class="error_message"><p>Required</p></div>
                                    </div>
                                    <div id="selSerOrdDiv" class="col-lg-8 col-lg-offset-0 col-md-8 col-md-offset-0 col-sm-8 col-sm-offset-0 col-xs-12 form-group" style="display:none;">
                                        <select class="form-control single_dropdown lbl_move" label="Service Order" style="width:100%;" name="soRegId" id="soRegId">
                                        </select>
                                        <div class="error_message"><p>Required</p></div>
                                    </div>
                                </div>
                            </div>
                            <div class="item" id="secondWin">
                                <!--                                <div class="item min_h550">top-sl-10-->
                                <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 col-xs-12 ">
                                    <div class="col-sm-12" align="left">
                                        <label style="font-size:15px; padding:0 !important" class="col-md-3">Cost Centre</label>
                                        <span id="costCentrePreview" style="color:#ff0000;font-size:14px;padding-left:6px;font-weight:600"></span>
                                    </div>
                                    <div class="col-sm-12" align="left">
                                        <label style="font-size:15px; padding:0 !important" class="col-md-3">Contractor</label>
                                        <span id="ContractorPreview" style="color:#ff0000;font-size:14px;padding-left:6px;font-weight:600"></span>
                                    </div>
                                    <div class="col-sm-12" align="left">
                                        <label style="font-size:15px; padding:0 !important" class="col-md-3">Order No</label>
                                        <span id="OrderPreview" style="color:#ff0000;font-size:14px;padding-left:6px;font-weight:600"></span>
                                    </div>
                                    <div id="resourceGrid"></div>
                                </div>
                                <!--                                </div>-->
                            </div>
                            <ul class="prev_next wpm-next col-lg-7 col-lg-offset-5 col-md-7 col-md-offset-5 col-sm-7 col-sm-offset-5 col-xs-7 col-xs-offset-3">
                                <li id="backPrev"><a href="javascript:void(0);" onclick="return goBack();"><span><i class="fa fa-arrow-left"></i></span> Back</a></li>
                                <li><a href="javascript:void(0);" role="button" id="nextBtn" onclick="return validateLabStg();">Next <span><i class="fa fa-arrow-right"></i></span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="stageTwo" style="display:none;">
                    <div class="col-lg-12">
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Cost Centre</label>
                                        <span class="sprojName"><?php if(isset($sdRegister) && $sdRegister['CostCentreName'] != '') { echo $sdRegister['CostCentreName']; } else { echo ''; } ?></span>
                                    </li>
                                    <li>
                                        <label>Contractor</label>
                                        <span class="sconName"><?php if(isset($sdRegister) && $sdRegister['VendorName'] != '') { echo $sdRegister['VendorName']; } else { echo ''; } ?></span>
                                    </li>
                                    <li>
                                        <label>Service Order</label>
                                        <span class="ssdName"><?php if(isset($sdRegister) && $sdRegister['SONo'] != '') { echo $sdRegister['SONo']; } else { echo ''; } ?></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box box2th zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Service Done Date</label>
                                        <span><input type="text" id="sdDate" name="sdDate" class="date_picker" value="<?php if(isset($sdRegister) && ($sdRegister['SDDate'] != NULL)) { echo date("d-m-Y", strtotime($sdRegister['SDDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>Ref Date</label>
                                        <span><input type="text" id="refDate" name="refDate" class="date_picker" value="<?php if(isset($sdRegister) && ($sdRegister['RefDate'] != NULL)) { echo date("d-m-Y", strtotime($sdRegister['RefDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>From Date</label>
                                        <span><input type="text" id="fromDate" name="fromDate" class="date_picker" value="<?php if(isset($sdRegister) && ($sdRegister['FromDate'] != NULL)) { echo date("d-m-Y", strtotime($sdRegister['FromDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>To Date</label>
                                        <span><input type="text" id="toDate" name="toDate" class="date_picker" value="<?php if(isset($sdRegister) && ($sdRegister['ToDate'] != NULL)) { echo date("d-m-Y", strtotime($sdRegister['ToDate'])); } else { echo date("d-m-Y"); } ?>" readonly /></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-lg-offset-0 col-md-6 col-md-offset-0 col-sm-6 col-sm-offset-0 col-xs-12 col-xs-offset-0">
                            <div class="panel-box box3th zoomIn animated">
                                <ul>
                                    <li>
                                        <label>Service Done No</label>
                                        <span><input type="text" id="sdNo" name="sdNo" value="<?php if(isset($sdRegister) && trim($sdRegister['SDNo']) != '') { echo trim($sdRegister['SDNo']); } else { echo ($genType) ? trim($sdNo) : ''; } ?>" readonly /></span>
                                    </li>
                                    <li>
                                        <label>CC Service Done No</label>
                                        <span><input type="text" id="ccSdNo" name="ccSdNo" value="<?php if(isset($sdRegister) && trim($sdRegister['SDCCNo']) != '') { echo $sdRegister['SDCCNo']; } else { echo ''; } ?>" /></span>
                                    </li>
                                    <li>
                                        <label>Comp Service Done No</label>
                                        <span><input type="text" id="compSdNo" name="compSdNo" value="<?php if(isset($sdRegister) && trim($sdRegister['SDCompNo']) != '') { echo $sdRegister['SDCompNo']; } else { echo ''; } ?>" /></span>
                                    </li>
                                    <li>
                                        <label>Ref No</label>
                                        <span><input type="text" id="refNo" name="refNo" value="<?php if(isset($sdRegister) && trim($sdRegister['RefNo']) != '') { echo trim($sdRegister['RefNo']); } else { echo ($genType) ? trim($sdNo) : '';} ?>" /></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="slic">
                        <ul>
                            <li class="face"><a href="#"></a></li>
                            <li><a href="#"></a></li>
                            <li><a href="#"></a></li>
                        </ul>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-lg-12 clear animated fadeInUp">
                        <!--div id="accordion" class="panel-group">
                            <div class="panel panel-info">
                                <div data-target="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="panel-heading collapsed panel_heads" id="panelheading-1">
                                    <h4 class="panel-title accordion-toggle defa_panels">Bill of Quantity</h4>
                                </div>
                                <div class="panel-collapse collapse" id="collapseOne" style="height: 0px;">
                                    <div class="panel-body bgcolr">
                                        <div class="col-lg-12"-->
                        <div class="error_message selOne" style="padding-right: 10px;padding-bottom: 10px;"><p>please enter atleast one entry...</p></div>
                        <div class="table-responsive top-30">
                            <table class="table" style="margin-bottom:0px;" id="serviceTable">
                                <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>Unit</th>
                                    <th>Qty</th>
                                    <th>Rate</th>
                                    <th class="text-right">Amount</th>
                                    <th>&nbsp;</th>
                                </tr>
                                </thead>
                                <tbody>
                                <?php
                                if(isset($sdServiceTrans) && count($sdServiceTrans) != 0) {
                                    $i = 1;
                                    foreach($sdServiceTrans as $sdTrans) {
                                            ?>
                                            <tr>
                                                <td width="20%">
                                                    <input class="parent_text serSuggest" type="text"
                                                           name="serviceName_<?php echo $i; ?>"
                                                           id="serviceName_<?php echo $i; ?>"
                                                           onfocus="return checkSDUsed(this);"
                                                           value="<?php echo $sdTrans['ServiceName']; ?>" readonly/>
                                                    <input type="hidden" name="serviceId_<?php echo $i; ?>"
                                                           id="serviceId_<?php echo $i; ?>"
                                                           value="<?php echo $sdTrans['ServiceId']; ?>"/>
                                                    <input type="hidden" name="serviceOrderId_<?php echo $i; ?>"
                                                           id="serviceOrderId_<?php echo $i; ?>"/>
                                                </td>
                                                <td width="20%"><input type="hidden" name="unitId_<?php echo $i; ?>"
                                                                       id="unitId_<?php echo $i; ?>"
                                                                       value="<?php echo $sdTrans['UnitId']; ?>"/><input
                                                        class="parent_text" type="text"
                                                        name="unitName_<?php echo $i; ?>"
                                                        id="unitName_<?php echo $i; ?>"
                                                        value="<?php echo $sdTrans['UnitName']; ?>" readonly/></td>
                                                <td width="18%"><input class="parent_text text-right" type="text"
                                                                       name="qty_<?php echo $i; ?>"
                                                                       id="qty_<?php echo $i; ?>"
                                                                       value="<?php echo $this->commonHelper()->sanitizeNumber($sdTrans['Qty'], 3); ?>"
                                                                       onfocus="qtyClick(this)"
                                                                       onchange="return FormatNum(this, 3)"
                                                                       onkeypress="return isDecimal(event,this);"
                                                                       onblur="return calAmount(this),checkqty(this);"/>
                                                    <input type="hidden" name="hiddenQty_<?php echo $i; ?>" id="hiddenQty_<?php echo $i; ?>" value="<?php echo $sdTrans['HiddenQty']; ?>"/>
                                                    <div style="position: relative; display:none;"
                                                         id="wfirst_<?php echo $i; ?>">
                                                        <div class="top-tip top-addtip"
                                                             style="background-color:#506faf ! important;margin-left:-55px ! important;top:-81px !important;width:190px !important;height:44px !important; ">
                                                            <span
                                                                style="color:white;text-align:left">Order Qty:<i id='workSet_<?php echo $i; ?>' style="color:white" value=""><?php echo $this->commonHelper()->sanitizeNumber($sdTrans['SOQty'], 3); ?></i></span>
                                                            <span
                                                                style="color:white;text-align:left">ServiceDone Qty:<i id='previousSet_<?php echo $i; ?>' style="color:white" value=""></i></span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td width="18%"><input class="parent_text text-right" type="text"
                                                                       name="rate_<?php echo $i; ?>"
                                                                       id="rate_<?php echo $i; ?>"
                                                                       value="<?php echo $this->commonHelper()->sanitizeNumber($sdTrans['Rate'], 2); ?>"
                                                                       onchange="return FormatNum(this, 2)"
                                                                       onkeypress="return isDecimal(event,this);"
                                                                       onblur="return calAmount(this);"/></td>
                                                <td width="20%">
                                                    <input class="parent_text text-right" type="text"
                                                           name="amount_<?php echo $i; ?>" id="amount_<?php echo $i; ?>"
                                                           value="<?php echo $sdTrans['Amount']; ?>"
                                                           onchange="return FormatNum(this, 2),sumAmount()"/>
                                                </td>
                                                <td width="4%" align="center" class="action_btns_td">
                                                    <ul class="action_btns">
                                                        <li>
                                                            <a href="javascript:void(0);"
                                                               class="serviceDelete_<?php echo $i; ?>"
                                                               id="deleteTr_<?php echo $i; ?>"
                                                               onclick="deleteServiceRow(this, event); "><i
                                                                    class="fa fa-trash-o" data-toggle="tooltip"
                                                                    data-placement="top"
                                                                    data-original-title="Delete"></i></a>
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                            <?php $i++;
                                        }
                                } ?>
                                <tr class="total">
                                    <td colspan="3">&nbsp;</td>
                                    <td align="right" class="rate_pri">Total Amount</td>
                                    <td width="20%"><input class="parent_text text-right bold-text-clr" type="text" id="totalAmount" onchange="return FormatNum(this, 2)" readonly /></td>
                                    <td width="5%">&nbsp;</td>
                                </tr>
                                </tbody>
                            </table>
                            <input type="hidden" name="serviceRows" id="serviceRows" value="" />
                        </div>

                    </div>

                        <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0">
                            <div  class="col-md-12" style="padding:0 !important;margin-top:30px">
                                <textarea  class="lbl_move" style="width:100%; border:1px solid #ddd; height:80px !important;"label="Narration" id="narration" name="narration"><?php if(isset($sdRegister) && $sdRegister['Narration'] != '') { echo $sdRegister['Narration']; } else { echo ''; } ?></textarea>
                            </div>
                        </div>
                </div>
            </form>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<div id="submitDiv" class="col-lg-12 savebtn_area" style="">
    <ul>
        <li class="dropdown save_btn float_r"><a href="javascript:void(0);" data-toggle="tooltip" class="ripple" title="Submit" onclick="return submitForm();">Submit</a>
            <?php if(isset($sdRegister)){?>
        <li class="cancel_btn cancel_btn_bluecolor float_l"><a href="<?php echo $this->basePath() . '/wpm/labourstrength/service-done-register';?>" class="ripple">Cancel <i class="fa fa-times-circle-o" aria-hidden="true"></i></a></li>
        <?php }else{?>
            <li class="cancel_btn cancel_btn_bluecolor float_l"><a href="<?php echo $this->basePath() . '/wpm/labourstrength/service-done';?>" class="ripple">Cancel <i class="fa fa-times-circle-o" aria-hidden="true"></i></a></li>
        <?php }?>    </ul>
</div>
<script id="I-template" type="text/template">
    <tr>
        <td width="20%">
            <input class="parent_text serSuggest" type="text" name="serviceName__" id="serviceName__" onfocus="return checkSDUsed(this);" />
            <input type="hidden" name="serviceId__" id="serviceId__" />
            <input type="hidden" name="serviceOrderId__" id="serviceOrderId__" />
        </td>
        <td width="20%"><input type="hidden" name="unitId__" id="unitId__" />
            <input class="parent_text" type="text" name="unitName__" id="unitName__" readonly /></td>
        <td width="18%">
            <input class="parent_text text-right" type="text" name="qty__" id="qty__" onfocus="qtyClick(this)" onchange="return FormatNum(this, 3)" onkeypress="return isDecimal(event,this);" onblur="return calAmount(this),checkqty(this);" />
            <input type="hidden" name="hiddenQty__" id="hiddenQty__" />
            <div style="position: relative; display:none;" id="wfirst__">
                <div class="top-tip top-addtip"style="background-color:#506faf ! important;margin-left:-55px ! important;top:-77px !important;width:190px !important;height:44px !important; ">
                    <span style="color:white;text-align:center">Order Qty:<i id='workSet__' style="color:white"></i></span>
                    <span style="color:white;text-align:center;display:none !important;" id="previousSpan__">ServiceDone Qty:<i id='previousSet__' style="color:white"></i></span>
                </div>
            </div>
        </td>
        <td width="18%"><input class="parent_text text-right" type="text" name="rate__" id="rate__" onchange="return FormatNum(this, 2)" onkeypress="return isDecimal(event,this);" onblur="return calAmount(this);" /></td>
        <td width="20%">
            <input class="parent_text text-right" type="text" name="amount__" id="amount__" onchange="return FormatNum(this, 2),sumAmount()" />
        </td>
        <td width="4%" align="center" class="action_btns_td">
            <ul class="action_btns">
                <li>
                    <a href="javascript:void(0);" class="serviceDelete__" id="deleteTr__" onclick="deleteServiceRow(this, event);" style="display:none;"><i class="fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="Delete"></i></a>
                </li>
            </ul>
        </td>
    </tr>
</script>

<script>
    var $sdServiceTrans=<?php echo (isset($sdServiceTrans)) ? json_encode($sdServiceTrans) : '[]';?>;
    var opCostCentre=<?php echo (isset($opCostCentre)) ? json_encode($opCostCentre) : '[]';?>;
    var vendorMaster=<?php echo (isset($vendorMaster)) ? json_encode($vendorMaster) : '[]';?>;
    var estimates=<?php echo (isset($estimates)) ? json_encode($estimates) : '[]';?>;
    if(estimates.length != 0){
        var i=0;
        $.each(estimates,function(i,o){

        });
    }
    $("#backPrev").hide();
    <?php if($serDoneId != 0){?>
    $('#stageOne').hide();
    $('#stageTwo').show();
    <?php } ?>
    var serviceList = '[]';
    var tmp_serviceList = serviceList;
    var sel_resource_count = 0;
    var $resourceGrid = $("#resourceGrid");
    var resourceSource = {
        localdata: [],
        dataType: "json",
        dataFields: [
            { name: 'Include', type: 'boolean' },
            { name: 'SORegisterId', type: 'int' },
            { name: 'UnitId', type: 'int' },
            { name: 'Amount', type: 'int' },
            { name: 'Rate', type: 'int' },
            { name: 'Qty', type: 'int' },
            { name: 'BalQty', type: 'int' },
            { name: 'SDQty', type: 'int' },
            { name: 'UnitName', type: 'string' },
            { name: 'data', type: 'int' },
            { name: 'value', type: 'string' }
        ],
        id: 'data'
    };
    var resourceAdapter = new $.jqx.dataAdapter(resourceSource);
    $(function(){
        bindcostCentreAutoComplete();
        bindContractorAutoComplete();
        $('.cnt_slider .carousel').carousel({
            interval: false
        });

        $('.ripple').materialripple();
        nextAccordian(1);
        $resourceGrid.jqxGrid({
            width: '100%',
            pageable: true,
            rowsheight: 35,
            selectionMode: 'singleRow',
            pagerButtonsCount: 6,
            autoheight: true,
            source: resourceAdapter,
            altrows: true,
            filterable: true,
            showfilterrow: true,
            editable: true,
            columnsResize: true,
            columns: [
                { text: 'ServiceId',dataField: 'data', hidden: true},
                { text: 'SORegisterId',dataField: 'SORegisterId', hidden: true},
                { text: 'UnitId',dataField: 'UnitId', hidden: true},
                { text: 'Amount',dataField: 'Amount', hidden: true},
                { text: 'UnitName',dataField: 'UnitName', hidden: true},
                { text: 'Rate',dataField: 'Rate', hidden: true},
                { text: 'Qty',dataField: 'Qty', hidden: true},
                { text: 'BalQty',dataField: 'BalQty', hidden: true},
                { text: 'SDQty',dataField: 'SDQty', hidden: true},
                { text: '', dataField: 'Include', columntype: 'checkbox', align: 'center', width: '10%'},
                { text: 'Service Name', dataField: 'value',width:'95%', editable:false}
            ]
        });
        $resourceGrid.on('cellvaluechanged', function (event) {
            var args = event.args;
            var datarow = $resourceGrid.jqxGrid('getrowdata', args.rowindex);
            if(args.newvalue === true)
                sel_resource_count++;
            else
                sel_resource_count--;
            $('#NoOfSelResource').html(sel_resource_count);
            generateSelResourceInputs();
        });
    });
    function qtyClick(x){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        $('#wfirst_' + rowid).show();
    }

    function checkqty(x,y){
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        var eVal=parseInt($('#workSet_'+rowid).text());
        var pVal=parseInt($('#previousSet_'+rowid).text());
        var cQty=parseInt($('#qty_'+rowid).val());
        if(cQty == '' || isNaN(cQty)) cQty=0;
        if(eVal == '' || isNaN(eVal)) eVal=0;
        if(pVal == '' || isNaN(pVal)) pVal=0;
        $('#wfirst_' + rowid).hide();
        if (parseFloat(eVal-pVal) < parseFloat(cQty)) {
            $('#qty_' + rowid).addClass('red_bdr');
            return false;
        } else {
            $('#qty_' + rowid).removeClass('red_bdr');
        }
    }
    //    $('.cnt_slider .carousel').carousel({
    //        interval: false
    //    });
    function generateSelResourceInputs() {
        var rows = $resourceGrid.jqxGrid('getrows');
        var $inputs = '';
        for(var i = 0; i < rows.length; i++) {
            var row = rows[i];
            if (row.Include === true) {
                $inputs += '<input type="hidden" name="resourceIds[]" class="resourceIds" value="' + row.uid + '"/>';
            }
        }
        $('#resourceInputsWrapper').html($inputs);
    }
    //    function qtyClick(x){
    //        var $x = $(x);
    //        var ids = $x[0].id.split('_');
    //        var rowid =ids[1];
    //            $('#wfirst_' + rowid).show();
    //    }

    function addServiceRow(x){
        var srowid=x;
        var iTemplate = $('#I-template').html();
        var $serRowId = $('#serviceRows');
        srowid ++;
        $('#serviceTable tbody').find('.total').before(iTemplate.replace(/__/g, '_' + srowid));
        $serRowId.val(srowid);
    }

    function nextAccordian(id)
    {
        $('#panelheading-' + id).trigger('click');
    }

    var $costCentreId = $('#costCentreId'),
        $vendorId = $('#vendorId');
    $soRegId = $('#soRegId');

    $('#costCentreId').on('change', function() {
        getServiceOrder();
    });

    $('#vendorId').on('change', function() {
        getServiceOrder();
    });

    function getServiceOrder()
    {
        if($costCentreId.val() != '' && $vendorId.val() != '') {
            $('#selSerOrdDiv').show();
            $.post(getBaseURL()+'wpm/labourstrength/get-service-orders', { ccId: $costCentreId.val(), vId: $vendorId.val() },
                function(data) {
                    $('#soRegId').empty();
                    $('#soRegId').append('<option value="">Select Service Order</option>');
                    var returnData = JSON.parse(data);
                    $.each(returnData, function(key, value){
                        $('#soRegId')
                            .append($("<option></option>")
                                .attr("value",value.data)
                                .text(value.value));
                    });
                });
        } else {
            $('#selSerOrdDiv').hide();
        }
    }

    function validateLabStg()
    {
        $('.error_message').hide();
        var currentIndex = $('#carousel-example-generic .item.active').index();
        //alert(currentIndex);
        if(currentIndex == 0) {
            var lCostCentreId = isNullCheck($costCentreId.val(),'number');
            var lVendorId = isNullCheck($vendorId.val(),'number');
            if (lCostCentreId == 0) {
                $costCentreId.closest('.form-group').find(".error_message").show();
                return;
            } else {
                var projName = $('#costCentreId option:selected').text();
                $('.projName').val(projName);
                $('.sprojName').html($('#costCentreName').val());
                $('#sdDate').val($('#sdeDate').val());
                /*getValueOfSlider('next');
                 $('#carousel-example-generic').carousel({
                 slide: "next"
                 });*/
            }

            if (lVendorId == 0) {
                $vendorId.closest('.form-group').find(".error_message").show();
                return;
            } else {
                if ($('#soRegId').val() == 0) {
                    $('#soRegId').closest('.form-group').find(".error_message").show();
                    return;
                }
                var conName = $('#vendorId option:selected').text();
                var stName = $('#soRegId option:selected').text();
                $('.conName').val(conName);
                $('.sdName').val(stName);
                $('#costCentrePreview').text($('#costCentreName').val());
                $('#ContractorPreview').text($('#vendorName').val());
                $('#OrderPreview').text(stName);
                $('.sconName').html($('#vendorName').val());
                $('.ssdName').html(stName);
                getValueOfSlider('next');
                $('#carousel-example-generic').carousel({
                    slide: "next"
                });
                bindServices();
            }
        } else {
            $.post(getBaseURL() + 'wpm/labourstrength/get-comp-cc-no', {
                    typeId: $('#sdTypeId').val(),
                    ccId: $('#costCentreId').val()
                },
                function (data) {
                    var vNo = data.split('###');
                    $('#ccSdNo').val($.trim(vNo[0]));
                    $('#compSdNo').val($.trim(vNo[1]));
                    if($.trim(vNo[0]) != '')
                        $('#ccSdNo').prop('readonly', true);
                    if($.trim(vNo[1]) != '')
                        $('#compSdNo').prop('readonly', true);
                });
            showBack('e');
            bindServices();
            var rows = $('#resourceGrid').jqxGrid('getboundrows');
            var doneRow=0;
            var iTemplate = $('#I-template').html();
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                if (row.Include === true) {
                    doneRow++;
                    $('#serviceTable tbody').find('.total').before(iTemplate.replace(/__/g, '_' + doneRow));
                    $('#serviceId_'+doneRow).val(row.data);
                    $('#serviceName_'+doneRow).val(row.value);
                    $('#unitId_'+doneRow).val(row.UnitId);
                    $('#unitName_'+doneRow).val(row.UnitName);
                    $('#rate_'+doneRow).val(sanitizeNumber(row.Rate,2)).attr('readonly',true);
                    $('#sAmount').val(row.Amount);
                    $('#workSet_'+ doneRow).text(sanitizeNumber(row.Qty,3));
                    if(row.SDQty != 0) {
                        $('#previousSpan_' + doneRow).show();
                        $('#previousSet_' + doneRow).text(sanitizeNumber(row.SDQty, 3));
                    }
                    $('#serviceOrderId_'+doneRow).val(row.SORegisterId);
                    $('#deleteTr_'+doneRow).show();
                }
            }
            doneRow+=1;
            $('#serviceTable tbody').find('.total').before(iTemplate.replace(/__/g, '_' + doneRow));
            $('#serviceRows').val(doneRow);
        }
    }
    function bindServices(){
        $.post(getBaseURL()+'wpm/labourstrength/get-order-services', { soRegId: $('#soRegId').val() },
            function(data) {
                serviceList = JSON.parse(data);
                tmp_serviceList = serviceList;
                bindServiceAutoComplete();
                resourceSource.localdata = data;
                resourceAdapter.dataBind();
                $('#NoOfSelResource').html(0);
                $('#carousel-example-generic').carousel({
                    slide: "next"
                });
                $('.loading_area').hide();
            });
    }

    function goBack()
    {
        $('#carousel-example-generic').carousel({
            slide: "prev"
        });
        getValueOfSlider('prev');
    }

    function getValueOfSlider(slType)
    {
        var curIndex = $('#carousel-example-generic .item.active').index();
        if(slType == 'next') {
            $("#backPrev").show();
        }
        if(curIndex == 1 && slType == 'prev') {
            $("#backPrev").hide();
        } else {
            $("#backPrev").show();
        }
    }

    function showBack(sbType)
    {
        if(sbType == 'a') {
            $('#submitDiv').hide();
            $('#stageTwo').hide();
            $('#stageOne').show();
            $('#titleTag').addClass('text-center');
        } else {
            $('#stageOne').hide();
            $('#stageTwo').show();
            $('#submitDiv').show();
            $('#titleTag').removeClass('text-center');
        }
    }

    function submitForm()
    {
        var errFlag = 0;
        var sdRows = $('#serviceRows').val();
        var sdCnt = 0;

        $('.error_message').hide();
        $('.red_bdr').removeClass('red_bdr');
        for(i=1;i<sdRows;i++){
            $('#qty_'+i).removeClass('red_bdr');
            var previous=isNullCheck(parseInt($('#previousSet_'+i).text()),'number');

            if(parseFloat(parseInt($('#qty_'+i).val())) > parseFloat(parseInt($('#workSet_'+i).text())-previous)) {
                $('#qty_'+i).addClass('red_bdr');
                $('#qty_'+i).focus();
                errFlag = 1;
                return false;
            }
        }

        if($.trim($('#fromDate').val()) != '' && $.trim($('#toDate').val()) != '') {
            if (!compareDate($('#fromDate').val(), $('#toDate').val())) {
                $('#toDate').addClass('red_bdr');
                $('#toDate').focus();
                errFlag = 1;
                return false;
            }
        }
        if($.trim($('#sdNo').val()) == '') {
            $('#sdNo').addClass('red_bdr');
            $('#sdNo').focus();
            errFlag = 1;
            return false;
        }
//        if(parseInt($('#totalAmount').val()) > parseInt($('#sAmount').val())) {
//            $('#totalAmount').removeClass('bold-text-clr');
//            $('#totalAmount').addClass('red_bdr');
//            $('#totalAmount').focus();
//            alert("Total Amount Does Not Exist Service Order Amount");
//            errFlag = 1;
//            return false;
//        }
        if($.trim($('#ccSdNo').val()) == '') {
            $('#ccSdNo').addClass('red_bdr');
            $('#ccSdNo').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#compSdNo').val()) == '') {
            $('#compSdNo').addClass('red_bdr');
            $('#compSdNo').focus();
            errFlag = 1;
            return false;
        }
        if($.trim($('#refNo').val()) == '') {
            $('#refNo').addClass('red_bdr');
            $('#refNo').focus();
            errFlag = 1;
            return false;
        }
        for (var i = 1; i <= sdRows; i++) {
            if($('#serviceId_'+i).val() == '') {
                sdCnt = sdCnt + 1;
            }
        }
        if(sdRows == sdCnt) {
            $(".selOne").show();
            errFlag = 1;
            return false;
        }

        if(errFlag == 0) {
            $('#formWrapper').submit();
        }
    }

    //    /* For Service */
    //    function addServiceRow(x)
    //    {
    //        var $x = $(x),
    //            $tr = $x.closest('tr'),
    //            key = $x[0].id.split('_')[1];
    //
    //        if ($tr.next('tr:not(.total)').length != 0)
    //            return;
    //
    //        if ($('#serviceName_' + key).val().length == 0 && $('#serviceId_' + key).val().length == 0)
    //            return;
    //
    //        var $rowid = $('#serviceRows'),
    //            count = parseInt($rowid.val()) + 1,
    //            template = $('#dummy-service-row tbody').html();
    //
    //        template = template.replace(/__1/g, '_' + count);
    //        $tr.after(template);
    //        $rowid.val(count);
    //        $('.serviceDelete_' + key).show();
    //        bindServiceAutoComplete();
    //    }

    //    function insertServiceRow()
    //    {
    //        var $rowid = $('#serviceRows'),
    //            count = parseInt($rowid.val()) + 1,
    //            template = $('#dummy-service-row tbody').html();
    //
    //        template = template.replace(/__1/g, '_' + count);
    //        $('#serviceTable tbody tr:last').before(template);
    //        $rowid.val(count);
    //        bindServiceAutoComplete();
    //    }

    function deleteServiceRow(x,e)
    {
        e.preventDefault();
        if (!confirm('Do you want to Delete'))
            return false;

        var $tr = $(x).closest('tr'),
            $tbody = $tr.parent('tbody');

        if ($tbody.find('> tr:not(.total)').length == 1) {
            var iTemplate = $('#I-template').html();
            $('#serviceTable tbody').find('.total').before(iTemplate.replace(/__/g, '_' + srowid));
            $('#serviceRows').val(1);
        }
        var $x = $(x);
        var ids = $x[0].id.split('_');
        var rowid =ids[1];
        var mqty=parseFloat($('#totalAmount').val())-parseFloat($('#amount_'+rowid).val());
        $('#totalAmount').val(mqty).trigger('change');
        $tr.remove();
        return false;
    }

    function bindServiceAutoComplete()
    {
        $('#serviceTable .serSuggest').autocomplete({
            lookup: tmp_serviceList,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    var $this = $(this);
                    var key1 = $this[0].id.split('_')[1];
                    $this.prop('readonly', true).addClass('border-none');

                    $('#serviceId_'+ key1).val(suggestion.data);
                    $('#unitId_'+ key1).val(suggestion.UnitId);
                    $('#unitName_'+ key1).val(suggestion.UnitName);
                    $('#workSet_'+ key1).text(sanitizeNumber(suggestion.Qty,3));
                    if(suggestion.SDQty != 0) {
                        $('#previousSpan_' + key1).show();
                        $('#previousSet_' + key1).text(sanitizeNumber(suggestion.SDQty, 3));
                    }
                    $('#rate_'+ key1).val(sanitizeNumber(suggestion.Rate,2)).attr('readonly',true);
                    addServiceRow(key1);
                    $('#deleteTr_'+key1).show();
                    removeError($(this));
                }
            }, onSearchStart: function(suggestion) {
                var $this = $(this);
                var key1 = $this[0].id.split('_')[1];

                $('#serviceId_'+key1).val('');
                $('#unitId_'+ key1).val('');
                $('#unitName_'+ key1).val('');
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
                } else
                    removeError($(this));
            }
        });

    }

    function checkSDUsed(x) {
        var id = $(x)[0].id.split('_')[1];
        var reskeyid = $('input[id*=serviceId_]');
        tmp_serviceList = serviceList;
        tmp_serviceList = $.grep(serviceList, function (element, index) {
            var is_selected = true;
            $.each(reskeyid, function (i, obj) {
                var $this = $(this),
                    name = $this[0].id;
                var arrname = name.split('_');
                var key1 = arrname[1];
                if (key1 != id) {
                    if (element.data == $this.val()) {
                        is_selected = false;
                        return false;
                    }
                }
            });
            return is_selected;
        });
        bindServiceAutoComplete();
    }

    function getServices(soRgId)
    {
        $.post(getBaseURL()+'wpm/labourstrength/get-order-services', { soRegId: soRgId },
            function(data) {
                serviceList = JSON.parse(data);
                tmp_serviceList = serviceList;
            });
    }

    function calAmount(x)
    {
        var amt = 0;
        var rId = $(x)[0].id.split('_')[1];
        if($('#qty_' + rId).val() != '' && $('#rate_' + rId).val() != '') {
            var amt = parseFloat($('#qty_' + rId).val()) * parseFloat($('#rate_' + rId).val());
        }
        $('#amount_'+rId).val(amt).trigger('change');

        sumAmount();
    }

    function sumAmount()
    {
        var $samt = $('input[id^=amount_]');
        var sumAmt = 0;
        $.each($samt, function() {
            var seAmt = parseFloat($(this).val());

            if (isNaN(seAmt))
                return;

            sumAmt += seAmt;
        });
        $('#totalAmount').val(sumAmt).trigger('change');
    }

    <?php if(isset($sdServiceTrans)) { ?>
    getServices('<?php echo $sdRegister['SORegisterId']; ?>');
    showBack('e');
    //    $('.cancel_btn').hide();
    //    $('.save_btn').hide();
    addServiceRow('<?php if(count($sdServiceTrans) != 0){echo count($sdServiceTrans);} else {echo "0";}?>');
    sumAmount();
    <?php } ?>
    /* For Service */
    <?php if(isset($sdRegister)){?>
    <?php if($sdRegister['Approve'] == 'Y'){?>
    $('.save_btn').hide();
    <?php }} ?>

    <?php
    if(isset($sdServiceTrans) && count($sdServiceTrans) != 0) {
     $i = 1;
     foreach($sdServiceTrans as $sdTrans) {
     ?>
    $('#amount_<?php echo $i; ?>').trigger('change');
    <?php $i++;
    }
    }
    ?>
    //costCentre AutoComplete
    function bindcostCentreAutoComplete()
    {
        $('#costCentreName').autocomplete({
            lookup:opCostCentre,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $('#costCentreId').val(suggestion.data).trigger('change');
                    $('#costCentreName').val(suggestion.value);
                    $(this).removeClass('error');
                }
            }, onSearchStart: function(suggestion) {
                $('#costCentreId').val(0);
//                $('#costCentreName').val('');
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
//                    $('#costCentreId').val(0);
//                    $('#costCentreName').val('');
                } else
                    $(this).removeClass('error');
            }
        });

    }

    //Contractor AutoComplete
    function bindContractorAutoComplete()
    {
        $('#vendorName').autocomplete({
            lookup:vendorMaster,
            lookupFilter: function (suggestion, originalQuery, queryLowerCase) {
                if (queryLowerCase == '*') {
                    return suggestion.value;
                } else {
                    var re = new RegExp($.Autocomplete.utils.escapeRegExChars(queryLowerCase), 'gi');
                    return re.test(suggestion.value);
                }
            }, onSelect: function(suggestion) {
                if(suggestion) {
                    $('#vendorId').val(suggestion.data).trigger('change');
                    $('#vendorName').val(suggestion.value);
                    $(this).removeClass('error');
                }
            }, onSearchStart: function(suggestion) {
                $('#vendorId').val(0);
//                $('#vendorName').val('');
            }, onSearchComplete: function (query, suggestions) {
                if(!suggestions.length){
                    $(this).addClass('error');
//                    $('#vendorId').val(0);
//                    $('#vendorName').val('');
                } else
                    $(this).removeClass('error');
            }
        });

    }
</script>